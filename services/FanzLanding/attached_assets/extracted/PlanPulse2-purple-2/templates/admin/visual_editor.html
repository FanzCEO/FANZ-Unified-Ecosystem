{% extends "base.html" %} {% block title %}Visual Theme Editor - {{
theme.display_name }}{% endblock %} {% block content %}
<div class="visual-editor-container">
  <!-- Editor Toolbar -->
  <div class="editor-toolbar">
    <div class="toolbar-left">
      <button class="btn btn-sm btn-outline-secondary" onclick="goBack()">
        <i class="fas fa-arrow-left me-2"></i>Back
      </button>
      <span class="theme-name">{{ theme.display_name }}</span>
    </div>
    <div class="toolbar-center">
      <div class="view-controls">
        <button class="btn btn-sm btn-primary active" data-view="desktop">
          <i class="fas fa-desktop"></i>
        </button>
        <button class="btn btn-sm btn-outline-primary" data-view="tablet">
          <i class="fas fa-tablet"></i>
        </button>
        <button class="btn btn-sm btn-outline-primary" data-view="mobile">
          <i class="fas fa-mobile"></i>
        </button>
      </div>
    </div>
    <div class="toolbar-right">
      <button class="btn btn-sm btn-outline-warning" onclick="previewTheme()">
        <i class="fas fa-eye me-2"></i>Preview
      </button>
      <button class="btn btn-sm btn-success" onclick="saveTheme()">
        <i class="fas fa-save me-2"></i>Save
      </button>
      <button class="btn btn-sm btn-info" onclick="publishTheme()">
        <i class="fas fa-rocket me-2"></i>Publish
      </button>
    </div>
  </div>

  <!-- Main Editor Layout -->
  <div class="editor-layout">
    <!-- Components Panel -->
    <div class="components-panel">
      <div class="panel-header">
        <h3><i class="fas fa-puzzle-piece me-2"></i>Components</h3>
        <button
          class="btn btn-sm btn-outline-primary"
          onclick="togglePanel('components')"
        >
          <i class="fas fa-times"></i>
        </button>
      </div>

      <div class="components-search">
        <input
          type="text"
          class="form-control form-control-sm"
          placeholder="Search components..."
          id="componentSearch"
        />
      </div>

      <div class="components-grid">
        {% for component in components %}
        <div
          class="component-item"
          draggable="true"
          data-component="{{ component.type }}"
        >
          <div class="component-icon">
            <i class="{{ component.icon }}"></i>
          </div>
          <div class="component-info">
            <h4>{{ component.name }}</h4>
            <p>Drag to canvas</p>
          </div>
        </div>
        {% endfor %}
      </div>

      <!-- Advanced Components -->
      <div class="panel-section">
        <h4><i class="fas fa-magic me-2"></i>Advanced</h4>
        <div class="advanced-components">
          <div class="component-item" data-component="custom_html">
            <i class="fas fa-code"></i>
            <span>Custom HTML</span>
          </div>
          <div class="component-item" data-component="embed">
            <i class="fas fa-external-link-alt"></i>
            <span>Embed Code</span>
          </div>
          <div class="component-item" data-component="animation">
            <i class="fas fa-play"></i>
            <span>Animation</span>
          </div>
        </div>
      </div>
    </div>

    <!-- Canvas Area -->
    <div class="canvas-area">
      <div class="canvas-container">
        <div class="canvas-frame" id="themeCanvas">
          <div class="canvas-viewport">
            <!-- Live preview area where components are dropped -->
            <div class="page-preview" id="pagePreview">
              <div class="drop-zone" data-zone="header">
                <div class="drop-indicator">
                  <i class="fas fa-plus"></i>
                  <span>Drop header components here</span>
                </div>
              </div>
              <div class="drop-zone" data-zone="main">
                <div class="drop-indicator">
                  <i class="fas fa-plus"></i>
                  <span>Drop main content here</span>
                </div>
              </div>
              <div class="drop-zone" data-zone="footer">
                <div class="drop-indicator">
                  <i class="fas fa-plus"></i>
                  <span>Drop footer components here</span>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Canvas Controls -->
      <div class="canvas-controls">
        <div class="zoom-controls">
          <button class="btn btn-sm btn-outline-secondary" onclick="zoomOut()">
            <i class="fas fa-search-minus"></i>
          </button>
          <span class="zoom-level">100%</span>
          <button class="btn btn-sm btn-outline-secondary" onclick="zoomIn()">
            <i class="fas fa-search-plus"></i>
          </button>
        </div>
        <button
          class="btn btn-sm btn-outline-secondary"
          onclick="resetCanvas()"
        >
          <i class="fas fa-undo"></i>
        </button>
      </div>
    </div>

    <!-- Properties Panel -->
    <div class="properties-panel">
      <div class="panel-header">
        <h3><i class="fas fa-sliders-h me-2"></i>Properties</h3>
        <button
          class="btn btn-sm btn-outline-primary"
          onclick="togglePanel('properties')"
        >
          <i class="fas fa-times"></i>
        </button>
      </div>

      <!-- Style Controls -->
      <div class="panel-section" id="styleControls">
        <h4><i class="fas fa-palette me-2"></i>Style</h4>

        <!-- Colors -->
        <div class="control-group">
          <label>Primary Color</label>
          <div class="color-input-group">
            <input
              type="color"
              class="form-control color-picker"
              id="primaryColor"
              value="{{ theme.color_config.primary if theme.color_config else '#00D4FF' }}"
            />
            <input
              type="text"
              class="form-control color-text"
              value="{{ theme.color_config.primary if theme.color_config else '#00D4FF' }}"
            />
          </div>
        </div>

        <div class="control-group">
          <label>Secondary Color</label>
          <div class="color-input-group">
            <input
              type="color"
              class="form-control color-picker"
              id="secondaryColor"
              value="{{ theme.color_config.secondary if theme.color_config else '#FF007F' }}"
            />
            <input
              type="text"
              class="form-control color-text"
              value="{{ theme.color_config.secondary if theme.color_config else '#FF007F' }}"
            />
          </div>
        </div>

        <div class="control-group">
          <label>Accent Color</label>
          <div class="color-input-group">
            <input
              type="color"
              class="form-control color-picker"
              id="accentColor"
              value="{{ theme.color_config.accent if theme.color_config else '#FFD700' }}"
            />
            <input
              type="text"
              class="form-control color-text"
              value="{{ theme.color_config.accent if theme.color_config else '#FFD700' }}"
            />
          </div>
        </div>

        <!-- Typography -->
        <div class="control-group">
          <label>Font Family</label>
          <select class="form-select form-select-sm" id="fontFamily">
            <option value="Inter">Inter</option>
            <option value="Roboto">Roboto</option>
            <option value="Poppins">Poppins</option>
            <option value="Montserrat">Montserrat</option>
            <option value="Open Sans">Open Sans</option>
          </select>
        </div>
      </div>

      <!-- Layout Controls -->
      <div class="panel-section">
        <h4><i class="fas fa-th-large me-2"></i>Layout</h4>

        <div class="control-group">
          <label>Container Width</label>
          <div class="input-group input-group-sm">
            <input
              type="number"
              class="form-control"
              id="containerWidth"
              value="1200"
            />
            <span class="input-group-text">px</span>
          </div>
        </div>

        <div class="control-group">
          <label>Header Height</label>
          <div class="input-group input-group-sm">
            <input
              type="number"
              class="form-control"
              id="headerHeight"
              value="80"
            />
            <span class="input-group-text">px</span>
          </div>
        </div>
      </div>

      <!-- Assets Manager -->
      <div class="panel-section">
        <h4><i class="fas fa-images me-2"></i>Assets</h4>

        <div class="asset-upload">
          <input
            type="file"
            id="assetUpload"
            class="d-none"
            accept="image/*"
            multiple
          />
          <button
            class="btn btn-outline-primary btn-sm w-100"
            onclick="document.getElementById('assetUpload').click()"
          >
            <i class="fas fa-upload me-2"></i>Upload Assets
          </button>
        </div>

        <div class="assets-grid" id="assetsGrid">
          <!-- Assets will be loaded here -->
        </div>
      </div>
    </div>
  </div>

  <!-- Layers Panel (Bottom) -->
  <div class="layers-panel">
    <div class="panel-header">
      <h4><i class="fas fa-layer-group me-2"></i>Layers</h4>
      <div class="layer-controls">
        <button class="btn btn-sm btn-outline-secondary" onclick="addLayer()">
          <i class="fas fa-plus"></i>
        </button>
        <button
          class="btn btn-sm btn-outline-secondary"
          onclick="deleteLayer()"
        >
          <i class="fas fa-trash"></i>
        </button>
      </div>
    </div>
    <div class="layers-list" id="layersList">
      <!-- Layers will be populated here -->
    </div>
  </div>
</div>

<!-- Component Configuration Modal -->
<div class="modal fade" id="componentModal" tabindex="-1">
  <div class="modal-dialog modal-lg">
    <div class="modal-content bg-dark border-primary">
      <div class="modal-header border-primary">
        <h5 class="modal-title">Configure Component</h5>
        <button
          type="button"
          class="btn-close btn-close-white"
          data-bs-dismiss="modal"
        ></button>
      </div>
      <div class="modal-body" id="componentConfig">
        <!-- Component-specific configuration will load here -->
      </div>
      <div class="modal-footer border-primary">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
          Cancel
        </button>
        <button
          type="button"
          class="btn btn-primary"
          onclick="applyComponentConfig()"
        >
          Apply
        </button>
      </div>
    </div>
  </div>
</div>

<style>
  .visual-editor-container {
    height: 100vh;
    background: var(--background);
    display: flex;
    flex-direction: column;
    overflow: hidden;
  }

  .editor-toolbar {
    background: rgba(26, 26, 46, 0.95);
    border-bottom: 1px solid rgba(0, 212, 255, 0.3);
    padding: 10px 20px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    backdrop-filter: blur(10px);
    z-index: 1000;
  }

  .theme-name {
    color: var(--text-primary);
    font-weight: bold;
    margin-left: 15px;
  }

  .view-controls .btn {
    margin: 0 2px;
  }

  .editor-layout {
    display: flex;
    flex: 1;
    min-height: 0;
  }

  .components-panel {
    width: 280px;
    background: rgba(26, 26, 46, 0.9);
    border-right: 1px solid rgba(0, 212, 255, 0.3);
    display: flex;
    flex-direction: column;
    backdrop-filter: blur(10px);
  }

  .panel-header {
    padding: 15px 20px;
    border-bottom: 1px solid rgba(0, 212, 255, 0.3);
    display: flex;
    justify-content: space-between;
    align-items: center;
  }

  .panel-header h3 {
    color: var(--text-primary);
    font-size: 1rem;
    margin: 0;
  }

  .components-search {
    padding: 15px 20px;
    border-bottom: 1px solid rgba(0, 212, 255, 0.2);
  }

  .components-grid {
    flex: 1;
    padding: 20px;
    overflow-y: auto;
  }

  .component-item {
    background: rgba(0, 212, 255, 0.1);
    border: 1px solid rgba(0, 212, 255, 0.3);
    border-radius: 8px;
    padding: 15px;
    margin-bottom: 10px;
    cursor: grab;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    gap: 12px;
  }

  .component-item:hover {
    border-color: var(--primary);
    background: rgba(0, 212, 255, 0.2);
    transform: translateY(-2px);
  }

  .component-item:active {
    cursor: grabbing;
  }

  .component-icon {
    font-size: 1.5rem;
    color: var(--primary);
    width: 30px;
    text-align: center;
  }

  .component-info h4 {
    color: var(--text-primary);
    font-size: 0.9rem;
    margin-bottom: 2px;
  }

  .component-info p {
    color: var(--text-secondary);
    font-size: 0.75rem;
    margin: 0;
  }

  .canvas-area {
    flex: 1;
    background: #f5f5f5;
    position: relative;
    display: flex;
    flex-direction: column;
  }

  .canvas-container {
    flex: 1;
    padding: 30px;
    overflow: auto;
  }

  .canvas-frame {
    background: white;
    border-radius: 10px;
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
    min-height: 800px;
    margin: 0 auto;
    transition: all 0.3s ease;
  }

  .canvas-viewport {
    padding: 20px;
    min-height: 100%;
  }

  .page-preview {
    min-height: 100%;
    display: flex;
    flex-direction: column;
  }

  .drop-zone {
    min-height: 150px;
    border: 2px dashed #ddd;
    border-radius: 8px;
    margin: 10px 0;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.3s ease;
    position: relative;
  }

  .drop-zone.drag-over {
    border-color: var(--primary);
    background: rgba(0, 212, 255, 0.1);
  }

  .drop-indicator {
    text-align: center;
    color: #999;
  }

  .drop-indicator i {
    font-size: 2rem;
    margin-bottom: 10px;
    display: block;
  }

  .canvas-controls {
    background: rgba(26, 26, 46, 0.9);
    border-top: 1px solid rgba(0, 212, 255, 0.3);
    padding: 15px 30px;
    display: flex;
    justify-content: space-between;
    align-items: center;
  }

  .zoom-controls {
    display: flex;
    align-items: center;
    gap: 10px;
  }

  .zoom-level {
    color: var(--text-primary);
    font-weight: bold;
  }

  .properties-panel {
    width: 320px;
    background: rgba(26, 26, 46, 0.9);
    border-left: 1px solid rgba(0, 212, 255, 0.3);
    display: flex;
    flex-direction: column;
    backdrop-filter: blur(10px);
  }

  .panel-section {
    padding: 20px;
    border-bottom: 1px solid rgba(0, 212, 255, 0.2);
  }

  .panel-section h4 {
    color: var(--text-primary);
    font-size: 0.9rem;
    margin-bottom: 15px;
  }

  .control-group {
    margin-bottom: 15px;
  }

  .control-group label {
    color: var(--text-secondary);
    font-size: 0.85rem;
    margin-bottom: 5px;
    display: block;
  }

  .color-input-group {
    display: flex;
    gap: 8px;
  }

  .color-picker {
    width: 50px;
    height: 35px;
    border: none;
    border-radius: 6px;
    cursor: pointer;
  }

  .color-text {
    flex: 1;
    font-family: monospace;
    font-size: 0.85rem;
  }

  .asset-upload {
    margin-bottom: 20px;
  }

  .assets-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 10px;
    max-height: 200px;
    overflow-y: auto;
  }

  .layers-panel {
    background: rgba(26, 26, 46, 0.9);
    border-top: 1px solid rgba(0, 212, 255, 0.3);
    height: 150px;
    backdrop-filter: blur(10px);
  }

  .layers-list {
    padding: 15px 20px;
    height: calc(100% - 60px);
    overflow-y: auto;
  }

  .advanced-components {
    display: grid;
    grid-template-columns: 1fr;
    gap: 8px;
  }

  .advanced-components .component-item {
    padding: 10px 15px;
    display: flex;
    align-items: center;
    gap: 10px;
    font-size: 0.85rem;
  }

  /* Responsive Canvas */
  .canvas-frame.tablet-view {
    max-width: 768px;
  }

  .canvas-frame.mobile-view {
    max-width: 375px;
  }

  /* Animation for drag and drop */
  .component-item.dragging {
    opacity: 0.5;
    transform: rotate(5deg);
  }

  .drop-zone.highlight {
    border-color: var(--primary);
    background: rgba(0, 212, 255, 0.1);
  }

  .added-component {
    background: rgba(0, 212, 255, 0.1);
    border: 1px solid var(--primary);
    border-radius: 6px;
    padding: 15px;
    margin: 10px 0;
    position: relative;
    cursor: pointer;
  }

  .added-component:hover {
    border-color: var(--secondary);
  }

  .component-controls {
    position: absolute;
    top: 5px;
    right: 5px;
    display: none;
  }

  .added-component:hover .component-controls {
    display: block;
  }
</style>

<script>
  let currentTheme = {{ theme.to_dict() | tojsonfilter }};
  let draggedComponent = null;
  let zoomLevel = 100;

  // Initialize editor
  document.addEventListener('DOMContentLoaded', function() {
      initializeDragAndDrop();
      initializeColorPickers();
      loadThemeAssets();
      setupViewControls();
  });

  function initializeDragAndDrop() {
      // Make components draggable
      document.querySelectorAll('.component-item').forEach(item => {
          item.addEventListener('dragstart', function(e) {
              draggedComponent = this.dataset.component;
              this.classList.add('dragging');
          });

          item.addEventListener('dragend', function(e) {
              this.classList.remove('dragging');
          });
      });

      // Setup drop zones
      document.querySelectorAll('.drop-zone').forEach(zone => {
          zone.addEventListener('dragover', function(e) {
              e.preventDefault();
              this.classList.add('highlight');
          });

          zone.addEventListener('dragleave', function(e) {
              this.classList.remove('highlight');
          });

          zone.addEventListener('drop', function(e) {
              e.preventDefault();
              this.classList.remove('highlight');

              if (draggedComponent) {
                  addComponentToZone(draggedComponent, this);
                  draggedComponent = null;
              }
          });
      });
  }

  function addComponentToZone(componentType, zone) {
      const componentConfig = getComponentConfig(componentType);

      // Create component element
      const componentElement = document.createElement('div');
      componentElement.className = 'added-component';
      componentElement.innerHTML = `
          <div class="component-content">
              ${componentConfig.html}
          </div>
          <div class="component-controls">
              <button class="btn btn-sm btn-outline-primary" onclick="editComponent(this)">
                  <i class="fas fa-edit"></i>
              </button>
              <button class="btn btn-sm btn-outline-danger" onclick="deleteComponent(this)">
                  <i class="fas fa-trash"></i>
              </button>
          </div>
      `;

      // Replace drop indicator or add to zone
      const dropIndicator = zone.querySelector('.drop-indicator');
      if (dropIndicator) {
          zone.removeChild(dropIndicator);
      }

      zone.appendChild(componentElement);

      // Update layers panel
      updateLayersPanel();
  }

  function getComponentConfig(type) {
      const configs = {
          header: {
              html: '<h1 style="color: var(--primary); margin: 0;">Your Header</h1>',
              name: 'Header'
          },
          navigation: {
              html: '<nav style="background: var(--secondary); padding: 10px; border-radius: 5px;"><a href="#" style="color: white; margin-right: 15px;">Home</a><a href="#" style="color: white; margin-right: 15px;">About</a><a href="#" style="color: white;">Contact</a></nav>',
              name: 'Navigation'
          },
          hero: {
              html: '<div style="background: linear-gradient(135deg, var(--primary), var(--secondary)); padding: 60px 20px; text-align: center; border-radius: 10px; color: white;"><h2>Hero Section</h2><p>Compelling headline goes here</p><button style="background: var(--accent); color: black; border: none; padding: 12px 30px; border-radius: 25px; font-weight: bold;">Call to Action</button></div>',
              name: 'Hero Section'
          },
          text: {
              html: '<div style="padding: 20px;"><p style="color: var(--text-primary);">This is a text block. You can edit this content and style it according to your needs.</p></div>',
              name: 'Text Block'
          },
          image: {
              html: '<div style="text-align: center; padding: 20px;"><img src="https://via.placeholder.com/400x200/00D4FF/FFFFFF?text=Image+Placeholder" style="max-width: 100%; border-radius: 8px;" alt="Placeholder"></div>',
              name: 'Image'
          },
          button: {
              html: '<div style="text-align: center; padding: 20px;"><button style="background: var(--primary); color: white; border: none; padding: 15px 40px; border-radius: 25px; font-size: 16px; cursor: pointer;">Click Me</button></div>',
              name: 'Button'
          }
      };

      return configs[type] || { html: '<div>Component</div>', name: 'Component' };
  }

  function initializeColorPickers() {
      document.querySelectorAll('.color-picker').forEach(picker => {
          picker.addEventListener('change', function() {
              const textInput = this.parentNode.querySelector('.color-text');
              textInput.value = this.value;
              updateThemeColors();
          });
      });

      document.querySelectorAll('.color-text').forEach(textInput => {
          textInput.addEventListener('input', function() {
              const colorPicker = this.parentNode.querySelector('.color-picker');
              if (/^#[0-9A-F]{6}$/i.test(this.value)) {
                  colorPicker.value = this.value;
                  updateThemeColors();
              }
          });
      });
  }

  function updateThemeColors() {
      const primary = document.getElementById('primaryColor').value;
      const secondary = document.getElementById('secondaryColor').value;
      const accent = document.getElementById('accentColor').value;

      // Update CSS variables
      document.documentElement.style.setProperty('--primary', primary);
      document.documentElement.style.setProperty('--secondary', secondary);
      document.documentElement.style.setProperty('--accent', accent);

      // Update theme object
      currentTheme.color_config.primary = primary;
      currentTheme.color_config.secondary = secondary;
      currentTheme.color_config.accent = accent;
  }

  function setupViewControls() {
      document.querySelectorAll('[data-view]').forEach(btn => {
          btn.addEventListener('click', function() {
              const view = this.dataset.view;
              const canvas = document.getElementById('themeCanvas');

              // Remove existing view classes
              canvas.classList.remove('tablet-view', 'mobile-view');

              // Add new view class
              if (view !== 'desktop') {
                  canvas.classList.add(view + '-view');
              }

              // Update active button
              document.querySelector('[data-view].active').classList.remove('active');
              this.classList.add('active');
          });
      });
  }

  function loadThemeAssets() {
      fetch(`/admin/themes/${currentTheme.id}/assets`)
          .then(response => response.json())
          .then(data => {
              const assetsGrid = document.getElementById('assetsGrid');
              assetsGrid.innerHTML = '';

              data.assets.forEach(asset => {
                  const assetElement = document.createElement('div');
                  assetElement.className = 'asset-item';
                  assetElement.innerHTML = `
                      <img src="${asset.url}" alt="${asset.name}" style="width: 100%; height: 60px; object-fit: cover; border-radius: 4px; cursor: pointer;" onclick="useAsset('${asset.url}')">
                  `;
                  assetsGrid.appendChild(assetElement);
              });
          });
  }

  function updateLayersPanel() {
      const layersList = document.getElementById('layersList');
      const components = document.querySelectorAll('.added-component');

      layersList.innerHTML = '';
      components.forEach((component, index) => {
          const layerItem = document.createElement('div');
          layerItem.className = 'layer-item';
          layerItem.innerHTML = `
              <div style="color: var(--text-primary); padding: 8px 0; border-bottom: 1px solid rgba(0, 212, 255, 0.2); cursor: pointer;">
                  <i class="fas fa-eye me-2"></i>
                  Component ${index + 1}
              </div>
          `;
          layersList.appendChild(layerItem);
      });
  }

  function saveTheme() {
      const themeData = {
          color_config: currentTheme.color_config,
          layout_config: {
              container_width: document.getElementById('containerWidth').value + 'px',
              header_height: document.getElementById('headerHeight').value + 'px'
          }
      };

      fetch(`/admin/themes/${currentTheme.id}/update`, {
          method: 'POST',
          headers: {
              'Content-Type': 'application/json',
          },
          body: JSON.stringify(themeData)
      })
      .then(response => response.json())
      .then(data => {
          if (data.success) {
              showNotification('Theme saved successfully!', 'success');
          }
      });
  }

  function previewTheme() {
      window.open(`/admin/themes/preview/${currentTheme.id}`, '_blank');
  }

  function publishTheme() {
      fetch(`/admin/themes/${currentTheme.id}/activate`, {
          method: 'POST'
      })
      .then(response => response.json())
      .then(data => {
          if (data.success) {
              showNotification('Theme published successfully!', 'success');
          }
      });
  }

  function goBack() {
      window.location.href = '/admin/themes';
  }

  function zoomIn() {
      if (zoomLevel < 200) {
          zoomLevel += 10;
          updateZoom();
      }
  }

  function zoomOut() {
      if (zoomLevel > 50) {
          zoomLevel -= 10;
          updateZoom();
      }
  }

  function updateZoom() {
      const canvas = document.getElementById('themeCanvas');
      canvas.style.transform = `scale(${zoomLevel / 100})`;
      document.querySelector('.zoom-level').textContent = zoomLevel + '%';
  }

  function showNotification(message, type) {
      // Simple notification system
      const notification = document.createElement('div');
      notification.className = `alert alert-${type} position-fixed`;
      notification.style.cssText = 'top: 20px; right: 20px; z-index: 9999;';
      notification.textContent = message;

      document.body.appendChild(notification);

      setTimeout(() => {
          notification.remove();
      }, 3000);
  }

  // Asset upload handling
  document.getElementById('assetUpload').addEventListener('change', function(e) {
      const files = Array.from(e.target.files);

      files.forEach(file => {
          const formData = new FormData();
          formData.append('file', file);
          formData.append('asset_type', 'background_image');
          formData.append('name', file.name);

          fetch(`/admin/themes/${currentTheme.id}/upload-asset`, {
              method: 'POST',
              body: formData
          })
          .then(response => response.json())
          .then(data => {
              if (data.success) {
                  loadThemeAssets();
                  showNotification('Asset uploaded successfully!', 'success');
              }
          });
      });
  });
</script>
{% endblock %}
