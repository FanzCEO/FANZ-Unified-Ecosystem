services:
  postgres:
    image: postgres:15
    environment:
      POSTGRES_PASSWORD: fanz
      POSTGRES_DB: fanz_core
    ports: ["5432:5432"]
  zookeeper:
    image: confluentinc/cp-zookeeper:7.6.1
    environment:
      ZOOKEEPER_CLIENT_PORT: 2181
  kafka:
    image: confluentinc/cp-kafka:7.6.1
    environment:
      KAFKA_ZOOKEEPER_CONNECT: zookeeper:2181
      KAFKA_ADVERTISED_LISTENERS: PLAINTEXT://kafka:9092
      KAFKA_OFFSETS_TOPIC_REPLICATION_FACTOR: "1"
    ports: ["9092:9092"]
    depends_on: [zookeeper]
  minio:
    image: minio/minio:RELEASE.2024-10-13T13-34-11Z
    environment:
      MINIO_ROOT_USER: fanz
      MINIO_ROOT_PASSWORD: fanzpassword
    command: server /data --console-address ":9001"
    ports: ["9000:9000", "9001:9001"]
  opensearch:
    image: opensearchproject/opensearch:2.15.0
    environment:
      discovery.type: single-node
      plugins.security.disabled: "true"
      OPENSEARCH_JAVA_OPTS: "-Xms512m -Xmx512m"
    ports: ["9200:9200"]
  api-gateway:
    build: ./services/api-gateway
    environment:
      NEXT_PUBLIC_API_BASE: http://localhost:8080
    depends_on: [identity-auth, media-hub, fanz-finance]
    ports: ["8080:8080"]
  identity-auth:
    build: ./services/identity-auth
    environment:
      OAUTH_ISSUER: http://localhost:8081
      SESSION_SECRET: dev-not-for-prod
    ports: ["8081:8081"]
  media-hub:
    build: ./services/media-hub
    environment:
      VAULT_BUCKET: fanzhub
      MODERATION_MODEL: moderate-v1
    depends_on: [minio, postgres, kafka]
    ports: ["8090:8090"]
  fanz-finance:
    build: ./services/fanz-finance
    environment:
      PROCESSOR_API_KEY: "replace_me"
      WEBHOOK_SECRET: "replace_me"
      TAX_PROVIDER_KEY: "replace_me"
    depends_on: [postgres, kafka]
    ports: ["8070:8070"]
  fanzdash:
    build: ./apps/fanzdash
    ports: ["3001:3000"]
networks:
  default:
    name: fanz-local
