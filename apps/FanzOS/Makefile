# FansLab Platform Makefile
# Simplified build and deployment commands

.PHONY: help install dev build start test clean health setup deploy

# Default target
help:
	@echo "FansLab Platform Build Commands"
	@echo "==============================="
	@echo ""
	@echo "Development:"
	@echo "  make install    - Install all dependencies"
	@echo "  make dev        - Start development server"
	@echo "  make build      - Build for production"
	@echo "  make start      - Start production server"
	@echo ""
	@echo "Database:"
	@echo "  make db-push    - Push schema changes to database"
	@echo "  make db-backup  - Create database backup"
	@echo "  make db-health  - Check database health"
	@echo ""
	@echo "Maintenance:"
	@echo "  make health     - Run comprehensive health check"
	@echo "  make clean      - Clean build artifacts"
	@echo "  make setup      - Initial project setup"
	@echo "  make test       - Run tests (when available)"

# Install dependencies
install:
	@echo "ğŸ“¦ Installing dependencies..."
	npm ci --silent
	@echo "âœ… Dependencies installed"

# Development server
dev:
	@echo "ğŸš€ Starting development server..."
	NODE_ENV=development npm run dev

# Production build
build:
	@echo "ğŸ”¨ Building for production..."
	node scripts/build.js
	@echo "âœ… Build completed"

# Production server
start:
	@echo "ğŸš€ Starting production server..."
	NODE_ENV=production npm start

# Database operations
db-push:
	@echo "ğŸ—ƒï¸ Pushing database schema..."
	npm run db:push

db-backup:
	@echo "ğŸ’¾ Creating database backup..."
	node scripts/database-manager.js backup

db-health:
	@echo "ğŸ¥ Checking database health..."
	node scripts/database-manager.js health

db-optimize:
	@echo "âš¡ Optimizing database..."
	node scripts/database-manager.js optimize

# Health check
health:
	@echo "ğŸ¥ Running health check..."
	node scripts/health-check.js

# Clean build artifacts  
clean:
	@echo "ğŸ§¹ Cleaning build artifacts..."
	rm -rf dist/
	rm -rf node_modules/.cache/
	rm -rf logs/*.log
	@echo "âœ… Cleanup completed"

# Initial setup
setup:
	@echo "âš™ï¸ Running initial setup..."
	node scripts/setup.js

# Test runner (placeholder)
test:
	@echo "ğŸ§ª Running tests..."
	@echo "âš ï¸ Test suite not configured yet"

# Quick development setup
quick-start: install db-push dev

# Production deployment
deploy: clean install build start

# Full maintenance
maintain: db-backup db-optimize health
	@echo "ğŸ‰ Maintenance completed"