{"file_contents":{"drizzle.config.ts":{"content":"import { defineConfig } from \"drizzle-kit\";\n\nif (!process.env.DATABASE_URL) {\n  throw new Error(\"DATABASE_URL, ensure the database is provisioned\");\n}\n\nexport default defineConfig({\n  out: \"./migrations\",\n  schema: \"./shared/schema.ts\",\n  dialect: \"postgresql\",\n  dbCredentials: {\n    url: process.env.DATABASE_URL,\n  },\n});\n","size_bytes":325},"server/services/moderationService.ts":{"content":"import { storage } from \"../storage\";\nimport { logger } from \"../logger\";\n\ninterface ModerationFlag {\n  type: \"nudity\" | \"violence\" | \"copyright\" | \"age_verification\" | \"illegal_content\" \n       | \"hate_speech\" | \"harassment\" | \"fake_identity\" | \"spam\" | \"financial_scam\"\n       | \"deepfake\" | \"revenge_porn\" | \"child_safety\" | \"drugs\" | \"weapons\" \n       | \"terrorism\" | \"self_harm\" | \"excessive_profanity\" | \"doxxing\";\n  confidence: number;\n  details?: string;\n  severity: \"low\" | \"medium\" | \"high\" | \"critical\";\n}\n\ninterface ModerationResult {\n  action: \"approve\" | \"reject\" | \"review\";\n  flags: ModerationFlag[];\n  autoProcessed: boolean;\n  confidence: number;\n}\n\nclass ModerationService {\n  private rules = {\n    // Auto-approve if confidence is very high and no major flags\n    autoApproveThreshold: 0.95,\n    // Auto-reject if flagged with high confidence\n    autoRejectThreshold: 0.85,\n    // Requires human review if between thresholds\n    reviewThreshold: 0.50,\n    \n    // Critical flags that require immediate rejection\n    criticalFlags: [\"child_safety\", \"terrorism\", \"revenge_porn\", \"illegal_content\"],\n    \n    // High severity flags that lower auto-approve threshold\n    highSeverityFlags: [\"deepfake\", \"harassment\", \"hate_speech\", \"doxxing\"],\n    \n    // Content filtering rules\n    ageVerificationRequired: true,\n    allowNudity: true,\n    allowExplicitContent: true,\n    requireWatermarking: true,\n    maxFileSize: 100 * 1024 * 1024, // 100MB\n    allowedMimeTypes: [\n      'image/jpeg', 'image/png', 'image/gif', 'image/webp',\n      'video/mp4', 'video/quicktime', 'video/avi', 'video/webm'\n    ],\n    \n    // Spam detection\n    maxUploadsPerHour: 50,\n    minTimeBetweenUploads: 30, // seconds\n    \n    // Content quality requirements\n    minImageResolution: { width: 480, height: 320 },\n    minVideoResolution: { width: 720, height: 480 },\n    maxVideoLength: 30 * 60, // 30 minutes\n  };\n\n  async moderateContent(mediaId: string, metadata: {\n    mimeType: string;\n    fileSize: number;\n    ownerId: string;\n    title?: string;\n    description?: string;\n  }): Promise<ModerationResult> {\n    try {\n      logger.info({ mediaId, metadata }, \"Starting content moderation\");\n\n      // Get media asset\n      const media = await storage.getMediaAsset(mediaId);\n      if (!media) {\n        throw new Error(\"Media asset not found\");\n      }\n\n      // Run automated checks\n      const flags = await this.runAutomatedChecks(media, metadata);\n      \n      // Calculate overall confidence\n      const confidence = this.calculateConfidence(flags);\n      \n      // Determine action based on flags and confidence\n      const action = this.determineAction(flags, confidence);\n\n      const result: ModerationResult = {\n        action,\n        flags,\n        autoProcessed: action !== \"review\",\n        confidence,\n      };\n\n      // Update media status based on action\n      if (action === \"approve\") {\n        await storage.updateMediaAsset(mediaId, { status: \"approved\" });\n      } else if (action === \"reject\") {\n        await storage.updateMediaAsset(mediaId, { status: \"rejected\" });\n      }\n\n      // Add to moderation queue if human review needed\n      if (action === \"review\") {\n        await this.addToModerationQueue(mediaId, flags);\n      }\n\n      logger.info({\n        mediaId,\n        action,\n        confidence,\n        flagCount: flags.length,\n        autoProcessed: result.autoProcessed,\n      }, \"Content moderation completed\");\n\n      return result;\n    } catch (error) {\n      logger.error({ error, mediaId }, \"Content moderation failed\");\n      \n      // Default to requiring human review on error\n      await this.addToModerationQueue(mediaId, [{\n        type: \"illegal_content\",\n        confidence: 1.0,\n        details: \"Moderation system error - requires human review\",\n        severity: \"high\"\n      }]);\n\n      return {\n        action: \"review\",\n        flags: [],\n        autoProcessed: false,\n        confidence: 0,\n      };\n    }\n  }\n\n  private async runAutomatedChecks(media: any, metadata: any): Promise<ModerationFlag[]> {\n    const flags: ModerationFlag[] = [];\n    \n    try {\n      // Basic content type validation\n      if (!this.isAllowedMimeType(metadata.mimeType)) {\n        flags.push({\n          type: \"illegal_content\",\n          confidence: 1.0,\n          details: `Unsupported file type: ${metadata.mimeType}`,\n          severity: \"high\"\n        });\n      }\n\n      // File size validation  \n      if (metadata.fileSize > this.rules.maxFileSize) {\n        flags.push({\n          type: \"spam\",\n          confidence: 0.8,\n          details: `File size exceeds limit: ${Math.round(metadata.fileSize / 1024 / 1024)}MB`,\n          severity: \"medium\"\n        });\n      }\n\n      // Age verification check\n      const profile = await storage.getProfile(metadata.ownerId);\n      if (this.rules.ageVerificationRequired && !profile?.ageVerified) {\n        flags.push({\n          type: \"age_verification\",\n          confidence: 1.0,\n          details: \"User age not verified\",\n          severity: \"critical\"\n        });\n      }\n\n      // Rate limiting check\n      const rateLimitFlags = await this.checkRateLimits(metadata.ownerId);\n      flags.push(...rateLimitFlags);\n\n      // Content quality checks\n      const qualityFlags = await this.checkContentQuality(metadata);\n      flags.push(...qualityFlags);\n\n      // Text analysis for titles and descriptions\n      const textFlags = await this.analyzeTextContent(metadata.title, metadata.description);\n      flags.push(...textFlags);\n\n      // Simulated AI content analysis (placeholder for actual AI integration)\n      const aiAnalysis = await this.simulateAIAnalysis(metadata);\n      flags.push(...aiAnalysis);\n      \n    } catch (error) {\n      logger.error({ error }, \"Error during automated checks\");\n      flags.push({\n        type: \"illegal_content\",\n        confidence: 0.5,\n        details: \"Analysis failed - requires human review\",\n        severity: \"medium\"\n      });\n    }\n\n    return flags;\n  }\n\n  private isAllowedMimeType(mimeType: string): boolean {\n    return this.rules.allowedMimeTypes.includes(mimeType);\n  }\n\n  private async checkRateLimits(ownerId: string): Promise<ModerationFlag[]> {\n    const flags: ModerationFlag[] = [];\n    \n    try {\n      // Check uploads in the last hour (placeholder - would need actual implementation)\n      // const recentUploads = await storage.getUserRecentUploads(ownerId, 60);\n      \n      // For now, simulate rate limit check\n      const simulatedRecentUploads = Math.floor(Math.random() * 60);\n      if (simulatedRecentUploads > this.rules.maxUploadsPerHour) {\n        flags.push({\n          type: \"spam\",\n          confidence: 0.9,\n          details: `Exceeded upload limit: ${simulatedRecentUploads}/${this.rules.maxUploadsPerHour} per hour`,\n          severity: \"high\"\n        });\n      }\n    } catch (error) {\n      logger.warn({ error, ownerId }, \"Could not check rate limits\");\n    }\n\n    return flags;\n  }\n\n  private async checkContentQuality(metadata: any): Promise<ModerationFlag[]> {\n    const flags: ModerationFlag[] = [];\n    \n    // For now, basic validation - in production would analyze actual media\n    if (metadata.mimeType.startsWith('image/')) {\n      // Placeholder for image resolution check\n      // Would need actual image analysis here\n    }\n    \n    if (metadata.mimeType.startsWith('video/')) {\n      // Placeholder for video quality/length check\n      // Would need actual video analysis here\n    }\n    \n    return flags;\n  }\n\n  private async analyzeTextContent(title?: string, description?: string): Promise<ModerationFlag[]> {\n    const flags: ModerationFlag[] = [];\n    const content = `${title || ''} ${description || ''}`.toLowerCase();\n    \n    if (!content.trim()) return flags;\n    \n    // Basic keyword filtering\n    const profanityKeywords = ['fuck', 'shit', 'damn', 'bitch', 'asshole', 'cunt'];\n    const hateSpeechKeywords = ['nazi', 'hitler', 'kill yourself', 'die', 'terrorist'];\n    const spamKeywords = ['buy now', 'click here', 'free money', 'get rich quick'];\n    const harassmentKeywords = ['stalker', 'creep', 'pervert', 'psycho'];\n    const childSafetyKeywords = ['underage', 'minor', 'child', 'teen', 'young', 'school'];\n    const drugsKeywords = ['cocaine', 'heroin', 'meth', 'ecstasy', 'buy drugs'];\n    const weaponsKeywords = ['gun for sale', 'buy weapons', 'assault rifle', 'explosives'];\n    \n    let profanityCount = 0;\n    profanityKeywords.forEach(keyword => {\n      if (content.includes(keyword)) {\n        profanityCount++;\n      }\n    });\n    \n    if (profanityCount > 3) {\n      flags.push({\n        type: \"excessive_profanity\",\n        confidence: 0.8,\n        details: `Excessive profanity detected: ${profanityCount} instances`,\n        severity: \"medium\"\n      });\n    }\n    \n    hateSpeechKeywords.forEach(keyword => {\n      if (content.includes(keyword)) {\n        flags.push({\n          type: \"hate_speech\",\n          confidence: 0.9,\n          details: `Hate speech keyword detected: ${keyword}`,\n          severity: \"high\"\n        });\n      }\n    });\n    \n    spamKeywords.forEach(keyword => {\n      if (content.includes(keyword)) {\n        flags.push({\n          type: \"spam\",\n          confidence: 0.7,\n          details: `Spam keyword detected: ${keyword}`,\n          severity: \"medium\"\n        });\n      }\n    });\n    \n    harassmentKeywords.forEach(keyword => {\n      if (content.includes(keyword)) {\n        flags.push({\n          type: \"harassment\",\n          confidence: 0.8,\n          details: `Harassment keyword detected: ${keyword}`,\n          severity: \"high\"\n        });\n      }\n    });\n\n    childSafetyKeywords.forEach(keyword => {\n      if (content.includes(keyword)) {\n        flags.push({\n          type: \"child_safety\",\n          confidence: 0.95,\n          details: `Child safety concern detected: ${keyword}`,\n          severity: \"critical\"\n        });\n      }\n    });\n\n    drugsKeywords.forEach(keyword => {\n      if (content.includes(keyword)) {\n        flags.push({\n          type: \"drugs\",\n          confidence: 0.9,\n          details: `Drug-related content detected: ${keyword}`,\n          severity: \"high\"\n        });\n      }\n    });\n\n    weaponsKeywords.forEach(keyword => {\n      if (content.includes(keyword)) {\n        flags.push({\n          type: \"weapons\",\n          confidence: 0.95,\n          details: `Weapon-related content detected: ${keyword}`,\n          severity: \"critical\"\n        });\n      }\n    });\n    \n    // Check for personal information (basic regex patterns)\n    const phonePattern = /\\b\\d{3}[-.]?\\d{3}[-.]?\\d{4}\\b/;\n    const emailPattern = /\\b[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\\.[A-Z|a-z]{2,}\\b/;\n    const ssnPattern = /\\b\\d{3}-\\d{2}-\\d{4}\\b/;\n    \n    if (phonePattern.test(content) || emailPattern.test(content) || ssnPattern.test(content)) {\n      flags.push({\n        type: \"doxxing\",\n        confidence: 0.9,\n        details: \"Personal information detected in content\",\n        severity: \"high\"\n      });\n    }\n    \n    return flags;\n  }\n\n  private async simulateAIAnalysis(metadata: any): Promise<ModerationFlag[]> {\n    const flags: ModerationFlag[] = [];\n    \n    // Check if OpenAI is configured\n    if (!process.env.OPENAI_API_KEY) {\n      logger.debug(\"OpenAI not configured, skipping AI content analysis\");\n      return flags;\n    }\n\n    try {\n      // the newest OpenAI model is \"gpt-5\" which was released August 7, 2025. do not change this unless explicitly requested by the user\n      const OpenAI = (await import(\"openai\")).default;\n      const openai = new OpenAI({ apiKey: process.env.OPENAI_API_KEY });\n\n      // Analyze text content if available\n      if (metadata.title || metadata.description) {\n        const textToAnalyze = `${metadata.title || ''} ${metadata.description || ''}`;\n        \n        const response = await openai.chat.completions.create({\n          model: \"gpt-5\",\n          messages: [\n            {\n              role: \"system\",\n              content: \"You are a content moderation AI for an adult content platform. Analyze text for policy violations including: child safety concerns, violence, weapons, drugs, terrorism, self-harm, harassment, hate speech, and illegal activities. Respond with JSON containing detected issues.\"\n            },\n            {\n              role: \"user\",\n              content: `Analyze this content for moderation: \"${textToAnalyze}\"\\n\\nProvide a JSON response with: {violations: [{type: string, confidence: number (0-1), details: string, severity: \"low\"|\"medium\"|\"high\"|\"critical\"}]}`\n            }\n          ],\n          response_format: { type: \"json_object\" }\n        });\n\n        const analysis = JSON.parse(response.choices[0].message.content || \"{}\");\n        \n        if (analysis.violations && Array.isArray(analysis.violations)) {\n          for (const violation of analysis.violations) {\n            flags.push({\n              type: this.mapViolationType(violation.type),\n              confidence: violation.confidence,\n              details: violation.details || `AI detected ${violation.type}`,\n              severity: violation.severity\n            });\n          }\n        }\n      }\n\n      // For media analysis, we would need the actual media content\n      // This would involve downloading from S3 and analyzing the image/video\n      // For now, log that media analysis would happen here\n      if (metadata.mimeType?.startsWith('image/') || metadata.mimeType?.startsWith('video/')) {\n        logger.debug(\"Media content detected - would perform visual AI analysis in production\");\n      }\n\n    } catch (error) {\n      logger.error({ error }, \"AI content analysis failed\");\n      // Don't add flags on error - let human review handle it\n    }\n    \n    return flags;\n  }\n\n  private mapViolationType(aiType: string): ModerationFlag[\"type\"] {\n    const mapping: Record<string, ModerationFlag[\"type\"]> = {\n      \"child_safety\": \"child_safety\",\n      \"violence\": \"violence\",\n      \"weapons\": \"weapons\",\n      \"drugs\": \"drugs\",\n      \"terrorism\": \"terrorism\",\n      \"self_harm\": \"self_harm\",\n      \"harassment\": \"harassment\",\n      \"hate_speech\": \"hate_speech\",\n      \"illegal\": \"illegal_content\",\n      \"spam\": \"spam\",\n      \"copyright\": \"copyright\",\n      \"deepfake\": \"deepfake\",\n      \"revenge_porn\": \"revenge_porn\",\n      \"nudity\": \"nudity\",\n      \"age_verification\": \"age_verification\",\n      \"fake_identity\": \"fake_identity\",\n      \"financial_scam\": \"financial_scam\",\n      \"doxxing\": \"doxxing\",\n      \"profanity\": \"excessive_profanity\"\n    };\n    return mapping[aiType.toLowerCase()] || \"illegal_content\";\n  }\n\n  private calculateConfidence(flags: ModerationFlag[]): number {\n    if (flags.length === 0) return 1.0;\n\n    // Calculate weighted confidence based on severity and individual confidence\n    let totalWeight = 0;\n    let weightedSum = 0;\n\n    flags.forEach(flag => {\n      let weight = 1;\n      switch (flag.severity) {\n        case \"critical\": weight = 4; break;\n        case \"high\": weight = 3; break;\n        case \"medium\": weight = 2; break;\n        case \"low\": weight = 1; break;\n      }\n      \n      totalWeight += weight;\n      weightedSum += flag.confidence * weight;\n    });\n\n    return weightedSum / totalWeight;\n  }\n\n  private determineAction(flags: ModerationFlag[], confidence: number): \"approve\" | \"reject\" | \"review\" {\n    // Check for critical flags that require immediate rejection\n    const hasCriticalFlag = flags.some(flag => \n      this.rules.criticalFlags.includes(flag.type as any) && flag.confidence > 0.7\n    );\n    \n    if (hasCriticalFlag) {\n      return \"reject\";\n    }\n    \n    // Check for critical severity flags\n    const hasCriticalSeverity = flags.some(flag => \n      flag.severity === \"critical\" && flag.confidence > 0.8\n    );\n    \n    if (hasCriticalSeverity) {\n      return \"reject\";\n    }\n    \n    // High severity flags lower the auto-approve threshold\n    const hasHighSeverityFlag = flags.some(flag => \n      flag.severity === \"high\" && flag.confidence > 0.6\n    );\n    \n    const adjustedApproveThreshold = hasHighSeverityFlag \n      ? this.rules.autoApproveThreshold + 0.03 // Make it harder to auto-approve\n      : this.rules.autoApproveThreshold;\n    \n    // Check confidence thresholds\n    if (flags.length === 0 && confidence >= adjustedApproveThreshold) {\n      return \"approve\";\n    }\n    \n    // Auto-reject if high confidence negative flags\n    const highConfidenceFlags = flags.filter(flag => flag.confidence > this.rules.autoRejectThreshold);\n    if (highConfidenceFlags.length > 0) {\n      return \"reject\";\n    }\n    \n    // Auto-reject if multiple medium confidence flags\n    const mediumConfidenceFlags = flags.filter(flag => \n      flag.confidence > 0.6 && flag.severity !== \"low\"\n    );\n    if (mediumConfidenceFlags.length >= 3) {\n      return \"reject\";\n    }\n    \n    return \"review\";\n  }\n\n  private async addToModerationQueue(mediaId: string, flags: ModerationFlag[]): Promise<void> {\n    // Calculate priority based on flags and severity\n    let priority = 0;\n    for (const flag of flags) {\n      // Base priority by flag type\n      if (flag.type === \"child_safety\") priority += 20;\n      if (flag.type === \"terrorism\") priority += 18;\n      if (flag.type === \"illegal_content\") priority += 15;\n      if (flag.type === \"revenge_porn\") priority += 12;\n      if (flag.type === \"age_verification\") priority += 10;\n      if (flag.type === \"copyright\") priority += 8;\n      \n      // Adjust by severity\n      switch (flag.severity) {\n        case \"critical\": priority += 10; break;\n        case \"high\": priority += 6; break;\n        case \"medium\": priority += 3; break;\n        case \"low\": priority += 1; break;\n      }\n      \n      priority += Math.floor(flag.confidence * 5);\n    }\n\n    // Add to moderation queue\n    logger.info({\n      mediaId,\n      priority,\n      flagCount: flags.length,\n      severityBreakdown: flags.reduce((acc, flag) => {\n        acc[flag.severity] = (acc[flag.severity] || 0) + 1;\n        return acc;\n      }, {} as Record<string, number>)\n    }, \"Adding to moderation queue\");\n  }\n\n  async processHumanReview(moderationId: string, decision: \"approve\" | \"reject\", reviewerId: string, notes?: string): Promise<void> {\n    try {\n      // Update moderation item\n      await storage.updateModerationItem(moderationId, {\n        status: decision === \"approve\" ? \"approved\" : \"rejected\",\n        reviewerId,\n        notes,\n      });\n\n      // Get the moderation item to find the media\n      const moderationItems = await storage.getModerationQueue();\n      const item = moderationItems.find(i => i.id === moderationId);\n      \n      if (item) {\n        // Update media status\n        await storage.updateMediaAsset(item.mediaId, {\n          status: decision === \"approve\" ? \"approved\" : \"rejected\",\n        });\n\n        logger.info({\n          moderationId,\n          mediaId: item.mediaId,\n          decision,\n          reviewerId,\n        }, \"Human moderation review completed\");\n      }\n    } catch (error) {\n      logger.error({ error, moderationId, decision }, \"Failed to process human review\");\n      throw error;\n    }\n  }\n\n  async getModerationStats(): Promise<{\n    totalQueued: number;\n    pendingReview: number;\n    autoApproved: number;\n    autoRejected: number;\n    humanReviewed: number;\n    flagBreakdown: Record<string, number>;\n    severityBreakdown: Record<string, number>;\n  }> {\n    const queue = await storage.getModerationQueue();\n    \n    // Calculate flag and severity breakdowns (would need to parse autoFlags from database)\n    const flagBreakdown: Record<string, number> = {};\n    const severityBreakdown: Record<string, number> = {};\n    \n    queue.forEach(item => {\n      if (item.autoFlags && Array.isArray(item.autoFlags)) {\n        item.autoFlags.forEach((flag: any) => {\n          if (flag.type) {\n            flagBreakdown[flag.type] = (flagBreakdown[flag.type] || 0) + 1;\n          }\n          if (flag.severity) {\n            severityBreakdown[flag.severity] = (severityBreakdown[flag.severity] || 0) + 1;\n          }\n        });\n      }\n    });\n    \n    return {\n      totalQueued: queue.length,\n      pendingReview: queue.filter(item => item.status === \"pending\").length,\n      autoApproved: 0, // Would need to track this in media_assets\n      autoRejected: 0, // Would need to track this in media_assets  \n      humanReviewed: queue.filter(item => item.reviewerId).length,\n      flagBreakdown,\n      severityBreakdown,\n    };\n  }\n\n  // New method to update moderation rules dynamically\n  updateModerationRules(newRules: Partial<typeof this.rules>): void {\n    this.rules = { ...this.rules, ...newRules };\n    logger.info({ updatedRules: newRules }, \"Moderation rules updated\");\n  }\n\n  // Get current moderation configuration\n  getModerationConfig(): typeof this.rules {\n    return { ...this.rules };\n  }\n}\n\nexport const moderationService = new ModerationService();","size_bytes":20848},"client/src/lib/logger.ts":{"content":"interface LogContext {\n  component?: string;\n  action?: string;\n  userId?: string;\n  error?: any;\n  metadata?: Record<string, any>;\n}\n\nclass ClientLogger {\n  private isDevelopment = import.meta.env.DEV;\n\n  info(message: string, context?: LogContext) {\n    if (this.isDevelopment) {\n      console.log(`[INFO] ${message}`, context);\n    }\n  }\n\n  warn(message: string, context?: LogContext) {\n    console.warn(`[WARN] ${message}`, context);\n  }\n\n  error(message: string, context?: LogContext) {\n    console.error(`[ERROR] ${message}`, context);\n  }\n\n  debug(message: string, context?: LogContext) {\n    if (this.isDevelopment) {\n      console.debug(`[DEBUG] ${message}`, context);\n    }\n  }\n}\n\nexport const logger = new ClientLogger();\n","size_bytes":733},"client/src/components/ui/carousel.tsx":{"content":"import * as React from \"react\"\nimport useEmblaCarousel, {\n  type UseEmblaCarouselType,\n} from \"embla-carousel-react\"\nimport { ArrowLeft, ArrowRight } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Button } from \"@/components/ui/button\"\n\ntype CarouselApi = UseEmblaCarouselType[1]\ntype UseCarouselParameters = Parameters<typeof useEmblaCarousel>\ntype CarouselOptions = UseCarouselParameters[0]\ntype CarouselPlugin = UseCarouselParameters[1]\n\ntype CarouselProps = {\n  opts?: CarouselOptions\n  plugins?: CarouselPlugin\n  orientation?: \"horizontal\" | \"vertical\"\n  setApi?: (api: CarouselApi) => void\n}\n\ntype CarouselContextProps = {\n  carouselRef: ReturnType<typeof useEmblaCarousel>[0]\n  api: ReturnType<typeof useEmblaCarousel>[1]\n  scrollPrev: () => void\n  scrollNext: () => void\n  canScrollPrev: boolean\n  canScrollNext: boolean\n} & CarouselProps\n\nconst CarouselContext = React.createContext<CarouselContextProps | null>(null)\n\nfunction useCarousel() {\n  const context = React.useContext(CarouselContext)\n\n  if (!context) {\n    throw new Error(\"useCarousel must be used within a <Carousel />\")\n  }\n\n  return context\n}\n\nconst Carousel = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement> & CarouselProps\n>(\n  (\n    {\n      orientation = \"horizontal\",\n      opts,\n      setApi,\n      plugins,\n      className,\n      children,\n      ...props\n    },\n    ref\n  ) => {\n    const [carouselRef, api] = useEmblaCarousel(\n      {\n        ...opts,\n        axis: orientation === \"horizontal\" ? \"x\" : \"y\",\n      },\n      plugins\n    )\n    const [canScrollPrev, setCanScrollPrev] = React.useState(false)\n    const [canScrollNext, setCanScrollNext] = React.useState(false)\n\n    const onSelect = React.useCallback((api: CarouselApi) => {\n      if (!api) {\n        return\n      }\n\n      setCanScrollPrev(api.canScrollPrev())\n      setCanScrollNext(api.canScrollNext())\n    }, [])\n\n    const scrollPrev = React.useCallback(() => {\n      api?.scrollPrev()\n    }, [api])\n\n    const scrollNext = React.useCallback(() => {\n      api?.scrollNext()\n    }, [api])\n\n    const handleKeyDown = React.useCallback(\n      (event: React.KeyboardEvent<HTMLDivElement>) => {\n        if (event.key === \"ArrowLeft\") {\n          event.preventDefault()\n          scrollPrev()\n        } else if (event.key === \"ArrowRight\") {\n          event.preventDefault()\n          scrollNext()\n        }\n      },\n      [scrollPrev, scrollNext]\n    )\n\n    React.useEffect(() => {\n      if (!api || !setApi) {\n        return\n      }\n\n      setApi(api)\n    }, [api, setApi])\n\n    React.useEffect(() => {\n      if (!api) {\n        return\n      }\n\n      onSelect(api)\n      api.on(\"reInit\", onSelect)\n      api.on(\"select\", onSelect)\n\n      return () => {\n        api?.off(\"select\", onSelect)\n      }\n    }, [api, onSelect])\n\n    return (\n      <CarouselContext.Provider\n        value={{\n          carouselRef,\n          api: api,\n          opts,\n          orientation:\n            orientation || (opts?.axis === \"y\" ? \"vertical\" : \"horizontal\"),\n          scrollPrev,\n          scrollNext,\n          canScrollPrev,\n          canScrollNext,\n        }}\n      >\n        <div\n          ref={ref}\n          onKeyDownCapture={handleKeyDown}\n          className={cn(\"relative\", className)}\n          role=\"region\"\n          aria-roledescription=\"carousel\"\n          {...props}\n        >\n          {children}\n        </div>\n      </CarouselContext.Provider>\n    )\n  }\n)\nCarousel.displayName = \"Carousel\"\n\nconst CarouselContent = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const { carouselRef, orientation } = useCarousel()\n\n  return (\n    <div ref={carouselRef} className=\"overflow-hidden\">\n      <div\n        ref={ref}\n        className={cn(\n          \"flex\",\n          orientation === \"horizontal\" ? \"-ml-4\" : \"-mt-4 flex-col\",\n          className\n        )}\n        {...props}\n      />\n    </div>\n  )\n})\nCarouselContent.displayName = \"CarouselContent\"\n\nconst CarouselItem = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const { orientation } = useCarousel()\n\n  return (\n    <div\n      ref={ref}\n      role=\"group\"\n      aria-roledescription=\"slide\"\n      className={cn(\n        \"min-w-0 shrink-0 grow-0 basis-full\",\n        orientation === \"horizontal\" ? \"pl-4\" : \"pt-4\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nCarouselItem.displayName = \"CarouselItem\"\n\nconst CarouselPrevious = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<typeof Button>\n>(({ className, variant = \"outline\", size = \"icon\", ...props }, ref) => {\n  const { orientation, scrollPrev, canScrollPrev } = useCarousel()\n\n  return (\n    <Button\n      ref={ref}\n      variant={variant}\n      size={size}\n      className={cn(\n        \"absolute  h-8 w-8 rounded-full\",\n        orientation === \"horizontal\"\n          ? \"-left-12 top-1/2 -translate-y-1/2\"\n          : \"-top-12 left-1/2 -translate-x-1/2 rotate-90\",\n        className\n      )}\n      disabled={!canScrollPrev}\n      onClick={scrollPrev}\n      {...props}\n    >\n      <ArrowLeft className=\"h-4 w-4\" />\n      <span className=\"sr-only\">Previous slide</span>\n    </Button>\n  )\n})\nCarouselPrevious.displayName = \"CarouselPrevious\"\n\nconst CarouselNext = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<typeof Button>\n>(({ className, variant = \"outline\", size = \"icon\", ...props }, ref) => {\n  const { orientation, scrollNext, canScrollNext } = useCarousel()\n\n  return (\n    <Button\n      ref={ref}\n      variant={variant}\n      size={size}\n      className={cn(\n        \"absolute h-8 w-8 rounded-full\",\n        orientation === \"horizontal\"\n          ? \"-right-12 top-1/2 -translate-y-1/2\"\n          : \"-bottom-12 left-1/2 -translate-x-1/2 rotate-90\",\n        className\n      )}\n      disabled={!canScrollNext}\n      onClick={scrollNext}\n      {...props}\n    >\n      <ArrowRight className=\"h-4 w-4\" />\n      <span className=\"sr-only\">Next slide</span>\n    </Button>\n  )\n})\nCarouselNext.displayName = \"CarouselNext\"\n\nexport {\n  type CarouselApi,\n  Carousel,\n  CarouselContent,\n  CarouselItem,\n  CarouselPrevious,\n  CarouselNext,\n}\n","size_bytes":6210},"client/src/components/ui/toggle.tsx":{"content":"import * as React from \"react\"\nimport * as TogglePrimitive from \"@radix-ui/react-toggle\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst toggleVariants = cva(\n  \"inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors hover:bg-muted hover:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=on]:bg-accent data-[state=on]:text-accent-foreground [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0 gap-2\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-transparent\",\n        outline:\n          \"border border-input bg-transparent hover:bg-accent hover:text-accent-foreground\",\n      },\n      size: {\n        default: \"h-10 px-3 min-w-10\",\n        sm: \"h-9 px-2.5 min-w-9\",\n        lg: \"h-11 px-5 min-w-11\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n)\n\nconst Toggle = React.forwardRef<\n  React.ElementRef<typeof TogglePrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof TogglePrimitive.Root> &\n    VariantProps<typeof toggleVariants>\n>(({ className, variant, size, ...props }, ref) => (\n  <TogglePrimitive.Root\n    ref={ref}\n    className={cn(toggleVariants({ variant, size, className }))}\n    {...props}\n  />\n))\n\nToggle.displayName = TogglePrimitive.Root.displayName\n\nexport { Toggle, toggleVariants }\n","size_bytes":1527},"client/src/pages/Verification.tsx":{"content":"import { useState } from \"react\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Upload, Shield, Check, AlertCircle, FileText, Camera } from \"lucide-react\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { Badge } from \"@/components/ui/badge\";\n\nexport default function Verification() {\n  const { toast } = useToast();\n  const [step, setStep] = useState<'overview' | 'age' | 'kyc' | 'complete'>('overview');\n  const [formData, setFormData] = useState({\n    documentType: '',\n    firstName: '',\n    lastName: '',\n    dateOfBirth: '',\n    address: '',\n    city: '',\n    state: '',\n    zipCode: '',\n    country: '',\n    businessType: '',\n    businessName: '',\n    taxId: ''\n  });\n\n  const handleFileUpload = (event: React.ChangeEvent<HTMLInputElement>, type: string) => {\n    const file = event.target.files?.[0];\n    if (file) {\n      toast({\n        title: \"File Uploaded\",\n        description: `${type} document uploaded successfully.`,\n      });\n    }\n  };\n\n  const handleSubmit = () => {\n    toast({\n      title: \"Verification Submitted\",\n      description: \"Your verification documents have been submitted for review. You'll be notified within 24-48 hours.\",\n    });\n    setStep('complete');\n  };\n\n  return (\n    <div className=\"min-h-screen bg-background text-foreground p-4\">\n      <div className=\"max-w-4xl mx-auto\">\n        {/* Header */}\n        <div className=\"text-center mb-8\">\n          <h1 className=\"neon-heading text-4xl font-bold mb-4\" data-testid=\"heading-verification\">\n            Creator Verification\n          </h1>\n          <p className=\"text-df-fog text-lg max-w-2xl mx-auto\">\n            Complete your age and identity verification to unlock creator features and ensure compliance with adult content regulations.\n          </p>\n        </div>\n\n        {/* Progress Steps */}\n        <div className=\"flex justify-center mb-8\">\n          <div className=\"flex items-center space-x-4\">\n            {[\n              { key: 'overview', label: 'Overview', icon: FileText },\n              { key: 'age', label: 'Age Verification', icon: Shield },\n              { key: 'kyc', label: 'Identity Verification', icon: Camera },\n              { key: 'complete', label: 'Complete', icon: Check }\n            ].map((stepItem, index) => {\n              const Icon = stepItem.icon;\n              const isActive = step === stepItem.key;\n              const isCompleted = ['overview', 'age'].includes(stepItem.key) && step === 'complete';\n              \n              return (\n                <div key={stepItem.key} className=\"flex items-center\">\n                  <div className={`flex items-center justify-center w-10 h-10 rounded-full border-2 ${\n                    isActive \n                      ? 'border-df-cyan bg-df-cyan text-df-ink' \n                      : isCompleted \n                        ? 'border-green-500 bg-green-500 text-df-ink'\n                        : 'border-df-steel text-df-fog'\n                  }`}>\n                    <Icon className=\"h-4 w-4\" />\n                  </div>\n                  {index < 3 && (\n                    <div className={`w-8 h-0.5 mx-2 ${\n                      isCompleted ? 'bg-green-500' : 'bg-df-steel'\n                    }`} />\n                  )}\n                </div>\n              );\n            })}\n          </div>\n        </div>\n\n        {/* Overview Step */}\n        {step === 'overview' && (\n          <div className=\"space-y-6\">\n            <Card className=\"card-df\">\n              <CardHeader>\n                <CardTitle className=\"text-xl neon-subheading\">\n                  <Shield className=\"inline h-6 w-6 mr-2\" />\n                  Verification Requirements\n                </CardTitle>\n              </CardHeader>\n              <CardContent className=\"space-y-6\">\n                <div className=\"grid md:grid-cols-2 gap-6\">\n                  {/* Age Verification */}\n                  <div className=\"bg-df-ink border border-df-steel rounded-md p-4\">\n                    <h3 className=\"text-df-cyan font-semibold mb-3\">Age Verification (18+)</h3>\n                    <div className=\"text-df-fog text-sm space-y-2\">\n                      <p>• Government-issued photo ID</p>\n                      <p>• Must show date of birth clearly</p>\n                      <p>• Accepted: Driver's License, Passport, State ID</p>\n                      <p>• Required for all content creators</p>\n                    </div>\n                    <Badge variant=\"outline\" className=\"mt-3 border-df-gold text-df-gold\">\n                      Required\n                    </Badge>\n                  </div>\n\n                  {/* KYC Verification */}\n                  <div className=\"bg-df-ink border border-df-steel rounded-md p-4\">\n                    <h3 className=\"text-df-cyan font-semibold mb-3\">Identity Verification (KYC)</h3>\n                    <div className=\"text-df-fog text-sm space-y-2\">\n                      <p>• Full legal name and address</p>\n                      <p>• Business information (if applicable)</p>\n                      <p>• Tax identification number</p>\n                      <p>• Required for payments and withdrawals</p>\n                    </div>\n                    <Badge variant=\"outline\" className=\"border-df-gold text-df-gold\">\n                      Required\n                    </Badge>\n                  </div>\n                </div>\n\n                <div className=\"bg-df-brick border border-df-steel rounded-md p-4\">\n                  <div className=\"flex items-start gap-3\">\n                    <AlertCircle className=\"h-5 w-5 text-df-gold mt-0.5 flex-shrink-0\" />\n                    <div className=\"text-df-fog text-sm\">\n                      <p className=\"font-medium text-df-snow mb-2\">Important Information:</p>\n                      <ul className=\"space-y-1\">\n                        <li>• All information is encrypted and stored securely</li>\n                        <li>• Verification typically takes 24-48 hours</li>\n                        <li>• You'll be notified via email once approved</li>\n                        <li>• Required by law for adult content platforms</li>\n                      </ul>\n                    </div>\n                  </div>\n                </div>\n\n                <div className=\"flex justify-between\">\n                  <Button variant=\"outline\" onClick={() => window.history.back()}>\n                    Back to Settings\n                  </Button>\n                  <Button \n                    className=\"btn-primary\" \n                    onClick={() => setStep('age')}\n                    data-testid=\"button-start-verification\"\n                  >\n                    Start Verification\n                  </Button>\n                </div>\n              </CardContent>\n            </Card>\n          </div>\n        )}\n\n        {/* Age Verification Step */}\n        {step === 'age' && (\n          <Card className=\"card-df\">\n            <CardHeader>\n              <CardTitle className=\"text-xl neon-subheading\">\n                Age Verification (18+)\n              </CardTitle>\n            </CardHeader>\n            <CardContent className=\"space-y-6\">\n              <div className=\"grid md:grid-cols-2 gap-6\">\n                <div>\n                  <Label htmlFor=\"document-type\" className=\"text-df-snow\">\n                    Document Type\n                  </Label>\n                  <Select \n                    value={formData.documentType} \n                    onValueChange={(value) => setFormData(prev => ({ ...prev, documentType: value }))}\n                  >\n                    <SelectTrigger className=\"input-df\" data-testid=\"select-document-type\">\n                      <SelectValue placeholder=\"Select document type\" />\n                    </SelectTrigger>\n                    <SelectContent>\n                      <SelectItem value=\"drivers_license\">Driver's License</SelectItem>\n                      <SelectItem value=\"passport\">Passport</SelectItem>\n                      <SelectItem value=\"state_id\">State ID</SelectItem>\n                      <SelectItem value=\"national_id\">National ID</SelectItem>\n                    </SelectContent>\n                  </Select>\n                </div>\n\n                <div>\n                  <Label htmlFor=\"dob\" className=\"text-df-snow\">\n                    Date of Birth\n                  </Label>\n                  <Input\n                    id=\"dob\"\n                    type=\"date\"\n                    value={formData.dateOfBirth}\n                    onChange={(e) => setFormData(prev => ({ ...prev, dateOfBirth: e.target.value }))}\n                    className=\"input-df\"\n                    data-testid=\"input-date-of-birth\"\n                  />\n                </div>\n              </div>\n\n              {/* File Upload */}\n              <div className=\"border-2 border-dashed border-df-steel rounded-lg p-6 text-center\">\n                <Upload className=\"h-8 w-8 text-df-fog mx-auto mb-2\" />\n                <p className=\"text-df-fog mb-2\">Upload front side of your ID</p>\n                <input\n                  type=\"file\"\n                  accept=\"image/*,.pdf\"\n                  onChange={(e) => handleFileUpload(e, 'ID Front')}\n                  className=\"hidden\"\n                  id=\"id-front\"\n                />\n                <label htmlFor=\"id-front\">\n                  <Button variant=\"outline\" className=\"cursor-pointer\" data-testid=\"button-upload-id-front\">\n                    Choose File\n                  </Button>\n                </label>\n              </div>\n\n              <div className=\"border-2 border-dashed border-df-steel rounded-lg p-6 text-center\">\n                <Upload className=\"h-8 w-8 text-df-fog mx-auto mb-2\" />\n                <p className=\"text-df-fog mb-2\">Upload back side of your ID</p>\n                <input\n                  type=\"file\"\n                  accept=\"image/*,.pdf\"\n                  onChange={(e) => handleFileUpload(e, 'ID Back')}\n                  className=\"hidden\"\n                  id=\"id-back\"\n                />\n                <label htmlFor=\"id-back\">\n                  <Button variant=\"outline\" className=\"cursor-pointer\" data-testid=\"button-upload-id-back\">\n                    Choose File\n                  </Button>\n                </label>\n              </div>\n\n              <div className=\"flex justify-between\">\n                <Button variant=\"outline\" onClick={() => setStep('overview')}>\n                  Back\n                </Button>\n                <div className=\"flex gap-2\">\n                  {/* Testing Skip Option - Remove in Production */}\n                  <Button \n                    variant=\"outline\"\n                    onClick={() => setStep('complete')}\n                    data-testid=\"button-skip-verification-testing\"\n                    className=\"text-xs opacity-75\"\n                  >\n                    Skip (Testing)\n                  </Button>\n                  <Button \n                    className=\"btn-primary\" \n                    onClick={() => setStep('kyc')}\n                    data-testid=\"button-continue-kyc\"\n                  >\n                    Continue to KYC\n                  </Button>\n                </div>\n              </div>\n            </CardContent>\n          </Card>\n        )}\n\n        {/* KYC Step */}\n        {step === 'kyc' && (\n          <Card className=\"card-df\">\n            <CardHeader>\n              <CardTitle className=\"text-xl neon-subheading\">\n                Identity Verification (KYC)\n              </CardTitle>\n            </CardHeader>\n            <CardContent className=\"space-y-6\">\n              <div className=\"grid md:grid-cols-2 gap-6\">\n                <div>\n                  <Label htmlFor=\"first-name\" className=\"text-df-snow\">\n                    First Name\n                  </Label>\n                  <Input\n                    id=\"first-name\"\n                    value={formData.firstName}\n                    onChange={(e) => setFormData(prev => ({ ...prev, firstName: e.target.value }))}\n                    className=\"input-df\"\n                    data-testid=\"input-first-name\"\n                  />\n                </div>\n\n                <div>\n                  <Label htmlFor=\"last-name\" className=\"text-df-snow\">\n                    Last Name\n                  </Label>\n                  <Input\n                    id=\"last-name\"\n                    value={formData.lastName}\n                    onChange={(e) => setFormData(prev => ({ ...prev, lastName: e.target.value }))}\n                    className=\"input-df\"\n                    data-testid=\"input-last-name\"\n                  />\n                </div>\n              </div>\n\n              <div>\n                <Label htmlFor=\"address\" className=\"text-df-snow\">\n                  Address\n                </Label>\n                <Input\n                  id=\"address\"\n                  value={formData.address}\n                  onChange={(e) => setFormData(prev => ({ ...prev, address: e.target.value }))}\n                  className=\"input-df\"\n                  data-testid=\"input-address\"\n                />\n              </div>\n\n              <div className=\"grid md:grid-cols-3 gap-6\">\n                <div>\n                  <Label htmlFor=\"city\" className=\"text-df-snow\">\n                    City\n                  </Label>\n                  <Input\n                    id=\"city\"\n                    value={formData.city}\n                    onChange={(e) => setFormData(prev => ({ ...prev, city: e.target.value }))}\n                    className=\"input-df\"\n                    data-testid=\"input-city\"\n                  />\n                </div>\n\n                <div>\n                  <Label htmlFor=\"state\" className=\"text-df-snow\">\n                    State/Province\n                  </Label>\n                  <Input\n                    id=\"state\"\n                    value={formData.state}\n                    onChange={(e) => setFormData(prev => ({ ...prev, state: e.target.value }))}\n                    className=\"input-df\"\n                    data-testid=\"input-state\"\n                  />\n                </div>\n\n                <div>\n                  <Label htmlFor=\"zip\" className=\"text-df-snow\">\n                    ZIP Code\n                  </Label>\n                  <Input\n                    id=\"zip\"\n                    value={formData.zipCode}\n                    onChange={(e) => setFormData(prev => ({ ...prev, zipCode: e.target.value }))}\n                    className=\"input-df\"\n                    data-testid=\"input-zip-code\"\n                  />\n                </div>\n              </div>\n\n              <div>\n                <Label htmlFor=\"country\" className=\"text-df-snow\">\n                  Country\n                </Label>\n                <Select \n                  value={formData.country} \n                  onValueChange={(value) => setFormData(prev => ({ ...prev, country: value }))}\n                >\n                  <SelectTrigger className=\"input-df\" data-testid=\"select-country\">\n                    <SelectValue placeholder=\"Select your country\" />\n                  </SelectTrigger>\n                  <SelectContent>\n                    <SelectItem value=\"US\">United States</SelectItem>\n                    <SelectItem value=\"CA\">Canada</SelectItem>\n                    <SelectItem value=\"GB\">United Kingdom</SelectItem>\n                    <SelectItem value=\"AU\">Australia</SelectItem>\n                    <SelectItem value=\"DE\">Germany</SelectItem>\n                    <SelectItem value=\"FR\">France</SelectItem>\n                  </SelectContent>\n                </Select>\n              </div>\n\n              {/* Business Information */}\n              <div className=\"bg-df-ink border border-df-steel rounded-md p-4\">\n                <h3 className=\"text-df-cyan font-semibold mb-4\">Business Information (Optional)</h3>\n                <div className=\"grid md:grid-cols-2 gap-4\">\n                  <div>\n                    <Label htmlFor=\"business-type\" className=\"text-df-snow\">\n                      Business Type\n                    </Label>\n                    <Select \n                      value={formData.businessType} \n                      onValueChange={(value) => setFormData(prev => ({ ...prev, businessType: value }))}\n                    >\n                      <SelectTrigger className=\"input-df\">\n                        <SelectValue placeholder=\"Select business type\" />\n                      </SelectTrigger>\n                      <SelectContent>\n                        <SelectItem value=\"individual\">Individual</SelectItem>\n                        <SelectItem value=\"sole_proprietorship\">Sole Proprietorship</SelectItem>\n                        <SelectItem value=\"llc\">LLC</SelectItem>\n                        <SelectItem value=\"corporation\">Corporation</SelectItem>\n                      </SelectContent>\n                    </Select>\n                  </div>\n\n                  <div>\n                    <Label htmlFor=\"business-name\" className=\"text-df-snow\">\n                      Business Name\n                    </Label>\n                    <Input\n                      id=\"business-name\"\n                      value={formData.businessName}\n                      onChange={(e) => setFormData(prev => ({ ...prev, businessName: e.target.value }))}\n                      className=\"input-df\"\n                    />\n                  </div>\n\n                  <div>\n                    <Label htmlFor=\"tax-id\" className=\"text-df-snow\">\n                      Tax ID / EIN\n                    </Label>\n                    <Input\n                      id=\"tax-id\"\n                      value={formData.taxId}\n                      onChange={(e) => setFormData(prev => ({ ...prev, taxId: e.target.value }))}\n                      className=\"input-df\"\n                    />\n                  </div>\n                </div>\n              </div>\n\n              <div className=\"flex justify-between\">\n                <Button variant=\"outline\" onClick={() => setStep('age')}>\n                  Back\n                </Button>\n                <Button \n                  className=\"btn-primary\" \n                  onClick={handleSubmit}\n                  data-testid=\"button-submit-verification\"\n                >\n                  Submit Verification\n                </Button>\n              </div>\n            </CardContent>\n          </Card>\n        )}\n\n        {/* Complete Step */}\n        {step === 'complete' && (\n          <Card className=\"card-df text-center\">\n            <CardContent className=\"pt-6\">\n              <div className=\"max-w-md mx-auto\">\n                <div className=\"h-16 w-16 bg-green-500 rounded-full flex items-center justify-center mx-auto mb-4\">\n                  <Check className=\"h-8 w-8 text-df-ink\" />\n                </div>\n                <h2 className=\"text-2xl font-bold text-df-snow mb-4\" data-testid=\"heading-verification-complete\">\n                  Verification Submitted\n                </h2>\n                <p className=\"text-df-fog mb-6\">\n                  Your verification documents have been submitted successfully. Our team will review them within 24-48 hours and notify you via email.\n                </p>\n                <Button \n                  className=\"btn-primary\" \n                  onClick={() => window.history.back()}\n                  data-testid=\"button-back-to-dashboard\"\n                >\n                  Back to Dashboard\n                </Button>\n              </div>\n            </CardContent>\n          </Card>\n        )}\n      </div>\n    </div>\n  );\n}","size_bytes":19906},"server/index.ts":{"content":"import express, { type Request, Response, NextFunction } from \"express\";\nimport cookieParser from \"cookie-parser\";\nimport { registerRoutes } from \"./routes\";\nimport { setupVite, serveStatic, log } from \"./vite\";\nimport { corsMiddleware } from \"./middleware/cors\";\n\nconst app = express();\napp.use(corsMiddleware); // CORS for custom domains\napp.use(cookieParser()); // Parse cookies before any routes\napp.use(express.json());\napp.use(express.urlencoded({ extended: false }));\n\napp.use((req, res, next) => {\n  const start = Date.now();\n  const path = req.path;\n  let capturedJsonResponse: Record<string, any> | undefined = undefined;\n\n  const originalResJson = res.json;\n  res.json = function (bodyJson, ...args) {\n    capturedJsonResponse = bodyJson;\n    return originalResJson.apply(res, [bodyJson, ...args]);\n  };\n\n  res.on(\"finish\", () => {\n    const duration = Date.now() - start;\n    if (path.startsWith(\"/api\")) {\n      let logLine = `${req.method} ${path} ${res.statusCode} in ${duration}ms`;\n      if (capturedJsonResponse) {\n        logLine += ` :: ${JSON.stringify(capturedJsonResponse)}`;\n      }\n\n      if (logLine.length > 80) {\n        logLine = logLine.slice(0, 79) + \"…\";\n      }\n\n      log(logLine);\n    }\n  });\n\n  next();\n});\n\n(async () => {\n  const server = await registerRoutes(app);\n\n  app.use((err: any, _req: Request, res: Response, _next: NextFunction) => {\n    const status = err.status || err.statusCode || 500;\n    const message = err.message || \"Internal Server Error\";\n\n    res.status(status).json({ message });\n    throw err;\n  });\n\n  // importantly only setup vite in development and after\n  // setting up all the other routes so the catch-all route\n  // doesn't interfere with the other routes\n  if (app.get(\"env\") === \"development\") {\n    await setupVite(app, server);\n  } else {\n    serveStatic(app);\n  }\n\n  // ALWAYS serve the app on the port specified in the environment variable PORT\n  // Other ports are firewalled. Default to 5000 if not specified.\n  // this serves both the API and the client.\n  // It is the only port that is not firewalled.\n  const port = parseInt(process.env.PORT || '5000', 10);\n  server.listen({\n    port,\n    host: \"0.0.0.0\",\n    reusePort: true,\n  }, () => {\n    log(`serving on port ${port}`);\n  });\n})();\n","size_bytes":2272},"client/src/components/ui/breadcrumb.tsx":{"content":"import * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { ChevronRight, MoreHorizontal } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Breadcrumb = React.forwardRef<\n  HTMLElement,\n  React.ComponentPropsWithoutRef<\"nav\"> & {\n    separator?: React.ReactNode\n  }\n>(({ ...props }, ref) => <nav ref={ref} aria-label=\"breadcrumb\" {...props} />)\nBreadcrumb.displayName = \"Breadcrumb\"\n\nconst BreadcrumbList = React.forwardRef<\n  HTMLOListElement,\n  React.ComponentPropsWithoutRef<\"ol\">\n>(({ className, ...props }, ref) => (\n  <ol\n    ref={ref}\n    className={cn(\n      \"flex flex-wrap items-center gap-1.5 break-words text-sm text-muted-foreground sm:gap-2.5\",\n      className\n    )}\n    {...props}\n  />\n))\nBreadcrumbList.displayName = \"BreadcrumbList\"\n\nconst BreadcrumbItem = React.forwardRef<\n  HTMLLIElement,\n  React.ComponentPropsWithoutRef<\"li\">\n>(({ className, ...props }, ref) => (\n  <li\n    ref={ref}\n    className={cn(\"inline-flex items-center gap-1.5\", className)}\n    {...props}\n  />\n))\nBreadcrumbItem.displayName = \"BreadcrumbItem\"\n\nconst BreadcrumbLink = React.forwardRef<\n  HTMLAnchorElement,\n  React.ComponentPropsWithoutRef<\"a\"> & {\n    asChild?: boolean\n  }\n>(({ asChild, className, ...props }, ref) => {\n  const Comp = asChild ? Slot : \"a\"\n\n  return (\n    <Comp\n      ref={ref}\n      className={cn(\"transition-colors hover:text-foreground\", className)}\n      {...props}\n    />\n  )\n})\nBreadcrumbLink.displayName = \"BreadcrumbLink\"\n\nconst BreadcrumbPage = React.forwardRef<\n  HTMLSpanElement,\n  React.ComponentPropsWithoutRef<\"span\">\n>(({ className, ...props }, ref) => (\n  <span\n    ref={ref}\n    role=\"link\"\n    aria-disabled=\"true\"\n    aria-current=\"page\"\n    className={cn(\"font-normal text-foreground\", className)}\n    {...props}\n  />\n))\nBreadcrumbPage.displayName = \"BreadcrumbPage\"\n\nconst BreadcrumbSeparator = ({\n  children,\n  className,\n  ...props\n}: React.ComponentProps<\"li\">) => (\n  <li\n    role=\"presentation\"\n    aria-hidden=\"true\"\n    className={cn(\"[&>svg]:w-3.5 [&>svg]:h-3.5\", className)}\n    {...props}\n  >\n    {children ?? <ChevronRight />}\n  </li>\n)\nBreadcrumbSeparator.displayName = \"BreadcrumbSeparator\"\n\nconst BreadcrumbEllipsis = ({\n  className,\n  ...props\n}: React.ComponentProps<\"span\">) => (\n  <span\n    role=\"presentation\"\n    aria-hidden=\"true\"\n    className={cn(\"flex h-9 w-9 items-center justify-center\", className)}\n    {...props}\n  >\n    <MoreHorizontal className=\"h-4 w-4\" />\n    <span className=\"sr-only\">More</span>\n  </span>\n)\nBreadcrumbEllipsis.displayName = \"BreadcrumbElipssis\"\n\nexport {\n  Breadcrumb,\n  BreadcrumbList,\n  BreadcrumbItem,\n  BreadcrumbLink,\n  BreadcrumbPage,\n  BreadcrumbSeparator,\n  BreadcrumbEllipsis,\n}\n","size_bytes":2712},"client/src/components/ui/dropdown-menu.tsx":{"content":"import * as React from \"react\"\nimport * as DropdownMenuPrimitive from \"@radix-ui/react-dropdown-menu\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst DropdownMenu = DropdownMenuPrimitive.Root\n\nconst DropdownMenuTrigger = DropdownMenuPrimitive.Trigger\n\nconst DropdownMenuGroup = DropdownMenuPrimitive.Group\n\nconst DropdownMenuPortal = DropdownMenuPrimitive.Portal\n\nconst DropdownMenuSub = DropdownMenuPrimitive.Sub\n\nconst DropdownMenuRadioGroup = DropdownMenuPrimitive.RadioGroup\n\nconst DropdownMenuSubTrigger = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <DropdownMenuPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto\" />\n  </DropdownMenuPrimitive.SubTrigger>\n))\nDropdownMenuSubTrigger.displayName =\n  DropdownMenuPrimitive.SubTrigger.displayName\n\nconst DropdownMenuSubContent = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <DropdownMenuPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-dropdown-menu-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuSubContent.displayName =\n  DropdownMenuPrimitive.SubContent.displayName\n\nconst DropdownMenuContent = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Content>\n>(({ className, sideOffset = 4, ...props }, ref) => (\n  <DropdownMenuPrimitive.Portal>\n    <DropdownMenuPrimitive.Content\n      ref={ref}\n      sideOffset={sideOffset}\n      className={cn(\n        \"z-50 max-h-[var(--radix-dropdown-menu-content-available-height)] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-dropdown-menu-content-transform-origin]\",\n        className\n      )}\n      {...props}\n    />\n  </DropdownMenuPrimitive.Portal>\n))\nDropdownMenuContent.displayName = DropdownMenuPrimitive.Content.displayName\n\nconst DropdownMenuItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <DropdownMenuPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuItem.displayName = DropdownMenuPrimitive.Item.displayName\n\nconst DropdownMenuCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <DropdownMenuPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <DropdownMenuPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </DropdownMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </DropdownMenuPrimitive.CheckboxItem>\n))\nDropdownMenuCheckboxItem.displayName =\n  DropdownMenuPrimitive.CheckboxItem.displayName\n\nconst DropdownMenuRadioItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <DropdownMenuPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <DropdownMenuPrimitive.ItemIndicator>\n        <Circle className=\"h-2 w-2 fill-current\" />\n      </DropdownMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </DropdownMenuPrimitive.RadioItem>\n))\nDropdownMenuRadioItem.displayName = DropdownMenuPrimitive.RadioItem.displayName\n\nconst DropdownMenuLabel = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <DropdownMenuPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuLabel.displayName = DropdownMenuPrimitive.Label.displayName\n\nconst DropdownMenuSeparator = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <DropdownMenuPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nDropdownMenuSeparator.displayName = DropdownMenuPrimitive.Separator.displayName\n\nconst DropdownMenuShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\"ml-auto text-xs tracking-widest opacity-60\", className)}\n      {...props}\n    />\n  )\n}\nDropdownMenuShortcut.displayName = \"DropdownMenuShortcut\"\n\nexport {\n  DropdownMenu,\n  DropdownMenuTrigger,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuCheckboxItem,\n  DropdownMenuRadioItem,\n  DropdownMenuLabel,\n  DropdownMenuSeparator,\n  DropdownMenuShortcut,\n  DropdownMenuGroup,\n  DropdownMenuPortal,\n  DropdownMenuSub,\n  DropdownMenuSubContent,\n  DropdownMenuSubTrigger,\n  DropdownMenuRadioGroup,\n}\n","size_bytes":7609},"client/src/components/ui/card.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Card = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\n      \"rounded-lg border bg-card text-card-foreground shadow-sm\",\n      className\n    )}\n    {...props}\n  />\n))\nCard.displayName = \"Card\"\n\nconst CardHeader = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"flex flex-col space-y-1.5 p-6\", className)}\n    {...props}\n  />\n))\nCardHeader.displayName = \"CardHeader\"\n\nconst CardTitle = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\n      \"text-2xl font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nCardTitle.displayName = \"CardTitle\"\n\nconst CardDescription = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nCardDescription.displayName = \"CardDescription\"\n\nconst CardContent = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div ref={ref} className={cn(\"p-6 pt-0\", className)} {...props} />\n))\nCardContent.displayName = \"CardContent\"\n\nconst CardFooter = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"flex items-center p-6 pt-0\", className)}\n    {...props}\n  />\n))\nCardFooter.displayName = \"CardFooter\"\n\nexport { Card, CardHeader, CardFooter, CardTitle, CardDescription, CardContent }\n","size_bytes":1858},"server/storage.ts":{"content":"import {\n  users,\n  profiles,\n  mediaAssets,\n  moderationQueue,\n  payoutAccounts,\n  payoutRequests,\n  messages,\n  subscriptions,\n  auditLogs,\n  tickets,\n  transactions,\n  refundRequests,\n  trustScores,\n  fanzWallets,\n  fanzCards,\n  paymentMethods,\n  posts,\n  postLikes,\n  postComments,\n  follows,\n  storyMoments,\n  storyViews,\n  fanLevels,\n  creatorAnalytics,\n  liveStreams,\n  streamViewers,\n  streamChat,\n  streamTips,\n  collaborations,\n  subscriptionTiers,\n  contentBundles,\n  virtualGifts,\n  giftsSent,\n  leaderboards,\n  referralCodes,\n  referrals,\n  scheduledPosts,\n  creatorBadges,\n  contentWatermarks,\n  geoBlockingRules,\n  contentTags,\n  postTags,\n  dmcaClaims,\n  twoFactorAuth,\n  pushSubscriptions,\n  onboardingProgress,\n  contentNiches,\n  userInterests,\n  passwordResetTokens,\n  emailRecoveryTokens,\n  emailVerificationTokens,\n  nftContracts,\n  nftMints,\n  onchainRoyalties,\n  loanPrograms,\n  loanApplications,\n  loanOffers,\n  loanRepayments,\n  loanEscrowAccounts,\n  aiScanJobs,\n  aiScanResults,\n  contentFingerprints,\n  type User,\n  type UpsertUser,\n  type InsertUser,\n  type InsertNftContract,\n  type InsertNftMint,\n  type InsertOnchainRoyalty,\n  type Profile,\n  type InsertProfile,\n  type OnboardingProgress,\n  type InsertOnboardingProgress,\n  type ContentNiche,\n  type InsertContentNiche,\n  type UserInterest,\n  type InsertUserInterest,\n  type Collaboration,\n  type InsertCollaboration,\n  type SubscriptionTier,\n  type InsertSubscriptionTier,\n  type ContentBundle,\n  type InsertContentBundle,\n  type VirtualGift,\n  type GiftSent,\n  type InsertGiftSent,\n  type ScheduledPost,\n  type InsertScheduledPost,\n  type CreatorBadge,\n  type InsertCreatorBadge,\n  type GeoBlockingRule,\n  type InsertGeoBlockingRule,\n  type DmcaClaim,\n  type InsertDmcaClaim,\n  type Leaderboard,\n  type ReferralCode,\n  type Referral,\n  type MediaAsset,\n  type InsertMediaAsset,\n  type ModerationItem,\n  type PayoutAccount,\n  type InsertPayoutAccount,\n  type Message,\n  type InsertMessage,\n  type PayoutRequest,\n  type Subscription,\n  type Ticket,\n  type InsertTicket,\n  type Transaction,\n  type InsertTransaction,\n  type RefundRequest,\n  type InsertRefundRequest,\n  type TrustScore,\n  type InsertTrustScore,\n  type FanzWallet,\n  type InsertFanzWallet,\n  type FanzCard,\n  type InsertFanzCard,\n  type PaymentMethod,\n  type InsertPaymentMethod,\n  type Post,\n  type InsertPost,\n  type PostLike,\n  type InsertPostLike,\n  type PostComment,\n  type InsertPostComment,\n  type Follow,\n  type InsertFollow,\n  type StoryMoment,\n  type InsertStoryMoment,\n  type StoryView,\n  type InsertStoryView,\n  type FanLevel,\n  type InsertFanLevel,\n  type CreatorAnalytics,\n  type InsertCreatorAnalytics,\n  type LiveStream,\n  type InsertLiveStream,\n  type StreamViewer,\n  type InsertStreamViewer,\n  type StreamChat,\n  type InsertStreamChat,\n  type StreamTip,\n  type InsertStreamTip,\n} from \"@shared/schema\";\nimport { db } from \"./db\";\nimport { eq, desc, and, or, inArray, gt, lt, sql as sqlOperator } from \"drizzle-orm\";\n\nexport interface IStorage {\n  // User operations (mandatory for Replit Auth)\n  getUser(id: string): Promise<User | undefined>;\n  upsertUser(user: UpsertUser): Promise<User>;\n  getUserByUsername(username: string): Promise<User | undefined>;\n  getUserByEmail(email: string): Promise<User | undefined>;\n  createUser(user: InsertUser): Promise<User>;\n  updateUser(id: string, updates: Partial<User>): Promise<User>;\n  updateUserPassword(userId: string, hashedPassword: string): Promise<void>;\n\n  // Password reset token operations\n  createPasswordResetToken(token: { userId: string; token: string; expiresAt: Date }): Promise<void>;\n  invalidatePreviousPasswordResetTokens(userId: string): Promise<void>;\n  redeemPasswordResetToken(tokenHash: string): Promise<{ userId: string } | undefined>;\n\n  // Email recovery token operations\n  createEmailRecoveryToken(token: { userId: string; token: string; expiresAt: Date }): Promise<void>;\n  invalidatePreviousEmailRecoveryTokens(userId: string): Promise<void>;\n\n  // Profile operations\n  getProfile(userId: string): Promise<Profile | undefined>;\n  createProfile(profile: InsertProfile): Promise<Profile>;\n  updateProfile(userId: string, updates: Partial<Profile>): Promise<Profile>;\n\n  // Media operations\n  createMediaAsset(asset: InsertMediaAsset): Promise<MediaAsset>;\n  getMediaAssets(ownerId: string): Promise<MediaAsset[]>;\n  getMediaAsset(id: string): Promise<MediaAsset | undefined>;\n  updateMediaAsset(id: string, updates: Partial<MediaAsset>): Promise<MediaAsset>;\n\n  // Moderation operations\n  getModerationQueue(): Promise<ModerationItem[]>;\n  updateModerationItem(id: string, updates: Partial<ModerationItem>): Promise<ModerationItem>;\n\n  // Payment operations\n  createPayoutAccount(account: InsertPayoutAccount): Promise<PayoutAccount>;\n  getPayoutAccounts(userId: string): Promise<PayoutAccount[]>;\n  createPayoutRequest(request: Omit<PayoutRequest, 'id' | 'createdAt' | 'updatedAt'>): Promise<PayoutRequest>;\n\n  // Messaging operations\n  createMessage(message: InsertMessage): Promise<Message>;\n  getMessages(userId1: string, userId2: string): Promise<Message[]>;\n  markMessageAsRead(id: string): Promise<void>;\n\n  // Subscription operations\n  getSubscriptions(fanId: string): Promise<Subscription[]>;\n  getCreatorSubscriptions(creatorId: string): Promise<Subscription[]>;\n\n  // Audit operations\n  createAuditLog(log: Omit<typeof auditLogs.$inferInsert, 'id' | 'timestamp'>): Promise<void>;\n\n  // Support ticket operations\n  getSupportTickets(userId: string): Promise<Ticket[]>;\n  createSupportTicket(ticket: InsertTicket): Promise<Ticket>;\n  updateSupportTicket(id: string, userId: string, updates: Partial<Ticket>): Promise<Ticket | null>;\n\n  // FanzTrust™ Transaction operations\n  findTransaction(criteria: Partial<Transaction>): Promise<Transaction | undefined>;\n  getTransaction(id: string): Promise<Transaction | undefined>;\n  getFanTransactions(fanId: string): Promise<Transaction[]>;\n  getCreatorTransactions(creatorId: string): Promise<Transaction[]>;\n  createTransaction(transaction: InsertTransaction): Promise<Transaction>;\n\n  // FanzTrust™ Refund operations\n  findRefundRequest(transactionId: string): Promise<RefundRequest | undefined>;\n  getRefundRequest(id: string): Promise<RefundRequest | undefined>;\n  getAllRefundRequests(): Promise<RefundRequest[]>;\n  getFanRefundRequests(fanId: string): Promise<RefundRequest[]>;\n  getCreatorRefundRequests(creatorId: string): Promise<RefundRequest[]>;\n  createRefundRequest(request: InsertRefundRequest): Promise<RefundRequest>;\n  updateRefundRequest(id: string, updates: Partial<RefundRequest>): Promise<RefundRequest>;\n  performAutoRefundCheck(transaction: Transaction, context: any): Promise<any>;\n\n  // FanzTrust™ Trust Score operations\n  getTrustScore(userId: string): Promise<TrustScore | undefined>;\n  createTrustScore(trustScore: InsertTrustScore): Promise<TrustScore>;\n  updateTrustScore(userId: string, updates: Partial<TrustScore>): Promise<TrustScore>;\n\n  // FanzPay Wallet operations\n  getFanzWallet(userId: string): Promise<FanzWallet | undefined>;\n  createFanzWallet(wallet: InsertFanzWallet): Promise<FanzWallet>;\n  updateFanzWallet(userId: string, updates: Partial<FanzWallet>): Promise<FanzWallet>;\n\n  // FanzCard operations\n  getFanzCards(userId: string): Promise<FanzCard[]>;\n  createFanzCard(card: InsertFanzCard): Promise<FanzCard>;\n\n  // Payment Method operations\n  getPaymentMethods(userId: string): Promise<PaymentMethod[]>;\n  createPaymentMethod(method: InsertPaymentMethod): Promise<PaymentMethod>;\n\n  // Feed operations (Infinity Scroll)\n  getPosts(options: { page: number; limit: number; userId?: string }): Promise<Post[]>;\n  getPostById(id: string): Promise<Post | undefined>;\n  createPost(post: InsertPost): Promise<Post>;\n  updatePost(id: string, updates: Partial<Post>): Promise<Post>;\n  \n  // Post Like operations\n  togglePostLike(userId: string, postId: string): Promise<{ liked: boolean }>;\n  isPostLikedByUser(userId: string, postId: string): Promise<boolean>;\n  \n  // Post Comment operations\n  addComment(userId: string, postId: string, text: string): Promise<PostComment>;\n  getPostComments(postId: string): Promise<PostComment[]>;\n  \n  // Follow operations\n  followCreator(fanId: string, creatorId: string): Promise<Follow>;\n  unfollowCreator(fanId: string, creatorId: string): Promise<void>;\n  getFollowing(fanId: string): Promise<Follow[]>;\n  isFollowing(fanId: string, creatorId: string): Promise<boolean>;\n\n  // Story Moment operations\n  getActiveStories(userId?: string): Promise<StoryMoment[]>;\n  getCreatorStories(creatorId: string): Promise<StoryMoment[]>;\n  createStory(story: InsertStoryMoment): Promise<StoryMoment>;\n  viewStory(storyId: string, viewerId: string): Promise<void>;\n  getStoryViews(storyId: string): Promise<StoryView[]>;\n  deleteExpiredStories(): Promise<void>;\n\n  // Fan Level & Gamification operations\n  getFanLevel(userId: string): Promise<FanLevel | undefined>;\n  createFanLevel(fanLevel: InsertFanLevel): Promise<FanLevel>;\n  updateFanLevel(userId: string, updates: Partial<FanLevel>): Promise<FanLevel>;\n  addXP(userId: string, xpAmount: number, reason: string): Promise<FanLevel>;\n  updateStreak(userId: string): Promise<FanLevel>;\n\n  // Creator Analytics operations\n  getCreatorAnalytics(creatorId: string, period: \"daily\" | \"weekly\" | \"monthly\", limit?: number): Promise<CreatorAnalytics[]>;\n  getCurrentAnalytics(creatorId: string): Promise<any>; // Real-time current period stats\n  aggregateAnalytics(creatorId: string, period: \"daily\" | \"weekly\" | \"monthly\", startDate: Date, endDate: Date): Promise<CreatorAnalytics>;\n  recordView(postId: string, viewerId?: string): Promise<void>;\n  recordLike(postId: string, viewerId: string): Promise<void>;\n  recordComment(postId: string, viewerId: string): Promise<void>;\n\n  // Live Streaming operations\n  createStream(stream: InsertLiveStream): Promise<LiveStream>;\n  getStream(streamId: string): Promise<LiveStream | undefined>;\n  getCreatorStreams(creatorId: string, status?: \"scheduled\" | \"live\" | \"ended\" | \"archived\"): Promise<LiveStream[]>;\n  getLiveStreams(limit?: number): Promise<LiveStream[]>; // Get all currently live streams\n  updateStream(streamId: string, updates: Partial<LiveStream>): Promise<LiveStream>;\n  startStream(streamId: string): Promise<LiveStream>;\n  endStream(streamId: string): Promise<LiveStream>;\n  joinStream(streamId: string, viewerId: string): Promise<void>;\n  leaveStream(streamId: string, viewerId: string): Promise<void>;\n  getStreamViewers(streamId: string): Promise<StreamViewer[]>;\n  sendStreamChat(streamId: string, userId: string, message: string): Promise<StreamChat>;\n  getStreamChat(streamId: string, limit?: number): Promise<StreamChat[]>;\n  sendStreamTip(tip: InsertStreamTip): Promise<StreamTip>;\n  getStreamTips(streamId: string): Promise<StreamTip[]>;\n\n  // Collaboration operations\n  createCollaboration(collab: InsertCollaboration): Promise<Collaboration>;\n  respondToCollaboration(collabId: string, accept: boolean): Promise<Collaboration>;\n  getCollaborations(userId: string): Promise<Collaboration[]>;\n\n  // Subscription Tier operations\n  createSubscriptionTier(tier: InsertSubscriptionTier): Promise<SubscriptionTier>;\n  getCreatorTiers(creatorId: string): Promise<SubscriptionTier[]>;\n  updateSubscriptionTier(tierId: string, updates: Partial<SubscriptionTier>): Promise<SubscriptionTier>;\n\n  // Content Bundle operations\n  createContentBundle(bundle: InsertContentBundle): Promise<ContentBundle>;\n  getCreatorBundles(creatorId: string): Promise<ContentBundle[]>;\n  purchaseBundle(bundleId: string, userId: string): Promise<{ success: boolean }>;\n\n  // Virtual Gift operations\n  getVirtualGifts(): Promise<VirtualGift[]>;\n  sendGift(gift: InsertGiftSent): Promise<GiftSent>;\n  getGiftsReceived(creatorId: string): Promise<GiftSent[]>;\n\n  // Leaderboard operations\n  updateLeaderboards(period: string): Promise<void>;\n  getLeaderboard(period: string, category: string, limit?: number): Promise<Leaderboard[]>;\n\n  // Referral operations\n  createReferralCode(userId: string): Promise<ReferralCode>;\n  getReferralCode(userId: string): Promise<ReferralCode | undefined>;\n  processReferral(code: string, newUserId: string): Promise<Referral>;\n\n  // Scheduled Post operations\n  createScheduledPost(post: InsertScheduledPost): Promise<ScheduledPost>;\n  getScheduledPosts(creatorId: string): Promise<ScheduledPost[]>;\n  publishScheduledPosts(): Promise<void>;\n\n  // Creator Badge operations\n  assignBadge(userId: string, badgeType: string): Promise<CreatorBadge>;\n  getUserBadges(userId: string): Promise<CreatorBadge[]>;\n\n  // Geo-blocking operations\n  createGeoBlockingRule(rule: InsertGeoBlockingRule): Promise<GeoBlockingRule>;\n  getGeoBlockingRules(creatorId: string): Promise<GeoBlockingRule[]>;\n  checkGeoAccess(creatorId: string, countryCode: string): Promise<boolean>;\n\n  // Search & Tag operations\n  searchContent(query: any): Promise<any[]>;\n  addTagsToPost(postId: string, tagIds: string[]): Promise<void>;\n\n  // DMCA operations\n  createDmcaClaim(claim: InsertDmcaClaim): Promise<DmcaClaim>;\n  getDmcaClaims(status?: string): Promise<DmcaClaim[]>;\n  reviewDmcaClaim(claimId: string, approved: boolean, reviewerId: string): Promise<DmcaClaim>;\n\n  // Onboarding operations\n  getOnboardingProgress(userId: string): Promise<OnboardingProgress | undefined>;\n  createOnboardingProgress(userId: string): Promise<OnboardingProgress>;\n  updateOnboardingProgress(userId: string, updates: Partial<OnboardingProgress>): Promise<OnboardingProgress>;\n  \n  // Content Niche operations\n  getContentNiches(): Promise<ContentNiche[]>;\n  createContentNiche(niche: InsertContentNiche): Promise<ContentNiche>;\n  \n  // User Interest operations\n  getUserInterests(userId: string): Promise<UserInterest[]>;\n  setUserInterests(userId: string, nicheIds: string[]): Promise<void>;\n  \n  // Profile operations\n  updateProfile(userId: string, updates: Partial<Profile>): Promise<Profile>;\n\n  // NFT operations\n  deployNftContract(contract: InsertNftContract): Promise<any>;\n  getNftContractsByCreator(creatorId: string): Promise<any[]>;\n  mintNft(mint: any, creatorId: string): Promise<any>;\n  getNftMintsByContract(contractId: string, userId: string): Promise<any[]>;\n  recordNftRoyalty(royalty: any, creatorId: string): Promise<any>;\n  getNftRoyaltiesByCreator(creatorId: string): Promise<any[]>;\n  getNftRoyaltyStats(creatorId: string): Promise<any>;\n  getMarketplaceNfts(): Promise<any[]>;\n  getNftMintById(nftId: string): Promise<any>;\n  purchaseNft(nftId: string, buyerId: string): Promise<any>;\n\n  // Loan operations\n  createLoanProgram(program: any): Promise<any>;\n  getLoanPrograms(): Promise<any[]>;\n  createLoanApplication(application: any): Promise<any>;\n  getLoanApplicationsByCreator(creatorId: string): Promise<any[]>;\n  createLoanOffer(offer: any): Promise<any>;\n  getLoanOffersByLender(lenderId: string): Promise<any[]>;\n  acceptLoanOffer(offerId: string, creatorId: string): Promise<any>;\n  getLoanRepaymentsByOffer(offerId: string, userId: string): Promise<any[]>;\n  payLoanRepayment(repaymentId: string, amount: number, creatorId: string): Promise<any>;\n\n  // AI Moderation operations\n  createAiScanJob(job: any): Promise<any>;\n  getAiScanJobsByMedia(mediaId: string, userId: string): Promise<any[]>;\n  getAiScanQueue(): Promise<any[]>;\n  getAiScanResults(jobId: string, userId: string): Promise<any>;\n  getAiScanResultsByMedia(mediaId: string, userId: string): Promise<any[]>;\n  reviewAiScanResult(id: string, review: any, userId: string): Promise<any>;\n  createContentFingerprint(fingerprint: any): Promise<any>;\n  getContentFingerprint(mediaId: string, userId: string): Promise<any>;\n  verifyContentFingerprint(id: string, verification: any, userId: string): Promise<any>;\n}\n\nexport class DatabaseStorage implements IStorage {\n  // User operations\n  async getUser(id: string): Promise<User | undefined> {\n    const [user] = await db.select().from(users).where(eq(users.id, id));\n    return user;\n  }\n\n  async upsertUser(userData: UpsertUser): Promise<User> {\n    // Check if user exists by email first\n    const existingUser = await this.getUserByEmail(userData.email!);\n    \n    if (existingUser) {\n      // Update existing user with new data\n      const updatedUser = await db\n        .update(users)\n        .set({ \n          ...userData, \n          updatedAt: new Date() \n        })\n        .where(eq(users.email, userData.email!))\n        .returning();\n      return updatedUser[0];\n    } else {\n      // Create new user\n      const newUser = await db\n        .insert(users)\n        .values(userData)\n        .returning();\n      return newUser[0];\n    }\n  }\n\n  async getUserByUsername(username: string): Promise<User | undefined> {\n    const [user] = await db.select().from(users).where(eq(users.username, username));\n    return user;\n  }\n\n  async getUserByEmail(email: string): Promise<User | undefined> {\n    const [user] = await db.select().from(users).where(eq(users.email, email));\n    return user;\n  }\n\n  async createUser(userData: InsertUser): Promise<User> {\n    const [user] = await db.insert(users).values(userData).returning();\n    return user;\n  }\n\n  async updateUser(id: string, updates: Partial<User>): Promise<User> {\n    const [user] = await db\n      .update(users)\n      .set({ ...updates, updatedAt: new Date() })\n      .where(eq(users.id, id))\n      .returning();\n    return user;\n  }\n\n  async updateUserPassword(userId: string, hashedPassword: string): Promise<void> {\n    await db\n      .update(users)\n      .set({ password: hashedPassword, updatedAt: new Date() })\n      .where(eq(users.id, userId));\n  }\n\n  // Password reset token operations\n  async createPasswordResetToken(token: { userId: string; token: string; expiresAt: Date }): Promise<void> {\n    await db.insert(passwordResetTokens).values(token);\n  }\n\n  async invalidatePreviousPasswordResetTokens(userId: string): Promise<void> {\n    // Invalidate all outstanding (unused) tokens for this user\n    await db\n      .update(passwordResetTokens)\n      .set({ usedAt: new Date() })\n      .where(\n        and(\n          eq(passwordResetTokens.userId, userId),\n          sqlOperator`${passwordResetTokens.usedAt} IS NULL`\n        )\n      );\n  }\n\n  async redeemPasswordResetToken(tokenHash: string): Promise<{ userId: string } | undefined> {\n    // Atomically redeem the token: update and return in one operation\n    // This prevents race conditions where multiple requests could use the same token\n    const [result] = await db\n      .update(passwordResetTokens)\n      .set({ usedAt: new Date() })\n      .where(\n        and(\n          eq(passwordResetTokens.token, tokenHash),\n          sqlOperator`${passwordResetTokens.usedAt} IS NULL`,\n          gt(passwordResetTokens.expiresAt, new Date())\n        )\n      )\n      .returning({ userId: passwordResetTokens.userId });\n    \n    return result;\n  }\n\n  // Email recovery token operations\n  async createEmailRecoveryToken(token: { userId: string; token: string; expiresAt: Date }): Promise<void> {\n    await db.insert(emailRecoveryTokens).values(token);\n  }\n\n  async invalidatePreviousEmailRecoveryTokens(userId: string): Promise<void> {\n    // Invalidate all outstanding (unused) tokens for this user\n    await db\n      .update(emailRecoveryTokens)\n      .set({ usedAt: new Date() })\n      .where(\n        and(\n          eq(emailRecoveryTokens.userId, userId),\n          sqlOperator`${emailRecoveryTokens.usedAt} IS NULL`\n        )\n      );\n  }\n\n  // Profile operations\n  async getProfile(userId: string): Promise<Profile | undefined> {\n    const [profile] = await db.select().from(profiles).where(eq(profiles.userId, userId));\n    return profile;\n  }\n\n  async createProfile(profileData: InsertProfile): Promise<Profile> {\n    const [profile] = await db.insert(profiles).values(profileData).returning();\n    return profile;\n  }\n\n  async updateProfile(userId: string, updates: Partial<Profile>): Promise<Profile> {\n    const [profile] = await db\n      .update(profiles)\n      .set({ ...updates, updatedAt: new Date() })\n      .where(eq(profiles.userId, userId))\n      .returning();\n    return profile;\n  }\n\n  // Media operations\n  async createMediaAsset(assetData: InsertMediaAsset): Promise<MediaAsset> {\n    const [asset] = await db.insert(mediaAssets).values(assetData).returning();\n    return asset;\n  }\n\n  async getMediaAssets(ownerId: string): Promise<MediaAsset[]> {\n    return await db\n      .select()\n      .from(mediaAssets)\n      .where(eq(mediaAssets.ownerId, ownerId))\n      .orderBy(desc(mediaAssets.createdAt));\n  }\n\n  async getMediaAsset(id: string): Promise<MediaAsset | undefined> {\n    const [asset] = await db.select().from(mediaAssets).where(eq(mediaAssets.id, id));\n    return asset;\n  }\n\n  async updateMediaAsset(id: string, updates: Partial<MediaAsset>): Promise<MediaAsset> {\n    const [asset] = await db\n      .update(mediaAssets)\n      .set({ ...updates, updatedAt: new Date() })\n      .where(eq(mediaAssets.id, id))\n      .returning();\n    return asset;\n  }\n\n  // Moderation operations\n  async getModerationQueue(): Promise<ModerationItem[]> {\n    return await db\n      .select()\n      .from(moderationQueue)\n      .orderBy(desc(moderationQueue.priority), desc(moderationQueue.createdAt));\n  }\n\n  async updateModerationItem(id: string, updates: Partial<ModerationItem>): Promise<ModerationItem> {\n    const [item] = await db\n      .update(moderationQueue)\n      .set({ ...updates, updatedAt: new Date() })\n      .where(eq(moderationQueue.id, id))\n      .returning();\n    return item;\n  }\n\n  // Payment operations\n  async createPayoutAccount(accountData: InsertPayoutAccount): Promise<PayoutAccount> {\n    const [account] = await db.insert(payoutAccounts).values(accountData).returning();\n    return account;\n  }\n\n  async getPayoutAccounts(userId: string): Promise<PayoutAccount[]> {\n    return await db\n      .select()\n      .from(payoutAccounts)\n      .where(eq(payoutAccounts.userId, userId));\n  }\n\n  async createPayoutRequest(requestData: Omit<PayoutRequest, 'id' | 'createdAt' | 'updatedAt'>): Promise<PayoutRequest> {\n    const [request] = await db.insert(payoutRequests).values(requestData).returning();\n    return request;\n  }\n\n  // Messaging operations\n  async createMessage(messageData: InsertMessage): Promise<Message> {\n    const [message] = await db.insert(messages).values(messageData).returning();\n    return message;\n  }\n\n  async getMessages(userId1: string, userId2: string): Promise<Message[]> {\n    return await db\n      .select()\n      .from(messages)\n      .where(\n        or(\n          and(eq(messages.senderId, userId1), eq(messages.recipientId, userId2)),\n          and(eq(messages.senderId, userId2), eq(messages.recipientId, userId1))\n        )\n      )\n      .orderBy(desc(messages.createdAt));\n  }\n\n  async markMessageAsRead(id: string): Promise<void> {\n    await db\n      .update(messages)\n      .set({ isRead: true })\n      .where(eq(messages.id, id));\n  }\n\n  // Subscription operations\n  async getSubscriptions(fanId: string): Promise<Subscription[]> {\n    return await db\n      .select()\n      .from(subscriptions)\n      .where(eq(subscriptions.fanId, fanId));\n  }\n\n  async getCreatorSubscriptions(creatorId: string): Promise<Subscription[]> {\n    return await db\n      .select()\n      .from(subscriptions)\n      .where(eq(subscriptions.creatorId, creatorId));\n  }\n\n  // Audit operations\n  async createAuditLog(logData: Omit<typeof auditLogs.$inferInsert, 'id' | 'timestamp'>): Promise<void> {\n    await db.insert(auditLogs).values(logData);\n  }\n\n  // Support ticket operations\n  async getSupportTickets(userId: string): Promise<Ticket[]> {\n    return await db\n      .select()\n      .from(tickets)\n      .where(eq(tickets.userId, userId))\n      .orderBy(desc(tickets.createdAt));\n  }\n\n  async createSupportTicket(ticketData: InsertTicket): Promise<Ticket> {\n    const [ticket] = await db.insert(tickets).values(ticketData).returning();\n    return ticket;\n  }\n\n  async updateSupportTicket(id: string, userId: string, updates: Partial<Ticket>): Promise<Ticket | null> {\n    // Verify the ticket belongs to the user\n    const existingTicket = await db\n      .select()\n      .from(tickets)\n      .where(and(eq(tickets.id, parseInt(id)), eq(tickets.userId, userId)))\n      .limit(1);\n\n    if (existingTicket.length === 0) {\n      return null;\n    }\n\n    const [updatedTicket] = await db\n      .update(tickets)\n      .set({ ...updates, updatedAt: new Date() })\n      .where(eq(tickets.id, parseInt(id)))\n      .returning();\n\n    return updatedTicket;\n  }\n\n  // FanzTrust™ Transaction operations\n  async findTransaction(criteria: Partial<Transaction>): Promise<Transaction | undefined> {\n    const conditions = [];\n    if (criteria.fanId) conditions.push(eq(transactions.fanId, criteria.fanId));\n    if (criteria.creatorId) conditions.push(eq(transactions.creatorId, criteria.creatorId));\n    if (criteria.gateway) conditions.push(eq(transactions.gateway, criteria.gateway));\n    if (criteria.txid) conditions.push(eq(transactions.txid, criteria.txid));\n    if (criteria.walletAddress) conditions.push(eq(transactions.walletAddress, criteria.walletAddress));\n\n    const [transaction] = await db\n      .select()\n      .from(transactions)\n      .where(and(...conditions))\n      .limit(1);\n\n    return transaction;\n  }\n\n  async getTransaction(id: string): Promise<Transaction | undefined> {\n    const [transaction] = await db\n      .select()\n      .from(transactions)\n      .where(eq(transactions.id, id))\n      .limit(1);\n    return transaction;\n  }\n\n  async getFanTransactions(fanId: string): Promise<Transaction[]> {\n    return await db\n      .select()\n      .from(transactions)\n      .where(eq(transactions.fanId, fanId))\n      .orderBy(desc(transactions.createdAt));\n  }\n\n  async getCreatorTransactions(creatorId: string): Promise<Transaction[]> {\n    return await db\n      .select()\n      .from(transactions)\n      .where(eq(transactions.creatorId, creatorId))\n      .orderBy(desc(transactions.createdAt));\n  }\n\n  async createTransaction(transactionData: InsertTransaction): Promise<Transaction> {\n    const [transaction] = await db.insert(transactions).values(transactionData).returning();\n    return transaction;\n  }\n\n  // FanzTrust™ Refund operations\n  async findRefundRequest(transactionId: string): Promise<RefundRequest | undefined> {\n    const [refund] = await db\n      .select()\n      .from(refundRequests)\n      .where(eq(refundRequests.transactionId, transactionId))\n      .limit(1);\n    return refund;\n  }\n\n  async getRefundRequest(id: string): Promise<RefundRequest | undefined> {\n    const [refund] = await db\n      .select()\n      .from(refundRequests)\n      .where(eq(refundRequests.id, id))\n      .limit(1);\n    return refund;\n  }\n\n  async getAllRefundRequests(): Promise<RefundRequest[]> {\n    return await db\n      .select()\n      .from(refundRequests)\n      .orderBy(desc(refundRequests.createdAt));\n  }\n\n  async getFanRefundRequests(fanId: string): Promise<RefundRequest[]> {\n    return await db\n      .select()\n      .from(refundRequests)\n      .where(eq(refundRequests.fanId, fanId))\n      .orderBy(desc(refundRequests.createdAt));\n  }\n\n  async getCreatorRefundRequests(creatorId: string): Promise<RefundRequest[]> {\n    return await db\n      .select()\n      .from(refundRequests)\n      .where(eq(refundRequests.creatorId, creatorId))\n      .orderBy(desc(refundRequests.createdAt));\n  }\n\n  async createRefundRequest(requestData: InsertRefundRequest): Promise<RefundRequest> {\n    const [refund] = await db.insert(refundRequests).values(requestData).returning();\n    return refund;\n  }\n\n  async updateRefundRequest(id: string, updates: Partial<RefundRequest>): Promise<RefundRequest> {\n    const [refund] = await db\n      .update(refundRequests)\n      .set({ ...updates, updatedAt: new Date() })\n      .where(eq(refundRequests.id, id))\n      .returning();\n    return refund;\n  }\n\n  async performAutoRefundCheck(transaction: Transaction, context: any): Promise<any> {\n    // Auto-refund logic based on FanzTrust spec\n    const createdTime = transaction.createdAt ? new Date(transaction.createdAt).getTime() : Date.now();\n    const hoursSincePurchase = (Date.now() - createdTime) / (1000 * 60 * 60);\n    const sameIP = transaction.ipAddress === context.ipAddress;\n    const sameDevice = transaction.deviceFingerprint === context.deviceFingerprint;\n\n    const autoApprove = hoursSincePurchase < 1 && sameIP && sameDevice;\n\n    return {\n      autoApprove,\n      hoursSincePurchase,\n      sameIP,\n      sameDevice,\n      flags: !autoApprove ? ['manual_review_required'] : [],\n    };\n  }\n\n  // FanzTrust™ Trust Score operations\n  async getTrustScore(userId: string): Promise<TrustScore | undefined> {\n    const [score] = await db\n      .select()\n      .from(trustScores)\n      .where(eq(trustScores.userId, userId))\n      .limit(1);\n    return score;\n  }\n\n  async createTrustScore(scoreData: InsertTrustScore): Promise<TrustScore> {\n    const [score] = await db.insert(trustScores).values(scoreData).returning();\n    return score;\n  }\n\n  async updateTrustScore(userId: string, updates: Partial<TrustScore>): Promise<TrustScore> {\n    // Get current trust score\n    const current = await this.getTrustScore(userId);\n    \n    if (!current) {\n      // Create if doesn't exist\n      return await this.createTrustScore({ userId, ...updates });\n    }\n\n    // Increment counters instead of replacing\n    const incrementedUpdates: any = { ...updates, updatedAt: new Date() };\n    if (updates.refundAttempts) incrementedUpdates.refundAttempts = (current.refundAttempts || 0) + updates.refundAttempts;\n    if (updates.approvedRefunds) incrementedUpdates.approvedRefunds = (current.approvedRefunds || 0) + updates.approvedRefunds;\n    if (updates.deniedRefunds) incrementedUpdates.deniedRefunds = (current.deniedRefunds || 0) + updates.deniedRefunds;\n    \n    // Calculate new score based on metrics\n    const totalRefunds = (current.refundAttempts || 0) + (updates.refundAttempts || 0);\n    const approved = (current.approvedRefunds || 0) + (updates.approvedRefunds || 0);\n    const denied = (current.deniedRefunds || 0) + (updates.deniedRefunds || 0);\n    \n    let newScore = current.score || 100;\n    if (approved > 0) newScore += 10; // Boost for legitimate refunds\n    if (denied > 0) newScore -= 25; // Penalty for false claims\n    newScore = Math.max(0, Math.min(1000, newScore)); // Clamp 0-1000\n    \n    incrementedUpdates.score = newScore;\n\n    const [score] = await db\n      .update(trustScores)\n      .set(incrementedUpdates)\n      .where(eq(trustScores.userId, userId))\n      .returning();\n    return score;\n  }\n\n  // FanzPay Wallet operations\n  async getFanzWallet(userId: string): Promise<FanzWallet | undefined> {\n    const [wallet] = await db\n      .select()\n      .from(fanzWallets)\n      .where(eq(fanzWallets.userId, userId))\n      .limit(1);\n    return wallet;\n  }\n\n  async createFanzWallet(walletData: InsertFanzWallet): Promise<FanzWallet> {\n    const [wallet] = await db.insert(fanzWallets).values(walletData).returning();\n    return wallet;\n  }\n\n  async updateFanzWallet(userId: string, updates: Partial<FanzWallet>): Promise<FanzWallet> {\n    const [wallet] = await db\n      .update(fanzWallets)\n      .set({ ...updates, updatedAt: new Date() })\n      .where(eq(fanzWallets.userId, userId))\n      .returning();\n    return wallet;\n  }\n\n  // FanzCard operations\n  async getFanzCards(userId: string): Promise<FanzCard[]> {\n    return await db\n      .select()\n      .from(fanzCards)\n      .where(eq(fanzCards.userId, userId))\n      .orderBy(desc(fanzCards.createdAt));\n  }\n\n  async createFanzCard(cardData: InsertFanzCard): Promise<FanzCard> {\n    const [card] = await db.insert(fanzCards).values(cardData).returning();\n    return card;\n  }\n\n  // Payment Method operations\n  async getPaymentMethods(userId: string): Promise<PaymentMethod[]> {\n    return await db\n      .select()\n      .from(paymentMethods)\n      .where(eq(paymentMethods.userId, userId))\n      .orderBy(desc(paymentMethods.createdAt));\n  }\n\n  async createPaymentMethod(methodData: InsertPaymentMethod): Promise<PaymentMethod> {\n    const [method] = await db.insert(paymentMethods).values(methodData).returning();\n    return method;\n  }\n\n  // Feed operations (Infinity Scroll)\n  async getPosts(options: { page: number; limit: number; userId?: string }): Promise<Post[]> {\n    const offset = (options.page - 1) * options.limit;\n    \n    if (options.userId) {\n      // Authenticated user: get personalized feed\n      // Get user's subscribed creators\n      const userSubs = await db\n        .select({ creatorId: subscriptions.creatorId })\n        .from(subscriptions)\n        .where(and(\n          eq(subscriptions.fanId, options.userId),\n          eq(subscriptions.status, 'active')\n        ));\n      \n      const subscribedCreatorIds = userSubs.map(s => s.creatorId);\n      \n      // Get user's followed creators\n      const userFollows = await db\n        .select({ creatorId: follows.creatorId })\n        .from(follows)\n        .where(eq(follows.fanId, options.userId));\n      \n      const followedCreatorIds = userFollows.map(f => f.creatorId);\n      \n      // Combine all creator IDs\n      const relevantCreatorIds = [...new Set([...subscribedCreatorIds, ...followedCreatorIds])];\n      \n      let feedCondition;\n      if (relevantCreatorIds.length > 0) {\n        feedCondition = or(\n          // Posts from subscribed/followed creators\n          inArray(posts.creatorId, relevantCreatorIds),\n          // Free posts from age-verified creators\n          and(\n            eq(posts.isFree, true),\n            eq(posts.creatorAllowsFree, true),\n            eq(posts.creatorIsAgeVerified, true)\n          )\n        );\n      } else {\n        // No subscriptions/follows, only show free posts\n        feedCondition = and(\n          eq(posts.isFree, true),\n          eq(posts.creatorAllowsFree, true),\n          eq(posts.creatorIsAgeVerified, true)\n        );\n      }\n      \n      return await db\n        .select()\n        .from(posts)\n        .where(feedCondition)\n        .orderBy(desc(posts.createdAt))\n        .limit(options.limit)\n        .offset(offset);\n    } else {\n      // Unauthenticated user: only free posts\n      return await db\n        .select()\n        .from(posts)\n        .where(and(\n          eq(posts.isFree, true),\n          eq(posts.creatorAllowsFree, true),\n          eq(posts.creatorIsAgeVerified, true)\n        ))\n        .orderBy(desc(posts.createdAt))\n        .limit(options.limit)\n        .offset(offset);\n    }\n  }\n\n  async getPostById(id: string): Promise<Post | undefined> {\n    const [post] = await db\n      .select()\n      .from(posts)\n      .where(eq(posts.id, id))\n      .limit(1);\n    return post;\n  }\n\n  async createPost(postData: InsertPost): Promise<Post> {\n    const [post] = await db.insert(posts).values(postData).returning();\n    return post;\n  }\n\n  async updatePost(id: string, updates: Partial<Post>): Promise<Post> {\n    const [post] = await db\n      .update(posts)\n      .set({ ...updates, updatedAt: new Date() })\n      .where(eq(posts.id, id))\n      .returning();\n    return post;\n  }\n\n  // Post Like operations\n  async togglePostLike(userId: string, postId: string): Promise<{ liked: boolean }> {\n    // Check if already liked\n    const [existing] = await db\n      .select()\n      .from(postLikes)\n      .where(and(\n        eq(postLikes.userId, userId),\n        eq(postLikes.postId, postId)\n      ))\n      .limit(1);\n\n    if (existing) {\n      // Unlike\n      await db\n        .delete(postLikes)\n        .where(and(\n          eq(postLikes.userId, userId),\n          eq(postLikes.postId, postId)\n        ));\n      // Decrement like count\n      await db\n        .update(posts)\n        .set({ likeCount: sqlOperator`${posts.likeCount} - 1` })\n        .where(eq(posts.id, postId));\n      return { liked: false };\n    } else {\n      // Like\n      await db.insert(postLikes).values({ userId, postId });\n      // Increment like count\n      await db\n        .update(posts)\n        .set({ likeCount: sqlOperator`${posts.likeCount} + 1` })\n        .where(eq(posts.id, postId));\n      return { liked: true };\n    }\n  }\n\n  async isPostLikedByUser(userId: string, postId: string): Promise<boolean> {\n    const [like] = await db\n      .select()\n      .from(postLikes)\n      .where(and(\n        eq(postLikes.userId, userId),\n        eq(postLikes.postId, postId)\n      ))\n      .limit(1);\n    return !!like;\n  }\n\n  // Post Comment operations\n  async addComment(userId: string, postId: string, text: string): Promise<PostComment> {\n    const [comment] = await db\n      .insert(postComments)\n      .values({ userId, postId, text })\n      .returning();\n    // Increment comment count\n    await db\n      .update(posts)\n      .set({ commentCount: sqlOperator`${posts.commentCount} + 1` })\n      .where(eq(posts.id, postId));\n    return comment;\n  }\n\n  async getPostComments(postId: string): Promise<PostComment[]> {\n    return await db\n      .select()\n      .from(postComments)\n      .where(eq(postComments.postId, postId))\n      .orderBy(desc(postComments.createdAt));\n  }\n\n  // Follow operations\n  async followCreator(fanId: string, creatorId: string): Promise<Follow> {\n    const [follow] = await db.insert(follows).values({ fanId, creatorId }).returning();\n    return follow;\n  }\n\n  async unfollowCreator(fanId: string, creatorId: string): Promise<void> {\n    await db\n      .delete(follows)\n      .where(and(\n        eq(follows.fanId, fanId),\n        eq(follows.creatorId, creatorId)\n      ));\n  }\n\n  async getFollowing(fanId: string): Promise<Follow[]> {\n    return await db\n      .select()\n      .from(follows)\n      .where(eq(follows.fanId, fanId))\n      .orderBy(desc(follows.createdAt));\n  }\n\n  async isFollowing(fanId: string, creatorId: string): Promise<boolean> {\n    const [follow] = await db\n      .select()\n      .from(follows)\n      .where(and(\n        eq(follows.fanId, fanId),\n        eq(follows.creatorId, creatorId)\n      ))\n      .limit(1);\n    return !!follow;\n  }\n\n  // Story Moment operations\n  async getActiveStories(userId?: string): Promise<StoryMoment[]> {\n    const now = new Date();\n    return await db\n      .select()\n      .from(storyMoments)\n      .where(gt(storyMoments.expiresAt, now))\n      .orderBy(desc(storyMoments.createdAt));\n  }\n\n  async getCreatorStories(creatorId: string): Promise<StoryMoment[]> {\n    const now = new Date();\n    return await db\n      .select()\n      .from(storyMoments)\n      .where(and(\n        eq(storyMoments.creatorId, creatorId),\n        gt(storyMoments.expiresAt, now)\n      ))\n      .orderBy(desc(storyMoments.createdAt));\n  }\n\n  async createStory(storyData: InsertStoryMoment): Promise<StoryMoment> {\n    const [story] = await db.insert(storyMoments).values(storyData).returning();\n    return story;\n  }\n\n  async viewStory(storyId: string, viewerId: string): Promise<void> {\n    // Check if already viewed\n    const [existing] = await db\n      .select()\n      .from(storyViews)\n      .where(and(\n        eq(storyViews.storyId, storyId),\n        eq(storyViews.viewerId, viewerId)\n      ))\n      .limit(1);\n\n    if (!existing) {\n      await db.insert(storyViews).values({ storyId, viewerId });\n      // Increment view count using SQL increment\n      await db\n        .update(storyMoments)\n        .set({ viewCount: sqlOperator`${storyMoments.viewCount} + 1` })\n        .where(eq(storyMoments.id, storyId));\n    }\n  }\n\n  async getStoryViews(storyId: string): Promise<StoryView[]> {\n    return await db\n      .select()\n      .from(storyViews)\n      .where(eq(storyViews.storyId, storyId))\n      .orderBy(desc(storyViews.viewedAt));\n  }\n\n  async deleteExpiredStories(): Promise<void> {\n    const now = new Date();\n    await db.delete(storyMoments).where(lt(storyMoments.expiresAt, now));\n  }\n\n  // Fan Level & Gamification operations\n  async getFanLevel(userId: string): Promise<FanLevel | undefined> {\n    const [fanLevel] = await db\n      .select()\n      .from(fanLevels)\n      .where(eq(fanLevels.userId, userId))\n      .limit(1);\n    return fanLevel;\n  }\n\n  async createFanLevel(fanLevelData: InsertFanLevel): Promise<FanLevel> {\n    const [fanLevel] = await db.insert(fanLevels).values(fanLevelData).returning();\n    return fanLevel;\n  }\n\n  async updateFanLevel(userId: string, updates: Partial<FanLevel>): Promise<FanLevel> {\n    const [fanLevel] = await db\n      .update(fanLevels)\n      .set({ ...updates, updatedAt: new Date() })\n      .where(eq(fanLevels.userId, userId))\n      .returning();\n    return fanLevel;\n  }\n\n  async addXP(userId: string, xpAmount: number, reason: string): Promise<FanLevel> {\n    let fanLevel = await this.getFanLevel(userId);\n    \n    if (!fanLevel) {\n      fanLevel = await this.createFanLevel({\n        userId,\n        level: 1,\n        xp: 0,\n      });\n    }\n\n    const newXP = fanLevel.xp + xpAmount;\n    const newLevel = Math.floor(newXP / 1000) + 1; // Level up every 1000 XP\n\n    return await this.updateFanLevel(userId, {\n      xp: newXP,\n      level: newLevel,\n    });\n  }\n\n  async updateStreak(userId: string): Promise<FanLevel> {\n    let fanLevel = await this.getFanLevel(userId);\n    \n    if (!fanLevel) {\n      fanLevel = await this.createFanLevel({\n        userId,\n        level: 1,\n        xp: 0,\n        streakDays: 1,\n        lastActivityDate: new Date(),\n      });\n      return fanLevel;\n    }\n\n    const lastActivity = fanLevel.lastActivityDate;\n    const now = new Date();\n    const daysSinceLastActivity = lastActivity \n      ? Math.floor((now.getTime() - lastActivity.getTime()) / (1000 * 60 * 60 * 24))\n      : 999;\n\n    let newStreak = fanLevel.streakDays || 0;\n    if (daysSinceLastActivity === 1) {\n      // Continue streak\n      newStreak += 1;\n    } else if (daysSinceLastActivity > 1) {\n      // Streak broken\n      newStreak = 1;\n    }\n    // If daysSinceLastActivity === 0 (same day), keep same streak\n\n    return await this.updateFanLevel(userId, {\n      streakDays: newStreak,\n      lastActivityDate: now,\n    });\n  }\n\n  // Creator Analytics operations\n  async getCreatorAnalytics(creatorId: string, period: \"daily\" | \"weekly\" | \"monthly\", limit: number = 30): Promise<CreatorAnalytics[]> {\n    const analytics = await db\n      .select()\n      .from(creatorAnalytics)\n      .where(\n        and(\n          eq(creatorAnalytics.creatorId, creatorId),\n          eq(creatorAnalytics.period, period)\n        )\n      )\n      .orderBy(desc(creatorAnalytics.startDate))\n      .limit(limit);\n    \n    return analytics;\n  }\n\n  async getCurrentAnalytics(creatorId: string): Promise<any> {\n    const today = new Date();\n    today.setHours(0, 0, 0, 0);\n    \n    // Get ALL posts stats (cumulative)\n    const allPostStats = await db\n      .select({\n        totalViews: sqlOperator<number>`COALESCE(SUM(${posts.viewCount}), 0)`,\n        totalLikes: sqlOperator<number>`COALESCE(SUM(${posts.likeCount}), 0)`,\n        totalComments: sqlOperator<number>`COALESCE(SUM(${posts.commentCount}), 0)`,\n        totalPosts: sqlOperator<number>`COUNT(*)`,\n      })\n      .from(posts)\n      .where(eq(posts.creatorId, creatorId));\n    \n    // Get today's posts count\n    const todayPosts = await db\n      .select({\n        count: sqlOperator<number>`COUNT(*)`,\n      })\n      .from(posts)\n      .where(\n        and(\n          eq(posts.creatorId, creatorId),\n          gt(posts.createdAt, today)\n        )\n      );\n    \n    // Get ALL story stats (cumulative)\n    const allStoryStats = await db\n      .select({\n        totalStories: sqlOperator<number>`COUNT(*)`,\n        totalStoryViews: sqlOperator<number>`COALESCE(SUM(${storyMoments.viewCount}), 0)`,\n      })\n      .from(storyMoments)\n      .where(eq(storyMoments.creatorId, creatorId));\n    \n    // Get active stories (not expired)\n    const activeStories = await db\n      .select({\n        count: sqlOperator<number>`COUNT(*)`,\n      })\n      .from(storyMoments)\n      .where(\n        and(\n          eq(storyMoments.creatorId, creatorId),\n          gt(storyMoments.expiresAt, new Date())\n        )\n      );\n    \n    // Get subscriber count (active subscriptions)\n    const subCount = await db\n      .select({\n        count: sqlOperator<number>`COUNT(*)`,\n      })\n      .from(subscriptions)\n      .where(\n        and(\n          eq(subscriptions.creatorId, creatorId),\n          eq(subscriptions.status, \"active\")\n        )\n      );\n    \n    // Get followers count\n    const followerCount = await db\n      .select({\n        count: sqlOperator<number>`COUNT(*)`,\n      })\n      .from(follows)\n      .where(eq(follows.creatorId, creatorId));\n    \n    return {\n      overall: {\n        totalViews: allPostStats[0]?.totalViews || 0,\n        totalLikes: allPostStats[0]?.totalLikes || 0,\n        totalComments: allPostStats[0]?.totalComments || 0,\n        totalPosts: allPostStats[0]?.totalPosts || 0,\n        totalStories: allStoryStats[0]?.totalStories || 0,\n        totalStoryViews: allStoryStats[0]?.totalStoryViews || 0,\n        subscribers: subCount[0]?.count || 0,\n        followers: followerCount[0]?.count || 0,\n      },\n      today: {\n        postsCreated: todayPosts[0]?.count || 0,\n        activeStories: activeStories[0]?.count || 0,\n      },\n    };\n  }\n\n  async aggregateAnalytics(creatorId: string, period: \"daily\" | \"weekly\" | \"monthly\", startDate: Date, endDate: Date): Promise<CreatorAnalytics> {\n    // Calculate metrics for the period\n    const postStats = await db\n      .select({\n        totalViews: sqlOperator<number>`COALESCE(SUM(${posts.viewCount}), 0)`,\n        totalLikes: sqlOperator<number>`COALESCE(SUM(${posts.likeCount}), 0)`,\n        totalComments: sqlOperator<number>`COALESCE(SUM(${posts.commentCount}), 0)`,\n        postsCreated: sqlOperator<number>`COUNT(*)`,\n      })\n      .from(posts)\n      .where(\n        and(\n          eq(posts.creatorId, creatorId),\n          gt(posts.createdAt, startDate),\n          lt(posts.createdAt, endDate)\n        )\n      );\n    \n    const storyStats = await db\n      .select({\n        storiesCreated: sqlOperator<number>`COUNT(*)`,\n      })\n      .from(storyMoments)\n      .where(\n        and(\n          eq(storyMoments.creatorId, creatorId),\n          gt(storyMoments.createdAt, startDate),\n          lt(storyMoments.createdAt, endDate)\n        )\n      );\n    \n    // Create or update analytics record\n    const analyticsData: InsertCreatorAnalytics = {\n      creatorId,\n      period,\n      startDate,\n      endDate,\n      totalViews: postStats[0]?.totalViews || 0,\n      totalLikes: postStats[0]?.totalLikes || 0,\n      totalComments: postStats[0]?.totalComments || 0,\n      postsCreated: postStats[0]?.postsCreated || 0,\n      storiesCreated: storyStats[0]?.storiesCreated || 0,\n      averageEngagementRate: postStats[0]?.totalViews ? \n        ((postStats[0].totalLikes + postStats[0].totalComments) / postStats[0].totalViews) : 0,\n    };\n    \n    const [analytics] = await db\n      .insert(creatorAnalytics)\n      .values(analyticsData)\n      .returning();\n    \n    return analytics;\n  }\n\n  async recordView(postId: string, viewerId?: string): Promise<void> {\n    // Increment view count for the post\n    await db\n      .update(posts)\n      .set({\n        viewCount: sqlOperator`${posts.viewCount} + 1`,\n      })\n      .where(eq(posts.id, postId));\n  }\n\n  async recordLike(postId: string, viewerId: string): Promise<void> {\n    // Increment like count for the post\n    await db\n      .update(posts)\n      .set({\n        likeCount: sqlOperator`${posts.likeCount} + 1`,\n      })\n      .where(eq(posts.id, postId));\n  }\n\n  async recordComment(postId: string, viewerId: string): Promise<void> {\n    // Increment comment count for the post\n    await db\n      .update(posts)\n      .set({\n        commentCount: sqlOperator`${posts.commentCount} + 1`,\n      })\n      .where(eq(posts.id, postId));\n  }\n\n  // Live Streaming operations\n  async createStream(stream: InsertLiveStream): Promise<LiveStream> {\n    const [newStream] = await db.insert(liveStreams).values(stream).returning();\n    return newStream;\n  }\n\n  async getStream(streamId: string): Promise<LiveStream | undefined> {\n    const stream = await db.query.liveStreams.findFirst({\n      where: eq(liveStreams.id, streamId),\n    });\n    return stream;\n  }\n\n  async getCreatorStreams(creatorId: string, status?: \"scheduled\" | \"live\" | \"ended\" | \"archived\"): Promise<LiveStream[]> {\n    const conditions = [eq(liveStreams.creatorId, creatorId)];\n    if (status) {\n      conditions.push(eq(liveStreams.status, status));\n    }\n    \n    const streams = await db.query.liveStreams.findMany({\n      where: and(...conditions),\n      orderBy: (streams, { desc }) => [desc(streams.createdAt)],\n    });\n    return streams;\n  }\n\n  async getLiveStreams(limit = 50): Promise<LiveStream[]> {\n    const streams = await db.query.liveStreams.findMany({\n      where: eq(liveStreams.status, \"live\"),\n      orderBy: (streams, { desc }) => [desc(streams.viewerCount)],\n      limit,\n    });\n    return streams;\n  }\n\n  async updateStream(streamId: string, updates: Partial<LiveStream>): Promise<LiveStream> {\n    const [updated] = await db\n      .update(liveStreams)\n      .set({ ...updates, updatedAt: new Date() })\n      .where(eq(liveStreams.id, streamId))\n      .returning();\n    return updated;\n  }\n\n  async startStream(streamId: string): Promise<LiveStream> {\n    const [updated] = await db\n      .update(liveStreams)\n      .set({\n        status: \"live\",\n        actualStartTime: new Date(),\n        updatedAt: new Date(),\n      })\n      .where(eq(liveStreams.id, streamId))\n      .returning();\n    return updated;\n  }\n\n  async endStream(streamId: string): Promise<LiveStream> {\n    const [updated] = await db\n      .update(liveStreams)\n      .set({\n        status: \"ended\",\n        endTime: new Date(),\n        updatedAt: new Date(),\n      })\n      .where(eq(liveStreams.id, streamId))\n      .returning();\n    return updated;\n  }\n\n  async joinStream(streamId: string, viewerId: string): Promise<void> {\n    // Check if viewer is already in stream\n    const existing = await db.query.streamViewers.findFirst({\n      where: and(\n        eq(streamViewers.streamId, streamId),\n        eq(streamViewers.viewerId, viewerId),\n        eq(streamViewers.leftAt, null)\n      ),\n    });\n\n    if (!existing) {\n      await db.insert(streamViewers).values({\n        streamId,\n        viewerId,\n      });\n\n      // Increment viewer count\n      await db\n        .update(liveStreams)\n        .set({\n          viewerCount: sqlOperator`${liveStreams.viewerCount} + 1`,\n        })\n        .where(eq(liveStreams.id, streamId));\n\n      // Update peak viewers if necessary\n      const stream = await this.getStream(streamId);\n      if (stream && stream.viewerCount > stream.peakViewers) {\n        await db\n          .update(liveStreams)\n          .set({\n            peakViewers: stream.viewerCount,\n          })\n          .where(eq(liveStreams.id, streamId));\n      }\n    }\n  }\n\n  async leaveStream(streamId: string, viewerId: string): Promise<void> {\n    const viewer = await db.query.streamViewers.findFirst({\n      where: and(\n        eq(streamViewers.streamId, streamId),\n        eq(streamViewers.viewerId, viewerId),\n        eq(streamViewers.leftAt, null)\n      ),\n    });\n\n    if (viewer) {\n      const watchTime = Math.floor((Date.now() - viewer.joinedAt.getTime()) / 1000);\n      await db\n        .update(streamViewers)\n        .set({\n          leftAt: new Date(),\n          totalWatchTime: watchTime,\n        })\n        .where(eq(streamViewers.id, viewer.id));\n\n      // Decrement viewer count\n      await db\n        .update(liveStreams)\n        .set({\n          viewerCount: sqlOperator`GREATEST(0, ${liveStreams.viewerCount} - 1)`,\n        })\n        .where(eq(liveStreams.id, streamId));\n    }\n  }\n\n  async getStreamViewers(streamId: string): Promise<StreamViewer[]> {\n    const viewers = await db.query.streamViewers.findMany({\n      where: and(\n        eq(streamViewers.streamId, streamId),\n        eq(streamViewers.leftAt, null)\n      ),\n    });\n    return viewers;\n  }\n\n  async sendStreamChat(streamId: string, userId: string, message: string): Promise<StreamChat> {\n    const [chat] = await db\n      .insert(streamChat)\n      .values({\n        streamId,\n        userId,\n        message,\n      })\n      .returning();\n    return chat;\n  }\n\n  async getStreamChat(streamId: string, limit = 100): Promise<StreamChat[]> {\n    const messages = await db.query.streamChat.findMany({\n      where: and(\n        eq(streamChat.streamId, streamId),\n        eq(streamChat.isDeleted, false)\n      ),\n      orderBy: (chat, { desc }) => [desc(chat.createdAt)],\n      limit,\n    });\n    return messages.reverse(); // Return in chronological order\n  }\n\n  async sendStreamTip(tip: InsertStreamTip): Promise<StreamTip> {\n    const [newTip] = await db.insert(streamTips).values(tip).returning();\n\n    // Update stream total tips\n    await db\n      .update(liveStreams)\n      .set({\n        totalTips: sqlOperator`${liveStreams.totalTips} + ${tip.amount}`,\n      })\n      .where(eq(liveStreams.id, tip.streamId));\n\n    return newTip;\n  }\n\n  async getStreamTips(streamId: string): Promise<StreamTip[]> {\n    const tips = await db.query.streamTips.findMany({\n      where: eq(streamTips.streamId, streamId),\n      orderBy: (tips, { desc }) => [desc(tips.createdAt)],\n    });\n    return tips;\n  }\n\n  // Collaboration operations\n  async createCollaboration(collab: InsertCollaboration): Promise<Collaboration> {\n    const [collaboration] = await db.insert(collaborations).values(collab).returning();\n    return collaboration;\n  }\n\n  async respondToCollaboration(collabId: string, accept: boolean): Promise<Collaboration> {\n    const status = accept ? \"accepted\" : \"rejected\";\n    const [updated] = await db\n      .update(collaborations)\n      .set({ status, respondedAt: new Date() })\n      .where(eq(collaborations.id, collabId))\n      .returning();\n    return updated;\n  }\n\n  async getCollaborations(userId: string): Promise<Collaboration[]> {\n    const collabs = await db.query.collaborations.findMany({\n      where: or(\n        eq(collaborations.primaryCreatorId, userId),\n        eq(collaborations.collaboratorId, userId)\n      ),\n    });\n    return collabs;\n  }\n\n  // Subscription Tier operations\n  async createSubscriptionTier(tier: InsertSubscriptionTier): Promise<SubscriptionTier> {\n    const [created] = await db.insert(subscriptionTiers).values(tier).returning();\n    return created;\n  }\n\n  async getCreatorTiers(creatorId: string): Promise<SubscriptionTier[]> {\n    const tiers = await db.query.subscriptionTiers.findMany({\n      where: eq(subscriptionTiers.creatorId, creatorId),\n      orderBy: (tiers, { asc }) => [asc(tiers.sortOrder)],\n    });\n    return tiers;\n  }\n\n  async updateSubscriptionTier(tierId: string, updates: Partial<SubscriptionTier>): Promise<SubscriptionTier> {\n    const [updated] = await db\n      .update(subscriptionTiers)\n      .set(updates)\n      .where(eq(subscriptionTiers.id, tierId))\n      .returning();\n    return updated;\n  }\n\n  // Content Bundle operations\n  async createContentBundle(bundle: InsertContentBundle): Promise<ContentBundle> {\n    const [created] = await db.insert(contentBundles).values(bundle).returning();\n    return created;\n  }\n\n  async getCreatorBundles(creatorId: string): Promise<ContentBundle[]> {\n    const bundles = await db.query.contentBundles.findMany({\n      where: and(\n        eq(contentBundles.creatorId, creatorId),\n        eq(contentBundles.isActive, true)\n      ),\n    });\n    return bundles;\n  }\n\n  async purchaseBundle(bundleId: string, userId: string): Promise<{ success: boolean }> {\n    await db\n      .update(contentBundles)\n      .set({ purchaseCount: sqlOperator`${contentBundles.purchaseCount} + 1` })\n      .where(eq(contentBundles.id, bundleId));\n    return { success: true };\n  }\n\n  // Virtual Gift operations\n  async getVirtualGifts(): Promise<VirtualGift[]> {\n    const gifts = await db.query.virtualGifts.findMany({\n      where: eq(virtualGifts.isActive, true),\n    });\n    return gifts;\n  }\n\n  async sendGift(gift: InsertGiftSent): Promise<GiftSent> {\n    const [sent] = await db.insert(giftsSent).values(gift).returning();\n    return sent;\n  }\n\n  async getGiftsReceived(creatorId: string): Promise<GiftSent[]> {\n    const gifts = await db.query.giftsSent.findMany({\n      where: eq(giftsSent.toCreatorId, creatorId),\n      orderBy: (gifts, { desc }) => [desc(gifts.createdAt)],\n      limit: 100,\n    });\n    return gifts;\n  }\n\n  // Leaderboard operations\n  async updateLeaderboards(period: string): Promise<void> {\n    // Clear existing leaderboards for this period\n    await db.delete(leaderboards).where(eq(leaderboards.period, period));\n\n    // Calculate top earners\n    const topEarners = await db\n      .select({\n        userId: transactions.creatorId,\n        score: sqlOperator`SUM(${transactions.amountCents})`,\n      })\n      .from(transactions)\n      .where(\n        and(\n          eq(transactions.status, \"completed\"),\n          period === \"daily\" \n            ? gte(transactions.createdAt, new Date(Date.now() - 24 * 60 * 60 * 1000))\n            : period === \"weekly\"\n            ? gte(transactions.createdAt, new Date(Date.now() - 7 * 24 * 60 * 60 * 1000))\n            : gte(transactions.createdAt, new Date(Date.now() - 30 * 24 * 60 * 60 * 1000))\n        )\n      )\n      .groupBy(transactions.creatorId)\n      .orderBy(desc(sqlOperator`SUM(${transactions.amountCents})`))\n      .limit(100);\n\n    // Insert top earners into leaderboard\n    for (let i = 0; i < topEarners.length; i++) {\n      await db.insert(leaderboards).values({\n        userId: topEarners[i].userId!,\n        category: \"top_earners\",\n        period,\n        rank: i + 1,\n        score: Number(topEarners[i].score),\n      });\n    }\n\n    // Calculate top creators by subscriber count\n    const topCreators = await db\n      .select({\n        userId: subscriptions.creatorId,\n        score: sqlOperator`COUNT(*)`,\n      })\n      .from(subscriptions)\n      .where(eq(subscriptions.status, \"active\"))\n      .groupBy(subscriptions.creatorId)\n      .orderBy(desc(sqlOperator`COUNT(*)`))\n      .limit(100);\n\n    for (let i = 0; i < topCreators.length; i++) {\n      await db.insert(leaderboards).values({\n        userId: topCreators[i].userId,\n        category: \"top_creators\",\n        period,\n        rank: i + 1,\n        score: Number(topCreators[i].score),\n      });\n    }\n\n    logger.info(`Updated leaderboards for period: ${period}`);\n  }\n\n  async getLeaderboard(period: string, category: string, limit = 100): Promise<Leaderboard[]> {\n    const board = await db.query.leaderboards.findMany({\n      where: and(\n        eq(leaderboards.period, period),\n        eq(leaderboards.category, category)\n      ),\n      orderBy: (lb, { asc }) => [asc(lb.rank)],\n      limit,\n    });\n    return board;\n  }\n\n  // Referral operations\n  async createReferralCode(userId: string): Promise<ReferralCode> {\n    const code = `REF${userId.slice(0, 8).toUpperCase()}`;\n    const [referral] = await db\n      .insert(referralCodes)\n      .values({ userId, code })\n      .returning();\n    return referral;\n  }\n\n  async getReferralCode(userId: string): Promise<ReferralCode | undefined> {\n    const code = await db.query.referralCodes.findFirst({\n      where: eq(referralCodes.userId, userId),\n    });\n    return code;\n  }\n\n  async processReferral(code: string, newUserId: string): Promise<Referral> {\n    const referralCode = await db.query.referralCodes.findFirst({\n      where: eq(referralCodes.code, code),\n    });\n    if (!referralCode) throw new Error(\"Invalid referral code\");\n\n    // Check if user has already been referred\n    const existingReferral = await db.query.referrals.findFirst({\n      where: eq(referrals.referredUserId, newUserId),\n    });\n    if (existingReferral) throw new Error(\"User already referred\");\n\n    // Create referral record\n    const [referral] = await db\n      .insert(referrals)\n      .values({\n        referrerId: referralCode.userId,\n        referredUserId: newUserId,\n        referralCode: code,\n        commissionEarned: \"0\", // Will be updated when referred user makes purchases\n      })\n      .returning();\n\n    // Update referral code usage count\n    await db\n      .update(referralCodes)\n      .set({ \n        totalEarnings: sqlOperator`${referralCodes.totalEarnings} + 0`,\n        usageCount: sqlOperator`${referralCodes.usageCount} + 1`,\n      })\n      .where(eq(referralCodes.id, referralCode.id));\n\n    logger.info(`Processed referral: ${code} for user ${newUserId}, referrer ${referralCode.userId}`);\n    return referral;\n  }\n\n  // Process referral commission when referred user makes a purchase\n  async processReferralCommission(transactionId: string, amountCents: number): Promise<void> {\n    const transaction = await db.query.transactions.findFirst({\n      where: eq(transactions.id, transactionId),\n    });\n    if (!transaction) return;\n\n    // Check if fan was referred\n    const referral = await db.query.referrals.findFirst({\n      where: eq(referrals.referredUserId, transaction.fanId),\n    });\n    if (!referral || referral.isPaid) return;\n\n    // Calculate 5% commission\n    const commission = (amountCents * 0.05) / 100; // Convert to decimal dollars\n\n    // Update referral commission\n    await db\n      .update(referrals)\n      .set({\n        commissionEarned: sqlOperator`${referrals.commissionEarned} + ${commission}`,\n      })\n      .where(eq(referrals.id, referral.id));\n\n    // Update referral code total earnings\n    const referralCode = await db.query.referralCodes.findFirst({\n      where: eq(referralCodes.code, referral.referralCode),\n    });\n    if (referralCode) {\n      await db\n        .update(referralCodes)\n        .set({\n          totalEarnings: sqlOperator`${referralCodes.totalEarnings} + ${commission}`,\n        })\n        .where(eq(referralCodes.id, referralCode.id));\n    }\n\n    logger.info(`Processed referral commission: $${commission.toFixed(2)} for referral ${referral.id}`);\n  }\n\n  // Scheduled Post operations\n  async createScheduledPost(post: InsertScheduledPost): Promise<ScheduledPost> {\n    const [scheduled] = await db.insert(scheduledPosts).values(post).returning();\n    return scheduled;\n  }\n\n  async getScheduledPosts(creatorId: string): Promise<ScheduledPost[]> {\n    const posts = await db.query.scheduledPosts.findMany({\n      where: and(\n        eq(scheduledPosts.creatorId, creatorId),\n        eq(scheduledPosts.isPublished, false)\n      ),\n      orderBy: (posts, { asc }) => [asc(posts.scheduledFor)],\n    });\n    return posts;\n  }\n\n  async publishScheduledPosts(): Promise<void> {\n    // Find all scheduled posts that are ready to be published\n    const now = new Date();\n    const readyPosts = await db.query.scheduledPosts.findMany({\n      where: and(\n        eq(scheduledPosts.isPublished, false),\n        lte(scheduledPosts.scheduledFor, now)\n      ),\n    });\n\n    logger.info(`Publishing ${readyPosts.length} scheduled posts`);\n\n    for (const scheduledPost of readyPosts) {\n      try {\n        // Create the actual post with media asset if needed\n        let mediaIds: string[] | undefined;\n        \n        if (scheduledPost.mediaUrl && scheduledPost.mediaType) {\n          // Create media asset from scheduled media\n          const [mediaAsset] = await db.insert(mediaAssets).values({\n            ownerId: scheduledPost.creatorId,\n            s3Key: scheduledPost.mediaUrl,\n            mimeType: scheduledPost.mediaType,\n            status: \"approved\",\n          }).returning();\n          mediaIds = [mediaAsset.id];\n        }\n\n        // Create the actual post  \n        const [newPost] = await db.insert(posts).values({\n          creatorId: scheduledPost.creatorId,\n          content: scheduledPost.text || \"\",\n          ...(mediaIds && { mediaIds }),\n        }).returning();\n\n        // Mark as published\n        await db\n          .update(scheduledPosts)\n          .set({ \n            isPublished: true,\n            publishedPostId: newPost.id,\n          })\n          .where(eq(scheduledPosts.id, scheduledPost.id));\n\n        logger.info(`Published scheduled post ${scheduledPost.id} as post ${newPost.id}`);\n      } catch (error) {\n        logger.error(`Failed to publish scheduled post ${scheduledPost.id}`, { error });\n      }\n    }\n  }\n\n  // Creator Badge operations\n  async assignBadge(userId: string, badgeType: string): Promise<CreatorBadge> {\n    const [badge] = await db\n      .insert(creatorBadges)\n      .values({ userId, badgeType })\n      .returning();\n    return badge;\n  }\n\n  async getUserBadges(userId: string): Promise<CreatorBadge[]> {\n    const badges = await db.query.creatorBadges.findMany({\n      where: and(\n        eq(creatorBadges.userId, userId),\n        eq(creatorBadges.isActive, true)\n      ),\n    });\n    return badges;\n  }\n\n  // Geo-blocking operations\n  async createGeoBlockingRule(rule: InsertGeoBlockingRule): Promise<GeoBlockingRule> {\n    const [created] = await db.insert(geoBlockingRules).values(rule).returning();\n    return created;\n  }\n\n  async getGeoBlockingRules(creatorId: string): Promise<GeoBlockingRule[]> {\n    const rules = await db.query.geoBlockingRules.findMany({\n      where: eq(geoBlockingRules.creatorId, creatorId),\n    });\n    return rules;\n  }\n\n  async checkGeoAccess(creatorId: string, countryCode: string): Promise<boolean> {\n    const rules = await this.getGeoBlockingRules(creatorId);\n    if (rules.length === 0) return true;\n\n    for (const rule of rules) {\n      if (rule.isActive) {\n        const blocked = (rule.blockedCountries as any[]) || [];\n        if (blocked.includes(countryCode)) return false;\n      }\n    }\n    return true;\n  }\n\n  // Search & Tag operations\n  async searchContent(query: any): Promise<any[]> {\n    // Placeholder - would use full-text search\n    return [];\n  }\n\n  async addTagsToPost(postId: string, tagIds: string[]): Promise<void> {\n    const values = tagIds.map(tagId => ({ postId, tagId }));\n    await db.insert(postTags).values(values);\n  }\n\n  // DMCA operations\n  async createDmcaClaim(claim: InsertDmcaClaim): Promise<DmcaClaim> {\n    const [created] = await db.insert(dmcaClaims).values(claim).returning();\n    return created;\n  }\n\n  async getDmcaClaims(status?: string): Promise<DmcaClaim[]> {\n    const where = status ? eq(dmcaClaims.status, status) : undefined;\n    const claims = await db.query.dmcaClaims.findMany({\n      where,\n      orderBy: (claims, { desc }) => [desc(claims.createdAt)],\n    });\n    return claims;\n  }\n\n  async reviewDmcaClaim(claimId: string, approved: boolean, reviewerId: string): Promise<DmcaClaim> {\n    const status = approved ? \"approved\" : \"rejected\";\n    const [updated] = await db\n      .update(dmcaClaims)\n      .set({\n        status,\n        reviewedBy: reviewerId,\n        reviewedAt: new Date(),\n      })\n      .where(eq(dmcaClaims.id, claimId))\n      .returning();\n    return updated;\n  }\n\n  // Onboarding operations\n  async getOnboardingProgress(userId: string): Promise<OnboardingProgress | undefined> {\n    const progress = await db.query.onboardingProgress.findFirst({\n      where: eq(onboardingProgress.userId, userId),\n    });\n    return progress;\n  }\n\n  async createOnboardingProgress(userId: string): Promise<OnboardingProgress> {\n    const [progress] = await db\n      .insert(onboardingProgress)\n      .values({ userId })\n      .returning();\n    return progress;\n  }\n\n  async updateOnboardingProgress(userId: string, updates: Partial<OnboardingProgress>): Promise<OnboardingProgress> {\n    const [updated] = await db\n      .update(onboardingProgress)\n      .set({ ...updates, updatedAt: new Date() })\n      .where(eq(onboardingProgress.userId, userId))\n      .returning();\n    return updated;\n  }\n\n  // Content Niche operations\n  async getContentNiches(): Promise<ContentNiche[]> {\n    const niches = await db.query.contentNiches.findMany({\n      where: eq(contentNiches.isActive, true),\n      orderBy: (niches, { asc }) => [asc(niches.name)],\n    });\n    return niches;\n  }\n\n  async createContentNiche(niche: InsertContentNiche): Promise<ContentNiche> {\n    const [created] = await db.insert(contentNiches).values(niche).returning();\n    return created;\n  }\n\n  // User Interest operations\n  async getUserInterests(userId: string): Promise<UserInterest[]> {\n    const interests = await db.query.userInterests.findMany({\n      where: eq(userInterests.userId, userId),\n    });\n    return interests;\n  }\n\n  async setUserInterests(userId: string, nicheIds: string[]): Promise<void> {\n    // Delete existing interests\n    await db.delete(userInterests).where(eq(userInterests.userId, userId));\n    \n    // Insert new interests\n    if (nicheIds.length > 0) {\n      const values = nicheIds.map(nicheId => ({ userId, nicheId }));\n      await db.insert(userInterests).values(values);\n    }\n  }\n\n  // Profile operations\n  async updateProfile(userId: string, updates: Partial<Profile>): Promise<Profile> {\n    const [updated] = await db\n      .update(profiles)\n      .set({ ...updates, updatedAt: new Date() })\n      .where(eq(profiles.userId, userId))\n      .returning();\n    return updated;\n  }\n\n  // NFT operations\n  async deployNftContract(contract: InsertNftContract): Promise<any> {\n    const [deployed] = await db.insert(nftContracts).values(contract).returning();\n    return deployed;\n  }\n\n  async getNftContractsByCreator(creatorId: string): Promise<any[]> {\n    const contracts = await db.query.nftContracts.findMany({\n      where: eq(nftContracts.creatorId, creatorId),\n      orderBy: (contracts, { desc }) => [desc(contracts.createdAt)],\n    });\n    return contracts;\n  }\n\n  async mintNft(mint: any, creatorId: string): Promise<any> {\n    // Verify the creator owns the contract\n    const contract = await db.query.nftContracts.findFirst({\n      where: eq(nftContracts.id, mint.contractId),\n    });\n    \n    if (!contract) {\n      throw new Error(\"NFT contract not found\");\n    }\n    \n    if (contract.creatorId !== creatorId) {\n      throw new Error(\"Unauthorized: You can only mint NFTs on your own contracts\");\n    }\n    \n    const [minted] = await db.insert(nftMints).values(mint).returning();\n    return minted;\n  }\n\n  async getNftMintsByContract(contractId: string, userId: string): Promise<any[]> {\n    // Get the contract to verify ownership\n    const contract = await db.query.nftContracts.findFirst({\n      where: eq(nftContracts.id, contractId),\n    });\n    \n    if (!contract) {\n      throw new Error(\"NFT contract not found\");\n    }\n    \n    if (contract.creatorId !== userId) {\n      throw new Error(\"Unauthorized: You can only view mints for your own NFT contracts\");\n    }\n    \n    const mints = await db.query.nftMints.findMany({\n      where: eq(nftMints.contractId, contractId),\n      orderBy: (mints, { desc }) => [desc(mints.createdAt)],\n    });\n    return mints;\n  }\n\n  async recordNftRoyalty(royalty: any, creatorId: string): Promise<any> {\n    // Verify the creator owns the contract\n    const contract = await db.query.nftContracts.findFirst({\n      where: eq(nftContracts.id, royalty.contractId),\n    });\n    \n    if (!contract) {\n      throw new Error(\"NFT contract not found\");\n    }\n    \n    if (contract.creatorId !== creatorId) {\n      throw new Error(\"Unauthorized: You can only record royalties for your own NFT contracts\");\n    }\n    \n    const [recorded] = await db.insert(onchainRoyalties).values(royalty).returning();\n    return recorded;\n  }\n\n  async getNftRoyaltiesByCreator(creatorId: string): Promise<any[]> {\n    const royalties = await db.query.onchainRoyalties.findMany({\n      where: eq(onchainRoyalties.creatorId, creatorId),\n      orderBy: (royalties, { desc }) => [desc(royalties.createdAt)],\n    });\n    return royalties;\n  }\n\n  async getNftRoyaltyStats(creatorId: string): Promise<any> {\n    const royalties = await this.getNftRoyaltiesByCreator(creatorId);\n    const totalRoyalties = royalties.reduce((sum, r) => sum + (parseFloat(r.royaltyAmount || '0')), 0);\n    const totalSales = royalties.length;\n    return {\n      totalRoyalties,\n      totalSales,\n      averageRoyalty: totalSales > 0 ? totalRoyalties / totalSales : 0,\n      recentRoyalties: royalties.slice(0, 10),\n    };\n  }\n\n  async getMarketplaceNfts(): Promise<any[]> {\n    const nfts = await db.query.nftMints.findMany({\n      where: eq(nftMints.status, \"minted\"),\n      columns: {\n        id: true,\n        tokenId: true,\n        tokenUri: true,\n        status: true,\n        mintPrice: true,\n        mintPriceUsd: true,\n        txHash: true,\n        mintedAt: true,\n        createdAt: true,\n        ownerId: true,\n      },\n      with: {\n        creator: {\n          columns: {\n            id: true,\n            username: true,\n            displayName: true,\n          },\n        },\n        media: {\n          columns: {\n            id: true,\n            title: true,\n            description: true,\n            thumbnailUrl: true,\n            mediaUrl: true,\n            mediaType: true,\n          },\n        },\n        contract: {\n          columns: {\n            id: true,\n            blockchain: true,\n            contractAddress: true,\n            royaltyPercentage: true,\n          },\n        },\n      },\n      orderBy: (mints, { desc }) => [desc(mints.mintedAt)],\n    });\n    \n    // Convert Decimal fields to strings for JSON serialization\n    return nfts.map(nft => ({\n      ...nft,\n      mintPrice: nft.mintPrice?.toString() || \"0\",\n      mintPriceUsd: nft.mintPriceUsd?.toString() || \"0.00\",\n    }));\n  }\n\n  async getNftMintById(nftId: string): Promise<any> {\n    const nft = await db.query.nftMints.findFirst({\n      where: eq(nftMints.id, nftId),\n    });\n    return nft;\n  }\n\n  async purchaseNft(nftId: string, buyerId: string): Promise<any> {\n    // Atomic conditional update - only succeeds if ownerId is null\n    const [purchased] = await db\n      .update(nftMints)\n      .set({ ownerId: buyerId })\n      .where(and(eq(nftMints.id, nftId), sqlOperator`owner_id IS NULL`))\n      .returning();\n    \n    if (!purchased) {\n      throw new Error(\"NFT already sold\");\n    }\n    \n    return purchased;\n  }\n\n  // Loan operations\n  async createLoanProgram(program: any): Promise<any> {\n    const [created] = await db.insert(loanPrograms).values(program).returning();\n    return created;\n  }\n\n  async getLoanPrograms(): Promise<any[]> {\n    const programs = await db.query.loanPrograms.findMany({\n      where: eq(loanPrograms.isActive, true),\n      orderBy: (programs, { asc }) => [asc(programs.name)],\n    });\n    return programs;\n  }\n\n  async createLoanApplication(application: any): Promise<any> {\n    const [created] = await db.insert(loanApplications).values(application).returning();\n    return created;\n  }\n\n  async getLoanApplicationsByCreator(creatorId: string): Promise<any[]> {\n    const applications = await db.query.loanApplications.findMany({\n      where: eq(loanApplications.creatorId, creatorId),\n      orderBy: (apps, { desc }) => [desc(apps.createdAt)],\n    });\n    return applications;\n  }\n\n  async createLoanOffer(offer: any): Promise<any> {\n    const [created] = await db.insert(loanOffers).values(offer).returning();\n    return created;\n  }\n\n  async getLoanOffersByLender(lenderId: string): Promise<any[]> {\n    const offers = await db.query.loanOffers.findMany({\n      where: eq(loanOffers.lenderId, lenderId),\n      orderBy: (offers, { desc }) => [desc(offers.createdAt)],\n    });\n    return offers;\n  }\n\n  async acceptLoanOffer(offerId: string, creatorId: string): Promise<any> {\n    // First get the loan offer to verify it exists and get the application\n    const offer = await db.query.loanOffers.findFirst({\n      where: eq(loanOffers.id, offerId),\n    });\n    \n    if (!offer) {\n      throw new Error(\"Loan offer not found\");\n    }\n    \n    // Get the application to verify creator ownership\n    const application = await db.query.loanApplications.findFirst({\n      where: eq(loanApplications.id, offer.applicationId),\n    });\n    \n    if (!application) {\n      throw new Error(\"Loan application not found\");\n    }\n    \n    if (application.creatorId !== creatorId) {\n      throw new Error(\"Unauthorized: You can only accept offers for your own loan applications\");\n    }\n    \n    const [updated] = await db\n      .update(loanOffers)\n      .set({ status: 'approved', approvedAt: new Date() })\n      .where(eq(loanOffers.id, offerId))\n      .returning();\n      \n    if (!updated) {\n      throw new Error(\"Failed to accept loan offer\");\n    }\n    \n    return updated;\n  }\n\n  async getLoanRepaymentsByOffer(offerId: string, userId: string): Promise<any[]> {\n    // Get the offer to verify ownership\n    const offer = await db.query.loanOffers.findFirst({\n      where: eq(loanOffers.id, offerId),\n    });\n    \n    if (!offer) {\n      throw new Error(\"Loan offer not found\");\n    }\n    \n    // Get the application to verify creator ownership\n    const application = await db.query.loanApplications.findFirst({\n      where: eq(loanApplications.id, offer.applicationId),\n    });\n    \n    if (!application) {\n      throw new Error(\"Loan application not found\");\n    }\n    \n    // Verify user is either the creator (borrower) or the lender\n    if (application.creatorId !== userId && offer.lenderId !== userId) {\n      throw new Error(\"Unauthorized: You can only view repayments for your own loans\");\n    }\n    \n    const repayments = await db.query.loanRepayments.findMany({\n      where: eq(loanRepayments.offerId, offerId),\n      orderBy: (repayments, { asc }) => [asc(repayments.dueDate)],\n    });\n    return repayments;\n  }\n\n  async payLoanRepayment(repaymentId: string, amount: number, creatorId: string): Promise<any> {\n    // First get the repayment to verify it exists and get the offer\n    const repayment = await db.query.loanRepayments.findFirst({\n      where: eq(loanRepayments.id, repaymentId),\n    });\n    \n    if (!repayment) {\n      throw new Error(\"Loan repayment not found\");\n    }\n    \n    // Get the offer to get the application\n    const offer = await db.query.loanOffers.findFirst({\n      where: eq(loanOffers.id, repayment.offerId),\n    });\n    \n    if (!offer) {\n      throw new Error(\"Loan offer not found\");\n    }\n    \n    // Get the application to verify creator ownership\n    const application = await db.query.loanApplications.findFirst({\n      where: eq(loanApplications.id, offer.applicationId),\n    });\n    \n    if (!application) {\n      throw new Error(\"Loan application not found\");\n    }\n    \n    if (application.creatorId !== creatorId) {\n      throw new Error(\"Unauthorized: You can only pay your own loan repayments\");\n    }\n    \n    const [updated] = await db\n      .update(loanRepayments)\n      .set({ \n        status: 'paid', \n        paidAt: new Date(),\n        paidAmount: amount\n      })\n      .where(eq(loanRepayments.id, repaymentId))\n      .returning();\n      \n    if (!updated) {\n      throw new Error(\"Failed to pay loan repayment\");\n    }\n    \n    return updated;\n  }\n\n  // AI Moderation operations\n  async createAiScanJob(job: any): Promise<any> {\n    const [created] = await db.insert(aiScanJobs).values(job).returning();\n    return created;\n  }\n\n  async getAiScanJobsByMedia(mediaId: string, userId: string): Promise<any[]> {\n    // Verify media ownership by checking if user owns the media asset\n    const media = await db.query.mediaAssets.findFirst({\n      where: eq(mediaAssets.id, mediaId),\n    });\n    \n    if (!media) {\n      throw new Error(\"Media asset not found\");\n    }\n    \n    if (media.userId !== userId) {\n      throw new Error(\"Unauthorized: You can only view scan jobs for your own media\");\n    }\n    \n    const jobs = await db.query.aiScanJobs.findMany({\n      where: eq(aiScanJobs.mediaId, mediaId),\n      orderBy: (jobs, { desc }) => [desc(jobs.queuedAt)],\n    });\n    return jobs;\n  }\n\n  async getAiScanQueue(): Promise<any[]> {\n    const queue = await db.query.aiScanJobs.findMany({\n      where: or(eq(aiScanJobs.status, 'queued'), eq(aiScanJobs.status, 'processing')),\n      orderBy: (jobs, { desc, asc }) => [desc(jobs.priority), asc(jobs.queuedAt)],\n      limit: 100,\n    });\n    return queue;\n  }\n\n  async getAiScanResults(jobId: string, userId: string): Promise<any> {\n    // Get the job to find the mediaId\n    const job = await db.query.aiScanJobs.findFirst({\n      where: eq(aiScanJobs.id, jobId),\n    });\n    \n    if (!job) {\n      throw new Error(\"Scan job not found\");\n    }\n    \n    // Verify media ownership\n    const media = await db.query.mediaAssets.findFirst({\n      where: eq(mediaAssets.id, job.mediaId),\n    });\n    \n    if (!media) {\n      throw new Error(\"Media asset not found\");\n    }\n    \n    if (media.userId !== userId) {\n      throw new Error(\"Unauthorized: You can only view scan results for your own media\");\n    }\n    \n    const result = await db.query.aiScanResults.findFirst({\n      where: eq(aiScanResults.scanJobId, jobId),\n    });\n    return result;\n  }\n\n  async createContentFingerprint(fingerprint: any): Promise<any> {\n    const [created] = await db.insert(contentFingerprints).values(fingerprint).returning();\n    return created;\n  }\n\n  async getContentFingerprint(mediaId: string, userId: string): Promise<any> {\n    // Verify media ownership\n    const media = await db.query.mediaAssets.findFirst({\n      where: eq(mediaAssets.id, mediaId),\n    });\n    \n    if (!media) {\n      throw new Error(\"Media asset not found\");\n    }\n    \n    if (media.userId !== userId) {\n      throw new Error(\"Unauthorized: You can only view fingerprints for your own media\");\n    }\n    \n    const fingerprint = await db.query.contentFingerprints.findFirst({\n      where: eq(contentFingerprints.mediaId, mediaId),\n    });\n    return fingerprint;\n  }\n\n  async getAiScanResultsByMedia(mediaId: string, userId: string): Promise<any[]> {\n    // Verify media ownership\n    const media = await db.query.mediaAssets.findFirst({\n      where: eq(mediaAssets.id, mediaId),\n    });\n    \n    if (!media) {\n      throw new Error(\"Media asset not found\");\n    }\n    \n    if (media.userId !== userId) {\n      throw new Error(\"Unauthorized: You can only view scan results for your own media\");\n    }\n    \n    // Get all scan jobs for this media\n    const jobs = await db.query.aiScanJobs.findMany({\n      where: eq(aiScanJobs.mediaId, mediaId),\n    });\n    \n    if (jobs.length === 0) {\n      return [];\n    }\n    \n    // Get results for all jobs\n    const jobIds = jobs.map(job => job.id);\n    const results = await db.query.aiScanResults.findMany({\n      where: inArray(aiScanResults.scanJobId, jobIds),\n    });\n    \n    return results;\n  }\n\n  async reviewAiScanResult(id: string, review: any, userId: string): Promise<any> {\n    // Get the result to find the job and media\n    const result = await db.query.aiScanResults.findFirst({\n      where: eq(aiScanResults.id, id),\n    });\n    \n    if (!result) {\n      throw new Error(\"Scan result not found\");\n    }\n    \n    // Get the job to find the media\n    const job = await db.query.aiScanJobs.findFirst({\n      where: eq(aiScanJobs.id, result.scanJobId),\n    });\n    \n    if (!job) {\n      throw new Error(\"Scan job not found\");\n    }\n    \n    // Verify media ownership\n    const media = await db.query.mediaAssets.findFirst({\n      where: eq(mediaAssets.id, job.mediaId),\n    });\n    \n    if (!media) {\n      throw new Error(\"Media asset not found\");\n    }\n    \n    if (media.userId !== userId) {\n      throw new Error(\"Unauthorized: You can only review scan results for your own media\");\n    }\n    \n    // Update the result with review data\n    const [updated] = await db.update(aiScanResults)\n      .set({\n        humanReviewStatus: review.humanReviewStatus,\n        humanReviewNotes: review.reviewNotes,\n        humanReviewedAt: new Date(),\n      })\n      .where(eq(aiScanResults.id, id))\n      .returning();\n    \n    return updated;\n  }\n\n  async verifyContentFingerprint(id: string, verification: any, userId: string): Promise<any> {\n    // Get the fingerprint to find the media\n    const fingerprint = await db.query.contentFingerprints.findFirst({\n      where: eq(contentFingerprints.id, id),\n    });\n    \n    if (!fingerprint) {\n      throw new Error(\"Content fingerprint not found\");\n    }\n    \n    // Verify media ownership\n    const media = await db.query.mediaAssets.findFirst({\n      where: eq(mediaAssets.id, fingerprint.mediaId),\n    });\n    \n    if (!media) {\n      throw new Error(\"Media asset not found\");\n    }\n    \n    if (media.userId !== userId) {\n      throw new Error(\"Unauthorized: You can only verify fingerprints for your own media\");\n    }\n    \n    // Update the fingerprint with verification data\n    const [updated] = await db.update(contentFingerprints)\n      .set({\n        verificationStatus: verification.isVerified ? 'verified' : 'unverified',\n        verificationNotes: verification.verificationNotes,\n        verifiedAt: verification.isVerified ? new Date() : null,\n      })\n      .where(eq(contentFingerprints.id, id))\n      .returning();\n    \n    return updated;\n  }\n}\n\nexport const storage = new DatabaseStorage();\n","size_bytes":84757},"client/src/components/ui/collapsible.tsx":{"content":"\"use client\"\n\nimport * as CollapsiblePrimitive from \"@radix-ui/react-collapsible\"\n\nconst Collapsible = CollapsiblePrimitive.Root\n\nconst CollapsibleTrigger = CollapsiblePrimitive.CollapsibleTrigger\n\nconst CollapsibleContent = CollapsiblePrimitive.CollapsibleContent\n\nexport { Collapsible, CollapsibleTrigger, CollapsibleContent }\n","size_bytes":329},"server/services/objectStorage.ts":{"content":"import fs from 'fs/promises';\nimport path from 'path';\nimport { nanoid } from 'nanoid';\nimport { logger } from '../logger';\n\nexport interface UploadResult {\n  key: string;\n  url: string;\n  size: number;\n  mimeType: string;\n}\n\nexport class ObjectStorageService {\n  private bucketId: string;\n  private publicDir: string;\n  private privateDir: string;\n\n  constructor() {\n    this.bucketId = process.env.DEFAULT_OBJECT_STORAGE_BUCKET_ID || '';\n    this.publicDir = process.env.PUBLIC_OBJECT_SEARCH_PATHS?.split(',')[0] || '';\n    this.privateDir = process.env.PRIVATE_OBJECT_DIR || '';\n    \n    logger.info('Object storage configuration loaded', {\n      bucketId: this.bucketId ? '***configured***' : 'missing',\n      publicDir: this.publicDir ? '***configured***' : 'missing', \n      privateDir: this.privateDir ? '***configured***' : 'missing'\n    });\n    \n    if (!this.bucketId || !this.publicDir || !this.privateDir) {\n      logger.warn('Object storage environment variables not fully configured', {\n        bucketId: !!this.bucketId,\n        publicDir: !!this.publicDir,\n        privateDir: !!this.privateDir\n      });\n    }\n  }\n\n  /**\n   * Upload a file to public storage (accessible via URL)\n   */\n  async uploadPublicFile(\n    fileBuffer: Buffer,\n    filename: string,\n    mimeType: string,\n    userId: string\n  ): Promise<UploadResult> {\n    const fileExtension = path.extname(filename);\n    const uniqueId = nanoid();\n    const key = `media/${userId}/${uniqueId}${fileExtension}`;\n    const fullPath = path.join(this.publicDir, key);\n\n    try {\n      // Ensure directory exists\n      await fs.mkdir(path.dirname(fullPath), { recursive: true });\n      \n      // Write file to object storage\n      await fs.writeFile(fullPath, fileBuffer);\n\n      // Generate public URL\n      const url = `/public/${key}`;\n\n      logger.info(`File uploaded successfully`, {\n        key,\n        url,\n        size: fileBuffer.length,\n        mimeType,\n        userId\n      });\n\n      return {\n        key,\n        url,\n        size: fileBuffer.length,\n        mimeType\n      };\n    } catch (error) {\n      logger.error('Failed to upload file to public storage', { error, key, userId });\n      throw new Error('File upload failed');\n    }\n  }\n\n  /**\n   * Upload a file to private storage (requires authentication)\n   */\n  async uploadPrivateFile(\n    fileBuffer: Buffer,\n    filename: string,\n    mimeType: string,\n    userId: string\n  ): Promise<UploadResult> {\n    const fileExtension = path.extname(filename);\n    const uniqueId = nanoid();\n    const key = `media/${userId}/${uniqueId}${fileExtension}`;\n    const fullPath = path.join(this.privateDir, key);\n\n    try {\n      // Log the attempted path for debugging\n      logger.info('Attempting to write file to private storage', { \n        fullPath,\n        key,\n        userId,\n        privateDir: this.privateDir \n      });\n      \n      // Ensure directory exists\n      await fs.mkdir(path.dirname(fullPath), { recursive: true });\n      \n      // Write file to private object storage\n      await fs.writeFile(fullPath, fileBuffer);\n\n      // Private files use API endpoint for access control\n      const url = `/api/media/file/${key}`;\n\n      logger.info(`Private file uploaded successfully`, {\n        key,\n        url,\n        size: fileBuffer.length,\n        mimeType,\n        userId\n      });\n\n      return {\n        key,\n        url,\n        size: fileBuffer.length,\n        mimeType\n      };\n    } catch (error) {\n      logger.error('Failed to upload file to private storage', { error, key, userId });\n      throw new Error('File upload failed');\n    }\n  }\n\n  /**\n   * Get a private file (with access control)\n   */\n  async getPrivateFile(key: string): Promise<Buffer | null> {\n    const fullPath = path.join(this.privateDir, key);\n    \n    try {\n      const fileBuffer = await fs.readFile(fullPath);\n      return fileBuffer;\n    } catch (error) {\n      if ((error as any).code === 'ENOENT') {\n        return null;\n      }\n      logger.error('Failed to read private file', { error, key });\n      throw error;\n    }\n  }\n\n  /**\n   * Delete a file from storage\n   */\n  async deleteFile(key: string, isPrivate: boolean = true): Promise<void> {\n    const baseDir = isPrivate ? this.privateDir : this.publicDir;\n    const fullPath = path.join(baseDir, key);\n    \n    try {\n      await fs.unlink(fullPath);\n      logger.info('File deleted successfully', { key, isPrivate });\n    } catch (error) {\n      if ((error as any).code !== 'ENOENT') {\n        logger.error('Failed to delete file', { error, key, isPrivate });\n        throw error;\n      }\n    }\n  }\n\n  /**\n   * Check if object storage is properly configured\n   */\n  isConfigured(): boolean {\n    const configured = !!(this.bucketId && this.publicDir && this.privateDir);\n    logger.info('Object storage configuration check', {\n      configured,\n      bucketId: !!this.bucketId,\n      publicDir: !!this.publicDir,\n      privateDir: !!this.privateDir\n    });\n    return configured;\n  }\n}\n\nexport const objectStorageService = new ObjectStorageService();","size_bytes":5048},"server/logger.ts":{"content":"import pino from \"pino\";\n\nconst level = process.env.NODE_ENV === \"production\" ? \"info\" : \"debug\";\n\nexport const logger = pino({\n  level,\n  transport: process.env.NODE_ENV !== \"production\" ? {\n    target: \"pino-pretty\",\n    options: {\n      colorize: true,\n      ignore: \"pid,hostname\",\n      translateTime: \"SYS:standard\",\n    },\n  } : undefined,\n  formatters: {\n    level: (label) => {\n      return { level: label };\n    },\n  },\n  serializers: {\n    req: pino.stdSerializers.req,\n    res: pino.stdSerializers.res,\n    err: pino.stdSerializers.err,\n  },\n});\n\nexport interface LogContext {\n  userId?: string;\n  requestId?: string;\n  action?: string;\n  target?: string;\n  metadata?: Record<string, any>;\n}\n\nexport const createLogger = (context: LogContext = {}) => {\n  return logger.child(context);\n};\n\n// Audit logging for compliance\nexport const auditLogger = {\n  log: async (context: {\n    actorId?: string;\n    action: string;\n    targetType: string;\n    targetId: string;\n    metadata?: Record<string, any>;\n    req?: any;\n  }) => {\n    const { req, ...logData } = context;\n    \n    // Log to audit system\n    logger.info({\n      type: \"audit\",\n      ...logData,\n      ipAddress: req?.ip,\n      userAgent: req?.get(\"user-agent\"),\n      timestamp: new Date().toISOString(),\n    }, \"Audit log\");\n\n    // Store in audit_logs table via storage\n    try {\n      const { storage } = await import(\"./storage\");\n      await storage.createAuditLog({\n        ...logData,\n        ipAddress: req?.ip,\n        userAgent: req?.get(\"user-agent\"),\n      });\n    } catch (error) {\n      logger.error({ error }, \"Failed to save audit log to database\");\n    }\n  },\n};\n","size_bytes":1651},"server/services/paymentService.ts":{"content":"import { logger } from \"../logger\";\nimport { storage } from \"../storage\";\nimport crypto from \"crypto\";\n\ninterface PaymentGateway {\n  name: string;\n  region: string[];\n  processor: \"ccbill\" | \"segpay\" | \"epoch\" | \"vendo\" | \"verotel\";\n  isAdultFriendly: boolean;\n}\n\ninterface PaymentResult {\n  success: boolean;\n  transactionId?: string;\n  error?: string;\n  redirectUrl?: string;\n}\n\ninterface PayoutResult {\n  success: boolean;\n  payoutId?: string;\n  error?: string;\n  estimatedArrival?: string;\n}\n\nclass AdultFriendlyPaymentService {\n  private gateways: PaymentGateway[] = [\n    { name: \"CCBill\", region: [\"US\", \"CA\"], processor: \"ccbill\", isAdultFriendly: true },\n    { name: \"Segpay\", region: [\"GLOBAL\"], processor: \"segpay\", isAdultFriendly: true },\n    { name: \"Epoch\", region: [\"EU\", \"UK\"], processor: \"epoch\", isAdultFriendly: true },\n    { name: \"Vendo\", region: [\"LATAM\", \"BR\"], processor: \"vendo\", isAdultFriendly: true },\n    { name: \"Verotel\", region: [\"EU\"], processor: \"verotel\", isAdultFriendly: true },\n  ];\n\n  constructor() {\n    this.validateConfiguration();\n  }\n\n  private validateConfiguration() {\n    // Ensure no banned processors are configured\n    const bannedProcessors = [\"stripe\", \"paypal\", \"square\"];\n    const configuredProcessor = process.env.PAYMENTS_PROCESSOR?.toLowerCase();\n    \n    if (configuredProcessor && bannedProcessors.includes(configuredProcessor)) {\n      throw new Error(`CRITICAL: ${configuredProcessor} is banned for adult content. Use adult-friendly processors only.`);\n    }\n\n    logger.info(\"Payment service initialized with adult-friendly processors\", {\n      availableGateways: this.gateways.map(g => g.name),\n      primaryProcessor: process.env.PAYMENTS_PROCESSOR || \"CCBill\",\n    });\n  }\n\n  selectGateway(region: string, amount: number): PaymentGateway {\n    // Regional routing logic\n    const regionMap: Record<string, string> = {\n      \"US\": \"ccbill\",\n      \"CA\": \"ccbill\", \n      \"EU\": \"epoch\",\n      \"UK\": \"epoch\",\n      \"DE\": \"epoch\",\n      \"FR\": \"epoch\",\n      \"LATAM\": \"vendo\",\n      \"BR\": \"vendo\",\n      \"MX\": \"vendo\",\n    };\n\n    const preferredProcessor = regionMap[region.toUpperCase()] || \"segpay\";\n    \n    let gateway = this.gateways.find(g => \n      g.processor === preferredProcessor && \n      (g.region.includes(region.toUpperCase()) || g.region.includes(\"GLOBAL\"))\n    );\n\n    // Fallback to Segpay (global)\n    if (!gateway) {\n      gateway = this.gateways.find(g => g.processor === \"segpay\");\n    }\n\n    if (!gateway) {\n      throw new Error(\"No suitable payment gateway found\");\n    }\n\n    logger.info(\"Payment gateway selected\", {\n      region,\n      amount,\n      selectedGateway: gateway.name,\n      processor: gateway.processor,\n    });\n\n    return gateway;\n  }\n\n  async processPayment(gateway: PaymentGateway, amount: number, metadata: any = {}): Promise<PaymentResult> {\n    try {\n      switch (gateway.processor) {\n        case \"ccbill\":\n          return await this.processCCBillPayment(amount, metadata);\n        case \"segpay\":\n          return await this.processSegpayPayment(amount, metadata);\n        case \"epoch\":\n          return await this.processEpochPayment(amount, metadata);\n        case \"vendo\":\n          return await this.processVendoPayment(amount, metadata);\n        case \"verotel\":\n          return await this.processVerotelPayment(amount, metadata);\n        default:\n          throw new Error(`Unsupported payment processor: ${gateway.processor}`);\n      }\n    } catch (error) {\n      logger.error(\"Payment processing failed\", { error, gateway: gateway.name, amount });\n      return {\n        success: false,\n        error: error instanceof Error ? error.message : \"Payment processing failed\",\n      };\n    }\n  }\n\n  private async processCCBillPayment(amount: number, metadata: any): Promise<PaymentResult> {\n    const clientAccnum = process.env.CCBILL_CLIENT_ACCNUM;\n    const clientSubacc = process.env.CCBILL_CLIENT_SUBACC;\n    const salt = process.env.CCBILL_SALT;\n\n    if (!clientAccnum || !clientSubacc || !salt) {\n      throw new Error(\"CCBill configuration missing\");\n    }\n\n    // CCBill integration logic here\n    // This would integrate with CCBill's API\n    logger.info(\"Processing CCBill payment\", { amount, clientAccnum });\n\n    return {\n      success: true,\n      transactionId: `ccb_${Date.now()}`,\n      redirectUrl: `https://bill.ccbill.com/jpost/signup.cgi?clientAccnum=${clientAccnum}&clientSubacc=${clientSubacc}`,\n    };\n  }\n\n  private async processSegpayPayment(amount: number, metadata: any): Promise<PaymentResult> {\n    const packageId = process.env.SEGPAY_PACKAGE_ID;\n    const userId = process.env.SEGPAY_USERID;\n    const accessKey = process.env.SEGPAY_ACCESS_KEY;\n\n    if (!packageId || !userId || !accessKey) {\n      throw new Error(\"Segpay configuration missing\");\n    }\n\n    logger.info(\"Processing Segpay payment\", { amount, packageId });\n\n    return {\n      success: true,\n      transactionId: `seg_${Date.now()}`,\n      redirectUrl: `https://secure2.segpay.com/billing/poset.cgi?PackageID=${packageId}`,\n    };\n  }\n\n  private async processEpochPayment(amount: number, metadata: any): Promise<PaymentResult> {\n    logger.info(\"Processing Epoch payment\", { amount });\n    \n    return {\n      success: true,\n      transactionId: `epoch_${Date.now()}`,\n    };\n  }\n\n  private async processVendoPayment(amount: number, metadata: any): Promise<PaymentResult> {\n    logger.info(\"Processing Vendo payment\", { amount });\n    \n    return {\n      success: true,\n      transactionId: `vendo_${Date.now()}`,\n    };\n  }\n\n  private async processVerotelPayment(amount: number, metadata: any): Promise<PaymentResult> {\n    logger.info(\"Processing Verotel payment\", { amount });\n    \n    return {\n      success: true,\n      transactionId: `verotel_${Date.now()}`,\n    };\n  }\n\n  async processCreatorPayout(userId: string, amount: number): Promise<PayoutResult> {\n    try {\n      const payoutAccounts = await storage.getPayoutAccounts(userId);\n      const primaryAccount = payoutAccounts.find(acc => acc.status === \"active\");\n\n      if (!primaryAccount) {\n        throw new Error(\"No active payout account found\");\n      }\n\n      switch (primaryAccount.provider) {\n        case \"paxum\":\n          return await this.processPaxumPayout(primaryAccount, amount);\n        case \"epayservice\":\n          return await this.processEPayServicePayout(primaryAccount, amount);\n        case \"wise\":\n          return await this.processWisePayout(primaryAccount, amount);\n        case \"crypto\":\n          return await this.processCryptoPayout(primaryAccount, amount);\n        default:\n          throw new Error(`Unsupported payout provider: ${primaryAccount.provider}`);\n      }\n    } catch (error) {\n      logger.error(\"Payout processing failed\", { error, userId, amount });\n      return {\n        success: false,\n        error: error instanceof Error ? error.message : \"Payout processing failed\",\n      };\n    }\n  }\n\n  private async processPaxumPayout(account: any, amount: number): Promise<PayoutResult> {\n    const apiUser = process.env.PAXUM_API_USER;\n    const apiPassword = process.env.PAXUM_API_PASSWORD;\n\n    if (!apiUser || !apiPassword) {\n      throw new Error(\"Paxum configuration missing\");\n    }\n\n    logger.info(\"Processing Paxum payout\", { amount, accountRef: account.accountRef });\n\n    // Create payout request in database\n    await storage.createPayoutRequest({\n      userId: account.userId,\n      payoutAccountId: account.id,\n      amountCents: amount * 100,\n      currency: \"USD\",\n      status: \"processing\",\n    });\n\n    return {\n      success: true,\n      payoutId: `pax_${Date.now()}`,\n      estimatedArrival: \"1-2 business days\",\n    };\n  }\n\n  private async processEPayServicePayout(account: any, amount: number): Promise<PayoutResult> {\n    logger.info(\"Processing ePayService payout\", { amount });\n    \n    return {\n      success: true,\n      payoutId: `eps_${Date.now()}`,\n      estimatedArrival: \"2-3 business days\",\n    };\n  }\n\n  private async processWisePayout(account: any, amount: number): Promise<PayoutResult> {\n    logger.info(\"Processing Wise payout\", { amount });\n    \n    return {\n      success: true,\n      payoutId: `wise_${Date.now()}`,\n      estimatedArrival: \"1-2 business days\",\n    };\n  }\n\n  private async processCryptoPayout(account: any, amount: number): Promise<PayoutResult> {\n    logger.info(\"Processing crypto payout\", { amount });\n    \n    return {\n      success: true,\n      payoutId: `crypto_${Date.now()}`,\n      estimatedArrival: \"1-24 hours\",\n    };\n  }\n\n  async verifyWebhookSignature(provider: string, payload: any, headers: any): Promise<boolean> {\n    try {\n      switch (provider.toLowerCase()) {\n        case \"ccbill\":\n          // CCBill webhook verification using hash\n          const ccbillHash = headers[\"x-ccbill-signature\"];\n          const ccbillSecret = process.env.CCBILL_WEBHOOK_SECRET;\n          if (!ccbillSecret) return false;\n          \n          const expectedCCBillHash = crypto.createHmac('sha256', ccbillSecret)\n            .update(JSON.stringify(payload))\n            .digest('hex');\n          return ccbillHash === expectedCCBillHash;\n          \n        case \"segpay\":\n          // Segpay webhook verification\n          const segpayHash = headers[\"x-segpay-signature\"];\n          const segpaySecret = process.env.SEGPAY_WEBHOOK_SECRET;\n          if (!segpaySecret) return false;\n          \n          const expectedSegpayHash = crypto.createHmac('sha256', segpaySecret)\n            .update(JSON.stringify(payload))\n            .digest('hex');\n          return segpayHash === expectedSegpayHash;\n          \n        case \"epoch\":\n          // Epoch webhook verification\n          const epochToken = headers[\"authorization\"];\n          const expectedEpochToken = process.env.EPOCH_WEBHOOK_TOKEN;\n          return epochToken === `Bearer ${expectedEpochToken}`;\n          \n        default:\n          logger.warn(\"No verification method for provider\", { provider });\n          return false;\n      }\n    } catch (error) {\n      logger.error(\"Webhook signature verification failed\", { error, provider });\n      return false;\n    }\n  }\n\n  async handleWebhook(provider: string, payload: any): Promise<void> {\n    logger.info(\"Processing payment webhook\", { provider, eventType: payload.eventType });\n\n    // Process webhook based on provider and event type\n    switch (provider.toLowerCase()) {\n      case \"ccbill\":\n        await this.handleCCBillWebhook(payload);\n        break;\n      case \"segpay\":\n        await this.handleSegpayWebhook(payload);\n        break;\n      case \"epoch\":\n        await this.handleEpochWebhook(payload);\n        break;\n      case \"vendo\":\n        await this.handleVendoWebhook(payload);\n        break;\n      case \"verotel\":\n        await this.handleVerotelWebhook(payload);\n        break;\n      default:\n        logger.warn(\"Unknown webhook provider\", { provider });\n    }\n  }\n\n  private async handleCCBillWebhook(payload: any): Promise<void> {\n    logger.info(\"Processing CCBill webhook\", { payload });\n    \n    // Handle different CCBill event types\n    switch (payload.eventType) {\n      case \"NewSaleSuccess\":\n        await this.processCCBillSale(payload);\n        break;\n      case \"Cancellation\":\n        await this.processCCBillCancellation(payload);\n        break;\n      case \"Chargeback\":\n        await this.processCCBillChargeback(payload);\n        break;\n      default:\n        logger.info(\"Unhandled CCBill event type\", { eventType: payload.eventType });\n    }\n  }\n\n  private async handleSegpayWebhook(payload: any): Promise<void> {\n    logger.info(\"Processing Segpay webhook\", { payload });\n    \n    switch (payload.event_type) {\n      case \"sale\":\n        await this.processSegpaySale(payload);\n        break;\n      case \"cancellation\":\n        await this.processSegpayCancellation(payload);\n        break;\n      case \"chargeback\":\n        await this.processSegpayChargeback(payload);\n        break;\n      default:\n        logger.info(\"Unhandled Segpay event type\", { eventType: payload.event_type });\n    }\n  }\n\n  private async handleEpochWebhook(payload: any): Promise<void> {\n    logger.info(\"Processing Epoch webhook\", { payload });\n    \n    switch (payload.transaction_type) {\n      case \"Sale\":\n        await this.processEpochSale(payload);\n        break;\n      case \"Cancellation\":\n        await this.processEpochCancellation(payload);\n        break;\n      default:\n        logger.info(\"Unhandled Epoch event type\", { transactionType: payload.transaction_type });\n    }\n  }\n\n  private async handleVendoWebhook(payload: any): Promise<void> {\n    logger.info(\"Processing Vendo webhook\", { payload });\n    // Implement Vendo-specific webhook handling\n  }\n\n  private async handleVerotelWebhook(payload: any): Promise<void> {\n    logger.info(\"Processing Verotel webhook\", { payload });\n    // Implement Verotel-specific webhook handling\n  }\n\n  // CCBill webhook processors\n  private async processCCBillSale(payload: any): Promise<void> {\n    try {\n      const subscriptionId = payload.subscriptionId;\n      const customerId = payload.customerId;\n      const amount = parseFloat(payload.billedAmount);\n      \n      // Update subscription status in database\n      await storage.updateSubscriptionStatus(subscriptionId, \"active\");\n      \n      logger.info(\"CCBill sale processed\", { subscriptionId, amount });\n    } catch (error) {\n      logger.error(\"CCBill sale processing failed\", { error, payload });\n    }\n  }\n\n  private async processCCBillCancellation(payload: any): Promise<void> {\n    try {\n      const subscriptionId = payload.subscriptionId;\n      \n      // Update subscription status\n      await storage.updateSubscriptionStatus(subscriptionId, \"cancelled\");\n      \n      logger.info(\"CCBill cancellation processed\", { subscriptionId });\n    } catch (error) {\n      logger.error(\"CCBill cancellation processing failed\", { error, payload });\n    }\n  }\n\n  private async processCCBillChargeback(payload: any): Promise<void> {\n    try {\n      const subscriptionId = payload.subscriptionId;\n      const amount = parseFloat(payload.chargebackAmount);\n      \n      // Handle chargeback - suspend subscription, notify admin\n      await storage.updateSubscriptionStatus(subscriptionId, \"suspended\");\n      \n      logger.warn(\"CCBill chargeback processed\", { subscriptionId, amount });\n    } catch (error) {\n      logger.error(\"CCBill chargeback processing failed\", { error, payload });\n    }\n  }\n\n  // Segpay webhook processors  \n  private async processSegpaySale(payload: any): Promise<void> {\n    try {\n      const transactionId = payload.transaction_id;\n      const amount = parseFloat(payload.amount);\n      \n      // Process Segpay sale\n      logger.info(\"Segpay sale processed\", { transactionId, amount });\n    } catch (error) {\n      logger.error(\"Segpay sale processing failed\", { error, payload });\n    }\n  }\n\n  private async processSegpayCancellation(payload: any): Promise<void> {\n    try {\n      const transactionId = payload.transaction_id;\n      \n      logger.info(\"Segpay cancellation processed\", { transactionId });\n    } catch (error) {\n      logger.error(\"Segpay cancellation processing failed\", { error, payload });\n    }\n  }\n\n  private async processSegpayChargeback(payload: any): Promise<void> {\n    try {\n      const transactionId = payload.transaction_id;\n      const amount = parseFloat(payload.amount);\n      \n      logger.warn(\"Segpay chargeback processed\", { transactionId, amount });\n    } catch (error) {\n      logger.error(\"Segpay chargeback processing failed\", { error, payload });\n    }\n  }\n\n  // Epoch webhook processors\n  private async processEpochSale(payload: any): Promise<void> {\n    try {\n      const transactionId = payload.transaction_id;\n      const amount = parseFloat(payload.amount);\n      \n      logger.info(\"Epoch sale processed\", { transactionId, amount });\n    } catch (error) {\n      logger.error(\"Epoch sale processing failed\", { error, payload });\n    }\n  }\n\n  private async processEpochCancellation(payload: any): Promise<void> {\n    try {\n      const transactionId = payload.transaction_id;\n      \n      logger.info(\"Epoch cancellation processed\", { transactionId });\n    } catch (error) {\n      logger.error(\"Epoch cancellation processing failed\", { error, payload });\n    }\n  }\n}\n\nexport const paymentService = new AdultFriendlyPaymentService();\n","size_bytes":16317},"client/src/pages/HelpDesk.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport { \n  HeadphonesIcon, \n  PlusIcon, \n  AlertTriangle,\n  Clock,\n  CheckCircle2,\n  MessageSquare,\n  Bug,\n  Lightbulb,\n  User,\n  Calendar,\n  Filter\n} from \"lucide-react\";\nimport type { Ticket } from \"@shared/schema\";\n\nconst ticketPriorityColors = {\n  low: \"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-300\",\n  medium: \"bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-300\", \n  high: \"bg-orange-100 text-orange-800 dark:bg-orange-900 dark:text-orange-300\",\n  urgent: \"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-300\"\n};\n\nconst ticketStatusColors = {\n  open: \"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-300\",\n  in_progress: \"bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-300\",\n  resolved: \"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-300\",\n  closed: \"bg-gray-100 text-gray-800 dark:bg-gray-900 dark:text-gray-300\"\n};\n\nconst ticketTypeIcons = {\n  bug: Bug,\n  feature_request: Lightbulb,\n  technical_support: HeadphonesIcon,\n  billing: User\n};\n\nexport default function HelpDesk() {\n  const { toast } = useToast();\n  const [selectedCategory, setSelectedCategory] = useState(\"all\");\n  const [selectedStatus, setSelectedStatus] = useState(\"all\");\n  const [showCreateForm, setShowCreateForm] = useState(false);\n  const [newTicket, setNewTicket] = useState({\n    title: \"\",\n    description: \"\",\n    category: \"technical_support\" as const,\n    priority: \"medium\" as const\n  });\n\n  // Fetch user's tickets\n  const { data: tickets = [], isLoading } = useQuery({\n    queryKey: [\"/api/tickets\"]\n  });\n\n  // Create ticket mutation\n  const createTicketMutation = useMutation({\n    mutationFn: (ticketData: typeof newTicket) => \n      apiRequest(\"POST\", \"/api/tickets\", ticketData),\n    onSuccess: () => {\n      toast({\n        title: \"Success\",\n        description: \"Support ticket created successfully!\"\n      });\n      setNewTicket({\n        title: \"\",\n        description: \"\",\n        category: \"technical_support\",\n        priority: \"medium\"\n      });\n      setShowCreateForm(false);\n      queryClient.invalidateQueries({ queryKey: [\"/api/tickets\"] });\n    },\n    onError: () => {\n      toast({\n        title: \"Error\",\n        description: \"Failed to create support ticket.\",\n        variant: \"destructive\"\n      });\n    }\n  });\n\n  const handleCreateTicket = (e: React.FormEvent) => {\n    e.preventDefault();\n    if (!newTicket.title.trim() || !newTicket.description.trim()) {\n      toast({\n        title: \"Error\", \n        description: \"Please fill in all required fields.\",\n        variant: \"destructive\"\n      });\n      return;\n    }\n    createTicketMutation.mutate(newTicket);\n  };\n\n  const filteredTickets = Array.isArray(tickets) \n    ? tickets.filter((ticket: Ticket) => {\n        if (selectedCategory !== \"all\" && ticket.category !== selectedCategory) return false;\n        if (selectedStatus !== \"all\" && ticket.status !== selectedStatus) return false;\n        return true;\n      })\n    : [];\n\n  return (\n    <div className=\"min-h-screen bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900\">\n      <div className=\"container mx-auto px-4 py-8 max-w-7xl\">\n        {/* Header */}\n        <div className=\"mb-8\">\n          <div className=\"flex items-center gap-3 mb-4\">\n            <div className=\"p-3 bg-cyan-500/20 rounded-lg backdrop-blur-sm\">\n              <HeadphonesIcon className=\"h-8 w-8 text-cyan-400\" />\n            </div>\n            <div>\n              <h1 className=\"text-3xl font-bold text-white\">Help Desk</h1>\n              <p className=\"text-slate-400\">Get technical support and submit feature requests</p>\n            </div>\n          </div>\n\n          <div className=\"flex flex-col sm:flex-row gap-4 items-start sm:items-center justify-between\">\n            <div className=\"flex gap-3\">\n              <Button\n                onClick={() => setShowCreateForm(true)}\n                className=\"bg-gradient-to-r from-cyan-500 to-blue-500 hover:from-cyan-600 hover:to-blue-600 text-white\"\n                data-testid=\"button-create-ticket\"\n              >\n                <PlusIcon className=\"h-4 w-4 mr-2\" />\n                New Ticket\n              </Button>\n            </div>\n\n            {/* Filters */}\n            <div className=\"flex flex-wrap gap-3\">\n              <Select value={selectedCategory} onValueChange={setSelectedCategory}>\n                <SelectTrigger className=\"w-[180px] bg-slate-700 border-slate-600 text-white\" data-testid=\"select-category\">\n                  <SelectValue placeholder=\"All Categories\" />\n                </SelectTrigger>\n                <SelectContent>\n                  <SelectItem value=\"all\">All Categories</SelectItem>\n                  <SelectItem value=\"bug\">Bug Report</SelectItem>\n                  <SelectItem value=\"feature_request\">Feature Request</SelectItem>\n                  <SelectItem value=\"technical_support\">Technical Support</SelectItem>\n                  <SelectItem value=\"billing\">Billing</SelectItem>\n                </SelectContent>\n              </Select>\n\n              <Select value={selectedStatus} onValueChange={setSelectedStatus}>\n                <SelectTrigger className=\"w-[150px] bg-slate-700 border-slate-600 text-white\" data-testid=\"select-status\">\n                  <SelectValue placeholder=\"All Status\" />\n                </SelectTrigger>\n                <SelectContent>\n                  <SelectItem value=\"all\">All Status</SelectItem>\n                  <SelectItem value=\"open\">Open</SelectItem>\n                  <SelectItem value=\"in_progress\">In Progress</SelectItem>\n                  <SelectItem value=\"resolved\">Resolved</SelectItem>\n                  <SelectItem value=\"closed\">Closed</SelectItem>\n                </SelectContent>\n              </Select>\n            </div>\n          </div>\n        </div>\n\n        <Tabs defaultValue=\"tickets\" className=\"space-y-6\">\n          <TabsList className=\"grid w-full grid-cols-2 bg-slate-800 border-slate-700\">\n            <TabsTrigger value=\"tickets\" className=\"data-[state=active]:bg-cyan-500/20 data-[state=active]:text-cyan-400\">\n              My Tickets\n            </TabsTrigger>\n            <TabsTrigger value=\"faq\" className=\"data-[state=active]:bg-cyan-500/20 data-[state=active]:text-cyan-400\">\n              FAQ & Guides\n            </TabsTrigger>\n          </TabsList>\n\n          <TabsContent value=\"tickets\" className=\"space-y-6\">\n            {/* Create Ticket Form */}\n            {showCreateForm && (\n              <Card className=\"border-slate-700/50 bg-slate-800/50 backdrop-blur-sm\">\n                <CardHeader>\n                  <CardTitle className=\"text-white\">Create Support Ticket</CardTitle>\n                </CardHeader>\n                <CardContent>\n                  <form onSubmit={handleCreateTicket} className=\"space-y-4\">\n                    <div className=\"grid gap-4 sm:grid-cols-2\">\n                      <div>\n                        <Label htmlFor=\"title\" className=\"text-white\">Title *</Label>\n                        <Input\n                          id=\"title\"\n                          value={newTicket.title}\n                          onChange={(e) => setNewTicket({...newTicket, title: e.target.value})}\n                          placeholder=\"Brief description of your issue\"\n                          className=\"bg-slate-700 border-slate-600 text-white\"\n                          data-testid=\"input-ticket-title\"\n                        />\n                      </div>\n                      <div>\n                        <Label htmlFor=\"category\" className=\"text-white\">Category</Label>\n                        <Select value={newTicket.category} onValueChange={(value: any) => setNewTicket({...newTicket, category: value})}>\n                          <SelectTrigger className=\"bg-slate-700 border-slate-600 text-white\" data-testid=\"select-ticket-category\">\n                            <SelectValue />\n                          </SelectTrigger>\n                          <SelectContent>\n                            <SelectItem value=\"bug\">Bug Report</SelectItem>\n                            <SelectItem value=\"feature_request\">Feature Request</SelectItem>\n                            <SelectItem value=\"technical_support\">Technical Support</SelectItem>\n                            <SelectItem value=\"billing\">Billing</SelectItem>\n                          </SelectContent>\n                        </Select>\n                      </div>\n                    </div>\n\n                    <div>\n                      <Label htmlFor=\"priority\" className=\"text-white\">Priority</Label>\n                      <Select value={newTicket.priority} onValueChange={(value: any) => setNewTicket({...newTicket, priority: value})}>\n                        <SelectTrigger className=\"bg-slate-700 border-slate-600 text-white\" data-testid=\"select-ticket-priority\">\n                          <SelectValue />\n                        </SelectTrigger>\n                        <SelectContent>\n                          <SelectItem value=\"low\">Low</SelectItem>\n                          <SelectItem value=\"medium\">Medium</SelectItem>\n                          <SelectItem value=\"high\">High</SelectItem>\n                          <SelectItem value=\"urgent\">Urgent</SelectItem>\n                        </SelectContent>\n                      </Select>\n                    </div>\n\n                    <div>\n                      <Label htmlFor=\"description\" className=\"text-white\">Description *</Label>\n                      <Textarea\n                        id=\"description\"\n                        value={newTicket.description}\n                        onChange={(e) => setNewTicket({...newTicket, description: e.target.value})}\n                        placeholder=\"Detailed description of your issue or request...\"\n                        className=\"bg-slate-700 border-slate-600 text-white min-h-[120px]\"\n                        data-testid=\"textarea-ticket-description\"\n                      />\n                    </div>\n\n                    <div className=\"flex gap-3\">\n                      <Button\n                        type=\"submit\"\n                        disabled={createTicketMutation.isPending}\n                        className=\"bg-gradient-to-r from-cyan-500 to-blue-500 hover:from-cyan-600 hover:to-blue-600\"\n                        data-testid=\"button-submit-ticket\"\n                      >\n                        {createTicketMutation.isPending ? \"Creating...\" : \"Create Ticket\"}\n                      </Button>\n                      <Button\n                        type=\"button\"\n                        variant=\"outline\"\n                        onClick={() => setShowCreateForm(false)}\n                        className=\"border-slate-600 text-slate-400 hover:text-white\"\n                        data-testid=\"button-cancel-ticket\"\n                      >\n                        Cancel\n                      </Button>\n                    </div>\n                  </form>\n                </CardContent>\n              </Card>\n            )}\n\n            {/* Tickets List */}\n            <div className=\"space-y-4\">\n              {isLoading ? (\n                <div className=\"space-y-4\">\n                  {[1, 2, 3].map((i) => (\n                    <Card key={i} className=\"border-slate-700/30 bg-slate-700/30 animate-pulse\">\n                      <CardContent className=\"p-6\">\n                        <div className=\"h-4 bg-slate-600 rounded w-3/4 mb-2\"></div>\n                        <div className=\"h-3 bg-slate-600 rounded w-1/2\"></div>\n                      </CardContent>\n                    </Card>\n                  ))}\n                </div>\n              ) : filteredTickets.length === 0 ? (\n                <Card className=\"border-slate-700/50 bg-slate-800/50 backdrop-blur-sm text-center p-8\">\n                  <HeadphonesIcon className=\"h-12 w-12 text-slate-500 mx-auto mb-4\" />\n                  <h3 className=\"text-lg font-semibold text-white mb-2\">No tickets found</h3>\n                  <p className=\"text-slate-400 mb-4\">\n                    {selectedCategory !== \"all\" || selectedStatus !== \"all\" \n                      ? \"No tickets match your current filters.\"\n                      : \"You haven't created any support tickets yet.\"}\n                  </p>\n                  <Button\n                    onClick={() => setShowCreateForm(true)}\n                    className=\"bg-gradient-to-r from-cyan-500 to-blue-500 hover:from-cyan-600 hover:to-blue-600\"\n                    data-testid=\"button-create-first-ticket\"\n                  >\n                    Create Your First Ticket\n                  </Button>\n                </Card>\n              ) : (\n                <div className=\"space-y-4\">\n                  {filteredTickets.map((ticket: Ticket) => {\n                    const IconComponent = ticketTypeIcons[ticket.category as keyof typeof ticketTypeIcons] || HeadphonesIcon;\n                    return (\n                      <Card\n                        key={ticket.id}\n                        className=\"border-slate-700/50 bg-slate-800/50 backdrop-blur-sm hover:bg-slate-700/50 transition-colors cursor-pointer\"\n                        data-testid={`card-ticket-${ticket.id}`}\n                      >\n                        <CardContent className=\"p-6\">\n                          <div className=\"flex items-start justify-between mb-4\">\n                            <div className=\"flex items-start gap-3 flex-1\">\n                              <div className=\"p-2 bg-slate-700 rounded-lg\">\n                                <IconComponent className=\"h-5 w-5 text-cyan-400\" />\n                              </div>\n                              <div className=\"flex-1\">\n                                <h3 className=\"text-lg font-semibold text-white mb-2\" data-testid={`text-ticket-title-${ticket.id}`}>\n                                  {ticket.title}\n                                </h3>\n                                <p className=\"text-slate-400 line-clamp-2\" data-testid={`text-ticket-description-${ticket.id}`}>\n                                  {ticket.description}\n                                </p>\n                              </div>\n                            </div>\n                            <div className=\"flex flex-col gap-2 items-end\">\n                              <Badge className={ticketStatusColors[ticket.status as keyof typeof ticketStatusColors]} data-testid={`badge-ticket-status-${ticket.id}`}>\n                                {ticket.status?.replace('_', ' ')}\n                              </Badge>\n                              <Badge className={ticketPriorityColors[ticket.priority as keyof typeof ticketPriorityColors]} data-testid={`badge-ticket-priority-${ticket.id}`}>\n                                {ticket.priority}\n                              </Badge>\n                            </div>\n                          </div>\n\n                          <div className=\"flex items-center justify-between text-sm text-slate-500\">\n                            <div className=\"flex items-center gap-4\">\n                              <span className=\"flex items-center gap-1\">\n                                <Calendar className=\"h-4 w-4\" />\n                                {ticket.createdAt ? new Date(ticket.createdAt).toLocaleDateString() : \"N/A\"}\n                              </span>\n                              <span className=\"capitalize\">\n                                {ticket.category.replace('_', ' ')}\n                              </span>\n                            </div>\n                            <span data-testid={`text-ticket-id-${ticket.id}`}>\n                              #{ticket.id}\n                            </span>\n                          </div>\n                        </CardContent>\n                      </Card>\n                    );\n                  })}\n                </div>\n              )}\n            </div>\n          </TabsContent>\n\n          <TabsContent value=\"faq\" className=\"space-y-6\">\n            <div className=\"grid gap-6 md:grid-cols-2\">\n              {/* Common Issues */}\n              <Card className=\"border-slate-700/50 bg-slate-800/50 backdrop-blur-sm\">\n                <CardHeader>\n                  <CardTitle className=\"text-white flex items-center gap-2\">\n                    <AlertTriangle className=\"h-5 w-5 text-yellow-400\" />\n                    Common Issues\n                  </CardTitle>\n                </CardHeader>\n                <CardContent className=\"space-y-4\">\n                  <div className=\"space-y-3\">\n                    <div className=\"p-3 bg-slate-700/50 rounded-lg\">\n                      <h4 className=\"font-semibold text-white mb-1\">Payment Processing Issues</h4>\n                      <p className=\"text-slate-400 text-sm\">Having trouble with payments? Check our payment troubleshooting guide.</p>\n                    </div>\n                    <div className=\"p-3 bg-slate-700/50 rounded-lg\">\n                      <h4 className=\"font-semibold text-white mb-1\">Content Upload Problems</h4>\n                      <p className=\"text-slate-400 text-sm\">Issues uploading photos or videos? Review our content guidelines.</p>\n                    </div>\n                    <div className=\"p-3 bg-slate-700/50 rounded-lg\">\n                      <h4 className=\"font-semibold text-white mb-1\">Account Verification</h4>\n                      <p className=\"text-slate-400 text-sm\">Need help with identity verification? See our KYC process guide.</p>\n                    </div>\n                  </div>\n                </CardContent>\n              </Card>\n\n              {/* Quick Actions */}\n              <Card className=\"border-slate-700/50 bg-slate-800/50 backdrop-blur-sm\">\n                <CardHeader>\n                  <CardTitle className=\"text-white flex items-center gap-2\">\n                    <MessageSquare className=\"h-5 w-5 text-cyan-400\" />\n                    Quick Actions\n                  </CardTitle>\n                </CardHeader>\n                <CardContent className=\"space-y-4\">\n                  <Button\n                    variant=\"outline\"\n                    className=\"w-full justify-start border-slate-600 text-slate-300 hover:text-white\"\n                    data-testid=\"button-contact-support\"\n                  >\n                    <HeadphonesIcon className=\"h-4 w-4 mr-2\" />\n                    Contact Live Support\n                  </Button>\n                  <Button\n                    variant=\"outline\"\n                    className=\"w-full justify-start border-slate-600 text-slate-300 hover:text-white\"\n                    data-testid=\"button-view-guides\"\n                  >\n                    <Lightbulb className=\"h-4 w-4 mr-2\" />\n                    View Creator Guides\n                  </Button>\n                  <Button\n                    variant=\"outline\"\n                    className=\"w-full justify-start border-slate-600 text-slate-300 hover:text-white\"\n                    data-testid=\"button-report-bug\"\n                  >\n                    <Bug className=\"h-4 w-4 mr-2\" />\n                    Report a Bug\n                  </Button>\n                </CardContent>\n              </Card>\n            </div>\n          </TabsContent>\n        </Tabs>\n      </div>\n    </div>\n  );\n}","size_bytes":19983},"vite.config.ts":{"content":"import { defineConfig } from \"vite\";\nimport react from \"@vitejs/plugin-react\";\nimport path from \"path\";\nimport runtimeErrorOverlay from \"@replit/vite-plugin-runtime-error-modal\";\n\nexport default defineConfig({\n  plugins: [\n    react(),\n    runtimeErrorOverlay(),\n    ...(process.env.NODE_ENV !== \"production\" &&\n    process.env.REPL_ID !== undefined\n      ? [\n          await import(\"@replit/vite-plugin-cartographer\").then((m) =>\n            m.cartographer(),\n          ),\n          await import(\"@replit/vite-plugin-dev-banner\").then((m) =>\n            m.devBanner(),\n          ),\n        ]\n      : []),\n  ],\n  resolve: {\n    alias: {\n      \"@\": path.resolve(import.meta.dirname, \"client\", \"src\"),\n      \"@shared\": path.resolve(import.meta.dirname, \"shared\"),\n      \"@assets\": path.resolve(import.meta.dirname, \"attached_assets\"),\n    },\n  },\n  root: path.resolve(import.meta.dirname, \"client\"),\n  build: {\n    outDir: path.resolve(import.meta.dirname, \"dist/public\"),\n    emptyOutDir: true,\n  },\n  server: {\n    fs: {\n      strict: true,\n      deny: [\"**/.*\"],\n    },\n  },\n});\n","size_bytes":1080},"client/src/pages/NftMarketplace.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { useAuth } from \"@/hooks/useAuth\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogFooter } from \"@/components/ui/dialog\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { queryClient, apiRequest } from \"@/lib/queryClient\";\nimport { ShoppingCart, Search, Filter, ExternalLink, Coins, Image as ImageIcon } from \"lucide-react\";\n\ninterface MarketplaceNft {\n  id: string;\n  tokenId: string;\n  blockchain: string;\n  mintPrice: string;\n  mintPriceUsd: string;\n  status: string;\n  mintedAt: string;\n  ownerId: string | null;\n  creator: {\n    id: string;\n    username: string;\n    displayName: string;\n  };\n  media: {\n    id: string;\n    title: string;\n    description: string;\n    thumbnailUrl: string;\n    mediaUrl: string;\n    mediaType: string;\n  };\n  contract: {\n    id: string;\n    blockchain: string;\n    contractAddress: string;\n    royaltyPercentage: string;\n  };\n}\n\nexport default function NftMarketplace() {\n  const { user, isAuthenticated } = useAuth();\n  const { toast } = useToast();\n  const [searchQuery, setSearchQuery] = useState(\"\");\n  const [blockchainFilter, setBlockchainFilter] = useState<string>(\"all\");\n  const [sortBy, setSortBy] = useState<string>(\"date\");\n  const [selectedNft, setSelectedNft] = useState<MarketplaceNft | null>(null);\n  const [purchaseDialogOpen, setPurchaseDialogOpen] = useState(false);\n\n  const { data: nfts, isLoading } = useQuery<MarketplaceNft[]>({\n    queryKey: [\"/api/nft/marketplace\"],\n    enabled: isAuthenticated,\n  });\n\n  // Filter and sort NFTs\n  const filteredNfts = nfts\n    ?.filter((nft) => {\n      const matchesSearch =\n        searchQuery === \"\" ||\n        nft.media.title.toLowerCase().includes(searchQuery.toLowerCase()) ||\n        nft.creator.displayName.toLowerCase().includes(searchQuery.toLowerCase());\n      const matchesBlockchain =\n        blockchainFilter === \"all\" || nft.contract.blockchain.toLowerCase() === blockchainFilter.toLowerCase();\n      return matchesSearch && matchesBlockchain;\n    })\n    .sort((a, b) => {\n      if (sortBy === \"price-asc\") {\n        return parseFloat(a.mintPriceUsd || \"0\") - parseFloat(b.mintPriceUsd || \"0\");\n      } else if (sortBy === \"price-desc\") {\n        return parseFloat(b.mintPriceUsd || \"0\") - parseFloat(a.mintPriceUsd || \"0\");\n      } else {\n        return new Date(b.mintedAt).getTime() - new Date(a.mintedAt).getTime();\n      }\n    });\n\n  const purchaseMutation = useMutation({\n    mutationFn: async (nftId: string) => {\n      // Simulate blockchain purchase\n      const response = await apiRequest(\"POST\", \"/api/nft/purchase\", { nftId });\n      return response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/nft/marketplace\"] });\n      toast({\n        title: \"Success\",\n        description: \"NFT purchased successfully!\",\n      });\n      setPurchaseDialogOpen(false);\n      setSelectedNft(null);\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"Error\",\n        description: error.message || \"Failed to purchase NFT\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const handlePurchase = () => {\n    if (selectedNft) {\n      purchaseMutation.mutate(selectedNft.id);\n    }\n  };\n\n  const getBlockchainExplorerUrl = (blockchain: string, address: string) => {\n    const explorers: Record<string, string> = {\n      ethereum: `https://etherscan.io/address/${address}`,\n      polygon: `https://polygonscan.com/address/${address}`,\n      solana: `https://solscan.io/account/${address}`,\n      binance: `https://bscscan.com/address/${address}`,\n    };\n    return explorers[blockchain.toLowerCase()] || \"#\";\n  };\n\n  if (!isAuthenticated) {\n    return (\n      <div className=\"flex items-center justify-center min-h-screen bg-df-ink\">\n        <Card className=\"w-full max-w-md bg-df-steel border-df-steel\">\n          <CardHeader>\n            <CardTitle className=\"text-df-gold\">NFT Marketplace</CardTitle>\n          </CardHeader>\n          <CardContent>\n            <p className=\"text-df-fog\">Please log in to browse the NFT marketplace.</p>\n          </CardContent>\n        </Card>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"min-h-screen bg-df-ink p-6\">\n      <div className=\"max-w-7xl mx-auto\">\n        {/* Header */}\n        <div className=\"mb-8\">\n          <h1 className=\"text-4xl font-bold text-df-snow mb-2\">NFT Marketplace</h1>\n          <p className=\"text-df-fog\">Discover and collect exclusive creator NFTs on blockchain</p>\n        </div>\n\n        {/* Filters and Search */}\n        <Card className=\"mb-6 bg-df-steel border-df-steel\">\n          <CardContent className=\"p-4\">\n            <div className=\"grid grid-cols-1 md:grid-cols-4 gap-4\">\n              {/* Search */}\n              <div className=\"md:col-span-2\">\n                <div className=\"relative\">\n                  <Search className=\"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-df-fog\" />\n                  <Input\n                    placeholder=\"Search NFTs or creators...\"\n                    value={searchQuery}\n                    onChange={(e) => setSearchQuery(e.target.value)}\n                    className=\"pl-10 bg-df-ink border-df-steel text-df-snow\"\n                    data-testid=\"input-search-nft\"\n                  />\n                </div>\n              </div>\n\n              {/* Blockchain Filter */}\n              <Select value={blockchainFilter} onValueChange={setBlockchainFilter}>\n                <SelectTrigger className=\"bg-df-ink border-df-steel text-df-snow\" data-testid=\"select-blockchain-filter\">\n                  <SelectValue placeholder=\"All Blockchains\" />\n                </SelectTrigger>\n                <SelectContent>\n                  <SelectItem value=\"all\">All Blockchains</SelectItem>\n                  <SelectItem value=\"ethereum\">Ethereum</SelectItem>\n                  <SelectItem value=\"polygon\">Polygon</SelectItem>\n                  <SelectItem value=\"solana\">Solana</SelectItem>\n                  <SelectItem value=\"binance\">Binance Smart Chain</SelectItem>\n                </SelectContent>\n              </Select>\n\n              {/* Sort */}\n              <Select value={sortBy} onValueChange={setSortBy}>\n                <SelectTrigger className=\"bg-df-ink border-df-steel text-df-snow\" data-testid=\"select-sort\">\n                  <SelectValue placeholder=\"Sort by...\" />\n                </SelectTrigger>\n                <SelectContent>\n                  <SelectItem value=\"date\">Newest First</SelectItem>\n                  <SelectItem value=\"price-asc\">Price: Low to High</SelectItem>\n                  <SelectItem value=\"price-desc\">Price: High to Low</SelectItem>\n                </SelectContent>\n              </Select>\n            </div>\n          </CardContent>\n        </Card>\n\n        {/* NFT Grid */}\n        {isLoading ? (\n          <div className=\"flex items-center justify-center py-12\">\n            <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-df-cyan\"></div>\n          </div>\n        ) : filteredNfts && filteredNfts.length > 0 ? (\n          <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6\">\n            {filteredNfts.map((nft) => (\n              <Card\n                key={nft.id}\n                className=\"bg-df-steel border-df-steel hover:border-df-cyan transition-colors cursor-pointer group\"\n                data-testid={`card-nft-${nft.id}`}\n              >\n                <CardContent className=\"p-4\">\n                  {/* NFT Image */}\n                  <div className=\"aspect-square bg-df-ink rounded-lg mb-4 overflow-hidden relative\">\n                    {nft.media.thumbnailUrl ? (\n                      <img\n                        src={nft.media.thumbnailUrl}\n                        alt={nft.media.title}\n                        className=\"w-full h-full object-cover group-hover:scale-105 transition-transform\"\n                      />\n                    ) : (\n                      <div className=\"w-full h-full flex items-center justify-center\">\n                        <ImageIcon className=\"h-16 w-16 text-df-fog\" />\n                      </div>\n                    )}\n                    <Badge className=\"absolute top-2 right-2 bg-df-ink/80 text-df-cyan border-df-cyan\">\n                      {nft.contract.blockchain}\n                    </Badge>\n                  </div>\n\n                  {/* NFT Info */}\n                  <div className=\"space-y-2\">\n                    <h3 className=\"font-semibold text-df-snow truncate\" data-testid={`text-nft-title-${nft.id}`}>\n                      {nft.media.title}\n                    </h3>\n                    <p className=\"text-sm text-df-fog truncate\">\n                      by {nft.creator.displayName || nft.creator.username}\n                    </p>\n                    <div className=\"flex items-center justify-between\">\n                      <div>\n                        <p className=\"text-xs text-df-fog\">Price</p>\n                        <p className=\"text-lg font-bold text-df-gold\" data-testid={`text-price-${nft.id}`}>\n                          ${nft.mintPriceUsd || \"0.00\"}\n                        </p>\n                      </div>\n                      <div className=\"text-right\">\n                        <p className=\"text-xs text-df-fog\">Token ID</p>\n                        <p className=\"text-sm text-df-snow\">#{nft.tokenId}</p>\n                      </div>\n                    </div>\n                  </div>\n\n                  {/* Actions */}\n                  <div className=\"mt-4 flex gap-2\">\n                    {nft.ownerId ? (\n                      <Button\n                        disabled\n                        className=\"flex-1 bg-df-fog text-df-ink cursor-not-allowed\"\n                        data-testid={`button-sold-${nft.id}`}\n                      >\n                        <Coins className=\"mr-2 h-4 w-4\" />\n                        {nft.ownerId === user?.id ? \"Owned\" : \"Sold\"}\n                      </Button>\n                    ) : (\n                      <Button\n                        onClick={() => {\n                          setSelectedNft(nft);\n                          setPurchaseDialogOpen(true);\n                        }}\n                        className=\"flex-1 bg-df-cyan hover:bg-df-cyan/80 text-df-ink\"\n                        data-testid={`button-purchase-${nft.id}`}\n                      >\n                        <ShoppingCart className=\"mr-2 h-4 w-4\" />\n                        Purchase\n                      </Button>\n                    )}\n                    <Button\n                      variant=\"outline\"\n                      size=\"icon\"\n                      onClick={() => window.open(getBlockchainExplorerUrl(nft.contract.blockchain, nft.contract.contractAddress), \"_blank\")}\n                      className=\"border-df-cyan text-df-cyan hover:bg-df-cyan hover:text-df-ink\"\n                      data-testid={`button-view-contract-${nft.id}`}\n                    >\n                      <ExternalLink className=\"h-4 w-4\" />\n                    </Button>\n                  </div>\n                </CardContent>\n              </Card>\n            ))}\n          </div>\n        ) : (\n          <div className=\"text-center py-12\">\n            <Coins className=\"mx-auto h-16 w-16 text-df-fog mb-4\" />\n            <p className=\"text-df-fog text-lg\">No NFTs found</p>\n            <p className=\"text-sm text-df-fog mt-2\">\n              {searchQuery || blockchainFilter !== \"all\"\n                ? \"Try adjusting your filters\"\n                : \"Check back later for new listings\"}\n            </p>\n          </div>\n        )}\n      </div>\n\n      {/* Purchase Dialog */}\n      <Dialog open={purchaseDialogOpen} onOpenChange={setPurchaseDialogOpen}>\n        <DialogContent className=\"bg-df-steel border-df-steel\">\n          <DialogHeader>\n            <DialogTitle className=\"text-df-gold\">Purchase NFT</DialogTitle>\n          </DialogHeader>\n          {selectedNft && (\n            <div className=\"space-y-4\">\n              <div className=\"aspect-video bg-df-ink rounded-lg overflow-hidden\">\n                {selectedNft.media.thumbnailUrl ? (\n                  <img\n                    src={selectedNft.media.thumbnailUrl}\n                    alt={selectedNft.media.title}\n                    className=\"w-full h-full object-cover\"\n                  />\n                ) : (\n                  <div className=\"w-full h-full flex items-center justify-center\">\n                    <ImageIcon className=\"h-16 w-16 text-df-fog\" />\n                  </div>\n                )}\n              </div>\n              <div>\n                <h3 className=\"text-xl font-semibold text-df-snow\">{selectedNft.media.title}</h3>\n                <p className=\"text-df-fog\">by {selectedNft.creator.displayName || selectedNft.creator.username}</p>\n              </div>\n              <div className=\"grid grid-cols-2 gap-4 p-4 bg-df-ink rounded-lg\">\n                <div>\n                  <p className=\"text-xs text-df-fog\">Price</p>\n                  <p className=\"text-2xl font-bold text-df-gold\">${selectedNft.mintPriceUsd || \"0.00\"}</p>\n                </div>\n                <div>\n                  <p className=\"text-xs text-df-fog\">Blockchain</p>\n                  <Badge className=\"mt-1 bg-df-cyan text-df-ink\">{selectedNft.contract.blockchain}</Badge>\n                </div>\n              </div>\n              <p className=\"text-sm text-df-fog\">{selectedNft.media.description || \"No description available\"}</p>\n              <div className=\"flex items-center gap-2 text-xs text-df-fog\">\n                <span>Contract:</span>\n                <code className=\"text-df-cyan\">{selectedNft.contract.contractAddress.slice(0, 10)}...</code>\n                <span>Royalty: {selectedNft.contract.royaltyPercentage}%</span>\n              </div>\n            </div>\n          )}\n          <DialogFooter>\n            <Button\n              variant=\"outline\"\n              onClick={() => setPurchaseDialogOpen(false)}\n              className=\"border-df-steel text-df-fog\"\n              data-testid=\"button-cancel-purchase\"\n            >\n              Cancel\n            </Button>\n            <Button\n              onClick={handlePurchase}\n              disabled={purchaseMutation.isPending}\n              className=\"bg-df-cyan hover:bg-df-cyan/80 text-df-ink\"\n              data-testid=\"button-confirm-purchase\"\n            >\n              {purchaseMutation.isPending ? \"Processing...\" : \"Confirm Purchase\"}\n            </Button>\n          </DialogFooter>\n        </DialogContent>\n      </Dialog>\n    </div>\n  );\n}\n","size_bytes":14976},"client/src/components/payments/PaymentSettings.tsx":{"content":"import { useState } from \"react\";\nimport { useAuth } from \"@/hooks/useAuth\";\nimport { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { isUnauthorizedError } from \"@/lib/authUtils\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { \n  DollarSign, \n  CreditCard, \n  Shield, \n  AlertTriangle, \n  CheckCircle,\n  Star,\n  Globe,\n  MapPin,\n  Clock,\n  TrendingUp,\n  Download\n} from \"lucide-react\";\n\ninterface PayoutAccount {\n  id: string;\n  provider: string;\n  accountRef: string;\n  status: string;\n  metadata?: any;\n  createdAt: string;\n}\n\ninterface PayoutAccountForm {\n  provider: \"paxum\" | \"epayservice\" | \"wise\" | \"crypto\";\n  accountRef: string;\n  metadata: Record<string, any>;\n}\n\nexport default function PaymentSettings() {\n  const { user } = useAuth();\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n  \n  const [selectedProcessor, setSelectedProcessor] = useState(\"ccbill\");\n  const [payoutForm, setPayoutForm] = useState<PayoutAccountForm>({\n    provider: \"paxum\",\n    accountRef: \"\",\n    metadata: {},\n  });\n\n  const { data: payoutAccounts, isLoading } = useQuery({\n    queryKey: [\"/api/payments/accounts\"],\n    retry: false,\n    enabled: user?.role === \"creator\" || user?.role === \"admin\",\n  });\n\n  const createPayoutAccountMutation = useMutation({\n    mutationFn: async (data: PayoutAccountForm) => {\n      const response = await apiRequest(\"POST\", \"/api/payments/accounts\", data);\n      return response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/payments/accounts\"] });\n      toast({\n        title: \"Payout Account Added\",\n        description: \"Your payout account has been set up successfully.\",\n      });\n      setPayoutForm({\n        provider: \"paxum\",\n        accountRef: \"\",\n        metadata: {},\n      });\n    },\n    onError: (error) => {\n      if (isUnauthorizedError(error as Error)) {\n        toast({\n          title: \"Unauthorized\",\n          description: \"You are logged out. Logging in again...\",\n          variant: \"destructive\",\n        });\n        setTimeout(() => {\n          window.location.href = \"/api/login\";\n        }, 500);\n        return;\n      }\n      toast({\n        title: \"Setup Failed\",\n        description: \"Failed to set up payout account. Please try again.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const requestPayoutMutation = useMutation({\n    mutationFn: async (amount: number) => {\n      const response = await apiRequest(\"POST\", \"/api/payments/payout\", { amount });\n      return response.json();\n    },\n    onSuccess: () => {\n      toast({\n        title: \"Payout Requested\",\n        description: \"Your payout request has been submitted for processing.\",\n      });\n    },\n    onError: (error) => {\n      toast({\n        title: \"Payout Failed\",\n        description: \"Failed to request payout. Please try again.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const handleSubmitPayoutAccount = () => {\n    if (!payoutForm.accountRef.trim()) {\n      toast({\n        title: \"Account Required\",\n        description: \"Please provide your account information.\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    createPayoutAccountMutation.mutate(payoutForm);\n  };\n\n  const handleRequestPayout = () => {\n    // Mock available balance\n    const availableBalance = 2134.50;\n    requestPayoutMutation.mutate(availableBalance);\n  };\n\n  const paymentProcessors = [\n    {\n      id: \"ccbill\",\n      name: \"CCBill\",\n      region: \"US\",\n      icon: \"💳\",\n      description: \"Primary US processor\",\n      recommended: true,\n    },\n    {\n      id: \"segpay\",\n      name: \"Segpay\",\n      region: \"Global\",\n      icon: \"🌍\",\n      description: \"Global backup processor\",\n      recommended: false,\n    },\n    {\n      id: \"epoch\",\n      name: \"Epoch\",\n      region: \"EU\",\n      icon: \"🇪🇺\",\n      description: \"European processor\",\n      recommended: false,\n    },\n    {\n      id: \"vendo\",\n      name: \"Vendo\",\n      region: \"LatAm\",\n      icon: \"🌎\",\n      description: \"Latin America processor\",\n      recommended: false,\n    },\n  ];\n\n  const payoutProviders = [\n    {\n      id: \"paxum\",\n      name: \"Paxum\",\n      description: \"Adult industry standard\",\n      processingTime: \"1-2 business days\",\n      fees: \"1.5%\",\n      recommended: true,\n    },\n    {\n      id: \"epayservice\",\n      name: \"ePayService\",\n      description: \"Alternative adult-friendly\",\n      processingTime: \"2-3 business days\",\n      fees: \"2.0%\",\n      recommended: false,\n    },\n    {\n      id: \"wise\",\n      name: \"Wise\",\n      description: \"International transfers\",\n      processingTime: \"1-2 business days\",\n      fees: \"0.5%\",\n      recommended: false,\n    },\n    {\n      id: \"crypto\",\n      name: \"Cryptocurrency\",\n      description: \"BTC, ETH, USDT, USDC\",\n      processingTime: \"1-24 hours\",\n      fees: \"Network fees\",\n      recommended: false,\n    },\n  ];\n\n  const getProviderStatus = (provider: string) => {\n    const account = payoutAccounts?.find((acc: PayoutAccount) => acc.provider === provider);\n    if (account) {\n      return account.status === \"active\" ? \"connected\" : \"pending\";\n    }\n    return \"not_connected\";\n  };\n\n  const getStatusBadge = (status: string) => {\n    switch (status) {\n      case \"connected\":\n        return <Badge className=\"bg-green-600 text-white\">Connected</Badge>;\n      case \"pending\":\n        return <Badge className=\"bg-yellow-500 text-black\">Pending</Badge>;\n      case \"not_connected\":\n        return <Badge variant=\"secondary\">Not Connected</Badge>;\n      default:\n        return <Badge variant=\"secondary\">{status}</Badge>;\n    }\n  };\n\n  const isCreator = user?.role === \"creator\" || user?.role === \"admin\";\n\n  if (!isCreator) {\n    return (\n      <Card className=\"card-df\">\n        <CardContent className=\"pt-6 text-center\">\n          <Shield className=\"h-12 w-12 text-df-fog mx-auto mb-4\" />\n          <h3 className=\"text-df-snow text-lg font-semibold mb-2\">Creator Access Required</h3>\n          <p className=\"text-df-fog\">You need to be a creator to access payment settings.</p>\n        </CardContent>\n      </Card>\n    );\n  }\n\n  return (\n    <div className=\"space-y-8\">\n      <Tabs defaultValue=\"processors\" className=\"space-y-6\">\n        <TabsList className=\"bg-df-brick border border-df-steel\">\n          <TabsTrigger \n            value=\"processors\" \n            className=\"data-[state=active]:bg-df-cyan data-[state=active]:text-df-ink text-df-fog\"\n            data-testid=\"tab-processors\"\n          >\n            <CreditCard className=\"mr-2 h-4 w-4\" />\n            Payment Processors\n          </TabsTrigger>\n          <TabsTrigger \n            value=\"payouts\" \n            className=\"data-[state=active]:bg-df-cyan data-[state=active]:text-df-ink text-df-fog\"\n            data-testid=\"tab-payouts\"\n          >\n            <DollarSign className=\"mr-2 h-4 w-4\" />\n            Payout Methods\n          </TabsTrigger>\n          <TabsTrigger \n            value=\"analytics\" \n            className=\"data-[state=active]:bg-df-cyan data-[state=active]:text-df-ink text-df-fog\"\n            data-testid=\"tab-analytics\"\n          >\n            <TrendingUp className=\"mr-2 h-4 w-4\" />\n            Analytics\n          </TabsTrigger>\n        </TabsList>\n\n        {/* Payment Processors Tab */}\n        <TabsContent value=\"processors\">\n          <Card className=\"card-df\">\n            <CardHeader>\n              <CardTitle className=\"text-xl glow-text-gold\">\n                Adult-Friendly Payment Processors\n              </CardTitle>\n            </CardHeader>\n            <CardContent>\n              {/* Critical Warning */}\n              <div className=\"bg-red-900 bg-opacity-20 border border-red-600 rounded-md p-4 mb-6\">\n                <div className=\"flex items-start space-x-3\">\n                  <AlertTriangle className=\"h-5 w-5 text-red-500 mt-0.5\" />\n                  <div>\n                    <h4 className=\"text-red-200 font-semibold mb-1\">CRITICAL: Adult-Friendly Processors Only</h4>\n                    <p className=\"text-red-100 text-sm\">\n                      NEVER use Stripe, PayPal, or Square - they prohibit adult content and will ban your account.\n                      Only the processors listed below are approved for adult content.\n                    </p>\n                  </div>\n                </div>\n              </div>\n\n              {/* Processor Selection */}\n              <div>\n                <Label className=\"text-df-fog\">Selected Payment Processor</Label>\n                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4 mt-3\">\n                  {paymentProcessors.map((processor) => (\n                    <div\n                      key={processor.id}\n                      onClick={() => setSelectedProcessor(processor.id)}\n                      className={`p-4 border rounded-md cursor-pointer transition-all ${\n                        selectedProcessor === processor.id\n                          ? 'border-df-cyan bg-df-cyan bg-opacity-10'\n                          : 'border-df-steel hover:border-df-cyan hover:bg-df-steel hover:bg-opacity-10'\n                      }`}\n                      data-testid={`processor-${processor.id}`}\n                    >\n                      <div className=\"flex items-center justify-between mb-2\">\n                        <div className=\"flex items-center space-x-3\">\n                          <span className=\"text-2xl\">{processor.icon}</span>\n                          <div>\n                            <h4 className=\"text-df-snow font-semibold\">{processor.name}</h4>\n                            <div className=\"flex items-center space-x-2\">\n                              <MapPin className=\"h-3 w-3 text-df-fog\" />\n                              <span className=\"text-df-fog text-sm\">{processor.region}</span>\n                            </div>\n                          </div>\n                        </div>\n                        {processor.recommended && (\n                          <div className=\"flex items-center space-x-1\">\n                            <Star className=\"h-4 w-4 text-df-gold\" />\n                            <span className=\"text-df-gold text-sm font-medium\">Recommended</span>\n                          </div>\n                        )}\n                      </div>\n                      <p className=\"text-df-fog text-sm\">{processor.description}</p>\n                      {selectedProcessor === processor.id && (\n                        <div className=\"mt-3 p-3 bg-df-ink border border-df-steel rounded-md\">\n                          <div className=\"flex items-center space-x-2 mb-2\">\n                            <CheckCircle className=\"h-4 w-4 text-green-400\" />\n                            <span className=\"text-green-400 text-sm font-medium\">Active Processor</span>\n                          </div>\n                          <p className=\"text-df-fog text-xs\">\n                            This processor is configured and ready to accept payments.\n                          </p>\n                        </div>\n                      )}\n                    </div>\n                  ))}\n                </div>\n              </div>\n\n              {/* Regional Routing Info */}\n              <div className=\"mt-6 bg-df-ink border border-df-steel rounded-md p-4\">\n                <h4 className=\"text-df-cyan font-semibold mb-3\">Regional Payment Routing</h4>\n                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm\">\n                  <div>\n                    <span className=\"text-df-fog\">US & Canada:</span>\n                    <span className=\"ml-2 text-df-snow\">CCBill</span>\n                  </div>\n                  <div>\n                    <span className=\"text-df-fog\">Europe:</span>\n                    <span className=\"ml-2 text-df-snow\">Epoch</span>\n                  </div>\n                  <div>\n                    <span className=\"text-df-fog\">Latin America:</span>\n                    <span className=\"ml-2 text-df-snow\">Vendo</span>\n                  </div>\n                  <div>\n                    <span className=\"text-df-fog\">Global Fallback:</span>\n                    <span className=\"ml-2 text-df-snow\">Segpay</span>\n                  </div>\n                </div>\n              </div>\n            </CardContent>\n          </Card>\n        </TabsContent>\n\n        {/* Payout Methods Tab */}\n        <TabsContent value=\"payouts\">\n          <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-8\">\n            {/* Payout Methods */}\n            <Card className=\"card-df\">\n              <CardHeader>\n                <CardTitle className=\"text-xl neon-subheading\">\n                  Payout Methods\n                </CardTitle>\n              </CardHeader>\n              <CardContent>\n                <div className=\"space-y-4\">\n                  {payoutProviders.map((provider) => (\n                    <div\n                      key={provider.id}\n                      className=\"p-4 border border-df-steel rounded-md\"\n                      data-testid={`payout-provider-${provider.id}`}\n                    >\n                      <div className=\"flex items-center justify-between mb-2\">\n                        <div>\n                          <div className=\"flex items-center space-x-2\">\n                            <h4 className=\"text-df-snow font-semibold\">{provider.name}</h4>\n                            {provider.recommended && (\n                              <div className=\"flex items-center space-x-1\">\n                                <Star className=\"h-3 w-3 text-df-gold\" />\n                                <span className=\"text-df-gold text-xs\">Recommended</span>\n                              </div>\n                            )}\n                          </div>\n                          <p className=\"text-df-fog text-sm\">{provider.description}</p>\n                        </div>\n                        {getStatusBadge(getProviderStatus(provider.id))}\n                      </div>\n                      \n                      <div className=\"grid grid-cols-2 gap-4 text-xs text-df-fog\">\n                        <div>\n                          <Clock className=\"h-3 w-3 inline mr-1\" />\n                          {provider.processingTime}\n                        </div>\n                        <div>\n                          <DollarSign className=\"h-3 w-3 inline mr-1\" />\n                          {provider.fees}\n                        </div>\n                      </div>\n\n                      {getProviderStatus(provider.id) === \"not_connected\" && (\n                        <Button\n                          onClick={() => setPayoutForm(prev => ({ ...prev, provider: provider.id as any }))}\n                          size=\"sm\"\n                          className=\"w-full mt-3 btn-outline\"\n                          data-testid={`button-setup-${provider.id}`}\n                        >\n                          Setup {provider.name}\n                        </Button>\n                      )}\n                    </div>\n                  ))}\n                </div>\n              </CardContent>\n            </Card>\n\n            {/* Setup Form */}\n            <Card className=\"card-df\">\n              <CardHeader>\n                <CardTitle className=\"text-xl neon-subheading\">\n                  Setup Payout Account\n                </CardTitle>\n              </CardHeader>\n              <CardContent className=\"space-y-4\">\n                <div>\n                  <Label htmlFor=\"payoutProvider\" className=\"text-df-fog\">Payout Provider</Label>\n                  <select\n                    id=\"payoutProvider\"\n                    value={payoutForm.provider}\n                    onChange={(e) => setPayoutForm(prev => ({ ...prev, provider: e.target.value as any }))}\n                    className=\"w-full bg-df-ink border border-df-steel rounded-md px-3 py-2 text-df-snow mt-1\"\n                    data-testid=\"select-payout-provider\"\n                  >\n                    <option value=\"paxum\">Paxum (Recommended)</option>\n                    <option value=\"epayservice\">ePayService</option>\n                    <option value=\"wise\">Wise</option>\n                    <option value=\"crypto\">Cryptocurrency</option>\n                  </select>\n                </div>\n\n                <div>\n                  <Label htmlFor=\"accountRef\" className=\"text-df-fog\">\n                    {payoutForm.provider === \"crypto\" ? \"Wallet Address\" : \"Account Email/ID\"}\n                  </Label>\n                  <Input\n                    id=\"accountRef\"\n                    type={payoutForm.provider === \"crypto\" ? \"text\" : \"email\"}\n                    value={payoutForm.accountRef}\n                    onChange={(e) => setPayoutForm(prev => ({ ...prev, accountRef: e.target.value }))}\n                    className=\"input-df\"\n                    placeholder={\n                      payoutForm.provider === \"crypto\" \n                        ? \"Enter wallet address\" \n                        : \"Enter account email\"\n                    }\n                    data-testid=\"input-account-ref\"\n                  />\n                </div>\n\n                {/* KYC Warning */}\n                <div className=\"bg-yellow-900 bg-opacity-20 border border-yellow-600 rounded-md p-3\">\n                  <div className=\"flex items-start space-x-2\">\n                    <Shield className=\"h-4 w-4 text-yellow-500 mt-0.5\" />\n                    <div>\n                      <p className=\"text-yellow-200 text-sm font-medium\">KYC Verification Required</p>\n                      <p className=\"text-yellow-100 text-xs\">\n                        KYC verification is required for payouts over $600 (US legal requirement).\n                      </p>\n                    </div>\n                  </div>\n                </div>\n\n                <Button\n                  onClick={handleSubmitPayoutAccount}\n                  disabled={createPayoutAccountMutation.isPending || !payoutForm.accountRef.trim()}\n                  className=\"w-full btn-primary\"\n                  data-testid=\"button-submit-payout-account\"\n                >\n                  {createPayoutAccountMutation.isPending ? \"Setting up...\" : \"Setup Payout Account\"}\n                </Button>\n              </CardContent>\n            </Card>\n          </div>\n\n          {/* Current Balance & Payout Request */}\n          <Card className=\"card-df mt-8\">\n            <CardHeader>\n              <CardTitle className=\"text-xl glow-text-gold\">\n                Current Balance & Payouts\n              </CardTitle>\n            </CardHeader>\n            <CardContent>\n              <div className=\"grid grid-cols-1 md:grid-cols-3 gap-6\">\n                {/* Available Balance */}\n                <div className=\"bg-df-ink border border-df-steel rounded-md p-4 text-center\">\n                  <DollarSign className=\"h-8 w-8 text-df-gold mx-auto mb-2\" />\n                  <p className=\"text-df-fog text-sm\">Available Balance</p>\n                  <p className=\"text-3xl font-bold text-df-gold\" data-testid=\"available-balance\">$2,134.50</p>\n                  <Button\n                    onClick={handleRequestPayout}\n                    disabled={requestPayoutMutation.isPending || !payoutAccounts?.length}\n                    className=\"w-full mt-3 btn-primary\"\n                    data-testid=\"button-request-payout\"\n                  >\n                    {requestPayoutMutation.isPending ? \"Processing...\" : \"Request Payout\"}\n                  </Button>\n                </div>\n\n                {/* Pending Payouts */}\n                <div className=\"bg-df-ink border border-df-steel rounded-md p-4 text-center\">\n                  <Clock className=\"h-8 w-8 text-df-cyan mx-auto mb-2\" />\n                  <p className=\"text-df-fog text-sm\">Pending Payouts</p>\n                  <p className=\"text-3xl font-bold text-df-cyan\" data-testid=\"pending-payouts\">$0.00</p>\n                  <p className=\"text-df-fog text-xs mt-2\">Next payout: Friday</p>\n                </div>\n\n                {/* Total Earnings */}\n                <div className=\"bg-df-ink border border-df-steel rounded-md p-4 text-center\">\n                  <TrendingUp className=\"h-8 w-8 text-green-400 mx-auto mb-2\" />\n                  <p className=\"text-df-fog text-sm\">Total Earnings</p>\n                  <p className=\"text-3xl font-bold text-green-400\" data-testid=\"total-earnings\">$12,847.25</p>\n                  <p className=\"text-green-400 text-xs mt-2\">+12% this month</p>\n                </div>\n              </div>\n            </CardContent>\n          </Card>\n        </TabsContent>\n\n        {/* Analytics Tab */}\n        <TabsContent value=\"analytics\">\n          <Card className=\"card-df\">\n            <CardHeader>\n              <CardTitle className=\"text-xl neon-subheading\">\n                Payment Analytics\n              </CardTitle>\n            </CardHeader>\n            <CardContent>\n              <div className=\"bg-df-ink border border-df-steel rounded-md p-6 h-48 flex items-center justify-center\">\n                <div className=\"text-center\">\n                  <TrendingUp className=\"h-12 w-12 text-df-cyan mx-auto mb-4\" />\n                  <p className=\"text-df-fog\">Revenue analytics chart will render here</p>\n                  <p className=\"text-df-fog text-sm\">Chart.js integration required</p>\n                </div>\n              </div>\n\n              {/* Recent Transactions */}\n              <div className=\"mt-8\">\n                <h4 className=\"text-df-gold font-semibold mb-4\">Recent Transactions</h4>\n                <div className=\"space-y-3\">\n                  <div className=\"flex items-center justify-between bg-df-ink border border-df-steel rounded-md p-3\">\n                    <div className=\"flex items-center space-x-3\">\n                      <div className=\"w-2 h-2 bg-green-400 rounded-full\"></div>\n                      <div>\n                        <p className=\"text-df-snow text-sm font-medium\">Subscription Payment</p>\n                        <p className=\"text-df-fog text-xs\">2 hours ago • CCBill</p>\n                      </div>\n                    </div>\n                    <span className=\"text-df-gold font-semibold\">+$29.99</span>\n                  </div>\n                  \n                  <div className=\"flex items-center justify-between bg-df-ink border border-df-steel rounded-md p-3\">\n                    <div className=\"flex items-center space-x-3\">\n                      <div className=\"w-2 h-2 bg-green-400 rounded-full\"></div>\n                      <div>\n                        <p className=\"text-df-snow text-sm font-medium\">Premium Content</p>\n                        <p className=\"text-df-fog text-xs\">5 hours ago • Segpay</p>\n                      </div>\n                    </div>\n                    <span className=\"text-df-gold font-semibold\">+$49.99</span>\n                  </div>\n                  \n                  <div className=\"flex items-center justify-between bg-df-ink border border-df-steel rounded-md p-3\">\n                    <div className=\"flex items-center space-x-3\">\n                      <div className=\"w-2 h-2 bg-yellow-400 rounded-full\"></div>\n                      <div>\n                        <p className=\"text-df-snow text-sm font-medium\">Payout to Paxum</p>\n                        <p className=\"text-df-fog text-xs\">1 day ago • Processing</p>\n                      </div>\n                    </div>\n                    <span className=\"text-df-gold font-semibold\">-$1,250.00</span>\n                  </div>\n                </div>\n              </div>\n            </CardContent>\n          </Card>\n        </TabsContent>\n      </Tabs>\n    </div>\n  );\n}\n","size_bytes":24041},"client/src/hooks/useAuth.ts":{"content":"import { useQuery } from \"@tanstack/react-query\";\n\n// Additional API response types for Dashboard and other components\nexport interface Profile {\n  id: string;\n  userId: string;\n  displayName?: string;\n  bio?: string;\n  avatarUrl?: string;\n  bannerUrl?: string;\n  kycStatus: \"pending\" | \"verified\" | \"rejected\";\n  ageVerified: boolean;\n  complianceNotes?: string;\n  subscriptionPrice?: string;\n  createdAt: string;\n  updatedAt: string;\n}\n\nexport interface MediaAsset {\n  id: string;\n  ownerId: string;\n  title?: string;\n  description?: string;\n  s3Key: string;\n  mimeType?: string;\n  fileSize?: number;\n  duration?: number;\n  status: \"uploaded\" | \"processing\" | \"approved\" | \"rejected\";\n  forensicSignature?: string;\n  price?: string;\n  isPremium: boolean;\n  createdAt: string;\n  updatedAt: string;\n}\n\nexport interface PayoutAccount {\n  id: string;\n  userId: string;\n  provider: string;\n  accountRef: string;\n  status: string;\n  metadata?: Record<string, any>;\n  createdAt: string;\n  updatedAt: string;\n}\n\nexport interface Message {\n  id: string;\n  senderId: string;\n  recipientId: string;\n  content: string;\n  mediaUrl?: string;\n  isRead: boolean;\n  createdAt: string;\n}\n\nexport interface AuthUser {\n  id: string;\n  email: string;\n  firstName?: string;\n  lastName?: string;\n  profileImageUrl?: string;\n  role: \"fan\" | \"creator\" | \"admin\";\n  authProvider: \"replit\" | \"local\";\n  status: \"active\" | \"suspended\" | \"banned\";\n  createdAt: string;\n  updatedAt: string;\n  // Profile information (if available)\n  profile?: {\n    id: string;\n    userId: string;\n    displayName?: string;\n    bio?: string;\n    avatarUrl?: string;\n    bannerUrl?: string;\n    kycStatus: \"pending\" | \"verified\" | \"rejected\";\n    ageVerified: boolean;\n    complianceNotes?: string;\n    subscriptionPrice?: string;\n    createdAt: string;\n    updatedAt: string;\n  };\n}\n\nexport function useAuth() {\n  const { data: user, isLoading } = useQuery<AuthUser>({\n    queryKey: [\"/api/auth/user\"],\n    retry: false,\n  });\n\n  return {\n    user,\n    isLoading,\n    isAuthenticated: !!user,\n  };\n}\n","size_bytes":2055},"client/src/pages/Settings.tsx":{"content":"import { useAuth } from \"@/hooks/useAuth\";\nimport { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { useState, useEffect } from \"react\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { isUnauthorizedError } from \"@/lib/authUtils\";\nimport Header from \"@/components/layout/Header\";\nimport Footer from \"@/components/layout/Footer\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Switch } from \"@/components/ui/switch\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { \n  Settings as SettingsIcon, \n  Shield, \n  Bell, \n  Lock, \n  Eye, \n  Trash2, \n  Download,\n  AlertTriangle,\n  Key,\n  Smartphone\n} from \"lucide-react\";\n\nexport default function Settings() {\n  const { user, isLoading, isAuthenticated } = useAuth();\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n  \n  const [notificationSettings, setNotificationSettings] = useState({\n    newMessages: true,\n    newSubscribers: true,\n    paymentUpdates: true,\n    contentApproved: true,\n    contentRejected: true,\n    payoutProcessed: true,\n    emailEnabled: true,\n    pushEnabled: true,\n  });\n\n  const [privacySettings, setPrivacySettings] = useState({\n    profileVisibility: \"public\",\n    allowDirectMessages: true,\n    showOnlineStatus: true,\n    allowSearchIndexing: false,\n  });\n\n  const [securitySettings, setSecuritySettings] = useState({\n    twoFactorEnabled: false,\n    loginNotifications: true,\n    sessionTimeout: 7, // days\n  });\n\n  // Redirect if not authenticated\n  useEffect(() => {\n    if (!isLoading && !isAuthenticated) {\n      toast({\n        title: \"Unauthorized\",\n        description: \"You are logged out. Logging in again...\",\n        variant: \"destructive\",\n      });\n      setTimeout(() => {\n        window.location.href = \"/api/login\";\n      }, 500);\n      return;\n    }\n  }, [isAuthenticated, isLoading, toast]);\n\n  const { data: profile } = useQuery({\n    queryKey: [\"/api/profile\"],\n    retry: false,\n    enabled: isAuthenticated,\n  });\n\n  // Update notification settings mutation\n  const updateNotificationsMutation = useMutation({\n    mutationFn: async (settings: typeof notificationSettings) => {\n      // This would call an API endpoint to update notification preferences\n      const response = await apiRequest(\"PUT\", \"/api/notifications/preferences\", settings);\n      return response.json();\n    },\n    onSuccess: () => {\n      toast({\n        title: \"Settings Updated\",\n        description: \"Your notification preferences have been saved.\",\n      });\n    },\n    onError: (error) => {\n      if (isUnauthorizedError(error as Error)) {\n        toast({\n          title: \"Unauthorized\",\n          description: \"You are logged out. Logging in again...\",\n          variant: \"destructive\",\n        });\n        setTimeout(() => {\n          window.location.href = \"/api/login\";\n        }, 500);\n        return;\n      }\n      toast({\n        title: \"Update Failed\",\n        description: \"Failed to update settings. Please try again.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const handleExportData = () => {\n    toast({\n      title: \"Data Export Requested\",\n      description: \"You'll receive an email with your data within 24 hours.\",\n    });\n  };\n\n  const handleDeleteAccount = () => {\n    toast({\n      title: \"Account Deletion\",\n      description: \"Please contact support to delete your account.\",\n      variant: \"destructive\",\n    });\n  };\n\n  if (isLoading) {\n    return (\n      <div className=\"min-h-screen bg-df-dungeon flex items-center justify-center\">\n        <div className=\"text-df-cyan text-xl font-display\">Loading settings...</div>\n      </div>\n    );\n  }\n\n  if (!isAuthenticated || !user) {\n    return null;\n  }\n\n  return (\n    <div className=\"min-h-screen bg-df-dungeon\">\n      <Header />\n      \n      <main className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8\">\n        <div className=\"mb-8\">\n          <h1 className=\"text-3xl font-display font-bold text-df-snow mb-2\">\n            Settings\n          </h1>\n          <p className=\"text-df-fog\">Manage your account preferences and security</p>\n        </div>\n\n        <Tabs defaultValue=\"notifications\" className=\"space-y-8\">\n          <TabsList className=\"bg-df-brick border border-df-steel\">\n            <TabsTrigger \n              value=\"notifications\" \n              className=\"data-[state=active]:bg-df-cyan data-[state=active]:text-df-ink text-df-fog\"\n              data-testid=\"tab-notifications\"\n            >\n              <Bell className=\"mr-2 h-4 w-4\" />\n              Notifications\n            </TabsTrigger>\n            <TabsTrigger \n              value=\"privacy\" \n              className=\"data-[state=active]:bg-df-cyan data-[state=active]:text-df-ink text-df-fog\"\n              data-testid=\"tab-privacy\"\n            >\n              <Eye className=\"mr-2 h-4 w-4\" />\n              Privacy\n            </TabsTrigger>\n            <TabsTrigger \n              value=\"security\" \n              className=\"data-[state=active]:bg-df-cyan data-[state=active]:text-df-ink text-df-fog\"\n              data-testid=\"tab-security\"\n            >\n              <Shield className=\"mr-2 h-4 w-4\" />\n              Security\n            </TabsTrigger>\n            <TabsTrigger \n              value=\"data\" \n              className=\"data-[state=active]:bg-df-cyan data-[state=active]:text-df-ink text-df-fog\"\n              data-testid=\"tab-data\"\n            >\n              <Download className=\"mr-2 h-4 w-4\" />\n              Data & Privacy\n            </TabsTrigger>\n            <TabsTrigger \n              value=\"account\" \n              className=\"data-[state=active]:bg-df-cyan data-[state=active]:text-df-ink text-df-fog\"\n              data-testid=\"tab-account\"\n            >\n              <SettingsIcon className=\"mr-2 h-4 w-4\" />\n              Account\n            </TabsTrigger>\n          </TabsList>\n\n          {/* Notifications Tab */}\n          <TabsContent value=\"notifications\">\n            <Card className=\"card-df\">\n              <CardHeader>\n                <CardTitle className=\"text-xl neon-subheading\">\n                  Notification Preferences\n                </CardTitle>\n              </CardHeader>\n              <CardContent className=\"space-y-6\">\n                {/* Notification Types */}\n                <div>\n                  <h4 className=\"text-df-snow font-semibold mb-4\">Activity Notifications</h4>\n                  <div className=\"space-y-4\">\n                    <div className=\"flex items-center justify-between\">\n                      <div>\n                        <Label className=\"text-df-fog\">New Messages</Label>\n                        <p className=\"text-df-fog text-sm\">Get notified when you receive new messages</p>\n                      </div>\n                      <Switch\n                        checked={notificationSettings.newMessages}\n                        onCheckedChange={(checked) => \n                          setNotificationSettings(prev => ({ ...prev, newMessages: checked }))\n                        }\n                        data-testid=\"switch-new-messages\"\n                      />\n                    </div>\n                    \n                    <div className=\"flex items-center justify-between\">\n                      <div>\n                        <Label className=\"text-df-fog\">New Subscribers</Label>\n                        <p className=\"text-df-fog text-sm\">Get notified when someone subscribes to you</p>\n                      </div>\n                      <Switch\n                        checked={notificationSettings.newSubscribers}\n                        onCheckedChange={(checked) => \n                          setNotificationSettings(prev => ({ ...prev, newSubscribers: checked }))\n                        }\n                        data-testid=\"switch-new-subscribers\"\n                      />\n                    </div>\n                    \n                    <div className=\"flex items-center justify-between\">\n                      <div>\n                        <Label className=\"text-df-fog\">Payment Updates</Label>\n                        <p className=\"text-df-fog text-sm\">Get notified about payments and payouts</p>\n                      </div>\n                      <Switch\n                        checked={notificationSettings.paymentUpdates}\n                        onCheckedChange={(checked) => \n                          setNotificationSettings(prev => ({ ...prev, paymentUpdates: checked }))\n                        }\n                        data-testid=\"switch-payment-updates\"\n                      />\n                    </div>\n                    \n                    <div className=\"flex items-center justify-between\">\n                      <div>\n                        <Label className=\"text-df-fog\">Content Approved</Label>\n                        <p className=\"text-df-fog text-sm\">Get notified when your content is approved</p>\n                      </div>\n                      <Switch\n                        checked={notificationSettings.contentApproved}\n                        onCheckedChange={(checked) => \n                          setNotificationSettings(prev => ({ ...prev, contentApproved: checked }))\n                        }\n                        data-testid=\"switch-content-approved\"\n                      />\n                    </div>\n                  </div>\n                </div>\n\n                {/* Delivery Methods */}\n                <div className=\"border-t border-df-steel pt-6\">\n                  <h4 className=\"text-df-snow font-semibold mb-4\">Delivery Methods</h4>\n                  <div className=\"space-y-4\">\n                    <div className=\"flex items-center justify-between\">\n                      <div>\n                        <Label className=\"text-df-fog\">Email Notifications</Label>\n                        <p className=\"text-df-fog text-sm\">Receive notifications via email</p>\n                      </div>\n                      <Switch\n                        checked={notificationSettings.emailEnabled}\n                        onCheckedChange={(checked) => \n                          setNotificationSettings(prev => ({ ...prev, emailEnabled: checked }))\n                        }\n                        data-testid=\"switch-email-enabled\"\n                      />\n                    </div>\n                    \n                    <div className=\"flex items-center justify-between\">\n                      <div>\n                        <Label className=\"text-df-fog\">Push Notifications</Label>\n                        <p className=\"text-df-fog text-sm\">Receive push notifications on your devices</p>\n                      </div>\n                      <Switch\n                        checked={notificationSettings.pushEnabled}\n                        onCheckedChange={(checked) => \n                          setNotificationSettings(prev => ({ ...prev, pushEnabled: checked }))\n                        }\n                        data-testid=\"switch-push-enabled\"\n                      />\n                    </div>\n                  </div>\n                </div>\n\n                <Button\n                  onClick={() => updateNotificationsMutation.mutate(notificationSettings)}\n                  disabled={updateNotificationsMutation.isPending}\n                  className=\"w-full btn-primary\"\n                  data-testid=\"button-save-notifications\"\n                >\n                  {updateNotificationsMutation.isPending ? \"Saving...\" : \"Save Notification Preferences\"}\n                </Button>\n              </CardContent>\n            </Card>\n          </TabsContent>\n\n          {/* Privacy Tab */}\n          <TabsContent value=\"privacy\">\n            <Card className=\"card-df\">\n              <CardHeader>\n                <CardTitle className=\"text-xl neon-subheading\">\n                  Privacy Settings\n                </CardTitle>\n              </CardHeader>\n              <CardContent className=\"space-y-6\">\n                <div>\n                  <Label htmlFor=\"profileVisibility\" className=\"text-df-fog\">Profile Visibility</Label>\n                  <p className=\"text-df-fog text-sm mb-2\">Control who can see your profile</p>\n                  <select \n                    id=\"profileVisibility\"\n                    value={privacySettings.profileVisibility}\n                    onChange={(e) => setPrivacySettings(prev => ({ ...prev, profileVisibility: e.target.value }))}\n                    className=\"w-full bg-df-ink border border-df-steel rounded-md px-3 py-2 text-df-snow\"\n                    data-testid=\"select-profile-visibility\"\n                  >\n                    <option value=\"public\">Public</option>\n                    <option value=\"subscribers\">Subscribers Only</option>\n                    <option value=\"private\">Private</option>\n                  </select>\n                </div>\n\n                <div className=\"flex items-center justify-between\">\n                  <div>\n                    <Label className=\"text-df-fog\">Allow Direct Messages</Label>\n                    <p className=\"text-df-fog text-sm\">Let people send you messages</p>\n                  </div>\n                  <Switch\n                    checked={privacySettings.allowDirectMessages}\n                    onCheckedChange={(checked) => \n                      setPrivacySettings(prev => ({ ...prev, allowDirectMessages: checked }))\n                    }\n                    data-testid=\"switch-allow-messages\"\n                  />\n                </div>\n\n                <div className=\"flex items-center justify-between\">\n                  <div>\n                    <Label className=\"text-df-fog\">Show Online Status</Label>\n                    <p className=\"text-df-fog text-sm\">Let others see when you're online</p>\n                  </div>\n                  <Switch\n                    checked={privacySettings.showOnlineStatus}\n                    onCheckedChange={(checked) => \n                      setPrivacySettings(prev => ({ ...prev, showOnlineStatus: checked }))\n                    }\n                    data-testid=\"switch-online-status\"\n                  />\n                </div>\n\n                <div className=\"flex items-center justify-between\">\n                  <div>\n                    <Label className=\"text-df-fog\">Search Engine Indexing</Label>\n                    <p className=\"text-df-fog text-sm\">Allow search engines to index your public content</p>\n                  </div>\n                  <Switch\n                    checked={privacySettings.allowSearchIndexing}\n                    onCheckedChange={(checked) => \n                      setPrivacySettings(prev => ({ ...prev, allowSearchIndexing: checked }))\n                    }\n                    data-testid=\"switch-search-indexing\"\n                  />\n                </div>\n\n                <Button className=\"w-full btn-primary\" data-testid=\"button-save-privacy\">\n                  Save Privacy Settings\n                </Button>\n              </CardContent>\n            </Card>\n          </TabsContent>\n\n          {/* Security Tab */}\n          <TabsContent value=\"security\">\n            <Card className=\"card-df\">\n              <CardHeader>\n                <CardTitle className=\"text-xl neon-subheading\">\n                  Security Settings\n                </CardTitle>\n              </CardHeader>\n              <CardContent className=\"space-y-6\">\n                {/* Two-Factor Authentication */}\n                <div className=\"bg-df-ink border border-df-steel rounded-md p-4\">\n                  <div className=\"flex items-center justify-between mb-3\">\n                    <div className=\"flex items-center gap-3\">\n                      <Smartphone className=\"h-5 w-5 text-df-cyan\" />\n                      <div>\n                        <h4 className=\"text-df-snow font-semibold\">Two-Factor Authentication</h4>\n                        <p className=\"text-df-fog text-sm\">Add an extra layer of security to your account</p>\n                      </div>\n                    </div>\n                    <Switch\n                      checked={securitySettings.twoFactorEnabled}\n                      onCheckedChange={(checked) => \n                        setSecuritySettings(prev => ({ ...prev, twoFactorEnabled: checked }))\n                      }\n                      data-testid=\"switch-2fa\"\n                    />\n                  </div>\n                  {!securitySettings.twoFactorEnabled && (\n                    <Button className=\"w-full btn-outline\" data-testid=\"button-setup-2fa\">\n                      <Key className=\"mr-2 h-4 w-4\" />\n                      Setup Two-Factor Authentication\n                    </Button>\n                  )}\n                </div>\n\n                {/* Login Notifications */}\n                <div className=\"flex items-center justify-between\">\n                  <div>\n                    <Label className=\"text-df-fog\">Login Notifications</Label>\n                    <p className=\"text-df-fog text-sm\">Get notified when someone logs into your account</p>\n                  </div>\n                  <Switch\n                    checked={securitySettings.loginNotifications}\n                    onCheckedChange={(checked) => \n                      setSecuritySettings(prev => ({ ...prev, loginNotifications: checked }))\n                    }\n                    data-testid=\"switch-login-notifications\"\n                  />\n                </div>\n\n                {/* Session Timeout */}\n                <div>\n                  <Label htmlFor=\"sessionTimeout\" className=\"text-df-fog\">Session Timeout</Label>\n                  <p className=\"text-df-fog text-sm mb-2\">Automatically log out after inactivity</p>\n                  <select \n                    id=\"sessionTimeout\"\n                    value={securitySettings.sessionTimeout}\n                    onChange={(e) => setSecuritySettings(prev => ({ ...prev, sessionTimeout: parseInt(e.target.value) }))}\n                    className=\"w-full bg-df-ink border border-df-steel rounded-md px-3 py-2 text-df-snow\"\n                    data-testid=\"select-session-timeout\"\n                  >\n                    <option value={1}>1 day</option>\n                    <option value={7}>7 days</option>\n                    <option value={14}>14 days</option>\n                    <option value={30}>30 days</option>\n                  </select>\n                </div>\n\n                {/* Change Password */}\n                <div className=\"border-t border-df-steel pt-6\">\n                  <h4 className=\"text-df-snow font-semibold mb-4\">Change Password</h4>\n                  <div className=\"space-y-3\">\n                    <Input\n                      type=\"password\"\n                      placeholder=\"Current password\"\n                      className=\"input-df\"\n                      data-testid=\"input-current-password\"\n                    />\n                    <Input\n                      type=\"password\"\n                      placeholder=\"New password\"\n                      className=\"input-df\"\n                      data-testid=\"input-new-password\"\n                    />\n                    <Input\n                      type=\"password\"\n                      placeholder=\"Confirm new password\"\n                      className=\"input-df\"\n                      data-testid=\"input-confirm-password\"\n                    />\n                    <Button className=\"w-full btn-primary\" data-testid=\"button-change-password\">\n                      Update Password\n                    </Button>\n                  </div>\n                </div>\n              </CardContent>\n            </Card>\n          </TabsContent>\n\n          {/* Data & Privacy Tab */}\n          <TabsContent value=\"data\">\n            <Card className=\"card-df\">\n              <CardHeader>\n                <CardTitle className=\"text-xl neon-subheading\">\n                  Data & Privacy\n                </CardTitle>\n              </CardHeader>\n              <CardContent className=\"space-y-6\">\n                {/* Data Export */}\n                <div className=\"bg-df-ink border border-df-steel rounded-md p-4\">\n                  <h4 className=\"text-df-snow font-semibold mb-2\">Export Your Data</h4>\n                  <p className=\"text-df-fog text-sm mb-4\">\n                    Download a copy of all your data including messages, content, and account information.\n                  </p>\n                  <Button \n                    onClick={handleExportData}\n                    className=\"btn-outline\"\n                    data-testid=\"button-export-data\"\n                  >\n                    <Download className=\"mr-2 h-4 w-4\" />\n                    Request Data Export\n                  </Button>\n                </div>\n\n                {/* GDPR Rights */}\n                <div className=\"bg-df-ink border border-df-steel rounded-md p-4\">\n                  <h4 className=\"text-df-snow font-semibold mb-2\">Your Privacy Rights</h4>\n                  <div className=\"space-y-2 text-df-fog text-sm\">\n                    <p>• Right to access your personal data</p>\n                    <p>• Right to rectify inaccurate data</p>\n                    <p>• Right to erase your data (right to be forgotten)</p>\n                    <p>• Right to restrict processing</p>\n                    <p>• Right to data portability</p>\n                    <p>• Right to object to processing</p>\n                  </div>\n                </div>\n\n                {/* Data Retention */}\n                <div className=\"bg-df-ink border border-df-steel rounded-md p-4\">\n                  <h4 className=\"text-df-snow font-semibold mb-2\">Data Retention</h4>\n                  <div className=\"space-y-2 text-df-fog text-sm\">\n                    <p>• Account data: Retained until account deletion</p>\n                    <p>• Financial records: 7 years (legal requirement)</p>\n                    <p>• Content: 2 years after deletion</p>\n                    <p>• Messages: 1 year after deletion</p>\n                    <p>• Compliance records: Permanently retained</p>\n                  </div>\n                </div>\n              </CardContent>\n            </Card>\n          </TabsContent>\n\n          {/* Account Tab */}\n          <TabsContent value=\"account\">\n            <Card className=\"card-df\">\n              <CardHeader>\n                <CardTitle className=\"text-xl neon-subheading\">\n                  Account Management\n                </CardTitle>\n              </CardHeader>\n              <CardContent className=\"space-y-6\">\n                {/* Account Info */}\n                <div className=\"bg-df-ink border border-df-steel rounded-md p-4\">\n                  <h4 className=\"text-df-snow font-semibold mb-3\">Account Information</h4>\n                  <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                    <div>\n                      <Label className=\"text-df-fog text-sm\">User ID</Label>\n                      <p className=\"text-df-snow font-mono text-sm\" data-testid=\"text-user-id\">{user.id}</p>\n                    </div>\n                    <div>\n                      <Label className=\"text-df-fog text-sm\">Email</Label>\n                      <p className=\"text-df-snow text-sm\" data-testid=\"text-email\">{user.email}</p>\n                    </div>\n                    <div>\n                      <Label className=\"text-df-fog text-sm\">Role</Label>\n                      <p className=\"text-df-snow text-sm capitalize\" data-testid=\"text-role\">{user.role}</p>\n                    </div>\n                    <div>\n                      <Label className=\"text-df-fog text-sm\">Account Status</Label>\n                      <p className=\"text-df-snow text-sm capitalize\" data-testid=\"text-status\">{user.status}</p>\n                    </div>\n                  </div>\n                </div>\n\n                {/* Deactivate Account */}\n                <div className=\"bg-yellow-900 bg-opacity-20 border border-yellow-600 rounded-md p-4\">\n                  <div className=\"flex items-start gap-3\">\n                    <AlertTriangle className=\"h-5 w-5 text-yellow-500 mt-0.5\" />\n                    <div className=\"flex-1\">\n                      <h4 className=\"text-yellow-200 font-semibold mb-2\">Deactivate Account</h4>\n                      <p className=\"text-yellow-100 text-sm mb-4\">\n                        Temporarily disable your account. You can reactivate it later by logging in.\n                      </p>\n                      <Button className=\"bg-yellow-600 hover:bg-yellow-700 text-black\" data-testid=\"button-deactivate\">\n                        Deactivate Account\n                      </Button>\n                    </div>\n                  </div>\n                </div>\n\n                {/* Delete Account */}\n                <div className=\"bg-red-900 bg-opacity-20 border border-red-600 rounded-md p-4\">\n                  <div className=\"flex items-start gap-3\">\n                    <Trash2 className=\"h-5 w-5 text-red-500 mt-0.5\" />\n                    <div className=\"flex-1\">\n                      <h4 className=\"text-red-200 font-semibold mb-2\">Delete Account Permanently</h4>\n                      <p className=\"text-red-100 text-sm mb-4\">\n                        This action cannot be undone. All your data, content, and messages will be permanently deleted.\n                        Financial records will be retained for legal compliance.\n                      </p>\n                      <Button \n                        onClick={handleDeleteAccount}\n                        className=\"bg-red-600 hover:bg-red-700 text-white\"\n                        data-testid=\"button-delete-account\"\n                      >\n                        Delete Account Permanently\n                      </Button>\n                    </div>\n                  </div>\n                </div>\n              </CardContent>\n            </Card>\n          </TabsContent>\n        </Tabs>\n      </main>\n\n      <Footer />\n    </div>\n  );\n}\n","size_bytes":26136},"server/middleware/csrf.ts":{"content":"import { Request, Response, NextFunction } from \"express\";\nimport crypto from \"crypto\";\nimport { logger } from \"../logger\";\n\nconst CSRF_SECRET = process.env.CSRF_SECRET || process.env.SESSION_SECRET || \"default-csrf-secret-change-in-production\";\n\ninterface CSRFOptions {\n  tokenHeader?: string;\n  tokenBody?: string;\n  cookieName?: string;\n  secretCookieName?: string;\n  ignoreMethods?: string[];\n}\n\nclass CSRFProtection {\n  private options: Required<CSRFOptions>;\n\n  constructor(options: CSRFOptions = {}) {\n    this.options = {\n      tokenHeader: \"x-csrf-token\",\n      tokenBody: \"_token\",\n      cookieName: \"csrf-token\",\n      secretCookieName: \"csrf-secret\",\n      ignoreMethods: [\"GET\", \"HEAD\", \"OPTIONS\"],\n      ...options,\n    };\n  }\n\n  private generateSecret(): string {\n    return crypto.randomBytes(24).toString(\"hex\");\n  }\n\n  private createToken(secret: string): string {\n    const salt = crypto.randomBytes(8).toString(\"hex\");\n    const hash = crypto.createHmac(\"sha256\", CSRF_SECRET)\n      .update(salt + secret)\n      .digest(\"hex\");\n    return salt + \":\" + hash;\n  }\n\n  private verifyToken(token: string, secret: string): boolean {\n    if (!token || !secret) return false;\n\n    const [salt, hash] = token.split(\":\");\n    if (!salt || !hash) return false;\n\n    const expectedHash = crypto.createHmac(\"sha256\", CSRF_SECRET)\n      .update(salt + secret)\n      .digest(\"hex\");\n\n    return crypto.timingSafeEqual(Buffer.from(hash), Buffer.from(expectedHash));\n  }\n\n  private signSecret(secret: string): string {\n    const signature = crypto.createHmac(\"sha256\", CSRF_SECRET)\n      .update(secret)\n      .digest(\"hex\");\n    return secret + \":\" + signature;\n  }\n\n  private verifySignedSecret(signedSecret: string): string | null {\n    if (!signedSecret) return null;\n\n    const [secret, signature] = signedSecret.split(\":\");\n    if (!secret || !signature) return null;\n\n    const expectedSignature = crypto.createHmac(\"sha256\", CSRF_SECRET)\n      .update(secret)\n      .digest(\"hex\");\n\n    if (!crypto.timingSafeEqual(Buffer.from(signature), Buffer.from(expectedSignature))) {\n      return null;\n    }\n\n    return secret;\n  }\n\n  middleware() {\n    return (req: Request, res: Response, next: NextFunction) => {\n      // Skip CSRF check for safe methods\n      if (this.options.ignoreMethods.includes(req.method)) {\n        // Get or generate secret\n        let secret: string | null = null;\n        const signedSecret = req.cookies?.[this.options.secretCookieName];\n        \n        if (signedSecret) {\n          secret = this.verifySignedSecret(signedSecret);\n        }\n        \n        if (!secret) {\n          secret = this.generateSecret();\n          const newSignedSecret = this.signSecret(secret);\n          const sameSite = process.env.NODE_ENV === \"production\" ? \"strict\" : \"lax\";\n          const cookieOptions = {\n            httpOnly: true,\n            secure: process.env.NODE_ENV === \"production\",\n            sameSite: sameSite as \"strict\" | \"lax\",\n            maxAge: 24 * 60 * 60 * 1000, // 24 hours\n          };\n          res.cookie(this.options.secretCookieName, newSignedSecret, cookieOptions);\n          logger.debug(`Set CSRF secret cookie with options: ${JSON.stringify(cookieOptions)}`);\n        }\n\n        // Generate and set token cookie\n        const token = this.createToken(secret);\n        const sameSite = process.env.NODE_ENV === \"production\" ? \"strict\" : \"lax\";\n        const tokenCookieOptions = {\n          httpOnly: false, // Allow frontend to read\n          secure: process.env.NODE_ENV === \"production\",\n          sameSite: sameSite as \"strict\" | \"lax\",\n        };\n        res.cookie(this.options.cookieName, token, tokenCookieOptions);\n        logger.debug(`Set CSRF token cookie with options: ${JSON.stringify(tokenCookieOptions)}`);\n        \n        return next();\n      }\n\n      // Get token from header or body\n      const token = req.get(this.options.tokenHeader) || req.body?.[this.options.tokenBody];\n      \n      // Get secret from signed cookie\n      const signedSecret = req.cookies?.[this.options.secretCookieName];\n      const secret = signedSecret ? this.verifySignedSecret(signedSecret) : null;\n\n      logger.debug(`CSRF validation for ${req.method} ${req.originalUrl}: ` +\n        `Token=${!!token}, SignedSecret=${!!signedSecret}, Secret=${!!secret}, ` +\n        `Cookies=${JSON.stringify(Object.keys(req.cookies || {}))}`);\n\n      if (!this.verifyToken(token || \"\", secret || \"\")) {\n        logger.warn(`CSRF token validation failed for ${req.method} ${req.originalUrl} from ${req.ip} - ` +\n          `Token: ${!!token}, SignedSecret: ${!!signedSecret}, Secret: ${!!secret}`);\n\n        return res.status(403).json({\n          error: \"Forbidden\",\n          message: \"Invalid CSRF token\",\n        });\n      }\n\n      next();\n    };\n  }\n\n  // Method to get current token for frontend\n  getToken(req: Request, res: Response): string {\n    // Get or generate secret\n    let secret: string | null = null;\n    const signedSecret = req.cookies?.[this.options.secretCookieName];\n    \n    if (signedSecret) {\n      secret = this.verifySignedSecret(signedSecret);\n    }\n    \n    if (!secret) {\n      secret = this.generateSecret();\n      const newSignedSecret = this.signSecret(secret);\n      const sameSite = process.env.NODE_ENV === \"production\" ? \"strict\" : \"lax\";\n      res.cookie(this.options.secretCookieName, newSignedSecret, {\n        httpOnly: true,\n        secure: process.env.NODE_ENV === \"production\",\n        sameSite: sameSite as \"strict\" | \"lax\",\n        maxAge: 24 * 60 * 60 * 1000, // 24 hours\n      });\n    }\n\n    return this.createToken(secret);\n  }\n}\n\nexport const csrfProtection = new CSRFProtection();\n\n// API endpoint to get CSRF token\nexport const getCSRFToken = (req: Request, res: Response) => {\n  const token = csrfProtection.getToken(req, res);\n  res.json({ token });\n};\n","size_bytes":5847},"replit.md":{"content":"# Overview\n\nDaddyFanz is a full-stack adult content creator platform designed for subscription-based monetization, secure adult-friendly payment processing, advanced content moderation, and real-time communication. It provides a comprehensive solution for creators to share content and connect with fans, ensuring compliance with adult industry regulations including age verification and 18 U.S.C. § 2257 record-keeping. Key capabilities include JWT-based authentication, media management, AI-powered content moderation with human review, live streaming with real-time tipping, and a robust payment ecosystem. The platform also features advanced enterprise capabilities like NFT blockchain content ownership, a fan-to-creator microlending system, and enhanced deepfake and AI content detection.\n\n# User Preferences\n\nPreferred communication style: Simple, everyday language.\n\n## Domain Configuration\n- **Production Domain**: daddiesFanz.com\n- **Testing Domain**: fanz.daddiesfanz.com (for staging/testing)\n- CORS configured for both custom domains + Replit dev domain\n\n# System Architecture\n\n## Frontend Architecture\n\nThe client-side application is built with React 18 and TypeScript, utilizing Vite for development and optimized production builds. Wouter is used for routing, and React Query manages server state. The UI leverages Radix UI primitives for accessible headless components, styled with Tailwind CSS, following a custom \"DaddyFanz\" brand identity with neon cyan, metallic gold, and dark industrial themes. The component architecture is modular and reusable.\n\n## Backend Architecture\n\nThe server uses Node.js with Express.js, implementing a RESTful API with middleware for security, rate limiting, CSRF protection, and request validation. It employs JWT-based authentication with email/password credentials. Database operations are handled by Drizzle ORM with PostgreSQL. Real-time functionality is provided via WebSockets for messaging, notifications, and content updates. Specialized services manage adult-friendly payment processing, AI-powered content moderation with human review workflows, and notification delivery.\n\n## Security and Compliance\n\nThe platform employs multiple layers of security, including CSRF protection, rate limiting, secure JWT token management, and comprehensive audit logging. Content moderation involves automated AI scanning (NSFW level, deepfake, prohibited content detection) with configurable thresholds and mandatory human review. Compliance features include 18 U.S.C. § 2257 record-keeping, age verification, KYC for creators, and forensic content signatures. Authentication architecture includes SHA-256 token hashing for password reset/email recovery, atomic token redemption, and role-based access control.\n\n## Data Storage and Management\n\nMedia files are stored using S3-compatible object storage with forensic signatures. The PostgreSQL database schema supports complex relationships between users, content, subscriptions, and financial transactions with proper indexing. JWT tokens are used for API authentication, with secure password reset and email recovery flows. Automated cleanup processes handle expired tokens and sessions. Database schemas include features for NFT content ownership (multi-blockchain support, royalty enforcement), fan-to-creator microlending (escrow protection, revenue-based repayment), and AI content detection (multi-provider scanning, deepfake detection, forensic watermarking).\n\n## Core Features and Implementations\n\n- **Authentication System**: JWT-only authentication with email/password, secure password reset, email recovery, and CSRF protection.\n- **Dual Onboarding System**: Distinct onboarding flows for Creators (Stars) and Fanz with role-specific UX, profile setup, interest selection, and progress tracking.\n- **AI Content Moderation**: Advanced AI detects NSFW levels, deepfakes, prohibited content, and performs scene/face analysis, with human review workflows.\n- **Live Streaming**: Full lifecycle management for live streams, real-time viewer tracking, chat, tipping, and VOD recording.\n- **Enterprise Features**: Creator Collaboration, Tiered Subscriptions, Content Bundles, Virtual Gifts, Leaderboards, Referral Program, Content Scheduling, Creator Verification Badges, Geo-blocking Controls, and DMCA Rights Management.\n- **NFT Blockchain Content Ownership**: Enables creators to mint content as NFTs with perpetual royalty tracking across secondary sales, multi-blockchain support, and automated smart contract deployment.\n- **Fan-to-Creator Microlending System**: Allows fans to support creators through structured microloans with escrow protection, configurable loan programs, and revenue-based repayment.\n- **Enhanced Deepfake & AI Content Detection**: Multi-provider scanning for deepfake and prohibited content, forensic watermarking, perceptual hashing, and provenance tracking.\n- **FanzTrust™ Payment Ecosystem**: Transaction verification, refund processing, multi-gateway support, trust score system, device fingerprinting, and FanzWallet management.\n- **Creator Analytics Dashboard**: Real-time stats, cumulative metrics, and daily activity tracking.\n\n# External Dependencies\n\n## Payment Processing Services\n- **CCBill, Segpay, Epoch, Vendo, Verotel**: Primary adult-friendly payment processors.\n- **Paxum, ePayService, Wise**: Creator payout solutions.\n\n## Database and Storage\n- **PostgreSQL**: Primary database via Neon Database.\n- **S3-compatible storage**: Media file storage.\n- **Redis**: Optional caching layer.\n\n## Authentication and Security\n- **JWT**: Token-based authentication.\n- **bcrypt**: Secure password hashing.\n\n## Development and Monitoring\n- **Vite**: Frontend build tool.\n- **Drizzle ORM**: Database interaction and schema management.\n- **Pino**: Structured logging.\n- **React Query**: Client-side data fetching.\n\n## UI and Design\n- **Radix UI**: Headless component primitives.\n- **Tailwind CSS**: Styling framework.\n- **Lucide React**: Icon library.\n- **Google Fonts**: Typography.\n\n## Communication\n- **WebSocket**: Real-time messaging and notifications.\n- **Email services**: Transactional emails.\n- **Push notifications**: Mobile and web delivery.\n\n## AI Content Moderation\n- **OpenAI GPT-5**: Text content analysis for policy violations (implemented)\n- **Hive Moderation, Reality Defender, AWS Rekognition**: AI content scanning providers (future integration for visual analysis).\n\n## Recent Implementations (October 2025)\n\n### Completed Features\n1. **Audit Logging to Database** - All audit logs now persist to `audit_logs` table for compliance\n2. **Scheduled Posts Publishing** - Automated system publishes scheduled posts at specified times\n3. **Leaderboards** - Dynamic leaderboard calculation for top earners and creators by period\n4. **Referral Rewards** - Automated 5% commission processing for referral program\n5. **WebSocket Management** - Full client connection tracking, room subscriptions, real-time messaging, and broadcast support\n6. **AI Content Moderation** - OpenAI GPT-5 integration for text content moderation with policy violation detection\n\n### Email Notifications\n- **SendGrid Integration**: User dismissed the Replit SendGrid connector. \n- **Note for Future**: To implement email notifications, either:\n  1. Set up SendGrid connector via Replit integrations UI\n  2. Manually provide SENDGRID_API_KEY as a secret and implement using @sendgrid/mail package\n  3. Use alternative email service (AWS SES, Mailgun, etc.)\n- Current implementation in `server/services/notificationService.ts` has placeholder methods ready for integration","size_bytes":7594},"client/src/pages/OnboardingInterests.tsx":{"content":"import { useState } from \"react\";\nimport { useLocation } from \"wouter\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Checkbox } from \"@/components/ui/checkbox\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { Loader2 } from \"lucide-react\";\n\nexport default function OnboardingInterests() {\n  const [, setLocation] = useLocation();\n  const { toast } = useToast();\n  const [selectedNiches, setSelectedNiches] = useState<string[]>([]);\n  const [isSubmitting, setIsSubmitting] = useState(false);\n\n  const { data: user } = useQuery<any>({\n    queryKey: [\"/api/auth/user\"],\n  });\n\n  const { data: niches, isLoading } = useQuery<any[]>({\n    queryKey: [\"/api/niches\"],\n  });\n\n  const isCreator = user?.role === \"creator\";\n\n  const toggleNiche = (nicheId: string) => {\n    setSelectedNiches((prev) =>\n      prev.includes(nicheId)\n        ? prev.filter((id) => id !== nicheId)\n        : [...prev, nicheId]\n    );\n  };\n\n  const handleContinue = async () => {\n    if (selectedNiches.length === 0) {\n      toast({\n        title: \"Select at least one interest\",\n        description: \"This helps us personalize your experience\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    setIsSubmitting(true);\n    try {\n      await apiRequest(\"/api/onboarding/select-interests\", {\n        method: \"POST\",\n        body: JSON.stringify({ nicheIds: selectedNiches }),\n      });\n\n      await apiRequest(\"/api/onboarding/complete\", {\n        method: \"POST\",\n      });\n\n      queryClient.invalidateQueries({ queryKey: [\"/api/onboarding/progress\"] });\n      setLocation(\"/onboarding/complete\");\n    } catch (error) {\n      toast({\n        title: \"Error\",\n        description: \"Failed to save interests. Please try again.\",\n        variant: \"destructive\",\n      });\n    } finally {\n      setIsSubmitting(false);\n    }\n  };\n\n  if (isLoading) {\n    return (\n      <div className=\"min-h-screen bg-gradient-to-br from-black via-gray-900 to-black flex items-center justify-center\">\n        <Loader2 className=\"w-8 h-8 animate-spin text-cyan-400\" />\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"min-h-screen bg-gradient-to-br from-black via-gray-900 to-black flex items-center justify-center p-4 sm:p-6 lg:p-8\">\n      <Card className=\"max-w-4xl w-full border-2 border-cyan-500/30 bg-black/40 backdrop-blur\">\n        <CardHeader className=\"text-center pb-4 sm:pb-6\">\n          <CardTitle className=\"text-2xl sm:text-3xl font-bold bg-gradient-to-r from-cyan-400 to-blue-500 bg-clip-text text-transparent\">\n            {isCreator ? \"What Do You Create?\" : \"What Are You Into?\"}\n          </CardTitle>\n          <p className=\"text-sm sm:text-base text-gray-400 mt-2\">\n            {isCreator\n              ? \"Select the niches that match your content\"\n              : \"Pick your interests to discover amazing creators\"}\n          </p>\n          <p className=\"text-xs sm:text-sm text-gray-500 mt-1\">\n            Select as many as you like\n          </p>\n        </CardHeader>\n        <CardContent className=\"space-y-4 sm:space-y-6 pt-0\">\n          <div className=\"grid grid-cols-1 md:grid-cols-2 gap-3 sm:gap-4\">\n            {niches?.map((niche) => (\n              <div\n                key={niche.id}\n                className={`\n                  relative border-2 rounded-lg p-3 sm:p-4 transition-all\n                  ${\n                    selectedNiches.includes(niche.id)\n                      ? \"border-cyan-500 bg-cyan-500/10\"\n                      : \"border-gray-700 bg-gray-900/30\"\n                  }\n                `}\n                data-testid={`niche-${niche.slug}`}\n              >\n                <div className=\"flex items-start gap-2.5 sm:gap-3\">\n                  <Checkbox\n                    checked={selectedNiches.includes(niche.id)}\n                    onCheckedChange={() => toggleNiche(niche.id)}\n                    className=\"mt-0.5 sm:mt-1 flex-shrink-0\"\n                    data-testid={`checkbox-niche-${niche.slug}`}\n                  />\n                  <label \n                    htmlFor={`checkbox-${niche.id}`}\n                    className=\"flex-1 cursor-pointer min-h-[44px] flex flex-col justify-center\"\n                    onClick={() => toggleNiche(niche.id)}\n                  >\n                    <h3 className=\"font-semibold text-white text-sm sm:text-base mb-1\">{niche.name}</h3>\n                    <p className=\"text-xs sm:text-sm text-gray-400 leading-relaxed\">{niche.description}</p>\n                  </label>\n                </div>\n              </div>\n            ))}\n          </div>\n\n          {selectedNiches.length > 0 && (\n            <div className=\"text-center text-xs sm:text-sm text-gray-400\">\n              {selectedNiches.length} {selectedNiches.length === 1 ? \"interest\" : \"interests\"} selected\n            </div>\n          )}\n\n          <div className=\"flex flex-col sm:flex-row gap-3 sm:gap-4 pt-4 sm:pt-6\">\n            <Button\n              type=\"button\"\n              variant=\"outline\"\n              onClick={() => setLocation(\"/onboarding/profile\")}\n              className=\"w-full sm:flex-1 border-gray-700 text-gray-300 hover:bg-gray-800 h-11 sm:h-auto\"\n              disabled={isSubmitting}\n              data-testid=\"button-back\"\n            >\n              Back\n            </Button>\n            <Button\n              onClick={handleContinue}\n              className=\"w-full sm:flex-1 bg-gradient-to-r from-cyan-500 to-blue-600 hover:from-cyan-600 hover:to-blue-700 text-white font-bold h-11 sm:h-auto\"\n              disabled={isSubmitting || selectedNiches.length === 0}\n              data-testid=\"button-continue\"\n            >\n              {isSubmitting ? (\n                <>\n                  <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />\n                  Finishing...\n                </>\n              ) : (\n                \"Complete Setup\"\n              )}\n            </Button>\n          </div>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","size_bytes":6140},"client/src/pages/ResetPassword.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { useLocation } from \"wouter\";\nimport daddyFanzLogo from \"@assets/daddyfanzlogo1_1759189347461.png\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { Shield, Check } from \"lucide-react\";\n\nexport default function ResetPassword() {\n  const [, setLocation] = useLocation();\n  const { toast } = useToast();\n  const [token, setToken] = useState<string>(\"\");\n  const [password, setPassword] = useState(\"\");\n  const [confirmPassword, setConfirmPassword] = useState(\"\");\n  const [isSubmitting, setIsSubmitting] = useState(false);\n  const [resetComplete, setResetComplete] = useState(false);\n\n  useEffect(() => {\n    const params = new URLSearchParams(window.location.search);\n    const tokenParam = params.get(\"token\");\n    \n    if (!tokenParam) {\n      toast({\n        title: \"Invalid Link\",\n        description: \"No reset token found. Please request a new password reset link.\",\n        variant: \"destructive\",\n      });\n      setTimeout(() => setLocation(\"/\"), 3000);\n    } else {\n      setToken(tokenParam);\n    }\n  }, [toast, setLocation]);\n\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault();\n    \n    if (password !== confirmPassword) {\n      toast({\n        title: \"Password Mismatch\",\n        description: \"Passwords don't match. Please try again.\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    if (password.length < 8) {\n      toast({\n        title: \"Password Too Short\",\n        description: \"Password must be at least 8 characters long.\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    setIsSubmitting(true);\n\n    try {\n      await apiRequest(\"POST\", \"/api/auth/reset-password\", {\n        token,\n        password,\n        confirmPassword,\n      });\n\n      toast({\n        title: \"Password Reset Successful\",\n        description: \"Your password has been updated. Redirecting to login...\",\n      });\n\n      setResetComplete(true);\n      setTimeout(() => setLocation(\"/\"), 3000);\n    } catch (error) {\n      toast({\n        title: \"Reset Failed\",\n        description: error instanceof Error ? error.message : \"Invalid or expired token. Please request a new reset link.\",\n        variant: \"destructive\",\n      });\n    } finally {\n      setIsSubmitting(false);\n    }\n  };\n\n  if (resetComplete) {\n    return (\n      <div className=\"min-h-screen bg-df-dungeon flex items-center justify-center px-4\">\n        <Card className=\"card-df max-w-md w-full\">\n          <CardContent className=\"pt-6 text-center\">\n            <div className=\"flex justify-center mb-6\">\n              <div className=\"h-16 w-16 bg-df-cyan rounded-full flex items-center justify-center\">\n                <Check className=\"h-8 w-8 text-df-dungeon\" />\n              </div>\n            </div>\n            <h2 className=\"text-2xl neon-heading mb-4\">Password Updated!</h2>\n            <p className=\"text-df-fog mb-4\">\n              Your password has been successfully reset. You can now sign in with your new password.\n            </p>\n            <p className=\"text-df-steel text-sm\">Redirecting to login...</p>\n          </CardContent>\n        </Card>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"min-h-screen bg-df-dungeon flex items-center justify-center px-4\">\n      <div className=\"max-w-md w-full\">\n        {/* Logo */}\n        <div className=\"flex justify-center mb-8\">\n          <img \n            src={daddyFanzLogo} \n            alt=\"DaddyFanz\" \n            className=\"h-24 w-auto glow-image animate-pulse-glow\"\n          />\n        </div>\n\n        <Card className=\"card-df\">\n          <CardHeader>\n            <div className=\"flex justify-center mb-4\">\n              <Shield className=\"h-12 w-12 text-df-cyan\" />\n            </div>\n            <CardTitle className=\"text-2xl neon-heading-caps text-center\">\n              Reset Your Password\n            </CardTitle>\n          </CardHeader>\n          <CardContent>\n            <form onSubmit={handleSubmit} className=\"space-y-4\">\n              <div>\n                <Label htmlFor=\"password\" className=\"text-df-fog\">New Password</Label>\n                <Input\n                  id=\"password\"\n                  type=\"password\"\n                  value={password}\n                  onChange={(e) => setPassword(e.target.value)}\n                  className=\"input-df\"\n                  placeholder=\"Enter new password\"\n                  required\n                  minLength={8}\n                  data-testid=\"input-new-password\"\n                />\n                <p className=\"text-df-fog text-xs mt-1\">\n                  Must be at least 8 characters\n                </p>\n              </div>\n\n              <div>\n                <Label htmlFor=\"confirmPassword\" className=\"text-df-fog\">Confirm Password</Label>\n                <Input\n                  id=\"confirmPassword\"\n                  type=\"password\"\n                  value={confirmPassword}\n                  onChange={(e) => setConfirmPassword(e.target.value)}\n                  className=\"input-df\"\n                  placeholder=\"Confirm new password\"\n                  required\n                  minLength={8}\n                  data-testid=\"input-confirm-password\"\n                />\n              </div>\n\n              <Button \n                type=\"submit\" \n                disabled={isSubmitting || !token}\n                className=\"w-full btn-secondary\"\n                data-testid=\"button-reset-password\"\n              >\n                {isSubmitting ? \"Resetting Password...\" : \"Reset Password\"}\n              </Button>\n            </form>\n\n            <div className=\"mt-6 text-center\">\n              <button\n                onClick={() => setLocation(\"/\")}\n                className=\"text-df-cyan hover:text-df-gold transition-colors text-sm\"\n                data-testid=\"button-back-home\"\n              >\n                Back to Sign In\n              </button>\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n    </div>\n  );\n}\n","size_bytes":6254},"client/src/components/ui/navigation-menu.tsx":{"content":"import * as React from \"react\"\nimport * as NavigationMenuPrimitive from \"@radix-ui/react-navigation-menu\"\nimport { cva } from \"class-variance-authority\"\nimport { ChevronDown } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst NavigationMenu = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Root>\n>(({ className, children, ...props }, ref) => (\n  <NavigationMenuPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative z-10 flex max-w-max flex-1 items-center justify-center\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <NavigationMenuViewport />\n  </NavigationMenuPrimitive.Root>\n))\nNavigationMenu.displayName = NavigationMenuPrimitive.Root.displayName\n\nconst NavigationMenuList = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.List\n    ref={ref}\n    className={cn(\n      \"group flex flex-1 list-none items-center justify-center space-x-1\",\n      className\n    )}\n    {...props}\n  />\n))\nNavigationMenuList.displayName = NavigationMenuPrimitive.List.displayName\n\nconst NavigationMenuItem = NavigationMenuPrimitive.Item\n\nconst navigationMenuTriggerStyle = cva(\n  \"group inline-flex h-10 w-max items-center justify-center rounded-md bg-background px-4 py-2 text-sm font-medium transition-colors hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground focus:outline-none disabled:pointer-events-none disabled:opacity-50 data-[state=open]:text-accent-foreground data-[state=open]:bg-accent/50 data-[state=open]:hover:bg-accent data-[state=open]:focus:bg-accent\"\n)\n\nconst NavigationMenuTrigger = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <NavigationMenuPrimitive.Trigger\n    ref={ref}\n    className={cn(navigationMenuTriggerStyle(), \"group\", className)}\n    {...props}\n  >\n    {children}{\" \"}\n    <ChevronDown\n      className=\"relative top-[1px] ml-1 h-3 w-3 transition duration-200 group-data-[state=open]:rotate-180\"\n      aria-hidden=\"true\"\n    />\n  </NavigationMenuPrimitive.Trigger>\n))\nNavigationMenuTrigger.displayName = NavigationMenuPrimitive.Trigger.displayName\n\nconst NavigationMenuContent = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.Content\n    ref={ref}\n    className={cn(\n      \"left-0 top-0 w-full data-[motion^=from-]:animate-in data-[motion^=to-]:animate-out data-[motion^=from-]:fade-in data-[motion^=to-]:fade-out data-[motion=from-end]:slide-in-from-right-52 data-[motion=from-start]:slide-in-from-left-52 data-[motion=to-end]:slide-out-to-right-52 data-[motion=to-start]:slide-out-to-left-52 md:absolute md:w-auto \",\n      className\n    )}\n    {...props}\n  />\n))\nNavigationMenuContent.displayName = NavigationMenuPrimitive.Content.displayName\n\nconst NavigationMenuLink = NavigationMenuPrimitive.Link\n\nconst NavigationMenuViewport = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Viewport>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Viewport>\n>(({ className, ...props }, ref) => (\n  <div className={cn(\"absolute left-0 top-full flex justify-center\")}>\n    <NavigationMenuPrimitive.Viewport\n      className={cn(\n        \"origin-top-center relative mt-1.5 h-[var(--radix-navigation-menu-viewport-height)] w-full overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-90 md:w-[var(--radix-navigation-menu-viewport-width)]\",\n        className\n      )}\n      ref={ref}\n      {...props}\n    />\n  </div>\n))\nNavigationMenuViewport.displayName =\n  NavigationMenuPrimitive.Viewport.displayName\n\nconst NavigationMenuIndicator = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Indicator>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Indicator>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.Indicator\n    ref={ref}\n    className={cn(\n      \"top-full z-[1] flex h-1.5 items-end justify-center overflow-hidden data-[state=visible]:animate-in data-[state=hidden]:animate-out data-[state=hidden]:fade-out data-[state=visible]:fade-in\",\n      className\n    )}\n    {...props}\n  >\n    <div className=\"relative top-[60%] h-2 w-2 rotate-45 rounded-tl-sm bg-border shadow-md\" />\n  </NavigationMenuPrimitive.Indicator>\n))\nNavigationMenuIndicator.displayName =\n  NavigationMenuPrimitive.Indicator.displayName\n\nexport {\n  navigationMenuTriggerStyle,\n  NavigationMenu,\n  NavigationMenuList,\n  NavigationMenuItem,\n  NavigationMenuContent,\n  NavigationMenuTrigger,\n  NavigationMenuLink,\n  NavigationMenuIndicator,\n  NavigationMenuViewport,\n}\n","size_bytes":5128},"client/src/components/ui/skeleton.tsx":{"content":"import { cn } from \"@/lib/utils\"\n\nfunction Skeleton({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) {\n  return (\n    <div\n      className={cn(\"animate-pulse rounded-md bg-muted\", className)}\n      {...props}\n    />\n  )\n}\n\nexport { Skeleton }\n","size_bytes":261},"client/src/components/ui/accordion.tsx":{"content":"import * as React from \"react\"\nimport * as AccordionPrimitive from \"@radix-ui/react-accordion\"\nimport { ChevronDown } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Accordion = AccordionPrimitive.Root\n\nconst AccordionItem = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Item>\n>(({ className, ...props }, ref) => (\n  <AccordionPrimitive.Item\n    ref={ref}\n    className={cn(\"border-b\", className)}\n    {...props}\n  />\n))\nAccordionItem.displayName = \"AccordionItem\"\n\nconst AccordionTrigger = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <AccordionPrimitive.Header className=\"flex\">\n    <AccordionPrimitive.Trigger\n      ref={ref}\n      className={cn(\n        \"flex flex-1 items-center justify-between py-4 font-medium transition-all hover:underline [&[data-state=open]>svg]:rotate-180\",\n        className\n      )}\n      {...props}\n    >\n      {children}\n      <ChevronDown className=\"h-4 w-4 shrink-0 transition-transform duration-200\" />\n    </AccordionPrimitive.Trigger>\n  </AccordionPrimitive.Header>\n))\nAccordionTrigger.displayName = AccordionPrimitive.Trigger.displayName\n\nconst AccordionContent = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <AccordionPrimitive.Content\n    ref={ref}\n    className=\"overflow-hidden text-sm transition-all data-[state=closed]:animate-accordion-up data-[state=open]:animate-accordion-down\"\n    {...props}\n  >\n    <div className={cn(\"pb-4 pt-0\", className)}>{children}</div>\n  </AccordionPrimitive.Content>\n))\n\nAccordionContent.displayName = AccordionPrimitive.Content.displayName\n\nexport { Accordion, AccordionItem, AccordionTrigger, AccordionContent }\n","size_bytes":1977},"client/src/hooks/useCSRF.ts":{"content":"import { useQuery } from \"@tanstack/react-query\";\nimport { useCallback, useEffect } from \"react\";\nimport { setCSRFToken as storeCSRFToken } from \"@/lib/queryClient\";\n\ninterface CSRFResponse {\n  token: string;\n}\n\nexport function useCSRF() {\n  const { data: csrfData, refetch } = useQuery<CSRFResponse>({\n    queryKey: [\"/api/csrf-token\"],\n    staleTime: 10 * 60 * 1000, // 10 minutes\n    refetchOnWindowFocus: false,\n  });\n\n  // Store CSRF token in module-level cache when it changes\n  useEffect(() => {\n    if (csrfData?.token) {\n      storeCSRFToken(csrfData.token);\n    }\n  }, [csrfData]);\n\n  const getCSRFToken = useCallback(() => {\n    return csrfData?.token || \"\";\n  }, [csrfData]);\n\n  const refreshCSRFToken = useCallback(async () => {\n    await refetch();\n  }, [refetch]);\n\n  return {\n    token: getCSRFToken(),\n    getCSRFToken,\n    refreshCSRFToken,\n  };\n}\n\n// Helper hook to add CSRF token to API requests\nexport function useCSRFHeaders() {\n  const { token } = useCSRF();\n\n  const getHeaders = useCallback((additionalHeaders: Record<string, string> = {}) => {\n    return {\n      \"Content-Type\": \"application/json\",\n      \"X-CSRF-Token\": token,\n      ...additionalHeaders,\n    };\n  }, [token]);\n\n  return { getHeaders, token };\n}\n","size_bytes":1239},"client/src/pages/Landing.tsx":{"content":"import { useState } from \"react\";\nimport { useAuth } from \"@/hooks/useAuth\";\nimport daddyFanzLogo from \"@assets/daddyfanzlogo1_1759189347461.png\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { useCSRFHeaders } from \"@/hooks/useCSRF\";\nimport { AlertTriangle, Shield, DollarSign, Users, Eye, Zap } from \"lucide-react\";\n\nexport default function Landing() {\n  const { isLoading } = useAuth();\n  const { toast } = useToast();\n  const { token: csrfToken } = useCSRFHeaders();\n  const [showAuthModal, setShowAuthModal] = useState(false);\n  const [authMode, setAuthMode] = useState<\"login\" | \"register\">(\"login\");\n  const [formData, setFormData] = useState({\n    email: \"\",\n    password: \"\",\n    confirmPassword: \"\",\n    username: \"\",\n  });\n  const [isSubmitting, setIsSubmitting] = useState(false);\n\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault();\n    \n    // Ensure CSRF token is available\n    if (!csrfToken) {\n      toast({\n        title: \"Please wait\",\n        description: \"Security token is loading. Please try again in a moment.\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n    \n    setIsSubmitting(true);\n\n    try {\n      if (authMode === \"register\") {\n        if (formData.password !== formData.confirmPassword) {\n          throw new Error(\"Passwords don't match\");\n        }\n        \n        await apiRequest(\"POST\", \"/api/auth/signup\", formData);\n        \n        toast({\n          title: \"Account Created\",\n          description: \"Welcome to DaddyFanz! Please log in to continue.\",\n        });\n        \n        setAuthMode(\"login\");\n      } else {\n        const response = await apiRequest(\"POST\", \"/api/auth/login\", {\n          email: formData.email,\n          password: formData.password,\n        });\n        \n        const data = await response.json();\n        localStorage.setItem(\"authToken\", data.token);\n        \n        toast({\n          title: \"Welcome Back\",\n          description: \"You've been logged in successfully.\",\n        });\n        \n        // Trigger auth refresh\n        window.location.reload();\n      }\n    } catch (error) {\n      toast({\n        title: \"Authentication Failed\",\n        description: error instanceof Error ? error.message : \"Please try again.\",\n        variant: \"destructive\",\n      });\n    } finally {\n      setIsSubmitting(false);\n    }\n  };\n\n  const [showForgotPassword, setShowForgotPassword] = useState(false);\n\n  if (isLoading) {\n    return (\n      <div className=\"min-h-screen bg-df-dungeon flex items-center justify-center\">\n        <div className=\"text-df-cyan text-xl font-display\">Loading DaddyFanz...</div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"min-h-screen bg-df-dungeon\">\n      {/* Hero Section */}\n      <div className=\"relative overflow-hidden\">\n        <div className=\"absolute inset-0 bg-chain-pattern opacity-5\"></div>\n        \n        <div className=\"relative max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-20\">\n          <div className=\"text-center\">\n            {/* Logo */}\n            <div className=\"mb-8\">\n              <div className=\"flex justify-center mb-6\">\n                <img \n                  src={daddyFanzLogo} \n                  alt=\"DaddyFanz\" \n                  className=\"h-32 w-auto md:h-40 lg:h-48 glow-image animate-pulse-glow\"\n                />\n              </div>\n              <p className=\"text-df-fog text-xl max-w-2xl mx-auto\">\n                The ultimate adult content creator platform. Raw, dominant, and unapologetically bold.\n              </p>\n            </div>\n\n            {/* CTA Buttons */}\n            <div className=\"flex flex-col sm:flex-row gap-4 justify-center mb-16\">\n              <Button \n                onClick={() => {\n                  setAuthMode(\"register\");\n                  setShowAuthModal(true);\n                }}\n                className=\"btn-primary px-8 py-4 text-lg pulse-glow\"\n                data-testid=\"button-signup\"\n              >\n                <Zap className=\"mr-2 h-5 w-5\" />\n                Join the Kingdom\n              </Button>\n              \n              <Button \n                onClick={() => {\n                  setAuthMode(\"login\");\n                  setShowAuthModal(true);\n                }}\n                className=\"bg-df-dom text-df-snow px-8 py-4 text-lg hover:shadow-glow\"\n                data-testid=\"button-login\"\n              >\n                Sign In\n              </Button>\n            </div>\n\n            {/* Age Verification Notice */}\n            <div className=\"flex items-center justify-center gap-2 text-df-fog text-sm\">\n              <AlertTriangle className=\"h-4 w-4 text-df-gold\" />\n              <span>18+ Only. By joining, you confirm you are of legal age.</span>\n            </div>\n          </div>\n        </div>\n      </div>\n\n      {/* Features Section */}\n      <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-20\">\n        <h2 className=\"text-3xl text-center mb-12 neon-heading-caps\">\n          Built for Creators, Designed for Dominance\n        </h2>\n        \n        <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8\">\n          {/* Feature 1 */}\n          <Card className=\"card-df p-6\">\n            <CardHeader>\n              <DollarSign className=\"h-12 w-12 text-df-gold mb-4\" />\n              <CardTitle className=\"neon-subheading\">Adult-Friendly Payments</CardTitle>\n            </CardHeader>\n            <CardContent>\n              <p className=\"text-df-fog\">\n                Integrated with CCBill, Segpay, and Paxum. Never worry about payment processor bans again.\n              </p>\n            </CardContent>\n          </Card>\n\n          {/* Feature 2 */}\n          <Card className=\"card-df p-6\">\n            <CardHeader>\n              <Shield className=\"h-12 w-12 text-df-cyan mb-4\" />\n              <CardTitle className=\"neon-subheading\">Compliance Built-In</CardTitle>\n            </CardHeader>\n            <CardContent>\n              <p className=\"text-df-fog\">\n                18 U.S.C. §2257 compliance, KYC verification, and GDPR ready. Your safety is our priority.\n              </p>\n            </CardContent>\n          </Card>\n\n          {/* Feature 3 */}\n          <Card className=\"card-df p-6\">\n            <CardHeader>\n              <Users className=\"h-12 w-12 text-df-gold mb-4\" />\n              <CardTitle className=\"neon-subheading\">Real-Time Interaction</CardTitle>\n            </CardHeader>\n            <CardContent>\n              <p className=\"text-df-fog\">\n                Live messaging, instant notifications, and WebSocket-powered real-time features.\n              </p>\n            </CardContent>\n          </Card>\n        </div>\n      </div>\n\n      {/* Stats Section */}\n      <div className=\"bg-df-brick py-16\">\n        <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8\">\n          <div className=\"grid grid-cols-1 md:grid-cols-3 gap-8 text-center\">\n            <div>\n              <div className=\"text-4xl neon-heading mb-2\">$2M+</div>\n              <div className=\"text-df-fog\">Creator Earnings</div>\n            </div>\n            <div>\n              <div className=\"text-4xl glow-text-gold mb-2\">10K+</div>\n              <div className=\"text-df-fog\">Active Creators</div>\n            </div>\n            <div>\n              <div className=\"text-4xl neon-heading mb-2\">99.9%</div>\n              <div className=\"text-df-fog\">Uptime</div>\n            </div>\n          </div>\n        </div>\n      </div>\n\n      {/* Footer */}\n      <footer className=\"bg-df-ink py-12\">\n        <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8\">\n          <div className=\"grid grid-cols-1 md:grid-cols-4 gap-8\">\n            {/* Brand */}\n            <div>\n              <div className=\"text-xl mb-4\">\n                <span className=\"neon-heading\">Daddy</span><span className=\"glow-text-gold\">Fanz</span>\n              </div>\n              <p className=\"text-df-fog text-sm\">Adult content platform for creators and fans.</p>\n            </div>\n\n            {/* Compliance */}\n            <div>\n              <h4 className=\"text-df-snow font-semibold mb-4\">Compliance</h4>\n              <ul className=\"space-y-2 text-df-fog text-sm\">\n                <li>18 U.S.C. § 2257</li>\n                <li>GDPR Compliance</li>\n                <li>Age Verification</li>\n                <li>KYC/AML Policy</li>\n              </ul>\n            </div>\n\n            {/* Support */}\n            <div>\n              <h4 className=\"text-df-snow font-semibold mb-4\">Support</h4>\n              <ul className=\"space-y-2 text-df-fog text-sm\">\n                <li>Help Center</li>\n                <li>Creator Guide</li>\n                <li>Payment Help</li>\n                <li>Contact Us</li>\n              </ul>\n            </div>\n\n            {/* Legal */}\n            <div>\n              <h4 className=\"text-df-snow font-semibold mb-4\">Legal</h4>\n              <ul className=\"space-y-2 text-df-fog text-sm\">\n                <li>Terms of Service</li>\n                <li>Privacy Policy</li>\n                <li>DMCA Policy</li>\n                <li>Acceptable Use</li>\n              </ul>\n            </div>\n          </div>\n\n          <div className=\"chain-divider my-8\"></div>\n\n          <div className=\"flex flex-col md:flex-row justify-between items-center\">\n            <p className=\"text-df-fog text-sm\">© 2024 DaddyFanz. All rights reserved. Adult content platform 18+</p>\n            <div className=\"flex items-center space-x-4 mt-4 md:mt-0\">\n              <span className=\"text-df-fog text-sm\">Powered by:</span>\n              <div className=\"flex items-center space-x-2 text-df-steel text-xs\">\n                <span>CCBill</span>\n                <span>•</span>\n                <span>Segpay</span>\n                <span>•</span>\n                <span>Paxum</span>\n              </div>\n            </div>\n          </div>\n        </div>\n      </footer>\n\n      {/* Forgot Password Modal */}\n      {showForgotPassword && (\n        <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50\" onClick={() => setShowForgotPassword(false)}>\n          <Card className=\"card-df max-w-md w-full mx-4\" onClick={(e) => e.stopPropagation()}>\n            <CardHeader>\n              <CardTitle className=\"text-2xl neon-heading-caps text-center\">\n                Reset Password\n              </CardTitle>\n            </CardHeader>\n            <CardContent>\n              <form onSubmit={async (e) => {\n                e.preventDefault();\n                \n                // Ensure CSRF token is available\n                if (!csrfToken) {\n                  toast({\n                    title: \"Please wait\",\n                    description: \"Security token is loading. Please try again in a moment.\",\n                    variant: \"destructive\",\n                  });\n                  return;\n                }\n                \n                setIsSubmitting(true);\n                \n                try {\n                  await apiRequest(\"POST\", \"/api/auth/forgot-password\", {\n                    email: formData.email,\n                  });\n                  \n                  toast({\n                    title: \"Email Sent\",\n                    description: \"Check your email for password reset instructions.\",\n                  });\n                  \n                  setShowForgotPassword(false);\n                  setFormData(prev => ({ ...prev, email: \"\" }));\n                } catch (error) {\n                  toast({\n                    title: \"Error\",\n                    description: error instanceof Error ? error.message : \"Failed to send reset email\",\n                    variant: \"destructive\",\n                  });\n                } finally {\n                  setIsSubmitting(false);\n                }\n              }} className=\"space-y-4\">\n                <div>\n                  <Label htmlFor=\"reset-email\" className=\"text-df-fog\">Email Address</Label>\n                  <Input\n                    id=\"reset-email\"\n                    type=\"email\"\n                    value={formData.email}\n                    onChange={(e) => setFormData(prev => ({ ...prev, email: e.target.value }))}\n                    className=\"input-df\"\n                    placeholder=\"Enter your email\"\n                    required\n                    data-testid=\"input-reset-email\"\n                  />\n                  <p className=\"text-df-fog text-xs mt-2\">\n                    We'll send you a link to reset your password.\n                  </p>\n                </div>\n                \n                <Button \n                  type=\"submit\" \n                  disabled={isSubmitting || !csrfToken}\n                  className=\"w-full btn-secondary\"\n                  data-testid=\"button-send-reset\"\n                >\n                  {isSubmitting ? \"Sending...\" : \"Send Reset Link\"}\n                </Button>\n              </form>\n              \n              <div className=\"mt-4 text-center\">\n                <button\n                  onClick={() => {\n                    setShowForgotPassword(false);\n                    setShowAuthModal(true);\n                  }}\n                  className=\"text-df-cyan hover:text-df-gold transition-colors text-sm\"\n                  data-testid=\"button-back-to-login\"\n                >\n                  Back to Sign In\n                </button>\n              </div>\n            </CardContent>\n          </Card>\n        </div>\n      )}\n\n      {/* Auth Modal */}\n      {showAuthModal && (\n        <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50\" onClick={() => setShowAuthModal(false)}>\n          <Card className=\"card-df max-w-md w-full mx-4\" onClick={(e) => e.stopPropagation()}>\n            <CardHeader>\n              <CardTitle className=\"text-2xl neon-heading-caps text-center\">\n                {authMode === \"login\" ? \"Welcome Back\" : \"Join DaddyFanz\"}\n              </CardTitle>\n            </CardHeader>\n            <CardContent>\n              <form onSubmit={handleSubmit} className=\"space-y-4\">\n                {authMode === \"register\" && (\n                  <div>\n                    <Label htmlFor=\"username\" className=\"text-df-fog\">Username</Label>\n                    <Input\n                      id=\"username\"\n                      type=\"text\"\n                      value={formData.username}\n                      onChange={(e) => setFormData(prev => ({ ...prev, username: e.target.value }))}\n                      className=\"input-df\"\n                      required\n                      data-testid=\"input-username\"\n                    />\n                  </div>\n                )}\n                \n                <div>\n                  <Label htmlFor=\"email\" className=\"text-df-fog\">Email</Label>\n                  <Input\n                    id=\"email\"\n                    type=\"email\"\n                    value={formData.email}\n                    onChange={(e) => setFormData(prev => ({ ...prev, email: e.target.value }))}\n                    className=\"input-df\"\n                    required\n                    data-testid=\"input-email\"\n                  />\n                </div>\n                \n                <div>\n                  <Label htmlFor=\"password\" className=\"text-df-fog\">Password</Label>\n                  <Input\n                    id=\"password\"\n                    type=\"password\"\n                    value={formData.password}\n                    onChange={(e) => setFormData(prev => ({ ...prev, password: e.target.value }))}\n                    className=\"input-df\"\n                    required\n                    minLength={8}\n                    data-testid=\"input-password\"\n                  />\n                </div>\n                \n                {authMode === \"register\" && (\n                  <div>\n                    <Label htmlFor=\"confirmPassword\" className=\"text-df-fog\">Confirm Password</Label>\n                    <Input\n                      id=\"confirmPassword\"\n                      type=\"password\"\n                      value={formData.confirmPassword}\n                      onChange={(e) => setFormData(prev => ({ ...prev, confirmPassword: e.target.value }))}\n                      className=\"input-df\"\n                      required\n                      minLength={8}\n                      data-testid=\"input-confirm-password\"\n                    />\n                  </div>\n                )}\n                \n                <Button \n                  type=\"submit\" \n                  disabled={isSubmitting || !csrfToken}\n                  className=\"w-full btn-secondary\"\n                  data-testid=\"button-submit\"\n                >\n                  {isSubmitting ? \"Processing...\" : authMode === \"login\" ? \"Sign In\" : \"Create Account\"}\n                </Button>\n              </form>\n              \n              {authMode === \"login\" && (\n                <div className=\"mt-4 text-center\">\n                  <button\n                    onClick={() => {\n                      setShowAuthModal(false);\n                      setShowForgotPassword(true);\n                    }}\n                    className=\"text-df-cyan hover:text-df-gold transition-colors text-sm\"\n                    data-testid=\"button-forgot-password\"\n                  >\n                    Forgot your password?\n                  </button>\n                </div>\n              )}\n              \n              <div className=\"mt-4 text-center\">\n                <button\n                  onClick={() => setAuthMode(authMode === \"login\" ? \"register\" : \"login\")}\n                  className=\"text-df-cyan hover:text-df-gold transition-colors text-sm\"\n                  data-testid=\"button-toggle-auth\"\n                >\n                  {authMode === \"login\" ? \"Need an account? Sign up\" : \"Already have an account? Sign in\"}\n                </button>\n              </div>\n              \n              <p className=\"text-df-fog text-xs text-center mt-4\">\n                <AlertTriangle className=\"inline h-3 w-3 text-df-gold mr-1\" />\n                By joining, you confirm you are 18+ and agree to our Terms & Privacy Policy\n              </p>\n            </CardContent>\n          </Card>\n        </div>\n      )}\n    </div>\n  );\n}\n","size_bytes":18472},"client/src/pages/AIWiki.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { useAuth } from \"@/hooks/useAuth\";\nimport { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { Link } from \"wouter\";\nimport { \n  Search, \n  BookOpen, \n  TrendingUp, \n  Clock, \n  Eye, \n  ThumbsUp, \n  Bot, \n  Sparkles, \n  Filter,\n  ArrowRight,\n  MessageCircle,\n  Star,\n  Grid,\n  List\n} from \"lucide-react\";\nimport { useToast } from \"@/hooks/use-toast\";\n\ninterface WikiEntry {\n  id: string;\n  title: string;\n  content: string;\n  category: string;\n  tags: string[];\n  lastUpdated: Date;\n  viewCount: number;\n}\n\ninterface SearchResult {\n  entry: WikiEntry;\n  relevanceScore: number;\n  snippet: string;\n}\n\nexport default function AIWiki() {\n  const { user } = useAuth();\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n  const [searchQuery, setSearchQuery] = useState(\"\");\n  const [selectedCategory, setSelectedCategory] = useState(\"all\");\n  const [viewMode, setViewMode] = useState<\"grid\" | \"list\">(\"grid\");\n\n  // Fetch popular articles\n  const { data: popularArticles = [] } = useQuery({\n    queryKey: [\"/api/wiki/popular\"],\n    queryFn: async () => {\n      const response = await apiRequest(\"GET\", \"/api/wiki/popular\");\n      return response.json();\n    }\n  });\n\n  // Fetch categories\n  const { data: categories = [] } = useQuery({\n    queryKey: [\"/api/wiki/categories\"], \n    queryFn: async () => {\n      const response = await apiRequest(\"GET\", \"/api/wiki/categories\");\n      return response.json();\n    }\n  });\n\n  // Search functionality\n  const searchMutation = useMutation({\n    mutationFn: async (query: string) => {\n      const response = await apiRequest(\"POST\", \"/api/wiki/search\", { query });\n      return response.json();\n    },\n    onSuccess: (results) => {\n      console.log(\"Search results:\", results);\n    }\n  });\n\n  // AI Assistant Query\n  const aiQueryMutation = useMutation({\n    mutationFn: async (question: string) => {\n      const response = await apiRequest(\"POST\", \"/api/wiki/ask\", { question });\n      return response.json();\n    },\n    onSuccess: (response) => {\n      setAiAnswer(response.answer);\n    },\n    onError: () => {\n      toast({\n        title: \"Error\",\n        description: \"Failed to get AI response. Please try again.\",\n        variant: \"destructive\"\n      });\n    }\n  });\n\n  const [aiAnswer, setAiAnswer] = useState(\"\");\n  const [aiQuestion, setAiQuestion] = useState(\"\");\n\n  const handleSearch = () => {\n    if (searchQuery.trim()) {\n      searchMutation.mutate(searchQuery);\n    }\n  };\n\n  const handleAiQuery = () => {\n    if (aiQuestion.trim()) {\n      aiQueryMutation.mutate(aiQuestion);\n    }\n  };\n\n  const filteredArticles = Array.isArray(popularArticles) \n    ? (selectedCategory === \"all\" \n        ? popularArticles \n        : popularArticles.filter((article: WikiEntry) => article.category === selectedCategory))\n    : [];\n\n  return (\n    <div className=\"min-h-screen bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900\">\n      {/* Header */}\n      <div className=\"border-b border-slate-700/50 bg-slate-900/80 backdrop-blur-sm\">\n        <div className=\"container mx-auto px-4 py-6\">\n          <div className=\"flex items-center justify-between\">\n            <div className=\"flex items-center space-x-4\">\n              <div className=\"h-12 w-12 rounded-lg bg-gradient-to-r from-cyan-400 to-blue-500 flex items-center justify-center\">\n                <Bot className=\"h-7 w-7 text-white\" />\n              </div>\n              <div>\n                <h1 className=\"text-3xl font-bold text-white flex items-center gap-2\">\n                  AI Knowledge Base\n                  <Sparkles className=\"h-6 w-6 text-yellow-400\" />\n                </h1>\n                <p className=\"text-slate-300\">Intelligent help system powered by AI</p>\n              </div>\n            </div>\n            <Link href=\"/\" data-testid=\"link-back-home\">\n              <Button variant=\"outline\" className=\"border-cyan-400/30 text-cyan-300 hover:bg-cyan-400/10\">\n                Back to Dashboard\n              </Button>\n            </Link>\n          </div>\n        </div>\n      </div>\n\n      <div className=\"container mx-auto px-4 py-8\">\n        <Tabs defaultValue=\"search\" className=\"space-y-8\">\n          <TabsList className=\"grid w-full grid-cols-4 bg-slate-800/50\">\n            <TabsTrigger value=\"search\" data-testid=\"tab-search\">\n              <Search className=\"h-4 w-4 mr-2\" />\n              Search\n            </TabsTrigger>\n            <TabsTrigger value=\"ai-assistant\" data-testid=\"tab-ai-assistant\">\n              <Bot className=\"h-4 w-4 mr-2\" />\n              AI Assistant\n            </TabsTrigger>\n            <TabsTrigger value=\"browse\" data-testid=\"tab-browse\">\n              <BookOpen className=\"h-4 w-4 mr-2\" />\n              Browse\n            </TabsTrigger>\n            <TabsTrigger value=\"popular\" data-testid=\"tab-popular\">\n              <TrendingUp className=\"h-4 w-4 mr-2\" />\n              Popular\n            </TabsTrigger>\n          </TabsList>\n\n          {/* Search Tab */}\n          <TabsContent value=\"search\" className=\"space-y-6\">\n            <Card className=\"border-slate-700/50 bg-slate-800/50 backdrop-blur-sm\">\n              <CardHeader>\n                <CardTitle className=\"text-white flex items-center gap-2\">\n                  <Search className=\"h-5 w-5 text-cyan-400\" />\n                  Search Knowledge Base\n                </CardTitle>\n                <CardDescription className=\"text-slate-300\">\n                  Find answers to your questions about DaddyFanz\n                </CardDescription>\n              </CardHeader>\n              <CardContent className=\"space-y-4\">\n                <div className=\"flex gap-3\">\n                  <Input\n                    placeholder=\"Search for help articles, guides, and FAQs...\"\n                    value={searchQuery}\n                    onChange={(e) => setSearchQuery(e.target.value)}\n                    onKeyPress={(e) => e.key === \"Enter\" && handleSearch()}\n                    className=\"bg-slate-700/50 border-slate-600 text-white placeholder:text-slate-400\"\n                    data-testid=\"input-search-query\"\n                  />\n                  <Button \n                    onClick={handleSearch}\n                    disabled={searchMutation.isPending}\n                    className=\"bg-gradient-to-r from-cyan-500 to-blue-600 hover:from-cyan-600 hover:to-blue-700\"\n                    data-testid=\"button-search\"\n                  >\n                    {searchMutation.isPending ? \"Searching...\" : \"Search\"}\n                  </Button>\n                </div>\n\n                {searchMutation.data && Array.isArray(searchMutation.data) && (\n                  <div className=\"space-y-4\">\n                    <h3 className=\"text-lg font-semibold text-white\">\n                      Search Results ({searchMutation.data.length})\n                    </h3>\n                    {searchMutation.data.map((result: SearchResult) => (\n                      <Card key={result.entry.id} className=\"border-slate-700/30 bg-slate-700/30\">\n                        <CardHeader className=\"pb-3\">\n                          <div className=\"flex items-start justify-between\">\n                            <div>\n                              <CardTitle className=\"text-white text-lg\">{result.entry.title}</CardTitle>\n                              <div className=\"flex items-center gap-2 mt-1\">\n                                <Badge variant=\"secondary\" className=\"text-xs\">\n                                  {result.entry.category}\n                                </Badge>\n                                <div className=\"flex items-center text-slate-400 text-xs\">\n                                  <Eye className=\"h-3 w-3 mr-1\" />\n                                  {result.entry.viewCount}\n                                </div>\n                              </div>\n                            </div>\n                            <Badge variant=\"outline\" className=\"text-cyan-300 border-cyan-400/30\">\n                              {result.relevanceScore}% match\n                            </Badge>\n                          </div>\n                        </CardHeader>\n                        <CardContent>\n                          <p className=\"text-slate-300 text-sm mb-3\">{result.snippet}</p>\n                          <div className=\"flex items-center gap-2\">\n                            {result.entry.tags.map((tag) => (\n                              <Badge key={tag} variant=\"outline\" className=\"text-xs\">\n                                {tag}\n                              </Badge>\n                            ))}\n                          </div>\n                        </CardContent>\n                      </Card>\n                    ))}\n                  </div>\n                )}\n              </CardContent>\n            </Card>\n          </TabsContent>\n\n          {/* AI Assistant Tab */}\n          <TabsContent value=\"ai-assistant\" className=\"space-y-6\">\n            <Card className=\"border-slate-700/50 bg-slate-800/50 backdrop-blur-sm\">\n              <CardHeader>\n                <CardTitle className=\"text-white flex items-center gap-2\">\n                  <Bot className=\"h-5 w-5 text-cyan-400\" />\n                  AI Assistant\n                  <Sparkles className=\"h-4 w-4 text-yellow-400\" />\n                </CardTitle>\n                <CardDescription className=\"text-slate-300\">\n                  Ask questions in natural language and get intelligent answers\n                </CardDescription>\n              </CardHeader>\n              <CardContent className=\"space-y-6\">\n                <div className=\"flex gap-3\">\n                  <Input\n                    placeholder=\"Ask me anything about DaddyFanz... How do I set up payments? How does verification work?\"\n                    value={aiQuestion}\n                    onChange={(e) => setAiQuestion(e.target.value)}\n                    onKeyPress={(e) => e.key === \"Enter\" && handleAiQuery()}\n                    className=\"bg-slate-700/50 border-slate-600 text-white placeholder:text-slate-400\"\n                    data-testid=\"input-ai-question\"\n                  />\n                  <Button \n                    onClick={handleAiQuery}\n                    disabled={aiQueryMutation.isPending}\n                    className=\"bg-gradient-to-r from-purple-500 to-pink-600 hover:from-purple-600 hover:to-pink-700\"\n                    data-testid=\"button-ask-ai\"\n                  >\n                    {aiQueryMutation.isPending ? (\n                      <>\n                        <Bot className=\"h-4 w-4 mr-2 animate-pulse\" />\n                        Thinking...\n                      </>\n                    ) : (\n                      <>\n                        <MessageCircle className=\"h-4 w-4 mr-2\" />\n                        Ask AI\n                      </>\n                    )}\n                  </Button>\n                </div>\n\n                {aiAnswer && (\n                  <Card className=\"border-cyan-400/30 bg-gradient-to-r from-cyan-900/20 to-blue-900/20\">\n                    <CardHeader>\n                      <CardTitle className=\"text-cyan-300 text-lg flex items-center gap-2\">\n                        <Bot className=\"h-5 w-5\" />\n                        AI Response\n                      </CardTitle>\n                    </CardHeader>\n                    <CardContent>\n                      <div className=\"prose prose-invert max-w-none text-slate-300\">\n                        {aiAnswer.split('\\n').map((paragraph, index) => (\n                          <p key={index} className=\"mb-3 last:mb-0\">{paragraph}</p>\n                        ))}\n                      </div>\n                    </CardContent>\n                  </Card>\n                )}\n\n                {/* Quick Questions */}\n                <div className=\"space-y-3\">\n                  <h3 className=\"text-lg font-semibold text-white\">Quick Questions</h3>\n                  <div className=\"grid md:grid-cols-2 gap-3\">\n                    {[\n                      \"How do I verify my age and identity?\",\n                      \"What payment processors do you support?\",\n                      \"How does content moderation work?\",\n                      \"How do I set up subscriptions?\",\n                      \"What are the revenue sharing terms?\",\n                      \"How do I enable real-time messaging?\"\n                    ].map((question) => (\n                      <Button\n                        key={question}\n                        variant=\"outline\"\n                        onClick={() => setAiQuestion(question)}\n                        className=\"text-left justify-start text-slate-300 border-slate-600 hover:bg-slate-700/50\"\n                        data-testid={`button-quick-question-${question.split(' ').slice(0, 3).join('-').toLowerCase()}`}\n                      >\n                        <ArrowRight className=\"h-4 w-4 mr-2 flex-shrink-0\" />\n                        <span className=\"truncate\">{question}</span>\n                      </Button>\n                    ))}\n                  </div>\n                </div>\n              </CardContent>\n            </Card>\n          </TabsContent>\n\n          {/* Browse Tab */}\n          <TabsContent value=\"browse\" className=\"space-y-6\">\n            <div className=\"flex items-center justify-between\">\n              <h2 className=\"text-2xl font-bold text-white\">Browse Articles</h2>\n              <div className=\"flex items-center gap-3\">\n                <select\n                  value={selectedCategory}\n                  onChange={(e) => setSelectedCategory(e.target.value)}\n                  className=\"bg-slate-700 border-slate-600 text-white rounded-md px-3 py-2\"\n                  data-testid=\"select-category\"\n                >\n                  <option value=\"all\">All Categories</option>\n                  {Array.isArray(categories) && categories.map((category: string) => (\n                    <option key={category} value={category}>{category}</option>\n                  ))}\n                </select>\n                <div className=\"flex border border-slate-600 rounded-md\">\n                  <Button\n                    variant={viewMode === \"grid\" ? \"default\" : \"outline\"}\n                    size=\"sm\"\n                    onClick={() => setViewMode(\"grid\")}\n                    className=\"rounded-r-none border-r-0\"\n                  >\n                    <Grid className=\"h-4 w-4\" />\n                  </Button>\n                  <Button\n                    variant={viewMode === \"list\" ? \"default\" : \"outline\"}\n                    size=\"sm\"\n                    onClick={() => setViewMode(\"list\")}\n                    className=\"rounded-l-none\"\n                  >\n                    <List className=\"h-4 w-4\" />\n                  </Button>\n                </div>\n              </div>\n            </div>\n\n            <div className={viewMode === \"grid\" ? \"grid md:grid-cols-2 lg:grid-cols-3 gap-6\" : \"space-y-4\"}>\n              {filteredArticles.map((article: WikiEntry) => (\n                <Card key={article.id} className=\"border-slate-700/50 bg-slate-800/50 backdrop-blur-sm hover:bg-slate-800/70 transition-all\">\n                  <CardHeader>\n                    <div className=\"flex items-start justify-between\">\n                      <div className=\"flex-1\">\n                        <CardTitle className=\"text-white text-lg leading-tight\">{article.title}</CardTitle>\n                        <div className=\"flex items-center gap-2 mt-2\">\n                          <Badge variant=\"secondary\" className=\"text-xs\">\n                            {article.category}\n                          </Badge>\n                          <div className=\"flex items-center text-slate-400 text-xs\">\n                            <Eye className=\"h-3 w-3 mr-1\" />\n                            {article.viewCount}\n                          </div>\n                          <div className=\"flex items-center text-slate-400 text-xs\">\n                            <Clock className=\"h-3 w-3 mr-1\" />\n                            {new Date(article.lastUpdated).toLocaleDateString()}\n                          </div>\n                        </div>\n                      </div>\n                    </div>\n                  </CardHeader>\n                  <CardContent>\n                    <p className=\"text-slate-300 text-sm mb-4 line-clamp-3\">\n                      {article.content.substring(0, 150)}...\n                    </p>\n                    <div className=\"flex flex-wrap gap-1 mb-4\">\n                      {article.tags.slice(0, 3).map((tag) => (\n                        <Badge key={tag} variant=\"outline\" className=\"text-xs\">\n                          {tag}\n                        </Badge>\n                      ))}\n                      {article.tags.length > 3 && (\n                        <Badge variant=\"outline\" className=\"text-xs\">\n                          +{article.tags.length - 3}\n                        </Badge>\n                      )}\n                    </div>\n                    <Button\n                      className=\"w-full bg-gradient-to-r from-cyan-500 to-blue-600 hover:from-cyan-600 hover:to-blue-700\"\n                      data-testid={`button-read-article-${article.id}`}\n                    >\n                      <BookOpen className=\"h-4 w-4 mr-2\" />\n                      Read Article\n                    </Button>\n                  </CardContent>\n                </Card>\n              ))}\n            </div>\n          </TabsContent>\n\n          {/* Popular Tab */}\n          <TabsContent value=\"popular\" className=\"space-y-6\">\n            <div className=\"flex items-center gap-3\">\n              <TrendingUp className=\"h-6 w-6 text-yellow-400\" />\n              <h2 className=\"text-2xl font-bold text-white\">Most Popular Articles</h2>\n            </div>\n\n            <div className=\"space-y-4\">\n              {Array.isArray(popularArticles) && popularArticles.map((article: WikiEntry, index: number) => (\n                <Card key={article.id} className=\"border-slate-700/50 bg-slate-800/50 backdrop-blur-sm\">\n                  <CardContent className=\"p-6\">\n                    <div className=\"flex items-start gap-4\">\n                      <div className=\"flex-shrink-0\">\n                        <div className=\"h-10 w-10 rounded-full bg-gradient-to-r from-yellow-400 to-orange-500 flex items-center justify-center font-bold text-slate-900\">\n                          {index + 1}\n                        </div>\n                      </div>\n                      <div className=\"flex-1\">\n                        <h3 className=\"text-xl font-semibold text-white mb-2\">{article.title}</h3>\n                        <p className=\"text-slate-300 text-sm mb-3 line-clamp-2\">\n                          {article.content.substring(0, 200)}...\n                        </p>\n                        <div className=\"flex items-center gap-4 text-sm text-slate-400\">\n                          <div className=\"flex items-center gap-1\">\n                            <Eye className=\"h-4 w-4\" />\n                            {article.viewCount.toLocaleString()} views\n                          </div>\n                          <Badge variant=\"secondary\" className=\"text-xs\">\n                            {article.category}\n                          </Badge>\n                          <div className=\"flex items-center gap-1\">\n                            <Clock className=\"h-4 w-4\" />\n                            Updated {new Date(article.lastUpdated).toLocaleDateString()}\n                          </div>\n                        </div>\n                      </div>\n                      <Button\n                        variant=\"outline\"\n                        className=\"border-cyan-400/30 text-cyan-300 hover:bg-cyan-400/10\"\n                        data-testid={`button-view-popular-${article.id}`}\n                      >\n                        <BookOpen className=\"h-4 w-4 mr-2\" />\n                        Read\n                      </Button>\n                    </div>\n                  </CardContent>\n                </Card>\n              ))}\n            </div>\n          </TabsContent>\n        </Tabs>\n      </div>\n    </div>\n  );\n}","size_bytes":20559},"client/src/components/auth/AuthModal.tsx":{"content":"import { useState } from \"react\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { AlertTriangle } from \"lucide-react\";\n\ninterface AuthModalProps {\n  isOpen: boolean;\n  onClose: () => void;\n  onSuccess?: () => void;\n}\n\nexport default function AuthModal({ isOpen, onClose, onSuccess }: AuthModalProps) {\n  const { toast } = useToast();\n  const [authMode, setAuthMode] = useState<\"login\" | \"register\">(\"login\");\n  const [formData, setFormData] = useState({\n    email: \"\",\n    password: \"\",\n    confirmPassword: \"\",\n    username: \"\",\n  });\n  const [isSubmitting, setIsSubmitting] = useState(false);\n\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault();\n    setIsSubmitting(true);\n\n    try {\n      if (authMode === \"register\") {\n        if (formData.password !== formData.confirmPassword) {\n          throw new Error(\"Passwords don't match\");\n        }\n        \n        await apiRequest(\"POST\", \"/api/auth/register\", {\n          ...formData,\n          authProvider: \"local\",\n        });\n        \n        toast({\n          title: \"Account Created\",\n          description: \"Welcome to DaddyFanz! Please log in to continue.\",\n        });\n        \n        setAuthMode(\"login\");\n      } else {\n        const response = await apiRequest(\"POST\", \"/api/auth/login\", {\n          email: formData.email,\n          password: formData.password,\n        });\n        \n        const data = await response.json();\n        localStorage.setItem(\"authToken\", data.token);\n        \n        toast({\n          title: \"Welcome Back\",\n          description: \"You've been logged in successfully.\",\n        });\n        \n        onSuccess?.();\n        onClose();\n        \n        // Trigger auth refresh\n        window.location.reload();\n      }\n    } catch (error) {\n      toast({\n        title: \"Authentication Failed\",\n        description: error instanceof Error ? error.message : \"Please try again.\",\n        variant: \"destructive\",\n      });\n    } finally {\n      setIsSubmitting(false);\n    }\n  };\n\n  const handleReplitAuth = () => {\n    window.location.href = \"/api/login\";\n  };\n\n  if (!isOpen) return null;\n\n  return (\n    <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50\" onClick={onClose}>\n      <Card className=\"card-df max-w-md w-full mx-4\" onClick={(e) => e.stopPropagation()}>\n        <CardHeader>\n          <CardTitle className=\"text-2xl neon-heading-caps text-center\">\n            {authMode === \"login\" ? \"Welcome Back\" : \"Join DaddyFanz\"}\n          </CardTitle>\n        </CardHeader>\n        <CardContent>\n          <form onSubmit={handleSubmit} className=\"space-y-4\">\n            {authMode === \"register\" && (\n              <div>\n                <Label htmlFor=\"username\" className=\"text-df-fog\">Username</Label>\n                <Input\n                  id=\"username\"\n                  type=\"text\"\n                  value={formData.username}\n                  onChange={(e) => setFormData(prev => ({ ...prev, username: e.target.value }))}\n                  className=\"input-df\"\n                  required\n                  data-testid=\"input-username\"\n                />\n              </div>\n            )}\n            \n            <div>\n              <Label htmlFor=\"email\" className=\"text-df-fog\">Email</Label>\n              <Input\n                id=\"email\"\n                type=\"email\"\n                value={formData.email}\n                onChange={(e) => setFormData(prev => ({ ...prev, email: e.target.value }))}\n                className=\"input-df\"\n                required\n                data-testid=\"input-email\"\n              />\n            </div>\n            \n            <div>\n              <Label htmlFor=\"password\" className=\"text-df-fog\">Password</Label>\n              <Input\n                id=\"password\"\n                type=\"password\"\n                value={formData.password}\n                onChange={(e) => setFormData(prev => ({ ...prev, password: e.target.value }))}\n                className=\"input-df\"\n                required\n                minLength={8}\n                data-testid=\"input-password\"\n              />\n            </div>\n            \n            {authMode === \"register\" && (\n              <div>\n                <Label htmlFor=\"confirmPassword\" className=\"text-df-fog\">Confirm Password</Label>\n                <Input\n                  id=\"confirmPassword\"\n                  type=\"password\"\n                  value={formData.confirmPassword}\n                  onChange={(e) => setFormData(prev => ({ ...prev, confirmPassword: e.target.value }))}\n                  className=\"input-df\"\n                  required\n                  minLength={8}\n                  data-testid=\"input-confirm-password\"\n                />\n              </div>\n            )}\n            \n            <Button \n              type=\"submit\" \n              disabled={isSubmitting}\n              className=\"w-full btn-secondary\"\n              data-testid=\"button-submit\"\n            >\n              {isSubmitting ? \"Processing...\" : authMode === \"login\" ? \"Sign In\" : \"Create Account\"}\n            </Button>\n          </form>\n          \n          <div className=\"mt-4 text-center\">\n            <button\n              onClick={() => setAuthMode(authMode === \"login\" ? \"register\" : \"login\")}\n              className=\"text-df-cyan hover:text-df-gold transition-colors text-sm\"\n              data-testid=\"button-toggle-auth\"\n            >\n              {authMode === \"login\" ? \"Need an account? Sign up\" : \"Already have an account? Sign in\"}\n            </button>\n          </div>\n          \n          <div className=\"chain-divider my-6\"></div>\n          \n          <Button \n            onClick={handleReplitAuth}\n            className=\"w-full bg-df-dom text-df-snow hover:shadow-glow\"\n            data-testid=\"button-replit-auth\"\n          >\n            Continue with Replit\n          </Button>\n          \n          <p className=\"text-df-fog text-xs text-center mt-4\">\n            <AlertTriangle className=\"inline h-3 w-3 text-df-gold mr-1\" />\n            By joining, you confirm you are 18+ and agree to our Terms & Privacy Policy\n          </p>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","size_bytes":6447},"client/src/pages/CreatorProfile.tsx":{"content":"import { useAuth } from \"@/hooks/useAuth\";\nimport { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { useState, useEffect } from \"react\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { isUnauthorizedError } from \"@/lib/authUtils\";\nimport Header from \"@/components/layout/Header\";\nimport Footer from \"@/components/layout/Footer\";\nimport MediaUpload from \"@/components/media/MediaUpload\";\nimport PaymentSettings from \"@/components/payments/PaymentSettings\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Label } from \"@/components/ui/label\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { Camera, Settings, DollarSign, Upload, Edit } from \"lucide-react\";\n\nexport default function CreatorProfile() {\n  const { user, isLoading, isAuthenticated } = useAuth();\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n  \n  const [isEditing, setIsEditing] = useState(false);\n  const [profileData, setProfileData] = useState({\n    displayName: \"\",\n    bio: \"\",\n    subscriptionPrice: \"\",\n  });\n\n  // Redirect if not authenticated\n  useEffect(() => {\n    if (!isLoading && !isAuthenticated) {\n      toast({\n        title: \"Unauthorized\",\n        description: \"You are logged out. Logging in again...\",\n        variant: \"destructive\",\n      });\n      setTimeout(() => {\n        window.location.href = \"/api/login\";\n      }, 500);\n      return;\n    }\n  }, [isAuthenticated, isLoading, toast]);\n\n  const { data: profile, isLoading: profileLoading } = useQuery({\n    queryKey: [\"/api/profile\"],\n    retry: false,\n    enabled: isAuthenticated,\n  });\n\n  const { data: mediaAssets, isLoading: mediaLoading } = useQuery({\n    queryKey: [\"/api/media\"],\n    retry: false,\n    enabled: isAuthenticated,\n  });\n\n  // Update form data when profile loads\n  useEffect(() => {\n    if (profile) {\n      setProfileData({\n        displayName: profile.displayName || \"\",\n        bio: profile.bio || \"\",\n        subscriptionPrice: profile.subscriptionPrice || \"\",\n      });\n    }\n  }, [profile]);\n\n  const updateProfileMutation = useMutation({\n    mutationFn: async (data: typeof profileData) => {\n      const response = await apiRequest(\"PUT\", \"/api/profile\", data);\n      return response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/profile\"] });\n      toast({\n        title: \"Profile Updated\",\n        description: \"Your profile has been updated successfully.\",\n      });\n      setIsEditing(false);\n    },\n    onError: (error) => {\n      if (isUnauthorizedError(error as Error)) {\n        toast({\n          title: \"Unauthorized\",\n          description: \"You are logged out. Logging in again...\",\n          variant: \"destructive\",\n        });\n        setTimeout(() => {\n          window.location.href = \"/api/login\";\n        }, 500);\n        return;\n      }\n      toast({\n        title: \"Update Failed\",\n        description: \"Failed to update profile. Please try again.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const handleSaveProfile = () => {\n    updateProfileMutation.mutate(profileData);\n  };\n\n  if (isLoading || profileLoading) {\n    return (\n      <div className=\"min-h-screen bg-df-dungeon flex items-center justify-center\">\n        <div className=\"text-df-cyan text-xl font-display\">Loading profile...</div>\n      </div>\n    );\n  }\n\n  if (!isAuthenticated || !user) {\n    return null;\n  }\n\n  const isCreator = user.role === \"creator\" || user.role === \"admin\";\n\n  if (!isCreator) {\n    return (\n      <div className=\"min-h-screen bg-df-dungeon\">\n        <Header />\n        <main className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8\">\n          <Card className=\"card-df max-w-md mx-auto\">\n            <CardContent className=\"pt-6 text-center\">\n              <h2 className=\"text-xl font-display text-df-cyan mb-4\">Creator Access Required</h2>\n              <p className=\"text-df-fog mb-4\">\n                You need to be a creator to access this page.\n              </p>\n              <Button \n                onClick={() => window.location.href = \"/\"}\n                className=\"btn-primary\"\n                data-testid=\"button-back-home\"\n              >\n                Back to Dashboard\n              </Button>\n            </CardContent>\n          </Card>\n        </main>\n        <Footer />\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"min-h-screen bg-df-dungeon\">\n      <Header />\n      \n      <main className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8\">\n        <div className=\"mb-8\">\n          <h1 className=\"text-3xl font-display font-bold text-df-snow mb-2\">\n            Creator Profile\n          </h1>\n          <p className=\"text-df-fog\">Manage your creator profile and content</p>\n        </div>\n\n        <Tabs defaultValue=\"profile\" className=\"space-y-8\">\n          <TabsList className=\"bg-df-brick border border-df-steel\">\n            <TabsTrigger \n              value=\"profile\" \n              className=\"data-[state=active]:bg-df-cyan data-[state=active]:text-df-ink text-df-fog\"\n              data-testid=\"tab-profile\"\n            >\n              <Edit className=\"mr-2 h-4 w-4\" />\n              Profile\n            </TabsTrigger>\n            <TabsTrigger \n              value=\"content\" \n              className=\"data-[state=active]:bg-df-cyan data-[state=active]:text-df-ink text-df-fog\"\n              data-testid=\"tab-content\"\n            >\n              <Upload className=\"mr-2 h-4 w-4\" />\n              Content\n            </TabsTrigger>\n            <TabsTrigger \n              value=\"payments\" \n              className=\"data-[state=active]:bg-df-cyan data-[state=active]:text-df-ink text-df-fog\"\n              data-testid=\"tab-payments\"\n            >\n              <DollarSign className=\"mr-2 h-4 w-4\" />\n              Payments\n            </TabsTrigger>\n            <TabsTrigger \n              value=\"settings\" \n              className=\"data-[state=active]:bg-df-cyan data-[state=active]:text-df-ink text-df-fog\"\n              data-testid=\"tab-settings\"\n            >\n              <Settings className=\"mr-2 h-4 w-4\" />\n              Settings\n            </TabsTrigger>\n          </TabsList>\n\n          {/* Profile Tab */}\n          <TabsContent value=\"profile\">\n            <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-8\">\n              {/* Profile Info */}\n              <Card className=\"card-df\">\n                <CardHeader>\n                  <div className=\"flex items-center justify-between\">\n                    <CardTitle className=\"text-xl neon-subheading\">\n                      Profile Information\n                    </CardTitle>\n                    <Button\n                      onClick={() => setIsEditing(!isEditing)}\n                      className=\"btn-outline\"\n                      data-testid=\"button-toggle-edit\"\n                    >\n                      {isEditing ? \"Cancel\" : \"Edit\"}\n                    </Button>\n                  </div>\n                </CardHeader>\n                <CardContent>\n                  {/* Avatar */}\n                  <div className=\"flex flex-col items-center mb-6\">\n                    <div className=\"w-24 h-24 bg-df-ink border-4 border-df-cyan rounded-full flex items-center justify-center shadow-glow mb-4\">\n                      <span className=\"text-df-cyan text-2xl font-bold\">\n                        {(profileData.displayName || user.email || 'U')[0].toUpperCase()}\n                      </span>\n                    </div>\n                    <Button className=\"btn-outline\" data-testid=\"button-change-avatar\">\n                      <Camera className=\"mr-2 h-4 w-4\" />\n                      Change Photo\n                    </Button>\n                  </div>\n\n                  {/* Profile Form */}\n                  <div className=\"space-y-4\">\n                    <div>\n                      <Label htmlFor=\"displayName\" className=\"text-df-fog\">Display Name</Label>\n                      <Input\n                        id=\"displayName\"\n                        type=\"text\"\n                        value={profileData.displayName}\n                        onChange={(e) => setProfileData(prev => ({ ...prev, displayName: e.target.value }))}\n                        className=\"input-df\"\n                        disabled={!isEditing}\n                        data-testid=\"input-display-name\"\n                      />\n                    </div>\n                    \n                    <div>\n                      <Label htmlFor=\"bio\" className=\"text-df-fog\">Bio</Label>\n                      <Textarea\n                        id=\"bio\"\n                        rows={4}\n                        value={profileData.bio}\n                        onChange={(e) => setProfileData(prev => ({ ...prev, bio: e.target.value }))}\n                        className=\"input-df resize-none\"\n                        placeholder=\"Tell your fans about yourself...\"\n                        disabled={!isEditing}\n                        data-testid=\"textarea-bio\"\n                      />\n                    </div>\n\n                    <div>\n                      <Label htmlFor=\"subscriptionPrice\" className=\"text-df-fog\">Subscription Price ($)</Label>\n                      <Input\n                        id=\"subscriptionPrice\"\n                        type=\"number\"\n                        step=\"0.01\"\n                        min=\"0\"\n                        value={profileData.subscriptionPrice}\n                        onChange={(e) => setProfileData(prev => ({ ...prev, subscriptionPrice: e.target.value }))}\n                        className=\"input-df\"\n                        disabled={!isEditing}\n                        data-testid=\"input-subscription-price\"\n                      />\n                    </div>\n\n                    {isEditing && (\n                      <Button\n                        onClick={handleSaveProfile}\n                        disabled={updateProfileMutation.isPending}\n                        className=\"w-full btn-primary\"\n                        data-testid=\"button-save-profile\"\n                      >\n                        {updateProfileMutation.isPending ? \"Saving...\" : \"Save Changes\"}\n                      </Button>\n                    )}\n                  </div>\n                </CardContent>\n              </Card>\n\n              {/* Verification Status */}\n              <Card className=\"card-df lg:col-span-2\">\n                <CardHeader>\n                  <CardTitle className=\"text-xl neon-subheading\">\n                    Verification & Compliance\n                  </CardTitle>\n                </CardHeader>\n                <CardContent>\n                  <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n                    {/* Age Verification */}\n                    <div className=\"bg-df-ink border border-df-steel rounded-md p-4\">\n                      <h4 className=\"text-df-cyan font-semibold mb-3\">Age Verification</h4>\n                      <div className=\"flex items-center justify-between mb-2\">\n                        <span className=\"text-df-fog text-sm\">Status</span>\n                        <span className=\"flex items-center text-green-400 text-sm\" data-testid=\"status-age-verified\">\n                          {profile?.ageVerified ? (\n                            <>\n                              <span className=\"w-2 h-2 bg-green-400 rounded-full mr-1\"></span>\n                              Verified\n                            </>\n                          ) : (\n                            <>\n                              <span className=\"w-2 h-2 bg-yellow-500 rounded-full mr-1\"></span>\n                              Pending\n                            </>\n                          )}\n                        </span>\n                      </div>\n                      {!profile?.ageVerified && (\n                        <Button className=\"w-full btn-primary mt-3\" data-testid=\"button-verify-age\">\n                          Verify Age\n                        </Button>\n                      )}\n                    </div>\n\n                    {/* KYC Status */}\n                    <div className=\"bg-df-ink border border-df-steel rounded-md p-4\">\n                      <h4 className=\"text-df-cyan font-semibold mb-3\">KYC Compliance</h4>\n                      <div className=\"flex items-center justify-between mb-2\">\n                        <span className=\"text-df-fog text-sm\">Status</span>\n                        <span className=\"flex items-center text-green-400 text-sm\" data-testid=\"status-kyc-status\">\n                          {profile?.kycStatus === 'verified' ? (\n                            <>\n                              <span className=\"w-2 h-2 bg-green-400 rounded-full mr-1\"></span>\n                              Complete\n                            </>\n                          ) : (\n                            <>\n                              <span className=\"w-2 h-2 bg-yellow-500 rounded-full mr-1\"></span>\n                              {profile?.kycStatus || 'Pending'}\n                            </>\n                          )}\n                        </span>\n                      </div>\n                      {profile?.kycStatus !== 'verified' && (\n                        <Button className=\"w-full btn-primary mt-3\" data-testid=\"button-complete-kyc\">\n                          Complete KYC\n                        </Button>\n                      )}\n                    </div>\n\n                    {/* 2257 Records */}\n                    <div className=\"bg-df-ink border border-df-steel rounded-md p-4\">\n                      <h4 className=\"text-df-cyan font-semibold mb-3\">2257 Records</h4>\n                      <div className=\"flex items-center justify-between mb-2\">\n                        <span className=\"text-df-fog text-sm\">Compliance</span>\n                        <span className=\"flex items-center text-green-400 text-sm\" data-testid=\"status-2257-records\">\n                          <span className=\"w-2 h-2 bg-green-400 rounded-full mr-1\"></span>\n                          Filed\n                        </span>\n                      </div>\n                      <p className=\"text-df-fog text-xs\">18 U.S.C. §2257 compliance maintained</p>\n                    </div>\n\n                    {/* Account Security */}\n                    <div className=\"bg-df-ink border border-df-steel rounded-md p-4\">\n                      <h4 className=\"text-df-cyan font-semibold mb-3\">Account Security</h4>\n                      <div className=\"space-y-2\">\n                        <div className=\"flex items-center justify-between\">\n                          <span className=\"text-df-fog text-sm\">Two-Factor Auth</span>\n                          <span className=\"text-yellow-500 text-sm\" data-testid=\"status-2fa\">Disabled</span>\n                        </div>\n                        <Button className=\"w-full btn-outline\" data-testid=\"button-enable-2fa\">\n                          Enable 2FA\n                        </Button>\n                      </div>\n                    </div>\n                  </div>\n                </CardContent>\n              </Card>\n            </div>\n          </TabsContent>\n\n          {/* Content Tab */}\n          <TabsContent value=\"content\">\n            <MediaUpload />\n          </TabsContent>\n\n          {/* Payments Tab */}\n          <TabsContent value=\"payments\">\n            <PaymentSettings />\n          </TabsContent>\n\n          {/* Settings Tab */}\n          <TabsContent value=\"settings\">\n            <Card className=\"card-df\">\n              <CardHeader>\n                <CardTitle className=\"text-xl neon-subheading\">\n                  Account Settings\n                </CardTitle>\n              </CardHeader>\n              <CardContent>\n                <div className=\"space-y-6\">\n                  {/* Notification Preferences */}\n                  <div>\n                    <h4 className=\"text-df-snow font-semibold mb-4\">Notification Preferences</h4>\n                    <div className=\"space-y-3\">\n                      <div className=\"flex items-center justify-between\">\n                        <span className=\"text-df-fog\">New Messages</span>\n                        <button className=\"w-12 h-6 bg-df-cyan rounded-full relative\">\n                          <span className=\"w-4 h-4 bg-white rounded-full absolute top-1 right-1\"></span>\n                        </button>\n                      </div>\n                      <div className=\"flex items-center justify-between\">\n                        <span className=\"text-df-fog\">New Subscribers</span>\n                        <button className=\"w-12 h-6 bg-df-cyan rounded-full relative\">\n                          <span className=\"w-4 h-4 bg-white rounded-full absolute top-1 right-1\"></span>\n                        </button>\n                      </div>\n                      <div className=\"flex items-center justify-between\">\n                        <span className=\"text-df-fog\">Payment Updates</span>\n                        <button className=\"w-12 h-6 bg-df-cyan rounded-full relative\">\n                          <span className=\"w-4 h-4 bg-white rounded-full absolute top-1 right-1\"></span>\n                        </button>\n                      </div>\n                    </div>\n                  </div>\n\n                  {/* Privacy Settings */}\n                  <div className=\"border-t border-df-steel pt-6\">\n                    <h4 className=\"text-df-snow font-semibold mb-4\">Privacy Settings</h4>\n                    <div className=\"space-y-3\">\n                      <div className=\"flex items-center justify-between\">\n                        <span className=\"text-df-fog\">Profile Visibility</span>\n                        <select className=\"bg-df-ink border border-df-steel rounded-md px-3 py-1 text-df-snow\">\n                          <option>Public</option>\n                          <option>Subscribers Only</option>\n                          <option>Private</option>\n                        </select>\n                      </div>\n                      <div className=\"flex items-center justify-between\">\n                        <span className=\"text-df-fog\">Allow Direct Messages</span>\n                        <button className=\"w-12 h-6 bg-df-cyan rounded-full relative\">\n                          <span className=\"w-4 h-4 bg-white rounded-full absolute top-1 right-1\"></span>\n                        </button>\n                      </div>\n                    </div>\n                  </div>\n\n                  {/* Danger Zone */}\n                  <div className=\"border-t border-df-steel pt-6\">\n                    <h4 className=\"text-red-400 font-semibold mb-4\">Danger Zone</h4>\n                    <div className=\"space-y-3\">\n                      <Button className=\"w-full bg-red-600 hover:bg-red-700 text-white\" data-testid=\"button-deactivate\">\n                        Deactivate Account\n                      </Button>\n                      <Button className=\"w-full bg-red-800 hover:bg-red-900 text-white\" data-testid=\"button-delete\">\n                        Delete Account Permanently\n                      </Button>\n                    </div>\n                    <p className=\"text-df-fog text-xs mt-2\">\n                      These actions cannot be undone. Please be certain.\n                    </p>\n                  </div>\n                </div>\n              </CardContent>\n            </Card>\n          </TabsContent>\n        </Tabs>\n      </main>\n\n      <Footer />\n    </div>\n  );\n}\n","size_bytes":19697},"server/middleware/rateLimit.ts":{"content":"import { Request, Response, NextFunction } from \"express\";\nimport { logger } from \"../logger\";\nimport { AuthenticatedUser } from \"./auth\";\n\ninterface RateLimitOptions {\n  windowMs: number; // Time window in milliseconds\n  maxRequests: number; // Maximum requests per window\n  skipSuccessfulRequests?: boolean;\n  skipFailedRequests?: boolean;\n  keyGenerator?: (req: Request) => string;\n  message?: string;\n}\n\ninterface RateLimitEntry {\n  count: number;\n  resetTime: number;\n}\n\nclass RateLimiter {\n  private store = new Map<string, RateLimitEntry>();\n  private options: Required<RateLimitOptions>;\n\n  constructor(options: RateLimitOptions) {\n    this.options = {\n      skipSuccessfulRequests: false,\n      skipFailedRequests: false,\n      keyGenerator: (req) => req.ip || \"anonymous\",\n      message: \"Too many requests\",\n      ...options,\n    };\n\n    // Clean up expired entries every minute\n    setInterval(() => this.cleanup(), 60000);\n  }\n\n  private cleanup() {\n    const now = Date.now();\n    for (const [key, entry] of this.store.entries()) {\n      if (entry.resetTime <= now) {\n        this.store.delete(key);\n      }\n    }\n  }\n\n  middleware() {\n    return (req: Request, res: Response, next: NextFunction) => {\n      const key = this.options.keyGenerator(req);\n      const now = Date.now();\n      const resetTime = now + this.options.windowMs;\n\n      let entry = this.store.get(key);\n      if (!entry || entry.resetTime <= now) {\n        entry = { count: 0, resetTime };\n        this.store.set(key, entry);\n      }\n\n      entry.count++;\n\n      // Set rate limit headers\n      res.set({\n        \"X-RateLimit-Limit\": this.options.maxRequests.toString(),\n        \"X-RateLimit-Remaining\": Math.max(0, this.options.maxRequests - entry.count).toString(),\n        \"X-RateLimit-Reset\": new Date(entry.resetTime).toISOString(),\n      });\n\n      if (entry.count > this.options.maxRequests) {\n        logger.warn(`Rate limit exceeded for ${key}: ${entry.count}/${this.options.maxRequests} from ${req.ip} (${req.get(\"user-agent\")})`);\n\n        res.status(429).json({\n          error: \"Too Many Requests\",\n          message: this.options.message,\n          retryAfter: Math.ceil((entry.resetTime - now) / 1000),\n        });\n        return;\n      }\n\n      // Track rate limit hits for analytics\n      if (entry.count > this.options.maxRequests * 0.8) {\n        logger.info(`Rate limit warning for ${key}: ${entry.count}/${this.options.maxRequests} (${(entry.count / this.options.maxRequests * 100).toFixed(1)}%)`);\n      }\n\n      next();\n    };\n  }\n}\n\n// Create rate limiters for different endpoints\nexport const globalRateLimit = new RateLimiter({\n  windowMs: 60 * 1000, // 1 minute\n  maxRequests: process.env.NODE_ENV === \"production\" ? 1000 : 10000,\n  keyGenerator: (req) => req.ip || \"anonymous\",\n}).middleware();\n\nexport const authRateLimit = new RateLimiter({\n  windowMs: 15 * 60 * 1000, // 15 minutes\n  maxRequests: 5, // 5 attempts per 15 minutes\n  keyGenerator: (req) => `auth:${req.ip}`,\n  message: \"Too many authentication attempts, please try again later\",\n}).middleware();\n\nexport const apiRateLimit = new RateLimiter({\n  windowMs: 60 * 1000, // 1 minute\n  maxRequests: 100, // 100 API calls per minute\n  keyGenerator: (req) => `api:${(req.user as AuthenticatedUser)?.id || req.ip}`,\n}).middleware();\n\nexport const uploadRateLimit = new RateLimiter({\n  windowMs: 60 * 60 * 1000, // 1 hour\n  maxRequests: 50, // 50 uploads per hour\n  keyGenerator: (req) => `upload:${(req.user as AuthenticatedUser)?.id || req.ip}`,\n  message: \"Upload limit exceeded, please try again later\",\n}).middleware();\n","size_bytes":3596},"client/src/components/ui/switch.tsx":{"content":"import * as React from \"react\"\nimport * as SwitchPrimitives from \"@radix-ui/react-switch\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Switch = React.forwardRef<\n  React.ElementRef<typeof SwitchPrimitives.Root>,\n  React.ComponentPropsWithoutRef<typeof SwitchPrimitives.Root>\n>(({ className, ...props }, ref) => (\n  <SwitchPrimitives.Root\n    className={cn(\n      \"peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  >\n    <SwitchPrimitives.Thumb\n      className={cn(\n        \"pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0\"\n      )}\n    />\n  </SwitchPrimitives.Root>\n))\nSwitch.displayName = SwitchPrimitives.Root.displayName\n\nexport { Switch }\n","size_bytes":1139},"client/src/components/ui/alert.tsx":{"content":"import * as React from \"react\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst alertVariants = cva(\n  \"relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-background text-foreground\",\n        destructive:\n          \"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nconst Alert = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement> & VariantProps<typeof alertVariants>\n>(({ className, variant, ...props }, ref) => (\n  <div\n    ref={ref}\n    role=\"alert\"\n    className={cn(alertVariants({ variant }), className)}\n    {...props}\n  />\n))\nAlert.displayName = \"Alert\"\n\nconst AlertTitle = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLHeadingElement>\n>(({ className, ...props }, ref) => (\n  <h5\n    ref={ref}\n    className={cn(\"mb-1 font-medium leading-none tracking-tight\", className)}\n    {...props}\n  />\n))\nAlertTitle.displayName = \"AlertTitle\"\n\nconst AlertDescription = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"text-sm [&_p]:leading-relaxed\", className)}\n    {...props}\n  />\n))\nAlertDescription.displayName = \"AlertDescription\"\n\nexport { Alert, AlertTitle, AlertDescription }\n","size_bytes":1584},"client/src/components/ui/select.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as SelectPrimitive from \"@radix-ui/react-select\"\nimport { Check, ChevronDown, ChevronUp } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Select = SelectPrimitive.Root\n\nconst SelectGroup = SelectPrimitive.Group\n\nconst SelectValue = SelectPrimitive.Value\n\nconst SelectTrigger = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <SelectPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background data-[placeholder]:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <SelectPrimitive.Icon asChild>\n      <ChevronDown className=\"h-4 w-4 opacity-50\" />\n    </SelectPrimitive.Icon>\n  </SelectPrimitive.Trigger>\n))\nSelectTrigger.displayName = SelectPrimitive.Trigger.displayName\n\nconst SelectScrollUpButton = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.ScrollUpButton>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.ScrollUpButton>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.ScrollUpButton\n    ref={ref}\n    className={cn(\n      \"flex cursor-default items-center justify-center py-1\",\n      className\n    )}\n    {...props}\n  >\n    <ChevronUp className=\"h-4 w-4\" />\n  </SelectPrimitive.ScrollUpButton>\n))\nSelectScrollUpButton.displayName = SelectPrimitive.ScrollUpButton.displayName\n\nconst SelectScrollDownButton = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.ScrollDownButton>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.ScrollDownButton>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.ScrollDownButton\n    ref={ref}\n    className={cn(\n      \"flex cursor-default items-center justify-center py-1\",\n      className\n    )}\n    {...props}\n  >\n    <ChevronDown className=\"h-4 w-4\" />\n  </SelectPrimitive.ScrollDownButton>\n))\nSelectScrollDownButton.displayName =\n  SelectPrimitive.ScrollDownButton.displayName\n\nconst SelectContent = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Content>\n>(({ className, children, position = \"popper\", ...props }, ref) => (\n  <SelectPrimitive.Portal>\n    <SelectPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"relative z-50 max-h-[--radix-select-content-available-height] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-select-content-transform-origin]\",\n        position === \"popper\" &&\n          \"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1\",\n        className\n      )}\n      position={position}\n      {...props}\n    >\n      <SelectScrollUpButton />\n      <SelectPrimitive.Viewport\n        className={cn(\n          \"p-1\",\n          position === \"popper\" &&\n            \"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]\"\n        )}\n      >\n        {children}\n      </SelectPrimitive.Viewport>\n      <SelectScrollDownButton />\n    </SelectPrimitive.Content>\n  </SelectPrimitive.Portal>\n))\nSelectContent.displayName = SelectPrimitive.Content.displayName\n\nconst SelectLabel = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Label>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.Label\n    ref={ref}\n    className={cn(\"py-1.5 pl-8 pr-2 text-sm font-semibold\", className)}\n    {...props}\n  />\n))\nSelectLabel.displayName = SelectPrimitive.Label.displayName\n\nconst SelectItem = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Item>\n>(({ className, children, ...props }, ref) => (\n  <SelectPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <SelectPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </SelectPrimitive.ItemIndicator>\n    </span>\n\n    <SelectPrimitive.ItemText>{children}</SelectPrimitive.ItemText>\n  </SelectPrimitive.Item>\n))\nSelectItem.displayName = SelectPrimitive.Item.displayName\n\nconst SelectSeparator = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nSelectSeparator.displayName = SelectPrimitive.Separator.displayName\n\nexport {\n  Select,\n  SelectGroup,\n  SelectValue,\n  SelectTrigger,\n  SelectContent,\n  SelectLabel,\n  SelectItem,\n  SelectSeparator,\n  SelectScrollUpButton,\n  SelectScrollDownButton,\n}\n","size_bytes":5742},"postcss.config.js":{"content":"export default {\n  plugins: {\n    tailwindcss: {},\n    autoprefixer: {},\n  },\n}\n","size_bytes":80},"client/src/pages/OnboardingWelcome.tsx":{"content":"import { useState } from \"react\";\nimport { useLocation } from \"wouter\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Star, Users } from \"lucide-react\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport { useToast } from \"@/hooks/use-toast\";\n\nexport default function OnboardingWelcome() {\n  const [, setLocation] = useLocation();\n  const [isLoading, setIsLoading] = useState(false);\n  const { toast} = useToast();\n\n  const selectRole = async (role: \"creator\" | \"fan\") => {\n    setIsLoading(true);\n    try {\n      await apiRequest(\"/api/onboarding/select-role\", {\n        method: \"POST\",\n        body: JSON.stringify({ role }),\n      });\n\n      // Invalidate user query to refresh role\n      queryClient.invalidateQueries({ queryKey: [\"/api/auth/user\"] });\n\n      toast({\n        title: \"Welcome aboard!\",\n        description: `Let's set up your ${role === \"creator\" ? \"Star\" : \"Fanz\"} profile`,\n      });\n\n      setLocation(\"/onboarding/profile\");\n    } catch (error) {\n      toast({\n        title: \"Error\",\n        description: \"Failed to select role. Please try again.\",\n        variant: \"destructive\",\n      });\n    } finally {\n      setIsLoading(false);\n    }\n  };\n\n  return (\n    <div className=\"min-h-screen bg-gradient-to-br from-black via-gray-900 to-black flex items-center justify-center p-4 sm:p-6 lg:p-8\">\n      <div className=\"max-w-6xl w-full\">\n        <div className=\"text-center mb-8 sm:mb-10 lg:mb-12\">\n          <h1 className=\"text-3xl sm:text-4xl lg:text-5xl font-bold mb-3 sm:mb-4 bg-gradient-to-r from-cyan-400 to-blue-500 bg-clip-text text-transparent\">\n            Welcome to DaddyFanz\n          </h1>\n          <p className=\"text-lg sm:text-xl text-gray-300\">Choose your journey</p>\n        </div>\n\n        <div className=\"grid md:grid-cols-2 gap-6 sm:gap-8\">\n          {/* Creator Card */}\n          <Card \n            className=\"border-2 border-cyan-500/30 bg-black/40 backdrop-blur hover:border-cyan-500 transition-all cursor-pointer group\"\n            onClick={() => !isLoading && selectRole(\"creator\")}\n            data-testid=\"card-creator-role\"\n          >\n            <CardHeader className=\"text-center pb-4 sm:pb-6\">\n              <div className=\"mx-auto mb-3 sm:mb-4 w-20 h-20 sm:w-24 sm:h-24 rounded-full bg-gradient-to-br from-cyan-500 to-blue-600 flex items-center justify-center group-hover:scale-110 transition-transform\">\n                <Star className=\"w-10 h-10 sm:w-12 sm:h-12 text-white\" />\n              </div>\n              <CardTitle className=\"text-2xl sm:text-3xl font-bold text-cyan-400\">\n                I'm a Creator\n              </CardTitle>\n              <CardDescription className=\"text-base sm:text-lg text-gray-300 mt-2\">\n                Claim Your Star Power\n              </CardDescription>\n            </CardHeader>\n            <CardContent className=\"space-y-4 sm:space-y-5\">\n              <ul className=\"space-y-2.5 sm:space-y-3 text-sm sm:text-base text-gray-300\">\n                <li className=\"flex items-start gap-2\">\n                  <span className=\"text-cyan-400 mt-0.5 sm:mt-1 flex-shrink-0\">✓</span>\n                  <span>100% of earnings go directly to you</span>\n                </li>\n                <li className=\"flex items-start gap-2\">\n                  <span className=\"text-cyan-400 mt-0.5 sm:mt-1 flex-shrink-0\">✓</span>\n                  <span>Full content ownership & control</span>\n                </li>\n                <li className=\"flex items-start gap-2\">\n                  <span className=\"text-cyan-400 mt-0.5 sm:mt-1 flex-shrink-0\">✓</span>\n                  <span>Advanced creator tools & analytics</span>\n                </li>\n                <li className=\"flex items-start gap-2\">\n                  <span className=\"text-cyan-400 mt-0.5 sm:mt-1 flex-shrink-0\">✓</span>\n                  <span>Direct connection with your fans</span>\n                </li>\n              </ul>\n              <Button \n                className=\"w-full bg-gradient-to-r from-cyan-500 to-blue-600 hover:from-cyan-600 hover:to-blue-700 text-white font-bold py-4 sm:py-5 lg:py-6 text-base sm:text-lg\"\n                disabled={isLoading}\n                data-testid=\"button-select-creator\"\n              >\n                Start as Creator\n              </Button>\n            </CardContent>\n          </Card>\n\n          {/* Fan Card */}\n          <Card \n            className=\"border-2 border-purple-500/30 bg-black/40 backdrop-blur hover:border-purple-500 transition-all cursor-pointer group\"\n            onClick={() => !isLoading && selectRole(\"fan\")}\n            data-testid=\"card-fan-role\"\n          >\n            <CardHeader className=\"text-center pb-4 sm:pb-6\">\n              <div className=\"mx-auto mb-3 sm:mb-4 w-20 h-20 sm:w-24 sm:h-24 rounded-full bg-gradient-to-br from-purple-500 to-pink-600 flex items-center justify-center group-hover:scale-110 transition-transform\">\n                <Users className=\"w-10 h-10 sm:w-12 sm:h-12 text-white\" />\n              </div>\n              <CardTitle className=\"text-2xl sm:text-3xl font-bold text-purple-400\">\n                I'm a Fanz\n              </CardTitle>\n              <CardDescription className=\"text-base sm:text-lg text-gray-300 mt-2\">\n                Discover. Connect. Support.\n              </CardDescription>\n            </CardHeader>\n            <CardContent className=\"space-y-4 sm:space-y-5\">\n              <ul className=\"space-y-2.5 sm:space-y-3 text-sm sm:text-base text-gray-300\">\n                <li className=\"flex items-start gap-2\">\n                  <span className=\"text-purple-400 mt-0.5 sm:mt-1 flex-shrink-0\">✓</span>\n                  <span>Discover amazing creators</span>\n                </li>\n                <li className=\"flex items-start gap-2\">\n                  <span className=\"text-purple-400 mt-0.5 sm:mt-1 flex-shrink-0\">✓</span>\n                  <span>Exclusive content & experiences</span>\n                </li>\n                <li className=\"flex items-start gap-2\">\n                  <span className=\"text-purple-400 mt-0.5 sm:mt-1 flex-shrink-0\">✓</span>\n                  <span>Direct interaction with stars</span>\n                </li>\n                <li className=\"flex items-start gap-2\">\n                  <span className=\"text-purple-400 mt-0.5 sm:mt-1 flex-shrink-0\">✓</span>\n                  <span>Support your favorite creators</span>\n                </li>\n              </ul>\n              <Button \n                className=\"w-full bg-gradient-to-r from-purple-500 to-pink-600 hover:from-purple-600 hover:to-pink-700 text-white font-bold py-4 sm:py-5 lg:py-6 text-base sm:text-lg\"\n                disabled={isLoading}\n                data-testid=\"button-select-fan\"\n              >\n                Start as Fanz\n              </Button>\n            </CardContent>\n          </Card>\n        </div>\n\n        <p className=\"text-center text-gray-400 mt-6 sm:mt-8 text-xs sm:text-sm\">\n          Don't worry, you can always upgrade from Fanz to Creator later\n        </p>\n      </div>\n    </div>\n  );\n}\n","size_bytes":7131},"client/src/components/ui/avatar.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as AvatarPrimitive from \"@radix-ui/react-avatar\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Avatar = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full\",\n      className\n    )}\n    {...props}\n  />\n))\nAvatar.displayName = AvatarPrimitive.Root.displayName\n\nconst AvatarImage = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Image>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Image>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Image\n    ref={ref}\n    className={cn(\"aspect-square h-full w-full\", className)}\n    {...props}\n  />\n))\nAvatarImage.displayName = AvatarPrimitive.Image.displayName\n\nconst AvatarFallback = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Fallback>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Fallback>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Fallback\n    ref={ref}\n    className={cn(\n      \"flex h-full w-full items-center justify-center rounded-full bg-muted\",\n      className\n    )}\n    {...props}\n  />\n))\nAvatarFallback.displayName = AvatarPrimitive.Fallback.displayName\n\nexport { Avatar, AvatarImage, AvatarFallback }\n","size_bytes":1419},"server/health.ts":{"content":"import { Request, Response } from \"express\";\nimport { db } from \"./db\";\nimport { logger } from \"./logger\";\n\nexport interface HealthStatus {\n  status: \"healthy\" | \"degraded\" | \"unhealthy\";\n  timestamp: string;\n  uptime: number;\n  version: string;\n  checks: {\n    database: HealthCheck;\n    memory: HealthCheck;\n    disk?: HealthCheck;\n  };\n}\n\ninterface HealthCheck {\n  status: \"pass\" | \"fail\" | \"warn\";\n  time: string;\n  output?: string;\n  details?: Record<string, any>;\n}\n\nclass HealthService {\n  private startTime = Date.now();\n\n  async checkDatabase(): Promise<HealthCheck> {\n    const start = Date.now();\n    try {\n      await db.execute(\"SELECT 1\");\n      const responseTime = Date.now() - start;\n      \n      return {\n        status: responseTime < 100 ? \"pass\" : \"warn\",\n        time: `${responseTime}ms`,\n        details: { responseTime },\n      };\n    } catch (error) {\n      logger.error(`Database health check failed: ${error instanceof Error ? error.message : String(error)}`);\n      return {\n        status: \"fail\",\n        time: `${Date.now() - start}ms`,\n        output: error instanceof Error ? error.message : \"Unknown error\",\n      };\n    }\n  }\n\n  async checkMemory(): Promise<HealthCheck> {\n    const memUsage = process.memoryUsage();\n    const heapUsedMB = Math.round(memUsage.heapUsed / 1024 / 1024);\n    const heapTotalMB = Math.round(memUsage.heapTotal / 1024 / 1024);\n    const rssUsedMB = Math.round(memUsage.rss / 1024 / 1024);\n    \n    // Warn if heap usage is over 80% or RSS over 2GB\n    const heapUsagePercent = (memUsage.heapUsed / memUsage.heapTotal) * 100;\n    const status = heapUsagePercent > 80 || rssUsedMB > 2048 ? \"warn\" : \"pass\";\n    \n    return {\n      status,\n      time: \"0ms\",\n      details: {\n        heapUsed: `${heapUsedMB}MB`,\n        heapTotal: `${heapTotalMB}MB`,\n        rss: `${rssUsedMB}MB`,\n        external: `${Math.round(memUsage.external / 1024 / 1024)}MB`,\n        heapUsagePercent: Math.round(heapUsagePercent),\n      },\n    };\n  }\n\n  async getHealthStatus(): Promise<HealthStatus> {\n    const [database, memory] = await Promise.all([\n      this.checkDatabase(),\n      this.checkMemory(),\n    ]);\n\n    const checks = { database, memory };\n    const allPassing = Object.values(checks).every(check => check.status === \"pass\");\n    const anyWarning = Object.values(checks).some(check => check.status === \"warn\");\n    const anyFailing = Object.values(checks).some(check => check.status === \"fail\");\n\n    let status: HealthStatus[\"status\"];\n    if (anyFailing) {\n      status = \"unhealthy\";\n    } else if (anyWarning) {\n      status = \"degraded\";\n    } else {\n      status = \"healthy\";\n    }\n\n    return {\n      status,\n      timestamp: new Date().toISOString(),\n      uptime: Date.now() - this.startTime,\n      version: process.env.npm_package_version || \"unknown\",\n      checks,\n    };\n  }\n}\n\nconst healthService = new HealthService();\n\nexport const healthEndpoints = {\n  // Basic health check\n  basic: async (req: Request, res: Response) => {\n    try {\n      const health = await healthService.getHealthStatus();\n      const statusCode = health.status === \"healthy\" ? 200 : health.status === \"degraded\" ? 200 : 503;\n      res.status(statusCode).json(health);\n    } catch (error) {\n      logger.error(`Health check failed: ${error instanceof Error ? error.message : String(error)}`);\n      res.status(503).json({\n        status: \"unhealthy\",\n        timestamp: new Date().toISOString(),\n        error: \"Health check failed\",\n      });\n    }\n  },\n\n  // Ready check (for load balancers)\n  ready: async (req: Request, res: Response) => {\n    try {\n      const dbCheck = await healthService.checkDatabase();\n      if (dbCheck.status === \"fail\") {\n        return res.status(503).json({ status: \"not ready\", reason: \"database unavailable\" });\n      }\n      res.json({ status: \"ready\" });\n    } catch (error) {\n      res.status(503).json({ status: \"not ready\", error: \"readiness check failed\" });\n    }\n  },\n\n  // Live check (for orchestrators)\n  live: async (req: Request, res: Response) => {\n    res.json({ status: \"alive\", timestamp: new Date().toISOString() });\n  },\n};\n","size_bytes":4122},"client/src/components/ui/alert-dialog.tsx":{"content":"import * as React from \"react\"\nimport * as AlertDialogPrimitive from \"@radix-ui/react-alert-dialog\"\n\nimport { cn } from \"@/lib/utils\"\nimport { buttonVariants } from \"@/components/ui/button\"\n\nconst AlertDialog = AlertDialogPrimitive.Root\n\nconst AlertDialogTrigger = AlertDialogPrimitive.Trigger\n\nconst AlertDialogPortal = AlertDialogPrimitive.Portal\n\nconst AlertDialogOverlay = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Overlay\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  />\n))\nAlertDialogOverlay.displayName = AlertDialogPrimitive.Overlay.displayName\n\nconst AlertDialogContent = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPortal>\n    <AlertDialogOverlay />\n    <AlertDialogPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg\",\n        className\n      )}\n      {...props}\n    />\n  </AlertDialogPortal>\n))\nAlertDialogContent.displayName = AlertDialogPrimitive.Content.displayName\n\nconst AlertDialogHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-2 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nAlertDialogHeader.displayName = \"AlertDialogHeader\"\n\nconst AlertDialogFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nAlertDialogFooter.displayName = \"AlertDialogFooter\"\n\nconst AlertDialogTitle = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Title\n    ref={ref}\n    className={cn(\"text-lg font-semibold\", className)}\n    {...props}\n  />\n))\nAlertDialogTitle.displayName = AlertDialogPrimitive.Title.displayName\n\nconst AlertDialogDescription = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nAlertDialogDescription.displayName =\n  AlertDialogPrimitive.Description.displayName\n\nconst AlertDialogAction = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Action>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Action>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Action\n    ref={ref}\n    className={cn(buttonVariants(), className)}\n    {...props}\n  />\n))\nAlertDialogAction.displayName = AlertDialogPrimitive.Action.displayName\n\nconst AlertDialogCancel = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Cancel>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Cancel>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Cancel\n    ref={ref}\n    className={cn(\n      buttonVariants({ variant: \"outline\" }),\n      \"mt-2 sm:mt-0\",\n      className\n    )}\n    {...props}\n  />\n))\nAlertDialogCancel.displayName = AlertDialogPrimitive.Cancel.displayName\n\nexport {\n  AlertDialog,\n  AlertDialogPortal,\n  AlertDialogOverlay,\n  AlertDialogTrigger,\n  AlertDialogContent,\n  AlertDialogHeader,\n  AlertDialogFooter,\n  AlertDialogTitle,\n  AlertDialogDescription,\n  AlertDialogAction,\n  AlertDialogCancel,\n}\n","size_bytes":4420},"client/src/pages/Feed.tsx":{"content":"import { useAuth } from \"@/hooks/useAuth\";\nimport Header from \"@/components/layout/Header\";\nimport Footer from \"@/components/layout/Footer\";\nimport FanzInfinityScrollFeed from \"@/components/feed/FanzInfinityScrollFeed\";\nimport { Card, CardContent } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { TrendingUp, Users, Sparkles } from \"lucide-react\";\n\nexport default function Feed() {\n  const { user, isAuthenticated } = useAuth();\n\n  return (\n    <div className=\"min-h-screen bg-df-dungeon\">\n      <Header />\n      \n      <main className=\"max-w-5xl mx-auto px-4 sm:px-6 lg:px-8 py-8\">\n        {/* Page Header */}\n        <div className=\"mb-8\">\n          <h1 className=\"text-3xl font-display font-bold neon-heading mb-2\">\n            Discover Feed\n          </h1>\n          <p className=\"text-df-fog\">\n            {isAuthenticated \n              ? \"Personalized content from creators you follow\" \n              : \"Explore free content from amazing creators\"}\n          </p>\n        </div>\n\n        <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-6\">\n          {/* Main Feed */}\n          <div className=\"lg:col-span-2\">\n            <FanzInfinityScrollFeed adInterval={5} />\n          </div>\n\n          {/* Sidebar */}\n          <div className=\"space-y-6\">\n            {/* Trending Card */}\n            <Card className=\"card-df\" data-testid=\"card-trending\">\n              <CardContent className=\"p-6\">\n                <h3 className=\"text-lg font-semibold text-df-snow mb-4 flex items-center gap-2\">\n                  <TrendingUp className=\"h-5 w-5 text-df-cyan\" />\n                  Trending Now\n                </h3>\n                <div className=\"space-y-4\">\n                  {[1, 2, 3].map((i) => (\n                    <div key={i} className=\"flex items-center gap-3 p-2 hover:bg-df-ink rounded transition-colors cursor-pointer\">\n                      <div className=\"h-12 w-12 rounded-full bg-gradient-to-br from-df-cyan to-df-gold flex items-center justify-center text-df-snow font-bold\">\n                        #{i}\n                      </div>\n                      <div className=\"flex-1\">\n                        <p className=\"text-df-snow font-medium text-sm\">Creator Name</p>\n                        <p className=\"text-df-fog text-xs\">1.2K followers</p>\n                      </div>\n                    </div>\n                  ))}\n                </div>\n              </CardContent>\n            </Card>\n\n            {/* Suggested Creators Card */}\n            <Card className=\"card-df\" data-testid=\"card-suggested\">\n              <CardContent className=\"p-6\">\n                <h3 className=\"text-lg font-semibold text-df-snow mb-4 flex items-center gap-2\">\n                  <Users className=\"h-5 w-5 text-df-cyan\" />\n                  Suggested Creators\n                </h3>\n                <div className=\"space-y-4\">\n                  {[1, 2, 3].map((i) => (\n                    <div key={i} className=\"flex items-center justify-between\">\n                      <div className=\"flex items-center gap-3\">\n                        <div className=\"h-10 w-10 rounded-full bg-df-ink border-2 border-df-steel\" />\n                        <div>\n                          <p className=\"text-df-snow font-medium text-sm\">Creator {i}</p>\n                          <p className=\"text-df-fog text-xs\">500 posts</p>\n                        </div>\n                      </div>\n                      <Button \n                        size=\"sm\" \n                        className=\"btn-primary text-xs\"\n                        data-testid={`button-follow-suggested-${i}`}\n                      >\n                        Follow\n                      </Button>\n                    </div>\n                  ))}\n                </div>\n              </CardContent>\n            </Card>\n\n            {/* Premium CTA */}\n            {!isAuthenticated && (\n              <Card className=\"card-df border-df-gold\" data-testid=\"card-premium-cta\">\n                <CardContent className=\"p-6 text-center\">\n                  <Sparkles className=\"h-12 w-12 text-df-gold mx-auto mb-4\" />\n                  <h3 className=\"text-lg font-semibold text-df-snow mb-2\">\n                    Unlock Premium Content\n                  </h3>\n                  <p className=\"text-df-fog text-sm mb-4\">\n                    Sign up to access exclusive content from your favorite creators\n                  </p>\n                  <Button \n                    className=\"btn-primary w-full\"\n                    onClick={() => window.location.href = \"/api/login\"}\n                    data-testid=\"button-signup-cta\"\n                  >\n                    Get Started\n                  </Button>\n                </CardContent>\n              </Card>\n            )}\n          </div>\n        </div>\n      </main>\n      \n      <Footer />\n    </div>\n  );\n}\n","size_bytes":4855},"client/src/components/ui/badge.tsx":{"content":"import * as React from \"react\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst badgeVariants = cva(\n  \"inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2\",\n  {\n    variants: {\n      variant: {\n        default:\n          \"border-transparent bg-primary text-primary-foreground hover:bg-primary/80\",\n        secondary:\n          \"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80\",\n        destructive:\n          \"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80\",\n        outline: \"text-foreground\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nexport interface BadgeProps\n  extends React.HTMLAttributes<HTMLDivElement>,\n    VariantProps<typeof badgeVariants> {}\n\nfunction Badge({ className, variant, ...props }: BadgeProps) {\n  return (\n    <div className={cn(badgeVariants({ variant }), className)} {...props} />\n  )\n}\n\nexport { Badge, badgeVariants }\n","size_bytes":1128},"client/src/components/ui/tooltip.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as TooltipPrimitive from \"@radix-ui/react-tooltip\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst TooltipProvider = TooltipPrimitive.Provider\n\nconst Tooltip = TooltipPrimitive.Root\n\nconst TooltipTrigger = TooltipPrimitive.Trigger\n\nconst TooltipContent = React.forwardRef<\n  React.ElementRef<typeof TooltipPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof TooltipPrimitive.Content>\n>(({ className, sideOffset = 4, ...props }, ref) => (\n  <TooltipPrimitive.Content\n    ref={ref}\n    sideOffset={sideOffset}\n    className={cn(\n      \"z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-tooltip-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nTooltipContent.displayName = TooltipPrimitive.Content.displayName\n\nexport { Tooltip, TooltipTrigger, TooltipContent, TooltipProvider }\n","size_bytes":1209},"client/src/components/ui/pagination.tsx":{"content":"import * as React from \"react\"\nimport { ChevronLeft, ChevronRight, MoreHorizontal } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { ButtonProps, buttonVariants } from \"@/components/ui/button\"\n\nconst Pagination = ({ className, ...props }: React.ComponentProps<\"nav\">) => (\n  <nav\n    role=\"navigation\"\n    aria-label=\"pagination\"\n    className={cn(\"mx-auto flex w-full justify-center\", className)}\n    {...props}\n  />\n)\nPagination.displayName = \"Pagination\"\n\nconst PaginationContent = React.forwardRef<\n  HTMLUListElement,\n  React.ComponentProps<\"ul\">\n>(({ className, ...props }, ref) => (\n  <ul\n    ref={ref}\n    className={cn(\"flex flex-row items-center gap-1\", className)}\n    {...props}\n  />\n))\nPaginationContent.displayName = \"PaginationContent\"\n\nconst PaginationItem = React.forwardRef<\n  HTMLLIElement,\n  React.ComponentProps<\"li\">\n>(({ className, ...props }, ref) => (\n  <li ref={ref} className={cn(\"\", className)} {...props} />\n))\nPaginationItem.displayName = \"PaginationItem\"\n\ntype PaginationLinkProps = {\n  isActive?: boolean\n} & Pick<ButtonProps, \"size\"> &\n  React.ComponentProps<\"a\">\n\nconst PaginationLink = ({\n  className,\n  isActive,\n  size = \"icon\",\n  ...props\n}: PaginationLinkProps) => (\n  <a\n    aria-current={isActive ? \"page\" : undefined}\n    className={cn(\n      buttonVariants({\n        variant: isActive ? \"outline\" : \"ghost\",\n        size,\n      }),\n      className\n    )}\n    {...props}\n  />\n)\nPaginationLink.displayName = \"PaginationLink\"\n\nconst PaginationPrevious = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof PaginationLink>) => (\n  <PaginationLink\n    aria-label=\"Go to previous page\"\n    size=\"default\"\n    className={cn(\"gap-1 pl-2.5\", className)}\n    {...props}\n  >\n    <ChevronLeft className=\"h-4 w-4\" />\n    <span>Previous</span>\n  </PaginationLink>\n)\nPaginationPrevious.displayName = \"PaginationPrevious\"\n\nconst PaginationNext = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof PaginationLink>) => (\n  <PaginationLink\n    aria-label=\"Go to next page\"\n    size=\"default\"\n    className={cn(\"gap-1 pr-2.5\", className)}\n    {...props}\n  >\n    <span>Next</span>\n    <ChevronRight className=\"h-4 w-4\" />\n  </PaginationLink>\n)\nPaginationNext.displayName = \"PaginationNext\"\n\nconst PaginationEllipsis = ({\n  className,\n  ...props\n}: React.ComponentProps<\"span\">) => (\n  <span\n    aria-hidden\n    className={cn(\"flex h-9 w-9 items-center justify-center\", className)}\n    {...props}\n  >\n    <MoreHorizontal className=\"h-4 w-4\" />\n    <span className=\"sr-only\">More pages</span>\n  </span>\n)\nPaginationEllipsis.displayName = \"PaginationEllipsis\"\n\nexport {\n  Pagination,\n  PaginationContent,\n  PaginationEllipsis,\n  PaginationItem,\n  PaginationLink,\n  PaginationNext,\n  PaginationPrevious,\n}\n","size_bytes":2751},"client/src/pages/OnboardingProfile.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { useLocation } from \"wouter\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { useForm } from \"react-hook-form\";\nimport { Form, FormControl, FormField, FormItem, FormLabel, FormMessage } from \"@/components/ui/form\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { Loader2 } from \"lucide-react\";\n\ntype ProfileFormData = {\n  displayName: string;\n  stageName?: string;\n  pronouns?: string;\n  bio?: string;\n};\n\nexport default function OnboardingProfile() {\n  const [, setLocation] = useLocation();\n  const { toast } = useToast();\n  const [isSubmitting, setIsSubmitting] = useState(false);\n\n  const { data: user, isLoading: isLoadingUser } = useQuery<any>({\n    queryKey: [\"/api/auth/user\"],\n  });\n\n  const { data: progress } = useQuery<any>({\n    queryKey: [\"/api/onboarding/progress\"],\n  });\n\n  const form = useForm<ProfileFormData>({\n    defaultValues: {\n      displayName: \"\",\n      stageName: \"\",\n      pronouns: \"\",\n      bio: \"\",\n    },\n  });\n\n  const isCreator = user?.role === \"creator\";\n\n  const onSubmit = async (data: ProfileFormData) => {\n    setIsSubmitting(true);\n    try {\n      await apiRequest(\"/api/onboarding/setup-profile\", {\n        method: \"POST\",\n        body: JSON.stringify(data),\n      });\n\n      toast({\n        title: \"Profile updated!\",\n        description: \"Let's personalize your experience\",\n      });\n\n      queryClient.invalidateQueries({ queryKey: [\"/api/onboarding/progress\"] });\n      setLocation(\"/onboarding/interests\");\n    } catch (error) {\n      toast({\n        title: \"Error\",\n        description: \"Failed to update profile. Please try again.\",\n        variant: \"destructive\",\n      });\n    } finally {\n      setIsSubmitting(false);\n    }\n  };\n\n  if (isLoadingUser) {\n    return (\n      <div className=\"min-h-screen bg-gradient-to-br from-black via-gray-900 to-black flex items-center justify-center\">\n        <Loader2 className=\"w-8 h-8 animate-spin text-cyan-400\" />\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"min-h-screen bg-gradient-to-br from-black via-gray-900 to-black flex items-center justify-center p-4 sm:p-6 lg:p-8\">\n      <Card className=\"max-w-2xl w-full border-2 border-cyan-500/30 bg-black/40 backdrop-blur\">\n        <CardHeader className=\"text-center pb-4 sm:pb-6\">\n          <CardTitle className=\"text-2xl sm:text-3xl font-bold bg-gradient-to-r from-cyan-400 to-blue-500 bg-clip-text text-transparent\">\n            {isCreator ? \"Set Up Your Star Profile\" : \"Create Your Fanz Profile\"}\n          </CardTitle>\n          <p className=\"text-sm sm:text-base text-gray-400 mt-2\">\n            {isCreator \n              ? \"Tell your fans who you are and what makes you unique\"\n              : \"Let creators know a bit about yourself\"\n            }\n          </p>\n        </CardHeader>\n        <CardContent className=\"pt-0\">\n          <Form {...form}>\n            <form onSubmit={form.handleSubmit(onSubmit)} className=\"space-y-4 sm:space-y-6\">\n              <FormField\n                control={form.control}\n                name=\"displayName\"\n                rules={{ required: \"Display name is required\" }}\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel className=\"text-gray-200\">Display Name *</FormLabel>\n                    <FormControl>\n                      <Input\n                        {...field}\n                        placeholder=\"Enter your name\"\n                        className=\"bg-gray-900/50 border-gray-700 text-white h-11\"\n                        data-testid=\"input-display-name\"\n                      />\n                    </FormControl>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n\n              {isCreator && (\n                <FormField\n                  control={form.control}\n                  name=\"stageName\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel className=\"text-gray-200\">\n                        Stage Name / Performer Name\n                      </FormLabel>\n                      <FormControl>\n                        <Input\n                          {...field}\n                          placeholder=\"Your professional name\"\n                          className=\"bg-gray-900/50 border-gray-700 text-white h-11\"\n                          data-testid=\"input-stage-name\"\n                        />\n                      </FormControl>\n                      <p className=\"text-sm text-gray-500\">\n                        This is how fans will find you\n                      </p>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n              )}\n\n              <FormField\n                control={form.control}\n                name=\"pronouns\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel className=\"text-gray-200\">Pronouns (Optional)</FormLabel>\n                    <FormControl>\n                      <Input\n                        {...field}\n                        placeholder=\"e.g., she/her, he/him, they/them\"\n                        className=\"bg-gray-900/50 border-gray-700 text-white h-11\"\n                        data-testid=\"input-pronouns\"\n                      />\n                    </FormControl>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n\n              <FormField\n                control={form.control}\n                name=\"bio\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel className=\"text-gray-200\">\n                      {isCreator ? \"Creator Bio\" : \"About You\"}\n                    </FormLabel>\n                    <FormControl>\n                      <Textarea\n                        {...field}\n                        placeholder={isCreator \n                          ? \"Tell your fans what kind of content you create...\"\n                          : \"Share a bit about yourself and your interests...\"\n                        }\n                        className=\"bg-gray-900/50 border-gray-700 text-white min-h-[120px]\"\n                        data-testid=\"textarea-bio\"\n                      />\n                    </FormControl>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n\n              <div className=\"flex flex-col sm:flex-row gap-3 sm:gap-4 pt-4 sm:pt-6\">\n                <Button\n                  type=\"button\"\n                  variant=\"outline\"\n                  onClick={() => setLocation(\"/onboarding\")}\n                  className=\"w-full sm:flex-1 border-gray-700 text-gray-300 hover:bg-gray-800 h-11 sm:h-auto\"\n                  disabled={isSubmitting}\n                  data-testid=\"button-back\"\n                >\n                  Back\n                </Button>\n                <Button\n                  type=\"submit\"\n                  className=\"w-full sm:flex-1 bg-gradient-to-r from-cyan-500 to-blue-600 hover:from-cyan-600 hover:to-blue-700 text-white font-bold h-11 sm:h-auto\"\n                  disabled={isSubmitting}\n                  data-testid=\"button-continue\"\n                >\n                  {isSubmitting ? (\n                    <>\n                      <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />\n                      Saving...\n                    </>\n                  ) : (\n                    \"Continue\"\n                  )}\n                </Button>\n              </div>\n            </form>\n          </Form>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","size_bytes":7996},"client/src/components/ui/input-otp.tsx":{"content":"import * as React from \"react\"\nimport { OTPInput, OTPInputContext } from \"input-otp\"\nimport { Dot } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst InputOTP = React.forwardRef<\n  React.ElementRef<typeof OTPInput>,\n  React.ComponentPropsWithoutRef<typeof OTPInput>\n>(({ className, containerClassName, ...props }, ref) => (\n  <OTPInput\n    ref={ref}\n    containerClassName={cn(\n      \"flex items-center gap-2 has-[:disabled]:opacity-50\",\n      containerClassName\n    )}\n    className={cn(\"disabled:cursor-not-allowed\", className)}\n    {...props}\n  />\n))\nInputOTP.displayName = \"InputOTP\"\n\nconst InputOTPGroup = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\">\n>(({ className, ...props }, ref) => (\n  <div ref={ref} className={cn(\"flex items-center\", className)} {...props} />\n))\nInputOTPGroup.displayName = \"InputOTPGroup\"\n\nconst InputOTPSlot = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\"> & { index: number }\n>(({ index, className, ...props }, ref) => {\n  const inputOTPContext = React.useContext(OTPInputContext)\n  const { char, hasFakeCaret, isActive } = inputOTPContext.slots[index]\n\n  return (\n    <div\n      ref={ref}\n      className={cn(\n        \"relative flex h-10 w-10 items-center justify-center border-y border-r border-input text-sm transition-all first:rounded-l-md first:border-l last:rounded-r-md\",\n        isActive && \"z-10 ring-2 ring-ring ring-offset-background\",\n        className\n      )}\n      {...props}\n    >\n      {char}\n      {hasFakeCaret && (\n        <div className=\"pointer-events-none absolute inset-0 flex items-center justify-center\">\n          <div className=\"h-4 w-px animate-caret-blink bg-foreground duration-1000\" />\n        </div>\n      )}\n    </div>\n  )\n})\nInputOTPSlot.displayName = \"InputOTPSlot\"\n\nconst InputOTPSeparator = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\">\n>(({ ...props }, ref) => (\n  <div ref={ref} role=\"separator\" {...props}>\n    <Dot />\n  </div>\n))\nInputOTPSeparator.displayName = \"InputOTPSeparator\"\n\nexport { InputOTP, InputOTPGroup, InputOTPSlot, InputOTPSeparator }\n","size_bytes":2154},"client/src/pages/ContentUpload.tsx":{"content":"import { useState } from \"react\";\nimport { useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { useLocation } from \"wouter\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Label } from \"@/components/ui/label\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Switch } from \"@/components/ui/switch\";\nimport { Progress } from \"@/components/ui/progress\";\nimport { Alert, AlertDescription } from \"@/components/ui/alert\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { Upload, Image, Video, X, CheckCircle, AlertCircle } from \"lucide-react\";\n\ninterface UploadFormData {\n  title: string;\n  description: string;\n  price: string;\n  isPremium: boolean;\n  file: File | null;\n}\n\nexport default function ContentUpload() {\n  const [formData, setFormData] = useState<UploadFormData>({\n    title: \"\",\n    description: \"\",\n    price: \"\",\n    isPremium: false,\n    file: null\n  });\n  const [dragActive, setDragActive] = useState(false);\n  const [uploadProgress, setUploadProgress] = useState(0);\n  const [, setLocation] = useLocation();\n  const queryClient = useQueryClient();\n  const { toast } = useToast();\n\n  const uploadMutation = useMutation({\n    mutationFn: async (data: UploadFormData) => {\n      if (!data.file) throw new Error(\"No file selected\");\n      \n      const formDataToSend = new FormData();\n      formDataToSend.append(\"file\", data.file);\n      formDataToSend.append(\"title\", data.title);\n      formDataToSend.append(\"description\", data.description);\n      if (data.price) formDataToSend.append(\"price\", data.price);\n      formDataToSend.append(\"isPremium\", data.isPremium.toString());\n\n      return new Promise<Response>((resolve, reject) => {\n        const xhr = new XMLHttpRequest();\n        \n        // Track upload progress\n        xhr.upload.addEventListener('progress', (event) => {\n          if (event.lengthComputable) {\n            const percentComplete = Math.round((event.loaded / event.total) * 100);\n            setUploadProgress(percentComplete);\n          }\n        });\n\n        // Handle completion\n        xhr.onload = () => {\n          if (xhr.status >= 200 && xhr.status < 300) {\n            resolve(new Response(xhr.responseText, {\n              status: xhr.status,\n              statusText: xhr.statusText,\n              headers: new Headers(xhr.getAllResponseHeaders().split('\\r\\n').reduce((headers: Record<string, string>, line) => {\n                const [key, value] = line.split(': ');\n                if (key && value) headers[key] = value;\n                return headers;\n              }, {}))\n            }));\n          } else {\n            reject(new Error(`Upload failed with status ${xhr.status}`));\n          }\n        };\n\n        xhr.onerror = () => reject(new Error('Upload failed'));\n        xhr.onabort = () => reject(new Error('Upload aborted'));\n\n        xhr.open('POST', '/api/media');\n        xhr.withCredentials = true;\n        xhr.send(formDataToSend);\n      });\n    },\n    onMutate: () => {\n      setUploadProgress(0);\n    },\n    onSuccess: async (response) => {\n      setUploadProgress(100);\n      if (response.ok) {\n        toast({\n          title: \"Upload Successful\",\n          description: \"Your content has been uploaded and is pending moderation.\"\n        });\n        queryClient.invalidateQueries({ queryKey: [\"/api/media\"] });\n        setTimeout(() => {\n          setLocation(\"/content-manage\");\n        }, 1000); // Brief delay to show 100% completion\n      } else {\n        const error = await response.text();\n        throw new Error(error || \"Upload failed\");\n      }\n    },\n    onError: (error) => {\n      setUploadProgress(0);\n      toast({\n        title: \"Upload Failed\",\n        description: error.message,\n        variant: \"destructive\"\n      });\n    }\n  });\n\n  const handleDrag = (e: React.DragEvent) => {\n    e.preventDefault();\n    e.stopPropagation();\n    if (e.type === \"dragenter\" || e.type === \"dragover\") {\n      setDragActive(true);\n    } else if (e.type === \"dragleave\") {\n      setDragActive(false);\n    }\n  };\n\n  const handleDrop = (e: React.DragEvent) => {\n    e.preventDefault();\n    e.stopPropagation();\n    setDragActive(false);\n    \n    if (e.dataTransfer.files && e.dataTransfer.files[0]) {\n      const file = e.dataTransfer.files[0];\n      handleFileSelect(file);\n    }\n  };\n\n  const handleFileSelect = (file: File) => {\n    const allowedTypes = [\n      'image/jpeg', 'image/png', 'image/gif', 'image/webp',\n      'video/mp4', 'video/webm', 'video/mov', 'video/avi'\n    ];\n\n    if (!allowedTypes.includes(file.type)) {\n      toast({\n        title: \"Invalid File Type\",\n        description: \"Please select an image or video file.\",\n        variant: \"destructive\"\n      });\n      return;\n    }\n\n    if (file.size > 500 * 1024 * 1024) {\n      toast({\n        title: \"File Too Large\",\n        description: \"File size must be under 500MB.\",\n        variant: \"destructive\"\n      });\n      return;\n    }\n\n    setFormData(prev => ({\n      ...prev,\n      file,\n      title: prev.title || file.name.split('.')[0]\n    }));\n  };\n\n  const removeFile = () => {\n    setFormData(prev => ({ ...prev, file: null }));\n  };\n\n  const handleSubmit = (e: React.FormEvent) => {\n    e.preventDefault();\n    \n    if (!formData.file) {\n      toast({\n        title: \"No File Selected\",\n        description: \"Please select a file to upload.\",\n        variant: \"destructive\"\n      });\n      return;\n    }\n\n    uploadMutation.mutate(formData);\n  };\n\n  const isVideo = formData.file?.type.startsWith('video/');\n  const isImage = formData.file?.type.startsWith('image/');\n\n  return (\n    <div className=\"min-h-screen bg-gradient-to-br from-slate-900 via-purple-900 to-slate-800 p-6\">\n      <div className=\"max-w-4xl mx-auto\">\n        <div className=\"mb-8\">\n          <h1 className=\"text-3xl font-bold text-white mb-2\">Upload Content</h1>\n          <p className=\"text-slate-300\">Share your premium content with subscribers</p>\n        </div>\n\n        <form onSubmit={handleSubmit} className=\"space-y-8\">\n          {/* File Upload Area */}\n          <Card className=\"border-slate-700 bg-slate-800/50\">\n            <CardHeader>\n              <CardTitle className=\"text-white flex items-center gap-2\">\n                <Upload className=\"h-5 w-5 text-cyan-400\" />\n                Upload File\n              </CardTitle>\n              <CardDescription className=\"text-slate-400\">\n                Drag and drop your file here, or click to browse. Max size: 500MB\n              </CardDescription>\n            </CardHeader>\n            <CardContent>\n              {!formData.file ? (\n                <div\n                  className={`border-2 border-dashed rounded-lg p-8 text-center transition-colors ${\n                    dragActive\n                      ? \"border-cyan-400 bg-cyan-400/10\"\n                      : \"border-slate-600 hover:border-slate-500\"\n                  }`}\n                  onDragEnter={handleDrag}\n                  onDragLeave={handleDrag}\n                  onDragOver={handleDrag}\n                  onDrop={handleDrop}\n                  onClick={() => document.getElementById('file-input')?.click()}\n                  data-testid=\"upload-dropzone\"\n                >\n                  <Upload className=\"h-16 w-16 text-slate-400 mx-auto mb-4\" />\n                  <p className=\"text-lg text-white mb-2\">Drop your file here</p>\n                  <p className=\"text-slate-400 mb-4\">or click to browse</p>\n                  <p className=\"text-sm text-slate-500\">\n                    Supports: JPEG, PNG, GIF, WebP, MP4, WebM, MOV, AVI\n                  </p>\n                  <input\n                    id=\"file-input\"\n                    type=\"file\"\n                    className=\"hidden\"\n                    accept=\"image/*,video/*\"\n                    onChange={(e) => e.target.files?.[0] && handleFileSelect(e.target.files[0])}\n                    data-testid=\"file-input\"\n                  />\n                </div>\n              ) : (\n                <div className=\"flex items-center gap-4 p-4 bg-slate-700/50 rounded-lg\">\n                  {isImage && <Image className=\"h-8 w-8 text-cyan-400\" />}\n                  {isVideo && <Video className=\"h-8 w-8 text-cyan-400\" />}\n                  <div className=\"flex-1\">\n                    <p className=\"text-white font-medium\">{formData.file.name}</p>\n                    <p className=\"text-slate-400 text-sm\">\n                      {(formData.file.size / (1024 * 1024)).toFixed(2)} MB\n                    </p>\n                  </div>\n                  <Button\n                    type=\"button\"\n                    variant=\"ghost\"\n                    size=\"sm\"\n                    onClick={removeFile}\n                    className=\"text-slate-400 hover:text-white\"\n                    data-testid=\"remove-file\"\n                  >\n                    <X className=\"h-4 w-4\" />\n                  </Button>\n                </div>\n              )}\n            </CardContent>\n          </Card>\n\n          {/* Content Details */}\n          <Card className=\"border-slate-700 bg-slate-800/50\">\n            <CardHeader>\n              <CardTitle className=\"text-white\">Content Details</CardTitle>\n              <CardDescription className=\"text-slate-400\">\n                Add title, description, and pricing information\n              </CardDescription>\n            </CardHeader>\n            <CardContent className=\"space-y-6\">\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"title\" className=\"text-white\">Title</Label>\n                <Input\n                  id=\"title\"\n                  value={formData.title}\n                  onChange={(e) => setFormData(prev => ({ ...prev, title: e.target.value }))}\n                  className=\"bg-slate-700 border-slate-600 text-white\"\n                  placeholder=\"Enter content title...\"\n                  required\n                  data-testid=\"input-title\"\n                />\n              </div>\n\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"description\" className=\"text-white\">Description</Label>\n                <Textarea\n                  id=\"description\"\n                  value={formData.description}\n                  onChange={(e) => setFormData(prev => ({ ...prev, description: e.target.value }))}\n                  className=\"bg-slate-700 border-slate-600 text-white min-h-[100px]\"\n                  placeholder=\"Describe your content...\"\n                  data-testid=\"input-description\"\n                />\n              </div>\n\n              <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n                <div className=\"space-y-2\">\n                  <Label htmlFor=\"price\" className=\"text-white\">Price (Optional)</Label>\n                  <Input\n                    id=\"price\"\n                    type=\"number\"\n                    step=\"0.01\"\n                    min=\"0\"\n                    value={formData.price}\n                    onChange={(e) => setFormData(prev => ({ ...prev, price: e.target.value }))}\n                    className=\"bg-slate-700 border-slate-600 text-white\"\n                    placeholder=\"0.00\"\n                    data-testid=\"input-price\"\n                  />\n                  <p className=\"text-sm text-slate-400\">Leave empty for subscription-only content</p>\n                </div>\n\n                <div className=\"space-y-2\">\n                  <Label className=\"text-white\">Premium Content</Label>\n                  <div className=\"flex items-center space-x-2\">\n                    <Switch\n                      checked={formData.isPremium}\n                      onCheckedChange={(checked) => setFormData(prev => ({ ...prev, isPremium: checked }))}\n                      data-testid=\"switch-premium\"\n                    />\n                    <span className=\"text-slate-300\">Premium subscribers only</span>\n                  </div>\n                  <p className=\"text-sm text-slate-400\">Premium content is only visible to premium subscribers</p>\n                </div>\n              </div>\n            </CardContent>\n          </Card>\n\n          {/* Upload Progress */}\n          {uploadMutation.isPending && (\n            <Card className=\"border-slate-700 bg-slate-800/50\">\n              <CardContent className=\"pt-6\">\n                <div className=\"flex items-center gap-4\">\n                  <div className=\"flex-1\">\n                    <div className=\"flex items-center justify-between mb-2\">\n                      <span className=\"text-white font-medium\">\n                        {uploadProgress === 100 ? \"Processing...\" : \"Uploading...\"}\n                      </span>\n                      <span className=\"text-slate-400 text-sm\">{uploadProgress}%</span>\n                    </div>\n                    <Progress value={uploadProgress} className=\"h-2\" />\n                    <p className=\"text-sm text-slate-400 mt-2\">\n                      {uploadProgress < 100 \n                        ? \"Uploading your content to secure storage...\" \n                        : \"Upload complete! Starting content moderation...\"}\n                    </p>\n                  </div>\n                </div>\n              </CardContent>\n            </Card>\n          )}\n\n          {/* Submit Button */}\n          <div className=\"flex justify-between\">\n            <Button\n              type=\"button\"\n              variant=\"outline\"\n              onClick={() => setLocation(\"/content-manage\")}\n              className=\"border-slate-600 text-slate-300 hover:bg-slate-700\"\n              data-testid=\"button-cancel\"\n            >\n              Cancel\n            </Button>\n            <Button\n              type=\"submit\"\n              disabled={!formData.file || uploadMutation.isPending}\n              className=\"bg-gradient-to-r from-cyan-500 to-blue-600 hover:from-cyan-600 hover:to-blue-700\"\n              data-testid=\"button-upload\"\n            >\n              {uploadMutation.isPending ? (\n                <>\n                  <div className=\"animate-spin rounded-full h-4 w-4 border-2 border-white border-t-transparent mr-2\" />\n                  Uploading...\n                </>\n              ) : (\n                <>\n                  <Upload className=\"h-4 w-4 mr-2\" />\n                  Upload Content\n                </>\n              )}\n            </Button>\n          </div>\n        </form>\n\n        {/* Upload Guidelines */}\n        <Card className=\"border-slate-700 bg-slate-800/50 mt-8\">\n          <CardHeader>\n            <CardTitle className=\"text-white flex items-center gap-2\">\n              <AlertCircle className=\"h-5 w-5 text-yellow-400\" />\n              Content Guidelines\n            </CardTitle>\n          </CardHeader>\n          <CardContent className=\"space-y-4\">\n            <Alert className=\"border-blue-600 bg-blue-600/10\">\n              <CheckCircle className=\"h-4 w-4 text-blue-400\" />\n              <AlertDescription className=\"text-blue-300\">\n                All content goes through automated and manual moderation before being published.\n              </AlertDescription>\n            </Alert>\n            \n            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm\">\n              <div className=\"space-y-2\">\n                <h4 className=\"text-white font-medium\">Allowed Content:</h4>\n                <ul className=\"text-slate-400 space-y-1\">\n                  <li>• Original photos and videos</li>\n                  <li>• Age-verified creator content</li>\n                  <li>• Properly licensed material</li>\n                  <li>• Content following platform guidelines</li>\n                </ul>\n              </div>\n              \n              <div className=\"space-y-2\">\n                <h4 className=\"text-white font-medium\">Technical Limits:</h4>\n                <ul className=\"text-slate-400 space-y-1\">\n                  <li>• Maximum file size: 500MB</li>\n                  <li>• Supported formats: JPEG, PNG, GIF, WebP, MP4, WebM, MOV, AVI</li>\n                  <li>• Video duration: No limit</li>\n                  <li>• Resolution: Up to 4K supported</li>\n                </ul>\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n    </div>\n  );\n}","size_bytes":16323},"client/src/components/ui/dialog.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as DialogPrimitive from \"@radix-ui/react-dialog\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Dialog = DialogPrimitive.Root\n\nconst DialogTrigger = DialogPrimitive.Trigger\n\nconst DialogPortal = DialogPrimitive.Portal\n\nconst DialogClose = DialogPrimitive.Close\n\nconst DialogOverlay = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Overlay\n    ref={ref}\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n  />\n))\nDialogOverlay.displayName = DialogPrimitive.Overlay.displayName\n\nconst DialogContent = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <DialogPortal>\n    <DialogOverlay />\n    <DialogPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg\",\n        className\n      )}\n      {...props}\n    >\n      {children}\n      <DialogPrimitive.Close className=\"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground\">\n        <X className=\"h-4 w-4\" />\n        <span className=\"sr-only\">Close</span>\n      </DialogPrimitive.Close>\n    </DialogPrimitive.Content>\n  </DialogPortal>\n))\nDialogContent.displayName = DialogPrimitive.Content.displayName\n\nconst DialogHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-1.5 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nDialogHeader.displayName = \"DialogHeader\"\n\nconst DialogFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nDialogFooter.displayName = \"DialogFooter\"\n\nconst DialogTitle = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Title\n    ref={ref}\n    className={cn(\n      \"text-lg font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nDialogTitle.displayName = DialogPrimitive.Title.displayName\n\nconst DialogDescription = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nDialogDescription.displayName = DialogPrimitive.Description.displayName\n\nexport {\n  Dialog,\n  DialogPortal,\n  DialogOverlay,\n  DialogClose,\n  DialogTrigger,\n  DialogContent,\n  DialogHeader,\n  DialogFooter,\n  DialogTitle,\n  DialogDescription,\n}\n","size_bytes":3848},"server/middleware/auth.ts":{"content":"import { Request, Response, NextFunction } from \"express\";\nimport { authService, JWTPayload } from \"../auth\";\nimport { storage } from \"../storage\";\nimport { logger } from \"../logger\";\n\n// Define authenticated user type for JWT auth\nexport interface AuthenticatedUser {\n  id: string;\n  email: string;\n  role: string;\n  firstName?: string;\n  lastName?: string;\n}\n\ndeclare global {\n  namespace Express {\n    interface Request {\n      user?: AuthenticatedUser;\n    }\n  }\n}\n\nexport const authenticateJWT = async (req: Request, res: Response, next: NextFunction) => {\n  try {\n    const authHeader = req.headers.authorization;\n    const token = authHeader?.startsWith(\"Bearer \") ? authHeader.slice(7) : null;\n\n    if (!token) {\n      return res.status(401).json({ message: \"No token provided\" });\n    }\n\n    const payload = authService.verifyToken(token);\n    const user = await storage.getUser(payload.userId);\n\n    if (!user || user.status !== \"active\") {\n      return res.status(401).json({ message: \"Invalid or inactive user\" });\n    }\n\n    req.user = {\n      id: user.id,\n      email: user.email!,\n      role: user.role!,\n      firstName: user.firstName || undefined,\n      lastName: user.lastName || undefined,\n    };\n\n    next();\n  } catch (error) {\n    logger.warn(`JWT authentication failed: ${error instanceof Error ? error.message : String(error)}`);\n    res.status(401).json({ message: \"Invalid token\" });\n  }\n};\n\nexport const requireRole = (roles: string[]) => {\n  return (req: Request, res: Response, next: NextFunction) => {\n    if (!req.user) {\n      return res.status(401).json({ message: \"Authentication required\" });\n    }\n\n    // Get role from either JWT user or from database lookup for Replit users\n    const userRole = req.user.role;\n    if (!userRole || !roles.includes(userRole)) {\n      return res.status(403).json({ message: \"Insufficient permissions\" });\n    }\n\n    next();\n  };\n};\n\nexport const requireCreator = requireRole([\"creator\", \"admin\"]);\nexport const requireAdmin = requireRole([\"admin\"]);\n\n// Middleware to check if user is authenticated (JWT only)\nexport const requireAuth = authenticateJWT;\n\n// Optional authentication - doesn't fail if no token provided\nexport const optionalAuth = async (req: Request, res: Response, next: NextFunction) => {\n  try {\n    const authHeader = req.headers.authorization;\n    const token = authHeader?.startsWith(\"Bearer \") ? authHeader.slice(7) : null;\n\n    if (!token) {\n      // No token provided, continue without user\n      return next();\n    }\n\n    try {\n      const payload = authService.verifyToken(token);\n      const user = await storage.getUser(payload.userId);\n\n      if (user && user.status === \"active\") {\n        req.user = {\n          id: user.id,\n          email: user.email!,\n          role: user.role!,\n          firstName: user.firstName || undefined,\n          lastName: user.lastName || undefined,\n        };\n      }\n    } catch (error) {\n      // Invalid token, but don't fail the request\n      logger.debug(`Optional auth failed: ${error instanceof Error ? error.message : String(error)}`);\n    }\n\n    next();\n  } catch (error) {\n    logger.error(`Optional auth middleware error: ${error instanceof Error ? error.message : String(error)}`);\n    next(); // Continue even on error\n  }\n};\n\n// Authorization helper to verify path param matches authenticated user\nexport const verifyOwnership = (paramName: string) => {\n  return (req: Request, res: Response, next: NextFunction) => {\n    const userId = req.user?.id;\n    const paramValue = req.params[paramName];\n\n    if (!userId) {\n      return res.status(401).json({ message: \"Authentication required\" });\n    }\n\n    if (userId !== paramValue) {\n      logger.warn(`Authorization failed: User ${userId} attempted to access resource belonging to ${paramValue}`);\n      return res.status(403).json({ message: \"Access denied: You can only access your own resources\" });\n    }\n\n    next();\n  };\n};\n","size_bytes":3928},"client/src/components/media/MediaUpload.tsx":{"content":"import { useState } from \"react\";\nimport { useAuth } from \"@/hooks/useAuth\";\nimport { useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { isUnauthorizedError } from \"@/lib/authUtils\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Label } from \"@/components/ui/label\";\nimport { Switch } from \"@/components/ui/switch\";\nimport { Progress } from \"@/components/ui/progress\";\nimport { \n  Upload, \n  Image, \n  Video, \n  File, \n  X, \n  DollarSign, \n  Shield,\n  AlertTriangle,\n  CheckCircle\n} from \"lucide-react\";\n\ninterface UploadData {\n  title: string;\n  description: string;\n  price: string;\n  isPremium: boolean;\n}\n\nexport default function MediaUpload() {\n  const { user } = useAuth();\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n  \n  const [uploadData, setUploadData] = useState<UploadData>({\n    title: \"\",\n    description: \"\",\n    price: \"\",\n    isPremium: false,\n  });\n  \n  const [selectedFiles, setSelectedFiles] = useState<File[]>([]);\n  const [dragActive, setDragActive] = useState(false);\n  const [uploadProgress, setUploadProgress] = useState(0);\n\n  const createMediaMutation = useMutation({\n    mutationFn: async (data: any) => {\n      const response = await apiRequest(\"POST\", \"/api/media\", data);\n      return response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/media\"] });\n      toast({\n        title: \"Content Uploaded\",\n        description: \"Your content has been submitted for review.\",\n      });\n      \n      // Reset form\n      setUploadData({\n        title: \"\",\n        description: \"\",\n        price: \"\",\n        isPremium: false,\n      });\n      setSelectedFiles([]);\n      setUploadProgress(0);\n    },\n    onError: (error) => {\n      if (isUnauthorizedError(error as Error)) {\n        toast({\n          title: \"Unauthorized\",\n          description: \"You are logged out. Logging in again...\",\n          variant: \"destructive\",\n        });\n        setTimeout(() => {\n          window.location.href = \"/api/login\";\n        }, 500);\n        return;\n      }\n      toast({\n        title: \"Upload Failed\",\n        description: \"Failed to upload content. Please try again.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const handleDrag = (e: React.DragEvent) => {\n    e.preventDefault();\n    e.stopPropagation();\n    if (e.type === \"dragenter\" || e.type === \"dragover\") {\n      setDragActive(true);\n    } else if (e.type === \"dragleave\") {\n      setDragActive(false);\n    }\n  };\n\n  const handleDrop = (e: React.DragEvent) => {\n    e.preventDefault();\n    e.stopPropagation();\n    setDragActive(false);\n    \n    const files = Array.from(e.dataTransfer.files);\n    handleFiles(files);\n  };\n\n  const handleFileSelect = (e: React.ChangeEvent<HTMLInputElement>) => {\n    if (e.target.files) {\n      const files = Array.from(e.target.files);\n      handleFiles(files);\n    }\n  };\n\n  const handleFiles = (files: File[]) => {\n    const validFiles = files.filter(file => {\n      const validTypes = [\n        'image/jpeg', 'image/png', 'image/gif', 'image/webp',\n        'video/mp4', 'video/webm', 'video/mov', 'video/avi'\n      ];\n      const maxSize = 500 * 1024 * 1024; // 500MB\n      \n      if (!validTypes.includes(file.type)) {\n        toast({\n          title: \"Invalid File Type\",\n          description: `${file.name} is not a supported file type.`,\n          variant: \"destructive\",\n        });\n        return false;\n      }\n      \n      if (file.size > maxSize) {\n        toast({\n          title: \"File Too Large\",\n          description: `${file.name} exceeds the 500MB limit.`,\n          variant: \"destructive\",\n        });\n        return false;\n      }\n      \n      return true;\n    });\n\n    setSelectedFiles(prev => [...prev, ...validFiles]);\n  };\n\n  const removeFile = (index: number) => {\n    setSelectedFiles(prev => prev.filter((_, i) => i !== index));\n  };\n\n  const getFileIcon = (file: File) => {\n    if (file.type.startsWith('image/')) {\n      return <Image className=\"h-8 w-8 text-df-cyan\" />;\n    } else if (file.type.startsWith('video/')) {\n      return <Video className=\"h-8 w-8 text-df-gold\" />;\n    } else {\n      return <File className=\"h-8 w-8 text-df-steel\" />;\n    }\n  };\n\n  const formatFileSize = (bytes: number) => {\n    if (bytes === 0) return '0 Bytes';\n    const k = 1024;\n    const sizes = ['Bytes', 'KB', 'MB', 'GB'];\n    const i = Math.floor(Math.log(bytes) / Math.log(k));\n    return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];\n  };\n\n  const handleSubmit = () => {\n    if (!uploadData.title.trim()) {\n      toast({\n        title: \"Title Required\",\n        description: \"Please provide a title for your content.\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    if (selectedFiles.length === 0) {\n      toast({\n        title: \"No Files Selected\",\n        description: \"Please select files to upload.\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    // Create FormData for file upload\n    const formData = new FormData();\n    formData.append('file', selectedFiles[0]);\n    formData.append('title', uploadData.title);\n    formData.append('description', uploadData.description);\n    if (uploadData.price) {\n      formData.append('price', uploadData.price);\n    }\n    formData.append('isPremium', uploadData.isPremium.toString());\n\n    // Simulate upload progress\n    const progressInterval = setInterval(() => {\n      setUploadProgress(prev => {\n        if (prev >= 90) {\n          clearInterval(progressInterval);\n          return 90;\n        }\n        return prev + 10;\n      });\n    }, 200);\n\n    // Upload file with FormData\n    createMediaMutation.mutate(formData);\n    \n    // Complete progress\n    setTimeout(() => {\n      setUploadProgress(100);\n      clearInterval(progressInterval);\n    }, 1000);\n  };\n\n  const isCreator = user?.role === \"creator\" || user?.role === \"admin\";\n\n  if (!isCreator) {\n    return (\n      <Card className=\"card-df\">\n        <CardContent className=\"pt-6 text-center\">\n          <Shield className=\"h-12 w-12 text-df-fog mx-auto mb-4\" />\n          <h3 className=\"text-df-snow text-lg font-semibold mb-2\">Creator Access Required</h3>\n          <p className=\"text-df-fog\">You need to be a creator to upload content.</p>\n        </CardContent>\n      </Card>\n    );\n  }\n\n  return (\n    <div className=\"space-y-8\">\n      {/* Upload Area */}\n      <Card className=\"card-df\">\n        <CardHeader>\n          <CardTitle className=\"text-xl neon-subheading\">\n            Upload Content\n          </CardTitle>\n        </CardHeader>\n        <CardContent>\n          {/* File Drop Zone */}\n          <div\n            className={`border-2 border-dashed rounded-lg p-8 text-center transition-colors ${\n              dragActive \n                ? 'border-df-cyan bg-df-cyan bg-opacity-10' \n                : 'border-df-steel hover:border-df-cyan hover:bg-df-steel hover:bg-opacity-10'\n            }`}\n            onDragEnter={handleDrag}\n            onDragLeave={handleDrag}\n            onDragOver={handleDrag}\n            onDrop={handleDrop}\n            data-testid=\"file-drop-zone\"\n          >\n            <Upload className=\"h-12 w-12 text-df-fog mx-auto mb-4\" />\n            <h3 className=\"text-df-snow text-lg font-semibold mb-2\">\n              Drop files here or click to browse\n            </h3>\n            <p className=\"text-df-fog text-sm mb-4\">\n              Supports images and videos up to 500MB\n            </p>\n            <input\n              type=\"file\"\n              multiple\n              accept=\"image/*,video/*\"\n              onChange={handleFileSelect}\n              className=\"hidden\"\n              id=\"file-upload\"\n              data-testid=\"file-input\"\n            />\n            <Button \n              asChild \n              className=\"btn-primary\"\n              data-testid=\"button-browse-files\"\n            >\n              <label htmlFor=\"file-upload\" className=\"cursor-pointer\">\n                Browse Files\n              </label>\n            </Button>\n            \n            <div className=\"mt-4 text-df-fog text-xs\">\n              <p>Supported formats: JPEG, PNG, GIF, WebP, MP4, WebM, MOV, AVI</p>\n              <p>Maximum file size: 500MB per file</p>\n            </div>\n          </div>\n\n          {/* Selected Files */}\n          {selectedFiles.length > 0 && (\n            <div className=\"mt-6\">\n              <h4 className=\"text-df-snow font-semibold mb-3\">Selected Files</h4>\n              <div className=\"space-y-2\">\n                {selectedFiles.map((file, index) => (\n                  <div \n                    key={index} \n                    className=\"flex items-center justify-between bg-df-ink border border-df-steel rounded-md p-3\"\n                  >\n                    <div className=\"flex items-center space-x-3\">\n                      {getFileIcon(file)}\n                      <div>\n                        <p className=\"text-df-snow font-medium text-sm\" data-testid={`file-name-${index}`}>\n                          {file.name}\n                        </p>\n                        <p className=\"text-df-fog text-xs\">\n                          {formatFileSize(file.size)} • {file.type}\n                        </p>\n                      </div>\n                    </div>\n                    <Button\n                      onClick={() => removeFile(index)}\n                      variant=\"ghost\"\n                      size=\"sm\"\n                      className=\"text-red-400 hover:text-red-300 hover:bg-red-900 hover:bg-opacity-20\"\n                      data-testid={`button-remove-file-${index}`}\n                    >\n                      <X className=\"h-4 w-4\" />\n                    </Button>\n                  </div>\n                ))}\n              </div>\n            </div>\n          )}\n\n          {/* Upload Progress */}\n          {uploadProgress > 0 && uploadProgress < 100 && (\n            <div className=\"mt-6\">\n              <div className=\"flex items-center justify-between mb-2\">\n                <span className=\"text-df-snow text-sm\">Uploading...</span>\n                <span className=\"text-df-cyan text-sm\">{uploadProgress}%</span>\n              </div>\n              <Progress value={uploadProgress} className=\"w-full\" />\n            </div>\n          )}\n        </CardContent>\n      </Card>\n\n      {/* Content Details */}\n      <Card className=\"card-df\">\n        <CardHeader>\n          <CardTitle className=\"text-xl neon-subheading\">\n            Content Details\n          </CardTitle>\n        </CardHeader>\n        <CardContent className=\"space-y-4\">\n          <div>\n            <Label htmlFor=\"title\" className=\"text-df-fog\">Title *</Label>\n            <Input\n              id=\"title\"\n              type=\"text\"\n              value={uploadData.title}\n              onChange={(e) => setUploadData(prev => ({ ...prev, title: e.target.value }))}\n              className=\"input-df\"\n              placeholder=\"Give your content a catchy title\"\n              required\n              data-testid=\"input-content-title\"\n            />\n          </div>\n          \n          <div>\n            <Label htmlFor=\"description\" className=\"text-df-fog\">Description</Label>\n            <Textarea\n              id=\"description\"\n              rows={4}\n              value={uploadData.description}\n              onChange={(e) => setUploadData(prev => ({ ...prev, description: e.target.value }))}\n              className=\"input-df resize-none\"\n              placeholder=\"Describe your content...\"\n              data-testid=\"textarea-content-description\"\n            />\n          </div>\n\n          {/* Premium Content Toggle */}\n          <div className=\"flex items-center justify-between bg-df-ink border border-df-steel rounded-md p-4\">\n            <div className=\"flex items-center space-x-3\">\n              <DollarSign className=\"h-5 w-5 text-df-gold\" />\n              <div>\n                <Label className=\"text-df-snow\">Premium Content</Label>\n                <p className=\"text-df-fog text-sm\">Require payment to view this content</p>\n              </div>\n            </div>\n            <Switch\n              checked={uploadData.isPremium}\n              onCheckedChange={(checked) => setUploadData(prev => ({ ...prev, isPremium: checked }))}\n              data-testid=\"switch-premium-content\"\n            />\n          </div>\n\n          {/* Price Input */}\n          {uploadData.isPremium && (\n            <div>\n              <Label htmlFor=\"price\" className=\"text-df-fog\">Price ($)</Label>\n              <Input\n                id=\"price\"\n                type=\"number\"\n                step=\"0.01\"\n                min=\"0\"\n                value={uploadData.price}\n                onChange={(e) => setUploadData(prev => ({ ...prev, price: e.target.value }))}\n                className=\"input-df\"\n                placeholder=\"0.00\"\n                data-testid=\"input-content-price\"\n              />\n            </div>\n          )}\n\n          {/* Compliance Notice */}\n          <div className=\"bg-yellow-900 bg-opacity-20 border border-yellow-600 rounded-md p-4\">\n            <div className=\"flex items-start space-x-3\">\n              <AlertTriangle className=\"h-5 w-5 text-yellow-500 mt-0.5\" />\n              <div>\n                <h4 className=\"text-yellow-200 font-semibold mb-1\">Content Guidelines</h4>\n                <ul className=\"text-yellow-100 text-sm space-y-1\">\n                  <li>• All content must comply with 18 U.S.C. §2257 requirements</li>\n                  <li>• Only verified performers (18+) are allowed</li>\n                  <li>• Content will be reviewed before publication</li>\n                  <li>• Prohibited content will be rejected and may result in account suspension</li>\n                </ul>\n              </div>\n            </div>\n          </div>\n\n          {/* Submit Button */}\n          <Button\n            onClick={handleSubmit}\n            disabled={createMediaMutation.isPending || uploadProgress > 0}\n            className=\"w-full btn-primary\"\n            data-testid=\"button-submit-upload\"\n          >\n            {createMediaMutation.isPending ? (\n              \"Processing...\"\n            ) : uploadProgress > 0 ? (\n              \"Uploading...\"\n            ) : (\n              \"Upload Content\"\n            )}\n          </Button>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","size_bytes":14595},"client/src/components/ui/scroll-area.tsx":{"content":"import * as React from \"react\"\nimport * as ScrollAreaPrimitive from \"@radix-ui/react-scroll-area\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ScrollArea = React.forwardRef<\n  React.ElementRef<typeof ScrollAreaPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ScrollAreaPrimitive.Root>\n>(({ className, children, ...props }, ref) => (\n  <ScrollAreaPrimitive.Root\n    ref={ref}\n    className={cn(\"relative overflow-hidden\", className)}\n    {...props}\n  >\n    <ScrollAreaPrimitive.Viewport className=\"h-full w-full rounded-[inherit]\">\n      {children}\n    </ScrollAreaPrimitive.Viewport>\n    <ScrollBar />\n    <ScrollAreaPrimitive.Corner />\n  </ScrollAreaPrimitive.Root>\n))\nScrollArea.displayName = ScrollAreaPrimitive.Root.displayName\n\nconst ScrollBar = React.forwardRef<\n  React.ElementRef<typeof ScrollAreaPrimitive.ScrollAreaScrollbar>,\n  React.ComponentPropsWithoutRef<typeof ScrollAreaPrimitive.ScrollAreaScrollbar>\n>(({ className, orientation = \"vertical\", ...props }, ref) => (\n  <ScrollAreaPrimitive.ScrollAreaScrollbar\n    ref={ref}\n    orientation={orientation}\n    className={cn(\n      \"flex touch-none select-none transition-colors\",\n      orientation === \"vertical\" &&\n        \"h-full w-2.5 border-l border-l-transparent p-[1px]\",\n      orientation === \"horizontal\" &&\n        \"h-2.5 flex-col border-t border-t-transparent p-[1px]\",\n      className\n    )}\n    {...props}\n  >\n    <ScrollAreaPrimitive.ScrollAreaThumb className=\"relative flex-1 rounded-full bg-border\" />\n  </ScrollAreaPrimitive.ScrollAreaScrollbar>\n))\nScrollBar.displayName = ScrollAreaPrimitive.ScrollAreaScrollbar.displayName\n\nexport { ScrollArea, ScrollBar }\n","size_bytes":1642},"client/src/components/ui/slider.tsx":{"content":"import * as React from \"react\"\nimport * as SliderPrimitive from \"@radix-ui/react-slider\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Slider = React.forwardRef<\n  React.ElementRef<typeof SliderPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof SliderPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <SliderPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative flex w-full touch-none select-none items-center\",\n      className\n    )}\n    {...props}\n  >\n    <SliderPrimitive.Track className=\"relative h-2 w-full grow overflow-hidden rounded-full bg-secondary\">\n      <SliderPrimitive.Range className=\"absolute h-full bg-primary\" />\n    </SliderPrimitive.Track>\n    <SliderPrimitive.Thumb className=\"block h-5 w-5 rounded-full border-2 border-primary bg-background ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50\" />\n  </SliderPrimitive.Root>\n))\nSlider.displayName = SliderPrimitive.Root.displayName\n\nexport { Slider }\n","size_bytes":1077},"client/src/components/ui/hover-card.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as HoverCardPrimitive from \"@radix-ui/react-hover-card\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst HoverCard = HoverCardPrimitive.Root\n\nconst HoverCardTrigger = HoverCardPrimitive.Trigger\n\nconst HoverCardContent = React.forwardRef<\n  React.ElementRef<typeof HoverCardPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof HoverCardPrimitive.Content>\n>(({ className, align = \"center\", sideOffset = 4, ...props }, ref) => (\n  <HoverCardPrimitive.Content\n    ref={ref}\n    align={align}\n    sideOffset={sideOffset}\n    className={cn(\n      \"z-50 w-64 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-hover-card-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nHoverCardContent.displayName = HoverCardPrimitive.Content.displayName\n\nexport { HoverCard, HoverCardTrigger, HoverCardContent }\n","size_bytes":1251},"client/src/components/ui/context-menu.tsx":{"content":"import * as React from \"react\"\nimport * as ContextMenuPrimitive from \"@radix-ui/react-context-menu\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ContextMenu = ContextMenuPrimitive.Root\n\nconst ContextMenuTrigger = ContextMenuPrimitive.Trigger\n\nconst ContextMenuGroup = ContextMenuPrimitive.Group\n\nconst ContextMenuPortal = ContextMenuPrimitive.Portal\n\nconst ContextMenuSub = ContextMenuPrimitive.Sub\n\nconst ContextMenuRadioGroup = ContextMenuPrimitive.RadioGroup\n\nconst ContextMenuSubTrigger = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <ContextMenuPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto h-4 w-4\" />\n  </ContextMenuPrimitive.SubTrigger>\n))\nContextMenuSubTrigger.displayName = ContextMenuPrimitive.SubTrigger.displayName\n\nconst ContextMenuSubContent = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-context-menu-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuSubContent.displayName = ContextMenuPrimitive.SubContent.displayName\n\nconst ContextMenuContent = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.Portal>\n    <ContextMenuPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"z-50 max-h-[--radix-context-menu-content-available-height] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md animate-in fade-in-80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-context-menu-content-transform-origin]\",\n        className\n      )}\n      {...props}\n    />\n  </ContextMenuPrimitive.Portal>\n))\nContextMenuContent.displayName = ContextMenuPrimitive.Content.displayName\n\nconst ContextMenuItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <ContextMenuPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuItem.displayName = ContextMenuPrimitive.Item.displayName\n\nconst ContextMenuCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <ContextMenuPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <ContextMenuPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </ContextMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </ContextMenuPrimitive.CheckboxItem>\n))\nContextMenuCheckboxItem.displayName =\n  ContextMenuPrimitive.CheckboxItem.displayName\n\nconst ContextMenuRadioItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <ContextMenuPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <ContextMenuPrimitive.ItemIndicator>\n        <Circle className=\"h-2 w-2 fill-current\" />\n      </ContextMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </ContextMenuPrimitive.RadioItem>\n))\nContextMenuRadioItem.displayName = ContextMenuPrimitive.RadioItem.displayName\n\nconst ContextMenuLabel = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <ContextMenuPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold text-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuLabel.displayName = ContextMenuPrimitive.Label.displayName\n\nconst ContextMenuSeparator = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-border\", className)}\n    {...props}\n  />\n))\nContextMenuSeparator.displayName = ContextMenuPrimitive.Separator.displayName\n\nconst ContextMenuShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nContextMenuShortcut.displayName = \"ContextMenuShortcut\"\n\nexport {\n  ContextMenu,\n  ContextMenuTrigger,\n  ContextMenuContent,\n  ContextMenuItem,\n  ContextMenuCheckboxItem,\n  ContextMenuRadioItem,\n  ContextMenuLabel,\n  ContextMenuSeparator,\n  ContextMenuShortcut,\n  ContextMenuGroup,\n  ContextMenuPortal,\n  ContextMenuSub,\n  ContextMenuSubContent,\n  ContextMenuSubTrigger,\n  ContextMenuRadioGroup,\n}\n","size_bytes":7428},"client/src/components/ui/aspect-ratio.tsx":{"content":"import * as AspectRatioPrimitive from \"@radix-ui/react-aspect-ratio\"\n\nconst AspectRatio = AspectRatioPrimitive.Root\n\nexport { AspectRatio }\n","size_bytes":140},"server/services/aiWikiService.ts":{"content":"// AI-powered knowledge base service using OpenAI integration\n// the newest OpenAI model is \"gpt-5\" which was released August 7, 2025. do not change this unless explicitly requested by the user\nimport OpenAI from \"openai\";\nimport { logger } from \"../logger\";\nimport { storage } from \"../storage\";\n\nconst openai = new OpenAI({ \n  apiKey: process.env.OPENAI_API_KEY \n});\n\nexport interface WikiEntry {\n  id: string;\n  title: string;\n  content: string;\n  category: string;\n  tags: string[];\n  lastUpdated: Date;\n  viewCount: number;\n}\n\nexport interface SearchResult {\n  entry: WikiEntry;\n  relevanceScore: number;\n  snippet: string;\n}\n\nexport class AIWikiService {\n  private knowledgeBase: WikiEntry[] = [\n    {\n      id: \"creator-onboarding\",\n      title: \"Creator Onboarding Guide\",\n      content: \"Complete guide for new creators joining DaddyFanz. This covers account setup, age verification, content guidelines, monetization options, and best practices for building a fanbase. Includes steps for identity verification, setting up payment methods with adult-friendly processors like CCBill and Segpay, content creation tips, and subscriber engagement strategies.\",\n      category: \"Getting Started\",\n      tags: [\"onboarding\", \"creators\", \"setup\", \"verification\"],\n      lastUpdated: new Date(),\n      viewCount: 0\n    },\n    {\n      id: \"payment-processing\",\n      title: \"Adult-Friendly Payment Processing\",\n      content: \"DaddyFanz uses specialized adult-industry payment processors including CCBill, Segpay, Epoch, Verotel, and Paxum. These processors understand adult content businesses and provide reliable payment processing. We never use mainstream processors like Stripe or PayPal that discriminate against adult content. Creators can set up subscriptions, one-time tips, and premium content pricing. All transactions are secure with industry-standard encryption.\",\n      category: \"Payments\",\n      tags: [\"payments\", \"ccbill\", \"segpay\", \"epoch\", \"adult-friendly\"],\n      lastUpdated: new Date(),\n      viewCount: 0\n    },\n    {\n      id: \"content-moderation\",\n      title: \"Content Moderation and Compliance\",\n      content: \"DaddyFanz maintains strict compliance with adult industry regulations including 2257 record-keeping requirements, age verification, and content filtering. Our enterprise-grade moderation system includes automated content scanning, human review processes, and forensic media signatures. Content is classified by severity levels (critical, high, medium, low) with over 15 flag types including age verification, violence, harassment, copyright, and spam detection.\",\n      category: \"Compliance\",\n      tags: [\"moderation\", \"compliance\", \"2257\", \"age-verification\"],\n      lastUpdated: new Date(),\n      viewCount: 0\n    },\n    {\n      id: \"real-time-messaging\",\n      title: \"Real-Time Messaging System\",\n      content: \"DaddyFanz features a comprehensive messaging system with WebSocket-powered real-time communication. Creators can chat directly with subscribers, send media content, and manage conversations. Features include message read receipts, typing indicators, online/offline status, and message encryption. The system supports both individual and group conversations with full multimedia support.\",\n      category: \"Features\",\n      tags: [\"messaging\", \"websocket\", \"real-time\", \"communication\"],\n      lastUpdated: new Date(),\n      viewCount: 0\n    },\n    {\n      id: \"subscription-management\",\n      title: \"Subscription and Monetization\",\n      content: \"Creators can set up monthly recurring subscriptions, offer premium content tiers, and receive tips from fans. The platform supports multiple pricing models including free content with premium upgrades, tiered subscriptions, and pay-per-view content. Revenue sharing is transparent with detailed analytics and automated payouts through adult-friendly payment processors.\",\n      category: \"Monetization\",\n      tags: [\"subscriptions\", \"monetization\", \"revenue\", \"pricing\"],\n      lastUpdated: new Date(),\n      viewCount: 0\n    },\n    {\n      id: \"multi-platform-integration\",\n      title: \"Multi-Platform Integration\",\n      content: \"DaddyFanz offers cross-platform compatibility with web dashboard, mobile apps (ClubCentral integration), and API access. Creators can manage content, respond to messages, and track analytics across all platforms. The system supports content synchronization, unified messaging, and consistent branding across all touchpoints.\",\n      category: \"Technical\",\n      tags: [\"integration\", \"mobile\", \"api\", \"cross-platform\"],\n      lastUpdated: new Date(),\n      viewCount: 0\n    },\n    {\n      id: \"privacy-security\",\n      title: \"Privacy and Security Features\",\n      content: \"DaddyFanz prioritizes creator and subscriber privacy with advanced security features including end-to-end message encryption, secure file storage with DRM protection, content watermarking, screenshot prevention, and comprehensive audit logging. All data is stored in compliance with GDPR and CCPA regulations with regular security audits and penetration testing.\",\n      category: \"Security\",\n      tags: [\"privacy\", \"security\", \"encryption\", \"protection\"],\n      lastUpdated: new Date(),\n      viewCount: 0\n    }\n  ];\n\n  async searchKnowledge(query: string, userId: string): Promise<SearchResult[]> {\n    try {\n      logger.info(`AI knowledge search initiated for query: ${query} by user: ${userId}`);\n\n      // Use AI to understand the query intent and generate relevant search terms\n      const searchResponse = await openai.chat.completions.create({\n        model: \"gpt-5\",\n        messages: [\n          {\n            role: \"system\",\n            content: \"You are a search assistant for DaddyFanz, an adult content creator platform. Analyze the user's query and extract key search terms and intent. Focus on creator-related topics like payments, content creation, subscriptions, verification, messaging, and platform features. Respond in JSON format with search terms and category suggestions.\"\n          },\n          {\n            role: \"user\",\n            content: `Search query: \"${query}\". Provide relevant search terms and categories for an adult content creator platform knowledge base.`\n          }\n        ],\n        response_format: { type: \"json_object\" }\n      });\n\n      const searchAnalysis = JSON.parse(searchResponse.choices[0].message.content || \"{}\");\n      \n      // Search through knowledge base entries\n      const results: SearchResult[] = [];\n      \n      for (const entry of this.knowledgeBase) {\n        let relevanceScore = 0;\n        \n        // Check title relevance\n        if (entry.title.toLowerCase().includes(query.toLowerCase())) {\n          relevanceScore += 30;\n        }\n        \n        // Check content relevance\n        if (entry.content.toLowerCase().includes(query.toLowerCase())) {\n          relevanceScore += 20;\n        }\n        \n        // Check tags relevance\n        for (const tag of entry.tags) {\n          if (tag.toLowerCase().includes(query.toLowerCase())) {\n            relevanceScore += 15;\n          }\n        }\n        \n        // Check category relevance\n        if (entry.category.toLowerCase().includes(query.toLowerCase())) {\n          relevanceScore += 25;\n        }\n\n        if (relevanceScore > 0) {\n          // Generate AI-powered snippet\n          const snippetResponse = await openai.chat.completions.create({\n            model: \"gpt-5\",\n            messages: [\n              {\n                role: \"system\",\n                content: \"Generate a concise, relevant snippet from the following content that best answers the user's query. Keep it under 150 characters and focus on the most relevant information.\"\n              },\n              {\n                role: \"user\",\n                content: `Query: \"${query}\"\\nContent: \"${entry.content}\"\\n\\nGenerate a relevant snippet:`\n              }\n            ]\n          });\n\n          const snippet = snippetResponse.choices[0].message.content || entry.content.substring(0, 150);\n\n          results.push({\n            entry,\n            relevanceScore,\n            snippet\n          });\n        }\n      }\n\n      // Sort by relevance score\n      results.sort((a, b) => b.relevanceScore - a.relevanceScore);\n\n      // Update view counts\n      for (const result of results.slice(0, 5)) {\n        result.entry.viewCount++;\n      }\n\n      logger.info(`AI knowledge search completed for query: ${query} by user: ${userId}, found ${results.length} results`);\n\n      return results.slice(0, 10); // Return top 10 results\n    } catch (error) {\n      logger.error(`AI knowledge search failed for query: ${query} by user: ${userId}: ${error instanceof Error ? error.message : String(error)}`);\n      return [];\n    }\n  }\n\n  async generateAnswer(question: string, userId: string): Promise<string> {\n    try {\n      logger.info(`AI answer generation initiated for question: ${question} by user: ${userId}`);\n\n      // First, search for relevant knowledge\n      const searchResults = await this.searchKnowledge(question, userId);\n      const context = searchResults\n        .slice(0, 3)\n        .map(result => `${result.entry.title}: ${result.entry.content}`)\n        .join('\\n\\n');\n\n      // Generate comprehensive answer using AI\n      const answerResponse = await openai.chat.completions.create({\n        model: \"gpt-5\",\n        messages: [\n          {\n            role: \"system\",\n            content: \"You are DaddyFanz AI Assistant, a helpful support bot for an adult content creator platform. Provide accurate, helpful, and professional answers based on the knowledge base context. Be supportive and understanding of creators' needs. Always maintain a professional tone while being informative about adult industry practices. If you don't have enough information, suggest contacting support.\"\n          },\n          {\n            role: \"user\",\n            content: `Question: \"${question}\"\\n\\nRelevant knowledge base context:\\n${context}\\n\\nProvide a comprehensive, helpful answer:`\n          }\n        ]\n      });\n\n      const answer = answerResponse.choices[0].message.content || \"I don't have enough information to answer that question. Please contact our support team for assistance.\";\n\n      logger.info(`AI answer generation completed for question: ${question} by user: ${userId}, answer length: ${answer.length}`);\n\n      return answer;\n    } catch (error) {\n      logger.error(`AI answer generation failed for question: ${question} by user: ${userId}: ${error instanceof Error ? error.message : String(error)}`);\n      return \"I'm having trouble processing your question right now. Please try again later or contact our support team.\";\n    }\n  }\n\n  async getPopularArticles(limit: number = 10): Promise<WikiEntry[]> {\n    return this.knowledgeBase\n      .sort((a, b) => b.viewCount - a.viewCount)\n      .slice(0, limit);\n  }\n\n  async getArticlesByCategory(category: string): Promise<WikiEntry[]> {\n    return this.knowledgeBase.filter(entry => \n      entry.category.toLowerCase() === category.toLowerCase()\n    );\n  }\n\n  async getAllCategories(): Promise<string[]> {\n    const categories = [...new Set(this.knowledgeBase.map(entry => entry.category))];\n    return categories.sort();\n  }\n\n  async getArticleById(id: string): Promise<WikiEntry | null> {\n    const entry = this.knowledgeBase.find(article => article.id === id);\n    if (entry) {\n      entry.viewCount++;\n    }\n    return entry || null;\n  }\n\n  async suggestRelatedArticles(currentArticleId: string): Promise<WikiEntry[]> {\n    const currentArticle = await this.getArticleById(currentArticleId);\n    if (!currentArticle) return [];\n\n    try {\n      // Use AI to find related articles\n      const relatedResponse = await openai.chat.completions.create({\n        model: \"gpt-5\",\n        messages: [\n          {\n            role: \"system\",\n            content: \"You are helping find related articles in a knowledge base. Based on the current article's content and tags, suggest which other articles would be most relevant. Respond with JSON containing article IDs in order of relevance.\"\n          },\n          {\n            role: \"user\",\n            content: `Current article: \"${currentArticle.title}\" with tags: ${currentArticle.tags.join(', ')} and category: ${currentArticle.category}. \n            \n            Available articles: ${this.knowledgeBase.map(a => `${a.id}: ${a.title} (${a.category})`).join(', ')}\n            \n            Suggest the most related article IDs:`\n          }\n        ],\n        response_format: { type: \"json_object\" }\n      });\n\n      const suggestions = JSON.parse(relatedResponse.choices[0].message.content || \"{}\");\n      const relatedIds = suggestions.relatedArticles || [];\n\n      return this.knowledgeBase\n        .filter(entry => relatedIds.includes(entry.id) && entry.id !== currentArticleId)\n        .slice(0, 5);\n    } catch (error) {\n      logger.error(`Failed to generate related articles for ${currentArticleId}: ${error instanceof Error ? error.message : String(error)}`);\n      \n      // Fallback to tag-based matching\n      return this.knowledgeBase\n        .filter(entry => \n          entry.id !== currentArticleId && \n          (entry.category === currentArticle.category || \n           entry.tags.some(tag => currentArticle.tags.includes(tag)))\n        )\n        .slice(0, 5);\n    }\n  }\n}\n\nexport const aiWikiService = new AIWikiService();","size_bytes":13389},"client/src/components/moderation/ModerationQueue.tsx":{"content":"import { useAuth } from \"@/hooks/useAuth\";\nimport { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { useState } from \"react\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { isUnauthorizedError } from \"@/lib/authUtils\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { ScrollArea } from \"@/components/ui/scroll-area\";\nimport { \n  Dialog,\n  DialogContent,\n  DialogHeader,\n  DialogTitle,\n  DialogTrigger,\n} from \"@/components/ui/dialog\";\nimport { \n  Check, \n  X, \n  Eye, \n  Filter, \n  AlertTriangle,\n  Clock,\n  User,\n  Calendar,\n  FileText,\n  Settings,\n  BarChart3,\n  Shield,\n  Zap,\n  Search,\n  SortAsc,\n  Download,\n  TrendingUp,\n  TrendingDown,\n  Minus\n} from \"lucide-react\";\n\ninterface ModerationItem {\n  id: string;\n  mediaId: string;\n  status: \"pending\" | \"approved\" | \"rejected\";\n  reviewerId?: string;\n  notes?: string;\n  priority: number;\n  autoFlags?: any[];\n  createdAt: string;\n  updatedAt: string;\n  media?: {\n    id: string;\n    title: string;\n    mimeType: string;\n    ownerId: string;\n    s3Key: string;\n  };\n}\n\nexport default function ModerationQueue() {\n  const { user } = useAuth();\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n  \n  const [selectedItem, setSelectedItem] = useState<ModerationItem | null>(null);\n  const [reviewNotes, setReviewNotes] = useState(\"\");\n  const [filter, setFilter] = useState<\"all\" | \"pending\" | \"approved\" | \"rejected\">(\"pending\");\n  const [severityFilter, setSeverityFilter] = useState<\"all\" | \"low\" | \"medium\" | \"high\" | \"critical\">(\"all\");\n  const [flagTypeFilter, setFlagTypeFilter] = useState<string>(\"all\");\n  const [sortBy, setSortBy] = useState<\"priority\" | \"created\" | \"confidence\">(\"priority\");\n  const [searchQuery, setSearchQuery] = useState(\"\");\n  const [showStats, setShowStats] = useState(false);\n  const [showConfig, setShowConfig] = useState(false);\n\n  const { data: moderationQueue, isLoading } = useQuery({\n    queryKey: [\"/api/moderation/queue\"],\n    retry: false,\n    enabled: user?.role === \"admin\",\n  });\n\n  const { data: moderationStats } = useQuery({\n    queryKey: [\"/api/moderation/stats\"],\n    retry: false,\n    enabled: user?.role === \"admin\",\n  });\n\n  const reviewMutation = useMutation({\n    mutationFn: async ({ id, decision, notes }: { id: string; decision: \"approve\" | \"reject\"; notes: string }) => {\n      const response = await apiRequest(\"PUT\", `/api/moderation/${id}`, { decision, notes });\n      return response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/moderation/queue\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/moderation/stats\"] });\n      toast({\n        title: \"Review Completed\",\n        description: \"The content has been reviewed successfully.\",\n      });\n      setSelectedItem(null);\n      setReviewNotes(\"\");\n    },\n    onError: (error) => {\n      if (isUnauthorizedError(error as Error)) {\n        toast({\n          title: \"Unauthorized\",\n          description: \"You are logged out. Logging in again...\",\n          variant: \"destructive\",\n        });\n        setTimeout(() => {\n          window.location.href = \"/api/login\";\n        }, 500);\n        return;\n      }\n      toast({\n        title: \"Review Failed\",\n        description: \"Failed to submit review. Please try again.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const handleReview = (decision: \"approve\" | \"reject\") => {\n    if (!selectedItem) return;\n    \n    reviewMutation.mutate({\n      id: selectedItem.id,\n      decision,\n      notes: reviewNotes,\n    });\n  };\n\n  // Filter and sort moderation items\n  const filteredItems = moderationQueue?.filter((item: ModerationItem) => {\n    if (filter !== \"all\" && item.status !== filter) return false;\n    \n    // Severity filter\n    if (severityFilter !== \"all\" && item.autoFlags) {\n      const hasMatchingSeverity = item.autoFlags.some((flag: any) => flag.severity === severityFilter);\n      if (!hasMatchingSeverity) return false;\n    }\n    \n    // Flag type filter\n    if (flagTypeFilter !== \"all\" && item.autoFlags) {\n      const hasMatchingFlag = item.autoFlags.some((flag: any) => flag.type === flagTypeFilter);\n      if (!hasMatchingFlag) return false;\n    }\n    \n    // Search filter\n    if (searchQuery) {\n      const query = searchQuery.toLowerCase();\n      const matchesSearch = \n        item.media?.title?.toLowerCase().includes(query) ||\n        item.notes?.toLowerCase().includes(query) ||\n        item.autoFlags?.some((flag: any) => flag.details?.toLowerCase().includes(query));\n      if (!matchesSearch) return false;\n    }\n    \n    return true;\n  })?.sort((a: ModerationItem, b: ModerationItem) => {\n    switch (sortBy) {\n      case \"priority\":\n        return (b.priority || 0) - (a.priority || 0);\n      case \"created\":\n        return new Date(b.createdAt).getTime() - new Date(a.createdAt).getTime();\n      case \"confidence\":\n        const aConfidence = a.autoFlags?.[0]?.confidence || 0;\n        const bConfidence = b.autoFlags?.[0]?.confidence || 0;\n        return bConfidence - aConfidence;\n      default:\n        return 0;\n    }\n  }) || [];\n\n  const flagTypes = Array.from(\n    new Set(\n      moderationQueue?.flatMap((item: ModerationItem) => \n        item.autoFlags?.map((flag: any) => flag.type) || []\n      ) || []\n    )\n  );\n\n  const getStatusBadge = (status: string) => {\n    switch (status) {\n      case \"pending\":\n        return <Badge className=\"bg-yellow-500 text-black\">Pending</Badge>;\n      case \"approved\":\n        return <Badge className=\"bg-green-600 text-white\">Approved</Badge>;\n      case \"rejected\":\n        return <Badge className=\"bg-red-600 text-white\">Rejected</Badge>;\n      default:\n        return <Badge variant=\"secondary\">{status}</Badge>;\n    }\n  };\n\n  const getPriorityColor = (priority: number) => {\n    if (priority >= 20) return \"text-red-400\";\n    if (priority >= 15) return \"text-orange-400\";\n    if (priority >= 10) return \"text-yellow-400\";\n    if (priority >= 5) return \"text-blue-400\";\n    return \"text-df-fog\";\n  };\n\n  const getPriorityIcon = (priority: number) => {\n    if (priority >= 15) return <TrendingUp className=\"h-3 w-3\" />;\n    if (priority >= 10) return <AlertTriangle className=\"h-3 w-3\" />;\n    if (priority >= 5) return <Minus className=\"h-3 w-3\" />;\n    return <TrendingDown className=\"h-3 w-3\" />;\n  };\n\n  const getContentTypeIcon = (mimeType?: string) => {\n    if (!mimeType) return <FileText className=\"h-4 w-4\" />;\n    \n    if (mimeType.startsWith(\"image/\")) {\n      return <div className=\"w-4 h-4 bg-df-cyan rounded text-xs flex items-center justify-center text-white\">IMG</div>;\n    } else if (mimeType.startsWith(\"video/\")) {\n      return <div className=\"w-4 h-4 bg-df-gold rounded text-xs flex items-center justify-center text-black\">VID</div>;\n    }\n    return <FileText className=\"h-4 w-4\" />;\n  };\n\n  const getSeverityColor = (severity: string) => {\n    switch (severity) {\n      case \"critical\": return \"bg-red-600 text-white\";\n      case \"high\": return \"bg-orange-500 text-white\";\n      case \"medium\": return \"bg-yellow-500 text-black\";\n      case \"low\": return \"bg-blue-500 text-white\";\n      default: return \"bg-gray-500 text-white\";\n    }\n  };\n\n  if (user?.role !== \"admin\") {\n    return (\n      <Card className=\"card-df\">\n        <CardHeader>\n          <CardTitle className=\"text-df-cyan\">Access Denied</CardTitle>\n        </CardHeader>\n        <CardContent>\n          <p className=\"text-df-fog\">You must be an administrator to access the moderation queue.</p>\n        </CardContent>\n      </Card>\n    );\n  }\n\n  return (\n    <Card className=\"card-df mb-8\">\n      <CardHeader>\n        <div className=\"flex items-center justify-between\">\n          <CardTitle className=\"neon-heading flex items-center gap-3\">\n            <Shield className=\"h-6 w-6\" />\n            Content Moderation Queue\n            <Badge variant=\"outline\" className=\"ml-2 text-df-cyan border-df-cyan\">\n              {filteredItems.length} items\n            </Badge>\n          </CardTitle>\n          <div className=\"flex items-center gap-2\">\n            <Button\n              variant=\"outline\"\n              size=\"sm\"\n              onClick={() => setShowStats(!showStats)}\n              data-testid=\"button-toggle-stats\"\n            >\n              <BarChart3 className=\"h-4 w-4 mr-1\" />\n              Stats\n            </Button>\n            <Button\n              variant=\"outline\"\n              size=\"sm\"\n              onClick={() => setShowConfig(!showConfig)}\n              data-testid=\"button-toggle-config\"\n            >\n              <Settings className=\"h-4 w-4 mr-1\" />\n              Config\n            </Button>\n          </div>\n        </div>\n      </CardHeader>\n      \n      <CardContent>\n        {/* Enhanced Filtering Controls */}\n        <div className=\"space-y-4 mb-6\">\n          {/* Search and Primary Filters */}\n          <div className=\"flex flex-wrap gap-4\">\n            <div className=\"flex items-center gap-2 flex-1 min-w-[200px]\">\n              <Search className=\"h-4 w-4 text-df-cyan\" />\n              <input\n                type=\"text\"\n                placeholder=\"Search content, notes, flags...\"\n                value={searchQuery}\n                onChange={(e) => setSearchQuery(e.target.value)}\n                className=\"input-df text-sm flex-1\"\n                data-testid=\"input-search\"\n              />\n            </div>\n            <div className=\"flex items-center gap-2\">\n              <SortAsc className=\"h-4 w-4 text-df-cyan\" />\n              <select \n                value={sortBy} \n                onChange={(e) => setSortBy(e.target.value as any)}\n                className=\"input-df text-sm\"\n                data-testid=\"select-sort\"\n              >\n                <option value=\"priority\">Sort by Priority</option>\n                <option value=\"created\">Sort by Date</option>\n                <option value=\"confidence\">Sort by Confidence</option>\n              </select>\n            </div>\n          </div>\n\n          {/* Advanced Filters */}\n          <div className=\"flex flex-wrap gap-4\">\n            <div className=\"flex items-center gap-2\">\n              <Filter className=\"h-4 w-4 text-df-cyan\" />\n              <select \n                value={filter} \n                onChange={(e) => setFilter(e.target.value as any)}\n                className=\"input-df text-sm\"\n                data-testid=\"select-status\"\n              >\n                <option value=\"all\">All Status</option>\n                <option value=\"pending\">Pending Review</option>\n                <option value=\"approved\">Approved</option>\n                <option value=\"rejected\">Rejected</option>\n              </select>\n            </div>\n            \n            <div className=\"flex items-center gap-2\">\n              <AlertTriangle className=\"h-4 w-4 text-df-gold\" />\n              <select \n                value={severityFilter} \n                onChange={(e) => setSeverityFilter(e.target.value as any)}\n                className=\"input-df text-sm\"\n                data-testid=\"select-severity\"\n              >\n                <option value=\"all\">All Severity</option>\n                <option value=\"critical\">Critical</option>\n                <option value=\"high\">High</option>\n                <option value=\"medium\">Medium</option>\n                <option value=\"low\">Low</option>\n              </select>\n            </div>\n            \n            <div className=\"flex items-center gap-2\">\n              <Zap className=\"h-4 w-4 text-df-cyan\" />\n              <select \n                value={flagTypeFilter} \n                onChange={(e) => setFlagTypeFilter(e.target.value)}\n                className=\"input-df text-sm\"\n                data-testid=\"select-flag-type\"\n              >\n                <option value=\"all\">All Flag Types</option>\n                {flagTypes.map(type => (\n                  <option key={type} value={type}>\n                    {type?.replace('_', ' ').toUpperCase()}\n                  </option>\n                ))}\n              </select>\n            </div>\n          </div>\n        </div>\n\n        {/* Statistics Panel */}\n        {showStats && moderationStats && (\n          <div className=\"mb-6 p-4 bg-df-brick/50 rounded-lg border border-df-steel\">\n            <h3 className=\"text-df-gold font-semibold mb-3 flex items-center gap-2\">\n              <BarChart3 className=\"h-4 w-4\" />\n              Moderation Statistics\n            </h3>\n            <div className=\"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm\">\n              <div>\n                <div className=\"text-df-fog\">Total Queued</div>\n                <div className=\"text-df-cyan font-semibold text-lg\">{moderationStats.totalQueued}</div>\n              </div>\n              <div>\n                <div className=\"text-df-fog\">Pending Review</div>\n                <div className=\"text-df-gold font-semibold text-lg\">{moderationStats.pendingReview}</div>\n              </div>\n              <div>\n                <div className=\"text-df-fog\">Auto Approved</div>\n                <div className=\"text-green-400 font-semibold text-lg\">{moderationStats.autoApproved}</div>\n              </div>\n              <div>\n                <div className=\"text-df-fog\">Auto Rejected</div>\n                <div className=\"text-red-400 font-semibold text-lg\">{moderationStats.autoRejected}</div>\n              </div>\n            </div>\n            \n            {/* Flag Breakdown */}\n            {moderationStats.flagBreakdown && Object.keys(moderationStats.flagBreakdown).length > 0 && (\n              <div className=\"mt-4\">\n                <h4 className=\"text-df-cyan font-medium mb-2\">Flag Types Breakdown</h4>\n                <div className=\"flex flex-wrap gap-2\">\n                  {Object.entries(moderationStats.flagBreakdown).map(([flag, count]) => (\n                    <Badge key={flag} variant=\"outline\" className=\"text-xs\">\n                      {flag?.replace('_', ' ')}: {count as number}\n                    </Badge>\n                  ))}\n                </div>\n              </div>\n            )}\n          </div>\n        )}\n\n        {/* Content List */}\n        {isLoading ? (\n          <div className=\"text-center py-8\">\n            <div className=\"text-df-fog\">Loading moderation queue...</div>\n          </div>\n        ) : filteredItems.length > 0 ? (\n          <ScrollArea className=\"h-[500px]\">\n            <div className=\"space-y-4\">\n              {filteredItems.map((item: ModerationItem) => (\n                <div \n                  key={item.id}\n                  className=\"bg-df-ink border border-df-steel rounded-md p-4 hover:border-df-cyan/50 transition-colors\"\n                  data-testid={`moderation-item-${item.id}`}\n                >\n                  <div className=\"flex items-start gap-4\">\n                    {/* Content Icon */}\n                    <div className=\"flex-shrink-0 mt-1\">\n                      {getContentTypeIcon(item.media?.mimeType)}\n                    </div>\n                    \n                    {/* Content Info */}\n                    <div className=\"flex-1 min-w-0\">\n                      <div className=\"flex items-center gap-2 mb-2 flex-wrap\">\n                        <h4 className=\"text-df-snow font-medium truncate\">\n                          {item.media?.title || `Content #${item.mediaId.slice(-8)}`}\n                        </h4>\n                        {getStatusBadge(item.status)}\n                        {item.priority > 0 && (\n                          <div className={`flex items-center gap-1 ${getPriorityColor(item.priority)}`}>\n                            {getPriorityIcon(item.priority)}\n                            <span className=\"text-xs font-medium\">P{item.priority}</span>\n                          </div>\n                        )}\n                      </div>\n                      \n                      <div className=\"flex items-center gap-4 text-df-fog text-sm mb-3\">\n                        <div className=\"flex items-center gap-1\">\n                          <User className=\"h-3 w-3\" />\n                          <span>Creator: {item.media?.ownerId?.slice(-8)}</span>\n                        </div>\n                        <div className=\"flex items-center gap-1\">\n                          <Clock className=\"h-3 w-3\" />\n                          <span>{new Date(item.createdAt).toLocaleDateString()}</span>\n                        </div>\n                        <div className=\"flex items-center gap-1\">\n                          <FileText className=\"h-3 w-3\" />\n                          <span>{item.media?.mimeType?.split('/')[0] || 'file'}</span>\n                        </div>\n                      </div>\n\n                      {/* Enhanced Auto Flags Display */}\n                      {item.autoFlags && item.autoFlags.length > 0 && (\n                        <div className=\"flex flex-wrap gap-1 mb-3\">\n                          {item.autoFlags.map((flag: any, index: number) => (\n                            <Badge \n                              key={index} \n                              className={`text-xs ${getSeverityColor(flag.severity)}`}\n                              title={flag.details}\n                            >\n                              {flag.type?.replace('_', ' ').toUpperCase()}: {Math.round(flag.confidence * 100)}%\n                              {flag.severity && (\n                                <span className=\"ml-1 text-xs opacity-75\">\n                                  [{flag.severity.toUpperCase()}]\n                                </span>\n                              )}\n                            </Badge>\n                          ))}\n                        </div>\n                      )}\n\n                      {/* Review Notes */}\n                      {item.notes && (\n                        <div className=\"text-sm text-df-fog bg-df-brick/30 p-2 rounded\">\n                          <span className=\"font-medium\">Review Notes: </span>\n                          {item.notes}\n                        </div>\n                      )}\n                    </div>\n                    \n                    {/* Actions */}\n                    <div className=\"flex items-center gap-2 flex-shrink-0\">\n                      {item.status === \"pending\" && (\n                        <>\n                          <Button\n                            onClick={() => {\n                              setSelectedItem(item);\n                              setReviewNotes(\"\");\n                            }}\n                            size=\"sm\"\n                            className=\"bg-green-600 hover:bg-green-700 text-white\"\n                            data-testid={`button-approve-${item.id}`}\n                          >\n                            <Check className=\"h-4 w-4 mr-1\" />\n                            Approve\n                          </Button>\n                          <Button\n                            onClick={() => {\n                              setSelectedItem(item);\n                              setReviewNotes(\"\");\n                            }}\n                            size=\"sm\"\n                            className=\"bg-red-600 hover:bg-red-700 text-white\"\n                            data-testid={`button-reject-${item.id}`}\n                          >\n                            <X className=\"h-4 w-4 mr-1\" />\n                            Reject\n                          </Button>\n                        </>\n                      )}\n                      \n                      <Dialog>\n                        <DialogTrigger asChild>\n                          <Button\n                            size=\"sm\"\n                            className=\"btn-outline\"\n                            data-testid={`button-review-${item.id}`}\n                          >\n                            <Eye className=\"h-4 w-4 mr-1\" />\n                            Review\n                          </Button>\n                        </DialogTrigger>\n                        <DialogContent className=\"bg-df-brick border border-df-steel max-w-4xl max-h-[90vh] overflow-y-auto\">\n                          <DialogHeader>\n                            <DialogTitle className=\"text-df-cyan\">\n                              Content Review - {item.media?.title || \"Untitled\"}\n                            </DialogTitle>\n                          </DialogHeader>\n                          <div className=\"space-y-6\">\n                            {/* Content Preview Placeholder */}\n                            <div className=\"bg-df-ink border border-df-steel rounded-md p-8 text-center\">\n                              {getContentTypeIcon(item.media?.mimeType)}\n                              <p className=\"text-df-fog text-sm mt-2\">Content preview would appear here</p>\n                              <p className=\"text-df-fog text-xs\">File: {item.media?.s3Key}</p>\n                            </div>\n                            \n                            {/* Content Details */}\n                            <div className=\"grid grid-cols-2 gap-4 text-sm\">\n                              <div>\n                                <span className=\"text-df-fog\">Status:</span>\n                                <span className=\"ml-2\">{getStatusBadge(item.status)}</span>\n                              </div>\n                              <div>\n                                <span className=\"text-df-fog\">Priority:</span>\n                                <span className={`ml-2 flex items-center gap-1 ${getPriorityColor(item.priority)}`}>\n                                  {getPriorityIcon(item.priority)}\n                                  {item.priority}\n                                </span>\n                              </div>\n                              <div>\n                                <span className=\"text-df-fog\">Submitted:</span>\n                                <span className=\"ml-2 text-df-snow\">{new Date(item.createdAt).toLocaleString()}</span>\n                              </div>\n                              <div>\n                                <span className=\"text-df-fog\">Type:</span>\n                                <span className=\"ml-2 text-df-snow\">{item.media?.mimeType}</span>\n                              </div>\n                            </div>\n\n                            {/* Detailed Auto Flags */}\n                            {item.autoFlags && item.autoFlags.length > 0 && (\n                              <div className=\"bg-yellow-900/20 border border-yellow-600 rounded-md p-4\">\n                                <div className=\"flex items-center gap-2 mb-3\">\n                                  <AlertTriangle className=\"h-4 w-4 text-yellow-500\" />\n                                  <span className=\"text-yellow-200 font-semibold\">Auto-detected Issues</span>\n                                </div>\n                                <div className=\"space-y-3\">\n                                  {item.autoFlags.map((flag: any, index: number) => (\n                                    <div key={index} className=\"bg-yellow-900/30 rounded p-3\">\n                                      <div className=\"flex items-center justify-between mb-2\">\n                                        <div className=\"flex items-center gap-2\">\n                                          <Badge className={getSeverityColor(flag.severity)}>\n                                            {flag.type?.replace('_', ' ').toUpperCase()}\n                                          </Badge>\n                                          <span className=\"text-yellow-100 font-medium\">\n                                            {Math.round(flag.confidence * 100)}% confidence\n                                          </span>\n                                        </div>\n                                        <Badge variant=\"outline\" className=\"text-yellow-200\">\n                                          {flag.severity?.toUpperCase()} SEVERITY\n                                        </Badge>\n                                      </div>\n                                      {flag.details && (\n                                        <p className=\"text-yellow-100 text-sm\">{flag.details}</p>\n                                      )}\n                                    </div>\n                                  ))}\n                                </div>\n                              </div>\n                            )}\n\n                            {/* Review Notes */}\n                            <div>\n                              <label className=\"text-df-fog text-sm font-medium\">Review Notes</label>\n                              <Textarea\n                                value={reviewNotes}\n                                onChange={(e) => setReviewNotes(e.target.value)}\n                                placeholder=\"Add detailed notes about your review decision...\"\n                                className=\"input-df mt-2\"\n                                rows={4}\n                                data-testid=\"textarea-review-notes\"\n                              />\n                            </div>\n\n                            {/* Action Buttons */}\n                            {item.status === \"pending\" && (\n                              <div className=\"flex gap-3\">\n                                <Button\n                                  onClick={() => handleReview(\"approve\")}\n                                  disabled={reviewMutation.isPending}\n                                  className=\"flex-1 bg-green-600 hover:bg-green-700 text-white\"\n                                  data-testid=\"button-approve-final\"\n                                >\n                                  <Check className=\"h-4 w-4 mr-2\" />\n                                  {reviewMutation.isPending ? \"Processing...\" : \"Approve Content\"}\n                                </Button>\n                                <Button\n                                  onClick={() => handleReview(\"reject\")}\n                                  disabled={reviewMutation.isPending}\n                                  className=\"flex-1 bg-red-600 hover:bg-red-700 text-white\"\n                                  data-testid=\"button-reject-final\"\n                                >\n                                  <X className=\"h-4 w-4 mr-2\" />\n                                  {reviewMutation.isPending ? \"Processing...\" : \"Reject Content\"}\n                                </Button>\n                              </div>\n                            )}\n                          </div>\n                        </DialogContent>\n                      </Dialog>\n                    </div>\n                  </div>\n                </div>\n              ))}\n            </div>\n          </ScrollArea>\n        ) : (\n          <div className=\"text-center py-12\">\n            <Shield className=\"h-16 w-16 text-df-fog mx-auto mb-4\" />\n            <h3 className=\"text-df-cyan text-lg font-semibold mb-2\">\n              {filter === \"pending\" ? \"No Pending Reviews\" : `No ${filter} Items`}\n            </h3>\n            <p className=\"text-df-fog\">\n              {filter === \"pending\" \n                ? \"All content has been reviewed. Great work keeping the platform safe!\"\n                : `No ${filter} items match your current filters.`\n              }\n            </p>\n          </div>\n        )}\n      </CardContent>\n    </Card>\n  );\n}","size_bytes":27575},"client/src/pages/Dashboard.tsx":{"content":"import { useAuth, Profile, MediaAsset, PayoutAccount } from \"@/hooks/useAuth\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport Header from \"@/components/layout/Header\";\nimport Footer from \"@/components/layout/Footer\";\nimport StatsCards from \"@/components/dashboard/StatsCards\";\nimport ModerationQueue from \"@/components/moderation/ModerationQueue\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { useEffect } from \"react\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { isUnauthorizedError } from \"@/lib/authUtils\";\nimport { Plus, TrendingUp, Users, DollarSign } from \"lucide-react\";\n\nexport default function Dashboard() {\n  const { user, isLoading, isAuthenticated } = useAuth();\n  const { toast } = useToast();\n\n  // Redirect to home if not authenticated\n  useEffect(() => {\n    if (!isLoading && !isAuthenticated) {\n      toast({\n        title: \"Unauthorized\",\n        description: \"You are logged out. Logging in again...\",\n        variant: \"destructive\",\n      });\n      setTimeout(() => {\n        window.location.href = \"/api/login\";\n      }, 500);\n      return;\n    }\n  }, [isAuthenticated, isLoading, toast]);\n\n  const { data: profile, isLoading: profileLoading } = useQuery({\n    queryKey: [\"/api/profile\"],\n    retry: false,\n    enabled: isAuthenticated,\n  });\n\n  const { data: mediaAssets, isLoading: mediaLoading } = useQuery({\n    queryKey: [\"/api/media\"],\n    retry: false,\n    enabled: isAuthenticated,\n  });\n\n  const { data: payoutAccounts } = useQuery({\n    queryKey: [\"/api/payments/accounts\"],\n    retry: false,\n    enabled: isAuthenticated && user?.role === \"creator\",\n  });\n\n  if (isLoading || profileLoading) {\n    return (\n      <div className=\"min-h-screen bg-df-dungeon flex items-center justify-center\">\n        <div className=\"text-xl neon-heading\">Loading dashboard...</div>\n      </div>\n    );\n  }\n\n  if (!isAuthenticated || !user) {\n    return null; // Will redirect via useEffect\n  }\n\n  const isCreator = user.role === \"creator\" || user.role === \"admin\";\n  const isAdmin = user.role === \"admin\";\n\n  return (\n    <div className=\"min-h-screen bg-df-dungeon\">\n      <Header />\n      \n      <main className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8\">\n        {/* Welcome Section */}\n        <div className=\"mb-8\">\n          <h1 className=\"text-3xl font-display font-bold text-df-snow mb-2\">\n            Welcome back, <span className=\"neon-heading\">{profile?.displayName || user.email}</span>\n          </h1>\n          <p className=\"text-df-fog\">\n            {isCreator ? \"Manage your content and earnings\" : \"Discover amazing creators\"}\n          </p>\n        </div>\n\n        {/* Stats Cards */}\n        <StatsCards \n          userRole={user.role} \n          mediaAssets={mediaAssets || []}\n          payoutAccounts={payoutAccounts || []}\n        />\n\n        {/* Main Content Grid */}\n        <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-8 mb-8\">\n          {/* Content Management */}\n          {isCreator && (\n            <div className=\"lg:col-span-2\">\n              <Card className=\"card-df\">\n                <CardHeader>\n                  <div className=\"flex items-center justify-between\">\n                    <CardTitle className=\"text-xl neon-subheading\">\n                      Content Management\n                    </CardTitle>\n                    <Button className=\"btn-primary\" data-testid=\"button-upload-content\">\n                      <Plus className=\"mr-2 h-4 w-4\" />\n                      Upload Content\n                    </Button>\n                  </div>\n                </CardHeader>\n                <CardContent>\n                  {mediaLoading ? (\n                    <div className=\"text-center py-8\">\n                      <div className=\"text-df-fog\">Loading content...</div>\n                    </div>\n                  ) : mediaAssets && mediaAssets.length > 0 ? (\n                    <div className=\"grid grid-cols-2 md:grid-cols-3 gap-4\">\n                      {mediaAssets.slice(0, 6).map((asset: any) => (\n                        <div key={asset.id} className=\"relative group\">\n                          <div className=\"aspect-video bg-df-ink border border-df-steel rounded-md flex items-center justify-center\">\n                            <span className=\"text-df-fog text-sm\">{asset.mimeType?.split('/')[0] || 'file'}</span>\n                          </div>\n                          <div className=\"mt-2\">\n                            <p className=\"text-df-snow text-sm font-medium truncate\">\n                              {asset.title || 'Untitled'}\n                            </p>\n                            <p className=\"text-df-fog text-xs\">\n                              {asset.status === 'approved' ? '✅' : asset.status === 'rejected' ? '❌' : '⏳'} {asset.status}\n                            </p>\n                          </div>\n                        </div>\n                      ))}\n                    </div>\n                  ) : (\n                    <div className=\"text-center py-8\">\n                      <div className=\"text-df-fog mb-4\">No content uploaded yet</div>\n                      <Button className=\"btn-primary\" data-testid=\"button-first-upload\">\n                        <Plus className=\"mr-2 h-4 w-4\" />\n                        Upload Your First Content\n                      </Button>\n                    </div>\n                  )}\n\n                  {/* Content Statistics */}\n                  {mediaAssets && mediaAssets.length > 0 && (\n                    <div className=\"grid grid-cols-3 gap-4 mt-6 pt-6 border-t border-df-steel\">\n                      <div className=\"bg-df-ink p-4 rounded-md border border-df-steel text-center\">\n                        <p className=\"text-2xl font-bold text-df-cyan\" data-testid=\"text-total-posts\">\n                          {mediaAssets.length}\n                        </p>\n                        <p className=\"text-df-fog text-sm\">Total Posts</p>\n                      </div>\n                      <div className=\"bg-df-ink p-4 rounded-md border border-df-steel text-center\">\n                        <p className=\"text-2xl font-bold text-df-gold\" data-testid=\"text-premium-posts\">\n                          {mediaAssets.filter((asset: any) => asset.isPremium).length}\n                        </p>\n                        <p className=\"text-df-fog text-sm\">Premium</p>\n                      </div>\n                      <div className=\"bg-df-ink p-4 rounded-md border border-df-steel text-center\">\n                        <p className=\"text-2xl font-bold text-yellow-500\" data-testid=\"text-pending-posts\">\n                          {mediaAssets.filter((asset: any) => asset.status === 'uploaded').length}\n                        </p>\n                        <p className=\"text-df-fog text-sm\">Pending</p>\n                      </div>\n                    </div>\n                  )}\n                </CardContent>\n              </Card>\n            </div>\n          )}\n\n          {/* Profile Overview */}\n          <div className={isCreator ? \"lg:col-span-1\" : \"lg:col-span-2\"}>\n            <Card className=\"card-df\">\n              <CardHeader>\n                <CardTitle className=\"text-xl neon-subheading\">\n                  {isCreator ? \"Creator Profile\" : \"Profile\"}\n                </CardTitle>\n              </CardHeader>\n              <CardContent>\n                <div className=\"flex flex-col items-center mb-6\">\n                  <div className=\"w-20 h-20 bg-df-ink border-4 border-df-cyan rounded-full flex items-center justify-center shadow-glow mb-4\">\n                    <span className=\"text-df-cyan text-2xl font-bold\">\n                      {(profile?.displayName || user.email || 'U')[0].toUpperCase()}\n                    </span>\n                  </div>\n                  <h3 className=\"text-df-snow font-semibold\" data-testid=\"text-display-name\">\n                    {profile?.displayName || user.email}\n                  </h3>\n                  <p className=\"text-df-fog text-sm capitalize\">{user.role}</p>\n                </div>\n\n                {profile?.bio && (\n                  <div className=\"mb-4\">\n                    <p className=\"text-df-fog text-sm\" data-testid=\"text-bio\">{profile.bio}</p>\n                  </div>\n                )}\n\n                {/* Verification Status */}\n                <div className=\"bg-df-ink border border-df-steel rounded-md p-4\">\n                  <h4 className=\"text-df-cyan font-semibold mb-3\">Verification Status</h4>\n                  <div className=\"space-y-2\">\n                    <div className=\"flex items-center justify-between\">\n                      <span className=\"text-df-fog text-sm\">Age Verification</span>\n                      <span className=\"flex items-center text-green-400 text-sm\" data-testid=\"status-age-verification\">\n                        {profile?.ageVerified ? (\n                          <>\n                            <span className=\"w-2 h-2 bg-green-400 rounded-full mr-1\"></span>\n                            Verified\n                          </>\n                        ) : (\n                          <>\n                            <span className=\"w-2 h-2 bg-yellow-500 rounded-full mr-1\"></span>\n                            Pending\n                          </>\n                        )}\n                      </span>\n                    </div>\n                    <div className=\"flex items-center justify-between\">\n                      <span className=\"text-df-fog text-sm\">KYC Compliance</span>\n                      <span className=\"flex items-center text-green-400 text-sm\" data-testid=\"status-kyc\">\n                        {profile?.kycStatus === 'verified' ? (\n                          <>\n                            <span className=\"w-2 h-2 bg-green-400 rounded-full mr-1\"></span>\n                            Complete\n                          </>\n                        ) : (\n                          <>\n                            <span className=\"w-2 h-2 bg-yellow-500 rounded-full mr-1\"></span>\n                            {profile?.kycStatus || 'Pending'}\n                          </>\n                        )}\n                      </span>\n                    </div>\n                  </div>\n                </div>\n              </CardContent>\n            </Card>\n          </div>\n\n          {/* Fan Dashboard */}\n          {!isCreator && (\n            <div className=\"lg:col-span-1\">\n              <Card className=\"card-df\">\n                <CardHeader>\n                  <CardTitle className=\"text-xl neon-subheading\">\n                    Discover Creators\n                  </CardTitle>\n                </CardHeader>\n                <CardContent>\n                  <div className=\"text-center py-8\">\n                    <Users className=\"h-12 w-12 text-df-fog mx-auto mb-4\" />\n                    <p className=\"text-df-fog mb-4\">Find amazing creators to follow</p>\n                    <Button className=\"btn-primary\" data-testid=\"button-browse-creators\">\n                      Browse Creators\n                    </Button>\n                  </div>\n                </CardContent>\n              </Card>\n            </div>\n          )}\n        </div>\n\n        {/* Admin Moderation Queue */}\n        {isAdmin && <ModerationQueue />}\n\n        {/* System Health Monitoring */}\n        <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6\">\n          <Card className=\"card-df p-4\">\n            <div className=\"flex items-center justify-between mb-2\">\n              <h4 className=\"text-df-cyan font-semibold text-sm\">API Gateway</h4>\n              <div className=\"w-3 h-3 bg-green-400 rounded-full pulse-glow\" data-testid=\"status-api-gateway\"></div>\n            </div>\n            <p className=\"text-2xl font-bold text-df-snow\">99.9%</p>\n            <p className=\"text-df-fog text-xs\">Uptime</p>\n          </Card>\n\n          <Card className=\"card-df p-4\">\n            <div className=\"flex items-center justify-between mb-2\">\n              <h4 className=\"text-df-cyan font-semibold text-sm\">Database</h4>\n              <div className=\"w-3 h-3 bg-green-400 rounded-full pulse-glow\" data-testid=\"status-database\"></div>\n            </div>\n            <p className=\"text-2xl font-bold text-df-snow\">12ms</p>\n            <p className=\"text-df-fog text-xs\">Avg Response</p>\n          </Card>\n\n          <Card className=\"card-df p-4\">\n            <div className=\"flex items-center justify-between mb-2\">\n              <h4 className=\"text-df-cyan font-semibold text-sm\">Payments</h4>\n              <div className=\"w-3 h-3 bg-green-400 rounded-full pulse-glow\" data-testid=\"status-payments\"></div>\n            </div>\n            <p className=\"text-2xl font-bold text-df-snow\">98.7%</p>\n            <p className=\"text-df-fog text-xs\">Success Rate</p>\n          </Card>\n\n          <Card className=\"card-df p-4\">\n            <div className=\"flex items-center justify-between mb-2\">\n              <h4 className=\"text-df-cyan font-semibold text-sm\">Real-time</h4>\n              <div className=\"w-3 h-3 bg-green-400 rounded-full pulse-glow\" data-testid=\"status-websocket\"></div>\n            </div>\n            <p className=\"text-2xl font-bold text-df-snow\">1,247</p>\n            <p className=\"text-df-fog text-xs\">Active Users</p>\n          </Card>\n        </div>\n      </main>\n\n      <Footer />\n    </div>\n  );\n}\n","size_bytes":13390},"client/src/components/ui/checkbox.tsx":{"content":"import * as React from \"react\"\nimport * as CheckboxPrimitive from \"@radix-ui/react-checkbox\"\nimport { Check } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Checkbox = React.forwardRef<\n  React.ElementRef<typeof CheckboxPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof CheckboxPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <CheckboxPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground\",\n      className\n    )}\n    {...props}\n  >\n    <CheckboxPrimitive.Indicator\n      className={cn(\"flex items-center justify-center text-current\")}\n    >\n      <Check className=\"h-4 w-4\" />\n    </CheckboxPrimitive.Indicator>\n  </CheckboxPrimitive.Root>\n))\nCheckbox.displayName = CheckboxPrimitive.Root.displayName\n\nexport { Checkbox }\n","size_bytes":1056},"client/src/components/ui/tabs.tsx":{"content":"import * as React from \"react\"\nimport * as TabsPrimitive from \"@radix-ui/react-tabs\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Tabs = TabsPrimitive.Root\n\nconst TabsList = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.List\n    ref={ref}\n    className={cn(\n      \"inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsList.displayName = TabsPrimitive.List.displayName\n\nconst TabsTrigger = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.Trigger>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsTrigger.displayName = TabsPrimitive.Trigger.displayName\n\nconst TabsContent = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.Content\n    ref={ref}\n    className={cn(\n      \"mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsContent.displayName = TabsPrimitive.Content.displayName\n\nexport { Tabs, TabsList, TabsTrigger, TabsContent }\n","size_bytes":1883},"client/src/lib/authUtils.ts":{"content":"export function isUnauthorizedError(error: Error): boolean {\n  return /^401: .*Unauthorized/.test(error.message);\n}","size_bytes":115},"client/src/components/ui/button.tsx":{"content":"import * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst buttonVariants = cva(\n  \"inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-primary text-primary-foreground hover:bg-primary/90\",\n        destructive:\n          \"bg-destructive text-destructive-foreground hover:bg-destructive/90\",\n        outline:\n          \"border border-input bg-background hover:bg-accent hover:text-accent-foreground\",\n        secondary:\n          \"bg-secondary text-secondary-foreground hover:bg-secondary/80\",\n        ghost: \"hover:bg-accent hover:text-accent-foreground\",\n        link: \"text-primary underline-offset-4 hover:underline\",\n      },\n      size: {\n        default: \"h-10 px-4 py-2\",\n        sm: \"h-9 rounded-md px-3\",\n        lg: \"h-11 rounded-md px-8\",\n        icon: \"h-10 w-10\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n)\n\nexport interface ButtonProps\n  extends React.ButtonHTMLAttributes<HTMLButtonElement>,\n    VariantProps<typeof buttonVariants> {\n  asChild?: boolean\n}\n\nconst Button = React.forwardRef<HTMLButtonElement, ButtonProps>(\n  ({ className, variant, size, asChild = false, ...props }, ref) => {\n    const Comp = asChild ? Slot : \"button\"\n    return (\n      <Comp\n        className={cn(buttonVariants({ variant, size, className }))}\n        ref={ref}\n        {...props}\n      />\n    )\n  }\n)\nButton.displayName = \"Button\"\n\nexport { Button, buttonVariants }\n","size_bytes":1901},"client/src/components/ui/sidebar.tsx":{"content":"import * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { VariantProps, cva } from \"class-variance-authority\"\nimport { PanelLeft } from \"lucide-react\"\n\nimport { useIsMobile } from \"@/hooks/use-mobile\"\nimport { cn } from \"@/lib/utils\"\nimport { Button } from \"@/components/ui/button\"\nimport { Input } from \"@/components/ui/input\"\nimport { Separator } from \"@/components/ui/separator\"\nimport {\n  Sheet,\n  SheetContent,\n  SheetDescription,\n  SheetHeader,\n  SheetTitle,\n} from \"@/components/ui/sheet\"\nimport { Skeleton } from \"@/components/ui/skeleton\"\nimport {\n  Tooltip,\n  TooltipContent,\n  TooltipProvider,\n  TooltipTrigger,\n} from \"@/components/ui/tooltip\"\n\nconst SIDEBAR_COOKIE_NAME = \"sidebar_state\"\nconst SIDEBAR_COOKIE_MAX_AGE = 60 * 60 * 24 * 7\nconst SIDEBAR_WIDTH = \"16rem\"\nconst SIDEBAR_WIDTH_MOBILE = \"18rem\"\nconst SIDEBAR_WIDTH_ICON = \"3rem\"\nconst SIDEBAR_KEYBOARD_SHORTCUT = \"b\"\n\ntype SidebarContextProps = {\n  state: \"expanded\" | \"collapsed\"\n  open: boolean\n  setOpen: (open: boolean) => void\n  openMobile: boolean\n  setOpenMobile: (open: boolean) => void\n  isMobile: boolean\n  toggleSidebar: () => void\n}\n\nconst SidebarContext = React.createContext<SidebarContextProps | null>(null)\n\nfunction useSidebar() {\n  const context = React.useContext(SidebarContext)\n  if (!context) {\n    throw new Error(\"useSidebar must be used within a SidebarProvider.\")\n  }\n\n  return context\n}\n\nconst SidebarProvider = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> & {\n    defaultOpen?: boolean\n    open?: boolean\n    onOpenChange?: (open: boolean) => void\n  }\n>(\n  (\n    {\n      defaultOpen = true,\n      open: openProp,\n      onOpenChange: setOpenProp,\n      className,\n      style,\n      children,\n      ...props\n    },\n    ref\n  ) => {\n    const isMobile = useIsMobile()\n    const [openMobile, setOpenMobile] = React.useState(false)\n\n    // This is the internal state of the sidebar.\n    // We use openProp and setOpenProp for control from outside the component.\n    const [_open, _setOpen] = React.useState(defaultOpen)\n    const open = openProp ?? _open\n    const setOpen = React.useCallback(\n      (value: boolean | ((value: boolean) => boolean)) => {\n        const openState = typeof value === \"function\" ? value(open) : value\n        if (setOpenProp) {\n          setOpenProp(openState)\n        } else {\n          _setOpen(openState)\n        }\n\n        // This sets the cookie to keep the sidebar state.\n        document.cookie = `${SIDEBAR_COOKIE_NAME}=${openState}; path=/; max-age=${SIDEBAR_COOKIE_MAX_AGE}`\n      },\n      [setOpenProp, open]\n    )\n\n    // Helper to toggle the sidebar.\n    const toggleSidebar = React.useCallback(() => {\n      return isMobile\n        ? setOpenMobile((open) => !open)\n        : setOpen((open) => !open)\n    }, [isMobile, setOpen, setOpenMobile])\n\n    // Adds a keyboard shortcut to toggle the sidebar.\n    React.useEffect(() => {\n      const handleKeyDown = (event: KeyboardEvent) => {\n        if (\n          event.key === SIDEBAR_KEYBOARD_SHORTCUT &&\n          (event.metaKey || event.ctrlKey)\n        ) {\n          event.preventDefault()\n          toggleSidebar()\n        }\n      }\n\n      window.addEventListener(\"keydown\", handleKeyDown)\n      return () => window.removeEventListener(\"keydown\", handleKeyDown)\n    }, [toggleSidebar])\n\n    // We add a state so that we can do data-state=\"expanded\" or \"collapsed\".\n    // This makes it easier to style the sidebar with Tailwind classes.\n    const state = open ? \"expanded\" : \"collapsed\"\n\n    const contextValue = React.useMemo<SidebarContextProps>(\n      () => ({\n        state,\n        open,\n        setOpen,\n        isMobile,\n        openMobile,\n        setOpenMobile,\n        toggleSidebar,\n      }),\n      [state, open, setOpen, isMobile, openMobile, setOpenMobile, toggleSidebar]\n    )\n\n    return (\n      <SidebarContext.Provider value={contextValue}>\n        <TooltipProvider delayDuration={0}>\n          <div\n            style={\n              {\n                \"--sidebar-width\": SIDEBAR_WIDTH,\n                \"--sidebar-width-icon\": SIDEBAR_WIDTH_ICON,\n                ...style,\n              } as React.CSSProperties\n            }\n            className={cn(\n              \"group/sidebar-wrapper flex min-h-svh w-full has-[[data-variant=inset]]:bg-sidebar\",\n              className\n            )}\n            ref={ref}\n            {...props}\n          >\n            {children}\n          </div>\n        </TooltipProvider>\n      </SidebarContext.Provider>\n    )\n  }\n)\nSidebarProvider.displayName = \"SidebarProvider\"\n\nconst Sidebar = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> & {\n    side?: \"left\" | \"right\"\n    variant?: \"sidebar\" | \"floating\" | \"inset\"\n    collapsible?: \"offcanvas\" | \"icon\" | \"none\"\n  }\n>(\n  (\n    {\n      side = \"left\",\n      variant = \"sidebar\",\n      collapsible = \"offcanvas\",\n      className,\n      children,\n      ...props\n    },\n    ref\n  ) => {\n    const { isMobile, state, openMobile, setOpenMobile } = useSidebar()\n\n    if (collapsible === \"none\") {\n      return (\n        <div\n          className={cn(\n            \"flex h-full w-[--sidebar-width] flex-col bg-sidebar text-sidebar-foreground\",\n            className\n          )}\n          ref={ref}\n          {...props}\n        >\n          {children}\n        </div>\n      )\n    }\n\n    if (isMobile) {\n      return (\n        <Sheet open={openMobile} onOpenChange={setOpenMobile} {...props}>\n          <SheetContent\n            data-sidebar=\"sidebar\"\n            data-mobile=\"true\"\n            className=\"w-[--sidebar-width] bg-sidebar p-0 text-sidebar-foreground [&>button]:hidden\"\n            style={\n              {\n                \"--sidebar-width\": SIDEBAR_WIDTH_MOBILE,\n              } as React.CSSProperties\n            }\n            side={side}\n          >\n            <SheetHeader className=\"sr-only\">\n              <SheetTitle>Sidebar</SheetTitle>\n              <SheetDescription>Displays the mobile sidebar.</SheetDescription>\n            </SheetHeader>\n            <div className=\"flex h-full w-full flex-col\">{children}</div>\n          </SheetContent>\n        </Sheet>\n      )\n    }\n\n    return (\n      <div\n        ref={ref}\n        className=\"group peer hidden text-sidebar-foreground md:block\"\n        data-state={state}\n        data-collapsible={state === \"collapsed\" ? collapsible : \"\"}\n        data-variant={variant}\n        data-side={side}\n      >\n        {/* This is what handles the sidebar gap on desktop */}\n        <div\n          className={cn(\n            \"relative w-[--sidebar-width] bg-transparent transition-[width] duration-200 ease-linear\",\n            \"group-data-[collapsible=offcanvas]:w-0\",\n            \"group-data-[side=right]:rotate-180\",\n            variant === \"floating\" || variant === \"inset\"\n              ? \"group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)_+_theme(spacing.4))]\"\n              : \"group-data-[collapsible=icon]:w-[--sidebar-width-icon]\"\n          )}\n        />\n        <div\n          className={cn(\n            \"fixed inset-y-0 z-10 hidden h-svh w-[--sidebar-width] transition-[left,right,width] duration-200 ease-linear md:flex\",\n            side === \"left\"\n              ? \"left-0 group-data-[collapsible=offcanvas]:left-[calc(var(--sidebar-width)*-1)]\"\n              : \"right-0 group-data-[collapsible=offcanvas]:right-[calc(var(--sidebar-width)*-1)]\",\n            // Adjust the padding for floating and inset variants.\n            variant === \"floating\" || variant === \"inset\"\n              ? \"p-2 group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)_+_theme(spacing.4)_+2px)]\"\n              : \"group-data-[collapsible=icon]:w-[--sidebar-width-icon] group-data-[side=left]:border-r group-data-[side=right]:border-l\",\n            className\n          )}\n          {...props}\n        >\n          <div\n            data-sidebar=\"sidebar\"\n            className=\"flex h-full w-full flex-col bg-sidebar group-data-[variant=floating]:rounded-lg group-data-[variant=floating]:border group-data-[variant=floating]:border-sidebar-border group-data-[variant=floating]:shadow\"\n          >\n            {children}\n          </div>\n        </div>\n      </div>\n    )\n  }\n)\nSidebar.displayName = \"Sidebar\"\n\nconst SidebarTrigger = React.forwardRef<\n  React.ElementRef<typeof Button>,\n  React.ComponentProps<typeof Button>\n>(({ className, onClick, ...props }, ref) => {\n  const { toggleSidebar } = useSidebar()\n\n  return (\n    <Button\n      ref={ref}\n      data-sidebar=\"trigger\"\n      variant=\"ghost\"\n      size=\"icon\"\n      className={cn(\"h-7 w-7\", className)}\n      onClick={(event) => {\n        onClick?.(event)\n        toggleSidebar()\n      }}\n      {...props}\n    >\n      <PanelLeft />\n      <span className=\"sr-only\">Toggle Sidebar</span>\n    </Button>\n  )\n})\nSidebarTrigger.displayName = \"SidebarTrigger\"\n\nconst SidebarRail = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<\"button\">\n>(({ className, ...props }, ref) => {\n  const { toggleSidebar } = useSidebar()\n\n  return (\n    <button\n      ref={ref}\n      data-sidebar=\"rail\"\n      aria-label=\"Toggle Sidebar\"\n      tabIndex={-1}\n      onClick={toggleSidebar}\n      title=\"Toggle Sidebar\"\n      className={cn(\n        \"absolute inset-y-0 z-20 hidden w-4 -translate-x-1/2 transition-all ease-linear after:absolute after:inset-y-0 after:left-1/2 after:w-[2px] hover:after:bg-sidebar-border group-data-[side=left]:-right-4 group-data-[side=right]:left-0 sm:flex\",\n        \"[[data-side=left]_&]:cursor-w-resize [[data-side=right]_&]:cursor-e-resize\",\n        \"[[data-side=left][data-state=collapsed]_&]:cursor-e-resize [[data-side=right][data-state=collapsed]_&]:cursor-w-resize\",\n        \"group-data-[collapsible=offcanvas]:translate-x-0 group-data-[collapsible=offcanvas]:after:left-full group-data-[collapsible=offcanvas]:hover:bg-sidebar\",\n        \"[[data-side=left][data-collapsible=offcanvas]_&]:-right-2\",\n        \"[[data-side=right][data-collapsible=offcanvas]_&]:-left-2\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarRail.displayName = \"SidebarRail\"\n\nconst SidebarInset = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"main\">\n>(({ className, ...props }, ref) => {\n  return (\n    <main\n      ref={ref}\n      className={cn(\n        \"relative flex w-full flex-1 flex-col bg-background\",\n        \"md:peer-data-[variant=inset]:m-2 md:peer-data-[state=collapsed]:peer-data-[variant=inset]:ml-2 md:peer-data-[variant=inset]:ml-0 md:peer-data-[variant=inset]:rounded-xl md:peer-data-[variant=inset]:shadow\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarInset.displayName = \"SidebarInset\"\n\nconst SidebarInput = React.forwardRef<\n  React.ElementRef<typeof Input>,\n  React.ComponentProps<typeof Input>\n>(({ className, ...props }, ref) => {\n  return (\n    <Input\n      ref={ref}\n      data-sidebar=\"input\"\n      className={cn(\n        \"h-8 w-full bg-background shadow-none focus-visible:ring-2 focus-visible:ring-sidebar-ring\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarInput.displayName = \"SidebarInput\"\n\nconst SidebarHeader = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\">\n>(({ className, ...props }, ref) => {\n  return (\n    <div\n      ref={ref}\n      data-sidebar=\"header\"\n      className={cn(\"flex flex-col gap-2 p-2\", className)}\n      {...props}\n    />\n  )\n})\nSidebarHeader.displayName = \"SidebarHeader\"\n\nconst SidebarFooter = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\">\n>(({ className, ...props }, ref) => {\n  return (\n    <div\n      ref={ref}\n      data-sidebar=\"footer\"\n      className={cn(\"flex flex-col gap-2 p-2\", className)}\n      {...props}\n    />\n  )\n})\nSidebarFooter.displayName = \"SidebarFooter\"\n\nconst SidebarSeparator = React.forwardRef<\n  React.ElementRef<typeof Separator>,\n  React.ComponentProps<typeof Separator>\n>(({ className, ...props }, ref) => {\n  return (\n    <Separator\n      ref={ref}\n      data-sidebar=\"separator\"\n      className={cn(\"mx-2 w-auto bg-sidebar-border\", className)}\n      {...props}\n    />\n  )\n})\nSidebarSeparator.displayName = \"SidebarSeparator\"\n\nconst SidebarContent = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\">\n>(({ className, ...props }, ref) => {\n  return (\n    <div\n      ref={ref}\n      data-sidebar=\"content\"\n      className={cn(\n        \"flex min-h-0 flex-1 flex-col gap-2 overflow-auto group-data-[collapsible=icon]:overflow-hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarContent.displayName = \"SidebarContent\"\n\nconst SidebarGroup = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\">\n>(({ className, ...props }, ref) => {\n  return (\n    <div\n      ref={ref}\n      data-sidebar=\"group\"\n      className={cn(\"relative flex w-full min-w-0 flex-col p-2\", className)}\n      {...props}\n    />\n  )\n})\nSidebarGroup.displayName = \"SidebarGroup\"\n\nconst SidebarGroupLabel = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> & { asChild?: boolean }\n>(({ className, asChild = false, ...props }, ref) => {\n  const Comp = asChild ? Slot : \"div\"\n\n  return (\n    <Comp\n      ref={ref}\n      data-sidebar=\"group-label\"\n      className={cn(\n        \"flex h-8 shrink-0 items-center rounded-md px-2 text-xs font-medium text-sidebar-foreground/70 outline-none ring-sidebar-ring transition-[margin,opacity] duration-200 ease-linear focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0\",\n        \"group-data-[collapsible=icon]:-mt-8 group-data-[collapsible=icon]:opacity-0\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarGroupLabel.displayName = \"SidebarGroupLabel\"\n\nconst SidebarGroupAction = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<\"button\"> & { asChild?: boolean }\n>(({ className, asChild = false, ...props }, ref) => {\n  const Comp = asChild ? Slot : \"button\"\n\n  return (\n    <Comp\n      ref={ref}\n      data-sidebar=\"group-action\"\n      className={cn(\n        \"absolute right-3 top-3.5 flex aspect-square w-5 items-center justify-center rounded-md p-0 text-sidebar-foreground outline-none ring-sidebar-ring transition-transform hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0\",\n        // Increases the hit area of the button on mobile.\n        \"after:absolute after:-inset-2 after:md:hidden\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarGroupAction.displayName = \"SidebarGroupAction\"\n\nconst SidebarGroupContent = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\">\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    data-sidebar=\"group-content\"\n    className={cn(\"w-full text-sm\", className)}\n    {...props}\n  />\n))\nSidebarGroupContent.displayName = \"SidebarGroupContent\"\n\nconst SidebarMenu = React.forwardRef<\n  HTMLUListElement,\n  React.ComponentProps<\"ul\">\n>(({ className, ...props }, ref) => (\n  <ul\n    ref={ref}\n    data-sidebar=\"menu\"\n    className={cn(\"flex w-full min-w-0 flex-col gap-1\", className)}\n    {...props}\n  />\n))\nSidebarMenu.displayName = \"SidebarMenu\"\n\nconst SidebarMenuItem = React.forwardRef<\n  HTMLLIElement,\n  React.ComponentProps<\"li\">\n>(({ className, ...props }, ref) => (\n  <li\n    ref={ref}\n    data-sidebar=\"menu-item\"\n    className={cn(\"group/menu-item relative\", className)}\n    {...props}\n  />\n))\nSidebarMenuItem.displayName = \"SidebarMenuItem\"\n\nconst sidebarMenuButtonVariants = cva(\n  \"peer/menu-button flex w-full items-center gap-2 overflow-hidden rounded-md p-2 text-left text-sm outline-none ring-sidebar-ring transition-[width,height,padding] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 active:bg-sidebar-accent active:text-sidebar-accent-foreground disabled:pointer-events-none disabled:opacity-50 group-has-[[data-sidebar=menu-action]]/menu-item:pr-8 aria-disabled:pointer-events-none aria-disabled:opacity-50 data-[active=true]:bg-sidebar-accent data-[active=true]:font-medium data-[active=true]:text-sidebar-accent-foreground data-[state=open]:hover:bg-sidebar-accent data-[state=open]:hover:text-sidebar-accent-foreground group-data-[collapsible=icon]:!size-8 group-data-[collapsible=icon]:!p-2 [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0\",\n  {\n    variants: {\n      variant: {\n        default: \"hover:bg-sidebar-accent hover:text-sidebar-accent-foreground\",\n        outline:\n          \"bg-background shadow-[0_0_0_1px_hsl(var(--sidebar-border))] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground hover:shadow-[0_0_0_1px_hsl(var(--sidebar-accent))]\",\n      },\n      size: {\n        default: \"h-8 text-sm\",\n        sm: \"h-7 text-xs\",\n        lg: \"h-12 text-sm group-data-[collapsible=icon]:!p-0\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n)\n\nconst SidebarMenuButton = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<\"button\"> & {\n    asChild?: boolean\n    isActive?: boolean\n    tooltip?: string | React.ComponentProps<typeof TooltipContent>\n  } & VariantProps<typeof sidebarMenuButtonVariants>\n>(\n  (\n    {\n      asChild = false,\n      isActive = false,\n      variant = \"default\",\n      size = \"default\",\n      tooltip,\n      className,\n      ...props\n    },\n    ref\n  ) => {\n    const Comp = asChild ? Slot : \"button\"\n    const { isMobile, state } = useSidebar()\n\n    const button = (\n      <Comp\n        ref={ref}\n        data-sidebar=\"menu-button\"\n        data-size={size}\n        data-active={isActive}\n        className={cn(sidebarMenuButtonVariants({ variant, size }), className)}\n        {...props}\n      />\n    )\n\n    if (!tooltip) {\n      return button\n    }\n\n    if (typeof tooltip === \"string\") {\n      tooltip = {\n        children: tooltip,\n      }\n    }\n\n    return (\n      <Tooltip>\n        <TooltipTrigger asChild>{button}</TooltipTrigger>\n        <TooltipContent\n          side=\"right\"\n          align=\"center\"\n          hidden={state !== \"collapsed\" || isMobile}\n          {...tooltip}\n        />\n      </Tooltip>\n    )\n  }\n)\nSidebarMenuButton.displayName = \"SidebarMenuButton\"\n\nconst SidebarMenuAction = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<\"button\"> & {\n    asChild?: boolean\n    showOnHover?: boolean\n  }\n>(({ className, asChild = false, showOnHover = false, ...props }, ref) => {\n  const Comp = asChild ? Slot : \"button\"\n\n  return (\n    <Comp\n      ref={ref}\n      data-sidebar=\"menu-action\"\n      className={cn(\n        \"absolute right-1 top-1.5 flex aspect-square w-5 items-center justify-center rounded-md p-0 text-sidebar-foreground outline-none ring-sidebar-ring transition-transform hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 peer-hover/menu-button:text-sidebar-accent-foreground [&>svg]:size-4 [&>svg]:shrink-0\",\n        // Increases the hit area of the button on mobile.\n        \"after:absolute after:-inset-2 after:md:hidden\",\n        \"peer-data-[size=sm]/menu-button:top-1\",\n        \"peer-data-[size=default]/menu-button:top-1.5\",\n        \"peer-data-[size=lg]/menu-button:top-2.5\",\n        \"group-data-[collapsible=icon]:hidden\",\n        showOnHover &&\n          \"group-focus-within/menu-item:opacity-100 group-hover/menu-item:opacity-100 data-[state=open]:opacity-100 peer-data-[active=true]/menu-button:text-sidebar-accent-foreground md:opacity-0\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarMenuAction.displayName = \"SidebarMenuAction\"\n\nconst SidebarMenuBadge = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\">\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    data-sidebar=\"menu-badge\"\n    className={cn(\n      \"pointer-events-none absolute right-1 flex h-5 min-w-5 select-none items-center justify-center rounded-md px-1 text-xs font-medium tabular-nums text-sidebar-foreground\",\n      \"peer-hover/menu-button:text-sidebar-accent-foreground peer-data-[active=true]/menu-button:text-sidebar-accent-foreground\",\n      \"peer-data-[size=sm]/menu-button:top-1\",\n      \"peer-data-[size=default]/menu-button:top-1.5\",\n      \"peer-data-[size=lg]/menu-button:top-2.5\",\n      \"group-data-[collapsible=icon]:hidden\",\n      className\n    )}\n    {...props}\n  />\n))\nSidebarMenuBadge.displayName = \"SidebarMenuBadge\"\n\nconst SidebarMenuSkeleton = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> & {\n    showIcon?: boolean\n  }\n>(({ className, showIcon = false, ...props }, ref) => {\n  // Random width between 50 to 90%.\n  const width = React.useMemo(() => {\n    return `${Math.floor(Math.random() * 40) + 50}%`\n  }, [])\n\n  return (\n    <div\n      ref={ref}\n      data-sidebar=\"menu-skeleton\"\n      className={cn(\"flex h-8 items-center gap-2 rounded-md px-2\", className)}\n      {...props}\n    >\n      {showIcon && (\n        <Skeleton\n          className=\"size-4 rounded-md\"\n          data-sidebar=\"menu-skeleton-icon\"\n        />\n      )}\n      <Skeleton\n        className=\"h-4 max-w-[--skeleton-width] flex-1\"\n        data-sidebar=\"menu-skeleton-text\"\n        style={\n          {\n            \"--skeleton-width\": width,\n          } as React.CSSProperties\n        }\n      />\n    </div>\n  )\n})\nSidebarMenuSkeleton.displayName = \"SidebarMenuSkeleton\"\n\nconst SidebarMenuSub = React.forwardRef<\n  HTMLUListElement,\n  React.ComponentProps<\"ul\">\n>(({ className, ...props }, ref) => (\n  <ul\n    ref={ref}\n    data-sidebar=\"menu-sub\"\n    className={cn(\n      \"mx-3.5 flex min-w-0 translate-x-px flex-col gap-1 border-l border-sidebar-border px-2.5 py-0.5\",\n      \"group-data-[collapsible=icon]:hidden\",\n      className\n    )}\n    {...props}\n  />\n))\nSidebarMenuSub.displayName = \"SidebarMenuSub\"\n\nconst SidebarMenuSubItem = React.forwardRef<\n  HTMLLIElement,\n  React.ComponentProps<\"li\">\n>(({ ...props }, ref) => <li ref={ref} {...props} />)\nSidebarMenuSubItem.displayName = \"SidebarMenuSubItem\"\n\nconst SidebarMenuSubButton = React.forwardRef<\n  HTMLAnchorElement,\n  React.ComponentProps<\"a\"> & {\n    asChild?: boolean\n    size?: \"sm\" | \"md\"\n    isActive?: boolean\n  }\n>(({ asChild = false, size = \"md\", isActive, className, ...props }, ref) => {\n  const Comp = asChild ? Slot : \"a\"\n\n  return (\n    <Comp\n      ref={ref}\n      data-sidebar=\"menu-sub-button\"\n      data-size={size}\n      data-active={isActive}\n      className={cn(\n        \"flex h-7 min-w-0 -translate-x-px items-center gap-2 overflow-hidden rounded-md px-2 text-sidebar-foreground outline-none ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 active:bg-sidebar-accent active:text-sidebar-accent-foreground disabled:pointer-events-none disabled:opacity-50 aria-disabled:pointer-events-none aria-disabled:opacity-50 [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0 [&>svg]:text-sidebar-accent-foreground\",\n        \"data-[active=true]:bg-sidebar-accent data-[active=true]:text-sidebar-accent-foreground\",\n        size === \"sm\" && \"text-xs\",\n        size === \"md\" && \"text-sm\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarMenuSubButton.displayName = \"SidebarMenuSubButton\"\n\nexport {\n  Sidebar,\n  SidebarContent,\n  SidebarFooter,\n  SidebarGroup,\n  SidebarGroupAction,\n  SidebarGroupContent,\n  SidebarGroupLabel,\n  SidebarHeader,\n  SidebarInput,\n  SidebarInset,\n  SidebarMenu,\n  SidebarMenuAction,\n  SidebarMenuBadge,\n  SidebarMenuButton,\n  SidebarMenuItem,\n  SidebarMenuSkeleton,\n  SidebarMenuSub,\n  SidebarMenuSubButton,\n  SidebarMenuSubItem,\n  SidebarProvider,\n  SidebarRail,\n  SidebarSeparator,\n  SidebarTrigger,\n  useSidebar,\n}\n","size_bytes":23567},"server/middleware/validation.ts":{"content":"import { Request, Response, NextFunction } from \"express\";\nimport { z, ZodError } from \"zod\";\nimport { logger } from \"../logger\";\n\nexport const validate = (schema: {\n  body?: z.ZodSchema;\n  query?: z.ZodSchema;\n  params?: z.ZodSchema;\n}) => {\n  return (req: Request, res: Response, next: NextFunction) => {\n    try {\n      // Validate request body\n      if (schema.body) {\n        req.body = schema.body.parse(req.body);\n      }\n\n      // Validate query parameters\n      if (schema.query) {\n        req.query = schema.query.parse(req.query);\n      }\n\n      // Validate route parameters\n      if (schema.params) {\n        req.params = schema.params.parse(req.params);\n      }\n\n      next();\n    } catch (error) {\n      if (error instanceof ZodError) {\n        logger.warn(`Validation error for ${req.method} ${req.originalUrl}: ${error.errors.map(e => e.message).join(', ')}`);\n\n        return res.status(400).json({\n          error: \"Validation Error\",\n          message: \"Invalid request data\",\n          details: error.errors.map(err => ({\n            field: err.path.join(\".\"),\n            message: err.message,\n            code: err.code,\n          })),\n        });\n      }\n\n      logger.error(`Unexpected validation error: ${error instanceof Error ? error.message : String(error)}`);\n      res.status(500).json({\n        error: \"Internal Server Error\",\n        message: \"An unexpected error occurred during validation\",\n      });\n    }\n  };\n};\n\n// Common validation schemas\nexport const paginationSchema = z.object({\n  page: z.coerce.number().min(1).default(1),\n  limit: z.coerce.number().min(1).max(100).default(20),\n  sort: z.string().optional(),\n  order: z.enum([\"asc\", \"desc\"]).default(\"desc\"),\n});\n\nexport const idParamSchema = z.object({\n  id: z.string().uuid(\"Invalid ID format\"),\n});\n\nexport const userIdParamSchema = z.object({\n  userId: z.string().min(1, \"User ID is required\"),\n});\n\n// File upload validation\nexport const fileUploadSchema = z.object({\n  title: z.string().min(1).max(255),\n  description: z.string().max(1000).optional(),\n  price: z.coerce.number().min(0).optional(),\n  isPremium: z.boolean().default(false),\n});\n\n// Profile update validation\nexport const profileUpdateSchema = z.object({\n  displayName: z.string().min(1).max(100).optional(),\n  bio: z.string().max(500).optional(),\n  subscriptionPrice: z.coerce.number().min(0).optional(),\n});\n\n// Message validation\nexport const messageSchema = z.object({\n  recipientId: z.string().min(1),\n  content: z.string().min(1).max(1000),\n  mediaUrl: z.string().url().optional(),\n});\n\n// Payment validation\nexport const payoutAccountSchema = z.object({\n  provider: z.enum([\"paxum\", \"epayservice\", \"wise\", \"crypto\"]),\n  accountRef: z.string().min(1).max(255),\n  metadata: z.record(z.any()).optional(),\n});\n\nexport const payoutRequestSchema = z.object({\n  payoutAccountId: z.string().uuid(),\n  amountCents: z.number().min(1000), // Minimum $10\n  currency: z.string().length(3).default(\"USD\"),\n});\n\n// Post validation\nexport const createPostSchema = z.object({\n  text: z.string().max(5000).optional(),\n  mediaUrl: z.string().url().optional(),\n  mediaType: z.enum([\"image\", \"video\", \"audio\"]).optional(),\n  mediaAssetId: z.string().uuid().optional(),\n  isFree: z.boolean().default(false),\n  creatorAllowsFree: z.boolean().default(false),\n  creatorIsAgeVerified: z.boolean().default(false),\n  requiresSubscription: z.boolean().default(true),\n  requiresAgeVerification: z.boolean().default(true),\n});\n\nexport const updatePostSchema = z.object({\n  text: z.string().max(5000).optional(),\n  isFree: z.boolean().optional(),\n  requiresSubscription: z.boolean().optional(),\n});\n\n// Follow validation\nexport const creatorIdParamSchema = z.object({\n  creatorId: z.string().min(1, \"Creator ID is required\"),\n});\n\n// Story validation\nexport const createStorySchema = z.object({\n  mediaUrl: z.string().url(\"Invalid media URL\"),\n  mediaType: z.enum([\"image\", \"video\"]),\n  mediaThumbnailUrl: z.string().url(\"Invalid thumbnail URL\").optional(),\n  caption: z.string().max(500).optional(),\n  isFree: z.boolean().default(false),\n  requiresSubscription: z.boolean().default(true),\n});\n\n// Fan Level validation\nexport const addXPSchema = z.object({\n  amount: z.number().min(1, \"XP amount must be positive\").max(1000, \"Maximum 1000 XP per action\"),\n  reason: z.string().min(1).max(100),\n});\n\n// NFT validation schemas\nexport const deployNftContractSchema = z.object({\n  blockchain: z.enum([\"ethereum\", \"polygon\", \"solana\", \"binance\"]),\n  contractAddress: z.string().min(1),\n  royaltyPercentage: z.number().min(0).max(50),\n  metadata: z.record(z.any()).optional(),\n});\n\nexport const mintNftSchema = z.object({\n  contractId: z.string().uuid(),\n  mediaId: z.string().uuid(),\n  tokenId: z.string().min(1),\n  metadata: z.record(z.any()).optional(),\n});\n\nexport const recordNftRoyaltySchema = z.object({\n  contractId: z.string().uuid(),\n  mintId: z.string().uuid(),\n  royaltyAmount: z.string().min(1),\n  buyerAddress: z.string().min(1),\n  transactionHash: z.string().min(1),\n  salePrice: z.string().min(1),\n});\n\n// Loan validation schemas\nexport const createLoanProgramSchema = z.object({\n  name: z.string().min(1).max(255),\n  description: z.string().max(1000).optional(),\n  minAmount: z.number().min(1),\n  maxAmount: z.number().min(1),\n  minTerm: z.number().min(1),\n  maxTerm: z.number().min(1),\n  interestRate: z.number().min(0).max(100),\n  isActive: z.boolean().default(true),\n});\n\nexport const createLoanApplicationSchema = z.object({\n  programId: z.string().uuid(),\n  requestedAmount: z.number().min(1),\n  requestedTerm: z.number().min(1),\n  purpose: z.string().max(1000),\n  revenueData: z.record(z.any()).optional(),\n});\n\nexport const createLoanOfferSchema = z.object({\n  applicationId: z.string().uuid(),\n  offeredAmount: z.number().min(1),\n  offeredTerm: z.number().min(1),\n  interestRate: z.number().min(0).max(100),\n  terms: z.string().max(1000).optional(),\n});\n\nexport const payLoanRepaymentSchema = z.object({\n  amount: z.number().min(1),\n});\n\n// AI Moderation validation schemas\nexport const createAiScanJobSchema = z.object({\n  mediaId: z.string().uuid(),\n  scanType: z.enum([\"deepfake\", \"nsfw\", \"prohibited\", \"full\"]),\n  priority: z.number().min(1).max(10).default(5),\n  provider: z.enum([\"hive\", \"reality_defender\", \"aws_rekognition\"]).optional(),\n});\n\nexport const createContentFingerprintSchema = z.object({\n  mediaId: z.string().uuid(),\n  fingerprintType: z.enum([\"perceptual_hash\", \"forensic_signature\", \"watermark\"]),\n  fingerprintData: z.string().min(1),\n  metadata: z.record(z.any()).optional(),\n});\n\n// Param validation schemas for new endpoints\nexport const creatorIdPathParamSchema = z.object({\n  creatorId: z.string().uuid(\"Invalid creator ID format\"),\n});\n\nexport const lenderIdPathParamSchema = z.object({\n  lenderId: z.string().uuid(\"Invalid lender ID format\"),\n});\n\nexport const mediaIdPathParamSchema = z.object({\n  mediaId: z.string().uuid(\"Invalid media ID format\"),\n});\n\nexport const contractIdPathParamSchema = z.object({\n  contractId: z.string().uuid(\"Invalid contract ID format\"),\n});\n\nexport const jobIdPathParamSchema = z.object({\n  jobId: z.string().uuid(\"Invalid job ID format\"),\n});\n\nexport const offerIdPathParamSchema = z.object({\n  offerId: z.string().uuid(\"Invalid offer ID format\"),\n});\n\n// AI Moderation review/verification schemas\nexport const reviewAiScanResultSchema = z.object({\n  humanReviewStatus: z.enum([\"approved\", \"rejected\", \"flagged\"]),\n  reviewNotes: z.string().max(1000).optional(),\n  moderatorAction: z.enum([\"none\", \"remove_content\", \"warn_user\", \"ban_user\"]).default(\"none\"),\n});\n\nexport const verifyContentFingerprintSchema = z.object({\n  isVerified: z.boolean(),\n  verificationNotes: z.string().max(1000).optional(),\n  matchConfidence: z.number().min(0).max(100).optional(),\n});\n","size_bytes":7788},"client/src/components/layout/Header.tsx":{"content":"import { useAuth } from \"@/hooks/useAuth\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport daddyFanzLogo from \"@assets/daddyfanzlogo1_1759189347461.png\";\nimport { Button } from \"@/components/ui/button\";\nimport { Avatar, AvatarFallback } from \"@/components/ui/avatar\";\nimport { \n  DropdownMenu,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuLabel,\n  DropdownMenuSeparator,\n  DropdownMenuTrigger,\n} from \"@/components/ui/dropdown-menu\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Link, useLocation } from \"wouter\";\nimport { \n  Bell, \n  Settings, \n  LogOut, \n  User, \n  DollarSign, \n  MessageCircle,\n  BarChart3,\n  Shield,\n  Menu,\n  X,\n  Brain,\n  HeadphonesIcon,\n  GraduationCap,\n  Upload,\n  FolderOpen,\n  Home\n} from \"lucide-react\";\nimport { useState } from \"react\";\n\nexport default function Header() {\n  const { user, isAuthenticated } = useAuth();\n  const [location] = useLocation();\n  const [mobileMenuOpen, setMobileMenuOpen] = useState(false);\n\n  const { data: profile } = useQuery({\n    queryKey: [\"/api/profile\"],\n    retry: false,\n    enabled: isAuthenticated,\n  });\n\n  const handleLogout = () => {\n    localStorage.removeItem(\"authToken\");\n    window.location.href = \"/api/logout\";\n  };\n\n  const navItems = [\n    { path: \"/\", label: \"Dashboard\", icon: BarChart3 },\n    { path: \"/feed\", label: \"Feed\", icon: Home },\n    { path: \"/profile\", label: \"Profile\", icon: User },\n    { path: \"/content-manage\", label: \"Content\", icon: FolderOpen },\n    { path: \"/content-upload\", label: \"Upload\", icon: Upload },\n    { path: \"/messages\", label: \"Messages\", icon: MessageCircle },\n    { path: \"/ai-wiki\", label: \"AI Wiki\", icon: Brain },\n    { path: \"/tutorials\", label: \"Tutorials\", icon: GraduationCap },\n    { path: \"/help-desk\", label: \"Help Desk\", icon: HeadphonesIcon },\n    { path: \"/settings\", label: \"Settings\", icon: Settings },\n  ];\n\n  const isCurrentPath = (path: string) => {\n    if (path === \"/\" && location === \"/\") return true;\n    if (path !== \"/\" && location.startsWith(path)) return true;\n    return false;\n  };\n\n  if (!isAuthenticated || !user) {\n    return null;\n  }\n\n  return (\n    <header className=\"bg-df-brick border-b border-df-steel shadow-lg sticky top-0 z-50\">\n      <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8\">\n        <div className=\"flex justify-between items-center h-16\">\n          {/* Logo */}\n          <Link href=\"/\" className=\"flex items-center\" data-testid=\"link-logo\">\n            <img \n              src={daddyFanzLogo} \n              alt=\"DaddyFanz\" \n              className=\"h-12 w-auto hover:scale-105 transition-transform duration-200 glow-image\"\n            />\n          </Link>\n          \n          {/* Desktop Navigation */}\n          <nav className=\"hidden md:flex space-x-8\">\n            {navItems.map((item) => (\n              <Link \n                key={item.path}\n                href={item.path}\n                className={`flex items-center space-x-2 px-3 py-2 rounded-md transition-colors ${\n                  isCurrentPath(item.path)\n                    ? 'neon-heading border-b-2 border-df-cyan bg-df-cyan bg-opacity-10'\n                    : 'text-df-fog hover:text-df-cyan hover:bg-df-steel hover:bg-opacity-20'\n                }`}\n                data-testid={`nav-${item.label.toLowerCase()}`}\n              >\n                <item.icon className=\"h-4 w-4\" />\n                <span>{item.label}</span>\n              </Link>\n            ))}\n          </nav>\n          \n          {/* User Menu */}\n          <div className=\"flex items-center space-x-4\">\n            {/* Notifications */}\n            <Button \n              variant=\"ghost\" \n              size=\"sm\"\n              className=\"text-df-fog hover:text-df-cyan relative p-2\"\n              data-testid=\"button-notifications\"\n            >\n              <Bell className=\"h-5 w-5\" />\n              <Badge \n                variant=\"secondary\" \n                className=\"absolute -top-1 -right-1 bg-df-gold text-df-ink text-xs h-5 w-5 flex items-center justify-center p-0\"\n              >\n                3\n              </Badge>\n            </Button>\n            \n            {/* Profile Dropdown */}\n            <DropdownMenu>\n              <DropdownMenuTrigger asChild>\n                <Button \n                  variant=\"ghost\" \n                  className=\"flex items-center space-x-3 p-1 hover:bg-df-steel hover:bg-opacity-20\"\n                  data-testid=\"button-profile-menu\"\n                >\n                  <Avatar className=\"h-8 w-8 border-2 border-df-cyan shadow-glow\">\n                    <AvatarFallback className=\"bg-df-ink text-df-cyan\">\n                      {((profile as any)?.displayName || user.email || 'U')[0].toUpperCase()}\n                    </AvatarFallback>\n                  </Avatar>\n                  <div className=\"hidden sm:block text-left\">\n                    <div className=\"text-df-snow font-medium text-sm\" data-testid=\"text-display-name\">\n                      {(profile as any)?.displayName || user.email}\n                    </div>\n                    <div className=\"flex items-center space-x-1\">\n                      <span className=\"text-df-fog text-xs capitalize\">{user.role}</span>\n                      {(profile as any)?.ageVerified && (\n                        <div className=\"w-3 h-3 bg-df-gold rounded-full\" title=\"Verified Creator\" />\n                      )}\n                    </div>\n                  </div>\n                </Button>\n              </DropdownMenuTrigger>\n              <DropdownMenuContent \n                className=\"w-56 bg-df-brick border border-df-steel shadow-glow\"\n                align=\"end\"\n              >\n                <DropdownMenuLabel className=\"text-df-snow\">\n                  My Account\n                </DropdownMenuLabel>\n                <DropdownMenuSeparator className=\"bg-df-steel\" />\n                \n                <DropdownMenuItem asChild>\n                  <Link \n                    href=\"/profile\" \n                    className=\"flex items-center w-full text-df-fog hover:text-df-cyan hover:bg-df-steel hover:bg-opacity-20\"\n                    data-testid=\"menu-profile\"\n                  >\n                    <User className=\"mr-2 h-4 w-4\" />\n                    Profile\n                  </Link>\n                </DropdownMenuItem>\n                \n                {(user.role === \"creator\" || user.role === \"admin\") && (\n                  <>\n                    <DropdownMenuItem asChild>\n                      <Link \n                        href=\"/content-manage\" \n                        className=\"flex items-center w-full text-df-fog hover:text-df-cyan hover:bg-df-steel hover:bg-opacity-20\"\n                        data-testid=\"menu-content-manage\"\n                      >\n                        <FolderOpen className=\"mr-2 h-4 w-4\" />\n                        Manage Content\n                      </Link>\n                    </DropdownMenuItem>\n                    <DropdownMenuItem asChild>\n                      <Link \n                        href=\"/content-upload\" \n                        className=\"flex items-center w-full text-df-fog hover:text-df-cyan hover:bg-df-steel hover:bg-opacity-20\"\n                        data-testid=\"menu-content-upload\"\n                      >\n                        <Upload className=\"mr-2 h-4 w-4\" />\n                        Upload Content\n                      </Link>\n                    </DropdownMenuItem>\n                    <DropdownMenuItem asChild>\n                      <Link \n                        href=\"/earnings\" \n                        className=\"flex items-center w-full text-df-fog hover:text-df-cyan hover:bg-df-steel hover:bg-opacity-20\"\n                        data-testid=\"menu-earnings\"\n                      >\n                        <DollarSign className=\"mr-2 h-4 w-4\" />\n                        Earnings\n                      </Link>\n                    </DropdownMenuItem>\n                  </>\n                )}\n                \n                <DropdownMenuItem asChild>\n                  <Link \n                    href=\"/messages\" \n                    className=\"flex items-center w-full text-df-fog hover:text-df-cyan hover:bg-df-steel hover:bg-opacity-20\"\n                    data-testid=\"menu-messages\"\n                  >\n                    <MessageCircle className=\"mr-2 h-4 w-4\" />\n                    Messages\n                  </Link>\n                </DropdownMenuItem>\n                \n                {user.role === \"admin\" && (\n                  <DropdownMenuItem asChild>\n                    <Link \n                      href=\"/admin\" \n                      className=\"flex items-center w-full text-df-fog hover:text-df-cyan hover:bg-df-steel hover:bg-opacity-20\"\n                      data-testid=\"menu-admin\"\n                    >\n                      <Shield className=\"mr-2 h-4 w-4\" />\n                      Admin Panel\n                    </Link>\n                  </DropdownMenuItem>\n                )}\n                \n                <DropdownMenuSeparator className=\"bg-df-steel\" />\n                \n                <DropdownMenuItem asChild>\n                  <Link \n                    href=\"/settings\" \n                    className=\"flex items-center w-full text-df-fog hover:text-df-cyan hover:bg-df-steel hover:bg-opacity-20\"\n                    data-testid=\"menu-settings\"\n                  >\n                    <Settings className=\"mr-2 h-4 w-4\" />\n                    Settings\n                  </Link>\n                </DropdownMenuItem>\n                \n                <DropdownMenuSeparator className=\"bg-df-steel\" />\n                \n                <DropdownMenuItem \n                  onClick={handleLogout}\n                  className=\"flex items-center w-full text-red-400 hover:text-red-300 hover:bg-red-900 hover:bg-opacity-20\"\n                  data-testid=\"menu-logout\"\n                >\n                  <LogOut className=\"mr-2 h-4 w-4\" />\n                  Log out\n                </DropdownMenuItem>\n              </DropdownMenuContent>\n            </DropdownMenu>\n\n            {/* Mobile Menu Button */}\n            <Button\n              variant=\"ghost\"\n              size=\"sm\"\n              className=\"md:hidden text-df-fog hover:text-df-cyan p-2\"\n              onClick={() => setMobileMenuOpen(!mobileMenuOpen)}\n              data-testid=\"button-mobile-menu\"\n            >\n              {mobileMenuOpen ? <X className=\"h-5 w-5\" /> : <Menu className=\"h-5 w-5\" />}\n            </Button>\n          </div>\n        </div>\n\n        {/* Mobile Navigation */}\n        {mobileMenuOpen && (\n          <div className=\"md:hidden py-4 border-t border-df-steel\">\n            <nav className=\"space-y-2\">\n              {navItems.map((item) => (\n                <Link\n                  key={item.path}\n                  href={item.path}\n                  onClick={() => setMobileMenuOpen(false)}\n                  className={`flex items-center space-x-3 px-3 py-2 rounded-md transition-colors ${\n                    isCurrentPath(item.path)\n                      ? 'text-df-cyan bg-df-cyan bg-opacity-10 border-l-4 border-df-cyan'\n                      : 'text-df-fog hover:text-df-cyan hover:bg-df-steel hover:bg-opacity-20'\n                  }`}\n                  data-testid={`mobile-nav-${item.label.toLowerCase()}`}\n                >\n                  <item.icon className=\"h-5 w-5\" />\n                  <span>{item.label}</span>\n                </Link>\n              ))}\n            </nav>\n          </div>\n        )}\n      </div>\n    </header>\n  );\n}\n","size_bytes":11545},"client/src/components/ui/radio-group.tsx":{"content":"import * as React from \"react\"\nimport * as RadioGroupPrimitive from \"@radix-ui/react-radio-group\"\nimport { Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst RadioGroup = React.forwardRef<\n  React.ElementRef<typeof RadioGroupPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof RadioGroupPrimitive.Root>\n>(({ className, ...props }, ref) => {\n  return (\n    <RadioGroupPrimitive.Root\n      className={cn(\"grid gap-2\", className)}\n      {...props}\n      ref={ref}\n    />\n  )\n})\nRadioGroup.displayName = RadioGroupPrimitive.Root.displayName\n\nconst RadioGroupItem = React.forwardRef<\n  React.ElementRef<typeof RadioGroupPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof RadioGroupPrimitive.Item>\n>(({ className, ...props }, ref) => {\n  return (\n    <RadioGroupPrimitive.Item\n      ref={ref}\n      className={cn(\n        \"aspect-square h-4 w-4 rounded-full border border-primary text-primary ring-offset-background focus:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50\",\n        className\n      )}\n      {...props}\n    >\n      <RadioGroupPrimitive.Indicator className=\"flex items-center justify-center\">\n        <Circle className=\"h-2.5 w-2.5 fill-current text-current\" />\n      </RadioGroupPrimitive.Indicator>\n    </RadioGroupPrimitive.Item>\n  )\n})\nRadioGroupItem.displayName = RadioGroupPrimitive.Item.displayName\n\nexport { RadioGroup, RadioGroupItem }\n","size_bytes":1467},"server/routes.ts":{"content":"import type { Express } from \"express\";\nimport { createServer, type Server } from \"http\";\nimport { WebSocketServer } from \"ws\";\nimport { storage } from \"./storage\";\nimport { logger } from \"./logger\";\nimport { healthEndpoints } from \"./health\";\nimport { authService, registerSchema, loginSchema, forgotPasswordSchema, resetPasswordSchema, forgotEmailSchema } from \"./auth\";\nimport { paymentService } from \"./services/paymentService\";\nimport { moderationService } from \"./services/moderationService\";\nimport { notificationService } from \"./services/notificationService\";\nimport { apiGatewayService } from \"./services/apiGatewayService\";\nimport { aiWikiService } from \"./services/aiWikiService\";\nimport { objectStorageService } from \"./services/objectStorage\";\nimport { \n  createTicketSchema,\n  verifyTransactionSchema,\n  requestRefundSchema,\n  reviewRefundSchema,\n  createPaymentMethodSchema,\n  storyMoments,\n} from \"@shared/schema\";\nimport multer from 'multer';\nimport { db } from \"./db\";\nimport { eq } from \"drizzle-orm\";\nimport { authenticateJWT, requireCreator, requireAdmin, requireAuth, optionalAuth, verifyOwnership } from \"./middleware/auth\";\nimport { globalRateLimit, authRateLimit, apiRateLimit, uploadRateLimit } from \"./middleware/rateLimit\";\nimport { csrfProtection, getCSRFToken } from \"./middleware/csrf\";\nimport { \n  validate, \n  profileUpdateSchema, \n  messageSchema, \n  payoutAccountSchema, \n  idParamSchema, \n  createPostSchema, \n  updatePostSchema, \n  creatorIdParamSchema, \n  paginationSchema, \n  createStorySchema, \n  addXPSchema,\n  deployNftContractSchema,\n  mintNftSchema,\n  recordNftRoyaltySchema,\n  createLoanProgramSchema,\n  createLoanApplicationSchema,\n  createLoanOfferSchema,\n  payLoanRepaymentSchema,\n  createAiScanJobSchema,\n  createContentFingerprintSchema,\n  reviewAiScanResultSchema,\n  verifyContentFingerprintSchema,\n  creatorIdPathParamSchema,\n  lenderIdPathParamSchema,\n  mediaIdPathParamSchema,\n  contractIdPathParamSchema,\n  jobIdPathParamSchema,\n  offerIdPathParamSchema,\n} from \"./middleware/validation\";\nimport { z } from \"zod\";\n\nexport async function registerRoutes(app: Express): Promise<Server> {\n  // Global middleware\n  app.use(globalRateLimit);\n\n  // CSRF protection for non-GET requests\n  app.use(csrfProtection.middleware());\n\n  // Health endpoints (no auth required)\n  app.get(\"/api/health\", healthEndpoints.basic);\n  app.get(\"/api/health/ready\", healthEndpoints.ready);\n  app.get(\"/api/health/live\", healthEndpoints.live);\n\n\n  // CSRF token endpoint\n  app.get(\"/api/csrf-token\", getCSRFToken);\n\n  // Auth endpoints\n  app.get(\"/api/auth/user\", authenticateJWT, async (req: any, res) => {\n    try {\n      const userId = req.user!.id;\n      const user = await storage.getUser(userId);\n      if (!user) {\n        return res.status(404).json({ message: \"User not found\" });\n      }\n      const profile = await storage.getProfile(userId);\n      res.json({ ...user, profile });\n    } catch (error) {\n      logger.error(`Error fetching user: ${error instanceof Error ? error.message : String(error)}`);\n      res.status(500).json({ message: \"Failed to fetch user\" });\n    }\n  });\n\n  // Local authentication endpoints\n  const signupHandler = async (req: Request, res: Response) => {\n    try {\n      const result = await authService.register(req.body);\n      res.status(201).json(result);\n    } catch (error) {\n      logger.warn(`Registration failed: ${error instanceof Error ? error.message : String(error)}`);\n      res.status(400).json({ message: error instanceof Error ? error.message : \"Registration failed\" });\n    }\n  };\n  \n  app.post(\"/api/auth/register\", authRateLimit, validate({ body: registerSchema }), signupHandler);\n  app.post(\"/api/auth/signup\", authRateLimit, validate({ body: registerSchema }), signupHandler);\n\n  app.post(\"/api/auth/login\", authRateLimit, validate({ body: loginSchema }), async (req, res) => {\n    try {\n      const result = await authService.login(req.body);\n      res.json(result);\n    } catch (error) {\n      logger.warn(`Login failed: ${error instanceof Error ? error.message : String(error)}`);\n      res.status(401).json({ message: \"Invalid credentials\" });\n    }\n  });\n\n  app.post(\"/api/auth/refresh\", authenticateJWT, async (req, res) => {\n    try {\n      const token = await authService.refreshToken(req.user!.id);\n      res.json({ token });\n    } catch (error) {\n      logger.warn(`Token refresh failed: ${error instanceof Error ? error.message : String(error)}`);\n      res.status(401).json({ message: \"Token refresh failed\" });\n    }\n  });\n\n  // Password reset endpoints\n  app.post(\"/api/auth/forgot-password\", authRateLimit, validate({ body: forgotPasswordSchema }), async (req, res) => {\n    try {\n      const result = await authService.requestPasswordReset(req.body.email);\n      res.json(result);\n    } catch (error) {\n      logger.error(`Forgot password failed: ${error instanceof Error ? error.message : String(error)}`);\n      res.status(500).json({ message: \"Failed to process password reset request\" });\n    }\n  });\n\n  app.post(\"/api/auth/reset-password\", authRateLimit, validate({ body: resetPasswordSchema }), async (req, res) => {\n    try {\n      await authService.resetPassword(req.body.token, req.body.password);\n      res.json({ message: \"Password has been reset successfully\" });\n    } catch (error) {\n      logger.warn(`Password reset failed: ${error instanceof Error ? error.message : String(error)}`);\n      res.status(400).json({ message: error instanceof Error ? error.message : \"Failed to reset password\" });\n    }\n  });\n\n  // Email recovery endpoint\n  app.post(\"/api/auth/forgot-email\", authRateLimit, validate({ body: forgotEmailSchema }), async (req, res) => {\n    try {\n      const result = await authService.requestEmailRecovery(req.body.username);\n      res.json(result);\n    } catch (error) {\n      logger.error(`Email recovery failed: ${error instanceof Error ? error.message : String(error)}`);\n      res.status(500).json({ message: \"Failed to process email recovery request\" });\n    }\n  });\n\n  // Profile endpoints\n  app.get(\"/api/profile\", authenticateJWT, async (req: any, res) => {\n    try {\n      const userId = req.user!.id;\n      let profile = await storage.getProfile(userId);\n      \n      // Auto-create profile if it doesn't exist for authenticated users\n      if (!profile) {\n        const user = await storage.getUser(userId);\n        if (user) {\n          profile = await storage.createProfile({\n            userId: userId,\n            displayName: user.displayName || `${req.user!.firstName || ''} ${req.user!.lastName || ''}`.trim() || user.email?.split('@')[0] || 'User',\n            bio: '',\n            subscriptionPrice: '9.99'\n          });\n        }\n      }\n      \n      if (!profile) {\n        return res.status(404).json({ message: \"Profile not found\" });\n      }\n      res.json(profile);\n    } catch (error) {\n      logger.error(`Error fetching profile: ${error instanceof Error ? error.message : String(error)}`);\n      res.status(500).json({ message: \"Failed to fetch profile\" });\n    }\n  });\n\n  app.put(\"/api/profile\", authenticateJWT, validate({ body: profileUpdateSchema }), async (req: any, res) => {\n    try {\n      const userId = req.user!.id;\n      const profile = await storage.updateProfile(userId, req.body);\n      res.json(profile);\n    } catch (error) {\n      logger.error(`Error updating profile: ${error instanceof Error ? error.message : String(error)}`);\n      res.status(500).json({ message: \"Failed to update profile\" });\n    }\n  });\n\n  // Media endpoints\n  app.get(\"/api/media\", authenticateJWT, async (req: any, res) => {\n    try {\n      const userId = req.user!.id;\n      const media = await storage.getMediaAssets(userId);\n      res.json(media);\n    } catch (error) {\n      logger.error(`Error fetching media: ${error instanceof Error ? error.message : String(error)}`);\n      res.status(500).json({ message: \"Failed to fetch media\" });\n    }\n  });\n\n  // Configure multer for file uploads\n  const upload = multer({\n    storage: multer.memoryStorage(),\n    limits: {\n      fileSize: 500 * 1024 * 1024, // 500MB limit\n    },\n    fileFilter: (req, file, cb) => {\n      const allowedTypes = [\n        'image/jpeg', 'image/png', 'image/gif', 'image/webp',\n        'video/mp4', 'video/webm', 'video/mov', 'video/avi'\n      ];\n      \n      if (allowedTypes.includes(file.mimetype)) {\n        cb(null, true);\n      } else {\n        cb(new Error(`File type ${file.mimetype} not allowed`), false);\n      }\n    }\n  });\n\n  app.post(\"/api/media\", authenticateJWT, uploadRateLimit, upload.single('file'), async (req: any, res) => {\n    try {\n      const userId = req.user!.id;\n      \n      if (!req.file) {\n        return res.status(400).json({ message: \"No file uploaded\" });\n      }\n\n      // Temporarily bypass configuration check for testing\n      if (!objectStorageService.isConfigured()) {\n        logger.warn('Object storage not fully configured, but attempting upload anyway');\n      }\n\n      // Upload file to object storage\n      const uploadResult = await objectStorageService.uploadPrivateFile(\n        req.file.buffer,\n        req.file.originalname,\n        req.file.mimetype,\n        userId\n      );\n\n      // Create media asset record\n      const mediaData = {\n        ownerId: userId,\n        title: req.body.title || req.file.originalname,\n        description: req.body.description || '',\n        mimeType: req.file.mimetype,\n        fileSize: req.file.size,\n        s3Key: uploadResult.key,\n        url: uploadResult.url,\n        price: req.body.price ? parseFloat(req.body.price) : undefined,\n        isPremium: req.body.isPremium === 'true',\n        status: 'pending' as const,\n      };\n\n      const media = await storage.createMediaAsset(mediaData);\n      \n      // Start moderation process\n      await moderationService.moderateContent(media.id, {\n        mimeType: media.mimeType!,\n        fileSize: media.fileSize || 0,\n        ownerId: userId,\n        title: media.title,\n        description: media.description,\n      });\n\n      res.status(201).json(media);\n    } catch (error) {\n      logger.error(`Error creating media: ${error instanceof Error ? error.message : String(error)}`);\n      res.status(500).json({ message: \"Failed to create media\" });\n    }\n  });\n\n  // File serving endpoint for private media\n  app.get(\"/api/media/file/:key(*)\", authenticateJWT, async (req: any, res) => {\n    try {\n      const { key } = req.params;\n      const userId = req.user!.id;\n      \n      // Get media asset to verify ownership/access\n      const media = await storage.getMediaAssets(userId);\n      const allowedFile = media.find(m => m.s3Key === key);\n      \n      if (!allowedFile) {\n        return res.status(404).json({ message: \"File not found\" });\n      }\n\n      // Get file from object storage\n      const fileBuffer = await objectStorageService.getPrivateFile(key);\n      \n      if (!fileBuffer) {\n        return res.status(404).json({ message: \"File not found\" });\n      }\n\n      // Set proper content type and headers\n      res.setHeader('Content-Type', allowedFile.mimeType || 'application/octet-stream');\n      res.setHeader('Content-Length', fileBuffer.length);\n      res.setHeader('Cache-Control', 'private, max-age=3600');\n      \n      res.send(fileBuffer);\n    } catch (error) {\n      logger.error(`Error serving file: ${error instanceof Error ? error.message : String(error)}`);\n      res.status(500).json({ message: \"Failed to serve file\" });\n    }\n  });\n\n  // Moderation endpoints (admin only)\n  app.get(\"/api/moderation/queue\", requireAdmin, async (req, res) => {\n    try {\n      const queue = await storage.getModerationQueue();\n      res.json(queue);\n    } catch (error) {\n      logger.error(`Error fetching moderation queue: ${error instanceof Error ? error.message : String(error)}`);\n      res.status(500).json({ message: \"Failed to fetch moderation queue\" });\n    }\n  });\n\n  app.put(\"/api/moderation/:id\", requireAdmin, validate({ params: idParamSchema }), async (req, res) => {\n    try {\n      const { id } = req.params;\n      const { decision, notes } = req.body;\n      const reviewerId = req.user!.id;\n      \n      await moderationService.processHumanReview(id, decision, reviewerId, notes);\n      res.json({ message: \"Review processed successfully\" });\n    } catch (error) {\n      logger.error(`Error processing moderation review: ${error instanceof Error ? error.message : String(error)}`);\n      res.status(500).json({ message: \"Failed to process review\" });\n    }\n  });\n\n  // Get moderation statistics\n  app.get(\"/api/moderation/stats\", requireAdmin, async (req, res) => {\n    try {\n      const stats = await moderationService.getModerationStats();\n      res.json(stats);\n    } catch (error) {\n      logger.error(`Error fetching moderation stats: ${error instanceof Error ? error.message : String(error)}`);\n      res.status(500).json({ message: \"Failed to fetch moderation statistics\" });\n    }\n  });\n\n  // Get moderation configuration\n  app.get(\"/api/moderation/config\", requireAdmin, async (req, res) => {\n    try {\n      const config = moderationService.getModerationConfig();\n      res.json(config);\n    } catch (error) {\n      logger.error(`Error fetching moderation config: ${error instanceof Error ? error.message : String(error)}`);\n      res.status(500).json({ message: \"Failed to fetch moderation configuration\" });\n    }\n  });\n\n  // Update moderation configuration\n  app.put(\"/api/moderation/config\", requireAdmin, async (req, res) => {\n    try {\n      const updates = req.body;\n      moderationService.updateModerationRules(updates);\n      res.json({ message: \"Moderation configuration updated successfully\" });\n    } catch (error) {\n      logger.error(`Error updating moderation config: ${error instanceof Error ? error.message : String(error)}`);\n      res.status(500).json({ message: \"Failed to update moderation configuration\" });\n    }\n  });\n\n  // Payment endpoints\n  app.get(\"/api/payments/accounts\", requireCreator, async (req, res) => {\n    try {\n      const userId = req.user!.id;\n      const accounts = await storage.getPayoutAccounts(userId);\n      res.json(accounts);\n    } catch (error) {\n      logger.error(`Error fetching payout accounts: ${error instanceof Error ? error.message : String(error)}`);\n      res.status(500).json({ message: \"Failed to fetch payout accounts\" });\n    }\n  });\n\n  app.post(\"/api/payments/accounts\", requireCreator, validate({ body: payoutAccountSchema }), async (req, res) => {\n    try {\n      const userId = req.user!.id;\n      const accountData = {\n        ...req.body,\n        userId,\n      };\n      const account = await storage.createPayoutAccount(accountData);\n      res.status(201).json(account);\n    } catch (error) {\n      logger.error(`Error creating payout account: ${error instanceof Error ? error.message : String(error)}`);\n      res.status(500).json({ message: \"Failed to create payout account\" });\n    }\n  });\n\n  app.post(\"/api/payments/payout\", requireCreator, async (req, res) => {\n    try {\n      const userId = req.user!.id;\n      const { amount } = req.body;\n      \n      const result = await paymentService.processCreatorPayout(userId, amount);\n      res.json(result);\n    } catch (error) {\n      logger.error(`Error processing payout: ${error instanceof Error ? error.message : String(error)}`);\n      res.status(500).json({ message: \"Failed to process payout\" });\n    }\n  });\n\n  // Payment webhooks (no auth required)\n  app.post(\"/api/webhooks/:provider\", async (req, res) => {\n    try {\n      const { provider } = req.params;\n      await paymentService.handleWebhook(provider, req.body);\n      res.status(200).json({ message: \"Webhook processed\" });\n    } catch (error) {\n      logger.error(`Error processing webhook from ${req.params.provider}: ${error instanceof Error ? error.message : String(error)}`);\n      res.status(500).json({ message: \"Failed to process webhook\" });\n    }\n  });\n\n  // Messaging endpoints\n  // Get conversations list\n  app.get(\"/api/messages/conversations\", requireAuth, async (req, res) => {\n    try {\n      const userId = req.user!.id;\n      const conversations = await storage.getConversations(userId);\n      res.json(conversations);\n    } catch (error) {\n      logger.error(`Error fetching conversations: ${error instanceof Error ? error.message : String(error)}`);\n      res.status(500).json({ message: \"Failed to fetch conversations\" });\n    }\n  });\n\n  app.get(\"/api/messages/:userId\", requireAuth, async (req, res) => {\n    try {\n      const currentUserId = req.user!.id;\n      const { userId } = req.params;\n      const messages = await storage.getMessages(currentUserId, userId);\n      res.json(messages);\n    } catch (error) {\n      logger.error(`Error fetching messages: ${error instanceof Error ? error.message : String(error)}`);\n      res.status(500).json({ message: \"Failed to fetch messages\" });\n    }\n  });\n\n  app.post(\"/api/messages\", requireAuth, validate({ body: messageSchema }), async (req, res) => {\n    try {\n      const senderId = req.user!.id;\n      const messageData = {\n        ...req.body,\n        senderId,\n      };\n      const message = await storage.createMessage(messageData);\n\n      // Broadcast message via WebSocket if connected\n      if (global.wsClients) {\n        const wsMessage = {\n          type: \"new_message\",\n          data: message,\n          timestamp: Date.now()\n        };\n        \n        // Send to recipient if connected\n        global.wsClients.forEach((client: any, userId: string) => {\n          if (userId === req.body.recipientId && client.readyState === 1) {\n            client.send(JSON.stringify(wsMessage));\n          }\n        });\n      }\n      \n      // Send push notification to recipient\n      await notificationService.notifyNewMessage(req.body.recipientId, req.user!.firstName || \"Someone\");\n      \n      res.status(201).json(message);\n    } catch (error) {\n      logger.error(`Error sending message: ${error instanceof Error ? error.message : String(error)}`);\n      res.status(500).json({ message: \"Failed to send message\" });\n    }\n  });\n\n  // Mark message as read\n  app.patch(\"/api/messages/:messageId/read\", requireAuth, validate({ params: idParamSchema }), async (req, res) => {\n    try {\n      const { messageId } = req.params;\n      const userId = req.user!.id;\n      \n      await storage.markMessageAsRead(messageId, userId);\n      res.json({ message: \"Message marked as read\" });\n    } catch (error) {\n      logger.error(`Error marking message as read: ${error instanceof Error ? error.message : String(error)}`);\n      res.status(500).json({ message: \"Failed to mark message as read\" });\n    }\n  });\n\n  // AI Wiki endpoints\n  app.get(\"/api/wiki/popular\", async (req, res) => {\n    try {\n      const popularArticles = await aiWikiService.getPopularArticles();\n      res.json(popularArticles);\n    } catch (error) {\n      logger.error(`Error fetching popular articles: ${error instanceof Error ? error.message : String(error)}`);\n      res.status(500).json({ message: \"Failed to fetch popular articles\" });\n    }\n  });\n\n  app.get(\"/api/wiki/categories\", async (req, res) => {\n    try {\n      const categories = await aiWikiService.getAllCategories();\n      res.json(categories);\n    } catch (error) {\n      logger.error(`Error fetching categories: ${error instanceof Error ? error.message : String(error)}`);\n      res.status(500).json({ message: \"Failed to fetch categories\" });\n    }\n  });\n\n  app.post(\"/api/wiki/search\", requireAuth, async (req, res) => {\n    try {\n      const { query } = req.body;\n      const userId = req.user!.id;\n      \n      if (!query || typeof query !== \"string\") {\n        return res.status(400).json({ message: \"Search query is required\" });\n      }\n\n      const results = await aiWikiService.searchKnowledge(query, userId);\n      res.json(results);\n    } catch (error) {\n      logger.error(`Error searching wiki: ${error instanceof Error ? error.message : String(error)}`);\n      res.status(500).json({ message: \"Failed to search wiki\" });\n    }\n  });\n\n  app.post(\"/api/wiki/ask\", requireAuth, async (req, res) => {\n    try {\n      const { question } = req.body;\n      const userId = req.user!.id;\n      \n      if (!question || typeof question !== \"string\") {\n        return res.status(400).json({ message: \"Question is required\" });\n      }\n\n      const answer = await aiWikiService.generateAnswer(question, userId);\n      res.json({ answer });\n    } catch (error) {\n      logger.error(`Error generating AI answer: ${error instanceof Error ? error.message : String(error)}`);\n      res.status(500).json({ message: \"Failed to generate answer\" });\n    }\n  });\n\n  app.get(\"/api/wiki/article/:id\", async (req, res) => {\n    try {\n      const { id } = req.params;\n      const article = await aiWikiService.getArticleById(id);\n      \n      if (!article) {\n        return res.status(404).json({ message: \"Article not found\" });\n      }\n\n      const relatedArticles = await aiWikiService.suggestRelatedArticles(id);\n      res.json({ article, relatedArticles });\n    } catch (error) {\n      logger.error(`Error fetching article: ${error instanceof Error ? error.message : String(error)}`);\n      res.status(500).json({ message: \"Failed to fetch article\" });\n    }\n  });\n\n  // Onboarding endpoints\n  app.get(\"/api/onboarding/progress\", requireAuth, async (req, res) => {\n    try {\n      const userId = req.user!.id;\n      let progress = await storage.getOnboardingProgress(userId!);\n      \n      // Auto-create onboarding progress if it doesn't exist\n      if (!progress) {\n        progress = await storage.createOnboardingProgress(userId!);\n      }\n      \n      res.json(progress);\n    } catch (error) {\n      logger.error(`Error fetching onboarding progress: ${error instanceof Error ? error.message : String(error)}`);\n      res.status(500).json({ message: \"Failed to fetch onboarding progress\" });\n    }\n  });\n\n  app.post(\"/api/onboarding/select-role\", requireAuth, async (req, res) => {\n    try {\n      const userId = req.user!.id;\n      const { role } = req.body;\n      \n      if (!role || !['creator', 'fan'].includes(role)) {\n        return res.status(400).json({ message: \"Invalid role. Must be 'creator' or 'fan'\" });\n      }\n\n      // Update user role\n      await storage.updateUser(userId!, { role });\n\n      // Update onboarding progress\n      let progress = await storage.getOnboardingProgress(userId!);\n      if (!progress) {\n        progress = await storage.createOnboardingProgress(userId!);\n      }\n\n      progress = await storage.updateOnboardingProgress(userId!, {\n        roleSelected: role,\n        currentStep: 'profile_setup',\n      });\n\n      res.json({ progress, role });\n    } catch (error) {\n      logger.error(`Error selecting role: ${error instanceof Error ? error.message : String(error)}`);\n      res.status(500).json({ message: \"Failed to select role\" });\n    }\n  });\n\n  app.post(\"/api/onboarding/setup-profile\", requireAuth, async (req, res) => {\n    try {\n      const userId = req.user!.id;\n      const { displayName, stageName, pronouns, bio, avatarUrl, bannerUrl } = req.body;\n\n      // Update profile\n      const profile = await storage.updateProfile(userId!, {\n        displayName,\n        stageName,\n        pronouns,\n        bio,\n        avatarUrl,\n        bannerUrl,\n      });\n\n      // Update onboarding progress\n      const progress = await storage.updateOnboardingProgress(userId!, {\n        profileSetupComplete: true,\n        currentStep: 'interests_selection',\n      });\n\n      res.json({ profile, progress });\n    } catch (error) {\n      logger.error(`Error setting up profile: ${error instanceof Error ? error.message : String(error)}`);\n      res.status(500).json({ message: \"Failed to set up profile\" });\n    }\n  });\n\n  app.post(\"/api/onboarding/select-interests\", requireAuth, async (req, res) => {\n    try {\n      const userId = req.user!.id;\n      const { nicheIds } = req.body;\n\n      if (!Array.isArray(nicheIds)) {\n        return res.status(400).json({ message: \"nicheIds must be an array\" });\n      }\n\n      // Save user interests\n      await storage.setUserInterests(userId!, nicheIds);\n\n      // Update onboarding progress\n      const progress = await storage.updateOnboardingProgress(userId!, {\n        interestsSelected: true,\n        currentStep: 'verification',\n      });\n\n      res.json({ progress });\n    } catch (error) {\n      logger.error(`Error selecting interests: ${error instanceof Error ? error.message : String(error)}`);\n      res.status(500).json({ message: \"Failed to select interests\" });\n    }\n  });\n\n  app.post(\"/api/onboarding/complete\", requireAuth, async (req, res) => {\n    try {\n      const userId = req.user!.id;\n\n      // Mark onboarding as complete\n      const progress = await storage.updateOnboardingProgress(userId!, {\n        onboardingComplete: true,\n        currentStep: 'completed',\n      });\n\n      res.json({ progress });\n    } catch (error) {\n      logger.error(`Error completing onboarding: ${error instanceof Error ? error.message : String(error)}`);\n      res.status(500).json({ message: \"Failed to complete onboarding\" });\n    }\n  });\n\n  app.get(\"/api/niches\", async (req, res) => {\n    try {\n      const niches = await storage.getContentNiches();\n      res.json(niches);\n    } catch (error) {\n      logger.error(`Error fetching niches: ${error instanceof Error ? error.message : String(error)}`);\n      res.status(500).json({ message: \"Failed to fetch niches\" });\n    }\n  });\n\n  // Feed endpoints (Infinity Scroll)\n  app.get(\"/api/feed\", optionalAuth, apiRateLimit, validate({ query: paginationSchema }), async (req, res) => {\n    try {\n      const { page, limit } = req.query as { page: number; limit: number };\n      const userId = req.user!.id;\n      \n      const posts = await storage.getPosts({ page, limit, userId });\n      res.json(posts);\n    } catch (error) {\n      logger.error(`Error fetching feed: ${error instanceof Error ? error.message : String(error)}`);\n      res.status(500).json({ message: \"Failed to fetch feed\" });\n    }\n  });\n\n  app.get(\"/api/posts/:id\", apiRateLimit, validate({ params: idParamSchema }), async (req, res) => {\n    try {\n      const post = await storage.getPostById(req.params.id);\n      if (!post) {\n        return res.status(404).json({ message: \"Post not found\" });\n      }\n      res.json(post);\n    } catch (error) {\n      logger.error(`Error fetching post: ${error instanceof Error ? error.message : String(error)}`);\n      res.status(500).json({ message: \"Failed to fetch post\" });\n    }\n  });\n\n  app.post(\"/api/posts\", requireAuth, requireCreator, apiRateLimit, validate({ body: createPostSchema }), async (req, res) => {\n    try {\n      const userId = req.user!.id;\n      const postData = {\n        ...req.body,\n        creatorId: userId,\n      };\n      \n      const post = await storage.createPost(postData);\n      \n      // Log post creation\n      await storage.createAuditLog({\n        actorId: userId,\n        action: 'post_created',\n        targetType: 'post',\n        targetId: post.id,\n        ipAddress: req.ip,\n        userAgent: req.headers['user-agent'],\n      });\n      \n      res.status(201).json(post);\n    } catch (error) {\n      logger.error(`Error creating post: ${error instanceof Error ? error.message : String(error)}`);\n      res.status(500).json({ message: \"Failed to create post\" });\n    }\n  });\n\n  app.put(\"/api/posts/:id\", requireAuth, requireCreator, apiRateLimit, validate({ params: idParamSchema, body: updatePostSchema }), async (req, res) => {\n    try {\n      const post = await storage.getPostById(req.params.id);\n      if (!post) {\n        return res.status(404).json({ message: \"Post not found\" });\n      }\n      \n      const userId = req.user!.id;\n      if (post.creatorId !== userId) {\n        return res.status(403).json({ message: \"Not authorized to edit this post\" });\n      }\n      \n      const updatedPost = await storage.updatePost(req.params.id, req.body);\n      res.json(updatedPost);\n    } catch (error) {\n      logger.error(`Error updating post: ${error instanceof Error ? error.message : String(error)}`);\n      res.status(500).json({ message: \"Failed to update post\" });\n    }\n  });\n\n  // Post Like endpoints\n  app.post(\"/api/posts/:id/like\", requireAuth, apiRateLimit, validate({ params: idParamSchema }), async (req, res) => {\n    try {\n      const userId = req.user!.id;\n      const result = await storage.togglePostLike(userId, req.params.id);\n      res.json(result);\n    } catch (error) {\n      logger.error(`Error toggling like: ${error instanceof Error ? error.message : String(error)}`);\n      res.status(500).json({ message: \"Failed to toggle like\" });\n    }\n  });\n\n  app.get(\"/api/posts/:id/liked\", requireAuth, apiRateLimit, validate({ params: idParamSchema }), async (req, res) => {\n    try {\n      const userId = req.user!.id;\n      const liked = await storage.isPostLikedByUser(userId, req.params.id);\n      res.json({ liked });\n    } catch (error) {\n      logger.error(`Error checking like status: ${error instanceof Error ? error.message : String(error)}`);\n      res.status(500).json({ message: \"Failed to check like status\" });\n    }\n  });\n\n  // Post Comment endpoints\n  app.get(\"/api/posts/:id/comments\", apiRateLimit, validate({ params: idParamSchema }), async (req, res) => {\n    try {\n      const comments = await storage.getPostComments(req.params.id);\n      res.json(comments);\n    } catch (error) {\n      logger.error(`Error fetching comments: ${error instanceof Error ? error.message : String(error)}`);\n      res.status(500).json({ message: \"Failed to fetch comments\" });\n    }\n  });\n\n  app.post(\"/api/posts/:id/comments\", requireAuth, apiRateLimit, validate({ params: idParamSchema, body: z.object({ text: z.string().min(1).max(2000) }) }), async (req, res) => {\n    try {\n      const userId = req.user!.id;\n      const { text } = req.body;\n      const comment = await storage.addComment(userId, req.params.id, text);\n      res.status(201).json(comment);\n    } catch (error) {\n      logger.error(`Error adding comment: ${error instanceof Error ? error.message : String(error)}`);\n      res.status(500).json({ message: \"Failed to add comment\" });\n    }\n  });\n\n  // Follow endpoints\n  app.post(\"/api/follow/:creatorId\", requireAuth, apiRateLimit, validate({ params: creatorIdParamSchema }), async (req, res) => {\n    try {\n      const userId = req.user!.id;\n      const { creatorId } = req.params;\n      \n      // Check if already following\n      const isFollowing = await storage.isFollowing(userId, creatorId);\n      if (isFollowing) {\n        return res.status(400).json({ message: \"Already following this creator\" });\n      }\n      \n      const follow = await storage.followCreator(userId, creatorId);\n      res.status(201).json(follow);\n    } catch (error) {\n      logger.error(`Error following creator: ${error instanceof Error ? error.message : String(error)}`);\n      res.status(500).json({ message: \"Failed to follow creator\" });\n    }\n  });\n\n  app.delete(\"/api/follow/:creatorId\", requireAuth, apiRateLimit, validate({ params: creatorIdParamSchema }), async (req, res) => {\n    try {\n      const userId = req.user!.id;\n      const { creatorId } = req.params;\n      \n      await storage.unfollowCreator(userId, creatorId);\n      res.status(204).send();\n    } catch (error) {\n      logger.error(`Error unfollowing creator: ${error instanceof Error ? error.message : String(error)}`);\n      res.status(500).json({ message: \"Failed to unfollow creator\" });\n    }\n  });\n\n  app.get(\"/api/following\", requireAuth, apiRateLimit, async (req, res) => {\n    try {\n      const userId = req.user!.id;\n      const following = await storage.getFollowing(userId);\n      res.json(following);\n    } catch (error) {\n      logger.error(`Error fetching following: ${error instanceof Error ? error.message : String(error)}`);\n      res.status(500).json({ message: \"Failed to fetch following\" });\n    }\n  });\n\n  // Story Moment endpoints\n  app.get(\"/api/stories\", optionalAuth, apiRateLimit, async (req, res) => {\n    try {\n      const userId = req.user!.id;\n      const stories = await storage.getActiveStories(userId);\n      res.json(stories);\n    } catch (error) {\n      logger.error(`Error fetching stories: ${error instanceof Error ? error.message : String(error)}`);\n      res.status(500).json({ message: \"Failed to fetch stories\" });\n    }\n  });\n\n  app.get(\"/api/stories/creator/:creatorId\", optionalAuth, apiRateLimit, async (req, res) => {\n    try {\n      const { creatorId } = req.params;\n      const stories = await storage.getCreatorStories(creatorId);\n      res.json(stories);\n    } catch (error) {\n      logger.error(`Error fetching creator stories: ${error instanceof Error ? error.message : String(error)}`);\n      res.status(500).json({ message: \"Failed to fetch creator stories\" });\n    }\n  });\n\n  app.post(\"/api/stories\", requireAuth, requireCreator, apiRateLimit, validate({ body: createStorySchema }), async (req, res) => {\n    try {\n      const userId = req.user!.id;\n      const { mediaUrl, mediaType, mediaThumbnailUrl, caption, isFree, requiresSubscription } = req.body;\n      \n      // Set expiration to 24 hours from now\n      const expiresAt = new Date(Date.now() + 24 * 60 * 60 * 1000);\n      \n      const storyData = {\n        creatorId: userId,\n        mediaUrl,\n        mediaType,\n        mediaThumbnailUrl,\n        caption,\n        isFree,\n        requiresSubscription,\n        expiresAt,\n      };\n      \n      const story = await storage.createStory(storyData);\n      \n      // Log story creation\n      await storage.createAuditLog({\n        actorId: userId,\n        action: 'story_created',\n        targetType: 'story',\n        targetId: story.id,\n        ipAddress: req.ip,\n        userAgent: req.headers['user-agent'],\n      });\n      \n      res.status(201).json(story);\n    } catch (error) {\n      logger.error(`Error creating story: ${error instanceof Error ? error.message : String(error)}`);\n      res.status(500).json({ message: \"Failed to create story\" });\n    }\n  });\n\n  app.post(\"/api/stories/:id/view\", requireAuth, apiRateLimit, async (req, res) => {\n    try {\n      const userId = req.user!.id;\n      const { id } = req.params;\n      \n      await storage.viewStory(id, userId);\n      res.status(204).send();\n    } catch (error) {\n      logger.error(`Error viewing story: ${error instanceof Error ? error.message : String(error)}`);\n      res.status(500).json({ message: \"Failed to view story\" });\n    }\n  });\n\n  app.get(\"/api/stories/:id/views\", requireAuth, apiRateLimit, validate({ params: idParamSchema }), async (req, res) => {\n    try {\n      const userId = req.user!.id;\n      const { id } = req.params;\n      \n      // Get story to check ownership\n      const story = await db.select().from(storyMoments).where(eq(storyMoments.id, id)).limit(1);\n      if (!story || story.length === 0) {\n        return res.status(404).json({ message: \"Story not found\" });\n      }\n      \n      // Only creator can view their story's views\n      if (story[0].creatorId !== userId) {\n        return res.status(403).json({ message: \"Not authorized to view story analytics\" });\n      }\n      \n      const views = await storage.getStoryViews(id);\n      res.json(views);\n    } catch (error) {\n      logger.error(`Error fetching story views: ${error instanceof Error ? error.message : String(error)}`);\n      res.status(500).json({ message: \"Failed to fetch story views\" });\n    }\n  });\n\n  // Fan Level & Gamification endpoints\n  app.get(\"/api/fan-level\", requireAuth, apiRateLimit, async (req, res) => {\n    try {\n      const userId = req.user!.id;\n      let fanLevel = await storage.getFanLevel(userId);\n      \n      if (!fanLevel) {\n        // Create default fan level if it doesn't exist\n        fanLevel = await storage.createFanLevel({\n          userId,\n          level: 1,\n          xp: 0,\n        });\n      }\n      \n      res.json(fanLevel);\n    } catch (error) {\n      logger.error(`Error fetching fan level: ${error instanceof Error ? error.message : String(error)}`);\n      res.status(500).json({ message: \"Failed to fetch fan level\" });\n    }\n  });\n\n  app.post(\"/api/fan-level/add-xp\", requireAuth, apiRateLimit, validate({ body: addXPSchema }), async (req, res) => {\n    try {\n      const userId = req.user!.id;\n      const { amount, reason } = req.body;\n      \n      const fanLevel = await storage.addXP(userId, amount, reason);\n      res.json(fanLevel);\n    } catch (error) {\n      logger.error(`Error adding XP: ${error instanceof Error ? error.message : String(error)}`);\n      res.status(500).json({ message: \"Failed to add XP\" });\n    }\n  });\n\n  app.post(\"/api/fan-level/update-streak\", requireAuth, apiRateLimit, async (req, res) => {\n    try {\n      const userId = req.user!.id;\n      const fanLevel = await storage.updateStreak(userId);\n      res.json(fanLevel);\n    } catch (error) {\n      logger.error(`Error updating streak: ${error instanceof Error ? error.message : String(error)}`);\n      res.status(500).json({ message: \"Failed to update streak\" });\n    }\n  });\n\n  // Creator Analytics endpoints\n  app.get(\"/api/analytics/current\", requireAuth, requireCreator, apiRateLimit, async (req, res) => {\n    try {\n      const userId = req.user!.id;\n      const analytics = await storage.getCurrentAnalytics(userId);\n      res.json(analytics);\n    } catch (error) {\n      logger.error(`Error fetching current analytics: ${error instanceof Error ? error.message : String(error)}`);\n      res.status(500).json({ message: \"Failed to fetch analytics\" });\n    }\n  });\n\n  app.get(\"/api/analytics/:period\", requireAuth, requireCreator, apiRateLimit, async (req, res) => {\n    try {\n      const userId = req.user!.id;\n      const { period } = req.params;\n      const limit = req.query.limit ? parseInt(req.query.limit as string) : 30;\n      \n      if (![\"daily\", \"weekly\", \"monthly\"].includes(period)) {\n        return res.status(400).json({ message: \"Invalid period. Must be daily, weekly, or monthly\" });\n      }\n      \n      const analytics = await storage.getCreatorAnalytics(userId, period as \"daily\" | \"weekly\" | \"monthly\", limit);\n      res.json(analytics);\n    } catch (error) {\n      logger.error(`Error fetching analytics: ${error instanceof Error ? error.message : String(error)}`);\n      res.status(500).json({ message: \"Failed to fetch analytics\" });\n    }\n  });\n\n  app.post(\"/api/analytics/view/:postId\", optionalAuth, apiRateLimit, async (req, res) => {\n    try {\n      const { postId } = req.params;\n      const userId = req.user!.id;\n      await storage.recordView(postId, userId);\n      res.status(204).send();\n    } catch (error) {\n      logger.error(`Error recording view: ${error instanceof Error ? error.message : String(error)}`);\n      res.status(500).json({ message: \"Failed to record view\" });\n    }\n  });\n\n  app.post(\"/api/analytics/like/:postId\", requireAuth, apiRateLimit, async (req, res) => {\n    try {\n      const { postId } = req.params;\n      const userId = req.user!.id;\n      await storage.recordLike(postId, userId);\n      res.status(204).send();\n    } catch (error) {\n      logger.error(`Error recording like: ${error instanceof Error ? error.message : String(error)}`);\n      res.status(500).json({ message: \"Failed to record like\" });\n    }\n  });\n\n  app.post(\"/api/analytics/comment/:postId\", requireAuth, apiRateLimit, async (req, res) => {\n    try {\n      const { postId } = req.params;\n      const userId = req.user!.id;\n      await storage.recordComment(postId, userId);\n      res.status(204).send();\n    } catch (error) {\n      logger.error(`Error recording comment: ${error instanceof Error ? error.message : String(error)}`);\n      res.status(500).json({ message: \"Failed to record comment\" });\n    }\n  });\n\n  // Support ticket endpoints\n  app.get(\"/api/tickets\", requireAuth, async (req, res) => {\n    try {\n      const userId = req.user!.id;\n      const tickets = await storage.getSupportTickets(userId);\n      res.json(tickets);\n    } catch (error) {\n      logger.error(`Error fetching support tickets: ${error instanceof Error ? error.message : String(error)}`);\n      res.status(500).json({ message: \"Failed to fetch support tickets\" });\n    }\n  });\n\n  app.post(\"/api/tickets\", requireAuth, validate({ body: createTicketSchema }), async (req, res) => {\n    try {\n      const userId = req.user!.id;\n      const { title, description, category, priority } = req.body;\n\n      const ticketData = {\n        userId,\n        title: title.trim(),\n        description: description.trim(),\n        category,\n        priority,\n        status: \"open\" as const,\n        createdAt: new Date(),\n        updatedAt: new Date()\n      };\n\n      const ticket = await storage.createSupportTicket(ticketData);\n      res.status(201).json(ticket);\n    } catch (error) {\n      logger.error(`Error creating support ticket: ${error instanceof Error ? error.message : String(error)}`);\n      res.status(500).json({ message: \"Failed to create support ticket\" });\n    }\n  });\n\n  app.patch(\"/api/tickets/:ticketId\", requireAuth, async (req, res) => {\n    try {\n      const { ticketId } = req.params;\n      const userId = req.user!.id;\n      const updates = req.body;\n\n      const updatedTicket = await storage.updateSupportTicket(ticketId, userId, updates);\n      if (!updatedTicket) {\n        return res.status(404).json({ message: \"Ticket not found or access denied\" });\n      }\n\n      res.json(updatedTicket);\n    } catch (error) {\n      logger.error(`Error updating support ticket: ${error instanceof Error ? error.message : String(error)}`);\n      res.status(500).json({ message: \"Failed to update support ticket\" });\n    }\n  });\n\n  // Mobile API endpoints (ClubCentral integration)\n  app.post(\"/api/mobile/auth/login\", authRateLimit, async (req, res) => {\n    try {\n      const result = await authService.login(req.body);\n      res.json(result);\n    } catch (error) {\n      res.status(401).json({ message: \"Invalid credentials\" });\n    }\n  });\n\n  app.post(\"/api/mobile/auth/register\", authRateLimit, async (req, res) => {\n    try {\n      const result = await authService.register(req.body);\n      res.status(201).json(result);\n    } catch (error) {\n      res.status(400).json({ message: error instanceof Error ? error.message : \"Registration failed\" });\n    }\n  });\n\n  app.get(\"/api/mobile/profile\", authenticateJWT, async (req, res) => {\n    try {\n      const userId = req.user!.id;\n      const user = await storage.getUser(userId);\n      const profile = await storage.getProfile(userId);\n      res.json({ ...user, profile });\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to fetch profile\" });\n    }\n  });\n\n  app.post(\"/api/mobile/notifications/register\", authenticateJWT, async (req, res) => {\n    try {\n      const userId = req.user!.id;\n      const { token, platform } = req.body;\n      await notificationService.registerDeviceToken(userId, token, platform);\n      res.json({ message: \"Device token registered\" });\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to register device token\" });\n    }\n  });\n\n  // API Gateway endpoints\n  app.get(\"/api/gateway/health\", async (req, res) => {\n    try {\n      const status = apiGatewayService.getServiceStatus();\n      const cacheStats = apiGatewayService.getCacheStats();\n      res.json({ services: status, cache: cacheStats });\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to get gateway health\" });\n    }\n  });\n\n  app.post(\"/api/gateway/route/:service/*\", apiRateLimit, async (req, res) => {\n    try {\n      const { service } = req.params;\n      const path = req.params[0];\n      \n      const result = await apiGatewayService.routeRequest(service, `/${path}`, {\n        method: req.method,\n        data: req.body,\n      });\n      \n      res.json(result);\n    } catch (error) {\n      logger.error(`Gateway routing failed for service ${req.params.service}: ${error instanceof Error ? error.message : String(error)}`);\n      res.status(503).json({ message: \"Service unavailable\" });\n    }\n  });\n\n  // 🔥 FanzTrust™ Payment & Refund System\n  \n  // Authorization middleware for refund management\n  const requireRefundManager = async (req: any, res: any, next: any) => {\n    try {\n      const userId = req.user!.id;\n      const { id } = req.params;\n      \n      // Load refund request\n      const refundRequest = await storage.getRefundRequest(id);\n      if (!refundRequest) {\n        return res.status(404).json({ message: \"Refund request not found\" });\n      }\n      \n      // Check authorization\n      const user = await storage.getUser(userId);\n      const isAuthorized = user?.role === \"admin\" || \n                          (user?.role === \"creator\" && refundRequest.creatorId === userId);\n      \n      if (!isAuthorized) {\n        return res.status(403).json({ message: \"Not authorized to manage this refund\" });\n      }\n      \n      // Attach refund request to req for handler use\n      req.refundRequest = refundRequest;\n      next();\n    } catch (error) {\n      logger.error(`Authorization check failed: ${error instanceof Error ? error.message : String(error)}`);\n      return res.status(500).json({ message: \"Authorization check failed\" });\n    }\n  };\n  \n  // Transaction verification endpoint\n  app.post(\"/api/fanztrust/verify-transaction\", authenticateJWT, validate({ body: verifyTransactionSchema }), async (req: any, res) => {\n    try {\n      const userId = req.user!.id;\n      const { creatorId, gateway, txid, walletAddress, email } = req.body;\n      \n      // Query transaction from database\n      const transaction = await storage.findTransaction({\n        fanId: userId,\n        creatorId,\n        gateway,\n        txid,\n        walletAddress,\n      });\n      \n      if (!transaction) {\n        return res.json({\n          status: \"not_verified\",\n          active: false,\n          message: \"No matching transaction found\"\n        });\n      }\n      \n      // Check if subscription is active\n      const isActive = transaction.status === \"completed\" && \n                       transaction.subscriptionId !== null;\n      \n      // Audit log\n      await storage.createAuditLog({\n        actorId: userId,\n        action: \"verify_transaction\",\n        targetType: \"transaction\",\n        targetId: transaction.id,\n        metadata: { status: \"verified\", active: isActive },\n        ipAddress: req.ip,\n        userAgent: req.headers['user-agent'],\n      });\n\n      res.json({\n        status: \"verified\",\n        active: isActive,\n        transaction: {\n          id: transaction.id,\n          amount: transaction.amountCents / 100,\n          currency: transaction.currency,\n          createdAt: transaction.createdAt,\n        }\n      });\n    } catch (error) {\n      logger.error(`Transaction verification failed: ${error instanceof Error ? error.message : String(error)}`);\n      res.status(500).json({ message: \"Verification failed\" });\n    }\n  });\n\n  // Request refund endpoint\n  app.post(\"/api/fanztrust/request-refund\", authenticateJWT, validate({ body: requestRefundSchema }), async (req: any, res) => {\n    try {\n      const userId = req.user!.id;\n      const { transactionId, reason, verificationData } = req.body;\n      \n      // Get transaction\n      const transaction = await storage.getTransaction(transactionId);\n      if (!transaction || transaction.fanId !== userId) {\n        return res.status(404).json({ message: \"Transaction not found\" });\n      }\n      \n      // Check if already refunded or requested\n      const existingRefund = await storage.findRefundRequest(transactionId);\n      if (existingRefund) {\n        return res.status(400).json({ message: \"Refund already requested\" });\n      }\n      \n      // Auto-verification logic\n      const autoCheckResult = await storage.performAutoRefundCheck(transaction, {\n        requestTime: new Date(),\n        ipAddress: req.ip,\n        deviceFingerprint: req.headers['x-device-fingerprint'],\n      });\n      \n      // Create refund request\n      const refundRequest = await storage.createRefundRequest({\n        transactionId,\n        fanId: userId,\n        creatorId: transaction.creatorId,\n        reason,\n        verificationData,\n        autoCheckResult,\n        status: autoCheckResult.autoApprove ? \"auto_approved\" : \"pending\",\n      });\n      \n      // Update trust score\n      await storage.updateTrustScore(userId, { refundAttempts: 1 });\n\n      // Audit log\n      await storage.createAuditLog({\n        actorId: userId,\n        action: \"request_refund\",\n        targetType: \"refund_request\",\n        targetId: refundRequest.id,\n        metadata: { transactionId, status: refundRequest.status, reason },\n        ipAddress: req.ip,\n        userAgent: req.headers['user-agent'],\n      });\n      \n      res.json({\n        refundRequest,\n        status: autoCheckResult.autoApprove ? \"auto_approved\" : \"pending_review\",\n        message: autoCheckResult.autoApprove \n          ? \"Refund automatically approved\" \n          : \"Refund request submitted for review\"\n      });\n    } catch (error) {\n      logger.error(`Refund request failed: ${error instanceof Error ? error.message : String(error)}`);\n      res.status(500).json({ message: \"Refund request failed\" });\n    }\n  });\n\n  // Get refund requests (creator view)\n  app.get(\"/api/fanztrust/refund-requests\", authenticateJWT, async (req: any, res) => {\n    try {\n      const userId = req.user!.id;\n      const user = await storage.getUser(userId);\n      \n      let refundRequests;\n      if (user?.role === \"admin\") {\n        // Admin sees all\n        refundRequests = await storage.getAllRefundRequests();\n      } else if (user?.role === \"creator\") {\n        // Creator sees their own\n        refundRequests = await storage.getCreatorRefundRequests(userId);\n      } else {\n        // Fan sees their requests\n        refundRequests = await storage.getFanRefundRequests(userId);\n      }\n      \n      res.json(refundRequests);\n    } catch (error) {\n      logger.error(`Failed to fetch refund requests: ${error instanceof Error ? error.message : String(error)}`);\n      res.status(500).json({ message: \"Failed to fetch refund requests\" });\n    }\n  });\n\n  // Approve refund (creator/admin only)\n  app.post(\"/api/fanztrust/refund-requests/:id/approve\", authenticateJWT, validate({ body: reviewRefundSchema }), requireRefundManager, async (req: any, res) => {\n    try {\n      const userId = req.user!.id;\n      const { id } = req.params;\n      const { notes } = req.body;\n      const refundRequest = req.refundRequest; // Attached by middleware\n      \n      const updated = await storage.updateRefundRequest(id, {\n        status: \"approved\",\n        reviewedBy: userId,\n        reviewNotes: notes,\n      });\n      \n      // Update trust score\n      await storage.updateTrustScore(refundRequest.fanId, { approvedRefunds: 1 });\n\n      // Audit log\n      await storage.createAuditLog({\n        actorId: userId,\n        action: \"approve_refund\",\n        targetType: \"refund_request\",\n        targetId: id,\n        metadata: { fanId: refundRequest.fanId, notes },\n        ipAddress: req.ip,\n        userAgent: req.headers['user-agent'],\n      });\n      \n      res.json(updated);\n    } catch (error) {\n      logger.error(`Failed to approve refund: ${error instanceof Error ? error.message : String(error)}`);\n      res.status(500).json({ message: \"Failed to approve refund\" });\n    }\n  });\n\n  // Deny refund (creator/admin only)\n  app.post(\"/api/fanztrust/refund-requests/:id/deny\", authenticateJWT, validate({ body: reviewRefundSchema }), requireRefundManager, async (req: any, res) => {\n    try {\n      const userId = req.user!.id;\n      const { id } = req.params;\n      const { notes } = req.body;\n      const refundRequest = req.refundRequest; // Attached by middleware\n      \n      const updated = await storage.updateRefundRequest(id, {\n        status: \"denied\",\n        reviewedBy: userId,\n        reviewNotes: notes,\n      });\n      \n      // Update trust score (negative impact for denied refunds)\n      await storage.updateTrustScore(refundRequest.fanId, { deniedRefunds: 1 });\n\n      // Audit log\n      await storage.createAuditLog({\n        actorId: userId,\n        action: \"deny_refund\",\n        targetType: \"refund_request\",\n        targetId: id,\n        metadata: { fanId: refundRequest.fanId, notes },\n        ipAddress: req.ip,\n        userAgent: req.headers['user-agent'],\n      });\n      \n      res.json(updated);\n    } catch (error) {\n      logger.error(`Failed to deny refund: ${error instanceof Error ? error.message : String(error)}`);\n      res.status(500).json({ message: \"Failed to deny refund\" });\n    }\n  });\n\n  // Get user's FanzWallet\n  app.get(\"/api/fanztrust/wallet\", authenticateJWT, async (req: any, res) => {\n    try {\n      const userId = req.user!.id;\n      let wallet = await storage.getFanzWallet(userId);\n      \n      // Auto-create wallet if it doesn't exist\n      if (!wallet) {\n        wallet = await storage.createFanzWallet({ userId });\n      }\n      \n      res.json(wallet);\n    } catch (error) {\n      logger.error(`Failed to fetch wallet: ${error instanceof Error ? error.message : String(error)}`);\n      res.status(500).json({ message: \"Failed to fetch wallet\" });\n    }\n  });\n\n  // Get user's trust score\n  app.get(\"/api/fanztrust/trust-score\", authenticateJWT, async (req: any, res) => {\n    try {\n      const userId = req.user!.id;\n      let trustScore = await storage.getTrustScore(userId);\n      \n      // Auto-create trust score if it doesn't exist\n      if (!trustScore) {\n        trustScore = await storage.createTrustScore({ userId });\n      }\n      \n      res.json(trustScore);\n    } catch (error) {\n      logger.error(`Failed to fetch trust score: ${error instanceof Error ? error.message : String(error)}`);\n      res.status(500).json({ message: \"Failed to fetch trust score\" });\n    }\n  });\n\n  // Get transaction history\n  app.get(\"/api/fanztrust/transactions\", authenticateJWT, async (req: any, res) => {\n    try {\n      const userId = req.user!.id;\n      const { type } = req.query; // 'fan' or 'creator'\n      \n      const transactions = type === \"creator\" \n        ? await storage.getCreatorTransactions(userId)\n        : await storage.getFanTransactions(userId);\n      \n      res.json(transactions);\n    } catch (error) {\n      logger.error(`Failed to fetch transactions: ${error instanceof Error ? error.message : String(error)}`);\n      res.status(500).json({ message: \"Failed to fetch transactions\" });\n    }\n  });\n\n  // Get payment methods\n  app.get(\"/api/fanztrust/payment-methods\", authenticateJWT, async (req: any, res) => {\n    try {\n      const userId = req.user!.id;\n      const paymentMethods = await storage.getPaymentMethods(userId);\n      res.json(paymentMethods);\n    } catch (error) {\n      logger.error(`Failed to fetch payment methods: ${error instanceof Error ? error.message : String(error)}`);\n      res.status(500).json({ message: \"Failed to fetch payment methods\" });\n    }\n  });\n\n  // Add payment method\n  app.post(\"/api/fanztrust/payment-methods\", authenticateJWT, validate({ body: createPaymentMethodSchema }), async (req: any, res) => {\n    try {\n      const userId = req.user!.id;\n      const { type, gateway, reference, displayName, isDefault, metadata } = req.body;\n      \n      const paymentMethod = await storage.createPaymentMethod({\n        userId,\n        type,\n        gateway,\n        reference,\n        displayName,\n        isDefault,\n        metadata,\n      });\n      \n      res.json(paymentMethod);\n    } catch (error) {\n      logger.error(`Failed to add payment method: ${error instanceof Error ? error.message : String(error)}`);\n      res.status(500).json({ message: \"Failed to add payment method\" });\n    }\n  });\n\n  // ===================\n  // Live Streaming Routes\n  // ===================\n\n  // Helper to get user ID from either auth method (JWT or Replit OAuth)\n  const getUserId = (req: any): string => {\n    return req.user?.id;\n  };\n\n  // Create new stream\n  app.post(\"/api/streams\", authenticateJWT, requireCreator, async (req: any, res) => {\n    try {\n      const creatorId = getUserId(req);\n      const { title, description, thumbnailUrl, scheduledStartTime, requiresSubscription, isRecorded } = req.body;\n      \n      const streamKey = `stream_${creatorId}_${Date.now()}`;\n      \n      const stream = await storage.createStream({\n        creatorId,\n        title,\n        description,\n        thumbnailUrl,\n        scheduledStartTime: scheduledStartTime ? new Date(scheduledStartTime) : null,\n        requiresSubscription: requiresSubscription ?? false,\n        isRecorded: isRecorded ?? true,\n        streamKey,\n        status: \"scheduled\",\n      });\n      \n      res.json(stream);\n    } catch (error) {\n      logger.error(`Failed to create stream: ${error instanceof Error ? error.message : String(error)}`);\n      res.status(500).json({ message: \"Failed to create stream\" });\n    }\n  });\n\n  // Get all live streams\n  app.get(\"/api/streams/live\", async (req: any, res) => {\n    try {\n      const limit = req.query.limit ? parseInt(req.query.limit) : 50;\n      const streams = await storage.getLiveStreams(limit);\n      res.json(streams);\n    } catch (error) {\n      logger.error(`Failed to fetch live streams: ${error instanceof Error ? error.message : String(error)}`);\n      res.status(500).json({ message: \"Failed to fetch live streams\" });\n    }\n  });\n\n  // Get creator's streams\n  app.get(\"/api/streams/creator/:creatorId\", async (req: any, res) => {\n    try {\n      const { creatorId } = req.params;\n      const { status } = req.query;\n      const streams = await storage.getCreatorStreams(creatorId, status as any);\n      res.json(streams);\n    } catch (error) {\n      logger.error(`Failed to fetch creator streams: ${error instanceof Error ? error.message : String(error)}`);\n      res.status(500).json({ message: \"Failed to fetch creator streams\" });\n    }\n  });\n\n  // Get stream details\n  app.get(\"/api/streams/:streamId\", async (req: any, res) => {\n    try {\n      const { streamId } = req.params;\n      const stream = await storage.getStream(streamId);\n      \n      if (!stream) {\n        return res.status(404).json({ message: \"Stream not found\" });\n      }\n      \n      res.json(stream);\n    } catch (error) {\n      logger.error(`Failed to fetch stream: ${error instanceof Error ? error.message : String(error)}`);\n      res.status(500).json({ message: \"Failed to fetch stream\" });\n    }\n  });\n\n  // Start stream (go live)\n  app.post(\"/api/streams/:streamId/start\", authenticateJWT, async (req: any, res) => {\n    try {\n      const { streamId } = req.params;\n      const userId = getUserId(req);\n      \n      const stream = await storage.getStream(streamId);\n      if (!stream) {\n        return res.status(404).json({ message: \"Stream not found\" });\n      }\n      \n      if (stream.creatorId !== userId) {\n        return res.status(403).json({ message: \"Not authorized\" });\n      }\n      \n      const updatedStream = await storage.startStream(streamId);\n      res.json(updatedStream);\n    } catch (error) {\n      logger.error(`Failed to start stream: ${error instanceof Error ? error.message : String(error)}`);\n      res.status(500).json({ message: \"Failed to start stream\" });\n    }\n  });\n\n  // End stream\n  app.post(\"/api/streams/:streamId/end\", authenticateJWT, async (req: any, res) => {\n    try {\n      const { streamId } = req.params;\n      const userId = getUserId(req);\n      \n      const stream = await storage.getStream(streamId);\n      if (!stream) {\n        return res.status(404).json({ message: \"Stream not found\" });\n      }\n      \n      if (stream.creatorId !== userId) {\n        return res.status(403).json({ message: \"Not authorized\" });\n      }\n      \n      const updatedStream = await storage.endStream(streamId);\n      res.json(updatedStream);\n    } catch (error) {\n      logger.error(`Failed to end stream: ${error instanceof Error ? error.message : String(error)}`);\n      res.status(500).json({ message: \"Failed to end stream\" });\n    }\n  });\n\n  // Join stream (viewer)\n  app.post(\"/api/streams/:streamId/join\", authenticateJWT, async (req: any, res) => {\n    try {\n      const { streamId } = req.params;\n      const viewerId = getUserId(req);\n      \n      await storage.joinStream(streamId, viewerId);\n      res.json({ message: \"Joined stream successfully\" });\n    } catch (error) {\n      logger.error(`Failed to join stream: ${error instanceof Error ? error.message : String(error)}`);\n      res.status(500).json({ message: \"Failed to join stream\" });\n    }\n  });\n\n  // Leave stream\n  app.post(\"/api/streams/:streamId/leave\", authenticateJWT, async (req: any, res) => {\n    try {\n      const { streamId } = req.params;\n      const viewerId = getUserId(req);\n      \n      await storage.leaveStream(streamId, viewerId);\n      res.json({ message: \"Left stream successfully\" });\n    } catch (error) {\n      logger.error(`Failed to leave stream: ${error instanceof Error ? error.message : String(error)}`);\n      res.status(500).json({ message: \"Failed to leave stream\" });\n    }\n  });\n\n  // Get stream chat\n  app.get(\"/api/streams/:streamId/chat\", async (req: any, res) => {\n    try {\n      const { streamId } = req.params;\n      const limit = req.query.limit ? parseInt(req.query.limit) : 100;\n      const messages = await storage.getStreamChat(streamId, limit);\n      res.json(messages);\n    } catch (error) {\n      logger.error(`Failed to fetch stream chat: ${error instanceof Error ? error.message : String(error)}`);\n      res.status(500).json({ message: \"Failed to fetch stream chat\" });\n    }\n  });\n\n  // Send stream chat message\n  app.post(\"/api/streams/:streamId/chat\", authenticateJWT, async (req: any, res) => {\n    try {\n      const { streamId } = req.params;\n      const userId = getUserId(req);\n      const { message } = req.body;\n      \n      if (!message || message.trim().length === 0) {\n        return res.status(400).json({ message: \"Message cannot be empty\" });\n      }\n      \n      const chat = await storage.sendStreamChat(streamId, userId, message);\n      res.json(chat);\n    } catch (error) {\n      logger.error(`Failed to send chat message: ${error instanceof Error ? error.message : String(error)}`);\n      res.status(500).json({ message: \"Failed to send chat message\" });\n    }\n  });\n\n  // Send stream tip\n  app.post(\"/api/streams/:streamId/tip\", authenticateJWT, async (req: any, res) => {\n    try {\n      const { streamId } = req.params;\n      const fromUserId = getUserId(req);\n      const { amount, message } = req.body;\n      \n      const stream = await storage.getStream(streamId);\n      if (!stream) {\n        return res.status(404).json({ message: \"Stream not found\" });\n      }\n      \n      const tip = await storage.sendStreamTip({\n        streamId,\n        fromUserId,\n        toCreatorId: stream.creatorId,\n        amount: amount.toString(),\n        message,\n      });\n      \n      res.json(tip);\n    } catch (error) {\n      logger.error(`Failed to send tip: ${error instanceof Error ? error.message : String(error)}`);\n      res.status(500).json({ message: \"Failed to send tip\" });\n    }\n  });\n\n  // Get stream tips\n  app.get(\"/api/streams/:streamId/tips\", async (req: any, res) => {\n    try {\n      const { streamId } = req.params;\n      const tips = await storage.getStreamTips(streamId);\n      res.json(tips);\n    } catch (error) {\n      logger.error(`Failed to fetch stream tips: ${error instanceof Error ? error.message : String(error)}`);\n      res.status(500).json({ message: \"Failed to fetch stream tips\" });\n    }\n  });\n\n  // ===================\n  // Collaboration Routes\n  // ===================\n  \n  app.post(\"/api/collaborations\", authenticateJWT, requireCreator, async (req: any, res) => {\n    try {\n      const userId = getUserId(req);\n      const collab = await storage.createCollaboration({ ...req.body, primaryCreatorId: userId });\n      res.json(collab);\n    } catch (error) {\n      logger.error(`Failed to create collaboration: ${error instanceof Error ? error.message : String(error)}`);\n      res.status(500).json({ message: \"Failed to create collaboration\" });\n    }\n  });\n\n  app.post(\"/api/collaborations/:id/respond\", authenticateJWT, async (req: any, res) => {\n    try {\n      const { id } = req.params;\n      const { accept } = req.body;\n      const updated = await storage.respondToCollaboration(id, accept);\n      res.json(updated);\n    } catch (error) {\n      logger.error(`Failed to respond to collaboration: ${error instanceof Error ? error.message : String(error)}`);\n      res.status(500).json({ message: \"Failed to respond\" });\n    }\n  });\n\n  app.get(\"/api/collaborations\", authenticateJWT, async (req: any, res) => {\n    try {\n      const userId = getUserId(req);\n      const collabs = await storage.getCollaborations(userId);\n      res.json(collabs);\n    } catch (error) {\n      logger.error(`Failed to get collaborations: ${error instanceof Error ? error.message : String(error)}`);\n      res.status(500).json({ message: \"Failed to get collaborations\" });\n    }\n  });\n\n  // ===================\n  // Subscription Tier Routes\n  // ===================\n\n  app.post(\"/api/subscription-tiers\", authenticateJWT, requireCreator, async (req: any, res) => {\n    try {\n      const userId = getUserId(req);\n      const tier = await storage.createSubscriptionTier({ ...req.body, creatorId: userId });\n      res.json(tier);\n    } catch (error) {\n      logger.error(`Failed to create tier: ${error instanceof Error ? error.message : String(error)}`);\n      res.status(500).json({ message: \"Failed to create tier\" });\n    }\n  });\n\n  app.get(\"/api/subscription-tiers/:creatorId\", async (req: any, res) => {\n    try {\n      const { creatorId } = req.params;\n      const tiers = await storage.getCreatorTiers(creatorId);\n      res.json(tiers);\n    } catch (error) {\n      logger.error(`Failed to get tiers: ${error instanceof Error ? error.message : String(error)}`);\n      res.status(500).json({ message: \"Failed to get tiers\" });\n    }\n  });\n\n  // ===================\n  // Content Bundle Routes\n  // ===================\n\n  app.post(\"/api/bundles\", authenticateJWT, requireCreator, async (req: any, res) => {\n    try {\n      const userId = getUserId(req);\n      const bundle = await storage.createContentBundle({ ...req.body, creatorId: userId });\n      res.json(bundle);\n    } catch (error) {\n      logger.error(`Failed to create bundle: ${error instanceof Error ? error.message : String(error)}`);\n      res.status(500).json({ message: \"Failed to create bundle\" });\n    }\n  });\n\n  app.get(\"/api/bundles/:creatorId\", async (req: any, res) => {\n    try {\n      const { creatorId } = req.params;\n      const bundles = await storage.getCreatorBundles(creatorId);\n      res.json(bundles);\n    } catch (error) {\n      logger.error(`Failed to get bundles: ${error instanceof Error ? error.message : String(error)}`);\n      res.status(500).json({ message: \"Failed to get bundles\" });\n    }\n  });\n\n  app.post(\"/api/bundles/:bundleId/purchase\", authenticateJWT, async (req: any, res) => {\n    try {\n      const { bundleId } = req.params;\n      const userId = getUserId(req);\n      const result = await storage.purchaseBundle(bundleId, userId);\n      res.json(result);\n    } catch (error) {\n      logger.error(`Failed to purchase bundle: ${error instanceof Error ? error.message : String(error)}`);\n      res.status(500).json({ message: \"Failed to purchase bundle\" });\n    }\n  });\n\n  // ===================\n  // Virtual Gifts Routes\n  // ===================\n\n  app.get(\"/api/gifts\", async (req: any, res) => {\n    try {\n      const gifts = await storage.getVirtualGifts();\n      res.json(gifts);\n    } catch (error) {\n      logger.error(`Failed to get gifts: ${error instanceof Error ? error.message : String(error)}`);\n      res.status(500).json({ message: \"Failed to get gifts\" });\n    }\n  });\n\n  app.post(\"/api/gifts/send\", authenticateJWT, async (req: any, res) => {\n    try {\n      const userId = getUserId(req);\n      const sent = await storage.sendGift({ ...req.body, fromUserId: userId });\n      res.json(sent);\n    } catch (error) {\n      logger.error(`Failed to send gift: ${error instanceof Error ? error.message : String(error)}`);\n      res.status(500).json({ message: \"Failed to send gift\" });\n    }\n  });\n\n  app.get(\"/api/gifts/received\", authenticateJWT, async (req: any, res) => {\n    try {\n      const userId = getUserId(req);\n      const gifts = await storage.getGiftsReceived(userId);\n      res.json(gifts);\n    } catch (error) {\n      logger.error(`Failed to get received gifts: ${error instanceof Error ? error.message : String(error)}`);\n      res.status(500).json({ message: \"Failed to get gifts\" });\n    }\n  });\n\n  // ===================\n  // Leaderboard Routes\n  // ===================\n\n  app.get(\"/api/leaderboards/:period/:category\", async (req: any, res) => {\n    try {\n      const { period, category } = req.params;\n      const limit = req.query.limit ? parseInt(req.query.limit as string) : 100;\n      const leaderboard = await storage.getLeaderboard(period, category, limit);\n      res.json(leaderboard);\n    } catch (error) {\n      logger.error(`Failed to get leaderboard: ${error instanceof Error ? error.message : String(error)}`);\n      res.status(500).json({ message: \"Failed to get leaderboard\" });\n    }\n  });\n\n  // ===================\n  // Referral Routes\n  // ===================\n\n  app.post(\"/api/referrals/code\", authenticateJWT, async (req: any, res) => {\n    try {\n      const userId = getUserId(req);\n      const code = await storage.createReferralCode(userId);\n      res.json(code);\n    } catch (error) {\n      logger.error(`Failed to create referral code: ${error instanceof Error ? error.message : String(error)}`);\n      res.status(500).json({ message: \"Failed to create code\" });\n    }\n  });\n\n  app.get(\"/api/referrals/code\", authenticateJWT, async (req: any, res) => {\n    try {\n      const userId = getUserId(req);\n      const code = await storage.getReferralCode(userId);\n      res.json(code);\n    } catch (error) {\n      logger.error(`Failed to get referral code: ${error instanceof Error ? error.message : String(error)}`);\n      res.status(500).json({ message: \"Failed to get code\" });\n    }\n  });\n\n  // ===================\n  // Scheduled Posts Routes\n  // ===================\n\n  app.post(\"/api/scheduled-posts\", authenticateJWT, requireCreator, async (req: any, res) => {\n    try {\n      const userId = getUserId(req);\n      const post = await storage.createScheduledPost({ ...req.body, creatorId: userId });\n      res.json(post);\n    } catch (error) {\n      logger.error(`Failed to schedule post: ${error instanceof Error ? error.message : String(error)}`);\n      res.status(500).json({ message: \"Failed to schedule post\" });\n    }\n  });\n\n  app.get(\"/api/scheduled-posts\", authenticateJWT, requireCreator, async (req: any, res) => {\n    try {\n      const userId = getUserId(req);\n      const posts = await storage.getScheduledPosts(userId);\n      res.json(posts);\n    } catch (error) {\n      logger.error(`Failed to get scheduled posts: ${error instanceof Error ? error.message : String(error)}`);\n      res.status(500).json({ message: \"Failed to get posts\" });\n    }\n  });\n\n  // ===================\n  // Creator Badges Routes\n  // ===================\n\n  app.get(\"/api/badges/:userId\", async (req: any, res) => {\n    try {\n      const { userId } = req.params;\n      const badges = await storage.getUserBadges(userId);\n      res.json(badges);\n    } catch (error) {\n      logger.error(`Failed to get badges: ${error instanceof Error ? error.message : String(error)}`);\n      res.status(500).json({ message: \"Failed to get badges\" });\n    }\n  });\n\n  // ===================\n  // Geo-blocking Routes\n  // ===================\n\n  app.post(\"/api/geo-blocking\", authenticateJWT, requireCreator, async (req: any, res) => {\n    try {\n      const userId = getUserId(req);\n      const rule = await storage.createGeoBlockingRule({ ...req.body, creatorId: userId });\n      res.json(rule);\n    } catch (error) {\n      logger.error(`Failed to create geo-blocking rule: ${error instanceof Error ? error.message : String(error)}`);\n      res.status(500).json({ message: \"Failed to create rule\" });\n    }\n  });\n\n  app.get(\"/api/geo-blocking\", authenticateJWT, requireCreator, async (req: any, res) => {\n    try {\n      const userId = getUserId(req);\n      const rules = await storage.getGeoBlockingRules(userId);\n      res.json(rules);\n    } catch (error) {\n      logger.error(`Failed to get geo-blocking rules: ${error instanceof Error ? error.message : String(error)}`);\n      res.status(500).json({ message: \"Failed to get rules\" });\n    }\n  });\n\n  // ===================\n  // Search & Tags Routes\n  // ===================\n\n  app.get(\"/api/search\", async (req: any, res) => {\n    try {\n      const results = await storage.searchContent(req.query);\n      res.json(results);\n    } catch (error) {\n      logger.error(`Search failed: ${error instanceof Error ? error.message : String(error)}`);\n      res.status(500).json({ message: \"Search failed\" });\n    }\n  });\n\n  // ===================\n  // DMCA Routes\n  // ===================\n\n  app.post(\"/api/dmca/claims\", async (req: any, res) => {\n    try {\n      const claim = await storage.createDmcaClaim(req.body);\n      res.json(claim);\n    } catch (error) {\n      logger.error(`Failed to create DMCA claim: ${error instanceof Error ? error.message : String(error)}`);\n      res.status(500).json({ message: \"Failed to create claim\" });\n    }\n  });\n\n  app.get(\"/api/dmca/claims\", authenticateJWT, requireAdmin, async (req: any, res) => {\n    try {\n      const { status } = req.query;\n      const claims = await storage.getDmcaClaims(status as string);\n      res.json(claims);\n    } catch (error) {\n      logger.error(`Failed to get DMCA claims: ${error instanceof Error ? error.message : String(error)}`);\n      res.status(500).json({ message: \"Failed to get claims\" });\n    }\n  });\n\n  app.post(\"/api/dmca/claims/:id/review\", authenticateJWT, requireAdmin, async (req: any, res) => {\n    try {\n      const { id } = req.params;\n      const { approved } = req.body;\n      const userId = getUserId(req);\n      const updated = await storage.reviewDmcaClaim(id, approved, userId);\n      res.json(updated);\n    } catch (error) {\n      logger.error(`Failed to review DMCA claim: ${error instanceof Error ? error.message : String(error)}`);\n      res.status(500).json({ message: \"Failed to review claim\" });\n    }\n  });\n\n  // ===================\n  // AI Moderation & Deepfake Detection Routes\n  // ===================\n\n  app.post(\"/api/moderation/scan\", authenticateJWT, validate({ body: createAiScanJobSchema }), async (req: any, res) => {\n    try {\n      const job = await storage.createAiScanJob(req.body);\n      res.status(201).json(job);\n    } catch (error) {\n      logger.error(`Failed to create AI scan job: ${error instanceof Error ? error.message : String(error)}`);\n      res.status(500).json({ message: \"Failed to create scan job\" });\n    }\n  });\n\n  app.get(\"/api/moderation/jobs/:mediaId\", authenticateJWT, validate({ params: mediaIdPathParamSchema }), async (req: any, res) => {\n    try {\n      const { mediaId } = req.params;\n      const userId = getUserId(req);\n      const jobs = await storage.getAiScanJobsByMedia(mediaId, userId);\n      res.json(jobs);\n    } catch (error) {\n      const errorMessage = error instanceof Error ? error.message : String(error);\n      logger.error(`Failed to get AI scan jobs: ${errorMessage}`);\n      \n      if (errorMessage.includes(\"Unauthorized\")) {\n        return res.status(403).json({ message: errorMessage });\n      } else if (errorMessage.includes(\"not found\")) {\n        return res.status(404).json({ message: errorMessage });\n      }\n      res.status(500).json({ message: \"Failed to get scan jobs\" });\n    }\n  });\n\n  app.get(\"/api/moderation/queue\", authenticateJWT, requireAdmin, async (req: any, res) => {\n    try {\n      const queue = await storage.getAiScanQueue();\n      res.json(queue);\n    } catch (error) {\n      logger.error(`Failed to get scan queue: ${error instanceof Error ? error.message : String(error)}`);\n      res.status(500).json({ message: \"Failed to get queue\" });\n    }\n  });\n\n  app.get(\"/api/moderation/results/:jobId\", authenticateJWT, validate({ params: jobIdPathParamSchema }), async (req: any, res) => {\n    try {\n      const { jobId } = req.params;\n      const userId = getUserId(req);\n      const results = await storage.getAiScanResults(jobId, userId);\n      res.json(results);\n    } catch (error) {\n      const errorMessage = error instanceof Error ? error.message : String(error);\n      logger.error(`Failed to get scan results: ${errorMessage}`);\n      \n      if (errorMessage.includes(\"Unauthorized\")) {\n        return res.status(403).json({ message: errorMessage });\n      } else if (errorMessage.includes(\"not found\")) {\n        return res.status(404).json({ message: errorMessage });\n      }\n      res.status(500).json({ message: \"Failed to get results\" });\n    }\n  });\n\n  app.post(\"/api/moderation/fingerprint\", authenticateJWT, validate({ body: createContentFingerprintSchema }), async (req: any, res) => {\n    try {\n      const fingerprint = await storage.createContentFingerprint(req.body);\n      res.status(201).json(fingerprint);\n    } catch (error) {\n      logger.error(`Failed to create content fingerprint: ${error instanceof Error ? error.message : String(error)}`);\n      res.status(500).json({ message: \"Failed to create fingerprint\" });\n    }\n  });\n\n  app.get(\"/api/moderation/fingerprints/:mediaId\", authenticateJWT, validate({ params: mediaIdPathParamSchema }), async (req: any, res) => {\n    try {\n      const { mediaId } = req.params;\n      const userId = getUserId(req);\n      const fingerprint = await storage.getContentFingerprint(mediaId, userId);\n      res.json(fingerprint);\n    } catch (error) {\n      const errorMessage = error instanceof Error ? error.message : String(error);\n      logger.error(`Failed to get content fingerprint: ${errorMessage}`);\n      \n      if (errorMessage.includes(\"Unauthorized\")) {\n        return res.status(403).json({ message: errorMessage });\n      } else if (errorMessage.includes(\"not found\")) {\n        return res.status(404).json({ message: errorMessage });\n      }\n      res.status(500).json({ message: \"Failed to get fingerprint\" });\n    }\n  });\n\n  app.get(\"/api/moderation/results/media/:mediaId\", authenticateJWT, validate({ params: mediaIdPathParamSchema }), async (req: any, res) => {\n    try {\n      const { mediaId } = req.params;\n      const userId = getUserId(req);\n      const results = await storage.getAiScanResultsByMedia(mediaId, userId);\n      res.json(results);\n    } catch (error) {\n      const errorMessage = error instanceof Error ? error.message : String(error);\n      logger.error(`Failed to get scan results by media: ${errorMessage}`);\n      \n      if (errorMessage.includes(\"Unauthorized\")) {\n        return res.status(403).json({ message: errorMessage });\n      } else if (errorMessage.includes(\"not found\")) {\n        return res.status(404).json({ message: errorMessage });\n      }\n      res.status(500).json({ message: \"Failed to get scan results\" });\n    }\n  });\n\n  app.post(\"/api/moderation/results/:id/review\", authenticateJWT, validate({ params: idParamSchema, body: reviewAiScanResultSchema }), async (req: any, res) => {\n    try {\n      const { id } = req.params;\n      const userId = getUserId(req);\n      const reviewed = await storage.reviewAiScanResult(id, req.body, userId);\n      res.json(reviewed);\n    } catch (error) {\n      const errorMessage = error instanceof Error ? error.message : String(error);\n      logger.error(`Failed to review scan result: ${errorMessage}`);\n      \n      if (errorMessage.includes(\"Unauthorized\")) {\n        return res.status(403).json({ message: errorMessage });\n      } else if (errorMessage.includes(\"not found\")) {\n        return res.status(404).json({ message: errorMessage });\n      }\n      res.status(500).json({ message: \"Failed to review result\" });\n    }\n  });\n\n  app.post(\"/api/moderation/fingerprints/:id/verify\", authenticateJWT, validate({ params: idParamSchema, body: verifyContentFingerprintSchema }), async (req: any, res) => {\n    try {\n      const { id } = req.params;\n      const userId = getUserId(req);\n      const verified = await storage.verifyContentFingerprint(id, req.body, userId);\n      res.json(verified);\n    } catch (error) {\n      const errorMessage = error instanceof Error ? error.message : String(error);\n      logger.error(`Failed to verify fingerprint: ${errorMessage}`);\n      \n      if (errorMessage.includes(\"Unauthorized\")) {\n        return res.status(403).json({ message: errorMessage });\n      } else if (errorMessage.includes(\"not found\")) {\n        return res.status(404).json({ message: errorMessage });\n      }\n      res.status(500).json({ message: \"Failed to verify fingerprint\" });\n    }\n  });\n\n  // ===================\n  // Loan Routes\n  // ===================\n\n  app.post(\"/api/loans/programs\", authenticateJWT, requireAdmin, validate({ body: createLoanProgramSchema }), async (req: any, res) => {\n    try {\n      const program = await storage.createLoanProgram(req.body);\n      res.status(201).json(program);\n    } catch (error) {\n      logger.error(`Failed to create loan program: ${error instanceof Error ? error.message : String(error)}`);\n      res.status(500).json({ message: \"Failed to create program\" });\n    }\n  });\n\n  app.get(\"/api/loans/programs\", authenticateJWT, async (req: any, res) => {\n    try {\n      const programs = await storage.getLoanPrograms();\n      res.json(programs);\n    } catch (error) {\n      logger.error(`Failed to get loan programs: ${error instanceof Error ? error.message : String(error)}`);\n      res.status(500).json({ message: \"Failed to get programs\" });\n    }\n  });\n\n  app.post(\"/api/loans/apply\", authenticateJWT, requireCreator, validate({ body: createLoanApplicationSchema }), async (req: any, res) => {\n    try {\n      const creatorId = getUserId(req);\n      const application = await storage.createLoanApplication({ ...req.body, creatorId });\n      res.status(201).json(application);\n    } catch (error) {\n      logger.error(`Failed to apply for loan: ${error instanceof Error ? error.message : String(error)}`);\n      res.status(500).json({ message: \"Failed to apply for loan\" });\n    }\n  });\n\n  app.get(\"/api/loans/applications/:creatorId\", authenticateJWT, verifyOwnership(\"creatorId\"), validate({ params: creatorIdPathParamSchema }), async (req: any, res) => {\n    try {\n      const { creatorId } = req.params;\n      const applications = await storage.getLoanApplicationsByCreator(creatorId);\n      res.json(applications);\n    } catch (error) {\n      logger.error(`Failed to get loan applications: ${error instanceof Error ? error.message : String(error)}`);\n      res.status(500).json({ message: \"Failed to get applications\" });\n    }\n  });\n\n  app.post(\"/api/loans/offer\", authenticateJWT, validate({ body: createLoanOfferSchema }), async (req: any, res) => {\n    try {\n      const lenderId = getUserId(req);\n      const offer = await storage.createLoanOffer({ ...req.body, lenderId });\n      res.status(201).json(offer);\n    } catch (error) {\n      logger.error(`Failed to create loan offer: ${error instanceof Error ? error.message : String(error)}`);\n      res.status(500).json({ message: \"Failed to create offer\" });\n    }\n  });\n\n  app.get(\"/api/loans/offers/:lenderId\", authenticateJWT, verifyOwnership(\"lenderId\"), validate({ params: lenderIdPathParamSchema }), async (req: any, res) => {\n    try {\n      const { lenderId } = req.params;\n      const offers = await storage.getLoanOffersByLender(lenderId);\n      res.json(offers);\n    } catch (error) {\n      logger.error(`Failed to get loan offers: ${error instanceof Error ? error.message : String(error)}`);\n      res.status(500).json({ message: \"Failed to get offers\" });\n    }\n  });\n\n  app.post(\"/api/loans/offers/:id/accept\", authenticateJWT, requireCreator, validate({ params: idParamSchema }), async (req: any, res) => {\n    try {\n      const { id } = req.params;\n      const offer = await storage.acceptLoanOffer(id, getUserId(req));\n      res.json(offer);\n    } catch (error) {\n      logger.error(`Failed to accept loan offer: ${error instanceof Error ? error.message : String(error)}`);\n      res.status(500).json({ message: \"Failed to accept offer\" });\n    }\n  });\n\n  app.get(\"/api/loans/repayments/:offerId\", authenticateJWT, validate({ params: offerIdPathParamSchema }), async (req: any, res) => {\n    try {\n      const { offerId } = req.params;\n      const userId = getUserId(req);\n      const repayments = await storage.getLoanRepaymentsByOffer(offerId, userId);\n      res.json(repayments);\n    } catch (error) {\n      logger.error(`Failed to get loan repayments: ${error instanceof Error ? error.message : String(error)}`);\n      res.status(500).json({ message: error instanceof Error ? error.message : \"Failed to get repayments\" });\n    }\n  });\n\n  app.post(\"/api/loans/repayments/:id/pay\", authenticateJWT, requireCreator, validate({ params: idParamSchema, body: payLoanRepaymentSchema }), async (req: any, res) => {\n    try {\n      const { id } = req.params;\n      const repayment = await storage.payLoanRepayment(id, req.body.amount, getUserId(req));\n      res.json(repayment);\n    } catch (error) {\n      logger.error(`Failed to pay loan repayment: ${error instanceof Error ? error.message : String(error)}`);\n      res.status(500).json({ message: \"Failed to pay repayment\" });\n    }\n  });\n\n  // ===================\n  // NFT Routes\n  // ===================\n\n  app.post(\"/api/nft/deploy-contract\", authenticateJWT, requireCreator, validate({ body: deployNftContractSchema }), async (req: any, res) => {\n    try {\n      const creatorId = getUserId(req);\n      const contract = await storage.deployNftContract({ ...req.body, creatorId });\n      res.status(201).json(contract);\n    } catch (error) {\n      logger.error(`Failed to deploy NFT contract: ${error instanceof Error ? error.message : String(error)}`);\n      res.status(500).json({ message: \"Failed to deploy contract\" });\n    }\n  });\n\n  app.get(\"/api/nft/contracts/:creatorId\", authenticateJWT, verifyOwnership(\"creatorId\"), validate({ params: creatorIdPathParamSchema }), async (req: any, res) => {\n    try {\n      const { creatorId } = req.params;\n      const contracts = await storage.getNftContractsByCreator(creatorId);\n      res.json(contracts);\n    } catch (error) {\n      logger.error(`Failed to get NFT contracts: ${error instanceof Error ? error.message : String(error)}`);\n      res.status(500).json({ message: \"Failed to get contracts\" });\n    }\n  });\n\n  app.post(\"/api/nft/mint\", authenticateJWT, requireCreator, validate({ body: mintNftSchema }), async (req: any, res) => {\n    try {\n      const creatorId = getUserId(req);\n      const mint = await storage.mintNft(req.body, creatorId);\n      res.status(201).json(mint);\n    } catch (error) {\n      const errorMessage = error instanceof Error ? error.message : String(error);\n      logger.error(`Failed to mint NFT: ${errorMessage}`);\n      \n      // Return 403 for authorization errors, 404 for not found, 500 for others\n      if (errorMessage.includes(\"Unauthorized\")) {\n        return res.status(403).json({ message: errorMessage });\n      } else if (errorMessage.includes(\"not found\")) {\n        return res.status(404).json({ message: errorMessage });\n      }\n      res.status(500).json({ message: \"Failed to mint NFT\" });\n    }\n  });\n\n  app.get(\"/api/nft/mints/:contractId\", authenticateJWT, validate({ params: contractIdPathParamSchema }), async (req: any, res) => {\n    try {\n      const { contractId } = req.params;\n      const userId = getUserId(req);\n      const mints = await storage.getNftMintsByContract(contractId, userId);\n      res.json(mints);\n    } catch (error) {\n      const errorMessage = error instanceof Error ? error.message : String(error);\n      logger.error(`Failed to get NFT mints: ${errorMessage}`);\n      \n      // Return 403 for authorization errors, 404 for not found, 500 for others\n      if (errorMessage.includes(\"Unauthorized\")) {\n        return res.status(403).json({ message: errorMessage });\n      } else if (errorMessage.includes(\"not found\")) {\n        return res.status(404).json({ message: errorMessage });\n      }\n      res.status(500).json({ message: \"Failed to get mints\" });\n    }\n  });\n\n  app.post(\"/api/nft/royalty\", authenticateJWT, validate({ body: recordNftRoyaltySchema }), async (req: any, res) => {\n    try {\n      const creatorId = getUserId(req);\n      const royalty = await storage.recordNftRoyalty(req.body, creatorId);\n      res.status(201).json(royalty);\n    } catch (error) {\n      const errorMessage = error instanceof Error ? error.message : String(error);\n      logger.error(`Failed to record NFT royalty: ${errorMessage}`);\n      \n      // Return 403 for authorization errors, 404 for not found, 500 for others\n      if (errorMessage.includes(\"Unauthorized\")) {\n        return res.status(403).json({ message: errorMessage });\n      } else if (errorMessage.includes(\"not found\")) {\n        return res.status(404).json({ message: errorMessage });\n      }\n      res.status(500).json({ message: \"Failed to record royalty\" });\n    }\n  });\n\n  app.get(\"/api/nft/royalties/:creatorId\", authenticateJWT, verifyOwnership(\"creatorId\"), validate({ params: creatorIdPathParamSchema }), async (req: any, res) => {\n    try {\n      const { creatorId } = req.params;\n      const royalties = await storage.getNftRoyaltiesByCreator(creatorId);\n      res.json(royalties);\n    } catch (error) {\n      logger.error(`Failed to get NFT royalties: ${error instanceof Error ? error.message : String(error)}`);\n      res.status(500).json({ message: \"Failed to get royalties\" });\n    }\n  });\n\n  app.get(\"/api/nft/royalties/stats/:creatorId\", authenticateJWT, verifyOwnership(\"creatorId\"), validate({ params: creatorIdPathParamSchema }), async (req: any, res) => {\n    try {\n      const { creatorId } = req.params;\n      const stats = await storage.getNftRoyaltyStats(creatorId);\n      res.json(stats);\n    } catch (error) {\n      logger.error(`Failed to get NFT royalty stats: ${error instanceof Error ? error.message : String(error)}`);\n      res.status(500).json({ message: \"Failed to get stats\" });\n    }\n  });\n\n  app.get(\"/api/nft/marketplace\", authenticateJWT, async (req: any, res) => {\n    try {\n      const nfts = await storage.getMarketplaceNfts();\n      res.json(nfts);\n    } catch (error) {\n      logger.error(`Failed to get marketplace NFTs: ${error instanceof Error ? error.message : String(error)}`);\n      res.status(500).json({ message: \"Failed to get marketplace NFTs\" });\n    }\n  });\n\n  app.post(\"/api/nft/purchase\", authenticateJWT, validate({ body: z.object({ nftId: z.string().uuid() }) }), async (req: any, res) => {\n    try {\n      const { nftId } = req.body;\n      const userId = req.user.id;\n      \n      // Get the NFT\n      const nft = await storage.getNftMintById(nftId);\n      if (!nft) {\n        return res.status(404).json({ message: \"NFT not found\" });\n      }\n      \n      // Check if already owned by anyone\n      if (nft.ownerId) {\n        if (nft.ownerId === userId) {\n          return res.status(400).json({ message: \"You already own this NFT\" });\n        } else {\n          return res.status(409).json({ message: \"NFT already sold to another user\" });\n        }\n      }\n      \n      // Simulate purchase (update owner)\n      const purchased = await storage.purchaseNft(nftId, userId);\n      res.json(purchased);\n    } catch (error) {\n      const errorMessage = error instanceof Error ? error.message : String(error);\n      logger.error(`Failed to purchase NFT: ${errorMessage}`);\n      \n      if (errorMessage.includes(\"already sold\")) {\n        return res.status(409).json({ message: \"NFT already sold to another user\" });\n      } else if (errorMessage.includes(\"not found\")) {\n        return res.status(404).json({ message: errorMessage });\n      }\n      res.status(500).json({ message: \"Failed to purchase NFT\" });\n    }\n  });\n\n  // Create HTTP server\n  const httpServer = createServer(app);\n\n  // WebSocket server for real-time features\n  const wss = new WebSocketServer({ server: httpServer, path: \"/ws\" });\n\n  // Store active connections and their subscriptions\n  const clients = new Map<string, { ws: any; userId?: string; rooms: Set<string> }>();\n\n  wss.on(\"connection\", (ws, req) => {\n    const clientId = Math.random().toString(36).substring(7);\n    clients.set(clientId, { ws, rooms: new Set() });\n    \n    logger.info(`WebSocket connection established [${clientId}] from ${req.socket.remoteAddress}`);\n\n    ws.on(\"message\", async (data) => {\n      try {\n        const message = JSON.parse(data.toString());\n        logger.debug(`WebSocket message received from [${clientId}]: ${message.type}`);\n        const client = clients.get(clientId);\n\n        switch (message.type) {\n          case \"ping\":\n            ws.send(JSON.stringify({ type: \"pong\", timestamp: Date.now() }));\n            break;\n\n          case \"auth\":\n            // Authenticate client with userId\n            if (message.userId) {\n              if (client) {\n                client.userId = message.userId;\n                ws.send(JSON.stringify({ type: \"authenticated\", userId: message.userId }));\n                logger.info(`Client [${clientId}] authenticated as user ${message.userId}`);\n              }\n            }\n            break;\n\n          case \"subscribe\":\n            // Subscribe to room (user channel, chat, stream, etc.)\n            if (message.room && client) {\n              client.rooms.add(message.room);\n              ws.send(JSON.stringify({ type: \"subscribed\", room: message.room }));\n              logger.debug(`Client [${clientId}] subscribed to room: ${message.room}`);\n            }\n            break;\n\n          case \"unsubscribe\":\n            // Unsubscribe from room\n            if (message.room && client) {\n              client.rooms.delete(message.room);\n              ws.send(JSON.stringify({ type: \"unsubscribed\", room: message.room }));\n              logger.debug(`Client [${clientId}] unsubscribed from room: ${message.room}`);\n            }\n            break;\n\n          case \"message\":\n            // Handle real-time chat messages\n            if (message.recipientId && message.content && client?.userId) {\n              // Save message to database\n              const savedMessage = await storage.createMessage({\n                senderId: client.userId,\n                recipientId: message.recipientId,\n                content: message.content,\n                mediaUrl: message.mediaUrl,\n              });\n\n              // Broadcast to recipient if they're online\n              for (const [id, c] of clients) {\n                if (c.userId === message.recipientId) {\n                  c.ws.send(JSON.stringify({\n                    type: \"new_message\",\n                    message: savedMessage,\n                  }));\n                }\n              }\n\n              // Confirm to sender\n              ws.send(JSON.stringify({ type: \"message_sent\", messageId: savedMessage.id }));\n              logger.info(`Message sent from ${client.userId} to ${message.recipientId}`);\n            }\n            break;\n\n          case \"broadcast\":\n            // Broadcast message to a room (e.g., live stream chat)\n            if (message.room && message.content && client) {\n              const broadcastData = {\n                type: \"room_message\",\n                room: message.room,\n                from: client.userId,\n                content: message.content,\n                timestamp: Date.now(),\n              };\n\n              // Send to all clients in the same room\n              for (const [id, c] of clients) {\n                if (c.rooms.has(message.room)) {\n                  c.ws.send(JSON.stringify(broadcastData));\n                }\n              }\n              logger.debug(`Broadcast sent to room ${message.room} from [${clientId}]`);\n            }\n            break;\n\n          default:\n            logger.warn(`Unknown WebSocket message type from [${clientId}]: ${message.type}`);\n        }\n      } catch (error) {\n        logger.error(`WebSocket message error [${clientId}]: ${error instanceof Error ? error.message : String(error)}`);\n        ws.send(JSON.stringify({ type: \"error\", message: \"Invalid message format\" }));\n      }\n    });\n\n    ws.on(\"close\", () => {\n      const client = clients.get(clientId);\n      logger.debug(`WebSocket connection closed [${clientId}] ${client?.userId ? `(user ${client.userId})` : \"\"}`);\n      clients.delete(clientId);\n    });\n\n    ws.on(\"error\", (error) => {\n      logger.error(`WebSocket error [${clientId}]: ${error instanceof Error ? error.message : String(error)}`);\n    });\n\n    // Send welcome message\n    ws.send(JSON.stringify({ \n      type: \"connected\", \n      message: \"Connected to DaddyFanz real-time server\",\n      clientId,\n      timestamp: Date.now(),\n    }));\n  });\n\n  logger.info(\"WebSocket server initialized on path: /ws\");\n\n  return httpServer;\n}\n","size_bytes":96865},"client/src/pages/not-found.tsx":{"content":"import { Card, CardContent } from \"@/components/ui/card\";\nimport { AlertCircle } from \"lucide-react\";\n\nexport default function NotFound() {\n  return (\n    <div className=\"min-h-screen w-full flex items-center justify-center bg-gray-50\">\n      <Card className=\"w-full max-w-md mx-4\">\n        <CardContent className=\"pt-6\">\n          <div className=\"flex mb-4 gap-2\">\n            <AlertCircle className=\"h-8 w-8 text-red-500\" />\n            <h1 className=\"text-2xl font-bold text-gray-900\">404 Page Not Found</h1>\n          </div>\n\n          <p className=\"mt-4 text-sm text-gray-600\">\n            Did you forget to add the page to the router?\n          </p>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","size_bytes":711},"client/src/components/ui/progress.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as ProgressPrimitive from \"@radix-ui/react-progress\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Progress = React.forwardRef<\n  React.ElementRef<typeof ProgressPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ProgressPrimitive.Root>\n>(({ className, value, ...props }, ref) => (\n  <ProgressPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative h-4 w-full overflow-hidden rounded-full bg-secondary\",\n      className\n    )}\n    {...props}\n  >\n    <ProgressPrimitive.Indicator\n      className=\"h-full w-full flex-1 bg-primary transition-all\"\n      style={{ transform: `translateX(-${100 - (value || 0)}%)` }}\n    />\n  </ProgressPrimitive.Root>\n))\nProgress.displayName = ProgressPrimitive.Root.displayName\n\nexport { Progress }\n","size_bytes":791},"client/src/components/ui/sheet.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as SheetPrimitive from \"@radix-ui/react-dialog\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Sheet = SheetPrimitive.Root\n\nconst SheetTrigger = SheetPrimitive.Trigger\n\nconst SheetClose = SheetPrimitive.Close\n\nconst SheetPortal = SheetPrimitive.Portal\n\nconst SheetOverlay = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Overlay\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  />\n))\nSheetOverlay.displayName = SheetPrimitive.Overlay.displayName\n\nconst sheetVariants = cva(\n  \"fixed z-50 gap-4 bg-background p-6 shadow-lg transition ease-in-out data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:duration-300 data-[state=open]:duration-500\",\n  {\n    variants: {\n      side: {\n        top: \"inset-x-0 top-0 border-b data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top\",\n        bottom:\n          \"inset-x-0 bottom-0 border-t data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom\",\n        left: \"inset-y-0 left-0 h-full w-3/4 border-r data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left sm:max-w-sm\",\n        right:\n          \"inset-y-0 right-0 h-full w-3/4  border-l data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right sm:max-w-sm\",\n      },\n    },\n    defaultVariants: {\n      side: \"right\",\n    },\n  }\n)\n\ninterface SheetContentProps\n  extends React.ComponentPropsWithoutRef<typeof SheetPrimitive.Content>,\n    VariantProps<typeof sheetVariants> {}\n\nconst SheetContent = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Content>,\n  SheetContentProps\n>(({ side = \"right\", className, children, ...props }, ref) => (\n  <SheetPortal>\n    <SheetOverlay />\n    <SheetPrimitive.Content\n      ref={ref}\n      className={cn(sheetVariants({ side }), className)}\n      {...props}\n    >\n      {children}\n      <SheetPrimitive.Close className=\"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-secondary\">\n        <X className=\"h-4 w-4\" />\n        <span className=\"sr-only\">Close</span>\n      </SheetPrimitive.Close>\n    </SheetPrimitive.Content>\n  </SheetPortal>\n))\nSheetContent.displayName = SheetPrimitive.Content.displayName\n\nconst SheetHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-2 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nSheetHeader.displayName = \"SheetHeader\"\n\nconst SheetFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nSheetFooter.displayName = \"SheetFooter\"\n\nconst SheetTitle = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Title\n    ref={ref}\n    className={cn(\"text-lg font-semibold text-foreground\", className)}\n    {...props}\n  />\n))\nSheetTitle.displayName = SheetPrimitive.Title.displayName\n\nconst SheetDescription = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nSheetDescription.displayName = SheetPrimitive.Description.displayName\n\nexport {\n  Sheet,\n  SheetPortal,\n  SheetOverlay,\n  SheetTrigger,\n  SheetClose,\n  SheetContent,\n  SheetHeader,\n  SheetFooter,\n  SheetTitle,\n  SheetDescription,\n}\n","size_bytes":4281},"client/src/components/layout/Footer.tsx":{"content":"import { Link } from \"wouter\";\n\nexport default function Footer() {\n  return (\n    <footer className=\"bg-df-brick border-t border-df-steel mt-16\">\n      <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8\">\n        <div className=\"grid grid-cols-1 md:grid-cols-4 gap-8\">\n          {/* Brand */}\n          <div>\n            <div className=\"text-xl mb-4\">\n              <span className=\"neon-heading\">Daddy</span><span className=\"glow-text-gold\">Fanz</span>\n            </div>\n            <p className=\"text-df-fog text-sm\">Premium adult content platform for creators and fans.</p>\n            <div className=\"flex items-center space-x-2 mt-4 text-df-steel text-xs\">\n              <span className=\"text-df-fog\">Powered by:</span>\n              <span>CCBill</span>\n              <span>•</span>\n              <span>Segpay</span>\n              <span>•</span>\n              <span>Paxum</span>\n            </div>\n          </div>\n\n          {/* Compliance */}\n          <div>\n            <h4 className=\"text-df-snow font-semibold mb-4\">Compliance</h4>\n            <ul className=\"space-y-2 text-df-fog text-sm\">\n              <li>\n                <Link \n                  href=\"/legal/2257\" \n                  className=\"hover:text-df-cyan transition-colors\"\n                  data-testid=\"link-2257\"\n                >\n                  18 U.S.C. § 2257\n                </Link>\n              </li>\n              <li>\n                <Link \n                  href=\"/legal/gdpr\" \n                  className=\"hover:text-df-cyan transition-colors\"\n                  data-testid=\"link-gdpr\"\n                >\n                  GDPR Compliance\n                </Link>\n              </li>\n              <li>\n                <Link \n                  href=\"/verification\" \n                  className=\"hover:text-df-cyan transition-colors\"\n                  data-testid=\"link-age-verification\"\n                >\n                  Age Verification\n                </Link>\n              </li>\n              <li>\n                <Link \n                  href=\"/legal/kyc\" \n                  className=\"hover:text-df-cyan transition-colors\"\n                  data-testid=\"link-kyc\"\n                >\n                  KYC/AML Policy\n                </Link>\n              </li>\n            </ul>\n          </div>\n\n          {/* Support */}\n          <div>\n            <h4 className=\"text-df-snow font-semibold mb-4\">Support</h4>\n            <ul className=\"space-y-2 text-df-fog text-sm\">\n              <li>\n                <Link \n                  href=\"/help\" \n                  className=\"hover:text-df-cyan transition-colors\"\n                  data-testid=\"link-help\"\n                >\n                  Help Center\n                </Link>\n              </li>\n              <li>\n                <Link \n                  href=\"/creator-guide\" \n                  className=\"hover:text-df-cyan transition-colors\"\n                  data-testid=\"link-creator-guide\"\n                >\n                  Creator Guide\n                </Link>\n              </li>\n              <li>\n                <Link \n                  href=\"/payment-help\" \n                  className=\"hover:text-df-cyan transition-colors\"\n                  data-testid=\"link-payment-help\"\n                >\n                  Payment Help\n                </Link>\n              </li>\n              <li>\n                <Link \n                  href=\"/contact\" \n                  className=\"hover:text-df-cyan transition-colors\"\n                  data-testid=\"link-contact\"\n                >\n                  Contact Us\n                </Link>\n              </li>\n            </ul>\n          </div>\n\n          {/* Legal */}\n          <div>\n            <h4 className=\"text-df-snow font-semibold mb-4\">Legal</h4>\n            <ul className=\"space-y-2 text-df-fog text-sm\">\n              <li>\n                <Link \n                  href=\"/legal/terms\" \n                  className=\"hover:text-df-cyan transition-colors\"\n                  data-testid=\"link-terms\"\n                >\n                  Terms of Service\n                </Link>\n              </li>\n              <li>\n                <Link \n                  href=\"/legal/privacy\" \n                  className=\"hover:text-df-cyan transition-colors\"\n                  data-testid=\"link-privacy\"\n                >\n                  Privacy Policy\n                </Link>\n              </li>\n              <li>\n                <Link \n                  href=\"/legal/dmca\" \n                  className=\"hover:text-df-cyan transition-colors\"\n                  data-testid=\"link-dmca\"\n                >\n                  DMCA Policy\n                </Link>\n              </li>\n              <li>\n                <Link \n                  href=\"/legal/acceptable-use\" \n                  className=\"hover:text-df-cyan transition-colors\"\n                  data-testid=\"link-acceptable-use\"\n                >\n                  Acceptable Use\n                </Link>\n              </li>\n            </ul>\n          </div>\n        </div>\n\n        <div className=\"chain-divider my-8\"></div>\n\n        <div className=\"flex flex-col md:flex-row justify-between items-center\">\n          <p className=\"text-df-fog text-sm\">\n            © 2025 DaddyFanz. All rights reserved. Adult content platform 18+\n          </p>\n          <div className=\"flex items-center space-x-4 mt-4 md:mt-0\">\n            <span className=\"text-df-fog text-sm\">Secure & Compliant</span>\n            <div className=\"flex items-center space-x-2\">\n              <div className=\"w-3 h-3 bg-green-400 rounded-full pulse-glow\" title=\"Systems Operational\"></div>\n              <span className=\"text-df-fog text-xs\">All Systems Operational</span>\n            </div>\n          </div>\n        </div>\n      </div>\n    </footer>\n  );\n}\n","size_bytes":5796},"client/src/pages/PaymentHelpPage.tsx":{"content":"import Header from \"@/components/layout/Header\";\nimport Footer from \"@/components/layout/Footer\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Accordion, AccordionContent, AccordionItem, AccordionTrigger } from \"@/components/ui/accordion\";\nimport { CreditCard, DollarSign, Shield, AlertCircle, HelpCircle, CheckCircle } from \"lucide-react\";\n\nexport default function PaymentHelpPage() {\n  return (\n    <div className=\"min-h-screen bg-df-obsidian\">\n      <Header />\n      <div className=\"max-w-4xl mx-auto px-4 py-16\">\n        <div className=\"text-center mb-12\">\n          <div className=\"flex items-center justify-center gap-4 mb-4\">\n            <div className=\"p-3 bg-df-brick rounded-lg border border-df-steel\">\n              <CreditCard className=\"w-8 h-8 text-df-cyan\" />\n            </div>\n            <h1 className=\"text-4xl neon-heading\">Payment Help</h1>\n          </div>\n          <p className=\"text-df-fog text-lg\">Everything you need to know about payments on DaddyFanz</p>\n        </div>\n\n        <div className=\"grid md:grid-cols-3 gap-6 mb-12\">\n          <Card className=\"bg-df-brick border-df-steel text-center\" data-testid=\"card-secure-payments\">\n            <CardHeader>\n              <div className=\"w-12 h-12 bg-df-obsidian rounded-full flex items-center justify-center mx-auto mb-2\">\n                <Shield className=\"w-6 h-6 text-df-cyan\" />\n              </div>\n              <CardTitle className=\"text-df-snow\">Secure Payments</CardTitle>\n            </CardHeader>\n            <CardContent>\n              <p className=\"text-df-fog text-sm\">Industry-leading payment processors</p>\n            </CardContent>\n          </Card>\n\n          <Card className=\"bg-df-brick border-df-steel text-center\" data-testid=\"card-adult-friendly\">\n            <CardHeader>\n              <div className=\"w-12 h-12 bg-df-obsidian rounded-full flex items-center justify-center mx-auto mb-2\">\n                <CheckCircle className=\"w-6 h-6 text-df-gold\" />\n              </div>\n              <CardTitle className=\"text-df-snow\">Adult-Friendly</CardTitle>\n            </CardHeader>\n            <CardContent>\n              <p className=\"text-df-fog text-sm\">Specialized processors for adult content</p>\n            </CardContent>\n          </Card>\n\n          <Card className=\"bg-df-brick border-df-steel text-center\" data-testid=\"card-instant-access\">\n            <CardHeader>\n              <div className=\"w-12 h-12 bg-df-obsidian rounded-full flex items-center justify-center mx-auto mb-2\">\n                <DollarSign className=\"w-6 h-6 text-df-cyan\" />\n              </div>\n              <CardTitle className=\"text-df-snow\">Instant Access</CardTitle>\n            </CardHeader>\n            <CardContent>\n              <p className=\"text-df-fog text-sm\">Immediate content access after payment</p>\n            </CardContent>\n          </Card>\n        </div>\n\n        <Card className=\"bg-df-brick border-df-steel mb-8\">\n          <CardHeader>\n            <CardTitle className=\"text-2xl text-df-snow\">Payment Processors</CardTitle>\n            <CardDescription className=\"text-df-fog\">\n              We work with trusted adult-friendly payment processors\n            </CardDescription>\n          </CardHeader>\n          <CardContent className=\"space-y-4\">\n            <div className=\"grid md:grid-cols-2 gap-4\">\n              <div className=\"p-4 bg-df-obsidian rounded border border-df-steel\">\n                <h3 className=\"text-df-snow font-semibold mb-2\">CCBill</h3>\n                <p className=\"text-df-fog text-sm\">Industry leader in adult payment processing</p>\n              </div>\n              <div className=\"p-4 bg-df-obsidian rounded border border-df-steel\">\n                <h3 className=\"text-df-snow font-semibold mb-2\">Segpay</h3>\n                <p className=\"text-df-fog text-sm\">Secure adult entertainment billing</p>\n              </div>\n              <div className=\"p-4 bg-df-obsidian rounded border border-df-steel\">\n                <h3 className=\"text-df-snow font-semibold mb-2\">Epoch</h3>\n                <p className=\"text-df-fog text-sm\">Global payment solutions</p>\n              </div>\n              <div className=\"p-4 bg-df-obsidian rounded border border-df-steel\">\n                <h3 className=\"text-df-snow font-semibold mb-2\">Paxum</h3>\n                <p className=\"text-df-fog text-sm\">Creator payout processing</p>\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n\n        <Card className=\"bg-df-brick border-df-steel\">\n          <CardHeader>\n            <CardTitle className=\"text-2xl text-df-snow flex items-center gap-2\">\n              <HelpCircle className=\"w-6 h-6 text-df-cyan\" />\n              Frequently Asked Questions\n            </CardTitle>\n          </CardHeader>\n          <CardContent>\n            <Accordion type=\"single\" collapsible className=\"w-full\">\n              <AccordionItem value=\"item-1\" className=\"border-df-steel\">\n                <AccordionTrigger className=\"text-df-snow hover:text-df-cyan\" data-testid=\"accordion-payment-methods\">\n                  What payment methods are accepted?\n                </AccordionTrigger>\n                <AccordionContent className=\"text-df-fog\">\n                  We accept credit cards (Visa, Mastercard, American Express, Discover), debit cards, and select digital payment methods. All transactions are processed through our secure adult-friendly payment processors.\n                </AccordionContent>\n              </AccordionItem>\n\n              <AccordionItem value=\"item-2\" className=\"border-df-steel\">\n                <AccordionTrigger className=\"text-df-snow hover:text-df-cyan\" data-testid=\"accordion-billing-descriptor\">\n                  How will charges appear on my statement?\n                </AccordionTrigger>\n                <AccordionContent className=\"text-df-fog\">\n                  Charges appear with discrete billing descriptors that do not reveal the adult nature of the content. The exact descriptor depends on your payment processor but will appear as a generic company name.\n                </AccordionContent>\n              </AccordionItem>\n\n              <AccordionItem value=\"item-3\" className=\"border-df-steel\">\n                <AccordionTrigger className=\"text-df-snow hover:text-df-cyan\" data-testid=\"accordion-subscription-cancel\">\n                  Can I cancel my subscription?\n                </AccordionTrigger>\n                <AccordionContent className=\"text-df-fog\">\n                  Yes, you can cancel your subscription at any time from your account settings. You'll retain access until the end of your current billing period. No refunds are provided for partial months.\n                </AccordionContent>\n              </AccordionItem>\n\n              <AccordionItem value=\"item-4\" className=\"border-df-steel\">\n                <AccordionTrigger className=\"text-df-snow hover:text-df-cyan\" data-testid=\"accordion-payment-failed\">\n                  What if my payment fails?\n                </AccordionTrigger>\n                <AccordionContent className=\"text-df-fog\">\n                  Payment failures can occur due to insufficient funds, expired cards, or bank blocks on adult content purchases. Contact your bank to authorize adult content transactions, or try a different payment method. Our support team can assist with payment issues.\n                </AccordionContent>\n              </AccordionItem>\n\n              <AccordionItem value=\"item-5\" className=\"border-df-steel\">\n                <AccordionTrigger className=\"text-df-snow hover:text-df-cyan\" data-testid=\"accordion-creator-payouts\">\n                  How do creator payouts work?\n                </AccordionTrigger>\n                <AccordionContent className=\"text-df-fog\">\n                  Creators receive payouts bi-weekly after a 7-day holding period for chargebacks. Minimum payout is $50. Payouts are processed via Paxum, ePayService, or wire transfer. Platform takes a 20% commission on all earnings.\n                </AccordionContent>\n              </AccordionItem>\n\n              <AccordionItem value=\"item-6\" className=\"border-df-steel\">\n                <AccordionTrigger className=\"text-df-snow hover:text-df-cyan\" data-testid=\"accordion-refund-policy\">\n                  What is your refund policy?\n                </AccordionTrigger>\n                <AccordionContent className=\"text-df-fog\">\n                  Digital content sales are generally non-refundable due to the instant delivery nature. Refunds may be granted for technical issues preventing content access, duplicate charges, or unauthorized transactions. Contact support within 48 hours for refund requests.\n                </AccordionContent>\n              </AccordionItem>\n\n              <AccordionItem value=\"item-7\" className=\"border-df-steel\">\n                <AccordionTrigger className=\"text-df-snow hover:text-df-cyan\" data-testid=\"accordion-payment-security\">\n                  Is my payment information secure?\n                </AccordionTrigger>\n                <AccordionContent className=\"text-df-fog\">\n                  Yes. We use PCI-DSS compliant payment processors with end-to-end encryption. DaddyFanz never stores your complete credit card information. All payment data is tokenized and secured by our payment processors.\n                </AccordionContent>\n              </AccordionItem>\n\n              <AccordionItem value=\"item-8\" className=\"border-df-steel\">\n                <AccordionTrigger className=\"text-df-snow hover:text-df-cyan\" data-testid=\"accordion-currency\">\n                  What currencies are supported?\n                </AccordionTrigger>\n                <AccordionContent className=\"text-df-fog\">\n                  Transactions are processed in USD (US Dollars). Your bank may convert the charge to your local currency and may apply foreign transaction fees. Exchange rates are determined by your card issuer.\n                </AccordionContent>\n              </AccordionItem>\n            </Accordion>\n          </CardContent>\n        </Card>\n\n        <Card className=\"bg-df-brick border-df-steel mt-8\">\n          <CardHeader>\n            <CardTitle className=\"text-df-snow flex items-center gap-2\">\n              <AlertCircle className=\"w-6 h-6 text-df-gold\" />\n              Need More Help?\n            </CardTitle>\n          </CardHeader>\n          <CardContent>\n            <p className=\"text-df-fog mb-4\">\n              If you're experiencing payment issues or have questions not covered here, our support team is ready to help.\n            </p>\n            <div className=\"space-y-2\">\n              <p className=\"text-df-fog text-sm\">\n                <strong className=\"text-df-snow\">Email:</strong>{\" \"}\n                <a href=\"mailto:billing@daddiesfanz.com\" className=\"text-df-cyan hover:underline\" data-testid=\"link-billing-email\">\n                  billing@daddiesfanz.com\n                </a>\n              </p>\n              <p className=\"text-df-fog text-sm\">\n                <strong className=\"text-df-snow\">Response Time:</strong> Within 24 hours\n              </p>\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n      <Footer />\n    </div>\n  );\n}\n","size_bytes":11223},"client/src/pages/NftDashboard.tsx":{"content":"import { useAuth } from \"@/hooks/useAuth\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport Header from \"@/components/layout/Header\";\nimport Footer from \"@/components/layout/Footer\";\nimport { Card, CardContent, CardHeader, CardTitle, CardDescription } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { useEffect, useState } from \"react\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { Coins, FileCode, TrendingUp, Plus, ExternalLink, Wallet } from \"lucide-react\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogTrigger, DialogDescription } from \"@/components/ui/dialog\";\nimport { Form, FormControl, FormField, FormItem, FormLabel, FormMessage } from \"@/components/ui/form\";\nimport { Input } from \"@/components/ui/input\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { useForm } from \"react-hook-form\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport { z } from \"zod\";\n\ninterface NftContract {\n  id: string;\n  creatorId: string;\n  blockchain: string;\n  contractAddress: string;\n  royaltyPercentage: number;\n  _count?: {\n    mints: number;\n  };\n}\n\ninterface RoyaltyStats {\n  totalRoyaltyAmount: string;\n  totalSales: number;\n}\n\ninterface MediaAsset {\n  id: string;\n  title: string;\n  mimeType: string;\n}\n\nconst deployContractSchema = z.object({\n  blockchain: z.enum([\"ethereum\", \"polygon\", \"solana\", \"binance\"]),\n  contractAddress: z.string().min(1, \"Contract address is required\"),\n  royaltyPercentage: z.coerce.number().min(0).max(50, \"Royalty must be between 0-50%\"),\n});\n\nconst mintNftSchema = z.object({\n  contractId: z.string().min(1, \"Contract is required\"),\n  mediaId: z.string().min(1, \"Media asset is required\"),\n  tokenId: z.string().min(1, \"Token ID is required\"),\n});\n\nexport default function NftDashboard() {\n  const { user, isLoading, isAuthenticated } = useAuth();\n  const { toast } = useToast();\n  const [deployDialogOpen, setDeployDialogOpen] = useState(false);\n  const [mintDialogOpen, setMintDialogOpen] = useState(false);\n\n  useEffect(() => {\n    if (!isLoading && !isAuthenticated) {\n      toast({\n        title: \"Unauthorized\",\n        description: \"Please log in to access NFT Dashboard\",\n        variant: \"destructive\",\n      });\n      setTimeout(() => {\n        window.location.href = \"/api/login\";\n      }, 500);\n      return;\n    }\n  }, [isAuthenticated, isLoading, toast]);\n\n  const isCreator = user?.role === \"creator\" || user?.role === \"admin\";\n\n  const { data: contracts, isLoading: contractsLoading } = useQuery<NftContract[]>({\n    queryKey: [`/api/nft/contracts/${user?.id}`],\n    enabled: isAuthenticated && isCreator && !!user?.id,\n  });\n\n  const { data: royaltyStats } = useQuery<RoyaltyStats>({\n    queryKey: [`/api/nft/royalties/stats/${user?.id}`],\n    enabled: isAuthenticated && isCreator && !!user?.id,\n  });\n\n  const { data: mediaAssets } = useQuery<MediaAsset[]>({\n    queryKey: [\"/api/media\"],\n    enabled: isAuthenticated && isCreator,\n  });\n\n  const { data: royalties } = useQuery<any[]>({\n    queryKey: [`/api/nft/royalties/${user?.id}`],\n    enabled: isAuthenticated && isCreator && !!user?.id,\n  });\n\n  // Get all minted NFTs for contracts with mints\n  const contractsWithMints = contracts?.filter(c => c._count && c._count.mints > 0) || [];\n  const { data: allMints } = useQuery<any[]>({\n    queryKey: [`/api/nft/mints/all/${user?.id}`],\n    queryFn: async () => {\n      // Fetch mints for all contracts\n      const mintsPromises = contractsWithMints.map(contract =>\n        fetch(`/api/nft/mints/${contract.id}`, {\n          credentials: 'include',\n          headers: {\n            'Authorization': `Bearer ${localStorage.getItem('authToken')}`\n          }\n        }).then(res => res.json()).then(mints => ({\n          contractId: contract.id,\n          mints: Array.isArray(mints) ? mints : []\n        }))\n      );\n      const results = await Promise.all(mintsPromises);\n      return results;\n    },\n    enabled: isAuthenticated && isCreator && contractsWithMints.length > 0,\n  });\n\n  const deployForm = useForm({\n    resolver: zodResolver(deployContractSchema),\n    defaultValues: {\n      blockchain: \"ethereum\" as const,\n      contractAddress: \"\",\n      royaltyPercentage: 10,\n    },\n  });\n\n  const mintForm = useForm({\n    resolver: zodResolver(mintNftSchema),\n    defaultValues: {\n      contractId: \"\",\n      mediaId: \"\",\n      tokenId: \"\",\n    },\n  });\n\n  const deployContractMutation = useMutation({\n    mutationFn: async (data: z.infer<typeof deployContractSchema>) => {\n      const response = await apiRequest(\"POST\", \"/api/nft/deploy-contract\", data);\n      return response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [`/api/nft/contracts/${user?.id}`] });\n      queryClient.invalidateQueries({ queryKey: [`/api/nft/mints/all/${user?.id}`] });\n      toast({\n        title: \"Success\",\n        description: \"NFT contract deployed successfully\",\n      });\n      setDeployDialogOpen(false);\n      deployForm.reset();\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"Error\",\n        description: error.message || \"Failed to deploy contract\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const mintNftMutation = useMutation({\n    mutationFn: async (data: z.infer<typeof mintNftSchema>) => {\n      const response = await apiRequest(\"POST\", \"/api/nft/mint\", data);\n      return response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [`/api/nft/contracts/${user?.id}`] });\n      queryClient.invalidateQueries({ queryKey: [`/api/nft/mints/all/${user?.id}`] });\n      toast({\n        title: \"Success\",\n        description: \"NFT minted successfully\",\n      });\n      setMintDialogOpen(false);\n      mintForm.reset();\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"Error\",\n        description: error.message || \"Failed to mint NFT\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  if (isLoading || contractsLoading) {\n    return (\n      <div className=\"min-h-screen bg-df-dungeon flex items-center justify-center\">\n        <div className=\"text-xl neon-heading\">Loading NFT Dashboard...</div>\n      </div>\n    );\n  }\n\n  if (!isAuthenticated || !user) {\n    return null;\n  }\n\n  if (!isCreator) {\n    return (\n      <div className=\"min-h-screen bg-df-dungeon\">\n        <Header />\n        <main className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8\">\n          <Card className=\"card-df\">\n            <CardContent className=\"pt-6\">\n              <div className=\"text-center py-12\">\n                <Wallet className=\"mx-auto h-12 w-12 text-df-fog mb-4\" />\n                <h3 className=\"text-xl font-semibold text-df-snow mb-2\">Creator Access Required</h3>\n                <p className=\"text-df-fog\">NFT Dashboard is only available for creators</p>\n              </div>\n            </CardContent>\n          </Card>\n        </main>\n        <Footer />\n      </div>\n    );\n  }\n\n  const totalRoyalties = royaltyStats?.totalRoyaltyAmount || \"0\";\n  const totalSales = royaltyStats?.totalSales || 0;\n\n  return (\n    <div className=\"min-h-screen bg-df-dungeon\">\n      <Header />\n      \n      <main className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8\">\n        <div className=\"mb-8\">\n          <h1 className=\"text-3xl font-display font-bold text-df-snow mb-2\">\n            <span className=\"neon-heading\">NFT Dashboard</span>\n          </h1>\n          <p className=\"text-df-fog\">\n            Mint your content as NFTs and earn perpetual royalties\n          </p>\n        </div>\n\n        <div className=\"grid grid-cols-1 md:grid-cols-3 gap-6 mb-8\">\n          <Card className=\"card-df\">\n            <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\n              <CardTitle className=\"text-sm font-medium text-df-fog\">Total Royalties</CardTitle>\n              <TrendingUp className=\"h-4 w-4 text-df-cyan\" />\n            </CardHeader>\n            <CardContent>\n              <div className=\"text-2xl font-bold text-df-cyan\" data-testid=\"text-total-royalties\">{totalRoyalties} ETH</div>\n              <p className=\"text-xs text-df-fog mt-1\">From {totalSales} sales</p>\n            </CardContent>\n          </Card>\n\n          <Card className=\"card-df\">\n            <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\n              <CardTitle className=\"text-sm font-medium text-df-fog\">Active Contracts</CardTitle>\n              <FileCode className=\"h-4 w-4 text-df-gold\" />\n            </CardHeader>\n            <CardContent>\n              <div className=\"text-2xl font-bold text-df-gold\" data-testid=\"text-contract-count\">{contracts?.length || 0}</div>\n              <p className=\"text-xs text-df-fog mt-1\">Deployed on blockchain</p>\n            </CardContent>\n          </Card>\n\n          <Card className=\"card-df\">\n            <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\n              <CardTitle className=\"text-sm font-medium text-df-fog\">Total Mints</CardTitle>\n              <Coins className=\"h-4 w-4 text-df-cyan\" />\n            </CardHeader>\n            <CardContent>\n              <div className=\"text-2xl font-bold text-df-cyan\" data-testid=\"text-total-mints\">\n                {contracts?.reduce((sum: number, c: any) => sum + (c._count?.mints || 0), 0) || 0}\n              </div>\n              <p className=\"text-xs text-df-fog mt-1\">NFTs minted</p>\n            </CardContent>\n          </Card>\n        </div>\n\n        <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-8\">\n          <Card className=\"card-df\">\n            <CardHeader>\n              <div className=\"flex items-center justify-between\">\n                <div>\n                  <CardTitle className=\"text-xl neon-subheading\">Smart Contracts</CardTitle>\n                  <CardDescription className=\"text-df-fog mt-1\">\n                    Deploy and manage your NFT contracts\n                  </CardDescription>\n                </div>\n                <Dialog open={deployDialogOpen} onOpenChange={setDeployDialogOpen}>\n                  <DialogTrigger asChild>\n                    <Button className=\"btn-primary\" data-testid=\"button-deploy-contract\">\n                      <Plus className=\"mr-2 h-4 w-4\" />\n                      Deploy Contract\n                    </Button>\n                  </DialogTrigger>\n                  <DialogContent className=\"bg-df-ink border-df-steel\">\n                    <DialogHeader>\n                      <DialogTitle className=\"text-df-snow\">Deploy NFT Contract</DialogTitle>\n                      <DialogDescription className=\"text-df-fog\">\n                        Deploy a new smart contract for your NFTs\n                      </DialogDescription>\n                    </DialogHeader>\n                    <Form {...deployForm}>\n                      <form onSubmit={deployForm.handleSubmit((data) => deployContractMutation.mutate(data))} className=\"space-y-4\">\n                        <FormField\n                          control={deployForm.control}\n                          name=\"blockchain\"\n                          render={({ field }) => (\n                            <FormItem>\n                              <FormLabel className=\"text-df-snow\">Blockchain</FormLabel>\n                              <Select onValueChange={field.onChange} defaultValue={field.value}>\n                                <FormControl>\n                                  <SelectTrigger className=\"input-df\" data-testid=\"select-blockchain\">\n                                    <SelectValue placeholder=\"Select blockchain\" />\n                                  </SelectTrigger>\n                                </FormControl>\n                                <SelectContent className=\"bg-df-ink border-df-steel\">\n                                  <SelectItem value=\"ethereum\">Ethereum</SelectItem>\n                                  <SelectItem value=\"polygon\">Polygon</SelectItem>\n                                  <SelectItem value=\"solana\">Solana</SelectItem>\n                                  <SelectItem value=\"binance\">Binance Smart Chain</SelectItem>\n                                </SelectContent>\n                              </Select>\n                              <FormMessage className=\"text-red-400\" />\n                            </FormItem>\n                          )}\n                        />\n                        <FormField\n                          control={deployForm.control}\n                          name=\"contractAddress\"\n                          render={({ field }) => (\n                            <FormItem>\n                              <FormLabel className=\"text-df-snow\">Contract Address</FormLabel>\n                              <FormControl>\n                                <Input {...field} className=\"input-df\" placeholder=\"0x...\" data-testid=\"input-contract-address\" />\n                              </FormControl>\n                              <FormMessage className=\"text-red-400\" />\n                            </FormItem>\n                          )}\n                        />\n                        <FormField\n                          control={deployForm.control}\n                          name=\"royaltyPercentage\"\n                          render={({ field }) => (\n                            <FormItem>\n                              <FormLabel className=\"text-df-snow\">Royalty Percentage (0-50%)</FormLabel>\n                              <FormControl>\n                                <Input {...field} type=\"number\" min=\"0\" max=\"50\" className=\"input-df\" data-testid=\"input-royalty-percentage\" />\n                              </FormControl>\n                              <FormMessage className=\"text-red-400\" />\n                            </FormItem>\n                          )}\n                        />\n                        <Button type=\"submit\" className=\"btn-primary w-full\" disabled={deployContractMutation.isPending} data-testid=\"button-submit-deploy\">\n                          {deployContractMutation.isPending ? \"Deploying...\" : \"Deploy Contract\"}\n                        </Button>\n                      </form>\n                    </Form>\n                  </DialogContent>\n                </Dialog>\n              </div>\n            </CardHeader>\n            <CardContent>\n              {contracts && contracts.length > 0 ? (\n                <div className=\"space-y-4\">\n                  {contracts.map((contract: any) => (\n                    <div key={contract.id} className=\"border border-df-steel rounded-lg p-4\" data-testid={`card-contract-${contract.id}`}>\n                      <div className=\"flex items-start justify-between\">\n                        <div className=\"flex-1\">\n                          <div className=\"flex items-center gap-2 mb-2\">\n                            <span className=\"text-df-gold font-semibold\">{contract.blockchain}</span>\n                            <span className=\"text-xs bg-df-steel px-2 py-1 rounded text-df-fog\">\n                              {contract.royaltyPercentage}% royalty\n                            </span>\n                          </div>\n                          <p className=\"text-sm text-df-fog font-mono break-all\">{contract.contractAddress}</p>\n                          <p className=\"text-xs text-df-fog mt-2\">{contract._count?.mints || 0} NFTs minted</p>\n                        </div>\n                        <Button \n                          variant=\"ghost\" \n                          size=\"sm\" \n                          className=\"text-df-cyan hover:text-df-gold\"\n                          data-testid={`button-view-contract-${contract.id}`}\n                        >\n                          <ExternalLink className=\"h-4 w-4\" />\n                        </Button>\n                      </div>\n                    </div>\n                  ))}\n                </div>\n              ) : (\n                <div className=\"text-center py-8\">\n                  <FileCode className=\"mx-auto h-12 w-12 text-df-fog mb-4\" />\n                  <p className=\"text-df-fog\">No contracts deployed yet</p>\n                  <p className=\"text-sm text-df-fog mt-2\">Deploy your first NFT contract to get started</p>\n                </div>\n              )}\n            </CardContent>\n          </Card>\n\n          <Card className=\"card-df\">\n            <CardHeader>\n              <div className=\"flex items-center justify-between\">\n                <div>\n                  <CardTitle className=\"text-xl neon-subheading\">Mint NFTs</CardTitle>\n                  <CardDescription className=\"text-df-fog mt-1\">\n                    Turn your content into NFTs\n                  </CardDescription>\n                </div>\n                <Dialog open={mintDialogOpen} onOpenChange={setMintDialogOpen}>\n                  <DialogTrigger asChild>\n                    <Button \n                      className=\"btn-primary\" \n                      disabled={!contracts || contracts.length === 0}\n                      data-testid=\"button-mint-nft\"\n                    >\n                      <Plus className=\"mr-2 h-4 w-4\" />\n                      Mint NFT\n                    </Button>\n                  </DialogTrigger>\n                  <DialogContent className=\"bg-df-ink border-df-steel\">\n                    <DialogHeader>\n                      <DialogTitle className=\"text-df-snow\">Mint NFT</DialogTitle>\n                      <DialogDescription className=\"text-df-fog\">\n                        Mint your content as an NFT\n                      </DialogDescription>\n                    </DialogHeader>\n                    <Form {...mintForm}>\n                      <form onSubmit={mintForm.handleSubmit((data) => mintNftMutation.mutate(data))} className=\"space-y-4\">\n                        <FormField\n                          control={mintForm.control}\n                          name=\"contractId\"\n                          render={({ field }) => (\n                            <FormItem>\n                              <FormLabel className=\"text-df-snow\">Contract</FormLabel>\n                              <Select onValueChange={field.onChange} value={field.value}>\n                                <FormControl>\n                                  <SelectTrigger className=\"input-df\" data-testid=\"select-contract\">\n                                    <SelectValue placeholder=\"Select contract\" />\n                                  </SelectTrigger>\n                                </FormControl>\n                                <SelectContent className=\"bg-df-ink border-df-steel\">\n                                  {contracts?.map((contract: any) => (\n                                    <SelectItem key={contract.id} value={contract.id}>\n                                      {contract.blockchain} - {contract.contractAddress.slice(0, 10)}...\n                                    </SelectItem>\n                                  ))}\n                                </SelectContent>\n                              </Select>\n                              <FormMessage className=\"text-red-400\" />\n                            </FormItem>\n                          )}\n                        />\n                        <FormField\n                          control={mintForm.control}\n                          name=\"mediaId\"\n                          render={({ field }) => (\n                            <FormItem>\n                              <FormLabel className=\"text-df-snow\">Media Asset</FormLabel>\n                              <Select onValueChange={field.onChange} value={field.value}>\n                                <FormControl>\n                                  <SelectTrigger className=\"input-df\" data-testid=\"select-media\">\n                                    <SelectValue placeholder=\"Select media\" />\n                                  </SelectTrigger>\n                                </FormControl>\n                                <SelectContent className=\"bg-df-ink border-df-steel\">\n                                  {mediaAssets?.map((media: any) => (\n                                    <SelectItem key={media.id} value={media.id}>\n                                      {media.title || 'Untitled'} ({media.mimeType})\n                                    </SelectItem>\n                                  ))}\n                                </SelectContent>\n                              </Select>\n                              <FormMessage className=\"text-red-400\" />\n                            </FormItem>\n                          )}\n                        />\n                        <FormField\n                          control={mintForm.control}\n                          name=\"tokenId\"\n                          render={({ field }) => (\n                            <FormItem>\n                              <FormLabel className=\"text-df-snow\">Token ID</FormLabel>\n                              <FormControl>\n                                <Input {...field} className=\"input-df\" placeholder=\"1\" data-testid=\"input-token-id\" />\n                              </FormControl>\n                              <FormMessage className=\"text-red-400\" />\n                            </FormItem>\n                          )}\n                        />\n                        <Button type=\"submit\" className=\"btn-primary w-full\" disabled={mintNftMutation.isPending} data-testid=\"button-submit-mint\">\n                          {mintNftMutation.isPending ? \"Minting...\" : \"Mint NFT\"}\n                        </Button>\n                      </form>\n                    </Form>\n                  </DialogContent>\n                </Dialog>\n              </div>\n            </CardHeader>\n            <CardContent>\n              {allMints && allMints.length > 0 ? (\n                <div className=\"space-y-4\">\n                  {allMints.map((contractMints: any) => {\n                    const contract = contracts?.find(c => c.id === contractMints.contractId);\n                    if (!contract || !contractMints.mints || contractMints.mints.length === 0) return null;\n                    \n                    return (\n                      <div key={contract.id} className=\"border border-df-steel rounded-lg p-4\" data-testid={`section-mints-${contract.id}`}>\n                        <div className=\"flex items-center justify-between mb-3\">\n                          <span className=\"text-df-gold font-semibold\">{contract.blockchain}</span>\n                          <span className=\"text-xs text-df-fog\">{contractMints.mints.length} minted</span>\n                        </div>\n                        <div className=\"space-y-2\">\n                          {contractMints.mints.map((mint: any) => (\n                            <div \n                              key={mint.id} \n                              className=\"flex items-center justify-between py-2 px-3 bg-df-ink/30 rounded\"\n                              data-testid={`item-mint-${mint.id}`}\n                            >\n                              <div>\n                                <p className=\"text-sm text-df-snow\">Token #{mint.tokenId}</p>\n                                <p className=\"text-xs text-df-fog\">{mint.media?.title || 'Untitled NFT'}</p>\n                              </div>\n                              <div className=\"text-xs text-df-fog\">\n                                {new Date(mint.createdAt).toLocaleDateString()}\n                              </div>\n                            </div>\n                          ))}\n                        </div>\n                      </div>\n                    );\n                  })}\n                </div>\n              ) : (\n                <div className=\"text-center py-8\">\n                  <Coins className=\"mx-auto h-12 w-12 text-df-fog mb-4\" />\n                  <p className=\"text-df-fog\">No NFTs minted yet</p>\n                  <p className=\"text-sm text-df-fog mt-2\">\n                    {contracts && contracts.length > 0 \n                      ? \"Mint your first NFT to get started\"\n                      : \"Deploy a contract first to mint NFTs\"}\n                  </p>\n                </div>\n              )}\n            </CardContent>\n          </Card>\n        </div>\n\n        {royalties && royalties.length > 0 && (\n          <Card className=\"card-df mt-8\">\n            <CardHeader>\n              <CardTitle className=\"text-xl neon-subheading\">Royalty History</CardTitle>\n              <CardDescription className=\"text-df-fog mt-1\">\n                Track your NFT secondary sales royalties\n              </CardDescription>\n            </CardHeader>\n            <CardContent>\n              <div className=\"overflow-x-auto\">\n                <table className=\"w-full\">\n                  <thead>\n                    <tr className=\"border-b border-df-steel\">\n                      <th className=\"text-left py-3 px-4 text-sm font-medium text-df-fog\">Date</th>\n                      <th className=\"text-left py-3 px-4 text-sm font-medium text-df-fog\">Contract</th>\n                      <th className=\"text-left py-3 px-4 text-sm font-medium text-df-fog\">Sale Price</th>\n                      <th className=\"text-left py-3 px-4 text-sm font-medium text-df-fog\">Royalty</th>\n                      <th className=\"text-left py-3 px-4 text-sm font-medium text-df-fog\">Transaction</th>\n                    </tr>\n                  </thead>\n                  <tbody>\n                    {royalties.map((royalty: any) => (\n                      <tr key={royalty.id} className=\"border-b border-df-steel/50\" data-testid={`row-royalty-${royalty.id}`}>\n                        <td className=\"py-3 px-4 text-sm text-df-snow\">\n                          {new Date(royalty.createdAt).toLocaleDateString()}\n                        </td>\n                        <td className=\"py-3 px-4 text-sm text-df-fog font-mono\">\n                          {royalty.contract?.contractAddress?.slice(0, 10)}...\n                        </td>\n                        <td className=\"py-3 px-4 text-sm text-df-cyan\">\n                          {royalty.salePrice} ETH\n                        </td>\n                        <td className=\"py-3 px-4 text-sm text-df-gold font-semibold\">\n                          {royalty.royaltyAmount} ETH\n                        </td>\n                        <td className=\"py-3 px-4 text-sm\">\n                          <a\n                            href={`https://etherscan.io/tx/${royalty.transactionHash}`}\n                            target=\"_blank\"\n                            rel=\"noopener noreferrer\"\n                            className=\"text-df-cyan hover:text-df-gold transition-colors\"\n                            data-testid={`link-tx-${royalty.id}`}\n                          >\n                            <ExternalLink className=\"h-4 w-4\" />\n                          </a>\n                        </td>\n                      </tr>\n                    ))}\n                  </tbody>\n                </table>\n              </div>\n            </CardContent>\n          </Card>\n        )}\n      </main>\n      \n      <Footer />\n    </div>\n  );\n}\n","size_bytes":27190},"client/src/components/ui/resizable.tsx":{"content":"\"use client\"\n\nimport { GripVertical } from \"lucide-react\"\nimport * as ResizablePrimitive from \"react-resizable-panels\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ResizablePanelGroup = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof ResizablePrimitive.PanelGroup>) => (\n  <ResizablePrimitive.PanelGroup\n    className={cn(\n      \"flex h-full w-full data-[panel-group-direction=vertical]:flex-col\",\n      className\n    )}\n    {...props}\n  />\n)\n\nconst ResizablePanel = ResizablePrimitive.Panel\n\nconst ResizableHandle = ({\n  withHandle,\n  className,\n  ...props\n}: React.ComponentProps<typeof ResizablePrimitive.PanelResizeHandle> & {\n  withHandle?: boolean\n}) => (\n  <ResizablePrimitive.PanelResizeHandle\n    className={cn(\n      \"relative flex w-px items-center justify-center bg-border after:absolute after:inset-y-0 after:left-1/2 after:w-1 after:-translate-x-1/2 focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring focus-visible:ring-offset-1 data-[panel-group-direction=vertical]:h-px data-[panel-group-direction=vertical]:w-full data-[panel-group-direction=vertical]:after:left-0 data-[panel-group-direction=vertical]:after:h-1 data-[panel-group-direction=vertical]:after:w-full data-[panel-group-direction=vertical]:after:-translate-y-1/2 data-[panel-group-direction=vertical]:after:translate-x-0 [&[data-panel-group-direction=vertical]>div]:rotate-90\",\n      className\n    )}\n    {...props}\n  >\n    {withHandle && (\n      <div className=\"z-10 flex h-4 w-3 items-center justify-center rounded-sm border bg-border\">\n        <GripVertical className=\"h-2.5 w-2.5\" />\n      </div>\n    )}\n  </ResizablePrimitive.PanelResizeHandle>\n)\n\nexport { ResizablePanelGroup, ResizablePanel, ResizableHandle }\n","size_bytes":1723},"client/src/pages/CreatorLoanDashboard.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { Form, FormControl, FormField, FormItem, FormLabel, FormMessage } from \"@/components/ui/form\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { useForm } from \"react-hook-form\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport { z } from \"zod\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport { DollarSign, Calendar, TrendingUp, Clock, CheckCircle2, XCircle, AlertCircle } from \"lucide-react\";\nimport type { LoanProgram, LoanApplication, LoanOffer, LoanRepayment } from \"@shared/schema\";\n\nconst applyFormSchema = z.object({\n  programId: z.string().uuid(\"Please select a loan program\"),\n  requestedAmount: z.coerce.number().positive(\"Amount must be greater than 0\").finite(\"Amount must be a valid number\"),\n  purpose: z.string().min(10, \"Please provide a detailed purpose (min 10 characters)\"),\n  businessPlan: z.string().optional(),\n});\n\ntype ApplyFormData = z.infer<typeof applyFormSchema>;\n\nexport default function CreatorLoanDashboard() {\n  const { toast } = useToast();\n  const [showApplyForm, setShowApplyForm] = useState(false);\n\n  const { data: programs, isLoading: programsLoading } = useQuery<LoanProgram[]>({\n    queryKey: [\"/api/loans/programs\"],\n  });\n\n  const { data: applications, isLoading: applicationsLoading } = useQuery<LoanApplication[]>({\n    queryKey: [\"/api/loans/applications/creator\"],\n  });\n\n  const { data: activeOffers, isLoading: offersLoading } = useQuery<(LoanOffer & { repayments?: LoanRepayment[] })[]>({\n    queryKey: [\"/api/loans/offers/creator\"],\n  });\n\n  const form = useForm<ApplyFormData>({\n    resolver: zodResolver(applyFormSchema),\n    defaultValues: {\n      programId: \"\",\n      requestedAmount: 0,\n      purpose: \"\",\n      businessPlan: \"\",\n    },\n  });\n\n  const applyMutation = useMutation({\n    mutationFn: async (data: ApplyFormData) => {\n      // Validate amount is within program bounds\n      const selectedProgram = programs?.find(p => p.id === data.programId);\n      if (selectedProgram) {\n        const amountCents = Math.round(data.requestedAmount * 100);\n        const minCents = selectedProgram.minLoanAmount;\n        const maxCents = selectedProgram.maxLoanAmount;\n        \n        if (amountCents < minCents || amountCents > maxCents) {\n          throw new Error(`Amount must be between ${formatCurrency(minCents)} and ${formatCurrency(maxCents)}`);\n        }\n        \n        return apiRequest(\"/api/loans/applications\", \"POST\", {\n          programId: data.programId,\n          requestedAmount: amountCents,\n          purpose: data.purpose,\n          businessPlan: data.businessPlan || null,\n        });\n      }\n      \n      throw new Error(\"Please select a valid loan program\");\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/loans/applications/creator\"] });\n      toast({ title: \"Application submitted\", description: \"Your loan application has been submitted for review.\" });\n      form.reset();\n      setShowApplyForm(false);\n    },\n    onError: (error: any) => {\n      toast({ title: \"Application failed\", description: error.message, variant: \"destructive\" });\n    },\n  });\n\n  const acceptOfferMutation = useMutation({\n    mutationFn: async (offerId: string) => {\n      return apiRequest(`/api/loans/offers/${offerId}/accept`, \"POST\");\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/loans/offers/creator\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/loans/applications/creator\"] });\n      toast({ title: \"Offer accepted\", description: \"Loan funds are now in escrow and will be released to you.\" });\n    },\n    onError: (error: any) => {\n      toast({ title: \"Accept failed\", description: error.message, variant: \"destructive\" });\n    },\n  });\n\n  const rejectOfferMutation = useMutation({\n    mutationFn: async (offerId: string) => {\n      return apiRequest(`/api/loans/offers/${offerId}/reject`, \"POST\");\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/loans/offers/creator\"] });\n      toast({ title: \"Offer rejected\", description: \"The loan offer has been declined.\" });\n    },\n    onError: (error: any) => {\n      toast({ title: \"Reject failed\", description: error.message, variant: \"destructive\" });\n    },\n  });\n\n  const onSubmit = (data: ApplyFormData) => {\n    applyMutation.mutate(data);\n  };\n\n  const formatCurrency = (cents: number) => {\n    return new Intl.NumberFormat(\"en-US\", { style: \"currency\", currency: \"USD\" }).format(cents / 100);\n  };\n\n  const getStatusBadge = (status: string) => {\n    const variants: Record<string, { variant: \"default\" | \"secondary\" | \"destructive\" | \"outline\", icon: any }> = {\n      pending: { variant: \"outline\", icon: Clock },\n      approved: { variant: \"default\", icon: CheckCircle2 },\n      active: { variant: \"default\", icon: TrendingUp },\n      repaid: { variant: \"secondary\", icon: CheckCircle2 },\n      defaulted: { variant: \"destructive\", icon: XCircle },\n      cancelled: { variant: \"secondary\", icon: XCircle },\n    };\n    const config = variants[status] || variants.pending;\n    const Icon = config.icon;\n    return (\n      <Badge variant={config.variant} data-testid={`badge-status-${status}`}>\n        <Icon className=\"w-3 h-3 mr-1\" />\n        {status}\n      </Badge>\n    );\n  };\n\n  return (\n    <div className=\"min-h-screen bg-gradient-to-br from-gray-900 via-gray-800 to-black text-white p-6\">\n      <div className=\"max-w-7xl mx-auto\">\n        <div className=\"flex items-center justify-between mb-8\">\n          <div>\n            <h1 className=\"text-4xl font-bold bg-gradient-to-r from-cyan-400 to-blue-500 bg-clip-text text-transparent\" data-testid=\"text-page-title\">\n              Creator Loan Dashboard\n            </h1>\n            <p className=\"text-gray-400 mt-2\">Apply for loans and manage repayments</p>\n          </div>\n          <Button\n            onClick={() => setShowApplyForm(!showApplyForm)}\n            className=\"bg-gradient-to-r from-cyan-500 to-blue-600 hover:from-cyan-600 hover:to-blue-700\"\n            data-testid=\"button-toggle-apply\"\n          >\n            {showApplyForm ? \"Cancel\" : \"Apply for Loan\"}\n          </Button>\n        </div>\n\n        {showApplyForm && (\n          <Card className=\"bg-gray-800/50 border-cyan-500/20 mb-8\" data-testid=\"card-apply-form\">\n            <CardHeader>\n              <CardTitle className=\"text-cyan-400\">Apply for a Loan</CardTitle>\n              <CardDescription>Select a program and submit your application</CardDescription>\n            </CardHeader>\n            <CardContent>\n              <Form {...form}>\n                <form onSubmit={form.handleSubmit(onSubmit)} className=\"space-y-6\">\n                  <FormField\n                    control={form.control}\n                    name=\"programId\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>Loan Program</FormLabel>\n                        <Select onValueChange={field.onChange} value={field.value}>\n                          <FormControl>\n                            <SelectTrigger className=\"bg-gray-700 border-gray-600\" data-testid=\"select-program\">\n                              <SelectValue placeholder=\"Select a program\" />\n                            </SelectTrigger>\n                          </FormControl>\n                          <SelectContent>\n                            {programs?.map((program) => (\n                              <SelectItem key={program.id} value={program.id} data-testid={`option-program-${program.id}`}>\n                                {program.name} ({formatCurrency(program.minLoanAmount)} - {formatCurrency(program.maxLoanAmount)})\n                              </SelectItem>\n                            ))}\n                          </SelectContent>\n                        </Select>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n\n                  <FormField\n                    control={form.control}\n                    name=\"requestedAmount\"\n                    render={({ field }) => {\n                      const selectedProgram = programs?.find(p => p.id === form.watch(\"programId\"));\n                      return (\n                        <FormItem>\n                          <FormLabel>Requested Amount (USD)</FormLabel>\n                          <FormControl>\n                            <Input\n                              type=\"number\"\n                              step=\"0.01\"\n                              placeholder=\"5000.00\"\n                              className=\"bg-gray-700 border-gray-600\"\n                              data-testid=\"input-amount\"\n                              {...field}\n                            />\n                          </FormControl>\n                          {selectedProgram && (\n                            <p className=\"text-sm text-gray-400\">\n                              Range: {formatCurrency(selectedProgram.minLoanAmount)} - {formatCurrency(selectedProgram.maxLoanAmount)}\n                            </p>\n                          )}\n                          <FormMessage />\n                        </FormItem>\n                      );\n                    }}\n                  />\n\n                  <FormField\n                    control={form.control}\n                    name=\"purpose\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>Loan Purpose</FormLabel>\n                        <FormControl>\n                          <Textarea\n                            placeholder=\"Explain how you'll use the funds...\"\n                            className=\"bg-gray-700 border-gray-600 min-h-[100px]\"\n                            data-testid=\"input-purpose\"\n                            {...field}\n                          />\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n\n                  <FormField\n                    control={form.control}\n                    name=\"businessPlan\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>Business Plan (Optional)</FormLabel>\n                        <FormControl>\n                          <Textarea\n                            placeholder=\"Detailed business plan...\"\n                            className=\"bg-gray-700 border-gray-600 min-h-[150px]\"\n                            data-testid=\"input-business-plan\"\n                            {...field}\n                          />\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n\n                  <Button\n                    type=\"submit\"\n                    disabled={applyMutation.isPending || programsLoading || !programs || programs.length === 0}\n                    className=\"w-full bg-gradient-to-r from-cyan-500 to-blue-600 hover:from-cyan-600 hover:to-blue-700\"\n                    data-testid=\"button-submit-application\"\n                  >\n                    {applyMutation.isPending ? \"Submitting...\" : programsLoading ? \"Loading programs...\" : programs?.length === 0 ? \"No programs available\" : \"Submit Application\"}\n                  </Button>\n                </form>\n              </Form>\n            </CardContent>\n          </Card>\n        )}\n\n        <Tabs defaultValue=\"programs\" className=\"space-y-6\">\n          <TabsList className=\"bg-gray-800 border border-gray-700\">\n            <TabsTrigger value=\"programs\" data-testid=\"tab-programs\">Available Programs</TabsTrigger>\n            <TabsTrigger value=\"applications\" data-testid=\"tab-applications\">My Applications</TabsTrigger>\n            <TabsTrigger value=\"active\" data-testid=\"tab-active\">Active Loans</TabsTrigger>\n          </TabsList>\n\n          <TabsContent value=\"programs\">\n            <div className=\"grid md:grid-cols-2 lg:grid-cols-3 gap-6\">\n              {programsLoading ? (\n                <div className=\"col-span-full text-center py-12 text-gray-400\">Loading programs...</div>\n              ) : programs?.length === 0 ? (\n                <div className=\"col-span-full text-center py-12 text-gray-400\">No programs available</div>\n              ) : (\n                programs?.map((program) => (\n                  <Card key={program.id} className=\"bg-gray-800/50 border-cyan-500/20\" data-testid={`card-program-${program.id}`}>\n                    <CardHeader>\n                      <CardTitle className=\"text-cyan-400\">{program.name}</CardTitle>\n                      <CardDescription>{program.description}</CardDescription>\n                    </CardHeader>\n                    <CardContent className=\"space-y-3\">\n                      <div className=\"flex justify-between\">\n                        <span className=\"text-gray-400\">Loan Range:</span>\n                        <span className=\"font-semibold\" data-testid={`text-range-${program.id}`}>\n                          {formatCurrency(program.minLoanAmount)} - {formatCurrency(program.maxLoanAmount)}\n                        </span>\n                      </div>\n                      <div className=\"flex justify-between\">\n                        <span className=\"text-gray-400\">Interest Rate:</span>\n                        <span className=\"font-semibold\" data-testid={`text-interest-${program.id}`}>{program.interestRatePercent}%</span>\n                      </div>\n                      <div className=\"flex justify-between\">\n                        <span className=\"text-gray-400\">Term:</span>\n                        <span className=\"font-semibold\" data-testid={`text-term-${program.id}`}>{program.termMonths} months</span>\n                      </div>\n                      <div className=\"flex justify-between\">\n                        <span className=\"text-gray-400\">Platform Fee:</span>\n                        <span className=\"font-semibold\">{program.platformFeePercent}%</span>\n                      </div>\n                    </CardContent>\n                  </Card>\n                ))\n              )}\n            </div>\n          </TabsContent>\n\n          <TabsContent value=\"applications\">\n            <div className=\"space-y-4\">\n              {applicationsLoading ? (\n                <div className=\"text-center py-12 text-gray-400\">Loading applications...</div>\n              ) : applications?.length === 0 ? (\n                <div className=\"text-center py-12 text-gray-400\">No applications yet</div>\n              ) : (\n                applications?.map((app) => (\n                  <Card key={app.id} className=\"bg-gray-800/50 border-cyan-500/20\" data-testid={`card-application-${app.id}`}>\n                    <CardHeader>\n                      <div className=\"flex items-start justify-between\">\n                        <div>\n                          <CardTitle className=\"text-cyan-400\">Loan Application</CardTitle>\n                          <CardDescription>Requested {formatCurrency(app.requestedAmount)}</CardDescription>\n                        </div>\n                        {getStatusBadge(app.status || \"pending\")}\n                      </div>\n                    </CardHeader>\n                    <CardContent className=\"space-y-3\">\n                      <div>\n                        <span className=\"text-gray-400\">Purpose:</span>\n                        <p className=\"mt-1\" data-testid={`text-purpose-${app.id}`}>{app.purpose}</p>\n                      </div>\n                      {app.businessPlan && (\n                        <div>\n                          <span className=\"text-gray-400\">Business Plan:</span>\n                          <p className=\"mt-1 text-sm text-gray-300\" data-testid={`text-plan-${app.id}`}>{app.businessPlan}</p>\n                        </div>\n                      )}\n                      <div className=\"flex items-center gap-2 text-sm text-gray-400\">\n                        <Calendar className=\"w-4 h-4\" />\n                        Applied {app.createdAt ? new Date(app.createdAt).toLocaleDateString() : \"Unknown\"}\n                      </div>\n                    </CardContent>\n                  </Card>\n                ))\n              )}\n            </div>\n          </TabsContent>\n\n          <TabsContent value=\"active\">\n            <div className=\"space-y-6\">\n              {offersLoading ? (\n                <div className=\"text-center py-12 text-gray-400\">Loading active loans...</div>\n              ) : activeOffers?.filter(o => o.status === \"active\").length === 0 ? (\n                <div className=\"text-center py-12 text-gray-400\">No active loans</div>\n              ) : (\n                activeOffers?.filter(o => o.status === \"active\").map((offer) => (\n                  <Card key={offer.id} className=\"bg-gray-800/50 border-cyan-500/20\" data-testid={`card-loan-${offer.id}`}>\n                    <CardHeader>\n                      <div className=\"flex items-start justify-between\">\n                        <div>\n                          <CardTitle className=\"text-cyan-400\">Active Loan</CardTitle>\n                          <CardDescription>\n                            {formatCurrency(offer.offeredAmount)} at {offer.interestRate}% for {offer.termMonths} months\n                          </CardDescription>\n                        </div>\n                        {getStatusBadge(offer.status || \"pending\")}\n                      </div>\n                    </CardHeader>\n                    <CardContent className=\"space-y-4\">\n                      <div className=\"grid grid-cols-2 gap-4\">\n                        <div>\n                          <span className=\"text-gray-400\">Total Amount:</span>\n                          <p className=\"text-xl font-bold text-cyan-400\" data-testid={`text-amount-${offer.id}`}>\n                            {formatCurrency(offer.offeredAmount)}\n                          </p>\n                        </div>\n                        <div>\n                          <span className=\"text-gray-400\">Interest Rate:</span>\n                          <p className=\"text-xl font-bold text-cyan-400\" data-testid={`text-rate-${offer.id}`}>\n                            {offer.interestRate}%\n                          </p>\n                        </div>\n                      </div>\n\n                      {offer.repayments && offer.repayments.length > 0 && (\n                        <div>\n                          <h4 className=\"font-semibold mb-3\">Repayment Schedule</h4>\n                          <div className=\"space-y-2\">\n                            {offer.repayments.slice(0, 5).map((repayment) => (\n                              <div\n                                key={repayment.id}\n                                className=\"flex items-center justify-between p-3 bg-gray-700/30 rounded\"\n                                data-testid={`row-repayment-${repayment.id}`}\n                              >\n                                <div className=\"flex items-center gap-3\">\n                                  <span className=\"text-gray-400\">Installment #{repayment.installmentNumber}</span>\n                                  {repayment.status === \"paid\" && <CheckCircle2 className=\"w-4 h-4 text-green-500\" />}\n                                  {repayment.status === \"late\" && <AlertCircle className=\"w-4 h-4 text-yellow-500\" />}\n                                  {repayment.status === \"missed\" && <XCircle className=\"w-4 h-4 text-red-500\" />}\n                                </div>\n                                <div className=\"text-right\">\n                                  <p className=\"font-semibold\" data-testid={`text-repay-amount-${repayment.id}`}>\n                                    {formatCurrency(repayment.amountDue)}\n                                  </p>\n                                  <p className=\"text-sm text-gray-400\">\n                                    Due {new Date(repayment.dueDate).toLocaleDateString()}\n                                  </p>\n                                </div>\n                              </div>\n                            ))}\n                          </div>\n                        </div>\n                      )}\n                    </CardContent>\n                  </Card>\n                ))\n              )}\n            </div>\n          </TabsContent>\n        </Tabs>\n      </div>\n    </div>\n  );\n}\n","size_bytes":20979},"client/src/components/ui/command.tsx":{"content":"import * as React from \"react\"\nimport { type DialogProps } from \"@radix-ui/react-dialog\"\nimport { Command as CommandPrimitive } from \"cmdk\"\nimport { Search } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Dialog, DialogContent } from \"@/components/ui/dialog\"\n\nconst Command = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive\n    ref={ref}\n    className={cn(\n      \"flex h-full w-full flex-col overflow-hidden rounded-md bg-popover text-popover-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nCommand.displayName = CommandPrimitive.displayName\n\nconst CommandDialog = ({ children, ...props }: DialogProps) => {\n  return (\n    <Dialog {...props}>\n      <DialogContent className=\"overflow-hidden p-0 shadow-lg\">\n        <Command className=\"[&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground [&_[cmdk-group]:not([hidden])_~[cmdk-group]]:pt-0 [&_[cmdk-group]]:px-2 [&_[cmdk-input-wrapper]_svg]:h-5 [&_[cmdk-input-wrapper]_svg]:w-5 [&_[cmdk-input]]:h-12 [&_[cmdk-item]]:px-2 [&_[cmdk-item]]:py-3 [&_[cmdk-item]_svg]:h-5 [&_[cmdk-item]_svg]:w-5\">\n          {children}\n        </Command>\n      </DialogContent>\n    </Dialog>\n  )\n}\n\nconst CommandInput = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Input>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Input>\n>(({ className, ...props }, ref) => (\n  <div className=\"flex items-center border-b px-3\" cmdk-input-wrapper=\"\">\n    <Search className=\"mr-2 h-4 w-4 shrink-0 opacity-50\" />\n    <CommandPrimitive.Input\n      ref={ref}\n      className={cn(\n        \"flex h-11 w-full rounded-md bg-transparent py-3 text-sm outline-none placeholder:text-muted-foreground disabled:cursor-not-allowed disabled:opacity-50\",\n        className\n      )}\n      {...props}\n    />\n  </div>\n))\n\nCommandInput.displayName = CommandPrimitive.Input.displayName\n\nconst CommandList = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.List\n    ref={ref}\n    className={cn(\"max-h-[300px] overflow-y-auto overflow-x-hidden\", className)}\n    {...props}\n  />\n))\n\nCommandList.displayName = CommandPrimitive.List.displayName\n\nconst CommandEmpty = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Empty>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Empty>\n>((props, ref) => (\n  <CommandPrimitive.Empty\n    ref={ref}\n    className=\"py-6 text-center text-sm\"\n    {...props}\n  />\n))\n\nCommandEmpty.displayName = CommandPrimitive.Empty.displayName\n\nconst CommandGroup = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Group>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Group>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Group\n    ref={ref}\n    className={cn(\n      \"overflow-hidden p-1 text-foreground [&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:py-1.5 [&_[cmdk-group-heading]]:text-xs [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\n\nCommandGroup.displayName = CommandPrimitive.Group.displayName\n\nconst CommandSeparator = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 h-px bg-border\", className)}\n    {...props}\n  />\n))\nCommandSeparator.displayName = CommandPrimitive.Separator.displayName\n\nconst CommandItem = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Item>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default gap-2 select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none data-[disabled=true]:pointer-events-none data-[selected='true']:bg-accent data-[selected=true]:text-accent-foreground data-[disabled=true]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n      className\n    )}\n    {...props}\n  />\n))\n\nCommandItem.displayName = CommandPrimitive.Item.displayName\n\nconst CommandShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nCommandShortcut.displayName = \"CommandShortcut\"\n\nexport {\n  Command,\n  CommandDialog,\n  CommandInput,\n  CommandList,\n  CommandEmpty,\n  CommandGroup,\n  CommandItem,\n  CommandShortcut,\n  CommandSeparator,\n}\n","size_bytes":4885},"tailwind.config.ts":{"content":"import type { Config } from \"tailwindcss\";\n\nexport default {\n  darkMode: [\"class\"],\n  content: [\"./client/index.html\", \"./client/src/**/*.{js,jsx,ts,tsx}\"],\n  theme: {\n    extend: {\n      borderRadius: {\n        lg: \"var(--radius)\",\n        md: \"calc(var(--radius) - 2px)\",\n        sm: \"calc(var(--radius) - 4px)\",\n      },\n      colors: {\n        background: \"var(--background)\",\n        foreground: \"var(--foreground)\",\n        card: {\n          DEFAULT: \"var(--card)\",\n          foreground: \"var(--card-foreground)\",\n        },\n        popover: {\n          DEFAULT: \"var(--popover)\",\n          foreground: \"var(--popover-foreground)\",\n        },\n        primary: {\n          DEFAULT: \"var(--primary)\",\n          foreground: \"var(--primary-foreground)\",\n        },\n        secondary: {\n          DEFAULT: \"var(--secondary)\",\n          foreground: \"var(--secondary-foreground)\",\n        },\n        muted: {\n          DEFAULT: \"var(--muted)\",\n          foreground: \"var(--muted-foreground)\",\n        },\n        accent: {\n          DEFAULT: \"var(--accent)\",\n          foreground: \"var(--accent-foreground)\",\n        },\n        destructive: {\n          DEFAULT: \"var(--destructive)\",\n          foreground: \"var(--destructive-foreground)\",\n        },\n        border: \"var(--border)\",\n        input: \"var(--input)\",\n        ring: \"var(--ring)\",\n        chart: {\n          \"1\": \"var(--chart-1)\",\n          \"2\": \"var(--chart-2)\",\n          \"3\": \"var(--chart-3)\",\n          \"4\": \"var(--chart-4)\",\n          \"5\": \"var(--chart-5)\",\n        },\n        sidebar: {\n          DEFAULT: \"var(--sidebar-background)\",\n          foreground: \"var(--sidebar-foreground)\",\n          primary: \"var(--sidebar-primary)\",\n          \"primary-foreground\": \"var(--sidebar-primary-foreground)\",\n          accent: \"var(--sidebar-accent)\",\n          \"accent-foreground\": \"var(--sidebar-accent-foreground)\",\n          border: \"var(--sidebar-border)\",\n          ring: \"var(--sidebar-ring)\",\n        },\n        // DaddyFanz brand colors\n        df: {\n          cyan: \"var(--df-cyan)\",\n          gold: \"var(--df-gold)\",\n          steel: \"var(--df-steel)\",\n          ink: \"var(--df-ink)\",\n          brick: \"var(--df-brick)\",\n          snow: \"var(--df-snow)\",\n          fog: \"var(--df-fog)\",\n        },\n        success: \"var(--success)\",\n        warning: \"var(--warning)\",\n        error: \"var(--error)\",\n      },\n      fontFamily: {\n        sans: [\"var(--font-sans)\"],\n        serif: [\"var(--font-serif)\"],\n        mono: [\"var(--font-mono)\"],\n        display: [\"var(--font-display)\"],\n      },\n      boxShadow: {\n        glow: \"var(--shadow-glow)\",\n        \"glow-gold\": \"var(--shadow-glow-gold)\",\n        \"inner-glow\": \"var(--shadow-inner-glow)\",\n      },\n      backgroundImage: {\n        \"df-dom\": \"var(--gradient-dom)\",\n        \"df-dungeon\": \"var(--gradient-dungeon)\",\n        \"df-gold\": \"var(--gradient-gold)\",\n        \"chain-pattern\": 'url(\"data:image/svg+xml,%3Csvg xmlns=\\'http://www.w3.org/2000/svg\\' width=\\'40\\' height=\\'40\\' viewBox=\\'0 0 40 40\\'%3E%3Cpath d=\\'M20 20a10 10 0 1 1-20 0 10 10 0 0 1 20 0z\\' fill=\\'%23121213\\' fill-opacity=\\'0.05\\'/%3E%3C/svg%3E\")',\n      },\n      keyframes: {\n        \"accordion-down\": {\n          from: {\n            height: \"0\",\n          },\n          to: {\n            height: \"var(--radix-accordion-content-height)\",\n          },\n        },\n        \"accordion-up\": {\n          from: {\n            height: \"var(--radix-accordion-content-height)\",\n          },\n          to: {\n            height: \"0\",\n          },\n        },\n        \"pulse-glow\": {\n          from: { boxShadow: \"0 0 24px rgba(0, 207, 255, 0.3)\" },\n          to: { boxShadow: \"0 0 36px rgba(0, 207, 255, 0.6)\" },\n        },\n      },\n      animation: {\n        \"accordion-down\": \"accordion-down 0.2s ease-out\",\n        \"accordion-up\": \"accordion-up 0.2s ease-out\",\n        \"pulse-glow\": \"pulse-glow 2s ease-in-out infinite alternate\",\n      },\n    },\n  },\n  plugins: [require(\"tailwindcss-animate\"), require(\"@tailwindcss/typography\")],\n} satisfies Config;\n","size_bytes":4030},"client/src/components/ui/form.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as LabelPrimitive from \"@radix-ui/react-label\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport {\n  Controller,\n  FormProvider,\n  useFormContext,\n  type ControllerProps,\n  type FieldPath,\n  type FieldValues,\n} from \"react-hook-form\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Label } from \"@/components/ui/label\"\n\nconst Form = FormProvider\n\ntype FormFieldContextValue<\n  TFieldValues extends FieldValues = FieldValues,\n  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>\n> = {\n  name: TName\n}\n\nconst FormFieldContext = React.createContext<FormFieldContextValue>(\n  {} as FormFieldContextValue\n)\n\nconst FormField = <\n  TFieldValues extends FieldValues = FieldValues,\n  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>\n>({\n  ...props\n}: ControllerProps<TFieldValues, TName>) => {\n  return (\n    <FormFieldContext.Provider value={{ name: props.name }}>\n      <Controller {...props} />\n    </FormFieldContext.Provider>\n  )\n}\n\nconst useFormField = () => {\n  const fieldContext = React.useContext(FormFieldContext)\n  const itemContext = React.useContext(FormItemContext)\n  const { getFieldState, formState } = useFormContext()\n\n  const fieldState = getFieldState(fieldContext.name, formState)\n\n  if (!fieldContext) {\n    throw new Error(\"useFormField should be used within <FormField>\")\n  }\n\n  const { id } = itemContext\n\n  return {\n    id,\n    name: fieldContext.name,\n    formItemId: `${id}-form-item`,\n    formDescriptionId: `${id}-form-item-description`,\n    formMessageId: `${id}-form-item-message`,\n    ...fieldState,\n  }\n}\n\ntype FormItemContextValue = {\n  id: string\n}\n\nconst FormItemContext = React.createContext<FormItemContextValue>(\n  {} as FormItemContextValue\n)\n\nconst FormItem = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const id = React.useId()\n\n  return (\n    <FormItemContext.Provider value={{ id }}>\n      <div ref={ref} className={cn(\"space-y-2\", className)} {...props} />\n    </FormItemContext.Provider>\n  )\n})\nFormItem.displayName = \"FormItem\"\n\nconst FormLabel = React.forwardRef<\n  React.ElementRef<typeof LabelPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof LabelPrimitive.Root>\n>(({ className, ...props }, ref) => {\n  const { error, formItemId } = useFormField()\n\n  return (\n    <Label\n      ref={ref}\n      className={cn(error && \"text-destructive\", className)}\n      htmlFor={formItemId}\n      {...props}\n    />\n  )\n})\nFormLabel.displayName = \"FormLabel\"\n\nconst FormControl = React.forwardRef<\n  React.ElementRef<typeof Slot>,\n  React.ComponentPropsWithoutRef<typeof Slot>\n>(({ ...props }, ref) => {\n  const { error, formItemId, formDescriptionId, formMessageId } = useFormField()\n\n  return (\n    <Slot\n      ref={ref}\n      id={formItemId}\n      aria-describedby={\n        !error\n          ? `${formDescriptionId}`\n          : `${formDescriptionId} ${formMessageId}`\n      }\n      aria-invalid={!!error}\n      {...props}\n    />\n  )\n})\nFormControl.displayName = \"FormControl\"\n\nconst FormDescription = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, ...props }, ref) => {\n  const { formDescriptionId } = useFormField()\n\n  return (\n    <p\n      ref={ref}\n      id={formDescriptionId}\n      className={cn(\"text-sm text-muted-foreground\", className)}\n      {...props}\n    />\n  )\n})\nFormDescription.displayName = \"FormDescription\"\n\nconst FormMessage = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, children, ...props }, ref) => {\n  const { error, formMessageId } = useFormField()\n  const body = error ? String(error?.message ?? \"\") : children\n\n  if (!body) {\n    return null\n  }\n\n  return (\n    <p\n      ref={ref}\n      id={formMessageId}\n      className={cn(\"text-sm font-medium text-destructive\", className)}\n      {...props}\n    >\n      {body}\n    </p>\n  )\n})\nFormMessage.displayName = \"FormMessage\"\n\nexport {\n  useFormField,\n  Form,\n  FormItem,\n  FormLabel,\n  FormControl,\n  FormDescription,\n  FormMessage,\n  FormField,\n}\n","size_bytes":4120},"client/src/pages/CreatorGuide.tsx":{"content":"import { useAuth } from \"@/hooks/useAuth\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Link } from \"wouter\";\nimport { \n  DollarSign, \n  Users, \n  Camera, \n  MessageCircle, \n  Shield, \n  TrendingUp,\n  CheckCircle,\n  Star,\n  Crown\n} from \"lucide-react\";\n\nexport default function CreatorGuide() {\n  const { user } = useAuth();\n\n  const steps = [\n    {\n      icon: Shield,\n      title: \"Complete Verification\",\n      description: \"Verify your identity and age to ensure platform compliance\",\n      link: \"/verification\",\n      status: \"pending\"\n    },\n    {\n      icon: Camera,\n      title: \"Create Your First Post\",\n      description: \"Share premium content with your subscribers\",\n      link: \"/\",\n      status: \"ready\"\n    },\n    {\n      icon: Users,\n      title: \"Build Your Following\",\n      description: \"Engage with fans and grow your subscriber base\",\n      link: \"/profile\",\n      status: \"ready\"\n    },\n    {\n      icon: DollarSign,\n      title: \"Start Earning\",\n      description: \"Set up subscriptions and premium content pricing\",\n      link: \"/settings\",\n      status: \"ready\"\n    }\n  ];\n\n  const features = [\n    {\n      icon: Crown,\n      title: \"Premium Subscriptions\",\n      description: \"Monthly recurring revenue from dedicated fans\"\n    },\n    {\n      icon: MessageCircle,\n      title: \"Direct Messaging\",\n      description: \"Personal connection with your subscribers\"\n    },\n    {\n      icon: TrendingUp,\n      title: \"Analytics Dashboard\", \n      description: \"Track your performance and earnings\"\n    },\n    {\n      icon: Star,\n      title: \"Content Protection\",\n      description: \"Advanced DRM and watermarking technology\"\n    }\n  ];\n\n  return (\n    <div className=\"min-h-screen bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900\">\n      {/* Header */}\n      <div className=\"border-b border-slate-700/50 bg-slate-900/80 backdrop-blur-sm\">\n        <div className=\"container mx-auto px-4 py-6\">\n          <div className=\"flex items-center justify-between\">\n            <div className=\"flex items-center space-x-4\">\n              <div className=\"h-10 w-10 rounded-lg bg-gradient-to-r from-cyan-400 to-blue-500 flex items-center justify-center\">\n                <Crown className=\"h-6 w-6 text-white\" />\n              </div>\n              <div>\n                <h1 className=\"text-2xl font-bold text-white\">Creator Guide</h1>\n                <p className=\"text-slate-300\">Welcome to DaddyFanz - Start your creator journey</p>\n              </div>\n            </div>\n            <Link href=\"/\" data-testid=\"link-back-home\">\n              <Button variant=\"outline\" className=\"border-cyan-400/30 text-cyan-300 hover:bg-cyan-400/10\">\n                Back to Feed\n              </Button>\n            </Link>\n          </div>\n        </div>\n      </div>\n\n      <div className=\"container mx-auto px-4 py-8 space-y-8\">\n        {/* Welcome Section */}\n        <Card className=\"border-slate-700/50 bg-slate-800/50 backdrop-blur-sm\">\n          <CardHeader className=\"text-center\">\n            <CardTitle className=\"text-3xl text-white flex items-center justify-center gap-3\">\n              <Crown className=\"h-8 w-8 text-yellow-400\" />\n              Welcome, {user?.firstName || 'Creator'}!\n            </CardTitle>\n            <CardDescription className=\"text-lg text-slate-300\">\n              Ready to monetize your content and build a loyal fanbase? Follow these steps to get started.\n            </CardDescription>\n          </CardHeader>\n        </Card>\n\n        {/* Getting Started Steps */}\n        <div className=\"space-y-6\">\n          <h2 className=\"text-2xl font-bold text-white flex items-center gap-2\">\n            <CheckCircle className=\"h-6 w-6 text-cyan-400\" />\n            Getting Started\n          </h2>\n          \n          <div className=\"grid gap-4 md:grid-cols-2\">\n            {steps.map((step, index) => {\n              const IconComponent = step.icon;\n              return (\n                <Card key={index} className=\"border-slate-700/50 bg-slate-800/50 backdrop-blur-sm hover:bg-slate-800/70 transition-all\">\n                  <CardHeader className=\"pb-3\">\n                    <div className=\"flex items-start justify-between\">\n                      <div className=\"flex items-center space-x-3\">\n                        <div className=\"h-10 w-10 rounded-lg bg-gradient-to-r from-cyan-400 to-blue-500 flex items-center justify-center\">\n                          <IconComponent className=\"h-5 w-5 text-white\" />\n                        </div>\n                        <div>\n                          <CardTitle className=\"text-white text-lg\">{step.title}</CardTitle>\n                          <Badge variant={step.status === 'ready' ? 'default' : 'secondary'} className=\"mt-1\">\n                            {step.status === 'ready' ? 'Ready' : 'Pending'}\n                          </Badge>\n                        </div>\n                      </div>\n                    </div>\n                  </CardHeader>\n                  <CardContent>\n                    <p className=\"text-slate-300 mb-4\">{step.description}</p>\n                    <Link href={step.link}>\n                      <Button \n                        className=\"w-full bg-gradient-to-r from-cyan-500 to-blue-600 hover:from-cyan-600 hover:to-blue-700\"\n                        data-testid={`button-${step.title.toLowerCase().replace(/\\s+/g, '-')}`}\n                      >\n                        {step.status === 'ready' ? 'Get Started' : 'Complete Setup'}\n                      </Button>\n                    </Link>\n                  </CardContent>\n                </Card>\n              );\n            })}\n          </div>\n        </div>\n\n        {/* Platform Features */}\n        <div className=\"space-y-6\">\n          <h2 className=\"text-2xl font-bold text-white flex items-center gap-2\">\n            <Star className=\"h-6 w-6 text-yellow-400\" />\n            Platform Features\n          </h2>\n          \n          <div className=\"grid gap-6 md:grid-cols-2\">\n            {features.map((feature, index) => {\n              const IconComponent = feature.icon;\n              return (\n                <Card key={index} className=\"border-slate-700/50 bg-slate-800/50 backdrop-blur-sm\">\n                  <CardHeader>\n                    <div className=\"flex items-center space-x-3\">\n                      <div className=\"h-12 w-12 rounded-lg bg-gradient-to-r from-yellow-400 to-orange-500 flex items-center justify-center\">\n                        <IconComponent className=\"h-6 w-6 text-white\" />\n                      </div>\n                      <div>\n                        <CardTitle className=\"text-white\">{feature.title}</CardTitle>\n                      </div>\n                    </div>\n                  </CardHeader>\n                  <CardContent>\n                    <p className=\"text-slate-300\">{feature.description}</p>\n                  </CardContent>\n                </Card>\n              );\n            })}\n          </div>\n        </div>\n\n        {/* Quick Actions */}\n        <Card className=\"border-slate-700/50 bg-slate-800/50 backdrop-blur-sm\">\n          <CardHeader>\n            <CardTitle className=\"text-white text-xl\">Ready to Start Creating?</CardTitle>\n            <CardDescription className=\"text-slate-300\">\n              Jump straight into creating content and building your fanbase.\n            </CardDescription>\n          </CardHeader>\n          <CardContent className=\"flex flex-col sm:flex-row gap-4\">\n            <Link href=\"/\" className=\"flex-1\">\n              <Button \n                className=\"w-full bg-gradient-to-r from-cyan-500 to-blue-600 hover:from-cyan-600 hover:to-blue-700\"\n                data-testid=\"button-create-first-post\"\n              >\n                <Camera className=\"h-4 w-4 mr-2\" />\n                Create Your First Post\n              </Button>\n            </Link>\n            <Link href=\"/settings\" className=\"flex-1\">\n              <Button \n                variant=\"outline\" \n                className=\"w-full border-cyan-400/30 text-cyan-300 hover:bg-cyan-400/10\"\n                data-testid=\"button-setup-monetization\"\n              >\n                <DollarSign className=\"h-4 w-4 mr-2\" />\n                Setup Monetization\n              </Button>\n            </Link>\n          </CardContent>\n        </Card>\n      </div>\n    </div>\n  );\n}","size_bytes":8468},"client/src/components/ui/label.tsx":{"content":"import * as React from \"react\"\nimport * as LabelPrimitive from \"@radix-ui/react-label\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst labelVariants = cva(\n  \"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70\"\n)\n\nconst Label = React.forwardRef<\n  React.ElementRef<typeof LabelPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof LabelPrimitive.Root> &\n    VariantProps<typeof labelVariants>\n>(({ className, ...props }, ref) => (\n  <LabelPrimitive.Root\n    ref={ref}\n    className={cn(labelVariants(), className)}\n    {...props}\n  />\n))\nLabel.displayName = LabelPrimitive.Root.displayName\n\nexport { Label }\n","size_bytes":710},"shared/schema.ts":{"content":"import { sql } from \"drizzle-orm\";\nimport {\n  index,\n  jsonb,\n  pgTable,\n  timestamp,\n  varchar,\n  text,\n  integer,\n  boolean,\n  uuid,\n  decimal,\n  serial,\n  numeric,\n  real,\n  pgEnum,\n} from \"drizzle-orm/pg-core\";\nimport { createInsertSchema } from \"drizzle-zod\";\nimport { z } from \"zod\";\nimport { relations } from \"drizzle-orm\";\n\n// Enums\nexport const userRoleEnum = pgEnum(\"user_role\", [\"fan\", \"creator\", \"admin\"]);\nexport const authProviderEnum = pgEnum(\"auth_provider\", [\"replit\", \"local\"]);\nexport const userStatusEnum = pgEnum(\"user_status\", [\"active\", \"suspended\", \"banned\"]);\nexport const kycStatusEnum = pgEnum(\"kyc_status\", [\"pending\", \"verified\", \"rejected\"]);\nexport const mediaStatusEnum = pgEnum(\"media_status\", [\"uploaded\", \"processing\", \"approved\", \"rejected\"]);\nexport const moderationStatusEnum = pgEnum(\"moderation_status\", [\"pending\", \"approved\", \"rejected\"]);\nexport const payoutStatusEnum = pgEnum(\"payout_status\", [\"pending\", \"processing\", \"completed\", \"failed\"]);\nexport const webhookStatusEnum = pgEnum(\"webhook_status\", [\"active\", \"inactive\"]);\nexport const transactionStatusEnum = pgEnum(\"transaction_status\", [\"pending\", \"completed\", \"failed\", \"refunded\", \"disputed\"]);\nexport const transactionTypeEnum = pgEnum(\"transaction_type\", [\"subscription\", \"tip\", \"content_purchase\", \"token_purchase\"]);\nexport const paymentGatewayEnum = pgEnum(\"payment_gateway\", [\"rocketgate\", \"segpay\", \"ccbill\", \"solana\", \"ethereum\", \"tron\", \"fanzpay\"]);\nexport const refundStatusEnum = pgEnum(\"refund_status\", [\"pending\", \"auto_approved\", \"manual_review\", \"approved\", \"denied\", \"processed\"]);\nexport const trustScoreTierEnum = pgEnum(\"trust_score_tier\", [\"new\", \"bronze\", \"silver\", \"gold\", \"platinum\", \"banned\"]);\n\n// Session storage table (mandatory for Replit Auth)\nexport const sessions = pgTable(\n  \"sessions\",\n  {\n    sid: varchar(\"sid\").primaryKey(),\n    sess: jsonb(\"sess\").notNull(),\n    expire: timestamp(\"expire\").notNull(),\n  },\n  (table) => [index(\"IDX_session_expire\").on(table.expire)],\n);\n\n// Users table (email/password authentication)\nexport const users = pgTable(\"users\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  username: varchar(\"username\").unique(),\n  email: varchar(\"email\").unique(),\n  password: text(\"password\"), // required for new users, nullable for migration\n  firstName: varchar(\"first_name\"),\n  lastName: varchar(\"last_name\"),\n  profileImageUrl: varchar(\"profile_image_url\"),\n  role: userRoleEnum(\"role\").default(\"fan\"),\n  authProvider: authProviderEnum(\"auth_provider\").default(\"local\"),\n  status: userStatusEnum(\"status\").default(\"active\"),\n  emailVerified: boolean(\"email_verified\").default(false),\n  lastLoginAt: timestamp(\"last_login_at\"),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n}, (table) => [\n  index(\"idx_users_email\").on(table.email),\n  index(\"idx_users_status\").on(table.status),\n  index(\"idx_users_last_login\").on(table.lastLoginAt),\n]);\n\n// Password Reset Tokens (for forgot password flow)\n// Token column stores SHA-256 hash, not plaintext\nexport const passwordResetTokens = pgTable(\"password_reset_tokens\", {\n  id: uuid(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  userId: varchar(\"user_id\").references(() => users.id, { onDelete: \"cascade\" }).notNull(),\n  token: varchar(\"token\", { length: 255 }).notNull().unique(), // Stores SHA-256 hash\n  expiresAt: timestamp(\"expires_at\").notNull(),\n  usedAt: timestamp(\"used_at\"),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n}, (table) => [\n  index(\"idx_password_reset_token\").on(table.token),\n  index(\"idx_password_reset_user\").on(table.userId),\n  index(\"idx_password_reset_expires\").on(table.expiresAt),\n]);\n\n// Email Recovery Tokens (for forgot email flow)\n// Token column stores SHA-256 hash, not plaintext\nexport const emailRecoveryTokens = pgTable(\"email_recovery_tokens\", {\n  id: uuid(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  userId: varchar(\"user_id\").references(() => users.id, { onDelete: \"cascade\" }).notNull(),\n  token: varchar(\"token\", { length: 255 }).notNull().unique(), // Stores SHA-256 hash\n  expiresAt: timestamp(\"expires_at\").notNull(),\n  usedAt: timestamp(\"used_at\"),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n}, (table) => [\n  index(\"idx_email_recovery_token\").on(table.token),\n  index(\"idx_email_recovery_user\").on(table.userId),\n  index(\"idx_email_recovery_expires\").on(table.expiresAt),\n]);\n\n// Email Verification Tokens (for email verification)\nexport const emailVerificationTokens = pgTable(\"email_verification_tokens\", {\n  id: uuid(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  userId: varchar(\"user_id\").references(() => users.id, { onDelete: \"cascade\" }).notNull(),\n  token: varchar(\"token\", { length: 255 }).notNull().unique(),\n  expiresAt: timestamp(\"expires_at\").notNull(),\n  usedAt: timestamp(\"used_at\"),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n}, (table) => [\n  index(\"idx_email_verification_token\").on(table.token),\n  index(\"idx_email_verification_user\").on(table.userId),\n  index(\"idx_email_verification_expires\").on(table.expiresAt),\n]);\n\n// Profiles (creator/fan profiles)\nexport const profiles = pgTable(\"profiles\", {\n  id: uuid(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  userId: varchar(\"user_id\").references(() => users.id).notNull(),\n  displayName: varchar(\"display_name\"),\n  stageName: varchar(\"stage_name\"), // creator's stage/performer name\n  pronouns: varchar(\"pronouns\"), // user's preferred pronouns\n  bio: text(\"bio\"),\n  avatarUrl: varchar(\"avatar_url\"),\n  bannerUrl: varchar(\"banner_url\"),\n  kycStatus: kycStatusEnum(\"kyc_status\").default(\"pending\"),\n  ageVerified: boolean(\"age_verified\").default(false),\n  complianceNotes: text(\"compliance_notes\"),\n  subscriptionPrice: decimal(\"subscription_price\", { precision: 10, scale: 2 }),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\n// Onboarding Progress (track user onboarding steps)\nexport const onboardingStepEnum = pgEnum(\"onboarding_step\", [\n  \"role_selection\",\n  \"profile_setup\",\n  \"interests_selection\",\n  \"verification\",\n  \"monetization\",\n  \"completed\"\n]);\n\nexport const onboardingProgress = pgTable(\"onboarding_progress\", {\n  id: uuid(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  userId: varchar(\"user_id\").references(() => users.id).notNull().unique(),\n  currentStep: onboardingStepEnum(\"current_step\").default(\"role_selection\"),\n  completedSteps: jsonb(\"completed_steps\").default([]), // array of completed step names\n  roleSelected: varchar(\"role_selected\"), // \"creator\" or \"fan\"\n  profileSetupComplete: boolean(\"profile_setup_complete\").default(false),\n  interestsSelected: boolean(\"interests_selected\").default(false),\n  verificationComplete: boolean(\"verification_complete\").default(false),\n  monetizationSetupComplete: boolean(\"monetization_setup_complete\").default(false),\n  onboardingComplete: boolean(\"onboarding_complete\").default(false),\n  firstPostCreated: boolean(\"first_post_created\").default(false), // milestone\n  firstTipSent: boolean(\"first_tip_sent\").default(false), // milestone\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n}, (table) => [\n  index(\"idx_onboarding_user\").on(table.userId),\n  index(\"idx_onboarding_step\").on(table.currentStep),\n]);\n\n// Content Niches (predefined categories/tags)\nexport const contentNiches = pgTable(\"content_niches\", {\n  id: uuid(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  name: varchar(\"name\").notNull().unique(),\n  slug: varchar(\"slug\").notNull().unique(),\n  description: text(\"description\"),\n  iconUrl: varchar(\"icon_url\"),\n  isActive: boolean(\"is_active\").default(true),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n});\n\n// User Interests (fan interests and creator niches)\nexport const userInterests = pgTable(\"user_interests\", {\n  id: uuid(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  userId: varchar(\"user_id\").references(() => users.id).notNull(),\n  nicheId: uuid(\"niche_id\").references(() => contentNiches.id).notNull(),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n}, (table) => [\n  index(\"idx_user_interests\").on(table.userId),\n  index(\"idx_niche_users\").on(table.nicheId),\n]);\n\n// Media Assets (content management)\nexport const mediaAssets = pgTable(\"media_assets\", {\n  id: uuid(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  ownerId: varchar(\"owner_id\").references(() => users.id).notNull(),\n  title: varchar(\"title\"),\n  description: text(\"description\"),\n  s3Key: varchar(\"s3_key\").notNull(),\n  mimeType: varchar(\"mime_type\"),\n  fileSize: integer(\"file_size\"),\n  duration: integer(\"duration\"), // for videos in seconds\n  status: mediaStatusEnum(\"status\").default(\"uploaded\"),\n  forensicSignature: text(\"forensic_signature\"), // for piracy protection\n  price: decimal(\"price\", { precision: 10, scale: 2 }),\n  isPremium: boolean(\"is_premium\").default(false),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\n// Posts (infinity scroll feed content)\nexport const posts = pgTable(\"posts\", {\n  id: uuid(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  creatorId: varchar(\"creator_id\").references(() => users.id).notNull(),\n  text: text(\"text\"),\n  mediaUrl: varchar(\"media_url\"), // URL to media asset\n  mediaType: varchar(\"media_type\"), // image, video, etc.\n  mediaAssetId: uuid(\"media_asset_id\").references(() => mediaAssets.id), // optional link to mediaAssets\n  isFree: boolean(\"is_free\").default(false), // this specific post is free\n  creatorAllowsFree: boolean(\"creator_allows_free\").default(false), // creator has enabled free previews\n  creatorIsAgeVerified: boolean(\"creator_is_age_verified\").default(false), // creator passed age verification\n  requiresSubscription: boolean(\"requires_subscription\").default(true),\n  requiresAgeVerification: boolean(\"requires_age_verification\").default(true),\n  viewCount: integer(\"view_count\").default(0),\n  likeCount: integer(\"like_count\").default(0),\n  commentCount: integer(\"comment_count\").default(0),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n}, (table) => [\n  // Indexes for feed queries\n  index(\"idx_creator_posts\").on(table.creatorId, table.createdAt),\n  index(\"idx_free_posts\").on(table.isFree, table.createdAt),\n  index(\"idx_post_created\").on(table.createdAt),\n  index(\"idx_subscription_posts\").on(table.requiresSubscription, table.createdAt),\n]);\n\n// Post Likes (user likes on posts)\nexport const postLikes = pgTable(\"post_likes\", {\n  id: uuid(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  postId: uuid(\"post_id\").references(() => posts.id, { onDelete: \"cascade\" }).notNull(),\n  userId: varchar(\"user_id\").references(() => users.id, { onDelete: \"cascade\" }).notNull(),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n}, (table) => [\n  index(\"idx_post_likes_post\").on(table.postId),\n  index(\"idx_post_likes_user\").on(table.userId),\n  index(\"idx_unique_post_like\").on(table.postId, table.userId),\n]);\n\n// Post Comments (user comments on posts)\nexport const postComments = pgTable(\"post_comments\", {\n  id: uuid(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  postId: uuid(\"post_id\").references(() => posts.id, { onDelete: \"cascade\" }).notNull(),\n  userId: varchar(\"user_id\").references(() => users.id, { onDelete: \"cascade\" }).notNull(),\n  text: text(\"text\").notNull(),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n}, (table) => [\n  index(\"idx_post_comments_post\").on(table.postId, table.createdAt),\n  index(\"idx_post_comments_user\").on(table.userId),\n]);\n\n// Follows (fan follows creator for free content)\nexport const follows = pgTable(\"follows\", {\n  id: uuid(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  fanId: varchar(\"fan_id\").references(() => users.id).notNull(),\n  creatorId: varchar(\"creator_id\").references(() => users.id).notNull(),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n}, (table) => [\n  // Unique constraint: fan can only follow a creator once\n  index(\"idx_unique_follow\").on(table.fanId, table.creatorId),\n]);\n\n// Story Moments (24-hour expiring content)\nexport const storyMoments = pgTable(\"story_moments\", {\n  id: uuid(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  creatorId: varchar(\"creator_id\").references(() => users.id).notNull(),\n  mediaUrl: varchar(\"media_url\").notNull(),\n  mediaType: varchar(\"media_type\").notNull(), // image, video\n  mediaThumbnailUrl: varchar(\"media_thumbnail_url\"),\n  caption: text(\"caption\"),\n  isFree: boolean(\"is_free\").default(false),\n  requiresSubscription: boolean(\"requires_subscription\").default(true),\n  viewCount: integer(\"view_count\").default(0),\n  expiresAt: timestamp(\"expires_at\").notNull(), // Auto-delete after 24h\n  createdAt: timestamp(\"created_at\").defaultNow(),\n}, (table) => [\n  index(\"idx_story_creator\").on(table.creatorId, table.createdAt),\n  index(\"idx_story_expires\").on(table.expiresAt),\n  index(\"idx_story_active\").on(table.creatorId, table.expiresAt),\n]);\n\n// Story Views (track who viewed stories)\nexport const storyViews = pgTable(\"story_views\", {\n  id: uuid(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  storyId: uuid(\"story_id\").references(() => storyMoments.id).notNull(),\n  viewerId: varchar(\"viewer_id\").references(() => users.id).notNull(),\n  viewedAt: timestamp(\"viewed_at\").defaultNow(),\n}, (table) => [\n  index(\"idx_story_view_unique\").on(table.storyId, table.viewerId),\n]);\n\n// Fan Levels & Gamification\nexport const fanLevels = pgTable(\"fan_levels\", {\n  id: uuid(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  userId: varchar(\"user_id\").references(() => users.id).notNull().unique(),\n  level: integer(\"level\").default(1),\n  xp: integer(\"xp\").default(0),\n  totalSpentCents: integer(\"total_spent_cents\").default(0),\n  totalTips: integer(\"total_tips\").default(0),\n  totalSubscriptions: integer(\"total_subscriptions\").default(0),\n  streakDays: integer(\"streak_days\").default(0),\n  lastActivityDate: timestamp(\"last_activity_date\"),\n  badges: jsonb(\"badges\").default([]), // array of badge IDs\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n}, (table) => [\n  index(\"idx_fan_level\").on(table.level),\n  index(\"idx_fan_xp\").on(table.xp),\n]);\n\n// Creator Analytics - Real-time metrics dashboard\nexport const creatorAnalytics = pgTable(\"creator_analytics\", {\n  id: uuid(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  creatorId: varchar(\"creator_id\").references(() => users.id).notNull(),\n  period: varchar(\"period\").notNull(), // \"daily\", \"weekly\", \"monthly\"\n  startDate: timestamp(\"start_date\").notNull(),\n  endDate: timestamp(\"end_date\").notNull(),\n  totalViews: integer(\"total_views\").default(0),\n  uniqueViewers: integer(\"unique_viewers\").default(0),\n  totalLikes: integer(\"total_likes\").default(0),\n  totalComments: integer(\"total_comments\").default(0),\n  totalShares: integer(\"total_shares\").default(0),\n  newSubscribers: integer(\"new_subscribers\").default(0),\n  totalSubscribers: integer(\"total_subscribers\").default(0),\n  subscriptionRevenue: integer(\"subscription_revenue\").default(0), // cents\n  tipsRevenue: integer(\"tips_revenue\").default(0), // cents\n  contentRevenue: integer(\"content_revenue\").default(0), // cents\n  totalRevenue: integer(\"total_revenue\").default(0), // cents\n  postsCreated: integer(\"posts_created\").default(0),\n  storiesCreated: integer(\"stories_created\").default(0),\n  averageEngagementRate: real(\"average_engagement_rate\").default(0),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n}, (table) => [\n  index(\"idx_analytics_creator_period\").on(table.creatorId, table.period, table.startDate),\n]);\n\n// KYC Verifications (compliance)\nexport const kycVerifications = pgTable(\"kyc_verifications\", {\n  id: uuid(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  userId: varchar(\"user_id\").references(() => users.id).notNull(),\n  provider: varchar(\"provider\"), // VerifyMy, AgeChecker, etc.\n  status: kycStatusEnum(\"status\").default(\"pending\"),\n  dataJson: jsonb(\"data_json\"), // verification data\n  documentUrls: jsonb(\"document_urls\"), // array of document URLs\n  reviewedBy: varchar(\"reviewed_by\").references(() => users.id),\n  reviewedAt: timestamp(\"reviewed_at\"),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\n// 2257 Records (adult industry compliance)\nexport const records2257 = pgTable(\"records_2257\", {\n  id: uuid(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  userId: varchar(\"user_id\").references(() => users.id).notNull(),\n  docType: varchar(\"doc_type\").notNull(), // government_id, secondary_id, etc.\n  s3Key: varchar(\"s3_key\").notNull(),\n  checksum: varchar(\"checksum\").notNull(),\n  expiresAt: timestamp(\"expires_at\"),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\n// Enhanced NSFW level enum for content moderation\nexport const nsfwLevelEnum = pgEnum(\"nsfw_level\", [\"safe\", \"suggestive\", \"explicit\", \"illegal\"]);\n\n// Moderation Queue\nexport const moderationQueue = pgTable(\"moderation_queue\", {\n  id: uuid(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  mediaId: uuid(\"media_id\").references(() => mediaAssets.id).notNull(),\n  status: moderationStatusEnum(\"status\").default(\"pending\"),\n  reviewerId: varchar(\"reviewer_id\").references(() => users.id),\n  notes: text(\"notes\"),\n  priority: integer(\"priority\").default(0),\n  autoFlags: jsonb(\"auto_flags\"), // automated moderation flags\n  \n  // Enhanced AI detection fields\n  nsfwLevel: nsfwLevelEnum(\"nsfw_level\"),\n  nsfwScore: real(\"nsfw_score\"), // 0.0 to 1.0 confidence score\n  deepfakeDetected: boolean(\"deepfake_detected\").default(false),\n  deepfakeConfidence: real(\"deepfake_confidence\"), // 0.0 to 1.0\n  aiLabels: jsonb(\"ai_labels\"), // detected objects/scenes\n  facesDetected: integer(\"faces_detected\").default(0),\n  minorsDetected: boolean(\"minors_detected\").default(false),\n  violenceDetected: boolean(\"violence_detected\").default(false),\n  weaponsDetected: boolean(\"weapons_detected\").default(false),\n  drugsDetected: boolean(\"drugs_detected\").default(false),\n  \n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\n// Audit Logs (compliance tracking)\nexport const auditLogs = pgTable(\"audit_logs\", {\n  id: uuid(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  actorId: varchar(\"actor_id\").references(() => users.id),\n  action: varchar(\"action\").notNull(),\n  targetType: varchar(\"target_type\").notNull(),\n  targetId: varchar(\"target_id\").notNull(),\n  metadata: jsonb(\"metadata\"),\n  ipAddress: varchar(\"ip_address\"),\n  userAgent: text(\"user_agent\"),\n  timestamp: timestamp(\"timestamp\").defaultNow(),\n});\n\n// Payout Accounts (adult-friendly providers only)\nexport const payoutAccounts = pgTable(\"payout_accounts\", {\n  id: uuid(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  userId: varchar(\"user_id\").references(() => users.id).notNull(),\n  provider: varchar(\"provider\").notNull(), // Paxum, ePayService, etc.\n  accountRef: varchar(\"account_ref\").notNull(), // email or account ID\n  status: varchar(\"status\").default(\"active\"),\n  metadata: jsonb(\"metadata\"), // provider-specific data\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\n// Payout Requests\nexport const payoutRequests = pgTable(\"payout_requests\", {\n  id: uuid(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  userId: varchar(\"user_id\").references(() => users.id).notNull(),\n  payoutAccountId: uuid(\"payout_account_id\").references(() => payoutAccounts.id).notNull(),\n  amountCents: integer(\"amount_cents\").notNull(),\n  currency: varchar(\"currency\").default(\"USD\"),\n  status: payoutStatusEnum(\"status\").default(\"pending\"),\n  providerRef: varchar(\"provider_ref\"), // provider transaction ID\n  processedAt: timestamp(\"processed_at\"),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\n// Webhooks (payment notifications)\nexport const webhooks = pgTable(\"webhooks\", {\n  id: uuid(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  userId: varchar(\"user_id\").references(() => users.id).notNull(),\n  url: varchar(\"url\").notNull(),\n  secret: varchar(\"secret\").notNull(),\n  eventsJson: jsonb(\"events_json\").notNull(), // array of event types\n  status: webhookStatusEnum(\"status\").default(\"active\"),\n  lastTriggered: timestamp(\"last_triggered\"),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\n// Subscriptions\nexport const subscriptions = pgTable(\"subscriptions\", {\n  id: uuid(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  fanId: varchar(\"fan_id\").references(() => users.id).notNull(),\n  creatorId: varchar(\"creator_id\").references(() => users.id).notNull(),\n  status: varchar(\"status\").default(\"active\"),\n  priceAtPurchase: decimal(\"price_at_purchase\", { precision: 10, scale: 2 }),\n  expiresAt: timestamp(\"expires_at\"),\n  autoRenew: boolean(\"auto_renew\").default(true),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\n// Messages (for real-time chat)\nexport const messages = pgTable(\"messages\", {\n  id: uuid(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  senderId: varchar(\"sender_id\").references(() => users.id).notNull(),\n  recipientId: varchar(\"recipient_id\").references(() => users.id).notNull(),\n  content: text(\"content\").notNull(),\n  mediaUrl: varchar(\"media_url\"),\n  isRead: boolean(\"is_read\").default(false),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n});\n\n// FanzTrust™ Transactions (all payment gateway transactions)\nexport const transactions = pgTable(\"transactions\", {\n  id: uuid(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  fanId: varchar(\"fan_id\").references(() => users.id).notNull(),\n  creatorId: varchar(\"creator_id\").references(() => users.id).notNull(),\n  gateway: paymentGatewayEnum(\"gateway\").notNull(),\n  txid: varchar(\"txid\").notNull(), // transaction ID from gateway or blockchain\n  type: transactionTypeEnum(\"type\").notNull(),\n  status: transactionStatusEnum(\"status\").default(\"pending\"),\n  amountCents: integer(\"amount_cents\").notNull(),\n  currency: varchar(\"currency\").default(\"USD\"),\n  subscriptionId: uuid(\"subscription_id\").references(() => subscriptions.id),\n  metadata: jsonb(\"metadata\"), // gateway-specific data (last 4 digits, etc.)\n  ipAddress: varchar(\"ip_address\"),\n  deviceFingerprint: varchar(\"device_fingerprint\"),\n  walletAddress: varchar(\"wallet_address\"), // for crypto transactions\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n}, (table) => [\n  // Unique constraint on gateway + txid to prevent duplicate transactions\n  index(\"idx_gateway_txid\").on(table.gateway, table.txid),\n  // Indexes for common query patterns\n  index(\"idx_fan_transactions\").on(table.fanId, table.createdAt),\n  index(\"idx_creator_transactions\").on(table.creatorId, table.createdAt),\n  index(\"idx_transaction_status\").on(table.status),\n]);\n\n// FanzTrust™ Refund Requests\nexport const refundRequests = pgTable(\"refund_requests\", {\n  id: uuid(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  transactionId: uuid(\"transaction_id\").references(() => transactions.id).notNull().unique(), // One refund per transaction\n  fanId: varchar(\"fan_id\").references(() => users.id).notNull(),\n  creatorId: varchar(\"creator_id\").references(() => users.id).notNull(),\n  status: refundStatusEnum(\"status\").default(\"pending\"),\n  reason: text(\"reason\"),\n  verificationData: jsonb(\"verification_data\"), // proof submitted by fan\n  autoCheckResult: jsonb(\"auto_check_result\"), // auto-verification results\n  reviewedBy: varchar(\"reviewed_by\").references(() => users.id),\n  reviewNotes: text(\"review_notes\"),\n  refundedAmountCents: integer(\"refunded_amount_cents\"),\n  processedAt: timestamp(\"processed_at\"),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n}, (table) => [\n  // Indexes for query patterns\n  index(\"idx_fan_refunds\").on(table.fanId, table.status),\n  index(\"idx_creator_refunds\").on(table.creatorId, table.status),\n  index(\"idx_refund_status\").on(table.status),\n]);\n\n// FanzTrust™ Trust Scores (fan reputation system)\nexport const trustScores = pgTable(\"trust_scores\", {\n  id: uuid(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  userId: varchar(\"user_id\").references(() => users.id).notNull().unique(),\n  score: integer(\"score\").default(100), // 0-1000 scale\n  tier: trustScoreTierEnum(\"tier\").default(\"new\"),\n  totalTransactions: integer(\"total_transactions\").default(0),\n  successfulTransactions: integer(\"successful_transactions\").default(0),\n  disputedTransactions: integer(\"disputed_transactions\").default(0),\n  refundAttempts: integer(\"refund_attempts\").default(0),\n  approvedRefunds: integer(\"approved_refunds\").default(0),\n  deniedRefunds: integer(\"denied_refunds\").default(0),\n  abuseFlags: integer(\"abuse_flags\").default(0),\n  lastActivityAt: timestamp(\"last_activity_at\"),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\n// FanzPay Wallets (proprietary token system)\nexport const fanzWallets = pgTable(\"fanz_wallets\", {\n  id: uuid(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  userId: varchar(\"user_id\").references(() => users.id).notNull().unique(),\n  fanzTokenBalance: integer(\"fanz_token_balance\").default(0), // FanzToken balance in cents\n  fanzCoinBalance: integer(\"fanz_coin_balance\").default(0), // FanzCoin balance (loyalty points)\n  fanzCreditBalance: integer(\"fanz_credit_balance\").default(0), // FanzCredit (promotional credits)\n  lifetimeEarnings: integer(\"lifetime_earnings\").default(0),\n  lifetimeSpent: integer(\"lifetime_spent\").default(0),\n  status: varchar(\"status\").default(\"active\"), // active, frozen, suspended\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\n// FanzCard Virtual Cards (fan payment cards)\nexport const fanzCards = pgTable(\"fanz_cards\", {\n  id: uuid(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  userId: varchar(\"user_id\").references(() => users.id).notNull(),\n  cardToken: varchar(\"card_token\").notNull().unique(), // tokenized card reference\n  last4: varchar(\"last_4\").notNull(),\n  brand: varchar(\"brand\"), // visa, mastercard, etc.\n  expiryMonth: integer(\"expiry_month\"),\n  expiryYear: integer(\"expiry_year\"),\n  billingZip: varchar(\"billing_zip\"),\n  isDefault: boolean(\"is_default\").default(false),\n  status: varchar(\"status\").default(\"active\"),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\n// Payment Methods (saved payment info for fans)\nexport const paymentMethods = pgTable(\"payment_methods\", {\n  id: uuid(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  userId: varchar(\"user_id\").references(() => users.id).notNull(),\n  type: varchar(\"type\").notNull(), // card, crypto_wallet, fanzpay\n  gateway: paymentGatewayEnum(\"gateway\").notNull(),\n  reference: varchar(\"reference\").notNull(), // wallet address or card token\n  displayName: varchar(\"display_name\"), // e.g., \"Visa ••••1234\" or \"Solana Wallet\"\n  isDefault: boolean(\"is_default\").default(false),\n  metadata: jsonb(\"metadata\"), // extra gateway-specific info\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\n// Relations\nexport const usersRelations = relations(users, ({ one, many }) => ({\n  profile: one(profiles),\n  mediaAssets: many(mediaAssets),\n  posts: many(posts),\n  kycVerifications: many(kycVerifications),\n  records2257: many(records2257),\n  payoutAccounts: many(payoutAccounts),\n  payoutRequests: many(payoutRequests),\n  webhooks: many(webhooks),\n  sentMessages: many(messages, { relationName: \"sentMessages\" }),\n  receivedMessages: many(messages, { relationName: \"receivedMessages\" }),\n  fanSubscriptions: many(subscriptions, { relationName: \"fanSubscriptions\" }),\n  creatorSubscriptions: many(subscriptions, { relationName: \"creatorSubscriptions\" }),\n  fanTransactions: many(transactions, { relationName: \"fanTransactions\" }),\n  creatorTransactions: many(transactions, { relationName: \"creatorTransactions\" }),\n  fanRefundRequests: many(refundRequests, { relationName: \"fanRefundRequests\" }),\n  creatorRefundRequests: many(refundRequests, { relationName: \"creatorRefundRequests\" }),\n  trustScore: one(trustScores),\n  fanzWallet: one(fanzWallets),\n  fanzCards: many(fanzCards),\n  paymentMethods: many(paymentMethods),\n  following: many(follows, { relationName: \"fanFollows\" }),\n  followers: many(follows, { relationName: \"creatorFollows\" }),\n}));\n\nexport const profilesRelations = relations(profiles, ({ one }) => ({\n  user: one(users, { fields: [profiles.userId], references: [users.id] }),\n}));\n\nexport const mediaAssetsRelations = relations(mediaAssets, ({ one, many }) => ({\n  owner: one(users, { fields: [mediaAssets.ownerId], references: [users.id] }),\n  moderationItems: many(moderationQueue),\n  posts: many(posts),\n}));\n\nexport const postsRelations = relations(posts, ({ one }) => ({\n  creator: one(users, { fields: [posts.creatorId], references: [users.id] }),\n  mediaAsset: one(mediaAssets, { fields: [posts.mediaAssetId], references: [mediaAssets.id] }),\n}));\n\nexport const followsRelations = relations(follows, ({ one }) => ({\n  fan: one(users, { fields: [follows.fanId], references: [users.id], relationName: \"fanFollows\" }),\n  creator: one(users, { fields: [follows.creatorId], references: [users.id], relationName: \"creatorFollows\" }),\n}));\n\nexport const moderationQueueRelations = relations(moderationQueue, ({ one }) => ({\n  media: one(mediaAssets, { fields: [moderationQueue.mediaId], references: [mediaAssets.id] }),\n  reviewer: one(users, { fields: [moderationQueue.reviewerId], references: [users.id] }),\n}));\n\nexport const payoutAccountsRelations = relations(payoutAccounts, ({ one, many }) => ({\n  user: one(users, { fields: [payoutAccounts.userId], references: [users.id] }),\n  payoutRequests: many(payoutRequests),\n}));\n\nexport const payoutRequestsRelations = relations(payoutRequests, ({ one }) => ({\n  user: one(users, { fields: [payoutRequests.userId], references: [users.id] }),\n  payoutAccount: one(payoutAccounts, { fields: [payoutRequests.payoutAccountId], references: [payoutAccounts.id] }),\n}));\n\nexport const subscriptionsRelations = relations(subscriptions, ({ one }) => ({\n  fan: one(users, { fields: [subscriptions.fanId], references: [users.id], relationName: \"fanSubscriptions\" }),\n  creator: one(users, { fields: [subscriptions.creatorId], references: [users.id], relationName: \"creatorSubscriptions\" }),\n}));\n\nexport const messagesRelations = relations(messages, ({ one }) => ({\n  sender: one(users, { fields: [messages.senderId], references: [users.id], relationName: \"sentMessages\" }),\n  recipient: one(users, { fields: [messages.recipientId], references: [users.id], relationName: \"receivedMessages\" }),\n}));\n\nexport const transactionsRelations = relations(transactions, ({ one, many }) => ({\n  fan: one(users, { fields: [transactions.fanId], references: [users.id], relationName: \"fanTransactions\" }),\n  creator: one(users, { fields: [transactions.creatorId], references: [users.id], relationName: \"creatorTransactions\" }),\n  subscription: one(subscriptions, { fields: [transactions.subscriptionId], references: [subscriptions.id] }),\n  refundRequests: many(refundRequests),\n}));\n\nexport const refundRequestsRelations = relations(refundRequests, ({ one }) => ({\n  transaction: one(transactions, { fields: [refundRequests.transactionId], references: [transactions.id] }),\n  fan: one(users, { fields: [refundRequests.fanId], references: [users.id], relationName: \"fanRefundRequests\" }),\n  creator: one(users, { fields: [refundRequests.creatorId], references: [users.id], relationName: \"creatorRefundRequests\" }),\n  reviewer: one(users, { fields: [refundRequests.reviewedBy], references: [users.id] }),\n}));\n\nexport const trustScoresRelations = relations(trustScores, ({ one }) => ({\n  user: one(users, { fields: [trustScores.userId], references: [users.id] }),\n}));\n\nexport const fanzWalletsRelations = relations(fanzWallets, ({ one }) => ({\n  user: one(users, { fields: [fanzWallets.userId], references: [users.id] }),\n}));\n\nexport const fanzCardsRelations = relations(fanzCards, ({ one }) => ({\n  user: one(users, { fields: [fanzCards.userId], references: [users.id] }),\n}));\n\nexport const paymentMethodsRelations = relations(paymentMethods, ({ one }) => ({\n  user: one(users, { fields: [paymentMethods.userId], references: [users.id] }),\n}));\n\n// Insert schemas\nexport const insertUserSchema = createInsertSchema(users).omit({\n  id: true,\n  createdAt: true,\n  updatedAt: true,\n});\n\nexport const upsertUserSchema = createInsertSchema(users).pick({\n  id: true,\n  email: true,\n  firstName: true,\n  lastName: true,\n  profileImageUrl: true,\n});\n\nexport const insertPasswordResetTokenSchema = createInsertSchema(passwordResetTokens).omit({\n  id: true,\n  createdAt: true,\n  usedAt: true,\n});\n\nexport const insertEmailRecoveryTokenSchema = createInsertSchema(emailRecoveryTokens).omit({\n  id: true,\n  createdAt: true,\n  usedAt: true,\n});\n\nexport const insertEmailVerificationTokenSchema = createInsertSchema(emailVerificationTokens).omit({\n  id: true,\n  createdAt: true,\n  usedAt: true,\n});\n\nexport const insertProfileSchema = createInsertSchema(profiles).omit({\n  id: true,\n  createdAt: true,\n  updatedAt: true,\n});\n\nexport const insertMediaAssetSchema = createInsertSchema(mediaAssets).omit({\n  id: true,\n  createdAt: true,\n  updatedAt: true,\n});\n\nexport const insertPayoutAccountSchema = createInsertSchema(payoutAccounts).omit({\n  id: true,\n  createdAt: true,\n  updatedAt: true,\n});\n\nexport const insertMessageSchema = createInsertSchema(messages).omit({\n  id: true,\n  createdAt: true,\n});\n\n// FanzTrust™ Insert Schemas\nexport const insertTransactionSchema = createInsertSchema(transactions).omit({\n  id: true,\n  createdAt: true,\n  updatedAt: true,\n});\n\nexport const insertRefundRequestSchema = createInsertSchema(refundRequests).omit({\n  id: true,\n  createdAt: true,\n  updatedAt: true,\n});\n\nexport const insertTrustScoreSchema = createInsertSchema(trustScores).omit({\n  id: true,\n  createdAt: true,\n  updatedAt: true,\n});\n\nexport const insertFanzWalletSchema = createInsertSchema(fanzWallets).omit({\n  id: true,\n  createdAt: true,\n  updatedAt: true,\n});\n\nexport const insertFanzCardSchema = createInsertSchema(fanzCards).omit({\n  id: true,\n  createdAt: true,\n  updatedAt: true,\n});\n\nexport const insertPaymentMethodSchema = createInsertSchema(paymentMethods).omit({\n  id: true,\n  createdAt: true,\n  updatedAt: true,\n});\n\n// Types\nexport type User = typeof users.$inferSelect;\nexport type UpsertUser = z.infer<typeof upsertUserSchema>;\nexport type InsertUser = z.infer<typeof insertUserSchema>;\nexport type PasswordResetToken = typeof passwordResetTokens.$inferSelect;\nexport type InsertPasswordResetToken = z.infer<typeof insertPasswordResetTokenSchema>;\nexport type EmailRecoveryToken = typeof emailRecoveryTokens.$inferSelect;\nexport type InsertEmailRecoveryToken = z.infer<typeof insertEmailRecoveryTokenSchema>;\nexport type EmailVerificationToken = typeof emailVerificationTokens.$inferSelect;\nexport type InsertEmailVerificationToken = z.infer<typeof insertEmailVerificationTokenSchema>;\nexport type Profile = typeof profiles.$inferSelect;\nexport type InsertProfile = z.infer<typeof insertProfileSchema>;\nexport type MediaAsset = typeof mediaAssets.$inferSelect;\nexport type InsertMediaAsset = z.infer<typeof insertMediaAssetSchema>;\nexport type PayoutAccount = typeof payoutAccounts.$inferSelect;\nexport type InsertPayoutAccount = z.infer<typeof insertPayoutAccountSchema>;\nexport type Message = z.infer<typeof insertMessageSchema>;\nexport type InsertMessage = z.infer<typeof insertMessageSchema>;\nexport type ModerationItem = typeof moderationQueue.$inferSelect;\nexport type PayoutRequest = typeof payoutRequests.$inferSelect;\nexport type Subscription = typeof subscriptions.$inferSelect;\n\n// FanzTrust™ Types\nexport type Transaction = typeof transactions.$inferSelect;\nexport type InsertTransaction = z.infer<typeof insertTransactionSchema>;\nexport type RefundRequest = typeof refundRequests.$inferSelect;\nexport type InsertRefundRequest = z.infer<typeof insertRefundRequestSchema>;\nexport type TrustScore = typeof trustScores.$inferSelect;\nexport type InsertTrustScore = z.infer<typeof insertTrustScoreSchema>;\nexport type FanzWallet = typeof fanzWallets.$inferSelect;\nexport type InsertFanzWallet = z.infer<typeof insertFanzWalletSchema>;\nexport type FanzCard = typeof fanzCards.$inferSelect;\nexport type InsertFanzCard = z.infer<typeof insertFanzCardSchema>;\nexport type PaymentMethod = typeof paymentMethods.$inferSelect;\nexport type InsertPaymentMethod = z.infer<typeof insertPaymentMethodSchema>;\n\n// FanzTrust™ Request Validation Schemas\nexport const verifyTransactionSchema = z.object({\n  creatorId: z.string().min(1, \"Creator ID is required\"),\n  gateway: z.enum([\"rocketgate\", \"segpay\", \"ccbill\", \"solana\", \"ethereum\", \"tron\", \"fanzpay\"]),\n  txid: z.string().min(1, \"Transaction ID is required\"),\n  walletAddress: z.string().optional(),\n  email: z.string().email().optional(),\n});\n\nexport const requestRefundSchema = z.object({\n  transactionId: z.string().uuid(\"Invalid transaction ID\"),\n  reason: z.string().min(10, \"Reason must be at least 10 characters\").max(1000),\n  verificationData: z.record(z.any()).optional(),\n});\n\nexport const reviewRefundSchema = z.object({\n  notes: z.string().min(1, \"Review notes are required\").max(2000),\n});\n\nexport const createPaymentMethodSchema = z.object({\n  type: z.enum([\"card\", \"crypto_wallet\", \"fanzpay\"]),\n  gateway: z.enum([\"rocketgate\", \"segpay\", \"ccbill\", \"solana\", \"ethereum\", \"tron\", \"fanzpay\"]),\n  reference: z.string().min(1, \"Payment reference is required\"),\n  displayName: z.string().min(1, \"Display name is required\").max(100),\n  isDefault: z.boolean().optional(),\n  metadata: z.record(z.any()).optional(),\n});\n\nexport type VerifyTransactionRequest = z.infer<typeof verifyTransactionSchema>;\nexport type RequestRefundRequest = z.infer<typeof requestRefundSchema>;\nexport type ReviewRefundRequest = z.infer<typeof reviewRefundSchema>;\nexport type CreatePaymentMethodRequest = z.infer<typeof createPaymentMethodSchema>;\n\n// Help desk tickets\nexport const tickets = pgTable(\"tickets\", {\n  id: serial(\"id\").primaryKey(),\n  userId: varchar(\"user_id\").references(() => users.id).notNull(),\n  title: varchar(\"title\", { length: 255 }).notNull(),\n  description: text(\"description\").notNull(),\n  category: varchar(\"category\").notNull(), // \"technical\", \"payment\", \"content\", \"account\", \"feature\"\n  priority: varchar(\"priority\").default(\"medium\"), // \"low\", \"medium\", \"high\", \"urgent\"\n  status: varchar(\"status\").default(\"open\"), // \"open\", \"in_progress\", \"resolved\", \"closed\"\n  assignedTo: varchar(\"assigned_to\").references(() => users.id),\n  tags: text(\"tags\").array().default([]),\n  attachments: jsonb(\"attachments\"),\n  lastResponseAt: timestamp(\"last_response_at\"),\n  resolvedAt: timestamp(\"resolved_at\"),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow()\n});\n\n// Ticket responses/comments\nexport const ticketResponses = pgTable(\"ticket_responses\", {\n  id: serial(\"id\").primaryKey(),\n  ticketId: integer(\"ticket_id\").references(() => tickets.id).notNull(),\n  userId: varchar(\"user_id\").references(() => users.id).notNull(),\n  content: text(\"content\").notNull(),\n  isInternal: boolean(\"is_internal\").default(false), // Staff-only notes\n  attachments: jsonb(\"attachments\"),\n  createdAt: timestamp(\"created_at\").defaultNow()\n});\n\n// Wiki articles\nexport const wikiArticles = pgTable(\"wiki_articles\", {\n  id: varchar(\"id\").primaryKey(),\n  title: varchar(\"title\", { length: 255 }).notNull(),\n  content: text(\"content\").notNull(),\n  category: varchar(\"category\").notNull(),\n  tags: text(\"tags\").array().default([]),\n  authorId: varchar(\"author_id\").references(() => users.id),\n  status: varchar(\"status\").default(\"published\"), // \"draft\", \"published\", \"archived\"\n  viewCount: integer(\"view_count\").default(0),\n  helpfulVotes: integer(\"helpful_votes\").default(0),\n  lastUpdated: timestamp(\"last_updated\").defaultNow(),\n  createdAt: timestamp(\"created_at\").defaultNow()\n});\n\n// Tutorial content\nexport const tutorials = pgTable(\"tutorials\", {\n  id: serial(\"id\").primaryKey(),\n  title: varchar(\"title\", { length: 255 }).notNull(),\n  description: text(\"description\"),\n  content: text(\"content\").notNull(),\n  category: varchar(\"category\").notNull(), // \"getting-started\", \"content-creation\", \"monetization\", \"technical\"\n  difficulty: varchar(\"difficulty\").default(\"beginner\"), // \"beginner\", \"intermediate\", \"advanced\"\n  estimatedTime: integer(\"estimated_time\"), // in minutes\n  tags: text(\"tags\").array().default([]),\n  authorId: varchar(\"author_id\").references(() => users.id),\n  status: varchar(\"status\").default(\"published\"),\n  viewCount: integer(\"view_count\").default(0),\n  completionCount: integer(\"completion_count\").default(0),\n  rating: numeric(\"rating\", { precision: 3, scale: 2 }).default(\"0\"),\n  ratingCount: integer(\"rating_count\").default(0),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow()\n});\n\n// Tutorial steps\nexport const tutorialSteps = pgTable(\"tutorial_steps\", {\n  id: serial(\"id\").primaryKey(),\n  tutorialId: integer(\"tutorial_id\").references(() => tutorials.id).notNull(),\n  stepNumber: integer(\"step_number\").notNull(),\n  title: varchar(\"title\", { length: 255 }).notNull(),\n  content: text(\"content\").notNull(),\n  mediaUrl: varchar(\"media_url\"),\n  actionType: varchar(\"action_type\"), // \"click\", \"input\", \"navigate\", \"wait\"\n  targetSelector: varchar(\"target_selector\"), // CSS selector for interactive elements\n  createdAt: timestamp(\"created_at\").defaultNow()\n});\n\n// User tutorial progress\nexport const tutorialProgress = pgTable(\"tutorial_progress\", {\n  id: serial(\"id\").primaryKey(),\n  userId: varchar(\"user_id\").references(() => users.id).notNull(),\n  tutorialId: integer(\"tutorial_id\").references(() => tutorials.id).notNull(),\n  currentStep: integer(\"current_step\").default(1),\n  completedSteps: integer(\"completed_steps\").array().default([]),\n  status: varchar(\"status\").default(\"started\"), // \"started\", \"completed\", \"abandoned\"\n  completedAt: timestamp(\"completed_at\"),\n  startedAt: timestamp(\"started_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow()\n});\n\n// FAQ entries\nexport const faqEntries = pgTable(\"faq_entries\", {\n  id: serial(\"id\").primaryKey(),\n  question: varchar(\"question\", { length: 500 }).notNull(),\n  answer: text(\"answer\").notNull(),\n  category: varchar(\"category\").notNull(),\n  order: integer(\"order\").default(0),\n  isPublished: boolean(\"is_published\").default(true),\n  viewCount: integer(\"view_count\").default(0),\n  helpfulVotes: integer(\"helpful_votes\").default(0),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow()\n});\n\n// Relations for new tables\nexport const ticketsRelations = relations(tickets, ({ one, many }) => ({\n  user: one(users, { fields: [tickets.userId], references: [users.id] }),\n  assignee: one(users, { fields: [tickets.assignedTo], references: [users.id] }),\n  responses: many(ticketResponses),\n}));\n\nexport const ticketResponsesRelations = relations(ticketResponses, ({ one }) => ({\n  ticket: one(tickets, { fields: [ticketResponses.ticketId], references: [tickets.id] }),\n  user: one(users, { fields: [ticketResponses.userId], references: [users.id] }),\n}));\n\nexport const wikiArticlesRelations = relations(wikiArticles, ({ one }) => ({\n  author: one(users, { fields: [wikiArticles.authorId], references: [users.id] }),\n}));\n\nexport const tutorialsRelations = relations(tutorials, ({ one, many }) => ({\n  author: one(users, { fields: [tutorials.authorId], references: [users.id] }),\n  steps: many(tutorialSteps),\n  progress: many(tutorialProgress),\n}));\n\nexport const tutorialStepsRelations = relations(tutorialSteps, ({ one }) => ({\n  tutorial: one(tutorials, { fields: [tutorialSteps.tutorialId], references: [tutorials.id] }),\n}));\n\nexport const tutorialProgressRelations = relations(tutorialProgress, ({ one }) => ({\n  user: one(users, { fields: [tutorialProgress.userId], references: [users.id] }),\n  tutorial: one(tutorials, { fields: [tutorialProgress.tutorialId], references: [tutorials.id] }),\n}));\n\n// Insert schemas for new tables\nexport const insertTicketSchema = createInsertSchema(tickets).omit({\n  id: true,\n  createdAt: true,\n  updatedAt: true,\n});\n\n// Client-side ticket creation schema (only fields sent by frontend)\nexport const createTicketSchema = insertTicketSchema.omit({\n  userId: true,\n  status: true,\n  assignedTo: true,\n  tags: true,\n  attachments: true,\n  lastResponseAt: true,\n  resolvedAt: true,\n});\n\nexport const insertTicketResponseSchema = createInsertSchema(ticketResponses).omit({\n  id: true,\n  createdAt: true,\n});\n\nexport const insertWikiArticleSchema = createInsertSchema(wikiArticles).omit({\n  createdAt: true,\n});\n\nexport const insertTutorialSchema = createInsertSchema(tutorials).omit({\n  id: true,\n  createdAt: true,\n  updatedAt: true,\n});\n\nexport const insertTutorialStepSchema = createInsertSchema(tutorialSteps).omit({\n  id: true,\n  createdAt: true,\n});\n\nexport const insertFaqEntrySchema = createInsertSchema(faqEntries).omit({\n  id: true,\n  createdAt: true,\n  updatedAt: true,\n});\n\nexport const insertPostSchema = createInsertSchema(posts).omit({\n  id: true,\n  viewCount: true,\n  likeCount: true,\n  commentCount: true,\n  createdAt: true,\n  updatedAt: true,\n});\n\nexport const insertPostLikeSchema = createInsertSchema(postLikes).omit({\n  id: true,\n  createdAt: true,\n});\n\nexport const insertPostCommentSchema = createInsertSchema(postComments).omit({\n  id: true,\n  createdAt: true,\n  updatedAt: true,\n});\n\nexport const insertFollowSchema = createInsertSchema(follows).omit({\n  id: true,\n  createdAt: true,\n});\n\nexport const insertStoryMomentSchema = createInsertSchema(storyMoments).omit({\n  id: true,\n  viewCount: true,\n  createdAt: true,\n});\n\nexport const insertStoryViewSchema = createInsertSchema(storyViews).omit({\n  id: true,\n  viewedAt: true,\n});\n\nexport const insertFanLevelSchema = createInsertSchema(fanLevels).omit({\n  id: true,\n  createdAt: true,\n  updatedAt: true,\n});\n\nexport const insertCreatorAnalyticsSchema = createInsertSchema(creatorAnalytics).omit({\n  id: true,\n  createdAt: true,\n});\n\n// Live Streaming tables\nexport const streamStatusEnum = pgEnum(\"stream_status\", [\"scheduled\", \"live\", \"ended\", \"archived\"]);\n\nexport const liveStreams = pgTable(\"live_streams\", {\n  id: uuid(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  creatorId: varchar(\"creator_id\").references(() => users.id).notNull(),\n  title: varchar(\"title\").notNull(),\n  description: text(\"description\"),\n  thumbnailUrl: varchar(\"thumbnail_url\"),\n  status: streamStatusEnum(\"status\").default(\"scheduled\"),\n  scheduledStartTime: timestamp(\"scheduled_start_time\"),\n  actualStartTime: timestamp(\"actual_start_time\"),\n  endTime: timestamp(\"end_time\"),\n  streamKey: varchar(\"stream_key\"), // for RTMP streaming\n  viewerCount: integer(\"viewer_count\").default(0),\n  peakViewers: integer(\"peak_viewers\").default(0),\n  totalTips: decimal(\"total_tips\", { precision: 10, scale: 2 }).default(\"0\"),\n  requiresSubscription: boolean(\"requires_subscription\").default(false),\n  isRecorded: boolean(\"is_recorded\").default(true), // whether to save VOD\n  recordingUrl: varchar(\"recording_url\"), // URL to saved recording\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n}, (table) => [\n  index(\"idx_stream_creator\").on(table.creatorId, table.createdAt),\n  index(\"idx_stream_status\").on(table.status),\n]);\n\nexport const streamViewers = pgTable(\"stream_viewers\", {\n  id: uuid(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  streamId: uuid(\"stream_id\").references(() => liveStreams.id).notNull(),\n  viewerId: varchar(\"viewer_id\").references(() => users.id).notNull(),\n  joinedAt: timestamp(\"joined_at\").defaultNow(),\n  leftAt: timestamp(\"left_at\"),\n  totalWatchTime: integer(\"total_watch_time\").default(0), // in seconds\n}, (table) => [\n  index(\"idx_stream_viewers\").on(table.streamId, table.viewerId),\n]);\n\nexport const streamChat = pgTable(\"stream_chat\", {\n  id: uuid(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  streamId: uuid(\"stream_id\").references(() => liveStreams.id).notNull(),\n  userId: varchar(\"user_id\").references(() => users.id).notNull(),\n  message: text(\"message\").notNull(),\n  isPinned: boolean(\"is_pinned\").default(false),\n  isDeleted: boolean(\"is_deleted\").default(false),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n}, (table) => [\n  index(\"idx_stream_chat\").on(table.streamId, table.createdAt),\n]);\n\nexport const streamTips = pgTable(\"stream_tips\", {\n  id: uuid(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  streamId: uuid(\"stream_id\").references(() => liveStreams.id).notNull(),\n  fromUserId: varchar(\"from_user_id\").references(() => users.id).notNull(),\n  toCreatorId: varchar(\"to_creator_id\").references(() => users.id).notNull(),\n  amount: decimal(\"amount\", { precision: 10, scale: 2 }).notNull(),\n  message: text(\"message\"),\n  isHighlighted: boolean(\"is_highlighted\").default(false), // show prominently in stream\n  createdAt: timestamp(\"created_at\").defaultNow(),\n}, (table) => [\n  index(\"idx_stream_tips\").on(table.streamId, table.createdAt),\n  index(\"idx_tips_creator\").on(table.toCreatorId),\n]);\n\n// Insert schemas for live streaming\nexport const insertLiveStreamSchema = createInsertSchema(liveStreams).omit({\n  id: true,\n  createdAt: true,\n  updatedAt: true,\n  viewerCount: true,\n  peakViewers: true,\n  totalTips: true,\n});\n\nexport const insertStreamViewerSchema = createInsertSchema(streamViewers).omit({\n  id: true,\n  joinedAt: true,\n  totalWatchTime: true,\n});\n\nexport const insertStreamChatSchema = createInsertSchema(streamChat).omit({\n  id: true,\n  createdAt: true,\n  isPinned: true,\n  isDeleted: true,\n});\n\nexport const insertStreamTipSchema = createInsertSchema(streamTips).omit({\n  id: true,\n  createdAt: true,\n  isHighlighted: true,\n});\n\n// Creator Collaboration System\nexport const collaborationStatusEnum = pgEnum(\"collaboration_status\", [\"invited\", \"accepted\", \"rejected\", \"active\", \"completed\"]);\n\nexport const collaborations = pgTable(\"collaborations\", {\n  id: uuid(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  contentId: uuid(\"content_id\"), // post or media asset\n  contentType: varchar(\"content_type\").notNull(), // \"post\", \"media\", \"stream\"\n  primaryCreatorId: varchar(\"primary_creator_id\").references(() => users.id).notNull(),\n  collaboratorId: varchar(\"collaborator_id\").references(() => users.id).notNull(),\n  status: collaborationStatusEnum(\"status\").default(\"invited\"),\n  revenueSplitPercent: integer(\"revenue_split_percent\").default(50), // collaborator's percentage\n  invitedAt: timestamp(\"invited_at\").defaultNow(),\n  respondedAt: timestamp(\"responded_at\"),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n}, (table) => [\n  index(\"idx_collab_creator\").on(table.primaryCreatorId),\n  index(\"idx_collab_collaborator\").on(table.collaboratorId),\n]);\n\n// Subscription Tiers\nexport const subscriptionTiers = pgTable(\"subscription_tiers\", {\n  id: uuid(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  creatorId: varchar(\"creator_id\").references(() => users.id).notNull(),\n  name: varchar(\"name\").notNull(),\n  description: text(\"description\"),\n  priceMonthly: decimal(\"price_monthly\", { precision: 10, scale: 2 }).notNull(),\n  benefits: jsonb(\"benefits\"), // array of benefit descriptions\n  isActive: boolean(\"is_active\").default(true),\n  sortOrder: integer(\"sort_order\").default(0),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n}, (table) => [\n  index(\"idx_tier_creator\").on(table.creatorId),\n]);\n\n// Content Bundles\nexport const contentBundles = pgTable(\"content_bundles\", {\n  id: uuid(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  creatorId: varchar(\"creator_id\").references(() => users.id).notNull(),\n  title: varchar(\"title\").notNull(),\n  description: text(\"description\"),\n  price: decimal(\"price\", { precision: 10, scale: 2 }).notNull(),\n  discountPercent: integer(\"discount_percent\").default(0),\n  thumbnailUrl: varchar(\"thumbnail_url\"),\n  contentIds: jsonb(\"content_ids\").notNull(), // array of media asset IDs\n  purchaseCount: integer(\"purchase_count\").default(0),\n  isActive: boolean(\"is_active\").default(true),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n}, (table) => [\n  index(\"idx_bundle_creator\").on(table.creatorId),\n]);\n\n// Virtual Gifts\nexport const virtualGifts = pgTable(\"virtual_gifts\", {\n  id: uuid(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  name: varchar(\"name\").notNull(),\n  description: text(\"description\"),\n  price: decimal(\"price\", { precision: 10, scale: 2 }).notNull(),\n  animationUrl: varchar(\"animation_url\"),\n  iconUrl: varchar(\"icon_url\").notNull(),\n  category: varchar(\"category\"), // \"basic\", \"premium\", \"exclusive\"\n  creatorRevenuePercent: integer(\"creator_revenue_percent\").default(80),\n  isActive: boolean(\"is_active\").default(true),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n});\n\nexport const giftsSent = pgTable(\"gifts_sent\", {\n  id: uuid(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  giftId: uuid(\"gift_id\").references(() => virtualGifts.id).notNull(),\n  fromUserId: varchar(\"from_user_id\").references(() => users.id).notNull(),\n  toCreatorId: varchar(\"to_creator_id\").references(() => users.id).notNull(),\n  postId: uuid(\"post_id\").references(() => posts.id),\n  streamId: uuid(\"stream_id\").references(() => liveStreams.id),\n  message: text(\"message\"),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n}, (table) => [\n  index(\"idx_gifts_sent_to\").on(table.toCreatorId, table.createdAt),\n  index(\"idx_gifts_sent_from\").on(table.fromUserId),\n]);\n\n// Leaderboards\nexport const leaderboards = pgTable(\"leaderboards\", {\n  id: uuid(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  period: varchar(\"period\").notNull(), // \"daily\", \"weekly\", \"monthly\", \"all-time\"\n  category: varchar(\"category\").notNull(), // \"top_creators\", \"top_fans\", \"top_spenders\"\n  userId: varchar(\"user_id\").references(() => users.id).notNull(),\n  score: integer(\"score\").notNull(),\n  rank: integer(\"rank\"),\n  metadata: jsonb(\"metadata\"), // additional stats\n  periodStart: timestamp(\"period_start\").notNull(),\n  periodEnd: timestamp(\"period_end\").notNull(),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n}, (table) => [\n  index(\"idx_leaderboard_period_category\").on(table.period, table.category, table.rank),\n]);\n\n// Referral Program\nexport const referralCodes = pgTable(\"referral_codes\", {\n  id: uuid(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  userId: varchar(\"user_id\").references(() => users.id).notNull().unique(),\n  code: varchar(\"code\").notNull().unique(),\n  commissionPercent: integer(\"commission_percent\").default(10),\n  totalReferrals: integer(\"total_referrals\").default(0),\n  totalEarnings: decimal(\"total_earnings\", { precision: 10, scale: 2 }).default(\"0\"),\n  isActive: boolean(\"is_active\").default(true),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n});\n\nexport const referrals = pgTable(\"referrals\", {\n  id: uuid(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  referrerId: varchar(\"referrer_id\").references(() => users.id).notNull(),\n  referredUserId: varchar(\"referred_user_id\").references(() => users.id).notNull(),\n  referralCode: varchar(\"referral_code\").notNull(),\n  commissionEarned: decimal(\"commission_earned\", { precision: 10, scale: 2 }).default(\"0\"),\n  isPaid: boolean(\"is_paid\").default(false),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n}, (table) => [\n  index(\"idx_referral_referrer\").on(table.referrerId),\n]);\n\n// Scheduled Content\nexport const scheduledPosts = pgTable(\"scheduled_posts\", {\n  id: uuid(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  creatorId: varchar(\"creator_id\").references(() => users.id).notNull(),\n  text: text(\"text\"),\n  mediaUrl: varchar(\"media_url\"),\n  mediaType: varchar(\"media_type\"),\n  scheduledFor: timestamp(\"scheduled_for\").notNull(),\n  isPublished: boolean(\"is_published\").default(false),\n  publishedPostId: uuid(\"published_post_id\").references(() => posts.id),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n}, (table) => [\n  index(\"idx_scheduled_creator\").on(table.creatorId, table.scheduledFor),\n  index(\"idx_scheduled_pending\").on(table.isPublished, table.scheduledFor),\n]);\n\n// Creator Badges\nexport const creatorBadges = pgTable(\"creator_badges\", {\n  id: uuid(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  userId: varchar(\"user_id\").references(() => users.id).notNull(),\n  badgeType: varchar(\"badge_type\").notNull(), // \"verified\", \"top_creator\", \"exclusive\", \"partner\"\n  isActive: boolean(\"is_active\").default(true),\n  verifiedBy: varchar(\"verified_by\").references(() => users.id),\n  verifiedAt: timestamp(\"verified_at\"),\n  metadata: jsonb(\"metadata\"),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n}, (table) => [\n  index(\"idx_badge_user\").on(table.userId),\n]);\n\n// Content Watermarks\nexport const contentWatermarks = pgTable(\"content_watermarks\", {\n  id: uuid(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  mediaId: uuid(\"media_id\").references(() => mediaAssets.id).notNull().unique(),\n  watermarkSignature: text(\"watermark_signature\").notNull(),\n  viewerFingerprint: text(\"viewer_fingerprint\"),\n  generatedAt: timestamp(\"generated_at\").defaultNow(),\n});\n\n// Geo-blocking Rules\nexport const geoBlockingRules = pgTable(\"geo_blocking_rules\", {\n  id: uuid(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  creatorId: varchar(\"creator_id\").references(() => users.id).notNull(),\n  contentType: varchar(\"content_type\"), // \"all\", \"posts\", \"streams\", etc.\n  blockedCountries: jsonb(\"blocked_countries\").notNull(), // array of country codes\n  allowedCountries: jsonb(\"allowed_countries\"), // optional whitelist\n  isActive: boolean(\"is_active\").default(true),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n}, (table) => [\n  index(\"idx_geoblocking_creator\").on(table.creatorId),\n]);\n\n// Content Tags (for advanced search)\nexport const contentTags = pgTable(\"content_tags\", {\n  id: uuid(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  name: varchar(\"name\").notNull().unique(),\n  category: varchar(\"category\"), // \"genre\", \"activity\", \"niche\"\n  usageCount: integer(\"usage_count\").default(0),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n});\n\nexport const postTags = pgTable(\"post_tags\", {\n  id: uuid(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  postId: uuid(\"post_id\").references(() => posts.id).notNull(),\n  tagId: uuid(\"tag_id\").references(() => contentTags.id).notNull(),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n}, (table) => [\n  index(\"idx_post_tag\").on(table.postId, table.tagId),\n]);\n\n// DMCA Takedown Claims\nexport const dmcaClaims = pgTable(\"dmca_claims\", {\n  id: uuid(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  claimantName: varchar(\"claimant_name\").notNull(),\n  claimantEmail: varchar(\"claimant_email\").notNull(),\n  claimantAddress: text(\"claimant_address\"),\n  contentUrl: varchar(\"content_url\").notNull(),\n  mediaId: uuid(\"media_id\").references(() => mediaAssets.id),\n  description: text(\"description\").notNull(),\n  status: varchar(\"status\").default(\"pending\"), // pending, approved, rejected, counter_claimed\n  reviewedBy: varchar(\"reviewed_by\").references(() => users.id),\n  reviewedAt: timestamp(\"reviewed_at\"),\n  actionTaken: text(\"action_taken\"),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n}, (table) => [\n  index(\"idx_dmca_status\").on(table.status, table.createdAt),\n]);\n\n// ============================================================\n// PHASE 1: BLOCKCHAIN, LOANS, AND DEEPFAKE DETECTION\n// ============================================================\n\n// NFT Blockchain Content Ownership\nexport const blockchainEnum = pgEnum(\"blockchain\", [\"ethereum\", \"polygon\", \"solana\", \"base\"]);\nexport const nftStatusEnum = pgEnum(\"nft_status\", [\"pending\", \"minting\", \"minted\", \"failed\", \"burned\"]);\n\nexport const nftContracts = pgTable(\"nft_contracts\", {\n  id: uuid(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  creatorId: varchar(\"creator_id\").references(() => users.id, { onDelete: \"cascade\" }).notNull(),\n  blockchain: blockchainEnum(\"blockchain\").default(\"polygon\"),\n  contractAddress: varchar(\"contract_address\").notNull().unique(),\n  name: varchar(\"name\").notNull(),\n  symbol: varchar(\"symbol\").notNull(),\n  royaltyPercent: integer(\"royalty_percent\").default(10), // 10% royalty\n  isActive: boolean(\"is_active\").default(true),\n  deployedAt: timestamp(\"deployed_at\"),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n}, (table) => [\n  index(\"idx_nft_contract_creator_created\").on(table.creatorId, table.createdAt),\n  index(\"idx_nft_contract_address\").on(table.contractAddress),\n]);\n\nexport const nftMints = pgTable(\"nft_mints\", {\n  id: uuid(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  contractId: uuid(\"contract_id\").references(() => nftContracts.id, { onDelete: \"cascade\" }).notNull(),\n  mediaId: uuid(\"media_id\").references(() => mediaAssets.id, { onDelete: \"cascade\" }).notNull(),\n  creatorId: varchar(\"creator_id\").references(() => users.id, { onDelete: \"cascade\" }).notNull(),\n  ownerId: varchar(\"owner_id\").references(() => users.id, { onDelete: \"set null\" }), // current owner\n  tokenId: varchar(\"token_id\"), // on-chain token ID\n  tokenUri: text(\"token_uri\"), // metadata URI\n  status: nftStatusEnum(\"status\").default(\"pending\"),\n  blockchain: blockchainEnum(\"blockchain\").default(\"polygon\"),\n  mintPrice: decimal(\"mint_price\", { precision: 18, scale: 8 }), // crypto price\n  mintPriceUsd: decimal(\"mint_price_usd\", { precision: 10, scale: 2 }), // USD equivalent\n  txHash: varchar(\"tx_hash\"), // blockchain transaction hash\n  mintedAt: timestamp(\"minted_at\"),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n}, (table) => [\n  index(\"idx_nft_mint_contract\").on(table.contractId),\n  index(\"idx_nft_mint_media\").on(table.mediaId),\n  index(\"idx_nft_mint_creator\").on(table.creatorId),\n  index(\"idx_nft_mint_creator_created\").on(table.creatorId, table.createdAt),\n  index(\"idx_nft_mint_status_created\").on(table.status, table.createdAt),\n  index(\"idx_nft_mint_owner\").on(table.ownerId),\n  index(\"idx_nft_mint_token\").on(table.tokenId),\n]);\n\nexport const onchainRoyalties = pgTable(\"onchain_royalties\", {\n  id: uuid(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  nftMintId: uuid(\"nft_mint_id\").references(() => nftMints.id, { onDelete: \"cascade\" }).notNull(),\n  creatorId: varchar(\"creator_id\").references(() => users.id, { onDelete: \"cascade\" }).notNull(),\n  salePrice: decimal(\"sale_price\", { precision: 18, scale: 8 }), // crypto\n  royaltyAmount: decimal(\"royalty_amount\", { precision: 18, scale: 8 }),\n  royaltyPercent: integer(\"royalty_percent\").notNull(),\n  blockchain: blockchainEnum(\"blockchain\").default(\"polygon\"),\n  txHash: varchar(\"tx_hash\").notNull(),\n  paidAt: timestamp(\"paid_at\").defaultNow(),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n}, (table) => [\n  index(\"idx_royalty_creator_created\").on(table.creatorId, table.createdAt),\n  index(\"idx_royalty_nft\").on(table.nftMintId),\n]);\n\n// Fan-to-Creator Microlending System\nexport const loanStatusEnum = pgEnum(\"loan_status\", [\"pending\", \"approved\", \"active\", \"repaid\", \"defaulted\", \"cancelled\"]);\nexport const repaymentStatusEnum = pgEnum(\"repayment_status\", [\"pending\", \"paid\", \"late\", \"missed\"]);\n\nexport const loanPrograms = pgTable(\"loan_programs\", {\n  id: uuid(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  name: varchar(\"name\").notNull(),\n  description: text(\"description\"),\n  minLoanAmount: integer(\"min_loan_amount\").notNull(), // cents\n  maxLoanAmount: integer(\"max_loan_amount\").notNull(), // cents\n  interestRatePercent: decimal(\"interest_rate_percent\", { precision: 5, scale: 2 }).notNull(),\n  termMonths: integer(\"term_months\").notNull(),\n  platformFeePercent: decimal(\"platform_fee_percent\", { precision: 5, scale: 2 }).default(\"5.00\"),\n  isActive: boolean(\"is_active\").default(true),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n});\n\nexport const loanApplications = pgTable(\"loan_applications\", {\n  id: uuid(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  creatorId: varchar(\"creator_id\").references(() => users.id, { onDelete: \"cascade\" }).notNull(),\n  programId: uuid(\"program_id\").references(() => loanPrograms.id, { onDelete: \"cascade\" }).notNull(),\n  requestedAmount: integer(\"requested_amount\").notNull(), // cents\n  purpose: text(\"purpose\").notNull(),\n  businessPlan: text(\"business_plan\"),\n  status: loanStatusEnum(\"status\").default(\"pending\"),\n  kycVerified: boolean(\"kyc_verified\").default(false),\n  creditScore: integer(\"credit_score\"), // internal FanzTrust score\n  reviewedBy: varchar(\"reviewed_by\").references(() => users.id),\n  reviewedAt: timestamp(\"reviewed_at\"),\n  reviewNotes: text(\"review_notes\"),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n}, (table) => [\n  index(\"idx_loan_app_creator_created\").on(table.creatorId, table.createdAt),\n  index(\"idx_loan_app_status_created\").on(table.status, table.createdAt),\n  index(\"idx_loan_app_program\").on(table.programId),\n]);\n\nexport const loanOffers = pgTable(\"loan_offers\", {\n  id: uuid(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  applicationId: uuid(\"application_id\").references(() => loanApplications.id, { onDelete: \"cascade\" }).notNull(),\n  lenderId: varchar(\"lender_id\").references(() => users.id, { onDelete: \"cascade\" }).notNull(), // fan providing the loan\n  creatorId: varchar(\"creator_id\").references(() => users.id, { onDelete: \"cascade\" }).notNull(),\n  offeredAmount: integer(\"offered_amount\").notNull(), // cents\n  interestRate: decimal(\"interest_rate\", { precision: 5, scale: 2 }).notNull(),\n  termMonths: integer(\"term_months\").notNull(),\n  status: varchar(\"status\").default(\"pending\"), // pending, accepted, rejected, expired\n  expiresAt: timestamp(\"expires_at\").notNull(),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n}, (table) => [\n  index(\"idx_loan_offer_app\").on(table.applicationId),\n  index(\"idx_loan_offer_lender_created\").on(table.lenderId, table.createdAt),\n  index(\"idx_loan_offer_creator_created\").on(table.creatorId, table.createdAt),\n  index(\"idx_loan_offer_status_created\").on(table.status, table.createdAt),\n]);\n\nexport const loanRepayments = pgTable(\"loan_repayments\", {\n  id: uuid(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  offerId: uuid(\"offer_id\").references(() => loanOffers.id, { onDelete: \"cascade\" }).notNull(),\n  creatorId: varchar(\"creator_id\").references(() => users.id, { onDelete: \"cascade\" }).notNull(),\n  lenderId: varchar(\"lender_id\").references(() => users.id, { onDelete: \"cascade\" }).notNull(),\n  installmentNumber: integer(\"installment_number\").notNull(),\n  dueDate: timestamp(\"due_date\").notNull(),\n  amountDue: integer(\"amount_due\").notNull(), // cents\n  amountPaid: integer(\"amount_paid\").default(0),\n  status: repaymentStatusEnum(\"status\").default(\"pending\"),\n  paidAt: timestamp(\"paid_at\"),\n  transactionId: uuid(\"transaction_id\").references(() => transactions.id),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n}, (table) => [\n  index(\"idx_repayment_offer\").on(table.offerId),\n  index(\"idx_repayment_creator_due\").on(table.creatorId, table.dueDate),\n  index(\"idx_repayment_status_due\").on(table.status, table.dueDate),\n  index(\"idx_repayment_lender_due\").on(table.lenderId, table.dueDate),\n]);\n\nexport const loanEscrowAccounts = pgTable(\"loan_escrow_accounts\", {\n  id: uuid(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  offerId: uuid(\"offer_id\").references(() => loanOffers.id, { onDelete: \"cascade\" }).notNull().unique(),\n  balanceCents: integer(\"balance_cents\").default(0),\n  released: boolean(\"released\").default(false),\n  releasedAt: timestamp(\"released_at\"),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n});\n\n// Enhanced Deepfake & AI Content Detection\nexport const scanStatusEnum = pgEnum(\"scan_status\", [\"queued\", \"processing\", \"completed\", \"failed\"]);\nexport const contentRiskEnum = pgEnum(\"content_risk\", [\"low\", \"medium\", \"high\", \"critical\"]);\n\nexport const aiScanJobs = pgTable(\"ai_scan_jobs\", {\n  id: uuid(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  mediaId: uuid(\"media_id\").references(() => mediaAssets.id, { onDelete: \"cascade\" }).notNull(),\n  scanType: varchar(\"scan_type\").notNull(), // \"deepfake\", \"nsfw\", \"prohibited\", \"all\"\n  status: scanStatusEnum(\"status\").default(\"queued\"),\n  provider: varchar(\"provider\"), // \"hive\", \"reality_defender\", \"aws_rekognition\"\n  jobId: varchar(\"job_id\"), // external provider job ID\n  priority: integer(\"priority\").default(0),\n  queuedAt: timestamp(\"queued_at\").defaultNow(),\n  startedAt: timestamp(\"started_at\"),\n  completedAt: timestamp(\"completed_at\"),\n}, (table) => [\n  index(\"idx_scan_media\").on(table.mediaId),\n  index(\"idx_scan_status_priority\").on(table.status, table.priority),\n  index(\"idx_scan_status_queued\").on(table.status, table.queuedAt),\n]);\n\nexport const aiScanResults = pgTable(\"ai_scan_results\", {\n  id: uuid(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  scanJobId: uuid(\"scan_job_id\").references(() => aiScanJobs.id, { onDelete: \"cascade\" }).notNull(),\n  mediaId: uuid(\"media_id\").references(() => mediaAssets.id, { onDelete: \"cascade\" }).notNull(),\n  \n  // Deepfake Detection\n  isDeepfake: boolean(\"is_deepfake\").default(false),\n  deepfakeConfidence: real(\"deepfake_confidence\"), // 0.0 to 1.0\n  deepfakeIndicators: jsonb(\"deepfake_indicators\"), // technical details\n  \n  // NSFW & Content Classification\n  nsfwLevel: nsfwLevelEnum(\"nsfw_level\"),\n  nsfwConfidence: real(\"nsfw_confidence\"),\n  contentLabels: jsonb(\"content_labels\"), // detected scenes/objects\n  \n  // Prohibited Content Detection\n  minorsDetected: boolean(\"minors_detected\").default(false),\n  minorsConfidence: real(\"minors_confidence\"),\n  violenceDetected: boolean(\"violence_detected\").default(false),\n  violenceConfidence: real(\"violence_confidence\"),\n  weaponsDetected: boolean(\"weapons_detected\").default(false),\n  drugsDetected: boolean(\"drugs_detected\").default(false),\n  \n  // Face Analysis\n  facesDetected: integer(\"faces_detected\").default(0),\n  faceData: jsonb(\"face_data\"), // detailed face analysis\n  \n  // Overall Risk Assessment\n  riskLevel: contentRiskEnum(\"risk_level\").default(\"low\"),\n  requiresHumanReview: boolean(\"requires_human_review\").default(false),\n  \n  // Raw Results\n  rawResults: jsonb(\"raw_results\"), // full API response\n  createdAt: timestamp(\"created_at\").defaultNow(),\n}, (table) => [\n  index(\"idx_scan_result_media\").on(table.mediaId),\n  index(\"idx_scan_result_risk_created\").on(table.riskLevel, table.createdAt),\n  index(\"idx_scan_result_review_created\").on(table.requiresHumanReview, table.createdAt),\n  index(\"idx_scan_result_job\").on(table.scanJobId),\n]);\n\nexport const contentFingerprints = pgTable(\"content_fingerprints\", {\n  id: uuid(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  mediaId: uuid(\"media_id\").references(() => mediaAssets.id, { onDelete: \"cascade\" }).notNull().unique(),\n  creatorId: varchar(\"creator_id\").references(() => users.id, { onDelete: \"cascade\" }).notNull(),\n  \n  // Perceptual Hashing\n  phashVideo: varchar(\"phash_video\"), // video perceptual hash\n  phashAudio: varchar(\"phash_audio\"), // audio fingerprint\n  phashFrames: jsonb(\"phash_frames\"), // key frame hashes\n  \n  // Forensic Watermarking\n  watermarkId: varchar(\"watermark_id\").notNull().unique(),\n  watermarkEmbedded: boolean(\"watermark_embedded\").default(false),\n  \n  // DMCA Protection\n  copyrightRegistered: boolean(\"copyright_registered\").default(false),\n  registrationNumber: varchar(\"registration_number\"),\n  \n  // Provenance Chain\n  originalUploadHash: varchar(\"original_upload_hash\").notNull(),\n  blockchainAnchor: varchar(\"blockchain_anchor\"), // IPFS or blockchain proof\n  \n  createdAt: timestamp(\"created_at\").defaultNow(),\n}, (table) => [\n  index(\"idx_fingerprint_creator_created\").on(table.creatorId, table.createdAt),\n  index(\"idx_fingerprint_watermark\").on(table.watermarkId),\n  index(\"idx_fingerprint_media\").on(table.mediaId),\n]);\n\n// Two-Factor Authentication\nexport const twoFactorAuth = pgTable(\"two_factor_auth\", {\n  id: uuid(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  userId: varchar(\"user_id\").references(() => users.id).notNull().unique(),\n  secret: text(\"secret\").notNull(),\n  isEnabled: boolean(\"is_enabled\").default(false),\n  backupCodes: jsonb(\"backup_codes\"), // encrypted array of backup codes\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\n// Push Notification Subscriptions\nexport const pushSubscriptions = pgTable(\"push_subscriptions\", {\n  id: uuid(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  userId: varchar(\"user_id\").references(() => users.id).notNull(),\n  endpoint: text(\"endpoint\").notNull(),\n  keys: jsonb(\"keys\").notNull(),\n  deviceInfo: jsonb(\"device_info\"),\n  isActive: boolean(\"is_active\").default(true),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n}, (table) => [\n  index(\"idx_push_user\").on(table.userId),\n]);\n\n// Phase 1 Relations\nexport const nftContractsRelations = relations(nftContracts, ({ one, many }) => ({\n  creator: one(users, { fields: [nftContracts.creatorId], references: [users.id] }),\n  mints: many(nftMints),\n}));\n\nexport const nftMintsRelations = relations(nftMints, ({ one, many }) => ({\n  contract: one(nftContracts, { fields: [nftMints.contractId], references: [nftContracts.id] }),\n  media: one(mediaAssets, { fields: [nftMints.mediaId], references: [mediaAssets.id] }),\n  creator: one(users, { fields: [nftMints.creatorId], references: [users.id] }),\n  owner: one(users, { fields: [nftMints.ownerId], references: [users.id] }),\n  royalties: many(onchainRoyalties),\n}));\n\nexport const onchainRoyaltiesRelations = relations(onchainRoyalties, ({ one }) => ({\n  nftMint: one(nftMints, { fields: [onchainRoyalties.nftMintId], references: [nftMints.id] }),\n  creator: one(users, { fields: [onchainRoyalties.creatorId], references: [users.id] }),\n}));\n\nexport const loanProgramsRelations = relations(loanPrograms, ({ many }) => ({\n  applications: many(loanApplications),\n}));\n\nexport const loanApplicationsRelations = relations(loanApplications, ({ one, many }) => ({\n  creator: one(users, { fields: [loanApplications.creatorId], references: [users.id] }),\n  program: one(loanPrograms, { fields: [loanApplications.programId], references: [loanPrograms.id] }),\n  reviewer: one(users, { fields: [loanApplications.reviewedBy], references: [users.id] }),\n  offers: many(loanOffers),\n}));\n\nexport const loanOffersRelations = relations(loanOffers, ({ one, many }) => ({\n  application: one(loanApplications, { fields: [loanOffers.applicationId], references: [loanApplications.id] }),\n  lender: one(users, { fields: [loanOffers.lenderId], references: [users.id] }),\n  creator: one(users, { fields: [loanOffers.creatorId], references: [users.id] }),\n  repayments: many(loanRepayments),\n  escrowAccount: one(loanEscrowAccounts),\n}));\n\nexport const loanRepaymentsRelations = relations(loanRepayments, ({ one }) => ({\n  offer: one(loanOffers, { fields: [loanRepayments.offerId], references: [loanOffers.id] }),\n  creator: one(users, { fields: [loanRepayments.creatorId], references: [users.id] }),\n  lender: one(users, { fields: [loanRepayments.lenderId], references: [users.id] }),\n  transaction: one(transactions, { fields: [loanRepayments.transactionId], references: [transactions.id] }),\n}));\n\nexport const loanEscrowAccountsRelations = relations(loanEscrowAccounts, ({ one }) => ({\n  offer: one(loanOffers, { fields: [loanEscrowAccounts.offerId], references: [loanOffers.id] }),\n}));\n\nexport const aiScanJobsRelations = relations(aiScanJobs, ({ one, many }) => ({\n  media: one(mediaAssets, { fields: [aiScanJobs.mediaId], references: [mediaAssets.id] }),\n  results: many(aiScanResults),\n}));\n\nexport const aiScanResultsRelations = relations(aiScanResults, ({ one }) => ({\n  scanJob: one(aiScanJobs, { fields: [aiScanResults.scanJobId], references: [aiScanJobs.id] }),\n  media: one(mediaAssets, { fields: [aiScanResults.mediaId], references: [mediaAssets.id] }),\n}));\n\nexport const contentFingerprintsRelations = relations(contentFingerprints, ({ one }) => ({\n  media: one(mediaAssets, { fields: [contentFingerprints.mediaId], references: [mediaAssets.id] }),\n  creator: one(users, { fields: [contentFingerprints.creatorId], references: [users.id] }),\n}));\n\n// Insert schemas\nexport const insertCollaborationSchema = createInsertSchema(collaborations).omit({\n  id: true,\n  invitedAt: true,\n  createdAt: true,\n});\n\nexport const insertSubscriptionTierSchema = createInsertSchema(subscriptionTiers).omit({\n  id: true,\n  createdAt: true,\n});\n\nexport const insertContentBundleSchema = createInsertSchema(contentBundles).omit({\n  id: true,\n  purchaseCount: true,\n  createdAt: true,\n});\n\nexport const insertVirtualGiftSchema = createInsertSchema(virtualGifts).omit({\n  id: true,\n  createdAt: true,\n});\n\nexport const insertGiftSentSchema = createInsertSchema(giftsSent).omit({\n  id: true,\n  createdAt: true,\n});\n\nexport const insertScheduledPostSchema = createInsertSchema(scheduledPosts).omit({\n  id: true,\n  isPublished: true,\n  createdAt: true,\n});\n\nexport const insertCreatorBadgeSchema = createInsertSchema(creatorBadges).omit({\n  id: true,\n  createdAt: true,\n});\n\nexport const insertGeoBlockingRuleSchema = createInsertSchema(geoBlockingRules).omit({\n  id: true,\n  createdAt: true,\n});\n\nexport const insertDmcaClaimSchema = createInsertSchema(dmcaClaims).omit({\n  id: true,\n  createdAt: true,\n});\n\nexport const insertOnboardingProgressSchema = createInsertSchema(onboardingProgress).omit({\n  id: true,\n  createdAt: true,\n  updatedAt: true,\n});\n\nexport const insertContentNicheSchema = createInsertSchema(contentNiches).omit({\n  id: true,\n  createdAt: true,\n});\n\nexport const insertUserInterestSchema = createInsertSchema(userInterests).omit({\n  id: true,\n  createdAt: true,\n});\n\n// Phase 1 Insert Schemas\nexport const insertNftContractSchema = createInsertSchema(nftContracts).omit({\n  id: true,\n  createdAt: true,\n});\n\nexport const insertNftMintSchema = createInsertSchema(nftMints).omit({\n  id: true,\n  createdAt: true,\n});\n\nexport const insertOnchainRoyaltySchema = createInsertSchema(onchainRoyalties).omit({\n  id: true,\n  paidAt: true,\n  createdAt: true,\n});\n\nexport const insertLoanProgramSchema = createInsertSchema(loanPrograms).omit({\n  id: true,\n  createdAt: true,\n});\n\nexport const insertLoanApplicationSchema = createInsertSchema(loanApplications).omit({\n  id: true,\n  createdAt: true,\n});\n\nexport const insertLoanOfferSchema = createInsertSchema(loanOffers).omit({\n  id: true,\n  createdAt: true,\n});\n\nexport const insertLoanRepaymentSchema = createInsertSchema(loanRepayments).omit({\n  id: true,\n  createdAt: true,\n});\n\nexport const insertLoanEscrowAccountSchema = createInsertSchema(loanEscrowAccounts).omit({\n  id: true,\n  createdAt: true,\n});\n\nexport const insertAiScanJobSchema = createInsertSchema(aiScanJobs).omit({\n  id: true,\n  queuedAt: true,\n});\n\nexport const insertAiScanResultSchema = createInsertSchema(aiScanResults).omit({\n  id: true,\n  createdAt: true,\n});\n\nexport const insertContentFingerprintSchema = createInsertSchema(contentFingerprints).omit({\n  id: true,\n  createdAt: true,\n});\n\n// Types for new tables\nexport type Ticket = typeof tickets.$inferSelect;\nexport type InsertTicket = z.infer<typeof insertTicketSchema>;\nexport type TicketResponse = typeof ticketResponses.$inferSelect;\nexport type InsertTicketResponse = z.infer<typeof insertTicketResponseSchema>;\nexport type WikiArticle = typeof wikiArticles.$inferSelect;\nexport type InsertWikiArticle = z.infer<typeof insertWikiArticleSchema>;\nexport type Tutorial = typeof tutorials.$inferSelect;\nexport type InsertTutorial = z.infer<typeof insertTutorialSchema>;\nexport type TutorialStep = typeof tutorialSteps.$inferSelect;\nexport type InsertTutorialStep = z.infer<typeof insertTutorialStepSchema>;\nexport type TutorialProgress = typeof tutorialProgress.$inferSelect;\nexport type FaqEntry = typeof faqEntries.$inferSelect;\nexport type InsertFaqEntry = z.infer<typeof insertFaqEntrySchema>;\nexport type Post = typeof posts.$inferSelect;\nexport type InsertPost = z.infer<typeof insertPostSchema>;\nexport type PostLike = typeof postLikes.$inferSelect;\nexport type InsertPostLike = z.infer<typeof insertPostLikeSchema>;\nexport type PostComment = typeof postComments.$inferSelect;\nexport type InsertPostComment = z.infer<typeof insertPostCommentSchema>;\nexport type Follow = typeof follows.$inferSelect;\nexport type InsertFollow = z.infer<typeof insertFollowSchema>;\nexport type StoryMoment = typeof storyMoments.$inferSelect;\nexport type InsertStoryMoment = z.infer<typeof insertStoryMomentSchema>;\nexport type StoryView = typeof storyViews.$inferSelect;\nexport type InsertStoryView = z.infer<typeof insertStoryViewSchema>;\nexport type FanLevel = typeof fanLevels.$inferSelect;\nexport type InsertFanLevel = z.infer<typeof insertFanLevelSchema>;\nexport type CreatorAnalytics = typeof creatorAnalytics.$inferSelect;\nexport type InsertCreatorAnalytics = z.infer<typeof insertCreatorAnalyticsSchema>;\nexport type LiveStream = typeof liveStreams.$inferSelect;\nexport type InsertLiveStream = z.infer<typeof insertLiveStreamSchema>;\nexport type StreamViewer = typeof streamViewers.$inferSelect;\nexport type InsertStreamViewer = z.infer<typeof insertStreamViewerSchema>;\nexport type StreamChat = typeof streamChat.$inferSelect;\nexport type InsertStreamChat = z.infer<typeof insertStreamChatSchema>;\nexport type StreamTip = typeof streamTips.$inferSelect;\nexport type InsertStreamTip = z.infer<typeof insertStreamTipSchema>;\nexport type Collaboration = typeof collaborations.$inferSelect;\nexport type InsertCollaboration = z.infer<typeof insertCollaborationSchema>;\nexport type SubscriptionTier = typeof subscriptionTiers.$inferSelect;\nexport type InsertSubscriptionTier = z.infer<typeof insertSubscriptionTierSchema>;\nexport type ContentBundle = typeof contentBundles.$inferSelect;\nexport type InsertContentBundle = z.infer<typeof insertContentBundleSchema>;\nexport type VirtualGift = typeof virtualGifts.$inferSelect;\nexport type InsertVirtualGift = z.infer<typeof insertVirtualGiftSchema>;\nexport type GiftSent = typeof giftsSent.$inferSelect;\nexport type InsertGiftSent = z.infer<typeof insertGiftSentSchema>;\nexport type ScheduledPost = typeof scheduledPosts.$inferSelect;\nexport type InsertScheduledPost = z.infer<typeof insertScheduledPostSchema>;\nexport type CreatorBadge = typeof creatorBadges.$inferSelect;\nexport type InsertCreatorBadge = z.infer<typeof insertCreatorBadgeSchema>;\nexport type GeoBlockingRule = typeof geoBlockingRules.$inferSelect;\nexport type InsertGeoBlockingRule = z.infer<typeof insertGeoBlockingRuleSchema>;\nexport type DmcaClaim = typeof dmcaClaims.$inferSelect;\nexport type InsertDmcaClaim = z.infer<typeof insertDmcaClaimSchema>;\nexport type Leaderboard = typeof leaderboards.$inferSelect;\nexport type ReferralCode = typeof referralCodes.$inferSelect;\nexport type Referral = typeof referrals.$inferSelect;\nexport type OnboardingProgress = typeof onboardingProgress.$inferSelect;\nexport type InsertOnboardingProgress = z.infer<typeof insertOnboardingProgressSchema>;\nexport type ContentNiche = typeof contentNiches.$inferSelect;\nexport type InsertContentNiche = z.infer<typeof insertContentNicheSchema>;\nexport type UserInterest = typeof userInterests.$inferSelect;\nexport type InsertUserInterest = z.infer<typeof insertUserInterestSchema>;\n\n// Phase 1 Types\nexport type NftContract = typeof nftContracts.$inferSelect;\nexport type InsertNftContract = z.infer<typeof insertNftContractSchema>;\nexport type NftMint = typeof nftMints.$inferSelect;\nexport type InsertNftMint = z.infer<typeof insertNftMintSchema>;\nexport type OnchainRoyalty = typeof onchainRoyalties.$inferSelect;\nexport type InsertOnchainRoyalty = z.infer<typeof insertOnchainRoyaltySchema>;\nexport type LoanProgram = typeof loanPrograms.$inferSelect;\nexport type InsertLoanProgram = z.infer<typeof insertLoanProgramSchema>;\nexport type LoanApplication = typeof loanApplications.$inferSelect;\nexport type InsertLoanApplication = z.infer<typeof insertLoanApplicationSchema>;\nexport type LoanOffer = typeof loanOffers.$inferSelect;\nexport type InsertLoanOffer = z.infer<typeof insertLoanOfferSchema>;\nexport type LoanRepayment = typeof loanRepayments.$inferSelect;\nexport type InsertLoanRepayment = z.infer<typeof insertLoanRepaymentSchema>;\nexport type LoanEscrowAccount = typeof loanEscrowAccounts.$inferSelect;\nexport type InsertLoanEscrowAccount = z.infer<typeof insertLoanEscrowAccountSchema>;\nexport type AiScanJob = typeof aiScanJobs.$inferSelect;\nexport type InsertAiScanJob = z.infer<typeof insertAiScanJobSchema>;\nexport type AiScanResult = typeof aiScanResults.$inferSelect;\nexport type InsertAiScanResult = z.infer<typeof insertAiScanResultSchema>;\nexport type ContentFingerprint = typeof contentFingerprints.$inferSelect;\nexport type InsertContentFingerprint = z.infer<typeof insertContentFingerprintSchema>;\n","size_bytes":85391},"client/src/components/ui/drawer.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport { Drawer as DrawerPrimitive } from \"vaul\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Drawer = ({\n  shouldScaleBackground = true,\n  ...props\n}: React.ComponentProps<typeof DrawerPrimitive.Root>) => (\n  <DrawerPrimitive.Root\n    shouldScaleBackground={shouldScaleBackground}\n    {...props}\n  />\n)\nDrawer.displayName = \"Drawer\"\n\nconst DrawerTrigger = DrawerPrimitive.Trigger\n\nconst DrawerPortal = DrawerPrimitive.Portal\n\nconst DrawerClose = DrawerPrimitive.Close\n\nconst DrawerOverlay = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Overlay\n    ref={ref}\n    className={cn(\"fixed inset-0 z-50 bg-black/80\", className)}\n    {...props}\n  />\n))\nDrawerOverlay.displayName = DrawerPrimitive.Overlay.displayName\n\nconst DrawerContent = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <DrawerPortal>\n    <DrawerOverlay />\n    <DrawerPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed inset-x-0 bottom-0 z-50 mt-24 flex h-auto flex-col rounded-t-[10px] border bg-background\",\n        className\n      )}\n      {...props}\n    >\n      <div className=\"mx-auto mt-4 h-2 w-[100px] rounded-full bg-muted\" />\n      {children}\n    </DrawerPrimitive.Content>\n  </DrawerPortal>\n))\nDrawerContent.displayName = \"DrawerContent\"\n\nconst DrawerHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\"grid gap-1.5 p-4 text-center sm:text-left\", className)}\n    {...props}\n  />\n)\nDrawerHeader.displayName = \"DrawerHeader\"\n\nconst DrawerFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\"mt-auto flex flex-col gap-2 p-4\", className)}\n    {...props}\n  />\n)\nDrawerFooter.displayName = \"DrawerFooter\"\n\nconst DrawerTitle = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Title\n    ref={ref}\n    className={cn(\n      \"text-lg font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nDrawerTitle.displayName = DrawerPrimitive.Title.displayName\n\nconst DrawerDescription = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nDrawerDescription.displayName = DrawerPrimitive.Description.displayName\n\nexport {\n  Drawer,\n  DrawerPortal,\n  DrawerOverlay,\n  DrawerTrigger,\n  DrawerClose,\n  DrawerContent,\n  DrawerHeader,\n  DrawerFooter,\n  DrawerTitle,\n  DrawerDescription,\n}\n","size_bytes":3021},"client/src/pages/Tutorials.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Input } from \"@/components/ui/input\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { Progress } from \"@/components/ui/progress\";\nimport { Collapsible, CollapsibleContent, CollapsibleTrigger } from \"@/components/ui/collapsible\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { \n  GraduationCap,\n  Search,\n  Play,\n  CheckCircle2,\n  Clock,\n  Star,\n  Users,\n  DollarSign,\n  Camera,\n  Shield,\n  Lightbulb,\n  ChevronRight,\n  ChevronDown,\n  BookOpen,\n  Video,\n  FileText,\n  Trophy,\n  Target,\n  TrendingUp\n} from \"lucide-react\";\n\ninterface TutorialStep {\n  id: string;\n  title: string;\n  description: string;\n  completed: boolean;\n  estimatedTime: number; // in minutes\n}\n\ninterface Tutorial {\n  id: string;\n  title: string;\n  description: string;\n  category: string;\n  difficulty: \"beginner\" | \"intermediate\" | \"advanced\";\n  estimatedTime: number;\n  completionRate: number;\n  rating: number;\n  enrolledUsers: number;\n  steps: TutorialStep[];\n  thumbnail?: string;\n}\n\nconst tutorialCategories = [\n  { id: \"all\", label: \"All Tutorials\", icon: GraduationCap },\n  { id: \"getting_started\", label: \"Getting Started\", icon: BookOpen },\n  { id: \"content_creation\", label: \"Content Creation\", icon: Camera },\n  { id: \"monetization\", label: \"Monetization\", icon: DollarSign },\n  { id: \"marketing\", label: \"Marketing & Growth\", icon: TrendingUp },\n  { id: \"security\", label: \"Security & Compliance\", icon: Shield },\n  { id: \"advanced\", label: \"Advanced Features\", icon: Lightbulb }\n];\n\nconst difficultyColors = {\n  beginner: \"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-300\",\n  intermediate: \"bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-300\",\n  advanced: \"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-300\"\n};\n\n// Sample tutorial data - in real app this would come from API\nconst sampleTutorials: Tutorial[] = [\n  {\n    id: \"1\",\n    title: \"Getting Started as a Creator\",\n    description: \"Complete guide to setting up your creator profile, verification, and first content upload.\",\n    category: \"getting_started\",\n    difficulty: \"beginner\",\n    estimatedTime: 30,\n    completionRate: 85,\n    rating: 4.8,\n    enrolledUsers: 1250,\n    steps: [\n      { id: \"1-1\", title: \"Create Your Profile\", description: \"Set up your creator profile with photos and bio\", completed: false, estimatedTime: 10 },\n      { id: \"1-2\", title: \"Verify Your Identity\", description: \"Complete KYC verification process\", completed: false, estimatedTime: 15 },\n      { id: \"1-3\", title: \"Upload Your First Content\", description: \"Learn how to upload and optimize content\", completed: false, estimatedTime: 5 }\n    ]\n  },\n  {\n    id: \"2\",\n    title: \"Content Creation Best Practices\",\n    description: \"Professional tips for creating engaging content that converts subscribers.\",\n    category: \"content_creation\",\n    difficulty: \"intermediate\",\n    estimatedTime: 45,\n    completionRate: 78,\n    rating: 4.6,\n    enrolledUsers: 890,\n    steps: [\n      { id: \"2-1\", title: \"Planning Your Content\", description: \"Develop a content strategy and calendar\", completed: false, estimatedTime: 15 },\n      { id: \"2-2\", title: \"Photography & Video Tips\", description: \"Technical aspects of creating quality content\", completed: false, estimatedTime: 20 },\n      { id: \"2-3\", title: \"Content Optimization\", description: \"SEO and engagement optimization techniques\", completed: false, estimatedTime: 10 }\n    ]\n  },\n  {\n    id: \"3\",\n    title: \"Maximizing Your Earnings\",\n    description: \"Advanced strategies for pricing, subscriptions, and revenue optimization.\",\n    category: \"monetization\",\n    difficulty: \"advanced\",\n    estimatedTime: 60,\n    completionRate: 65,\n    rating: 4.9,\n    enrolledUsers: 560,\n    steps: [\n      { id: \"3-1\", title: \"Subscription Pricing Strategy\", description: \"How to price your content for maximum revenue\", completed: false, estimatedTime: 20 },\n      { id: \"3-2\", title: \"Pay-Per-View Content\", description: \"Creating and pricing premium content\", completed: false, estimatedTime: 15 },\n      { id: \"3-3\", title: \"Fan Engagement & Retention\", description: \"Building loyal subscriber base\", completed: false, estimatedTime: 25 }\n    ]\n  },\n  {\n    id: \"4\",\n    title: \"Marketing Your Profile\",\n    description: \"Proven strategies to grow your audience and increase visibility.\",\n    category: \"marketing\",\n    difficulty: \"intermediate\",\n    estimatedTime: 40,\n    completionRate: 72,\n    rating: 4.5,\n    enrolledUsers: 720,\n    steps: [\n      { id: \"4-1\", title: \"Social Media Cross-Promotion\", description: \"Leverage other platforms to grow\", completed: false, estimatedTime: 15 },\n      { id: \"4-2\", title: \"SEO for Adult Content\", description: \"Optimize your profile for discovery\", completed: false, estimatedTime: 15 },\n      { id: \"4-3\", title: \"Collaboration Strategies\", description: \"Network with other creators\", completed: false, estimatedTime: 10 }\n    ]\n  },\n  {\n    id: \"5\",\n    title: \"Security & Privacy Guide\",\n    description: \"Essential security practices to protect yourself and your content.\",\n    category: \"security\",\n    difficulty: \"beginner\",\n    estimatedTime: 25,\n    completionRate: 92,\n    rating: 4.7,\n    enrolledUsers: 1100,\n    steps: [\n      { id: \"5-1\", title: \"Account Security Setup\", description: \"Two-factor authentication and strong passwords\", completed: false, estimatedTime: 10 },\n      { id: \"5-2\", title: \"Content Protection\", description: \"Watermarking and content theft prevention\", completed: false, estimatedTime: 10 },\n      { id: \"5-3\", title: \"Privacy Best Practices\", description: \"Protecting your personal information\", completed: false, estimatedTime: 5 }\n    ]\n  }\n];\n\nexport default function Tutorials() {\n  const [selectedCategory, setSelectedCategory] = useState(\"all\");\n  const [searchQuery, setSearchQuery] = useState(\"\");\n  const [selectedTutorial, setSelectedTutorial] = useState<Tutorial | null>(null);\n  const [expandedTutorials, setExpandedTutorials] = useState<Set<string>>(new Set());\n\n  const filteredTutorials = sampleTutorials.filter(tutorial => {\n    const matchesCategory = selectedCategory === \"all\" || tutorial.category === selectedCategory;\n    const matchesSearch = tutorial.title.toLowerCase().includes(searchQuery.toLowerCase()) ||\n                         tutorial.description.toLowerCase().includes(searchQuery.toLowerCase());\n    return matchesCategory && matchesSearch;\n  });\n\n  const toggleTutorialExpansion = (tutorialId: string) => {\n    const newExpanded = new Set(expandedTutorials);\n    if (newExpanded.has(tutorialId)) {\n      newExpanded.delete(tutorialId);\n    } else {\n      newExpanded.add(tutorialId);\n    }\n    setExpandedTutorials(newExpanded);\n  };\n\n  const calculateProgress = (tutorial: Tutorial) => {\n    const completedSteps = tutorial.steps.filter(step => step.completed).length;\n    return (completedSteps / tutorial.steps.length) * 100;\n  };\n\n  return (\n    <div className=\"min-h-screen bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900\">\n      <div className=\"container mx-auto px-4 py-8 max-w-7xl\">\n        {/* Header */}\n        <div className=\"mb-8\">\n          <div className=\"flex items-center gap-3 mb-4\">\n            <div className=\"p-3 bg-gradient-to-r from-purple-500/20 to-pink-500/20 rounded-lg backdrop-blur-sm\">\n              <GraduationCap className=\"h-8 w-8 text-purple-400\" />\n            </div>\n            <div>\n              <h1 className=\"text-3xl font-bold text-white\">Creator Tutorials</h1>\n              <p className=\"text-slate-400\">Master the platform with our comprehensive guides</p>\n            </div>\n          </div>\n\n          {/* Search and Filter */}\n          <div className=\"flex flex-col lg:flex-row gap-4 items-start lg:items-center justify-between\">\n            <div className=\"flex-1 max-w-md\">\n              <div className=\"relative\">\n                <Search className=\"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-slate-400\" />\n                <Input\n                  placeholder=\"Search tutorials...\"\n                  value={searchQuery}\n                  onChange={(e) => setSearchQuery(e.target.value)}\n                  className=\"bg-slate-700 border-slate-600 text-white pl-10\"\n                  data-testid=\"input-search-tutorials\"\n                />\n              </div>\n            </div>\n\n            <div className=\"flex flex-wrap gap-2\">\n              {tutorialCategories.map((category) => {\n                const IconComponent = category.icon;\n                return (\n                  <Button\n                    key={category.id}\n                    variant={selectedCategory === category.id ? \"default\" : \"outline\"}\n                    size=\"sm\"\n                    onClick={() => setSelectedCategory(category.id)}\n                    className={`${\n                      selectedCategory === category.id\n                        ? \"bg-gradient-to-r from-purple-500 to-pink-500 text-white\"\n                        : \"border-slate-600 text-slate-300 hover:text-white hover:border-slate-500\"\n                    }`}\n                    data-testid={`button-category-${category.id}`}\n                  >\n                    <IconComponent className=\"h-4 w-4 mr-2\" />\n                    {category.label}\n                  </Button>\n                );\n              })}\n            </div>\n          </div>\n        </div>\n\n        <Tabs defaultValue=\"browse\" className=\"space-y-6\">\n          <TabsList className=\"grid w-full grid-cols-3 bg-slate-800 border-slate-700\">\n            <TabsTrigger \n              value=\"browse\" \n              className=\"data-[state=active]:bg-purple-500/20 data-[state=active]:text-purple-400\"\n            >\n              Browse Tutorials\n            </TabsTrigger>\n            <TabsTrigger \n              value=\"progress\" \n              className=\"data-[state=active]:bg-purple-500/20 data-[state=active]:text-purple-400\"\n            >\n              My Progress\n            </TabsTrigger>\n            <TabsTrigger \n              value=\"achievements\" \n              className=\"data-[state=active]:bg-purple-500/20 data-[state=active]:text-purple-400\"\n            >\n              Achievements\n            </TabsTrigger>\n          </TabsList>\n\n          <TabsContent value=\"browse\" className=\"space-y-6\">\n            {/* Featured Tutorial */}\n            <Card className=\"border-slate-700/50 bg-gradient-to-r from-purple-900/50 to-pink-900/50 backdrop-blur-sm\">\n              <CardContent className=\"p-6\">\n                <div className=\"flex items-center justify-between mb-4\">\n                  <Badge className=\"bg-yellow-500/20 text-yellow-400 border-yellow-400/20\">\n                    <Star className=\"h-3 w-3 mr-1\" />\n                    Featured\n                  </Badge>\n                  <Badge className={difficultyColors.beginner}>\n                    Beginner\n                  </Badge>\n                </div>\n                <h3 className=\"text-2xl font-bold text-white mb-2\">Getting Started as a Creator</h3>\n                <p className=\"text-slate-300 mb-4\">\n                  Everything you need to know to launch your creator journey successfully. From profile setup to your first earnings.\n                </p>\n                <div className=\"flex items-center gap-6 text-sm text-slate-400 mb-4\">\n                  <span className=\"flex items-center gap-1\">\n                    <Clock className=\"h-4 w-4\" />\n                    30 min\n                  </span>\n                  <span className=\"flex items-center gap-1\">\n                    <Users className=\"h-4 w-4\" />\n                    1,250 enrolled\n                  </span>\n                  <span className=\"flex items-center gap-1\">\n                    <Star className=\"h-4 w-4\" />\n                    4.8 rating\n                  </span>\n                </div>\n                <Button \n                  className=\"bg-gradient-to-r from-purple-500 to-pink-500 hover:from-purple-600 hover:to-pink-600\"\n                  data-testid=\"button-start-featured\"\n                >\n                  <Play className=\"h-4 w-4 mr-2\" />\n                  Start Tutorial\n                </Button>\n              </CardContent>\n            </Card>\n\n            {/* Tutorials Grid */}\n            <div className=\"space-y-4\">\n              {filteredTutorials.length === 0 ? (\n                <Card className=\"border-slate-700/50 bg-slate-800/50 backdrop-blur-sm text-center p-8\">\n                  <GraduationCap className=\"h-12 w-12 text-slate-500 mx-auto mb-4\" />\n                  <h3 className=\"text-lg font-semibold text-white mb-2\">No tutorials found</h3>\n                  <p className=\"text-slate-400\">\n                    Try adjusting your search or category filters.\n                  </p>\n                </Card>\n              ) : (\n                <div className=\"space-y-4\">\n                  {filteredTutorials.map((tutorial) => {\n                    const isExpanded = expandedTutorials.has(tutorial.id);\n                    const progress = calculateProgress(tutorial);\n                    \n                    return (\n                      <Card \n                        key={tutorial.id} \n                        className=\"border-slate-700/50 bg-slate-800/50 backdrop-blur-sm hover:bg-slate-700/50 transition-colors\"\n                      >\n                        <Collapsible\n                          open={isExpanded}\n                          onOpenChange={() => toggleTutorialExpansion(tutorial.id)}\n                        >\n                          <CollapsibleTrigger asChild>\n                            <CardHeader className=\"cursor-pointer hover:bg-slate-700/30 rounded-t-lg\">\n                              <div className=\"flex items-start justify-between\">\n                                <div className=\"flex-1\">\n                                  <div className=\"flex items-center gap-2 mb-2\">\n                                    <CardTitle className=\"text-lg text-white\" data-testid={`text-tutorial-title-${tutorial.id}`}>\n                                      {tutorial.title}\n                                    </CardTitle>\n                                    {isExpanded ? (\n                                      <ChevronDown className=\"h-5 w-5 text-slate-400\" />\n                                    ) : (\n                                      <ChevronRight className=\"h-5 w-5 text-slate-400\" />\n                                    )}\n                                  </div>\n                                  <p className=\"text-slate-400 mb-3\" data-testid={`text-tutorial-description-${tutorial.id}`}>\n                                    {tutorial.description}\n                                  </p>\n                                  <div className=\"flex flex-wrap items-center gap-3 text-sm\">\n                                    <Badge className={difficultyColors[tutorial.difficulty]} data-testid={`badge-difficulty-${tutorial.id}`}>\n                                      {tutorial.difficulty}\n                                    </Badge>\n                                    <span className=\"text-slate-400 flex items-center gap-1\">\n                                      <Clock className=\"h-3 w-3\" />\n                                      {tutorial.estimatedTime} min\n                                    </span>\n                                    <span className=\"text-slate-400 flex items-center gap-1\">\n                                      <Users className=\"h-3 w-3\" />\n                                      {tutorial.enrolledUsers.toLocaleString()}\n                                    </span>\n                                    <span className=\"text-slate-400 flex items-center gap-1\">\n                                      <Star className=\"h-3 w-3\" />\n                                      {tutorial.rating}\n                                    </span>\n                                  </div>\n                                </div>\n                              </div>\n                              {progress > 0 && (\n                                <div className=\"mt-4\">\n                                  <div className=\"flex items-center justify-between text-sm mb-1\">\n                                    <span className=\"text-slate-400\">Progress</span>\n                                    <span className=\"text-slate-400\">{Math.round(progress)}%</span>\n                                  </div>\n                                  <Progress value={progress} className=\"h-2\" data-testid={`progress-${tutorial.id}`} />\n                                </div>\n                              )}\n                            </CardHeader>\n                          </CollapsibleTrigger>\n\n                          <CollapsibleContent>\n                            <CardContent className=\"pt-0\">\n                              <div className=\"space-y-3\">\n                                {tutorial.steps.map((step, index) => (\n                                  <div \n                                    key={step.id}\n                                    className=\"flex items-start gap-3 p-3 bg-slate-700/30 rounded-lg\"\n                                    data-testid={`step-${step.id}`}\n                                  >\n                                    <div className=\"flex-shrink-0 mt-1\">\n                                      {step.completed ? (\n                                        <CheckCircle2 className=\"h-5 w-5 text-green-400\" />\n                                      ) : (\n                                        <div className=\"h-5 w-5 rounded-full border-2 border-slate-500 flex items-center justify-center text-xs font-semibold text-slate-400\">\n                                          {index + 1}\n                                        </div>\n                                      )}\n                                    </div>\n                                    <div className=\"flex-1\">\n                                      <h4 className={`font-medium ${step.completed ? 'text-green-400' : 'text-white'}`}>\n                                        {step.title}\n                                      </h4>\n                                      <p className=\"text-slate-400 text-sm mt-1\">\n                                        {step.description}\n                                      </p>\n                                      <div className=\"flex items-center gap-4 mt-2 text-xs text-slate-500\">\n                                        <span className=\"flex items-center gap-1\">\n                                          <Clock className=\"h-3 w-3\" />\n                                          {step.estimatedTime} min\n                                        </span>\n                                        {step.completed && (\n                                          <Badge variant=\"outline\" className=\"text-green-400 border-green-400/50\">\n                                            Completed\n                                          </Badge>\n                                        )}\n                                      </div>\n                                    </div>\n                                  </div>\n                                ))}\n                              </div>\n                              \n                              <div className=\"flex gap-3 mt-6\">\n                                <Button \n                                  className=\"bg-gradient-to-r from-purple-500 to-pink-500 hover:from-purple-600 hover:to-pink-600\"\n                                  data-testid={`button-start-${tutorial.id}`}\n                                >\n                                  <Play className=\"h-4 w-4 mr-2\" />\n                                  {progress > 0 ? \"Continue\" : \"Start Tutorial\"}\n                                </Button>\n                                <Button \n                                  variant=\"outline\" \n                                  className=\"border-slate-600 text-slate-300 hover:text-white\"\n                                  data-testid={`button-bookmark-${tutorial.id}`}\n                                >\n                                  <BookOpen className=\"h-4 w-4 mr-2\" />\n                                  Bookmark\n                                </Button>\n                              </div>\n                            </CardContent>\n                          </CollapsibleContent>\n                        </Collapsible>\n                      </Card>\n                    );\n                  })}\n                </div>\n              )}\n            </div>\n          </TabsContent>\n\n          <TabsContent value=\"progress\" className=\"space-y-6\">\n            <div className=\"grid gap-6 md:grid-cols-2 lg:grid-cols-3\">\n              {/* Overall Progress */}\n              <Card className=\"border-slate-700/50 bg-slate-800/50 backdrop-blur-sm\">\n                <CardHeader>\n                  <CardTitle className=\"text-white flex items-center gap-2\">\n                    <Target className=\"h-5 w-5 text-purple-400\" />\n                    Overall Progress\n                  </CardTitle>\n                </CardHeader>\n                <CardContent>\n                  <div className=\"space-y-4\">\n                    <div>\n                      <div className=\"flex items-center justify-between text-sm mb-1\">\n                        <span className=\"text-slate-400\">Tutorials Completed</span>\n                        <span className=\"text-white font-semibold\">3 / 5</span>\n                      </div>\n                      <Progress value={60} className=\"h-2\" />\n                    </div>\n                    <div className=\"grid grid-cols-2 gap-4 text-center\">\n                      <div>\n                        <div className=\"text-2xl font-bold text-purple-400\">15h</div>\n                        <div className=\"text-sm text-slate-400\">Time Spent</div>\n                      </div>\n                      <div>\n                        <div className=\"text-2xl font-bold text-pink-400\">850</div>\n                        <div className=\"text-sm text-slate-400\">XP Earned</div>\n                      </div>\n                    </div>\n                  </div>\n                </CardContent>\n              </Card>\n\n              {/* Recent Activity */}\n              <Card className=\"border-slate-700/50 bg-slate-800/50 backdrop-blur-sm\">\n                <CardHeader>\n                  <CardTitle className=\"text-white flex items-center gap-2\">\n                    <TrendingUp className=\"h-5 w-5 text-cyan-400\" />\n                    Recent Activity\n                  </CardTitle>\n                </CardHeader>\n                <CardContent>\n                  <div className=\"space-y-3\">\n                    <div className=\"flex items-center gap-3\">\n                      <CheckCircle2 className=\"h-4 w-4 text-green-400\" />\n                      <div className=\"flex-1\">\n                        <div className=\"text-sm text-white\">Completed \"Account Security\"</div>\n                        <div className=\"text-xs text-slate-400\">2 hours ago</div>\n                      </div>\n                    </div>\n                    <div className=\"flex items-center gap-3\">\n                      <Play className=\"h-4 w-4 text-purple-400\" />\n                      <div className=\"flex-1\">\n                        <div className=\"text-sm text-white\">Started \"Content Creation\"</div>\n                        <div className=\"text-xs text-slate-400\">1 day ago</div>\n                      </div>\n                    </div>\n                    <div className=\"flex items-center gap-3\">\n                      <Trophy className=\"h-4 w-4 text-yellow-400\" />\n                      <div className=\"flex-1\">\n                        <div className=\"text-sm text-white\">Earned \"First Steps\" badge</div>\n                        <div className=\"text-xs text-slate-400\">3 days ago</div>\n                      </div>\n                    </div>\n                  </div>\n                </CardContent>\n              </Card>\n\n              {/* Learning Streak */}\n              <Card className=\"border-slate-700/50 bg-slate-800/50 backdrop-blur-sm\">\n                <CardHeader>\n                  <CardTitle className=\"text-white flex items-center gap-2\">\n                    <Trophy className=\"h-5 w-5 text-yellow-400\" />\n                    Learning Streak\n                  </CardTitle>\n                </CardHeader>\n                <CardContent>\n                  <div className=\"text-center\">\n                    <div className=\"text-3xl font-bold text-yellow-400 mb-2\">7</div>\n                    <div className=\"text-sm text-slate-400 mb-4\">Days in a row</div>\n                    <div className=\"text-xs text-slate-500\">\n                      Keep it up! Study for 3 more days to earn the \"Dedicated Learner\" badge.\n                    </div>\n                  </div>\n                </CardContent>\n              </Card>\n            </div>\n          </TabsContent>\n\n          <TabsContent value=\"achievements\" className=\"space-y-6\">\n            <div className=\"grid gap-4 md:grid-cols-2 lg:grid-cols-3\">\n              {/* Sample achievements */}\n              <Card className=\"border-slate-700/50 bg-slate-800/50 backdrop-blur-sm\">\n                <CardContent className=\"p-6 text-center\">\n                  <div className=\"h-16 w-16 bg-gradient-to-r from-green-400 to-emerald-400 rounded-full flex items-center justify-center mx-auto mb-4\">\n                    <CheckCircle2 className=\"h-8 w-8 text-white\" />\n                  </div>\n                  <h3 className=\"text-lg font-semibold text-white mb-2\">First Steps</h3>\n                  <p className=\"text-slate-400 text-sm mb-4\">Complete your first tutorial</p>\n                  <Badge className=\"bg-green-500/20 text-green-400 border-green-400/50\">\n                    Earned\n                  </Badge>\n                </CardContent>\n              </Card>\n\n              <Card className=\"border-slate-700/50 bg-slate-800/50 backdrop-blur-sm\">\n                <CardContent className=\"p-6 text-center\">\n                  <div className=\"h-16 w-16 bg-gradient-to-r from-purple-400 to-pink-400 rounded-full flex items-center justify-center mx-auto mb-4\">\n                    <GraduationCap className=\"h-8 w-8 text-white\" />\n                  </div>\n                  <h3 className=\"text-lg font-semibold text-white mb-2\">Quick Learner</h3>\n                  <p className=\"text-slate-400 text-sm mb-4\">Complete 5 tutorials in one week</p>\n                  <Badge className=\"bg-purple-500/20 text-purple-400 border-purple-400/50\">\n                    Earned\n                  </Badge>\n                </CardContent>\n              </Card>\n\n              <Card className=\"border-slate-700/50 bg-slate-800/50 backdrop-blur-sm opacity-60\">\n                <CardContent className=\"p-6 text-center\">\n                  <div className=\"h-16 w-16 bg-slate-600 rounded-full flex items-center justify-center mx-auto mb-4\">\n                    <Trophy className=\"h-8 w-8 text-slate-400\" />\n                  </div>\n                  <h3 className=\"text-lg font-semibold text-slate-400 mb-2\">Master Creator</h3>\n                  <p className=\"text-slate-500 text-sm mb-4\">Complete all tutorial categories</p>\n                  <Badge variant=\"outline\" className=\"border-slate-600 text-slate-500\">\n                    Locked\n                  </Badge>\n                </CardContent>\n              </Card>\n            </div>\n          </TabsContent>\n        </Tabs>\n      </div>\n    </div>\n  );\n}","size_bytes":27777},"client/src/components/ui/input.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Input = React.forwardRef<HTMLInputElement, React.ComponentProps<\"input\">>(\n  ({ className, type, ...props }, ref) => {\n    return (\n      <input\n        type={type}\n        className={cn(\n          \"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm\",\n          className\n        )}\n        ref={ref}\n        {...props}\n      />\n    )\n  }\n)\nInput.displayName = \"Input\"\n\nexport { Input }\n","size_bytes":791},"client/src/components/ui/chart.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as RechartsPrimitive from \"recharts\"\n\nimport { cn } from \"@/lib/utils\"\n\n// Format: { THEME_NAME: CSS_SELECTOR }\nconst THEMES = { light: \"\", dark: \".dark\" } as const\n\nexport type ChartConfig = {\n  [k in string]: {\n    label?: React.ReactNode\n    icon?: React.ComponentType\n  } & (\n    | { color?: string; theme?: never }\n    | { color?: never; theme: Record<keyof typeof THEMES, string> }\n  )\n}\n\ntype ChartContextProps = {\n  config: ChartConfig\n}\n\nconst ChartContext = React.createContext<ChartContextProps | null>(null)\n\nfunction useChart() {\n  const context = React.useContext(ChartContext)\n\n  if (!context) {\n    throw new Error(\"useChart must be used within a <ChartContainer />\")\n  }\n\n  return context\n}\n\nconst ChartContainer = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> & {\n    config: ChartConfig\n    children: React.ComponentProps<\n      typeof RechartsPrimitive.ResponsiveContainer\n    >[\"children\"]\n  }\n>(({ id, className, children, config, ...props }, ref) => {\n  const uniqueId = React.useId()\n  const chartId = `chart-${id || uniqueId.replace(/:/g, \"\")}`\n\n  return (\n    <ChartContext.Provider value={{ config }}>\n      <div\n        data-chart={chartId}\n        ref={ref}\n        className={cn(\n          \"flex aspect-video justify-center text-xs [&_.recharts-cartesian-axis-tick_text]:fill-muted-foreground [&_.recharts-cartesian-grid_line[stroke='#ccc']]:stroke-border/50 [&_.recharts-curve.recharts-tooltip-cursor]:stroke-border [&_.recharts-dot[stroke='#fff']]:stroke-transparent [&_.recharts-layer]:outline-none [&_.recharts-polar-grid_[stroke='#ccc']]:stroke-border [&_.recharts-radial-bar-background-sector]:fill-muted [&_.recharts-rectangle.recharts-tooltip-cursor]:fill-muted [&_.recharts-reference-line_[stroke='#ccc']]:stroke-border [&_.recharts-sector[stroke='#fff']]:stroke-transparent [&_.recharts-sector]:outline-none [&_.recharts-surface]:outline-none\",\n          className\n        )}\n        {...props}\n      >\n        <ChartStyle id={chartId} config={config} />\n        <RechartsPrimitive.ResponsiveContainer>\n          {children}\n        </RechartsPrimitive.ResponsiveContainer>\n      </div>\n    </ChartContext.Provider>\n  )\n})\nChartContainer.displayName = \"Chart\"\n\nconst ChartStyle = ({ id, config }: { id: string; config: ChartConfig }) => {\n  const colorConfig = Object.entries(config).filter(\n    ([, config]) => config.theme || config.color\n  )\n\n  if (!colorConfig.length) {\n    return null\n  }\n\n  return (\n    <style\n      dangerouslySetInnerHTML={{\n        __html: Object.entries(THEMES)\n          .map(\n            ([theme, prefix]) => `\n${prefix} [data-chart=${id}] {\n${colorConfig\n  .map(([key, itemConfig]) => {\n    const color =\n      itemConfig.theme?.[theme as keyof typeof itemConfig.theme] ||\n      itemConfig.color\n    return color ? `  --color-${key}: ${color};` : null\n  })\n  .join(\"\\n\")}\n}\n`\n          )\n          .join(\"\\n\"),\n      }}\n    />\n  )\n}\n\nconst ChartTooltip = RechartsPrimitive.Tooltip\n\nconst ChartTooltipContent = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<typeof RechartsPrimitive.Tooltip> &\n    React.ComponentProps<\"div\"> & {\n      hideLabel?: boolean\n      hideIndicator?: boolean\n      indicator?: \"line\" | \"dot\" | \"dashed\"\n      nameKey?: string\n      labelKey?: string\n    }\n>(\n  (\n    {\n      active,\n      payload,\n      className,\n      indicator = \"dot\",\n      hideLabel = false,\n      hideIndicator = false,\n      label,\n      labelFormatter,\n      labelClassName,\n      formatter,\n      color,\n      nameKey,\n      labelKey,\n    },\n    ref\n  ) => {\n    const { config } = useChart()\n\n    const tooltipLabel = React.useMemo(() => {\n      if (hideLabel || !payload?.length) {\n        return null\n      }\n\n      const [item] = payload\n      const key = `${labelKey || item?.dataKey || item?.name || \"value\"}`\n      const itemConfig = getPayloadConfigFromPayload(config, item, key)\n      const value =\n        !labelKey && typeof label === \"string\"\n          ? config[label as keyof typeof config]?.label || label\n          : itemConfig?.label\n\n      if (labelFormatter) {\n        return (\n          <div className={cn(\"font-medium\", labelClassName)}>\n            {labelFormatter(value, payload)}\n          </div>\n        )\n      }\n\n      if (!value) {\n        return null\n      }\n\n      return <div className={cn(\"font-medium\", labelClassName)}>{value}</div>\n    }, [\n      label,\n      labelFormatter,\n      payload,\n      hideLabel,\n      labelClassName,\n      config,\n      labelKey,\n    ])\n\n    if (!active || !payload?.length) {\n      return null\n    }\n\n    const nestLabel = payload.length === 1 && indicator !== \"dot\"\n\n    return (\n      <div\n        ref={ref}\n        className={cn(\n          \"grid min-w-[8rem] items-start gap-1.5 rounded-lg border border-border/50 bg-background px-2.5 py-1.5 text-xs shadow-xl\",\n          className\n        )}\n      >\n        {!nestLabel ? tooltipLabel : null}\n        <div className=\"grid gap-1.5\">\n          {payload.map((item, index) => {\n            const key = `${nameKey || item.name || item.dataKey || \"value\"}`\n            const itemConfig = getPayloadConfigFromPayload(config, item, key)\n            const indicatorColor = color || item.payload.fill || item.color\n\n            return (\n              <div\n                key={item.dataKey}\n                className={cn(\n                  \"flex w-full flex-wrap items-stretch gap-2 [&>svg]:h-2.5 [&>svg]:w-2.5 [&>svg]:text-muted-foreground\",\n                  indicator === \"dot\" && \"items-center\"\n                )}\n              >\n                {formatter && item?.value !== undefined && item.name ? (\n                  formatter(item.value, item.name, item, index, item.payload)\n                ) : (\n                  <>\n                    {itemConfig?.icon ? (\n                      <itemConfig.icon />\n                    ) : (\n                      !hideIndicator && (\n                        <div\n                          className={cn(\n                            \"shrink-0 rounded-[2px] border-[--color-border] bg-[--color-bg]\",\n                            {\n                              \"h-2.5 w-2.5\": indicator === \"dot\",\n                              \"w-1\": indicator === \"line\",\n                              \"w-0 border-[1.5px] border-dashed bg-transparent\":\n                                indicator === \"dashed\",\n                              \"my-0.5\": nestLabel && indicator === \"dashed\",\n                            }\n                          )}\n                          style={\n                            {\n                              \"--color-bg\": indicatorColor,\n                              \"--color-border\": indicatorColor,\n                            } as React.CSSProperties\n                          }\n                        />\n                      )\n                    )}\n                    <div\n                      className={cn(\n                        \"flex flex-1 justify-between leading-none\",\n                        nestLabel ? \"items-end\" : \"items-center\"\n                      )}\n                    >\n                      <div className=\"grid gap-1.5\">\n                        {nestLabel ? tooltipLabel : null}\n                        <span className=\"text-muted-foreground\">\n                          {itemConfig?.label || item.name}\n                        </span>\n                      </div>\n                      {item.value && (\n                        <span className=\"font-mono font-medium tabular-nums text-foreground\">\n                          {item.value.toLocaleString()}\n                        </span>\n                      )}\n                    </div>\n                  </>\n                )}\n              </div>\n            )\n          })}\n        </div>\n      </div>\n    )\n  }\n)\nChartTooltipContent.displayName = \"ChartTooltip\"\n\nconst ChartLegend = RechartsPrimitive.Legend\n\nconst ChartLegendContent = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> &\n    Pick<RechartsPrimitive.LegendProps, \"payload\" | \"verticalAlign\"> & {\n      hideIcon?: boolean\n      nameKey?: string\n    }\n>(\n  (\n    { className, hideIcon = false, payload, verticalAlign = \"bottom\", nameKey },\n    ref\n  ) => {\n    const { config } = useChart()\n\n    if (!payload?.length) {\n      return null\n    }\n\n    return (\n      <div\n        ref={ref}\n        className={cn(\n          \"flex items-center justify-center gap-4\",\n          verticalAlign === \"top\" ? \"pb-3\" : \"pt-3\",\n          className\n        )}\n      >\n        {payload.map((item) => {\n          const key = `${nameKey || item.dataKey || \"value\"}`\n          const itemConfig = getPayloadConfigFromPayload(config, item, key)\n\n          return (\n            <div\n              key={item.value}\n              className={cn(\n                \"flex items-center gap-1.5 [&>svg]:h-3 [&>svg]:w-3 [&>svg]:text-muted-foreground\"\n              )}\n            >\n              {itemConfig?.icon && !hideIcon ? (\n                <itemConfig.icon />\n              ) : (\n                <div\n                  className=\"h-2 w-2 shrink-0 rounded-[2px]\"\n                  style={{\n                    backgroundColor: item.color,\n                  }}\n                />\n              )}\n              {itemConfig?.label}\n            </div>\n          )\n        })}\n      </div>\n    )\n  }\n)\nChartLegendContent.displayName = \"ChartLegend\"\n\n// Helper to extract item config from a payload.\nfunction getPayloadConfigFromPayload(\n  config: ChartConfig,\n  payload: unknown,\n  key: string\n) {\n  if (typeof payload !== \"object\" || payload === null) {\n    return undefined\n  }\n\n  const payloadPayload =\n    \"payload\" in payload &&\n    typeof payload.payload === \"object\" &&\n    payload.payload !== null\n      ? payload.payload\n      : undefined\n\n  let configLabelKey: string = key\n\n  if (\n    key in payload &&\n    typeof payload[key as keyof typeof payload] === \"string\"\n  ) {\n    configLabelKey = payload[key as keyof typeof payload] as string\n  } else if (\n    payloadPayload &&\n    key in payloadPayload &&\n    typeof payloadPayload[key as keyof typeof payloadPayload] === \"string\"\n  ) {\n    configLabelKey = payloadPayload[\n      key as keyof typeof payloadPayload\n    ] as string\n  }\n\n  return configLabelKey in config\n    ? config[configLabelKey]\n    : config[key as keyof typeof config]\n}\n\nexport {\n  ChartContainer,\n  ChartTooltip,\n  ChartTooltipContent,\n  ChartLegend,\n  ChartLegendContent,\n  ChartStyle,\n}\n","size_bytes":10481},"client/src/main.tsx":{"content":"import { createRoot } from \"react-dom/client\";\nimport App from \"./App\";\nimport \"./index.css\";\n\ncreateRoot(document.getElementById(\"root\")!).render(<App />);\n","size_bytes":157},"client/src/pages/ContactPage.tsx":{"content":"import Header from \"@/components/layout/Header\";\nimport Footer from \"@/components/layout/Footer\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Mail, MessageSquare, Phone, MapPin, Clock } from \"lucide-react\";\nimport { useState } from \"react\";\nimport { useToast } from \"@/hooks/use-toast\";\n\nexport default function ContactPage() {\n  const { toast } = useToast();\n  const [isSubmitting, setIsSubmitting] = useState(false);\n\n  const handleSubmit = async (e: React.FormEvent<HTMLFormElement>) => {\n    e.preventDefault();\n    setIsSubmitting(true);\n    \n    // Simulate form submission\n    await new Promise(resolve => setTimeout(resolve, 1000));\n    \n    toast({\n      title: \"Message Sent\",\n      description: \"We've received your message and will respond within 24 hours.\",\n    });\n    \n    setIsSubmitting(false);\n    (e.target as HTMLFormElement).reset();\n  };\n\n  return (\n    <div className=\"min-h-screen bg-df-obsidian\">\n      <Header />\n      <div className=\"max-w-6xl mx-auto px-4 py-16\">\n        <div className=\"text-center mb-12\">\n          <h1 className=\"text-4xl neon-heading mb-4\">Contact Us</h1>\n          <p className=\"text-df-fog text-lg\">Get in touch with our support team</p>\n        </div>\n\n        <div className=\"grid md:grid-cols-3 gap-6 mb-12\">\n          <Card className=\"bg-df-brick border-df-steel\" data-testid=\"card-contact-email\">\n            <CardHeader>\n              <div className=\"w-12 h-12 bg-df-obsidian rounded-full flex items-center justify-center mb-4\">\n                <Mail className=\"w-6 h-6 text-df-cyan\" />\n              </div>\n              <CardTitle className=\"text-df-snow\">Email Support</CardTitle>\n              <CardDescription className=\"text-df-fog\">We'll respond within 24 hours</CardDescription>\n            </CardHeader>\n            <CardContent>\n              <a href=\"mailto:support@daddiesfanz.com\" className=\"text-df-cyan hover:underline\" data-testid=\"link-support-email\">\n                support@daddiesfanz.com\n              </a>\n            </CardContent>\n          </Card>\n\n          <Card className=\"bg-df-brick border-df-steel\" data-testid=\"card-contact-hours\">\n            <CardHeader>\n              <div className=\"w-12 h-12 bg-df-obsidian rounded-full flex items-center justify-center mb-4\">\n                <Clock className=\"w-6 h-6 text-df-gold\" />\n              </div>\n              <CardTitle className=\"text-df-snow\">Business Hours</CardTitle>\n              <CardDescription className=\"text-df-fog\">Available to assist you</CardDescription>\n            </CardHeader>\n            <CardContent>\n              <p className=\"text-df-fog text-sm\">Mon-Fri: 9AM - 6PM EST</p>\n              <p className=\"text-df-fog text-sm\">Sat-Sun: 10AM - 4PM EST</p>\n            </CardContent>\n          </Card>\n\n          <Card className=\"bg-df-brick border-df-steel\" data-testid=\"card-contact-live-chat\">\n            <CardHeader>\n              <div className=\"w-12 h-12 bg-df-obsidian rounded-full flex items-center justify-center mb-4\">\n                <MessageSquare className=\"w-6 h-6 text-df-cyan\" />\n              </div>\n              <CardTitle className=\"text-df-snow\">Live Chat</CardTitle>\n              <CardDescription className=\"text-df-fog\">Chat with our team</CardDescription>\n            </CardHeader>\n            <CardContent>\n              <Button className=\"w-full bg-df-cyan hover:bg-df-cyan/90 text-df-obsidian\" data-testid=\"button-start-chat\">\n                Start Chat\n              </Button>\n            </CardContent>\n          </Card>\n        </div>\n\n        <Card className=\"bg-df-brick border-df-steel\">\n          <CardHeader>\n            <CardTitle className=\"text-2xl text-df-snow\">Send Us a Message</CardTitle>\n            <CardDescription className=\"text-df-fog\">\n              Fill out the form below and we'll get back to you as soon as possible\n            </CardDescription>\n          </CardHeader>\n          <CardContent>\n            <form onSubmit={handleSubmit} className=\"space-y-6\">\n              <div className=\"grid md:grid-cols-2 gap-6\">\n                <div className=\"space-y-2\">\n                  <Label htmlFor=\"name\" className=\"text-df-snow\">Name</Label>\n                  <Input\n                    id=\"name\"\n                    placeholder=\"Your name\"\n                    required\n                    className=\"bg-df-obsidian border-df-steel text-df-snow\"\n                    data-testid=\"input-name\"\n                  />\n                </div>\n                <div className=\"space-y-2\">\n                  <Label htmlFor=\"email\" className=\"text-df-snow\">Email</Label>\n                  <Input\n                    id=\"email\"\n                    type=\"email\"\n                    placeholder=\"your@email.com\"\n                    required\n                    className=\"bg-df-obsidian border-df-steel text-df-snow\"\n                    data-testid=\"input-email\"\n                  />\n                </div>\n              </div>\n\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"subject\" className=\"text-df-snow\">Subject</Label>\n                <Select required>\n                  <SelectTrigger className=\"bg-df-obsidian border-df-steel text-df-snow\" data-testid=\"select-subject\">\n                    <SelectValue placeholder=\"Select a subject\" />\n                  </SelectTrigger>\n                  <SelectContent>\n                    <SelectItem value=\"general\">General Inquiry</SelectItem>\n                    <SelectItem value=\"technical\">Technical Support</SelectItem>\n                    <SelectItem value=\"billing\">Billing Question</SelectItem>\n                    <SelectItem value=\"creator\">Creator Support</SelectItem>\n                    <SelectItem value=\"verification\">Verification Issue</SelectItem>\n                    <SelectItem value=\"report\">Report Content</SelectItem>\n                  </SelectContent>\n                </Select>\n              </div>\n\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"message\" className=\"text-df-snow\">Message</Label>\n                <Textarea\n                  id=\"message\"\n                  placeholder=\"Tell us how we can help...\"\n                  rows={6}\n                  required\n                  className=\"bg-df-obsidian border-df-steel text-df-snow\"\n                  data-testid=\"input-message\"\n                />\n              </div>\n\n              <Button\n                type=\"submit\"\n                className=\"w-full bg-df-cyan hover:bg-df-cyan/90 text-df-obsidian font-semibold\"\n                disabled={isSubmitting}\n                data-testid=\"button-submit-contact\"\n              >\n                {isSubmitting ? \"Sending...\" : \"Send Message\"}\n              </Button>\n            </form>\n          </CardContent>\n        </Card>\n\n        <div className=\"mt-12 grid md:grid-cols-2 gap-6\">\n          <Card className=\"bg-df-brick border-df-steel\">\n            <CardHeader>\n              <CardTitle className=\"text-df-snow\">Creator Support</CardTitle>\n            </CardHeader>\n            <CardContent className=\"space-y-2\">\n              <p className=\"text-df-fog text-sm\">For creator-specific questions:</p>\n              <a href=\"mailto:creators@daddiesfanz.com\" className=\"text-df-cyan hover:underline block\" data-testid=\"link-creator-email\">\n                creators@daddiesfanz.com\n              </a>\n            </CardContent>\n          </Card>\n\n          <Card className=\"bg-df-brick border-df-steel\">\n            <CardHeader>\n              <CardTitle className=\"text-df-snow\">Legal & Compliance</CardTitle>\n            </CardHeader>\n            <CardContent className=\"space-y-2\">\n              <p className=\"text-df-fog text-sm\">For legal and compliance matters:</p>\n              <a href=\"mailto:legal@daddiesfanz.com\" className=\"text-df-cyan hover:underline block\" data-testid=\"link-legal-contact-email\">\n                legal@daddiesfanz.com\n              </a>\n            </CardContent>\n          </Card>\n        </div>\n      </div>\n      <Footer />\n    </div>\n  );\n}\n","size_bytes":8365},"client/src/App.tsx":{"content":"import { Switch, Route } from \"wouter\";\nimport { queryClient } from \"./lib/queryClient\";\nimport { QueryClientProvider } from \"@tanstack/react-query\";\nimport { Toaster } from \"@/components/ui/toaster\";\nimport { TooltipProvider } from \"@/components/ui/tooltip\";\nimport { useAuth } from \"@/hooks/useAuth\";\nimport { useCSRF } from \"@/hooks/useCSRF\";\nimport Landing from \"@/pages/Landing\";\nimport Dashboard from \"@/pages/Dashboard\";\nimport CreatorProfile from \"@/pages/CreatorProfile\";\nimport Messages from \"@/pages/Messages\";\nimport Settings from \"@/pages/Settings\";\nimport Verification from \"@/pages/Verification\";\nimport CreatorGuide from \"@/pages/CreatorGuide\";\nimport AIWiki from \"@/pages/AIWiki\";\nimport Tutorials from \"@/pages/Tutorials\";\nimport HelpDesk from \"@/pages/HelpDesk\";\nimport ContentUpload from \"@/pages/ContentUpload\";\nimport ContentManage from \"@/pages/ContentManage\";\nimport Feed from \"@/pages/Feed\";\nimport NotFound from \"@/pages/not-found\";\nimport OnboardingWelcome from \"@/pages/OnboardingWelcome\";\nimport OnboardingProfile from \"@/pages/OnboardingProfile\";\nimport OnboardingInterests from \"@/pages/OnboardingInterests\";\nimport OnboardingComplete from \"@/pages/OnboardingComplete\";\nimport ResetPassword from \"@/pages/ResetPassword\";\nimport NftDashboard from \"@/pages/NftDashboard\";\nimport NftMarketplace from \"@/pages/NftMarketplace\";\nimport CreatorLoanDashboard from \"@/pages/CreatorLoanDashboard\";\nimport FanLendingDashboard from \"@/pages/FanLendingDashboard\";\nimport LegalPage from \"@/pages/LegalPage\";\nimport ContactPage from \"@/pages/ContactPage\";\nimport PaymentHelpPage from \"@/pages/PaymentHelpPage\";\n\nfunction Router() {\n  const { isAuthenticated, isLoading } = useAuth();\n  useCSRF(); // Initialize CSRF token on app load\n\n  return (\n    <Switch>\n      {/* Public routes available to all users */}\n      <Route path=\"/reset-password\" component={ResetPassword} />\n      <Route path=\"/ai-wiki\" component={AIWiki} />\n      <Route path=\"/tutorials\" component={Tutorials} />\n      <Route path=\"/help-desk\" component={HelpDesk} />\n      <Route path=\"/help\" component={HelpDesk} />\n      <Route path=\"/feed\" component={Feed} />\n      \n      {/* Legal and Support Pages */}\n      <Route path=\"/legal/:page\" component={LegalPage} />\n      <Route path=\"/contact\" component={ContactPage} />\n      <Route path=\"/payment-help\" component={PaymentHelpPage} />\n      \n      {isLoading || !isAuthenticated ? (\n        <Route path=\"/\" component={Landing} />\n      ) : (\n        <>\n          {/* Onboarding routes */}\n          <Route path=\"/onboarding\" component={OnboardingWelcome} />\n          <Route path=\"/onboarding/profile\" component={OnboardingProfile} />\n          <Route path=\"/onboarding/interests\" component={OnboardingInterests} />\n          <Route path=\"/onboarding/complete\" component={OnboardingComplete} />\n          \n          {/* Main app routes */}\n          <Route path=\"/\" component={Dashboard} />\n          <Route path=\"/profile\" component={CreatorProfile} />\n          <Route path=\"/messages\" component={Messages} />\n          <Route path=\"/content-upload\" component={ContentUpload} />\n          <Route path=\"/content-manage\" component={ContentManage} />\n          <Route path=\"/nft-dashboard\" component={NftDashboard} />\n          <Route path=\"/nft-marketplace\" component={NftMarketplace} />\n          <Route path=\"/loans/creator\" component={CreatorLoanDashboard} />\n          <Route path=\"/loans/lend\" component={FanLendingDashboard} />\n          <Route path=\"/settings\" component={Settings} />\n          <Route path=\"/verification\" component={Verification} />\n          <Route path=\"/creator-guide\" component={CreatorGuide} />\n        </>\n      )}\n      <Route component={NotFound} />\n    </Switch>\n  );\n}\n\nfunction App() {\n  return (\n    <div className=\"dark\">\n      <QueryClientProvider client={queryClient}>\n        <TooltipProvider>\n          <Toaster />\n          <Router />\n        </TooltipProvider>\n      </QueryClientProvider>\n    </div>\n  );\n}\n\nexport default App;\n","size_bytes":4011},"client/src/pages/Messages.tsx":{"content":"import { useAuth } from \"@/hooks/useAuth\";\nimport { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { useRealTimeMessages } from \"@/hooks/useWebSocket\";\nimport { useState, useEffect, useRef } from \"react\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { isUnauthorizedError } from \"@/lib/authUtils\";\nimport Header from \"@/components/layout/Header\";\nimport Footer from \"@/components/layout/Footer\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { ScrollArea } from \"@/components/ui/scroll-area\";\nimport { Avatar, AvatarFallback } from \"@/components/ui/avatar\";\nimport { Send, MessageCircle, Search, Phone, Video } from \"lucide-react\";\n\ninterface Message {\n  id: string;\n  senderId: string;\n  recipientId: string;\n  content: string;\n  mediaUrl?: string;\n  isRead: boolean;\n  createdAt: string;\n}\n\ninterface Conversation {\n  userId: string;\n  displayName: string;\n  lastMessage?: string;\n  lastMessageTime?: string;\n  unreadCount: number;\n}\n\nexport default function Messages() {\n  const { user, isLoading, isAuthenticated } = useAuth();\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n  \n  const [selectedConversation, setSelectedConversation] = useState<string | null>(null);\n  const [messageInput, setMessageInput] = useState(\"\");\n  const [searchQuery, setSearchQuery] = useState(\"\");\n  const messagesEndRef = useRef<HTMLDivElement>(null);\n\n  // Real-time messaging\n  const {\n    isConnected,\n    connectionStatus,\n    sendChatMessage,\n    sendTypingIndicator,\n  } = useRealTimeMessages(user?.id);\n\n  // Redirect if not authenticated\n  useEffect(() => {\n    if (!isLoading && !isAuthenticated) {\n      toast({\n        title: \"Unauthorized\",\n        description: \"You are logged out. Logging in again...\",\n        variant: \"destructive\",\n      });\n      setTimeout(() => {\n        window.location.href = \"/api/login\";\n      }, 500);\n      return;\n    }\n  }, [isAuthenticated, isLoading, toast]);\n\n  // Mock conversations data for now\n  const conversations: Conversation[] = [\n    {\n      userId: \"user1\",\n      displayName: \"AlphaDom\",\n      lastMessage: \"Hey there, how's your day?\",\n      lastMessageTime: \"2 hours ago\",\n      unreadCount: 2,\n    },\n    {\n      userId: \"user2\", \n      displayName: \"MasterChief\",\n      lastMessage: \"Thanks for the great content!\",\n      lastMessageTime: \"1 day ago\",\n      unreadCount: 0,\n    },\n    {\n      userId: \"user3\",\n      displayName: \"PowerBottom\",\n      lastMessage: \"When will you upload new videos?\",\n      lastMessageTime: \"3 days ago\", \n      unreadCount: 1,\n    },\n  ];\n\n  // Fetch messages for selected conversation\n  const { data: messages, isLoading: messagesLoading } = useQuery({\n    queryKey: [\"/api/messages\", selectedConversation],\n    enabled: !!selectedConversation && isAuthenticated,\n    retry: false,\n  });\n\n  // Send message mutation\n  const sendMessageMutation = useMutation({\n    mutationFn: async (data: { recipientId: string; content: string }) => {\n      const response = await apiRequest(\"POST\", \"/api/messages\", data);\n      return response.json();\n    },\n    onSuccess: (newMessage) => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/messages\", selectedConversation] });\n      setMessageInput(\"\");\n      \n      // Also send via WebSocket for real-time delivery\n      if (selectedConversation) {\n        sendChatMessage(selectedConversation, newMessage.content);\n      }\n    },\n    onError: (error) => {\n      if (isUnauthorizedError(error as Error)) {\n        toast({\n          title: \"Unauthorized\",\n          description: \"You are logged out. Logging in again...\",\n          variant: \"destructive\",\n        });\n        setTimeout(() => {\n          window.location.href = \"/api/login\";\n        }, 500);\n        return;\n      }\n      toast({\n        title: \"Message Failed\",\n        description: \"Failed to send message. Please try again.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  // Auto-scroll to bottom of messages\n  useEffect(() => {\n    messagesEndRef.current?.scrollIntoView({ behavior: \"smooth\" });\n  }, [messages]);\n\n  const handleSendMessage = () => {\n    if (!messageInput.trim() || !selectedConversation) return;\n\n    sendMessageMutation.mutate({\n      recipientId: selectedConversation,\n      content: messageInput.trim(),\n    });\n  };\n\n  const handleKeyPress = (e: React.KeyboardEvent) => {\n    if (e.key === \"Enter\" && !e.shiftKey) {\n      e.preventDefault();\n      handleSendMessage();\n    }\n  };\n\n  const filteredConversations = conversations.filter(conv =>\n    conv.displayName.toLowerCase().includes(searchQuery.toLowerCase())\n  );\n\n  if (isLoading) {\n    return (\n      <div className=\"min-h-screen bg-df-dungeon flex items-center justify-center\">\n        <div className=\"text-df-cyan text-xl font-display\">Loading messages...</div>\n      </div>\n    );\n  }\n\n  if (!isAuthenticated || !user) {\n    return null;\n  }\n\n  return (\n    <div className=\"min-h-screen bg-df-dungeon\">\n      <Header />\n      \n      <main className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8\">\n        <div className=\"mb-8\">\n          <div className=\"flex items-center justify-between\">\n            <div>\n              <h1 className=\"text-3xl font-display font-bold text-df-snow mb-2\">\n                Messages\n              </h1>\n              <p className=\"text-df-fog\">Connect with your fans and fellow creators</p>\n            </div>\n            <div className=\"flex items-center gap-2\">\n              <div className={`w-3 h-3 rounded-full ${isConnected ? 'bg-green-400 pulse-glow' : 'bg-red-500'}`}></div>\n              <span className=\"text-df-fog text-sm\">\n                {connectionStatus === 'connected' ? 'Online' : 'Offline'}\n              </span>\n            </div>\n          </div>\n        </div>\n\n        <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-8 h-[calc(100vh-16rem)]\">\n          {/* Conversations List */}\n          <Card className=\"card-df lg:col-span-1\">\n            <CardHeader>\n              <CardTitle className=\"text-lg neon-subheading\">\n                <MessageCircle className=\"inline mr-2 h-5 w-5\" />\n                Conversations\n              </CardTitle>\n              <div className=\"relative\">\n                <Search className=\"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-df-fog\" />\n                <Input\n                  placeholder=\"Search conversations...\"\n                  value={searchQuery}\n                  onChange={(e) => setSearchQuery(e.target.value)}\n                  className=\"input-df pl-10\"\n                  data-testid=\"input-search-conversations\"\n                />\n              </div>\n            </CardHeader>\n            <CardContent className=\"p-0\">\n              <ScrollArea className=\"h-96\">\n                {filteredConversations.length > 0 ? (\n                  <div className=\"space-y-2 p-4\">\n                    {filteredConversations.map((conversation) => (\n                      <div\n                        key={conversation.userId}\n                        onClick={() => setSelectedConversation(conversation.userId)}\n                        className={`p-3 rounded-md cursor-pointer transition-colors ${\n                          selectedConversation === conversation.userId\n                            ? 'bg-df-cyan bg-opacity-20 border border-df-cyan'\n                            : 'hover:bg-df-steel hover:bg-opacity-20'\n                        }`}\n                        data-testid={`conversation-${conversation.userId}`}\n                      >\n                        <div className=\"flex items-center gap-3\">\n                          <Avatar className=\"h-10 w-10 border-2 border-df-steel\">\n                            <AvatarFallback className=\"bg-df-ink text-df-cyan\">\n                              {conversation.displayName[0].toUpperCase()}\n                            </AvatarFallback>\n                          </Avatar>\n                          <div className=\"flex-1 min-w-0\">\n                            <div className=\"flex items-center justify-between\">\n                              <h4 className=\"text-df-snow font-medium truncate\">\n                                {conversation.displayName}\n                              </h4>\n                              {conversation.unreadCount > 0 && (\n                                <span className=\"bg-df-gold text-df-ink text-xs rounded-full h-5 w-5 flex items-center justify-center font-bold\">\n                                  {conversation.unreadCount}\n                                </span>\n                              )}\n                            </div>\n                            <p className=\"text-df-fog text-sm truncate\">\n                              {conversation.lastMessage}\n                            </p>\n                            <p className=\"text-df-fog text-xs\">\n                              {conversation.lastMessageTime}\n                            </p>\n                          </div>\n                        </div>\n                      </div>\n                    ))}\n                  </div>\n                ) : (\n                  <div className=\"p-4 text-center\">\n                    <MessageCircle className=\"h-12 w-12 text-df-fog mx-auto mb-4\" />\n                    <p className=\"text-df-fog\">No conversations found</p>\n                  </div>\n                )}\n              </ScrollArea>\n            </CardContent>\n          </Card>\n\n          {/* Chat Area */}\n          <Card className=\"card-df lg:col-span-2\">\n            {selectedConversation ? (\n              <>\n                {/* Chat Header */}\n                <CardHeader className=\"border-b border-df-steel\">\n                  <div className=\"flex items-center justify-between\">\n                    <div className=\"flex items-center gap-3\">\n                      <Avatar className=\"h-10 w-10 border-2 border-df-steel\">\n                        <AvatarFallback className=\"bg-df-ink text-df-cyan\">\n                          {conversations.find(c => c.userId === selectedConversation)?.displayName[0].toUpperCase()}\n                        </AvatarFallback>\n                      </Avatar>\n                      <div>\n                        <h3 className=\"text-df-snow font-semibold\">\n                          {conversations.find(c => c.userId === selectedConversation)?.displayName}\n                        </h3>\n                        <p className=\"text-df-fog text-sm\">\n                          {isConnected ? 'Online' : 'Last seen recently'}\n                        </p>\n                      </div>\n                    </div>\n                    <div className=\"flex items-center gap-2\">\n                      <Button className=\"btn-outline p-2\" data-testid=\"button-voice-call\">\n                        <Phone className=\"h-4 w-4\" />\n                      </Button>\n                      <Button className=\"btn-outline p-2\" data-testid=\"button-video-call\">\n                        <Video className=\"h-4 w-4\" />\n                      </Button>\n                    </div>\n                  </div>\n                </CardHeader>\n\n                {/* Messages */}\n                <CardContent className=\"p-0 flex flex-col h-96\">\n                  <ScrollArea className=\"flex-1 p-4\">\n                    {messagesLoading ? (\n                      <div className=\"text-center py-8\">\n                        <div className=\"text-df-fog\">Loading messages...</div>\n                      </div>\n                    ) : messages && messages.length > 0 ? (\n                      <div className=\"space-y-4\">\n                        {messages.map((message: Message) => (\n                          <div\n                            key={message.id}\n                            className={`flex ${\n                              message.senderId === user.id ? 'justify-end' : 'justify-start'\n                            }`}\n                          >\n                            <div\n                              className={`max-w-xs lg:max-w-md px-4 py-2 rounded-lg ${\n                                message.senderId === user.id\n                                  ? 'bg-df-cyan text-df-ink'\n                                  : 'bg-df-steel text-df-snow'\n                              }`}\n                              data-testid={`message-${message.id}`}\n                            >\n                              <p className=\"text-sm\">{message.content}</p>\n                              <p className={`text-xs mt-1 ${\n                                message.senderId === user.id ? 'text-df-ink text-opacity-70' : 'text-df-fog'\n                              }`}>\n                                {new Date(message.createdAt).toLocaleTimeString()}\n                              </p>\n                            </div>\n                          </div>\n                        ))}\n                        <div ref={messagesEndRef} />\n                      </div>\n                    ) : (\n                      <div className=\"text-center py-8\">\n                        <MessageCircle className=\"h-12 w-12 text-df-fog mx-auto mb-4\" />\n                        <p className=\"text-df-fog\">Start the conversation!</p>\n                      </div>\n                    )}\n                  </ScrollArea>\n\n                  {/* Message Input */}\n                  <div className=\"border-t border-df-steel p-4\">\n                    <div className=\"flex items-center gap-2\">\n                      <Input\n                        placeholder=\"Type your message...\"\n                        value={messageInput}\n                        onChange={(e) => setMessageInput(e.target.value)}\n                        onKeyPress={handleKeyPress}\n                        className=\"input-df flex-1\"\n                        disabled={sendMessageMutation.isPending}\n                        data-testid=\"input-message\"\n                      />\n                      <Button\n                        onClick={handleSendMessage}\n                        disabled={!messageInput.trim() || sendMessageMutation.isPending}\n                        className=\"btn-primary p-3\"\n                        data-testid=\"button-send-message\"\n                      >\n                        <Send className=\"h-4 w-4\" />\n                      </Button>\n                    </div>\n                  </div>\n                </CardContent>\n              </>\n            ) : (\n              <CardContent className=\"flex items-center justify-center h-full\">\n                <div className=\"text-center\">\n                  <MessageCircle className=\"h-16 w-16 text-df-fog mx-auto mb-4\" />\n                  <h3 className=\"text-df-snow text-lg font-semibold mb-2\">\n                    Select a conversation\n                  </h3>\n                  <p className=\"text-df-fog\">\n                    Choose a conversation from the left to start messaging\n                  </p>\n                </div>\n              </CardContent>\n            )}\n          </Card>\n        </div>\n      </main>\n\n      <Footer />\n    </div>\n  );\n}\n","size_bytes":15173},"client/src/lib/utils.ts":{"content":"import { clsx, type ClassValue } from \"clsx\"\nimport { twMerge } from \"tailwind-merge\"\n\nexport function cn(...inputs: ClassValue[]) {\n  return twMerge(clsx(inputs))\n}\n","size_bytes":166},"server/services/apiGatewayService.ts":{"content":"import { logger } from \"../logger\";\n\ninterface ServiceConfig {\n  name: string;\n  url: string;\n  healthPath: string;\n  weight: number;\n  timeout: number;\n}\n\ninterface CircuitBreakerState {\n  failures: number;\n  lastFailureTime: number;\n  state: \"closed\" | \"open\" | \"half-open\";\n}\n\ninterface CacheEntry {\n  data: any;\n  timestamp: number;\n  ttl: number;\n}\n\nclass APIGatewayService {\n  private services = new Map<string, ServiceConfig>();\n  private circuitBreakers = new Map<string, CircuitBreakerState>();\n  private cache = new Map<string, CacheEntry>();\n  private readonly failureThreshold = 5;\n  private readonly openStateTimeout = 60000; // 60 seconds\n  private readonly cacheMaxSize = 1000;\n\n  constructor() {\n    this.registerDefaultServices();\n    // Only start health checks in production when microservices are available\n    if (process.env.NODE_ENV === 'production' && process.env.ENABLE_MICROSERVICES === 'true') {\n      this.startHealthChecks();\n    }\n    this.startCacheCleanup();\n  }\n\n  private registerDefaultServices() {\n    const services: ServiceConfig[] = [\n      {\n        name: \"infrastructure\",\n        url: process.env.INFRASTRUCTURE_SERVICE_URL || \"http://localhost:5001\",\n        healthPath: \"/health\",\n        weight: 1,\n        timeout: 5000,\n      },\n      {\n        name: \"security\",\n        url: process.env.SECURITY_SERVICE_URL || \"http://localhost:5002\",\n        healthPath: \"/health\",\n        weight: 1,\n        timeout: 5000,\n      },\n      {\n        name: \"mobile\",\n        url: process.env.MOBILE_SERVICE_URL || \"http://localhost:5003\",\n        healthPath: \"/health\",\n        weight: 1,\n        timeout: 3000,\n      },\n      {\n        name: \"monitoring\",\n        url: process.env.MONITORING_SERVICE_URL || \"http://localhost:5004\",\n        healthPath: \"/health\",\n        weight: 1,\n        timeout: 5000,\n      },\n      {\n        name: \"payments\",\n        url: process.env.PAYMENTS_SERVICE_URL || \"http://localhost:5005\",\n        healthPath: \"/health\",\n        weight: 1,\n        timeout: 10000,\n      },\n      {\n        name: \"media\",\n        url: process.env.MEDIA_SERVICE_URL || \"http://localhost:5006\",\n        healthPath: \"/health\",\n        weight: 1,\n        timeout: 15000,\n      },\n    ];\n\n    services.forEach(service => {\n      this.services.set(service.name, service);\n      this.circuitBreakers.set(service.name, {\n        failures: 0,\n        lastFailureTime: 0,\n        state: \"closed\",\n      });\n    });\n  }\n\n  private startHealthChecks() {\n    setInterval(async () => {\n      for (const [name, service] of this.services) {\n        try {\n          await this.checkServiceHealth(name);\n        } catch (error) {\n          logger.warn(`Health check failed for service: ${name}`, { error });\n        }\n      }\n    }, 30000); // Every 30 seconds\n  }\n\n  private startCacheCleanup() {\n    setInterval(() => {\n      const now = Date.now();\n      for (const [key, entry] of this.cache) {\n        if (now - entry.timestamp > entry.ttl) {\n          this.cache.delete(key);\n        }\n      }\n\n      // Maintain cache size limit\n      if (this.cache.size > this.cacheMaxSize) {\n        const entries = Array.from(this.cache.entries());\n        entries.sort((a, b) => a[1].timestamp - b[1].timestamp);\n        const toDelete = entries.slice(0, entries.length - this.cacheMaxSize);\n        toDelete.forEach(([key]) => this.cache.delete(key));\n      }\n    }, 60000); // Every minute\n  }\n\n  private async checkServiceHealth(serviceName: string): Promise<boolean> {\n    const service = this.services.get(serviceName);\n    const breaker = this.circuitBreakers.get(serviceName);\n    \n    if (!service || !breaker) return false;\n\n    try {\n      const controller = new AbortController();\n      const timeoutId = setTimeout(() => controller.abort(), service.timeout);\n\n      const response = await fetch(`${service.url}${service.healthPath}`, {\n        signal: controller.signal,\n        headers: { \"Content-Type\": \"application/json\" },\n      });\n\n      clearTimeout(timeoutId);\n\n      if (response.ok) {\n        // Reset circuit breaker on success\n        breaker.failures = 0;\n        breaker.state = \"closed\";\n        logger.debug(`Service ${serviceName} health check passed`);\n        return true;\n      } else {\n        throw new Error(`Health check failed with status: ${response.status}`);\n      }\n    } catch (error) {\n      this.recordFailure(serviceName);\n      logger.warn(`Service ${serviceName} health check failed`, { error });\n      return false;\n    }\n  }\n\n  private recordFailure(serviceName: string) {\n    const breaker = this.circuitBreakers.get(serviceName);\n    if (!breaker) return;\n\n    breaker.failures++;\n    breaker.lastFailureTime = Date.now();\n\n    if (breaker.failures >= this.failureThreshold) {\n      breaker.state = \"open\";\n      logger.warn(`Circuit breaker opened for service: ${serviceName}`, {\n        failures: breaker.failures,\n      });\n    }\n  }\n\n  private canMakeRequest(serviceName: string): boolean {\n    const breaker = this.circuitBreakers.get(serviceName);\n    if (!breaker) return false;\n\n    if (breaker.state === \"closed\") return true;\n    if (breaker.state === \"open\") {\n      if (Date.now() - breaker.lastFailureTime > this.openStateTimeout) {\n        breaker.state = \"half-open\";\n        return true;\n      }\n      return false;\n    }\n    if (breaker.state === \"half-open\") return true;\n\n    return false;\n  }\n\n  private getCacheKey(method: string, url: string, data?: any): string {\n    return `${method}:${url}:${data ? JSON.stringify(data) : \"\"}`;\n  }\n\n  private getFromCache(key: string): any | null {\n    const entry = this.cache.get(key);\n    if (!entry) return null;\n\n    if (Date.now() - entry.timestamp > entry.ttl) {\n      this.cache.delete(key);\n      return null;\n    }\n\n    return entry.data;\n  }\n\n  private setCache(key: string, data: any, ttl: number = 300000): void {\n    this.cache.set(key, {\n      data,\n      timestamp: Date.now(),\n      ttl,\n    });\n  }\n\n  async routeRequest(\n    serviceName: string,\n    path: string,\n    options: {\n      method?: string;\n      data?: any;\n      useCache?: boolean;\n      cacheTtl?: number;\n    } = {}\n  ): Promise<any> {\n    const { method = \"GET\", data, useCache = true, cacheTtl = 300000 } = options;\n    \n    if (!this.canMakeRequest(serviceName)) {\n      throw new Error(`Service ${serviceName} is currently unavailable (circuit breaker open)`);\n    }\n\n    const service = this.services.get(serviceName);\n    if (!service) {\n      throw new Error(`Service ${serviceName} not found`);\n    }\n\n    // Check cache for GET requests\n    if (method === \"GET\" && useCache) {\n      const cacheKey = this.getCacheKey(method, `${service.url}${path}`, data);\n      const cached = this.getFromCache(cacheKey);\n      if (cached) {\n        logger.debug(`Cache hit for ${serviceName}${path}`);\n        return cached;\n      }\n    }\n\n    try {\n      const controller = new AbortController();\n      const timeoutId = setTimeout(() => controller.abort(), service.timeout);\n\n      const response = await fetch(`${service.url}${path}`, {\n        method,\n        headers: { \"Content-Type\": \"application/json\" },\n        body: data ? JSON.stringify(data) : undefined,\n        signal: controller.signal,\n      });\n\n      clearTimeout(timeoutId);\n\n      if (!response.ok) {\n        throw new Error(`Request failed with status: ${response.status}`);\n      }\n\n      const result = await response.json();\n\n      // Cache successful GET responses\n      if (method === \"GET\" && useCache) {\n        const cacheKey = this.getCacheKey(method, `${service.url}${path}`, data);\n        this.setCache(cacheKey, result, cacheTtl);\n      }\n\n      // Reset circuit breaker on success\n      const breaker = this.circuitBreakers.get(serviceName);\n      if (breaker && breaker.state === \"half-open\") {\n        breaker.state = \"closed\";\n        breaker.failures = 0;\n      }\n\n      return result;\n    } catch (error) {\n      this.recordFailure(serviceName);\n      logger.error(`Request to service ${serviceName} failed`, { error, path });\n      throw error;\n    }\n  }\n\n  getServiceStatus(): Record<string, any> {\n    const status: Record<string, any> = {};\n    \n    for (const [name, service] of this.services) {\n      const breaker = this.circuitBreakers.get(name);\n      status[name] = {\n        url: service.url,\n        state: breaker?.state || \"unknown\",\n        failures: breaker?.failures || 0,\n        lastFailureTime: breaker?.lastFailureTime || null,\n      };\n    }\n\n    return status;\n  }\n\n  getCacheStats(): { size: number; maxSize: number; hitRate?: number } {\n    return {\n      size: this.cache.size,\n      maxSize: this.cacheMaxSize,\n    };\n  }\n}\n\nexport const apiGatewayService = new APIGatewayService();\n","size_bytes":8716},"client/src/pages/LegalPage.tsx":{"content":"import { useRoute } from \"wouter\";\nimport Header from \"@/components/layout/Header\";\nimport Footer from \"@/components/layout/Footer\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Shield, FileText, Lock, Scale, AlertTriangle, Copyright } from \"lucide-react\";\n\nconst legalContent = {\n  \"2257\": {\n    title: \"18 U.S.C. § 2257 Compliance\",\n    icon: Shield,\n    sections: [\n      {\n        heading: \"Record-Keeping Requirements\",\n        content: \"DaddyFanz complies with 18 U.S.C. § 2257 and 28 C.F.R. Part 75 record-keeping requirements for all content depicting actual sexually explicit conduct. All models, performers, and other persons who appear in any visual depiction of actual or simulated sexually explicit conduct appearing on this platform were over the age of 18 years at the time of creation of such depictions.\"\n      },\n      {\n        heading: \"Custodian of Records\",\n        content: \"Records required to be maintained under 18 U.S.C. § 2257 and 28 C.F.R. Part 75 for materials contained on this platform are kept by the designated Custodian of Records. Content creators are required to maintain their own records in compliance with these regulations.\"\n      },\n      {\n        heading: \"Content Creator Responsibilities\",\n        content: \"All content creators on DaddyFanz are required to verify and maintain records proving that all individuals appearing in their content are at least 18 years of age. Creators must provide age verification documentation for all performers in their content upon request.\"\n      },\n      {\n        heading: \"Enforcement\",\n        content: \"DaddyFanz takes compliance with federal record-keeping requirements seriously. Any creator found to be in violation of these requirements will be immediately removed from the platform and reported to appropriate authorities.\"\n      }\n    ]\n  },\n  \"gdpr\": {\n    title: \"GDPR Compliance\",\n    icon: Lock,\n    sections: [\n      {\n        heading: \"Data Protection Rights\",\n        content: \"Under the General Data Protection Regulation (GDPR), European Union users have specific rights regarding their personal data. DaddyFanz is committed to protecting these rights and ensuring full compliance with GDPR requirements.\"\n      },\n      {\n        heading: \"Your Rights Under GDPR\",\n        content: \"You have the right to access, rectify, erase, restrict processing, data portability, and object to processing of your personal data. You also have the right to withdraw consent at any time and lodge a complaint with a supervisory authority.\"\n      },\n      {\n        heading: \"Data Processing Legal Basis\",\n        content: \"We process personal data based on: (1) your consent for marketing communications and optional features, (2) contractual necessity to provide our services, (3) legal obligations including age verification and compliance, and (4) legitimate interests in fraud prevention and platform security.\"\n      },\n      {\n        heading: \"International Data Transfers\",\n        content: \"Data may be transferred outside the European Economic Area. We ensure adequate protection through standard contractual clauses, adequacy decisions, and other appropriate safeguards as required by GDPR.\"\n      },\n      {\n        heading: \"Contact Our DPO\",\n        content: \"For GDPR-related inquiries, contact our Data Protection Officer at privacy@daddiesfanz.com. We will respond to all requests within 30 days as required by law.\"\n      }\n    ]\n  },\n  \"kyc\": {\n    title: \"KYC/AML Policy\",\n    icon: FileText,\n    sections: [\n      {\n        heading: \"Know Your Customer (KYC)\",\n        content: \"DaddyFanz implements robust Know Your Customer procedures for all content creators to ensure platform integrity, prevent fraud, and comply with financial regulations. All creators must verify their identity before monetizing content.\"\n      },\n      {\n        heading: \"Required Documentation\",\n        content: \"Creators must provide: (1) Government-issued photo ID (passport, driver's license, or national ID card), (2) Proof of address dated within the last 90 days, (3) Tax identification information, and (4) Banking details for payouts. Additional documentation may be required based on jurisdiction and earnings level.\"\n      },\n      {\n        heading: \"Anti-Money Laundering (AML)\",\n        content: \"We maintain strict anti-money laundering controls including transaction monitoring, suspicious activity reporting, and enhanced due diligence for high-value accounts. Our AML program complies with applicable financial crimes enforcement regulations.\"\n      },\n      {\n        heading: \"Verification Process\",\n        content: \"Identity verification is performed using automated and manual review processes. Most verifications complete within 24-48 hours. Enhanced verification may be required for accounts with high transaction volumes or unusual activity patterns.\"\n      },\n      {\n        heading: \"Ongoing Monitoring\",\n        content: \"We continuously monitor for suspicious activity, unusual transaction patterns, and potential policy violations. Accounts may be subject to periodic re-verification to maintain compliance with regulatory requirements.\"\n      }\n    ]\n  },\n  \"terms\": {\n    title: \"Terms of Service\",\n    icon: Scale,\n    sections: [\n      {\n        heading: \"Acceptance of Terms\",\n        content: \"By accessing or using DaddyFanz, you agree to be bound by these Terms of Service. If you do not agree to these terms, you may not use our platform. These terms constitute a legally binding agreement between you and DaddyFanz.\"\n      },\n      {\n        heading: \"Age Requirement\",\n        content: \"You must be at least 18 years old to use DaddyFanz. By using this platform, you represent and warrant that you are of legal age in your jurisdiction. We reserve the right to request proof of age at any time.\"\n      },\n      {\n        heading: \"Account Responsibilities\",\n        content: \"You are responsible for maintaining the confidentiality of your account credentials and for all activities that occur under your account. You must immediately notify us of any unauthorized use of your account or other security breach.\"\n      },\n      {\n        heading: \"Content Ownership and Licensing\",\n        content: \"Creators retain ownership of their content but grant DaddyFanz a non-exclusive license to display, distribute, and monetize content on the platform. Fans may access content according to their subscription level but may not redistribute, resell, or claim ownership.\"\n      },\n      {\n        heading: \"Prohibited Conduct\",\n        content: \"Users may not: upload illegal content, impersonate others, harass or threaten other users, attempt to circumvent payment systems, scrape or crawl the platform, or violate any applicable laws. Violations may result in immediate account termination.\"\n      },\n      {\n        heading: \"Payment Terms\",\n        content: \"All payments are processed through third-party payment processors. Subscription fees are non-refundable except as required by law. Creators receive payouts according to our payout schedule minus applicable platform fees and processing charges.\"\n      },\n      {\n        heading: \"Limitation of Liability\",\n        content: \"DaddyFanz is provided 'as is' without warranties of any kind. We are not liable for any indirect, incidental, or consequential damages arising from your use of the platform. Our total liability is limited to the amount you paid us in the 12 months prior to any claim.\"\n      },\n      {\n        heading: \"Changes to Terms\",\n        content: \"We may modify these Terms of Service at any time. Continued use of the platform after changes constitutes acceptance of the new terms. Material changes will be communicated via email or platform notification.\"\n      }\n    ]\n  },\n  \"privacy\": {\n    title: \"Privacy Policy\",\n    icon: Lock,\n    sections: [\n      {\n        heading: \"Information We Collect\",\n        content: \"We collect information you provide directly (account details, profile information, payment data), automatically through your use of the platform (device information, IP address, browsing activity), and from third parties (payment processors, identity verification services).\"\n      },\n      {\n        heading: \"How We Use Your Information\",\n        content: \"We use your information to: provide and improve our services, process transactions, verify identity and age, prevent fraud and abuse, communicate with you, comply with legal obligations, and personalize your experience.\"\n      },\n      {\n        heading: \"Information Sharing\",\n        content: \"We share information with: payment processors for transaction processing, identity verification services for KYC/AML compliance, law enforcement when legally required, service providers who assist our operations, and other users as necessary to provide services (e.g., creators see subscriber counts).\"\n      },\n      {\n        heading: \"Data Security\",\n        content: \"We implement industry-standard security measures including encryption, access controls, regular security audits, and secure data storage. However, no system is completely secure, and we cannot guarantee absolute security of your information.\"\n      },\n      {\n        heading: \"Your Privacy Rights\",\n        content: \"You have the right to access, correct, delete, or export your personal data. You can manage privacy settings in your account dashboard. For GDPR or CCPA requests, contact privacy@daddiesfanz.com.\"\n      },\n      {\n        heading: \"Cookies and Tracking\",\n        content: \"We use cookies and similar technologies for authentication, preferences, analytics, and advertising. You can control cookie settings through your browser, but some features may not function properly if cookies are disabled.\"\n      },\n      {\n        heading: \"Data Retention\",\n        content: \"We retain your information for as long as your account is active and as necessary to comply with legal obligations, resolve disputes, and enforce our agreements. Deleted account data is retained for 90 days before permanent deletion.\"\n      }\n    ]\n  },\n  \"dmca\": {\n    title: \"DMCA Policy\",\n    icon: Copyright,\n    sections: [\n      {\n        heading: \"Copyright Infringement Policy\",\n        content: \"DaddyFanz respects intellectual property rights and complies with the Digital Millennium Copyright Act (DMCA). We respond promptly to valid copyright infringement notices and will remove infringing content.\"\n      },\n      {\n        heading: \"Filing a DMCA Takedown Notice\",\n        content: \"To file a DMCA notice, you must provide: (1) Your physical or electronic signature, (2) Identification of the copyrighted work, (3) Identification of the infringing material and its location, (4) Your contact information, (5) A statement of good faith belief that use is unauthorized, (6) A statement under penalty of perjury that the information is accurate and you are authorized to act.\"\n      },\n      {\n        heading: \"Counter-Notification Process\",\n        content: \"If you believe your content was wrongly removed, you may file a counter-notification. We will forward it to the complaining party and may restore the content within 10-14 business days unless the copyright owner files a court action.\"\n      },\n      {\n        heading: \"Designated DMCA Agent\",\n        content: \"All DMCA notices and counter-notifications should be sent to our designated agent: dmca@daddiesfanz.com. Physical mail: DaddyFanz DMCA Agent, Legal Department.\"\n      },\n      {\n        heading: \"Repeat Infringer Policy\",\n        content: \"We will terminate accounts of users who are repeat copyright infringers. Multiple validated DMCA complaints against an account may result in permanent suspension.\"\n      },\n      {\n        heading: \"Creator Protections\",\n        content: \"Creators own their original content and can issue DMCA takedown notices for unauthorized use of their content on other platforms. We provide tools to help creators protect their intellectual property.\"\n      }\n    ]\n  },\n  \"acceptable-use\": {\n    title: \"Acceptable Use Policy\",\n    icon: AlertTriangle,\n    sections: [\n      {\n        heading: \"Permitted Use\",\n        content: \"DaddyFanz is intended for legal adult content creation and consumption. Users must be 18+ and comply with all applicable laws. Content must not violate any local, state, national, or international laws or regulations.\"\n      },\n      {\n        heading: \"Prohibited Content\",\n        content: \"The following content is strictly prohibited: illegal content of any kind, content depicting minors or individuals who appear to be minors, non-consensual content, violent or extreme content, hate speech or discriminatory content, content promoting illegal activities, and deceptive or fraudulent content.\"\n      },\n      {\n        heading: \"Content Moderation\",\n        content: \"All content is subject to automated and human moderation. We use AI-powered tools to detect prohibited content, deepfakes, and policy violations. Content flagged by our systems undergoes manual review by trained moderators.\"\n      },\n      {\n        heading: \"Prohibited Activities\",\n        content: \"Users may not: attempt to hack or breach platform security, create multiple accounts to evade bans, engage in spam or manipulation, harass or threaten other users, attempt payment fraud or chargebacks abuse, use bots or automated tools, or scrape platform data.\"\n      },\n      {\n        heading: \"Enforcement\",\n        content: \"Violations may result in: content removal, account warnings, temporary suspension, permanent account termination, loss of earnings, and reporting to law enforcement. We reserve the right to take any action necessary to maintain platform integrity.\"\n      },\n      {\n        heading: \"Reporting Violations\",\n        content: \"If you encounter content or behavior that violates this policy, please report it immediately using the report button or contact abuse@daddiesfanz.com. All reports are reviewed and investigated promptly.\"\n      }\n    ]\n  }\n};\n\nexport default function LegalPage() {\n  const [, params] = useRoute(\"/legal/:page\");\n  const page = params?.page || \"terms\";\n  const content = legalContent[page as keyof typeof legalContent];\n\n  if (!content) {\n    return (\n      <div className=\"min-h-screen bg-df-obsidian\">\n        <Header />\n        <div className=\"max-w-4xl mx-auto px-4 py-16 text-center\">\n          <h1 className=\"text-2xl text-df-snow\">Page not found</h1>\n        </div>\n        <Footer />\n      </div>\n    );\n  }\n\n  const IconComponent = content.icon;\n\n  return (\n    <div className=\"min-h-screen bg-df-obsidian\">\n      <Header />\n      <div className=\"max-w-4xl mx-auto px-4 py-16\">\n        <div className=\"flex items-center gap-4 mb-8\">\n          <div className=\"p-3 bg-df-brick rounded-lg border border-df-steel\">\n            <IconComponent className=\"w-8 h-8 text-df-cyan\" />\n          </div>\n          <h1 className=\"text-4xl neon-heading\">{content.title}</h1>\n        </div>\n\n        <div className=\"space-y-6\">\n          {content.sections.map((section, index) => (\n            <Card key={index} className=\"bg-df-brick border-df-steel\">\n              <CardHeader>\n                <CardTitle className=\"text-xl text-df-snow\">{section.heading}</CardTitle>\n              </CardHeader>\n              <CardContent>\n                <p className=\"text-df-fog leading-relaxed\">{section.content}</p>\n              </CardContent>\n            </Card>\n          ))}\n        </div>\n\n        <div className=\"mt-12 p-6 bg-df-brick border border-df-steel rounded-lg\">\n          <p className=\"text-df-fog text-sm\">\n            <strong className=\"text-df-snow\">Last Updated:</strong> October 2024\n          </p>\n          <p className=\"text-df-fog text-sm mt-2\">\n            For questions about this policy, contact us at <a href=\"mailto:legal@daddiesfanz.com\" className=\"text-df-cyan hover:underline\" data-testid=\"link-legal-email\">legal@daddiesfanz.com</a>\n          </p>\n        </div>\n      </div>\n      <Footer />\n    </div>\n  );\n}\n","size_bytes":16087},"client/src/hooks/use-toast.ts":{"content":"import * as React from \"react\"\n\nimport type {\n  ToastActionElement,\n  ToastProps,\n} from \"@/components/ui/toast\"\n\nconst TOAST_LIMIT = 1\nconst TOAST_REMOVE_DELAY = 1000000\n\ntype ToasterToast = ToastProps & {\n  id: string\n  title?: React.ReactNode\n  description?: React.ReactNode\n  action?: ToastActionElement\n}\n\nconst actionTypes = {\n  ADD_TOAST: \"ADD_TOAST\",\n  UPDATE_TOAST: \"UPDATE_TOAST\",\n  DISMISS_TOAST: \"DISMISS_TOAST\",\n  REMOVE_TOAST: \"REMOVE_TOAST\",\n} as const\n\nlet count = 0\n\nfunction genId() {\n  count = (count + 1) % Number.MAX_SAFE_INTEGER\n  return count.toString()\n}\n\ntype ActionType = typeof actionTypes\n\ntype Action =\n  | {\n      type: ActionType[\"ADD_TOAST\"]\n      toast: ToasterToast\n    }\n  | {\n      type: ActionType[\"UPDATE_TOAST\"]\n      toast: Partial<ToasterToast>\n    }\n  | {\n      type: ActionType[\"DISMISS_TOAST\"]\n      toastId?: ToasterToast[\"id\"]\n    }\n  | {\n      type: ActionType[\"REMOVE_TOAST\"]\n      toastId?: ToasterToast[\"id\"]\n    }\n\ninterface State {\n  toasts: ToasterToast[]\n}\n\nconst toastTimeouts = new Map<string, ReturnType<typeof setTimeout>>()\n\nconst addToRemoveQueue = (toastId: string) => {\n  if (toastTimeouts.has(toastId)) {\n    return\n  }\n\n  const timeout = setTimeout(() => {\n    toastTimeouts.delete(toastId)\n    dispatch({\n      type: \"REMOVE_TOAST\",\n      toastId: toastId,\n    })\n  }, TOAST_REMOVE_DELAY)\n\n  toastTimeouts.set(toastId, timeout)\n}\n\nexport const reducer = (state: State, action: Action): State => {\n  switch (action.type) {\n    case \"ADD_TOAST\":\n      return {\n        ...state,\n        toasts: [action.toast, ...state.toasts].slice(0, TOAST_LIMIT),\n      }\n\n    case \"UPDATE_TOAST\":\n      return {\n        ...state,\n        toasts: state.toasts.map((t) =>\n          t.id === action.toast.id ? { ...t, ...action.toast } : t\n        ),\n      }\n\n    case \"DISMISS_TOAST\": {\n      const { toastId } = action\n\n      // ! Side effects ! - This could be extracted into a dismissToast() action,\n      // but I'll keep it here for simplicity\n      if (toastId) {\n        addToRemoveQueue(toastId)\n      } else {\n        state.toasts.forEach((toast) => {\n          addToRemoveQueue(toast.id)\n        })\n      }\n\n      return {\n        ...state,\n        toasts: state.toasts.map((t) =>\n          t.id === toastId || toastId === undefined\n            ? {\n                ...t,\n                open: false,\n              }\n            : t\n        ),\n      }\n    }\n    case \"REMOVE_TOAST\":\n      if (action.toastId === undefined) {\n        return {\n          ...state,\n          toasts: [],\n        }\n      }\n      return {\n        ...state,\n        toasts: state.toasts.filter((t) => t.id !== action.toastId),\n      }\n  }\n}\n\nconst listeners: Array<(state: State) => void> = []\n\nlet memoryState: State = { toasts: [] }\n\nfunction dispatch(action: Action) {\n  memoryState = reducer(memoryState, action)\n  listeners.forEach((listener) => {\n    listener(memoryState)\n  })\n}\n\ntype Toast = Omit<ToasterToast, \"id\">\n\nfunction toast({ ...props }: Toast) {\n  const id = genId()\n\n  const update = (props: ToasterToast) =>\n    dispatch({\n      type: \"UPDATE_TOAST\",\n      toast: { ...props, id },\n    })\n  const dismiss = () => dispatch({ type: \"DISMISS_TOAST\", toastId: id })\n\n  dispatch({\n    type: \"ADD_TOAST\",\n    toast: {\n      ...props,\n      id,\n      open: true,\n      onOpenChange: (open) => {\n        if (!open) dismiss()\n      },\n    },\n  })\n\n  return {\n    id: id,\n    dismiss,\n    update,\n  }\n}\n\nfunction useToast() {\n  const [state, setState] = React.useState<State>(memoryState)\n\n  React.useEffect(() => {\n    listeners.push(setState)\n    return () => {\n      const index = listeners.indexOf(setState)\n      if (index > -1) {\n        listeners.splice(index, 1)\n      }\n    }\n  }, [state])\n\n  return {\n    ...state,\n    toast,\n    dismiss: (toastId?: string) => dispatch({ type: \"DISMISS_TOAST\", toastId }),\n  }\n}\n\nexport { useToast, toast }\n","size_bytes":3895},"client/src/pages/ContentManage.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { useLocation } from \"wouter\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { \n  Upload, \n  Search, \n  Filter, \n  Image, \n  Video, \n  Edit, \n  Trash2, \n  Eye, \n  Clock,\n  CheckCircle,\n  XCircle,\n  DollarSign,\n  Star,\n  Grid,\n  List\n} from \"lucide-react\";\n\ninterface MediaAsset {\n  id: string;\n  title: string;\n  description: string;\n  mimeType: string;\n  fileSize: number;\n  status: \"uploaded\" | \"processing\" | \"approved\" | \"rejected\";\n  price?: number;\n  isPremium: boolean;\n  s3Key: string;\n  createdAt: string;\n  updatedAt: string;\n}\n\nexport default function ContentManage() {\n  const [searchTerm, setSearchTerm] = useState(\"\");\n  const [statusFilter, setStatusFilter] = useState<string>(\"all\");\n  const [viewMode, setViewMode] = useState<\"grid\" | \"list\">(\"grid\");\n  const [, navigate] = useLocation();\n  const queryClient = useQueryClient();\n  const { toast } = useToast();\n\n  // Fetch user's media assets\n  const { data: mediaAssets = [], isLoading } = useQuery({\n    queryKey: [\"/api/media\"],\n    queryFn: async () => {\n      const response = await apiRequest(\"GET\", \"/api/media\");\n      return response.json();\n    }\n  });\n\n  // Delete media mutation\n  const deleteMutation = useMutation({\n    mutationFn: async (id: string) => {\n      return apiRequest(\"DELETE\", `/api/media/${id}`);\n    },\n    onSuccess: () => {\n      toast({\n        title: \"Content Deleted\",\n        description: \"Your content has been successfully deleted.\"\n      });\n      queryClient.invalidateQueries({ queryKey: [\"/api/media\"] });\n    },\n    onError: () => {\n      toast({\n        title: \"Delete Failed\",\n        description: \"Failed to delete content. Please try again.\",\n        variant: \"destructive\"\n      });\n    }\n  });\n\n  // Filter media assets\n  const filteredAssets = mediaAssets.filter((asset: MediaAsset) => {\n    const matchesSearch = asset.title.toLowerCase().includes(searchTerm.toLowerCase()) ||\n                         asset.description?.toLowerCase().includes(searchTerm.toLowerCase());\n    const matchesStatus = statusFilter === \"all\" || asset.status === statusFilter;\n    return matchesSearch && matchesStatus;\n  });\n\n  const getStatusColor = (status: string) => {\n    switch (status) {\n      case \"approved\": return \"bg-green-600\";\n      case \"rejected\": return \"bg-red-600\";\n      case \"processing\": return \"bg-yellow-600\";\n      default: return \"bg-slate-600\";\n    }\n  };\n\n  const getStatusIcon = (status: string) => {\n    switch (status) {\n      case \"approved\": return <CheckCircle className=\"h-4 w-4\" />;\n      case \"rejected\": return <XCircle className=\"h-4 w-4\" />;\n      case \"processing\": return <Clock className=\"h-4 w-4\" />;\n      default: return <Clock className=\"h-4 w-4\" />;\n    }\n  };\n\n  const formatFileSize = (bytes: number) => {\n    if (bytes < 1024 * 1024) {\n      return `${(bytes / 1024).toFixed(1)} KB`;\n    }\n    return `${(bytes / (1024 * 1024)).toFixed(1)} MB`;\n  };\n\n  const formatDate = (dateString: string) => {\n    return new Date(dateString).toLocaleDateString(\"en-US\", {\n      year: \"numeric\",\n      month: \"short\",\n      day: \"numeric\",\n      hour: \"2-digit\",\n      minute: \"2-digit\"\n    });\n  };\n\n  if (isLoading) {\n    return (\n      <div className=\"min-h-screen bg-gradient-to-br from-slate-900 via-purple-900 to-slate-800 p-6\">\n        <div className=\"max-w-7xl mx-auto\">\n          <div className=\"flex items-center justify-center h-64\">\n            <div className=\"animate-spin rounded-full h-12 w-12 border-4 border-cyan-400 border-t-transparent\"></div>\n          </div>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"min-h-screen bg-gradient-to-br from-slate-900 via-purple-900 to-slate-800 p-6\">\n      <div className=\"max-w-7xl mx-auto\">\n        {/* Header */}\n        <div className=\"mb-8\">\n          <div className=\"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4\">\n            <div>\n              <h1 className=\"text-3xl font-bold text-white mb-2\">Content Management</h1>\n              <p className=\"text-slate-300\">Manage your uploaded content and track moderation status</p>\n            </div>\n            <Button\n              onClick={() => navigate(\"/content-upload\")}\n              className=\"bg-gradient-to-r from-cyan-500 to-blue-600 hover:from-cyan-600 hover:to-blue-700\"\n              data-testid=\"button-upload-new\"\n            >\n              <Upload className=\"h-4 w-4 mr-2\" />\n              Upload New Content\n            </Button>\n          </div>\n        </div>\n\n        {/* Filters and Search */}\n        <Card className=\"border-slate-700 bg-slate-800/50 mb-8\">\n          <CardHeader>\n            <CardTitle className=\"text-white\">Filter & Search</CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className=\"flex flex-col lg:flex-row gap-4\">\n              <div className=\"flex-1\">\n                <div className=\"relative\">\n                  <Search className=\"absolute left-3 top-1/2 transform -translate-y-1/2 text-slate-400 h-4 w-4\" />\n                  <Input\n                    placeholder=\"Search content...\"\n                    value={searchTerm}\n                    onChange={(e) => setSearchTerm(e.target.value)}\n                    className=\"pl-10 bg-slate-700 border-slate-600 text-white\"\n                    data-testid=\"input-search\"\n                  />\n                </div>\n              </div>\n              \n              <div className=\"flex gap-4\">\n                <Select value={statusFilter} onValueChange={setStatusFilter}>\n                  <SelectTrigger className=\"w-48 bg-slate-700 border-slate-600 text-white\" data-testid=\"select-status\">\n                    <Filter className=\"h-4 w-4 mr-2\" />\n                    <SelectValue />\n                  </SelectTrigger>\n                  <SelectContent>\n                    <SelectItem value=\"all\">All Status</SelectItem>\n                    <SelectItem value=\"uploaded\">Uploaded</SelectItem>\n                    <SelectItem value=\"processing\">Processing</SelectItem>\n                    <SelectItem value=\"approved\">Approved</SelectItem>\n                    <SelectItem value=\"rejected\">Rejected</SelectItem>\n                  </SelectContent>\n                </Select>\n\n                <div className=\"flex border border-slate-600 rounded-md\">\n                  <Button\n                    variant={viewMode === \"grid\" ? \"default\" : \"ghost\"}\n                    size=\"sm\"\n                    onClick={() => setViewMode(\"grid\")}\n                    className=\"rounded-r-none\"\n                    data-testid=\"button-grid-view\"\n                  >\n                    <Grid className=\"h-4 w-4\" />\n                  </Button>\n                  <Button\n                    variant={viewMode === \"list\" ? \"default\" : \"ghost\"}\n                    size=\"sm\"\n                    onClick={() => setViewMode(\"list\")}\n                    className=\"rounded-l-none\"\n                    data-testid=\"button-list-view\"\n                  >\n                    <List className=\"h-4 w-4\" />\n                  </Button>\n                </div>\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n\n        {/* Content Stats */}\n        <div className=\"grid grid-cols-1 md:grid-cols-4 gap-6 mb-8\">\n          <Card className=\"border-slate-700 bg-slate-800/50\">\n            <CardContent className=\"p-6\">\n              <div className=\"flex items-center\">\n                <Image className=\"h-8 w-8 text-cyan-400\" />\n                <div className=\"ml-4\">\n                  <p className=\"text-slate-400 text-sm\">Total Content</p>\n                  <p className=\"text-2xl font-bold text-white\">{mediaAssets.length}</p>\n                </div>\n              </div>\n            </CardContent>\n          </Card>\n\n          <Card className=\"border-slate-700 bg-slate-800/50\">\n            <CardContent className=\"p-6\">\n              <div className=\"flex items-center\">\n                <CheckCircle className=\"h-8 w-8 text-green-400\" />\n                <div className=\"ml-4\">\n                  <p className=\"text-slate-400 text-sm\">Approved</p>\n                  <p className=\"text-2xl font-bold text-white\">\n                    {mediaAssets.filter((asset: MediaAsset) => asset.status === \"approved\").length}\n                  </p>\n                </div>\n              </div>\n            </CardContent>\n          </Card>\n\n          <Card className=\"border-slate-700 bg-slate-800/50\">\n            <CardContent className=\"p-6\">\n              <div className=\"flex items-center\">\n                <Clock className=\"h-8 w-8 text-yellow-400\" />\n                <div className=\"ml-4\">\n                  <p className=\"text-slate-400 text-sm\">Pending</p>\n                  <p className=\"text-2xl font-bold text-white\">\n                    {mediaAssets.filter((asset: MediaAsset) => asset.status === \"processing\" || asset.status === \"uploaded\").length}\n                  </p>\n                </div>\n              </div>\n            </CardContent>\n          </Card>\n\n          <Card className=\"border-slate-700 bg-slate-800/50\">\n            <CardContent className=\"p-6\">\n              <div className=\"flex items-center\">\n                <Star className=\"h-8 w-8 text-purple-400\" />\n                <div className=\"ml-4\">\n                  <p className=\"text-slate-400 text-sm\">Premium</p>\n                  <p className=\"text-2xl font-bold text-white\">\n                    {mediaAssets.filter((asset: MediaAsset) => asset.isPremium).length}\n                  </p>\n                </div>\n              </div>\n            </CardContent>\n          </Card>\n        </div>\n\n        {/* Content Grid/List */}\n        {filteredAssets.length === 0 ? (\n          <Card className=\"border-slate-700 bg-slate-800/50\">\n            <CardContent className=\"p-12 text-center\">\n              <Upload className=\"h-16 w-16 text-slate-400 mx-auto mb-4\" />\n              <h3 className=\"text-xl font-medium text-white mb-2\">No Content Found</h3>\n              <p className=\"text-slate-400 mb-6\">\n                {searchTerm || statusFilter !== \"all\" \n                  ? \"No content matches your current filters.\" \n                  : \"Upload your first piece of content to get started.\"}\n              </p>\n              <Button\n                onClick={() => navigate(\"/content-upload\")}\n                className=\"bg-gradient-to-r from-cyan-500 to-blue-600 hover:from-cyan-600 hover:to-blue-700\"\n                data-testid=\"button-upload-first\"\n              >\n                <Upload className=\"h-4 w-4 mr-2\" />\n                Upload Content\n              </Button>\n            </CardContent>\n          </Card>\n        ) : (\n          <div className={viewMode === \"grid\" \n            ? \"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6\" \n            : \"space-y-4\"\n          }>\n            {filteredAssets.map((asset: MediaAsset) => (\n              <Card key={asset.id} className=\"border-slate-700 bg-slate-800/50 hover:bg-slate-800/70 transition-colors\">\n                <CardContent className={viewMode === \"grid\" ? \"p-4\" : \"p-6\"}>\n                  {viewMode === \"grid\" ? (\n                    <>\n                      {/* Grid View */}\n                      <div className=\"aspect-video bg-slate-700 rounded-lg mb-4 flex items-center justify-center\">\n                        {asset.mimeType.startsWith('image/') ? (\n                          <Image className=\"h-12 w-12 text-slate-400\" />\n                        ) : (\n                          <Video className=\"h-12 w-12 text-slate-400\" />\n                        )}\n                      </div>\n                      \n                      <div className=\"space-y-2\">\n                        <div className=\"flex items-start justify-between\">\n                          <h3 className=\"font-medium text-white truncate\" title={asset.title}>\n                            {asset.title}\n                          </h3>\n                          {asset.isPremium && <Star className=\"h-4 w-4 text-purple-400 flex-shrink-0 ml-2\" />}\n                        </div>\n                        \n                        <div className=\"flex items-center gap-2\">\n                          <Badge className={`${getStatusColor(asset.status)} text-white`}>\n                            {getStatusIcon(asset.status)}\n                            <span className=\"ml-1 capitalize\">{asset.status}</span>\n                          </Badge>\n                          {asset.price && (\n                            <Badge variant=\"outline\" className=\"border-green-600 text-green-400\">\n                              <DollarSign className=\"h-3 w-3 mr-1\" />\n                              {asset.price}\n                            </Badge>\n                          )}\n                        </div>\n                        \n                        <p className=\"text-sm text-slate-400\">\n                          {formatFileSize(asset.fileSize)} • {formatDate(asset.createdAt)}\n                        </p>\n                        \n                        <div className=\"flex gap-2 pt-2\">\n                          <Button size=\"sm\" variant=\"outline\" className=\"flex-1\">\n                            <Eye className=\"h-3 w-3 mr-1\" />\n                            View\n                          </Button>\n                          <Button size=\"sm\" variant=\"outline\">\n                            <Edit className=\"h-3 w-3\" />\n                          </Button>\n                          <Button \n                            size=\"sm\" \n                            variant=\"outline\" \n                            className=\"text-red-400 hover:text-red-300\"\n                            onClick={() => deleteMutation.mutate(asset.id)}\n                            disabled={deleteMutation.isPending}\n                          >\n                            <Trash2 className=\"h-3 w-3\" />\n                          </Button>\n                        </div>\n                      </div>\n                    </>\n                  ) : (\n                    <>\n                      {/* List View */}\n                      <div className=\"flex items-center gap-4\">\n                        <div className=\"w-16 h-16 bg-slate-700 rounded-lg flex items-center justify-center flex-shrink-0\">\n                          {asset.mimeType.startsWith('image/') ? (\n                            <Image className=\"h-8 w-8 text-slate-400\" />\n                          ) : (\n                            <Video className=\"h-8 w-8 text-slate-400\" />\n                          )}\n                        </div>\n                        \n                        <div className=\"flex-1 min-w-0\">\n                          <div className=\"flex items-center gap-2 mb-1\">\n                            <h3 className=\"font-medium text-white truncate\">{asset.title}</h3>\n                            {asset.isPremium && <Star className=\"h-4 w-4 text-purple-400\" />}\n                          </div>\n                          <p className=\"text-sm text-slate-400 truncate mb-2\">{asset.description}</p>\n                          <div className=\"flex items-center gap-4 text-sm text-slate-500\">\n                            <span>{formatFileSize(asset.fileSize)}</span>\n                            <span>{formatDate(asset.createdAt)}</span>\n                            {asset.price && (\n                              <span className=\"text-green-400\">${asset.price}</span>\n                            )}\n                          </div>\n                        </div>\n                        \n                        <div className=\"flex items-center gap-4\">\n                          <Badge className={`${getStatusColor(asset.status)} text-white`}>\n                            {getStatusIcon(asset.status)}\n                            <span className=\"ml-1 capitalize\">{asset.status}</span>\n                          </Badge>\n                          \n                          <div className=\"flex gap-2\">\n                            <Button size=\"sm\" variant=\"outline\">\n                              <Eye className=\"h-3 w-3\" />\n                            </Button>\n                            <Button size=\"sm\" variant=\"outline\">\n                              <Edit className=\"h-3 w-3\" />\n                            </Button>\n                            <Button \n                              size=\"sm\" \n                              variant=\"outline\" \n                              className=\"text-red-400 hover:text-red-300\"\n                              onClick={() => deleteMutation.mutate(asset.id)}\n                              disabled={deleteMutation.isPending}\n                            >\n                              <Trash2 className=\"h-3 w-3\" />\n                            </Button>\n                          </div>\n                        </div>\n                      </div>\n                    </>\n                  )}\n                </CardContent>\n              </Card>\n            ))}\n          </div>\n        )}\n      </div>\n    </div>\n  );\n}","size_bytes":17556},"server/auth.ts":{"content":"import bcrypt from \"bcrypt\";\nimport jwt from \"jsonwebtoken\";\nimport { z } from \"zod\";\nimport { storage } from \"./storage\";\nimport { insertUserSchema } from \"@shared/schema\";\nimport crypto from \"crypto\";\nimport { logger } from \"./logger\";\n\nconst JWT_SECRET = process.env.JWT_SECRET || crypto.randomBytes(64).toString('hex');\nconst JWT_EXPIRES_IN = \"7d\";\nconst BCRYPT_ROUNDS = 12;\nconst RESET_TOKEN_EXPIRES_IN = 60 * 60 * 1000; // 1 hour in milliseconds\nconst RECOVERY_TOKEN_EXPIRES_IN = 24 * 60 * 60 * 1000; // 24 hours in milliseconds\n\n// Helper function to hash tokens using SHA-256\nfunction hashToken(token: string): string {\n  return crypto.createHash('sha256').update(token).digest('hex');\n}\n\nif (!process.env.JWT_SECRET && process.env.NODE_ENV === 'production') {\n  console.warn('WARNING: JWT_SECRET not set in production. Using auto-generated secret (sessions will not persist across restarts).');\n}\n\nexport const registerSchema = insertUserSchema.extend({\n  password: z.string().min(8).max(100),\n  confirmPassword: z.string(),\n}).refine((data) => data.password === data.confirmPassword, {\n  message: \"Passwords don't match\",\n  path: [\"confirmPassword\"],\n});\n\nexport const loginSchema = z.object({\n  email: z.string().email(),\n  password: z.string().min(1),\n});\n\nexport const forgotPasswordSchema = z.object({\n  email: z.string().email(),\n});\n\nexport const resetPasswordSchema = z.object({\n  token: z.string().min(1),\n  password: z.string().min(8).max(100),\n  confirmPassword: z.string(),\n}).refine((data) => data.password === data.confirmPassword, {\n  message: \"Passwords don't match\",\n  path: [\"confirmPassword\"],\n});\n\nexport const forgotEmailSchema = z.object({\n  username: z.string().min(3),\n});\n\nexport interface JWTPayload {\n  userId: string;\n  email: string;\n  role: string;\n  iat?: number;\n  exp?: number;\n}\n\nexport class AuthService {\n  async hashPassword(password: string): Promise<string> {\n    return bcrypt.hash(password, BCRYPT_ROUNDS);\n  }\n\n  async verifyPassword(password: string, hash: string): Promise<boolean> {\n    return bcrypt.compare(password, hash);\n  }\n\n  generateToken(payload: Omit<JWTPayload, 'iat' | 'exp'>): string {\n    return jwt.sign(payload, JWT_SECRET, { expiresIn: JWT_EXPIRES_IN });\n  }\n\n  verifyToken(token: string): JWTPayload {\n    return jwt.verify(token, JWT_SECRET) as JWTPayload;\n  }\n\n  async register(userData: z.infer<typeof registerSchema>) {\n    const { confirmPassword, ...userInfo } = userData;\n    \n    // Check if user already exists\n    const existingUser = await storage.getUserByEmail(userInfo.email!);\n    if (existingUser) {\n      throw new Error(\"User already exists\");\n    }\n\n    // Hash password\n    const hashedPassword = await this.hashPassword(userInfo.password!);\n\n    // Create user\n    const user = await storage.createUser({\n      ...userInfo,\n      password: hashedPassword,\n      authProvider: \"local\",\n    });\n\n    // Create profile\n    await storage.createProfile({\n      userId: user.id,\n      displayName: userInfo.username || userInfo.email!.split('@')[0],\n    });\n\n    // Generate token\n    const token = this.generateToken({\n      userId: user.id,\n      email: user.email!,\n      role: user.role!,\n    });\n\n    return { user, token };\n  }\n\n  async login(credentials: z.infer<typeof loginSchema>) {\n    const user = await storage.getUserByEmail(credentials.email);\n    if (!user || !user.password) {\n      throw new Error(\"Invalid credentials\");\n    }\n\n    const isValidPassword = await this.verifyPassword(credentials.password, user.password);\n    if (!isValidPassword) {\n      throw new Error(\"Invalid credentials\");\n    }\n\n    if (user.status !== \"active\") {\n      throw new Error(\"Account is suspended or banned\");\n    }\n\n    const token = this.generateToken({\n      userId: user.id,\n      email: user.email!,\n      role: user.role!,\n    });\n\n    return { user, token };\n  }\n\n  async refreshToken(userId: string): Promise<string> {\n    const user = await storage.getUser(userId);\n    if (!user || user.status !== \"active\") {\n      throw new Error(\"Invalid user\");\n    }\n\n    return this.generateToken({\n      userId: user.id,\n      email: user.email!,\n      role: user.role!,\n    });\n  }\n\n  async requestPasswordReset(email: string): Promise<{ message: string; token?: string }> {\n    const user = await storage.getUserByEmail(email);\n    \n    // For security, always return success even if user doesn't exist\n    // This prevents account enumeration attacks\n    if (!user) {\n      logger.info(`Password reset requested for non-existent email`);\n      return { message: \"If an account with that email exists, a password reset link has been sent.\" };\n    }\n\n    // Generate secure random token (raw token)\n    const rawToken = crypto.randomBytes(32).toString('hex');\n    const tokenHash = hashToken(rawToken);\n    const expiresAt = new Date(Date.now() + RESET_TOKEN_EXPIRES_IN);\n\n    // Invalidate all previous outstanding tokens for this user\n    await storage.invalidatePreviousPasswordResetTokens(user.id);\n\n    // Store hashed token in database\n    await storage.createPasswordResetToken({\n      userId: user.id,\n      token: tokenHash,\n      expiresAt,\n    });\n\n    logger.info(`Password reset token generated for user ${user.id}`);\n    \n    // TODO: Send email with reset link containing rawToken\n    \n    // In development with TEST_MODE enabled, return raw token for testing\n    // NEVER enable this in production\n    if (process.env.NODE_ENV !== 'production' && process.env.TEST_MODE === 'true') {\n      return { \n        message: \"If an account with that email exists, a password reset link has been sent.\",\n        token: rawToken // Only for explicit testing\n      };\n    }\n    \n    return { message: \"If an account with that email exists, a password reset link has been sent.\" };\n  }\n\n  async resetPassword(token: string, newPassword: string): Promise<void> {\n    // Hash the incoming token to match stored hash\n    const tokenHash = hashToken(token);\n    \n    // Atomically redeem the token (checks validity, expiry, and marks as used in one operation)\n    const redemptionResult = await storage.redeemPasswordResetToken(tokenHash);\n    \n    if (!redemptionResult) {\n      throw new Error(\"Invalid or expired reset token\");\n    }\n\n    // Hash new password\n    const hashedPassword = await this.hashPassword(newPassword);\n\n    // Update user password\n    await storage.updateUserPassword(redemptionResult.userId, hashedPassword);\n\n    logger.info(`Password reset successful for user ${redemptionResult.userId}`);\n  }\n\n  async requestEmailRecovery(username: string): Promise<{ message: string; email?: string }> {\n    const user = await storage.getUserByUsername(username);\n    \n    // For security, always return success\n    if (!user || !user.email) {\n      logger.info(`Email recovery requested for non-existent username`);\n      return { message: \"If an account with that username exists, recovery information has been sent.\" };\n    }\n\n    // Generate secure random token (raw token)\n    const rawToken = crypto.randomBytes(32).toString('hex');\n    const tokenHash = hashToken(rawToken);\n    const expiresAt = new Date(Date.now() + RECOVERY_TOKEN_EXPIRES_IN);\n\n    // Invalidate all previous outstanding tokens for this user\n    await storage.invalidatePreviousEmailRecoveryTokens(user.id);\n\n    // Store hashed token in database\n    await storage.createEmailRecoveryToken({\n      userId: user.id,\n      token: tokenHash,\n      expiresAt,\n    });\n\n    // Mask email for security (show first 2 chars and domain)\n    const maskedEmail = this.maskEmail(user.email);\n    \n    logger.info(`Email recovery initiated for user ${user.id}`);\n    \n    // In development with TEST_MODE enabled, return actual email for testing\n    // NEVER enable this in production\n    if (process.env.NODE_ENV !== 'production' && process.env.TEST_MODE === 'true') {\n      return { \n        message: `A recovery code has been generated. Your email is: ${maskedEmail}`,\n        email: user.email // Only for explicit testing\n      };\n    }\n    \n    return { message: `A recovery code has been generated. Your email is: ${maskedEmail}` };\n  }\n\n  private maskEmail(email: string): string {\n    const [local, domain] = email.split('@');\n    if (local.length <= 2) {\n      return `${local[0]}***@${domain}`;\n    }\n    return `${local.substring(0, 2)}***@${domain}`;\n  }\n}\n\nexport const authService = new AuthService();\n","size_bytes":8387},"client/src/pages/OnboardingComplete.tsx":{"content":"import { useEffect, useState } from \"react\";\nimport { useLocation } from \"wouter\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent } from \"@/components/ui/card\";\nimport { Sparkles, Rocket } from \"lucide-react\";\nimport confetti from \"canvas-confetti\";\n\nexport default function OnboardingComplete() {\n  const [, setLocation] = useLocation();\n  const [showContent, setShowContent] = useState(false);\n\n  const { data: user } = useQuery<any>({\n    queryKey: [\"/api/auth/user\"],\n  });\n\n  const isCreator = user?.role === \"creator\";\n\n  useEffect(() => {\n    // Celebration animation\n    const duration = 3000;\n    const animationEnd = Date.now() + duration;\n    const defaults = { startVelocity: 30, spread: 360, ticks: 60, zIndex: 0 };\n\n    function randomInRange(min: number, max: number) {\n      return Math.random() * (max - min) + min;\n    }\n\n    const interval = setInterval(function() {\n      const timeLeft = animationEnd - Date.now();\n\n      if (timeLeft <= 0) {\n        clearInterval(interval);\n        setShowContent(true);\n        return;\n      }\n\n      const particleCount = 50 * (timeLeft / duration);\n      confetti({\n        ...defaults,\n        particleCount,\n        origin: { x: randomInRange(0.1, 0.3), y: Math.random() - 0.2 }\n      });\n      confetti({\n        ...defaults,\n        particleCount,\n        origin: { x: randomInRange(0.7, 0.9), y: Math.random() - 0.2 }\n      });\n    }, 250);\n\n    return () => clearInterval(interval);\n  }, []);\n\n  const handleGetStarted = () => {\n    if (isCreator) {\n      setLocation(\"/\");\n    } else {\n      setLocation(\"/feed\");\n    }\n  };\n\n  return (\n    <div className=\"min-h-screen bg-gradient-to-br from-black via-gray-900 to-black flex items-center justify-center p-4 sm:p-6 lg:p-8\">\n      <Card className=\"max-w-2xl w-full border-2 border-cyan-500/30 bg-black/40 backdrop-blur text-center\">\n        <CardContent className=\"pt-8 sm:pt-10 lg:pt-12 pb-8 sm:pb-10 lg:pb-12 px-4 sm:px-6 space-y-6 sm:space-y-8\">\n          <div className=\"relative\">\n            <div className=\"absolute inset-0 flex items-center justify-center\">\n              <div className=\"w-24 h-24 sm:w-28 sm:h-28 lg:w-32 lg:h-32 bg-gradient-to-br from-cyan-500/20 to-blue-600/20 rounded-full animate-pulse\" />\n            </div>\n            <div className=\"relative flex items-center justify-center\">\n              <div className=\"w-20 h-20 sm:w-[88px] sm:h-[88px] lg:w-24 lg:h-24 bg-gradient-to-br from-cyan-500 to-blue-600 rounded-full flex items-center justify-center\">\n                {isCreator ? (\n                  <Sparkles className=\"w-10 h-10 sm:w-11 sm:h-11 lg:w-12 lg:h-12 text-white\" />\n                ) : (\n                  <Rocket className=\"w-10 h-10 sm:w-11 sm:h-11 lg:w-12 lg:h-12 text-white\" />\n                )}\n              </div>\n            </div>\n          </div>\n\n          <div className=\"space-y-3 sm:space-y-4\">\n            <h1 className=\"text-3xl sm:text-4xl lg:text-5xl font-bold bg-gradient-to-r from-cyan-400 to-blue-500 bg-clip-text text-transparent animate-fade-in px-2\">\n              {isCreator ? \"You're All Set, Star! ⭐\" : \"Welcome to the Fanz Family! 🎉\"}\n            </h1>\n            <p className=\"text-base sm:text-lg lg:text-xl text-gray-300 px-2\">\n              {isCreator\n                ? \"Your creator profile is ready. Time to shine!\"\n                : \"Your profile is ready. Let's discover amazing creators!\"}\n            </p>\n          </div>\n\n          <div className=\"bg-gradient-to-r from-cyan-500/10 to-blue-600/10 border border-cyan-500/30 rounded-lg p-4 sm:p-5 lg:p-6 space-y-3 sm:space-y-4\">\n            <h2 className=\"text-lg sm:text-xl font-semibold text-white\">What's Next?</h2>\n            <div className=\"text-left space-y-2.5 sm:space-y-3 text-sm sm:text-base text-gray-300\">\n              {isCreator ? (\n                <>\n                  <div className=\"flex items-start gap-2 sm:gap-3\">\n                    <span className=\"text-cyan-400 font-bold flex-shrink-0\">1.</span>\n                    <span>Upload your first content and start building your fanbase</span>\n                  </div>\n                  <div className=\"flex items-start gap-2 sm:gap-3\">\n                    <span className=\"text-cyan-400 font-bold flex-shrink-0\">2.</span>\n                    <span>Customize your subscription tiers and pricing</span>\n                  </div>\n                  <div className=\"flex items-start gap-2 sm:gap-3\">\n                    <span className=\"text-cyan-400 font-bold flex-shrink-0\">3.</span>\n                    <span>Engage with your fans through messages and live streams</span>\n                  </div>\n                  <div className=\"flex items-start gap-2 sm:gap-3\">\n                    <span className=\"text-cyan-400 font-bold flex-shrink-0\">4.</span>\n                    <span>Track your earnings and analytics in real-time</span>\n                  </div>\n                </>\n              ) : (\n                <>\n                  <div className=\"flex items-start gap-2 sm:gap-3\">\n                    <span className=\"text-purple-400 font-bold flex-shrink-0\">1.</span>\n                    <span>Browse and discover creators in your favorite niches</span>\n                  </div>\n                  <div className=\"flex items-start gap-2 sm:gap-3\">\n                    <span className=\"text-purple-400 font-bold flex-shrink-0\">2.</span>\n                    <span>Follow creators to get updates on their latest content</span>\n                  </div>\n                  <div className=\"flex items-start gap-2 sm:gap-3\">\n                    <span className=\"text-purple-400 font-bold flex-shrink-0\">3.</span>\n                    <span>Subscribe to unlock exclusive content and perks</span>\n                  </div>\n                  <div className=\"flex items-start gap-2 sm:gap-3\">\n                    <span className=\"text-purple-400 font-bold flex-shrink-0\">4.</span>\n                    <span>Interact directly with your favorite stars</span>\n                  </div>\n                </>\n              )}\n            </div>\n          </div>\n\n          <Button\n            onClick={handleGetStarted}\n            size=\"lg\"\n            className=\"w-full max-w-md mx-auto bg-gradient-to-r from-cyan-500 to-blue-600 hover:from-cyan-600 hover:to-blue-700 text-white font-bold py-4 sm:py-5 lg:py-6 text-base sm:text-lg h-auto\"\n            data-testid=\"button-get-started\"\n          >\n            {isCreator ? \"Go to Dashboard\" : \"Start Exploring\"}\n          </Button>\n\n          <p className=\"text-xs sm:text-sm text-gray-500 px-2\">\n            {isCreator\n              ? \"Remember: You keep 100% of your earnings!\"\n              : \"Tip: You can upgrade to Creator anytime in Settings\"}\n          </p>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","size_bytes":6850},"client/src/components/ui/table.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Table = React.forwardRef<\n  HTMLTableElement,\n  React.HTMLAttributes<HTMLTableElement>\n>(({ className, ...props }, ref) => (\n  <div className=\"relative w-full overflow-auto\">\n    <table\n      ref={ref}\n      className={cn(\"w-full caption-bottom text-sm\", className)}\n      {...props}\n    />\n  </div>\n))\nTable.displayName = \"Table\"\n\nconst TableHeader = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <thead ref={ref} className={cn(\"[&_tr]:border-b\", className)} {...props} />\n))\nTableHeader.displayName = \"TableHeader\"\n\nconst TableBody = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <tbody\n    ref={ref}\n    className={cn(\"[&_tr:last-child]:border-0\", className)}\n    {...props}\n  />\n))\nTableBody.displayName = \"TableBody\"\n\nconst TableFooter = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <tfoot\n    ref={ref}\n    className={cn(\n      \"border-t bg-muted/50 font-medium [&>tr]:last:border-b-0\",\n      className\n    )}\n    {...props}\n  />\n))\nTableFooter.displayName = \"TableFooter\"\n\nconst TableRow = React.forwardRef<\n  HTMLTableRowElement,\n  React.HTMLAttributes<HTMLTableRowElement>\n>(({ className, ...props }, ref) => (\n  <tr\n    ref={ref}\n    className={cn(\n      \"border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted\",\n      className\n    )}\n    {...props}\n  />\n))\nTableRow.displayName = \"TableRow\"\n\nconst TableHead = React.forwardRef<\n  HTMLTableCellElement,\n  React.ThHTMLAttributes<HTMLTableCellElement>\n>(({ className, ...props }, ref) => (\n  <th\n    ref={ref}\n    className={cn(\n      \"h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0\",\n      className\n    )}\n    {...props}\n  />\n))\nTableHead.displayName = \"TableHead\"\n\nconst TableCell = React.forwardRef<\n  HTMLTableCellElement,\n  React.TdHTMLAttributes<HTMLTableCellElement>\n>(({ className, ...props }, ref) => (\n  <td\n    ref={ref}\n    className={cn(\"p-4 align-middle [&:has([role=checkbox])]:pr-0\", className)}\n    {...props}\n  />\n))\nTableCell.displayName = \"TableCell\"\n\nconst TableCaption = React.forwardRef<\n  HTMLTableCaptionElement,\n  React.HTMLAttributes<HTMLTableCaptionElement>\n>(({ className, ...props }, ref) => (\n  <caption\n    ref={ref}\n    className={cn(\"mt-4 text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nTableCaption.displayName = \"TableCaption\"\n\nexport {\n  Table,\n  TableHeader,\n  TableBody,\n  TableFooter,\n  TableHead,\n  TableRow,\n  TableCell,\n  TableCaption,\n}\n","size_bytes":2765},"client/src/hooks/useWebSocket.ts":{"content":"import { useEffect, useRef, useState, useCallback } from \"react\";\nimport { logger } from \"@/lib/logger\";\n\ninterface WebSocketMessage {\n  type: string;\n  data?: any;\n  timestamp?: number;\n}\n\ninterface UseWebSocketOptions {\n  onMessage?: (message: WebSocketMessage) => void;\n  onConnect?: () => void;\n  onDisconnect?: () => void;\n  onError?: (error: Event) => void;\n  reconnectInterval?: number;\n  maxReconnectAttempts?: number;\n}\n\nexport function useWebSocket(options: UseWebSocketOptions = {}) {\n  const {\n    onMessage,\n    onConnect,\n    onDisconnect,\n    onError,\n    reconnectInterval = 3000,\n    maxReconnectAttempts = 10,\n  } = options;\n\n  const [isConnected, setIsConnected] = useState(false);\n  const [connectionStatus, setConnectionStatus] = useState<\"connecting\" | \"connected\" | \"disconnected\" | \"error\">(\"disconnected\");\n  const [lastMessage, setLastMessage] = useState<WebSocketMessage | null>(null);\n  \n  const ws = useRef<WebSocket | null>(null);\n  const reconnectAttempts = useRef(0);\n  const reconnectTimeoutId = useRef<NodeJS.Timeout | null>(null);\n\n  const connect = useCallback(() => {\n    if (ws.current?.readyState === WebSocket.OPEN) {\n      return;\n    }\n\n    try {\n      setConnectionStatus(\"connecting\");\n      \n      const protocol = window.location.protocol === \"https:\" ? \"wss:\" : \"ws:\";\n      const wsUrl = `${protocol}//${window.location.host}/ws`;\n      \n      ws.current = new WebSocket(wsUrl);\n\n      ws.current.onopen = () => {\n        setIsConnected(true);\n        setConnectionStatus(\"connected\");\n        reconnectAttempts.current = 0;\n        onConnect?.();\n        console.log(\"WebSocket connected to DaddyFanz server\");\n      };\n\n      ws.current.onmessage = (event) => {\n        try {\n          const message: WebSocketMessage = JSON.parse(event.data);\n          setLastMessage(message);\n          onMessage?.(message);\n        } catch (error) {\n          console.error(\"Failed to parse WebSocket message:\", error);\n        }\n      };\n\n      ws.current.onclose = () => {\n        setIsConnected(false);\n        setConnectionStatus(\"disconnected\");\n        onDisconnect?.();\n        \n        // Attempt reconnection if not explicitly closed\n        if (reconnectAttempts.current < maxReconnectAttempts) {\n          reconnectAttempts.current++;\n          console.log(`WebSocket disconnected. Reconnecting... (${reconnectAttempts.current}/${maxReconnectAttempts})`);\n          \n          reconnectTimeoutId.current = setTimeout(() => {\n            connect();\n          }, reconnectInterval);\n        } else {\n          console.error(\"Max reconnection attempts reached\");\n          setConnectionStatus(\"error\");\n        }\n      };\n\n      ws.current.onerror = (error) => {\n        console.error(\"WebSocket error:\", error);\n        setConnectionStatus(\"error\");\n        onError?.(error);\n      };\n    } catch (error) {\n      console.error(\"Failed to create WebSocket connection:\", error);\n      setConnectionStatus(\"error\");\n    }\n  }, [onMessage, onConnect, onDisconnect, onError, reconnectInterval, maxReconnectAttempts]);\n\n  const disconnect = useCallback(() => {\n    if (reconnectTimeoutId.current) {\n      clearTimeout(reconnectTimeoutId.current);\n      reconnectTimeoutId.current = null;\n    }\n    \n    if (ws.current) {\n      ws.current.close();\n      ws.current = null;\n    }\n    \n    setIsConnected(false);\n    setConnectionStatus(\"disconnected\");\n  }, []);\n\n  const sendMessage = useCallback((message: WebSocketMessage) => {\n    if (ws.current?.readyState === WebSocket.OPEN) {\n      ws.current.send(JSON.stringify(message));\n      return true;\n    } else {\n      console.warn(\"WebSocket is not connected. Message not sent:\", message);\n      return false;\n    }\n  }, []);\n\n  const sendPing = useCallback(() => {\n    return sendMessage({ type: \"ping\", timestamp: Date.now() });\n  }, [sendMessage]);\n\n  const subscribe = useCallback((room: string) => {\n    return sendMessage({ type: \"subscribe\", data: { room } });\n  }, [sendMessage]);\n\n  useEffect(() => {\n    connect();\n    \n    return () => {\n      disconnect();\n    };\n  }, [connect, disconnect]);\n\n  // Ping server every 30 seconds to keep connection alive\n  useEffect(() => {\n    if (!isConnected) return;\n\n    const pingInterval = setInterval(() => {\n      sendPing();\n    }, 30000);\n\n    return () => clearInterval(pingInterval);\n  }, [isConnected, sendPing]);\n\n  return {\n    isConnected,\n    connectionStatus,\n    lastMessage,\n    sendMessage,\n    sendPing,\n    subscribe,\n    connect,\n    disconnect,\n  };\n}\n\n// Custom hook for handling real-time messages\nexport function useRealTimeMessages(userId?: string) {\n  const [messages, setMessages] = useState<any[]>([]);\n  const [onlineUsers, setOnlineUsers] = useState<string[]>([]);\n\n  const handleMessage = useCallback((message: WebSocketMessage) => {\n    switch (message.type) {\n      case \"new_message\":\n        setMessages(prev => [...prev, message.data]);\n        break;\n      case \"user_online\":\n        setOnlineUsers(prev => [...new Set([...prev, message.data.userId])]);\n        break;\n      case \"user_offline\":\n        setOnlineUsers(prev => prev.filter(id => id !== message.data.userId));\n        break;\n      case \"typing\":\n        // Handle typing indicators\n        break;\n    }\n  }, []);\n\n  const {\n    isConnected,\n    connectionStatus,\n    sendMessage,\n    subscribe,\n  } = useWebSocket({\n    onMessage: handleMessage,\n    onConnect: () => {\n      if (userId) {\n        subscribe(`user:${userId}`);\n      }\n    },\n  });\n\n  const sendChatMessage = useCallback((recipientId: string, content: string) => {\n    return sendMessage({\n      type: \"message\",\n      data: {\n        recipientId,\n        content,\n        timestamp: Date.now(),\n      },\n    });\n  }, [sendMessage]);\n\n  const sendTypingIndicator = useCallback((recipientId: string, isTyping: boolean) => {\n    return sendMessage({\n      type: \"typing\",\n      data: {\n        recipientId,\n        isTyping,\n        timestamp: Date.now(),\n      },\n    });\n  }, [sendMessage]);\n\n  return {\n    isConnected,\n    connectionStatus,\n    messages,\n    onlineUsers,\n    sendChatMessage,\n    sendTypingIndicator,\n  };\n}\n","size_bytes":6134},"client/src/components/ui/toast.tsx":{"content":"import * as React from \"react\"\nimport * as ToastPrimitives from \"@radix-ui/react-toast\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ToastProvider = ToastPrimitives.Provider\n\nconst ToastViewport = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Viewport>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Viewport>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Viewport\n    ref={ref}\n    className={cn(\n      \"fixed top-0 z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:right-0 sm:top-auto sm:flex-col md:max-w-[420px]\",\n      className\n    )}\n    {...props}\n  />\n))\nToastViewport.displayName = ToastPrimitives.Viewport.displayName\n\nconst toastVariants = cva(\n  \"group pointer-events-auto relative flex w-full items-center justify-between space-x-4 overflow-hidden rounded-md border p-6 pr-8 shadow-lg transition-all data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-right-full data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full\",\n  {\n    variants: {\n      variant: {\n        default: \"border bg-background text-foreground\",\n        destructive:\n          \"destructive group border-destructive bg-destructive text-destructive-foreground\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nconst Toast = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Root>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Root> &\n    VariantProps<typeof toastVariants>\n>(({ className, variant, ...props }, ref) => {\n  return (\n    <ToastPrimitives.Root\n      ref={ref}\n      className={cn(toastVariants({ variant }), className)}\n      {...props}\n    />\n  )\n})\nToast.displayName = ToastPrimitives.Root.displayName\n\nconst ToastAction = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Action>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Action>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Action\n    ref={ref}\n    className={cn(\n      \"inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium ring-offset-background transition-colors hover:bg-secondary focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 group-[.destructive]:border-muted/40 group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground group-[.destructive]:focus:ring-destructive\",\n      className\n    )}\n    {...props}\n  />\n))\nToastAction.displayName = ToastPrimitives.Action.displayName\n\nconst ToastClose = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Close>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Close>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Close\n    ref={ref}\n    className={cn(\n      \"absolute right-2 top-2 rounded-md p-1 text-foreground/50 opacity-0 transition-opacity hover:text-foreground focus:opacity-100 focus:outline-none focus:ring-2 group-hover:opacity-100 group-[.destructive]:text-red-300 group-[.destructive]:hover:text-red-50 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600\",\n      className\n    )}\n    toast-close=\"\"\n    {...props}\n  >\n    <X className=\"h-4 w-4\" />\n  </ToastPrimitives.Close>\n))\nToastClose.displayName = ToastPrimitives.Close.displayName\n\nconst ToastTitle = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Title>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Title>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Title\n    ref={ref}\n    className={cn(\"text-sm font-semibold\", className)}\n    {...props}\n  />\n))\nToastTitle.displayName = ToastPrimitives.Title.displayName\n\nconst ToastDescription = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Description>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Description>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Description\n    ref={ref}\n    className={cn(\"text-sm opacity-90\", className)}\n    {...props}\n  />\n))\nToastDescription.displayName = ToastPrimitives.Description.displayName\n\ntype ToastProps = React.ComponentPropsWithoutRef<typeof Toast>\n\ntype ToastActionElement = React.ReactElement<typeof ToastAction>\n\nexport {\n  type ToastProps,\n  type ToastActionElement,\n  ToastProvider,\n  ToastViewport,\n  Toast,\n  ToastTitle,\n  ToastDescription,\n  ToastClose,\n  ToastAction,\n}\n","size_bytes":4845},"server/vite.ts":{"content":"import express, { type Express } from \"express\";\nimport fs from \"fs\";\nimport path from \"path\";\nimport { createServer as createViteServer, createLogger } from \"vite\";\nimport { type Server } from \"http\";\nimport viteConfig from \"../vite.config\";\nimport { nanoid } from \"nanoid\";\n\nconst viteLogger = createLogger();\n\nexport function log(message: string, source = \"express\") {\n  const formattedTime = new Date().toLocaleTimeString(\"en-US\", {\n    hour: \"numeric\",\n    minute: \"2-digit\",\n    second: \"2-digit\",\n    hour12: true,\n  });\n\n  console.log(`${formattedTime} [${source}] ${message}`);\n}\n\nexport async function setupVite(app: Express, server: Server) {\n  const serverOptions = {\n    middlewareMode: true,\n    hmr: { server },\n    allowedHosts: true as const,\n  };\n\n  const vite = await createViteServer({\n    ...viteConfig,\n    configFile: false,\n    customLogger: {\n      ...viteLogger,\n      error: (msg, options) => {\n        viteLogger.error(msg, options);\n        process.exit(1);\n      },\n    },\n    server: serverOptions,\n    appType: \"custom\",\n  });\n\n  app.use(vite.middlewares);\n  app.use(\"*\", async (req, res, next) => {\n    const url = req.originalUrl;\n\n    try {\n      const clientTemplate = path.resolve(\n        import.meta.dirname,\n        \"..\",\n        \"client\",\n        \"index.html\",\n      );\n\n      // always reload the index.html file from disk incase it changes\n      let template = await fs.promises.readFile(clientTemplate, \"utf-8\");\n      template = template.replace(\n        `src=\"/src/main.tsx\"`,\n        `src=\"/src/main.tsx?v=${nanoid()}\"`,\n      );\n      const page = await vite.transformIndexHtml(url, template);\n      res.status(200).set({ \"Content-Type\": \"text/html\" }).end(page);\n    } catch (e) {\n      vite.ssrFixStacktrace(e as Error);\n      next(e);\n    }\n  });\n}\n\nexport function serveStatic(app: Express) {\n  const distPath = path.resolve(import.meta.dirname, \"public\");\n\n  if (!fs.existsSync(distPath)) {\n    throw new Error(\n      `Could not find the build directory: ${distPath}, make sure to build the client first`,\n    );\n  }\n\n  app.use(express.static(distPath));\n\n  // fall through to index.html if the file doesn't exist\n  app.use(\"*\", (_req, res) => {\n    res.sendFile(path.resolve(distPath, \"index.html\"));\n  });\n}\n","size_bytes":2263},"client/src/components/ui/menubar.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as MenubarPrimitive from \"@radix-ui/react-menubar\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nfunction MenubarMenu({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Menu>) {\n  return <MenubarPrimitive.Menu {...props} />\n}\n\nfunction MenubarGroup({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Group>) {\n  return <MenubarPrimitive.Group {...props} />\n}\n\nfunction MenubarPortal({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Portal>) {\n  return <MenubarPrimitive.Portal {...props} />\n}\n\nfunction MenubarRadioGroup({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.RadioGroup>) {\n  return <MenubarPrimitive.RadioGroup {...props} />\n}\n\nfunction MenubarSub({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Sub>) {\n  return <MenubarPrimitive.Sub data-slot=\"menubar-sub\" {...props} />\n}\n\nconst Menubar = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"flex h-10 items-center space-x-1 rounded-md border bg-background p-1\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubar.displayName = MenubarPrimitive.Root.displayName\n\nconst MenubarTrigger = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Trigger>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-3 py-1.5 text-sm font-medium outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarTrigger.displayName = MenubarPrimitive.Trigger.displayName\n\nconst MenubarSubTrigger = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <MenubarPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto h-4 w-4\" />\n  </MenubarPrimitive.SubTrigger>\n))\nMenubarSubTrigger.displayName = MenubarPrimitive.SubTrigger.displayName\n\nconst MenubarSubContent = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-menubar-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarSubContent.displayName = MenubarPrimitive.SubContent.displayName\n\nconst MenubarContent = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Content>\n>(\n  (\n    { className, align = \"start\", alignOffset = -4, sideOffset = 8, ...props },\n    ref\n  ) => (\n    <MenubarPrimitive.Portal>\n      <MenubarPrimitive.Content\n        ref={ref}\n        align={align}\n        alignOffset={alignOffset}\n        sideOffset={sideOffset}\n        className={cn(\n          \"z-50 min-w-[12rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-menubar-content-transform-origin]\",\n          className\n        )}\n        {...props}\n      />\n    </MenubarPrimitive.Portal>\n  )\n)\nMenubarContent.displayName = MenubarPrimitive.Content.displayName\n\nconst MenubarItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <MenubarPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarItem.displayName = MenubarPrimitive.Item.displayName\n\nconst MenubarCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <MenubarPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <MenubarPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </MenubarPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </MenubarPrimitive.CheckboxItem>\n))\nMenubarCheckboxItem.displayName = MenubarPrimitive.CheckboxItem.displayName\n\nconst MenubarRadioItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <MenubarPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <MenubarPrimitive.ItemIndicator>\n        <Circle className=\"h-2 w-2 fill-current\" />\n      </MenubarPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </MenubarPrimitive.RadioItem>\n))\nMenubarRadioItem.displayName = MenubarPrimitive.RadioItem.displayName\n\nconst MenubarLabel = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <MenubarPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarLabel.displayName = MenubarPrimitive.Label.displayName\n\nconst MenubarSeparator = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nMenubarSeparator.displayName = MenubarPrimitive.Separator.displayName\n\nconst MenubarShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nMenubarShortcut.displayname = \"MenubarShortcut\"\n\nexport {\n  Menubar,\n  MenubarMenu,\n  MenubarTrigger,\n  MenubarContent,\n  MenubarItem,\n  MenubarSeparator,\n  MenubarLabel,\n  MenubarCheckboxItem,\n  MenubarRadioGroup,\n  MenubarRadioItem,\n  MenubarPortal,\n  MenubarSubContent,\n  MenubarSubTrigger,\n  MenubarGroup,\n  MenubarSub,\n  MenubarShortcut,\n}\n","size_bytes":8605},"client/src/components/feed/FanzInfinityScrollFeed.tsx":{"content":"import { useEffect, useRef, useState, useCallback } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { queryClient, apiRequest } from \"@/lib/queryClient\";\nimport { useAuth } from \"@/hooks/useAuth\";\nimport { Card, CardContent, CardHeader } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Avatar, AvatarFallback, AvatarImage } from \"@/components/ui/avatar\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Dialog, DialogContent, DialogDescription, DialogHeader, DialogTitle, DialogTrigger } from \"@/components/ui/dialog\";\nimport { ScrollArea } from \"@/components/ui/scroll-area\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { Heart, MessageCircle, Share2, UserPlus, UserMinus, Lock, Send } from \"lucide-react\";\n\ninterface Post {\n  id: string;\n  creatorId: string;\n  text: string | null;\n  mediaUrl: string | null;\n  mediaType: string | null;\n  mediaAssetId: string | null;\n  isFree: boolean;\n  creatorAllowsFree: boolean;\n  creatorIsAgeVerified: boolean;\n  requiresSubscription: boolean;\n  requiresAgeVerification: boolean;\n  viewCount: number;\n  likeCount: number;\n  commentCount: number;\n  createdAt: string;\n  updatedAt: string;\n}\n\ninterface FeedPost extends Post {\n  creator: {\n    id: string;\n    username: string | null;\n    email: string | null;\n    profileImageUrl: string | null;\n    displayName: string | null;\n  };\n  isFollowing: boolean;\n}\n\ninterface PostComment {\n  id: string;\n  postId: string;\n  userId: string;\n  text: string;\n  createdAt: string;\n  updatedAt: string;\n}\n\ninterface FanzInfinityScrollFeedProps {\n  adInterval?: number; // Insert ad every N posts\n}\n\nexport default function FanzInfinityScrollFeed({ adInterval = 5 }: FanzInfinityScrollFeedProps) {\n  const { user, isAuthenticated } = useAuth();\n  const { toast } = useToast();\n  const [page, setPage] = useState(1);\n  const [allPosts, setAllPosts] = useState<FeedPost[]>([]);\n  const [hasMore, setHasMore] = useState(true);\n  const observerTarget = useRef<HTMLDivElement>(null);\n  const [ageVerifiedPosts, setAgeVerifiedPosts] = useState<Set<string>>(new Set());\n  const [selectedPostId, setSelectedPostId] = useState<string | null>(null);\n  const [commentText, setCommentText] = useState(\"\");\n\n  const limit = 20;\n\n  const { data, isLoading, isFetching } = useQuery<FeedPost[]>({\n    queryKey: [`/api/feed?page=${page}&limit=${limit}`],\n    staleTime: 30000,\n  });\n\n  // Append new posts when data arrives\n  useEffect(() => {\n    if (data) {\n      if (data.length < limit) {\n        setHasMore(false);\n      }\n      setAllPosts((prev) => {\n        const existingIds = new Set(prev.map((p) => p.id));\n        const newPosts = data.filter((p) => !existingIds.has(p.id));\n        return [...prev, ...newPosts];\n      });\n    }\n  }, [data, limit]);\n\n  // Intersection observer for infinite scroll\n  useEffect(() => {\n    const observer = new IntersectionObserver(\n      (entries) => {\n        if (entries[0].isIntersecting && hasMore && !isFetching) {\n          setPage((prev) => prev + 1);\n        }\n      },\n      { threshold: 0.5 }\n    );\n\n    const currentTarget = observerTarget.current;\n    if (currentTarget) {\n      observer.observe(currentTarget);\n    }\n\n    return () => {\n      if (currentTarget) {\n        observer.unobserve(currentTarget);\n      }\n    };\n  }, [hasMore, isFetching]);\n\n  // Follow/unfollow mutation\n  const followMutation = useMutation({\n    mutationFn: async ({ creatorId, isFollowing }: { creatorId: string; isFollowing: boolean }) => {\n      if (isFollowing) {\n        return apiRequest(\"DELETE\", `/api/follow/${creatorId}`);\n      } else {\n        return apiRequest(\"POST\", `/api/follow/${creatorId}`);\n      }\n    },\n    onSuccess: (_, variables) => {\n      setAllPosts((prev) =>\n        prev.map((post) =>\n          post.creatorId === variables.creatorId\n            ? { ...post, isFollowing: !variables.isFollowing }\n            : post\n        )\n      );\n      queryClient.invalidateQueries({ queryKey: [\"/api/following\"] });\n      toast({\n        title: variables.isFollowing ? \"Unfollowed\" : \"Followed\",\n        description: variables.isFollowing\n          ? \"You've unfollowed this creator\"\n          : \"You're now following this creator\",\n      });\n    },\n    onError: () => {\n      toast({\n        title: \"Error\",\n        description: \"Failed to update follow status\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const handleFollow = (creatorId: string, isFollowing: boolean) => {\n    if (!isAuthenticated) {\n      toast({\n        title: \"Login Required\",\n        description: \"Please log in to follow creators\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n    followMutation.mutate({ creatorId, isFollowing });\n  };\n\n  // Like mutation\n  const likeMutation = useMutation({\n    mutationFn: async (postId: string) => {\n      const response = await apiRequest(`/api/posts/${postId}/like`, {\n        method: \"POST\",\n      });\n      return response as { liked: boolean };\n    },\n    onSuccess: (data, postId) => {\n      // Update the post's like count optimistically\n      setAllPosts((prev) =>\n        prev.map((post) =>\n          post.id === postId\n            ? { ...post, likeCount: data.liked ? post.likeCount + 1 : post.likeCount - 1 }\n            : post\n        )\n      );\n    },\n    onError: () => {\n      toast({\n        title: \"Error\",\n        description: \"Failed to update like\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const handleLike = (postId: string) => {\n    if (!isAuthenticated) {\n      toast({\n        title: \"Login Required\",\n        description: \"Please log in to like posts\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n    likeMutation.mutate(postId);\n  };\n\n  // Comments query\n  const { data: comments, refetch: refetchComments } = useQuery<PostComment[]>({\n    queryKey: [\"/api/posts\", selectedPostId, \"comments\"],\n    enabled: !!selectedPostId,\n  });\n\n  // Comment mutation\n  const commentMutation = useMutation({\n    mutationFn: async ({ postId, text }: { postId: string; text: string }) => {\n      const response = await apiRequest(`/api/posts/${postId}/comments`, {\n        method: \"POST\",\n        body: { text },\n      });\n      return response as PostComment;\n    },\n    onSuccess: (_, variables) => {\n      setCommentText(\"\");\n      refetchComments();\n      // Update comment count\n      setAllPosts((prev) =>\n        prev.map((post) =>\n          post.id === variables.postId\n            ? { ...post, commentCount: post.commentCount + 1 }\n            : post\n        )\n      );\n      toast({\n        title: \"Comment posted\",\n        description: \"Your comment has been added\",\n      });\n    },\n    onError: () => {\n      toast({\n        title: \"Error\",\n        description: \"Failed to post comment\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const handleComment = () => {\n    if (!selectedPostId || !commentText.trim()) return;\n    commentMutation.mutate({\n      postId: selectedPostId,\n      text: commentText,\n    });\n  };\n\n  const handleAgeVerify = (postId: string) => {\n    setAgeVerifiedPosts((prev) => new Set([...prev, postId]));\n  };\n\n  const renderPost = (post: FeedPost, index: number) => {\n    const isOwnPost = user?.id === post.creatorId;\n    const needsAgeVerification = post.requiresAgeVerification && !ageVerifiedPosts.has(post.id);\n    const isBlurred = needsAgeVerification && !isOwnPost;\n\n    return (\n      <Card key={post.id} className=\"card-df mb-4\" data-testid={`card-post-${post.id}`}>\n        <CardHeader className=\"pb-4\">\n          <div className=\"flex items-center justify-between\">\n            <div className=\"flex items-center gap-3\">\n              <Avatar className=\"border-2 border-df-cyan\">\n                <AvatarImage src={post.creator.profileImageUrl || undefined} />\n                <AvatarFallback className=\"bg-df-ink text-df-cyan\">\n                  {post.creator.displayName?.[0] || post.creator.username?.[0] || \"?\"}\n                </AvatarFallback>\n              </Avatar>\n              <div>\n                <h3 className=\"text-df-snow font-semibold\" data-testid={`text-creator-name-${post.id}`}>\n                  {post.creator.displayName || post.creator.username || \"Anonymous\"}\n                </h3>\n                <p className=\"text-df-fog text-sm\">\n                  {new Date(post.createdAt).toLocaleDateString()}\n                </p>\n              </div>\n            </div>\n            {!isOwnPost && (\n              <Button\n                variant=\"outline\"\n                size=\"sm\"\n                className={post.isFollowing ? \"btn-secondary\" : \"btn-primary\"}\n                onClick={() => handleFollow(post.creatorId, post.isFollowing)}\n                disabled={followMutation.isPending}\n                data-testid={`button-follow-${post.id}`}\n              >\n                {post.isFollowing ? (\n                  <>\n                    <UserMinus className=\"h-4 w-4 mr-1\" />\n                    Unfollow\n                  </>\n                ) : (\n                  <>\n                    <UserPlus className=\"h-4 w-4 mr-1\" />\n                    Follow\n                  </>\n                )}\n              </Button>\n            )}\n          </div>\n        </CardHeader>\n        <CardContent>\n          {/* Post Text */}\n          {post.text && (\n            <p className=\"text-df-snow mb-4 whitespace-pre-wrap\" data-testid={`text-post-content-${post.id}`}>\n              {post.text}\n            </p>\n          )}\n\n          {/* Post Media */}\n          {post.mediaUrl && (\n            <div className=\"relative rounded-lg overflow-hidden mb-4 bg-df-ink\">\n              {isBlurred ? (\n                <div className=\"relative\">\n                  <div className=\"aspect-video w-full bg-df-ink border border-df-steel flex items-center justify-center backdrop-blur-xl\">\n                    <div className=\"text-center p-6\">\n                      <Lock className=\"h-12 w-12 text-df-cyan mx-auto mb-4\" />\n                      <h4 className=\"text-df-snow font-semibold mb-2\">\n                        Age Verification Required\n                      </h4>\n                      <p className=\"text-df-fog mb-4\">\n                        This content requires age verification to view\n                      </p>\n                      <Button\n                        onClick={() => handleAgeVerify(post.id)}\n                        className=\"btn-primary\"\n                        data-testid={`button-verify-age-${post.id}`}\n                      >\n                        I am 18+ years old\n                      </Button>\n                    </div>\n                  </div>\n                </div>\n              ) : (\n                <>\n                  {post.mediaType === \"video\" ? (\n                    <video\n                      controls\n                      className=\"w-full\"\n                      data-testid={`video-media-${post.id}`}\n                    >\n                      <source src={post.mediaUrl} />\n                    </video>\n                  ) : (\n                    <img\n                      src={post.mediaUrl}\n                      alt=\"Post media\"\n                      className=\"w-full h-auto\"\n                      data-testid={`img-media-${post.id}`}\n                    />\n                  )}\n                </>\n              )}\n            </div>\n          )}\n\n          {/* Engagement Stats */}\n          <div className=\"flex items-center gap-6 pt-4 border-t border-df-steel\">\n            <button\n              onClick={() => handleLike(post.id)}\n              className=\"flex items-center gap-2 text-df-fog hover:text-pink-500 transition-colors\"\n              data-testid={`button-like-${post.id}`}\n            >\n              <Heart className=\"h-5 w-5\" />\n              <span>{post.likeCount}</span>\n            </button>\n            \n            <Dialog\n              onOpenChange={(open) => {\n                if (open) {\n                  setSelectedPostId(post.id);\n                  setCommentText(\"\");\n                } else {\n                  setSelectedPostId(null);\n                }\n              }}\n            >\n              <DialogTrigger asChild>\n                <button\n                  className=\"flex items-center gap-2 text-df-fog hover:text-df-cyan transition-colors\"\n                  data-testid={`button-comment-${post.id}`}\n                >\n                  <MessageCircle className=\"h-5 w-5\" />\n                  <span>{post.commentCount}</span>\n                </button>\n              </DialogTrigger>\n              <DialogContent className=\"bg-df-dungeon border-df-cyan/20 max-w-2xl\">\n                <DialogHeader>\n                  <DialogTitle className=\"text-df-cyan\">Comments</DialogTitle>\n                  <DialogDescription className=\"text-df-fog\">\n                    Join the conversation\n                  </DialogDescription>\n                </DialogHeader>\n\n                <ScrollArea className=\"h-[400px] pr-4\">\n                  {!comments || comments.length === 0 ? (\n                    <p className=\"text-df-fog text-center py-8\">\n                      No comments yet. Be the first to comment!\n                    </p>\n                  ) : (\n                    <div className=\"space-y-4\">\n                      {comments.map((comment) => (\n                        <div\n                          key={comment.id}\n                          className=\"flex gap-3 p-3 rounded-lg bg-df-ink/30\"\n                          data-testid={`comment-${comment.id}`}\n                        >\n                          <Avatar className=\"w-8 h-8 border border-df-cyan/20\">\n                            <AvatarFallback className=\"bg-gradient-to-br from-df-cyan to-df-gold text-df-dungeon text-xs\">\n                              {comment.userId.substring(0, 2).toUpperCase()}\n                            </AvatarFallback>\n                          </Avatar>\n                          <div className=\"flex-1\">\n                            <p className=\"text-sm text-df-fog\">\n                              User {comment.userId.substring(0, 8)}... •{\" \"}\n                              {new Date(comment.createdAt).toLocaleDateString()}\n                            </p>\n                            <p className=\"text-df-snow mt-1\">{comment.text}</p>\n                          </div>\n                        </div>\n                      ))}\n                    </div>\n                  )}\n                </ScrollArea>\n\n                <div className=\"flex gap-2 mt-4\">\n                  <Textarea\n                    placeholder=\"Write a comment...\"\n                    value={commentText}\n                    onChange={(e) => setCommentText(e.target.value)}\n                    className=\"bg-df-ink border-df-steel resize-none\"\n                    rows={3}\n                    data-testid=\"input-comment-text\"\n                  />\n                  <Button\n                    onClick={handleComment}\n                    disabled={!commentText.trim() || commentMutation.isPending}\n                    className=\"btn-primary\"\n                    data-testid=\"button-submit-comment\"\n                  >\n                    <Send className=\"w-4 h-4\" />\n                  </Button>\n                </div>\n              </DialogContent>\n            </Dialog>\n\n            <button\n              className=\"flex items-center gap-2 text-df-fog hover:text-df-cyan transition-colors\"\n              data-testid={`button-share-${post.id}`}\n            >\n              <Share2 className=\"h-5 w-5\" />\n              <span>Share</span>\n            </button>\n          </div>\n        </CardContent>\n      </Card>\n    );\n  };\n\n  const renderAd = (index: number) => {\n    return (\n      <Card key={`ad-${index}`} className=\"card-df mb-4 border-df-gold\" data-testid={`card-ad-${index}`}>\n        <CardContent className=\"p-6 text-center\">\n          <div className=\"bg-gradient-to-r from-df-gold/20 to-df-cyan/20 rounded-lg p-8\">\n            <p className=\"text-df-gold font-semibold mb-2\">SPONSORED</p>\n            <h3 className=\"text-xl text-df-snow font-bold mb-2 neon-subheading\">\n              Upgrade to FanzPremium\n            </h3>\n            <p className=\"text-df-fog mb-4\">\n              Get exclusive access to premium creators and unlock special features\n            </p>\n            <Button className=\"btn-primary\" data-testid={`button-ad-cta-${index}`}>\n              Learn More\n            </Button>\n          </div>\n        </CardContent>\n      </Card>\n    );\n  };\n\n  if (isLoading && allPosts.length === 0) {\n    return (\n      <div className=\"space-y-4\">\n        {[...Array(3)].map((_, i) => (\n          <Card key={i} className=\"card-df\">\n            <CardHeader>\n              <div className=\"flex items-center gap-3\">\n                <Skeleton className=\"h-12 w-12 rounded-full\" />\n                <div className=\"space-y-2\">\n                  <Skeleton className=\"h-4 w-32\" />\n                  <Skeleton className=\"h-3 w-20\" />\n                </div>\n              </div>\n            </CardHeader>\n            <CardContent>\n              <Skeleton className=\"h-4 w-full mb-2\" />\n              <Skeleton className=\"h-4 w-3/4 mb-4\" />\n              <Skeleton className=\"h-64 w-full\" />\n            </CardContent>\n          </Card>\n        ))}\n      </div>\n    );\n  }\n\n  if (allPosts.length === 0 && !isLoading) {\n    return (\n      <Card className=\"card-df\">\n        <CardContent className=\"p-12 text-center\">\n          <h3 className=\"text-xl text-df-snow font-semibold mb-2\">No posts yet</h3>\n          <p className=\"text-df-fog\">Follow some creators to see their content here</p>\n        </CardContent>\n      </Card>\n    );\n  }\n\n  return (\n    <div>\n      {allPosts.map((post, index) => (\n        <div key={`wrapper-${index}`}>\n          {renderPost(post, index)}\n          {/* Insert ad every N posts */}\n          {(index + 1) % adInterval === 0 && renderAd(Math.floor(index / adInterval))}\n        </div>\n      ))}\n\n      {/* Infinite scroll trigger */}\n      {hasMore && (\n        <div ref={observerTarget} className=\"py-8 text-center\">\n          {isFetching ? (\n            <div className=\"space-y-4\">\n              <Skeleton className=\"h-32 w-full\" />\n              <p className=\"text-df-fog\">Loading more posts...</p>\n            </div>\n          ) : (\n            <p className=\"text-df-fog\">Scroll to load more</p>\n          )}\n        </div>\n      )}\n\n      {!hasMore && allPosts.length > 0 && (\n        <div className=\"py-8 text-center\">\n          <p className=\"text-df-fog\">You've reached the end of the feed</p>\n        </div>\n      )}\n    </div>\n  );\n}\n","size_bytes":18678},"client/src/components/ui/toggle-group.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as ToggleGroupPrimitive from \"@radix-ui/react-toggle-group\"\nimport { type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\nimport { toggleVariants } from \"@/components/ui/toggle\"\n\nconst ToggleGroupContext = React.createContext<\n  VariantProps<typeof toggleVariants>\n>({\n  size: \"default\",\n  variant: \"default\",\n})\n\nconst ToggleGroup = React.forwardRef<\n  React.ElementRef<typeof ToggleGroupPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ToggleGroupPrimitive.Root> &\n    VariantProps<typeof toggleVariants>\n>(({ className, variant, size, children, ...props }, ref) => (\n  <ToggleGroupPrimitive.Root\n    ref={ref}\n    className={cn(\"flex items-center justify-center gap-1\", className)}\n    {...props}\n  >\n    <ToggleGroupContext.Provider value={{ variant, size }}>\n      {children}\n    </ToggleGroupContext.Provider>\n  </ToggleGroupPrimitive.Root>\n))\n\nToggleGroup.displayName = ToggleGroupPrimitive.Root.displayName\n\nconst ToggleGroupItem = React.forwardRef<\n  React.ElementRef<typeof ToggleGroupPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof ToggleGroupPrimitive.Item> &\n    VariantProps<typeof toggleVariants>\n>(({ className, children, variant, size, ...props }, ref) => {\n  const context = React.useContext(ToggleGroupContext)\n\n  return (\n    <ToggleGroupPrimitive.Item\n      ref={ref}\n      className={cn(\n        toggleVariants({\n          variant: context.variant || variant,\n          size: context.size || size,\n        }),\n        className\n      )}\n      {...props}\n    >\n      {children}\n    </ToggleGroupPrimitive.Item>\n  )\n})\n\nToggleGroupItem.displayName = ToggleGroupPrimitive.Item.displayName\n\nexport { ToggleGroup, ToggleGroupItem }\n","size_bytes":1753},"client/src/lib/queryClient.ts":{"content":"import { QueryClient, QueryFunction } from \"@tanstack/react-query\";\n\nasync function throwIfResNotOk(res: Response) {\n  if (!res.ok) {\n    const text = (await res.text()) || res.statusText;\n    throw new Error(`${res.status}: ${text}`);\n  }\n}\n\n// Module-level CSRF token storage\nlet cachedCSRFToken: string = '';\n\nexport function setCSRFToken(token: string) {\n  cachedCSRFToken = token;\n}\n\nexport function getCSRFToken(): string {\n  return cachedCSRFToken;\n}\n\nexport async function apiRequest(\n  method: string,\n  url: string,\n  data?: unknown | undefined,\n): Promise<Response> {\n  let headers: Record<string, string> = {};\n  let body: any = undefined;\n\n  // Include JWT token if available (for local auth)\n  const authToken = localStorage.getItem(\"authToken\");\n  if (authToken) {\n    headers[\"Authorization\"] = `Bearer ${authToken}`;\n  }\n\n  // Add CSRF token to headers for non-safe methods\n  if (!['GET', 'HEAD', 'OPTIONS'].includes(method.toUpperCase())) {\n    const csrfToken = getCSRFToken();\n    if (csrfToken) {\n      headers[\"x-csrf-token\"] = csrfToken;\n    }\n  }\n\n  if (data) {\n    // Handle FormData (for file uploads)\n    if (data instanceof FormData) {\n      body = data;\n      // Don't set Content-Type for FormData - browser will set it with boundary\n    } else {\n      // Handle JSON data\n      headers[\"Content-Type\"] = \"application/json\";\n      body = JSON.stringify(data);\n    }\n  }\n\n  const res = await fetch(url, {\n    method,\n    headers,\n    body,\n    credentials: \"include\", // For Replit auth session cookies\n  });\n\n  await throwIfResNotOk(res);\n  return res;\n}\n\ntype UnauthorizedBehavior = \"returnNull\" | \"throw\";\nexport const getQueryFn: <T>(options: {\n  on401: UnauthorizedBehavior;\n}) => QueryFunction<T> =\n  ({ on401: unauthorizedBehavior }) =>\n  async ({ queryKey }) => {\n    const headers: Record<string, string> = {};\n    \n    // Include JWT token if available (for local auth)\n    const authToken = localStorage.getItem(\"authToken\");\n    if (authToken) {\n      headers[\"Authorization\"] = `Bearer ${authToken}`;\n    }\n\n    const res = await fetch(queryKey.join(\"/\") as string, {\n      credentials: \"include\", // For Replit auth session cookies\n      headers,\n    });\n\n    if (unauthorizedBehavior === \"returnNull\" && res.status === 401) {\n      return null;\n    }\n\n    await throwIfResNotOk(res);\n    return await res.json();\n  };\n\nexport const queryClient = new QueryClient({\n  defaultOptions: {\n    queries: {\n      queryFn: getQueryFn({ on401: \"throw\" }),\n      refetchInterval: false,\n      refetchOnWindowFocus: false,\n      staleTime: Infinity,\n      retry: false,\n    },\n    mutations: {\n      retry: false,\n    },\n  },\n});\n","size_bytes":2662},"client/src/index.css":{"content":"@import url('https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;400;500;600;700&family=Inter:wght@300;400;500;600;700&display=swap');\n\n@tailwind base;\n@tailwind components;\n@tailwind utilities;\n\n:root {\n  /* DaddyFanz Brand Colors */\n  --df-cyan: hsl(195, 100%, 50%);\n  --df-gold: hsl(45, 93%, 59%);\n  --df-steel: hsl(220, 7%, 52%);\n  --df-ink: hsl(240, 10%, 4%);\n  --df-brick: hsl(240, 10%, 7%);\n  --df-snow: hsl(210, 40%, 96%);\n  --df-fog: hsl(215, 16%, 65%);\n\n  /* System Colors */\n  --background: hsl(240, 10%, 4%);\n  --foreground: hsl(210, 40%, 96%);\n  --card: hsl(240, 10%, 7%);\n  --card-foreground: hsl(210, 40%, 96%);\n  --popover: hsl(240, 10%, 7%);\n  --popover-foreground: hsl(210, 40%, 96%);\n  --primary: hsl(195, 100%, 50%);\n  --primary-foreground: hsl(210, 40%, 96%);\n  --secondary: hsl(45, 93%, 59%);\n  --secondary-foreground: hsl(240, 10%, 4%);\n  --muted: hsl(240, 5%, 26%);\n  --muted-foreground: hsl(215, 16%, 65%);\n  --accent: hsl(220, 7%, 52%);\n  --accent-foreground: hsl(210, 40%, 96%);\n  --destructive: hsl(0, 84%, 60%);\n  --destructive-foreground: hsl(210, 40%, 96%);\n  --border: hsl(220, 7%, 52%);\n  --input: hsl(240, 10%, 7%);\n  --ring: hsl(195, 100%, 50%);\n  --radius: 8px;\n\n  /* Success, Warning, Error */\n  --success: hsl(142, 76%, 36%);\n  --warning: hsl(38, 92%, 50%);\n  --error: hsl(0, 84%, 60%);\n\n  /* Font Families */\n  --font-sans: 'Inter', sans-serif;\n  --font-display: 'Space Grotesk', sans-serif;\n  --font-mono: 'Menlo', monospace;\n\n  /* Shadows */\n  --shadow-glow: 0 0 24px rgba(0, 207, 255, 0.5);\n  --shadow-glow-gold: 0 0 24px rgba(245, 194, 55, 0.3);\n  --shadow-inner-glow: inset 0 0 20px rgba(0, 207, 255, 0.1);\n\n  /* Gradients */\n  --gradient-dom: linear-gradient(135deg, #00CFFF 0%, #0047FF 60%, #F5C237 100%);\n  --gradient-dungeon: radial-gradient(1200px 600px at 60% -15%, rgba(0,207,255,0.11) 0%, rgba(0,0,0,0.7) 65%);\n  --gradient-gold: linear-gradient(90deg, #F5C237, #FFD97A);\n}\n\n.dark {\n  --background: hsl(240, 10%, 4%);\n  --foreground: hsl(210, 40%, 96%);\n  --card: hsl(240, 10%, 7%);\n  --card-foreground: hsl(210, 40%, 96%);\n  --popover: hsl(240, 10%, 7%);\n  --popover-foreground: hsl(210, 40%, 96%);\n  --primary: hsl(195, 100%, 50%);\n  --primary-foreground: hsl(210, 40%, 96%);\n  --secondary: hsl(45, 93%, 59%);\n  --secondary-foreground: hsl(240, 10%, 4%);\n  --muted: hsl(240, 5%, 26%);\n  --muted-foreground: hsl(215, 16%, 65%);\n  --accent: hsl(220, 7%, 52%);\n  --accent-foreground: hsl(210, 40%, 96%);\n  --destructive: hsl(0, 84%, 60%);\n  --destructive-foreground: hsl(210, 40%, 96%);\n  --border: hsl(220, 7%, 52%);\n  --input: hsl(240, 10%, 7%);\n  --ring: hsl(195, 100%, 50%);\n}\n\n@layer base {\n  * {\n    @apply border-border;\n  }\n\n  body {\n    @apply font-sans antialiased text-foreground;\n    font-family: var(--font-sans);\n    position: relative;\n    min-height: 100vh;\n  }\n\n  /* Fixed background for all screens - mobile compatible */\n  body::before {\n    content: '';\n    position: fixed;\n    top: 0;\n    left: 0;\n    width: 100%;\n    height: 100%;\n    background: url('./assets/shutterstock_2147591959_1759133066572.jpg');\n    background-size: cover;\n    background-position: center;\n    background-repeat: no-repeat;\n    z-index: -2;\n  }\n\n  /* Gradient overlay */\n  body::after {\n    content: '';\n    position: fixed;\n    top: 0;\n    left: 0;\n    width: 100%;\n    height: 100%;\n    background: var(--gradient-dungeon);\n    z-index: -1;\n  }\n\n  /* Mobile-specific optimizations */\n  @media (max-width: 768px) {\n    body::before {\n      background-size: cover;\n      background-position: center center;\n    }\n  }\n\n  h1, h2, h3, h4, h5, h6 {\n    font-family: var(--font-display);\n  }\n}\n\n@layer components {\n  /* DaddyFanz Neon Sign Typography - Toned Down */\n  .glow-text {\n    text-shadow: \n      0 0 3px currentColor,\n      0 0 6px currentColor,\n      0 0 12px rgba(0, 207, 255, 0.6),\n      0 0 18px rgba(0, 207, 255, 0.4);\n    animation: neon-flicker 8s linear infinite alternate;\n  }\n\n  .glow-text-gold {\n    color: var(--df-gold);\n    text-shadow: \n      0 0 3px currentColor,\n      0 0 6px currentColor,\n      0 0 12px rgba(245, 194, 55, 0.6),\n      0 0 18px rgba(245, 194, 55, 0.4);\n    animation: neon-flicker-gold 7s linear infinite alternate;\n  }\n\n  .neon-heading {\n    font-family: var(--font-display);\n    font-weight: 700;\n    letter-spacing: 0.1em;\n    color: var(--df-cyan);\n    text-shadow: \n      0 0 2px currentColor,\n      0 0 5px currentColor,\n      0 0 10px rgba(0, 207, 255, 0.7),\n      0 0 20px rgba(0, 207, 255, 0.5),\n      0 0 30px rgba(0, 207, 255, 0.3);\n    animation: neon-buzz 12s ease-in-out infinite alternate;\n  }\n\n  .neon-heading-caps {\n    font-family: var(--font-display);\n    font-weight: 700;\n    letter-spacing: 0.1em;\n    text-transform: uppercase;\n    color: var(--df-cyan);\n    text-shadow: \n      0 0 2px currentColor,\n      0 0 5px currentColor,\n      0 0 10px rgba(0, 207, 255, 0.7),\n      0 0 20px rgba(0, 207, 255, 0.5),\n      0 0 30px rgba(0, 207, 255, 0.3);\n    animation: neon-buzz 12s ease-in-out infinite alternate;\n  }\n\n  .neon-subheading {\n    font-family: var(--font-display);\n    font-weight: 600;\n    letter-spacing: 0.05em;\n    color: var(--df-gold);\n    text-shadow: \n      0 0 2px currentColor,\n      0 0 5px currentColor,\n      0 0 10px rgba(245, 194, 55, 0.7),\n      0 0 18px rgba(245, 194, 55, 0.5);\n    animation: neon-pulse 10s ease-in-out infinite alternate;\n  }\n\n  .pulse-glow {\n    animation: pulse-glow 2s ease-in-out infinite alternate;\n  }\n\n  .glow-image {\n    filter: drop-shadow(0 0 20px rgba(0, 207, 255, 0.3));\n    transition: filter 0.3s ease, transform 0.2s ease;\n  }\n\n  .glow-image:hover {\n    filter: drop-shadow(0 0 30px rgba(0, 207, 255, 0.6));\n  }\n\n  .animate-pulse-glow {\n    animation: pulse-glow-image 3s ease-in-out infinite alternate;\n  }\n\n  .chain-divider {\n    background: linear-gradient(90deg, transparent, var(--df-steel), transparent);\n    height: 1px;\n    position: relative;\n  }\n\n  .chain-divider::after {\n    content: '⛓️';\n    position: absolute;\n    left: 50%;\n    top: 50%;\n    transform: translate(-50%, -50%);\n    background: var(--df-brick);\n    padding: 0 8px;\n    font-size: 12px;\n  }\n\n  /* Button styles */\n  .btn-primary {\n    @apply bg-df-cyan text-df-snow font-semibold py-2 px-4 rounded-md;\n    @apply hover:shadow-glow transition-all duration-200;\n    @apply focus:outline-none focus:ring-2 focus:ring-df-cyan focus:ring-opacity-50;\n  }\n\n  .btn-secondary {\n    @apply bg-df-gold text-df-ink font-semibold py-2 px-4 rounded-md;\n    @apply hover:bg-opacity-90 transition-colors duration-200;\n    @apply focus:outline-none focus:ring-2 focus:ring-df-gold focus:ring-opacity-50;\n  }\n\n  .btn-outline {\n    @apply border border-df-steel text-df-snow py-2 px-4 rounded-md;\n    @apply hover:bg-df-steel hover:bg-opacity-20 transition-colors duration-200;\n    @apply focus:outline-none focus:ring-2 focus:ring-df-steel focus:ring-opacity-50;\n  }\n\n  /* Card styles */\n  .card-df {\n    @apply bg-df-brick border border-df-steel rounded-lg;\n    box-shadow: var(--shadow-inner-glow);\n  }\n\n  /* Input styles */\n  .input-df {\n    @apply bg-df-ink border border-df-steel rounded-md px-4 py-2;\n    @apply text-df-snow placeholder-df-fog;\n    @apply focus:border-df-cyan focus:ring-1 focus:ring-df-cyan;\n    @apply transition-colors duration-200;\n  }\n}\n\n@layer utilities {\n  /* Color utilities */\n  .text-df-cyan { color: var(--df-cyan); }\n  .text-df-gold { color: var(--df-gold); }\n  .text-df-steel { color: var(--df-steel); }\n  .text-df-ink { color: var(--df-ink); }\n  .text-df-brick { color: var(--df-brick); }\n  .text-df-snow { color: var(--df-snow); }\n  .text-df-fog { color: var(--df-fog); }\n\n  .bg-df-cyan { background-color: var(--df-cyan); }\n  .bg-df-gold { background-color: var(--df-gold); }\n  .bg-df-steel { background-color: var(--df-steel); }\n  .bg-df-ink { background-color: var(--df-ink); }\n  .bg-df-brick { background-color: var(--df-brick); }\n  .bg-df-snow { background-color: var(--df-snow); }\n  .bg-df-fog { background-color: var(--df-fog); }\n\n  .border-df-cyan { border-color: var(--df-cyan); }\n  .border-df-gold { border-color: var(--df-gold); }\n  .border-df-steel { border-color: var(--df-steel); }\n  .border-df-ink { border-color: var(--df-ink); }\n  .border-df-brick { border-color: var(--df-brick); }\n  .border-df-snow { border-color: var(--df-snow); }\n  .border-df-fog { border-color: var(--df-fog); }\n\n  /* Gradient utilities */\n  .bg-df-dom { background: var(--gradient-dom); }\n  .bg-df-dungeon { background: var(--gradient-dungeon); }\n  .bg-df-gold-gradient { background: var(--gradient-gold); }\n\n  /* Shadow utilities */\n  .shadow-glow { box-shadow: var(--shadow-glow); }\n  .shadow-glow-gold { box-shadow: var(--shadow-glow-gold); }\n  .shadow-inner-glow { box-shadow: var(--shadow-inner-glow); }\n}\n\n@keyframes pulse-glow {\n  from { box-shadow: 0 0 24px rgba(0, 207, 255, 0.3); }\n  to { box-shadow: 0 0 36px rgba(0, 207, 255, 0.6); }\n}\n\n@keyframes pulse-glow-image {\n  from { filter: drop-shadow(0 0 15px rgba(0, 207, 255, 0.4)); }\n  to { filter: drop-shadow(0 0 25px rgba(0, 207, 255, 0.8)); }\n}\n\n@keyframes neon-flicker {\n  0%, 18%, 22%, 25%, 53%, 57%, 100% {\n    text-shadow: \n      0 0 3px currentColor,\n      0 0 6px currentColor,\n      0 0 12px rgba(0, 207, 255, 0.6),\n      0 0 18px rgba(0, 207, 255, 0.4);\n  }\n  20%, 24%, 55% {\n    text-shadow: \n      0 0 2px currentColor,\n      0 0 4px currentColor,\n      0 0 8px rgba(0, 207, 255, 0.4);\n  }\n}\n\n@keyframes neon-flicker-gold {\n  0%, 19%, 21%, 23%, 25%, 54%, 56%, 100% {\n    text-shadow: \n      0 0 3px currentColor,\n      0 0 6px currentColor,\n      0 0 12px rgba(245, 194, 55, 0.6),\n      0 0 18px rgba(245, 194, 55, 0.4);\n  }\n  20%, 22%, 24%, 55% {\n    text-shadow: \n      0 0 2px currentColor,\n      0 0 4px currentColor,\n      0 0 8px rgba(245, 194, 55, 0.4);\n  }\n}\n\n@keyframes neon-buzz {\n  0%, 100% {\n    text-shadow: \n      0 0 2px currentColor,\n      0 0 5px currentColor,\n      0 0 10px rgba(0, 207, 255, 0.7),\n      0 0 20px rgba(0, 207, 255, 0.5),\n      0 0 30px rgba(0, 207, 255, 0.3);\n  }\n  50% {\n    text-shadow: \n      0 0 3px currentColor,\n      0 0 7px currentColor,\n      0 0 14px rgba(0, 207, 255, 0.8),\n      0 0 25px rgba(0, 207, 255, 0.6),\n      0 0 35px rgba(0, 207, 255, 0.4);\n  }\n}\n\n@keyframes neon-pulse {\n  0%, 100% {\n    text-shadow: \n      0 0 2px currentColor,\n      0 0 5px currentColor,\n      0 0 10px rgba(245, 194, 55, 0.7),\n      0 0 18px rgba(245, 194, 55, 0.5);\n  }\n  50% {\n    text-shadow: \n      0 0 3px currentColor,\n      0 0 6px currentColor,\n      0 0 14px rgba(245, 194, 55, 0.8),\n      0 0 22px rgba(245, 194, 55, 0.6);\n  }\n}\n\n/* Scrollbar styling */\n::-webkit-scrollbar {\n  width: 8px;\n}\n\n::-webkit-scrollbar-track {\n  background: var(--df-ink);\n}\n\n::-webkit-scrollbar-thumb {\n  background: var(--df-steel);\n  border-radius: 4px;\n}\n\n::-webkit-scrollbar-thumb:hover {\n  background: var(--df-cyan);\n}\n\n/* Selection styling */\n::selection {\n  background: var(--df-cyan);\n  color: var(--df-ink);\n}\n\n/* Focus visible styling */\n:focus-visible {\n  outline: 2px solid var(--df-cyan);\n  outline-offset: 2px;\n}\n","size_bytes":11098},"client/src/pages/FanLendingDashboard.tsx":{"content":"import { useState, useEffect, useMemo } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { Form, FormControl, FormField, FormItem, FormLabel, FormMessage } from \"@/components/ui/form\";\nimport { Dialog, DialogContent, DialogDescription, DialogHeader, DialogTitle, DialogTrigger } from \"@/components/ui/dialog\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { useForm } from \"react-hook-form\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport { z } from \"zod\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport { DollarSign, Calendar, TrendingUp, Clock, CheckCircle2, XCircle, AlertCircle, User } from \"lucide-react\";\nimport type { LoanApplication, LoanOffer, LoanRepayment } from \"@shared/schema\";\n\nconst createOfferFormSchema = (maxAmountCents?: number) => z.object({\n  offeredAmount: z.coerce.number()\n    .positive(\"Amount must be greater than 0\")\n    .finite(\"Amount must be a valid number\")\n    .refine(\n      (val) => !maxAmountCents || (val * 100) <= maxAmountCents,\n      (val) => ({ message: `Offer cannot exceed requested amount of $${((maxAmountCents || 0) / 100).toFixed(2)}` })\n    ),\n  interestRate: z.coerce.number().min(0, \"Interest rate must be 0 or higher\").max(100, \"Interest rate cannot exceed 100%\"),\n  termMonths: z.coerce.number().int().min(1, \"Term must be at least 1 month\").max(60, \"Term cannot exceed 60 months\"),\n});\n\ntype OfferFormData = z.infer<ReturnType<typeof createOfferFormSchema>>;\n\nexport default function FanLendingDashboard() {\n  const { toast } = useToast();\n  const [selectedApplication, setSelectedApplication] = useState<LoanApplication | null>(null);\n\n  const { data: opportunities, isLoading: opportunitiesLoading } = useQuery<LoanApplication[]>({\n    queryKey: [\"/api/loans/applications/all\"],\n  });\n\n  const { data: myOffers, isLoading: offersLoading } = useQuery<(LoanOffer & { repayments?: LoanRepayment[] })[]>({\n    queryKey: [\"/api/loans/offers/lender\"],\n  });\n\n  const offerFormSchema = useMemo(\n    () => createOfferFormSchema(selectedApplication?.requestedAmount),\n    [selectedApplication?.requestedAmount]\n  );\n\n  const form = useForm<OfferFormData>({\n    resolver: zodResolver(offerFormSchema),\n    defaultValues: {\n      offeredAmount: 0,\n      interestRate: 0,\n      termMonths: 12,\n    },\n  });\n\n  // Reset form validation when selected application changes\n  useEffect(() => {\n    if (selectedApplication) {\n      form.trigger();\n    }\n  }, [selectedApplication, form]);\n\n  const makeOfferMutation = useMutation({\n    mutationFn: async (data: OfferFormData) => {\n      if (!selectedApplication) {\n        throw new Error(\"No application selected\");\n      }\n\n      const amountCents = Math.round(data.offeredAmount * 100);\n      const requestedCents = selectedApplication.requestedAmount;\n\n      if (amountCents > requestedCents) {\n        throw new Error(`Offer cannot exceed requested amount of ${formatCurrency(requestedCents)}`);\n      }\n\n      return apiRequest(\"/api/loans/offers\", \"POST\", {\n        applicationId: selectedApplication.id,\n        creatorId: selectedApplication.creatorId,\n        offeredAmount: amountCents,\n        interestRate: data.interestRate.toString(),\n        termMonths: data.termMonths,\n      });\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/loans/offers/lender\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/loans/applications/all\"] });\n      toast({ title: \"Offer submitted\", description: \"Your loan offer has been sent to the creator.\" });\n      form.reset();\n      setSelectedApplication(null);\n    },\n    onError: (error: any) => {\n      toast({ title: \"Offer failed\", description: error.message, variant: \"destructive\" });\n    },\n  });\n\n  const onSubmit = (data: OfferFormData) => {\n    makeOfferMutation.mutate(data);\n  };\n\n  const formatCurrency = (cents: number) => {\n    return new Intl.NumberFormat(\"en-US\", { style: \"currency\", currency: \"USD\" }).format(cents / 100);\n  };\n\n  const getStatusBadge = (status: string) => {\n    const variants: Record<string, { variant: \"default\" | \"secondary\" | \"destructive\" | \"outline\", icon: any }> = {\n      pending: { variant: \"outline\", icon: Clock },\n      approved: { variant: \"default\", icon: CheckCircle2 },\n      active: { variant: \"default\", icon: TrendingUp },\n      repaid: { variant: \"secondary\", icon: CheckCircle2 },\n      defaulted: { variant: \"destructive\", icon: XCircle },\n      cancelled: { variant: \"secondary\", icon: XCircle },\n    };\n    const config = variants[status] || variants.pending;\n    const Icon = config.icon;\n    return (\n      <Badge variant={config.variant} data-testid={`badge-status-${status}`}>\n        <Icon className=\"w-3 h-3 mr-1\" />\n        {status}\n      </Badge>\n    );\n  };\n\n  const calculateMonthlyPayment = (principal: number, interestRate: number, months: number) => {\n    if (interestRate === 0) {\n      return principal / months;\n    }\n    const monthlyRate = interestRate / 100 / 12;\n    const payment = (principal * monthlyRate * Math.pow(1 + monthlyRate, months)) / (Math.pow(1 + monthlyRate, months) - 1);\n    return payment;\n  };\n\n  return (\n    <div className=\"min-h-screen bg-gradient-to-br from-gray-900 via-gray-800 to-black text-white p-6\">\n      <div className=\"max-w-7xl mx-auto\">\n        <div className=\"mb-8\">\n          <h1 className=\"text-4xl font-bold bg-gradient-to-r from-cyan-400 to-blue-500 bg-clip-text text-transparent\" data-testid=\"text-page-title\">\n            Lending Dashboard\n          </h1>\n          <p className=\"text-gray-400 mt-2\">Support creators and earn returns on your investments</p>\n        </div>\n\n        <Tabs defaultValue=\"opportunities\" className=\"space-y-6\">\n          <TabsList className=\"bg-gray-800 border border-gray-700\">\n            <TabsTrigger value=\"opportunities\" data-testid=\"tab-opportunities\">Lending Opportunities</TabsTrigger>\n            <TabsTrigger value=\"my-offers\" data-testid=\"tab-my-offers\">My Offers</TabsTrigger>\n            <TabsTrigger value=\"active\" data-testid=\"tab-active\">Active Loans</TabsTrigger>\n          </TabsList>\n\n          <TabsContent value=\"opportunities\">\n            <div className=\"grid md:grid-cols-2 lg:grid-cols-3 gap-6\">\n              {opportunitiesLoading ? (\n                <div className=\"col-span-full text-center py-12 text-gray-400\">Loading opportunities...</div>\n              ) : opportunities?.filter(app => app.status === \"pending\").length === 0 ? (\n                <div className=\"col-span-full text-center py-12 text-gray-400\">No lending opportunities available</div>\n              ) : (\n                opportunities?.filter(app => app.status === \"pending\").map((app) => (\n                  <Card key={app.id} className=\"bg-gray-800/50 border-cyan-500/20\" data-testid={`card-opportunity-${app.id}`}>\n                    <CardHeader>\n                      <div className=\"flex items-start justify-between\">\n                        <div className=\"flex-1\">\n                          <CardTitle className=\"text-cyan-400 text-lg\">Creator Loan Request</CardTitle>\n                          <CardDescription className=\"mt-1\">\n                            Requesting {formatCurrency(app.requestedAmount)}\n                          </CardDescription>\n                        </div>\n                        {getStatusBadge(app.status || \"pending\")}\n                      </div>\n                    </CardHeader>\n                    <CardContent className=\"space-y-4\">\n                      <div>\n                        <span className=\"text-gray-400 text-sm\">Purpose:</span>\n                        <p className=\"mt-1 text-sm\" data-testid={`text-purpose-${app.id}`}>{app.purpose}</p>\n                      </div>\n\n                      {app.businessPlan && (\n                        <div>\n                          <span className=\"text-gray-400 text-sm\">Business Plan:</span>\n                          <p className=\"mt-1 text-xs text-gray-300 line-clamp-3\" data-testid={`text-plan-${app.id}`}>\n                            {app.businessPlan}\n                          </p>\n                        </div>\n                      )}\n\n                      <div className=\"flex items-center gap-2 text-sm text-gray-400\">\n                        <Calendar className=\"w-4 h-4\" />\n                        Applied {app.createdAt ? new Date(app.createdAt).toLocaleDateString() : \"Unknown\"}\n                      </div>\n\n                      <div className=\"flex items-center gap-2 text-sm text-gray-400\">\n                        <User className=\"w-4 h-4\" />\n                        Creator ID: {app.creatorId.substring(0, 8)}...\n                      </div>\n\n                      <Dialog>\n                        <DialogTrigger asChild>\n                          <Button\n                            onClick={() => {\n                              setSelectedApplication(app);\n                              form.reset({\n                                offeredAmount: app.requestedAmount / 100,\n                                interestRate: 5,\n                                termMonths: 12,\n                              });\n                            }}\n                            className=\"w-full bg-gradient-to-r from-cyan-500 to-blue-600 hover:from-cyan-600 hover:to-blue-700\"\n                            data-testid={`button-make-offer-${app.id}`}\n                          >\n                            Make Offer\n                          </Button>\n                        </DialogTrigger>\n                        <DialogContent className=\"bg-gray-800 border-cyan-500/20\">\n                          <DialogHeader>\n                            <DialogTitle className=\"text-cyan-400\">Make a Loan Offer</DialogTitle>\n                            <DialogDescription>\n                              Creator is requesting {selectedApplication ? formatCurrency(selectedApplication.requestedAmount) : \"$0.00\"}\n                            </DialogDescription>\n                          </DialogHeader>\n\n                          <Form {...form}>\n                            <form onSubmit={form.handleSubmit(onSubmit)} className=\"space-y-6\">\n                              <FormField\n                                control={form.control}\n                                name=\"offeredAmount\"\n                                render={({ field }) => {\n                                  const maxAmount = selectedApplication ? selectedApplication.requestedAmount / 100 : 0;\n                                  return (\n                                    <FormItem>\n                                      <FormLabel>Offer Amount (USD)</FormLabel>\n                                      <FormControl>\n                                        <Input\n                                          type=\"number\"\n                                          step=\"0.01\"\n                                          placeholder=\"5000.00\"\n                                          className=\"bg-gray-700 border-gray-600\"\n                                          data-testid=\"input-offer-amount\"\n                                          {...field}\n                                        />\n                                      </FormControl>\n                                      <p className=\"text-sm text-gray-400\">\n                                        Maximum: {formatCurrency(selectedApplication?.requestedAmount || 0)}\n                                      </p>\n                                      <FormMessage />\n                                    </FormItem>\n                                  );\n                                }}\n                              />\n\n                              <FormField\n                                control={form.control}\n                                name=\"interestRate\"\n                                render={({ field }) => (\n                                  <FormItem>\n                                    <FormLabel>Interest Rate (%)</FormLabel>\n                                    <FormControl>\n                                      <Input\n                                        type=\"number\"\n                                        step=\"0.1\"\n                                        placeholder=\"5.0\"\n                                        className=\"bg-gray-700 border-gray-600\"\n                                        data-testid=\"input-interest-rate\"\n                                        {...field}\n                                      />\n                                    </FormControl>\n                                    <FormMessage />\n                                  </FormItem>\n                                )}\n                              />\n\n                              <FormField\n                                control={form.control}\n                                name=\"termMonths\"\n                                render={({ field }) => (\n                                  <FormItem>\n                                    <FormLabel>Term (Months)</FormLabel>\n                                    <FormControl>\n                                      <Input\n                                        type=\"number\"\n                                        placeholder=\"12\"\n                                        className=\"bg-gray-700 border-gray-600\"\n                                        data-testid=\"input-term-months\"\n                                        {...field}\n                                      />\n                                    </FormControl>\n                                    <FormMessage />\n                                  </FormItem>\n                                )}\n                              />\n\n                              {form.watch(\"offeredAmount\") > 0 && form.watch(\"termMonths\") > 0 && (\n                                <div className=\"p-4 bg-gray-700/30 rounded space-y-2\">\n                                  <h4 className=\"font-semibold text-cyan-400\">Loan Summary</h4>\n                                  <div className=\"flex justify-between text-sm\">\n                                    <span className=\"text-gray-400\">Principal:</span>\n                                    <span>{formatCurrency(Math.round(form.watch(\"offeredAmount\") * 100))}</span>\n                                  </div>\n                                  <div className=\"flex justify-between text-sm\">\n                                    <span className=\"text-gray-400\">Monthly Payment:</span>\n                                    <span>\n                                      {formatCurrency(\n                                        Math.round(\n                                          calculateMonthlyPayment(\n                                            form.watch(\"offeredAmount\"),\n                                            form.watch(\"interestRate\"),\n                                            form.watch(\"termMonths\")\n                                          ) * 100\n                                        )\n                                      )}\n                                    </span>\n                                  </div>\n                                  <div className=\"flex justify-between text-sm\">\n                                    <span className=\"text-gray-400\">Total Return:</span>\n                                    <span>\n                                      {formatCurrency(\n                                        Math.round(\n                                          calculateMonthlyPayment(\n                                            form.watch(\"offeredAmount\"),\n                                            form.watch(\"interestRate\"),\n                                            form.watch(\"termMonths\")\n                                          ) * form.watch(\"termMonths\") * 100\n                                        )\n                                      )}\n                                    </span>\n                                  </div>\n                                </div>\n                              )}\n\n                              <Button\n                                type=\"submit\"\n                                disabled={makeOfferMutation.isPending}\n                                className=\"w-full bg-gradient-to-r from-cyan-500 to-blue-600 hover:from-cyan-600 hover:to-blue-700\"\n                                data-testid=\"button-submit-offer\"\n                              >\n                                {makeOfferMutation.isPending ? \"Submitting...\" : \"Submit Offer\"}\n                              </Button>\n                            </form>\n                          </Form>\n                        </DialogContent>\n                      </Dialog>\n                    </CardContent>\n                  </Card>\n                ))\n              )}\n            </div>\n          </TabsContent>\n\n          <TabsContent value=\"my-offers\">\n            <div className=\"space-y-4\">\n              {offersLoading ? (\n                <div className=\"text-center py-12 text-gray-400\">Loading offers...</div>\n              ) : myOffers?.length === 0 ? (\n                <div className=\"text-center py-12 text-gray-400\">No offers yet</div>\n              ) : (\n                myOffers?.map((offer) => (\n                  <Card key={offer.id} className=\"bg-gray-800/50 border-cyan-500/20\" data-testid={`card-offer-${offer.id}`}>\n                    <CardHeader>\n                      <div className=\"flex items-start justify-between\">\n                        <div>\n                          <CardTitle className=\"text-cyan-400\">Loan Offer</CardTitle>\n                          <CardDescription>\n                            {formatCurrency(offer.offeredAmount)} at {offer.interestRate}% for {offer.termMonths} months\n                          </CardDescription>\n                        </div>\n                        {getStatusBadge(offer.status || \"pending\")}\n                      </div>\n                    </CardHeader>\n                    <CardContent className=\"space-y-3\">\n                      <div className=\"grid grid-cols-2 gap-4\">\n                        <div>\n                          <span className=\"text-gray-400\">Offered Amount:</span>\n                          <p className=\"text-xl font-bold text-cyan-400\" data-testid={`text-amount-${offer.id}`}>\n                            {formatCurrency(offer.offeredAmount)}\n                          </p>\n                        </div>\n                        <div>\n                          <span className=\"text-gray-400\">Interest Rate:</span>\n                          <p className=\"text-xl font-bold text-cyan-400\" data-testid={`text-rate-${offer.id}`}>\n                            {offer.interestRate}%\n                          </p>\n                        </div>\n                      </div>\n                      <div className=\"flex items-center gap-2 text-sm text-gray-400\">\n                        <User className=\"w-4 h-4\" />\n                        Creator ID: {offer.creatorId.substring(0, 8)}...\n                      </div>\n                      <div className=\"flex items-center gap-2 text-sm text-gray-400\">\n                        <Calendar className=\"w-4 h-4\" />\n                        Offered {offer.createdAt ? new Date(offer.createdAt).toLocaleDateString() : \"Unknown\"}\n                      </div>\n                    </CardContent>\n                  </Card>\n                ))\n              )}\n            </div>\n          </TabsContent>\n\n          <TabsContent value=\"active\">\n            <div className=\"space-y-6\">\n              {offersLoading ? (\n                <div className=\"text-center py-12 text-gray-400\">Loading active loans...</div>\n              ) : myOffers?.filter(o => o.status === \"active\").length === 0 ? (\n                <div className=\"text-center py-12 text-gray-400\">No active loans</div>\n              ) : (\n                myOffers?.filter(o => o.status === \"active\").map((offer) => (\n                  <Card key={offer.id} className=\"bg-gray-800/50 border-cyan-500/20\" data-testid={`card-loan-${offer.id}`}>\n                    <CardHeader>\n                      <div className=\"flex items-start justify-between\">\n                        <div>\n                          <CardTitle className=\"text-cyan-400\">Active Loan</CardTitle>\n                          <CardDescription>\n                            {formatCurrency(offer.offeredAmount)} at {offer.interestRate}% for {offer.termMonths} months\n                          </CardDescription>\n                        </div>\n                        {getStatusBadge(offer.status || \"pending\")}\n                      </div>\n                    </CardHeader>\n                    <CardContent className=\"space-y-4\">\n                      <div className=\"grid grid-cols-2 gap-4\">\n                        <div>\n                          <span className=\"text-gray-400\">Principal:</span>\n                          <p className=\"text-xl font-bold text-cyan-400\" data-testid={`text-principal-${offer.id}`}>\n                            {formatCurrency(offer.offeredAmount)}\n                          </p>\n                        </div>\n                        <div>\n                          <span className=\"text-gray-400\">Expected Return:</span>\n                          <p className=\"text-xl font-bold text-green-400\">\n                            {formatCurrency(\n                              Math.round(\n                                calculateMonthlyPayment(\n                                  offer.offeredAmount / 100,\n                                  parseFloat(offer.interestRate),\n                                  offer.termMonths\n                                ) * offer.termMonths * 100\n                              )\n                            )}\n                          </p>\n                        </div>\n                      </div>\n\n                      {offer.repayments && offer.repayments.length > 0 && (\n                        <div>\n                          <h4 className=\"font-semibold mb-3\">Repayment Schedule</h4>\n                          <div className=\"space-y-2\">\n                            {offer.repayments.slice(0, 5).map((repayment) => (\n                              <div\n                                key={repayment.id}\n                                className=\"flex items-center justify-between p-3 bg-gray-700/30 rounded\"\n                                data-testid={`row-repayment-${repayment.id}`}\n                              >\n                                <div className=\"flex items-center gap-3\">\n                                  <span className=\"text-gray-400\">Payment #{repayment.installmentNumber}</span>\n                                  {repayment.status === \"paid\" && <CheckCircle2 className=\"w-4 h-4 text-green-500\" />}\n                                  {repayment.status === \"late\" && <AlertCircle className=\"w-4 h-4 text-yellow-500\" />}\n                                  {repayment.status === \"missed\" && <XCircle className=\"w-4 h-4 text-red-500\" />}\n                                </div>\n                                <div className=\"text-right\">\n                                  <p className=\"font-semibold\" data-testid={`text-repay-amount-${repayment.id}`}>\n                                    {formatCurrency(repayment.amountDue)}\n                                  </p>\n                                  <p className=\"text-sm text-gray-400\">\n                                    {repayment.status === \"paid\" && repayment.paidAt\n                                      ? `Paid ${new Date(repayment.paidAt).toLocaleDateString()}`\n                                      : `Due ${new Date(repayment.dueDate).toLocaleDateString()}`}\n                                  </p>\n                                </div>\n                              </div>\n                            ))}\n                          </div>\n                        </div>\n                      )}\n                    </CardContent>\n                  </Card>\n                ))\n              )}\n            </div>\n          </TabsContent>\n        </Tabs>\n      </div>\n    </div>\n  );\n}\n","size_bytes":24436},"client/src/components/ui/textarea.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Textarea = React.forwardRef<\n  HTMLTextAreaElement,\n  React.ComponentProps<\"textarea\">\n>(({ className, ...props }, ref) => {\n  return (\n    <textarea\n      className={cn(\n        \"flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm\",\n        className\n      )}\n      ref={ref}\n      {...props}\n    />\n  )\n})\nTextarea.displayName = \"Textarea\"\n\nexport { Textarea }\n","size_bytes":689},"client/src/components/dashboard/StatsCards.tsx":{"content":"import { Card, CardContent } from \"@/components/ui/card\";\nimport { DollarSign, Users, Eye, Clock, TrendingUp, TrendingDown } from \"lucide-react\";\n\ninterface StatsCardsProps {\n  userRole: string;\n  mediaAssets: any[];\n  payoutAccounts: any[];\n}\n\nexport default function StatsCards({ userRole, mediaAssets, payoutAccounts }: StatsCardsProps) {\n  const isCreator = userRole === \"creator\" || userRole === \"admin\";\n\n  // Calculate stats from actual data\n  const totalPosts = mediaAssets.length;\n  const premiumPosts = mediaAssets.filter(asset => asset.isPremium).length;\n  const approvedPosts = mediaAssets.filter(asset => asset.status === \"approved\").length;\n  const pendingPosts = mediaAssets.filter(asset => asset.status === \"uploaded\").length;\n\n  // Creator stats\n  const creatorStats = [\n    {\n      title: \"Total Earnings\",\n      value: \"$12,847\",\n      icon: DollarSign,\n      iconColor: \"text-df-gold\",\n      bgColor: \"bg-df-gold bg-opacity-20\",\n      change: \"+12%\",\n      changeType: \"positive\" as const,\n      testId: \"stat-total-earnings\"\n    },\n    {\n      title: \"Active Subscribers\",\n      value: \"1,247\",\n      icon: Users,\n      iconColor: \"text-df-cyan\",\n      bgColor: \"bg-df-cyan bg-opacity-20\",\n      change: \"+47 new\",\n      changeType: \"positive\" as const,\n      testId: \"stat-subscribers\"\n    },\n    {\n      title: \"Content Views\",\n      value: \"89,432\",\n      icon: Eye,\n      iconColor: \"text-df-snow\",\n      bgColor: \"bg-df-steel bg-opacity-20\",\n      change: \"+23%\",\n      changeType: \"positive\" as const,\n      testId: \"stat-views\"\n    },\n    {\n      title: \"Pending Payout\",\n      value: \"$2,134\",\n      icon: Clock,\n      iconColor: \"text-df-gold\",\n      bgColor: \"bg-df-gold bg-opacity-20\",\n      change: \"Friday\",\n      changeType: \"neutral\" as const,\n      testId: \"stat-pending-payout\"\n    },\n  ];\n\n  // Fan stats\n  const fanStats = [\n    {\n      title: \"Subscriptions\",\n      value: \"12\",\n      icon: Users,\n      iconColor: \"text-df-cyan\",\n      bgColor: \"bg-df-cyan bg-opacity-20\",\n      change: \"+2 this month\",\n      changeType: \"positive\" as const,\n      testId: \"stat-subscriptions\"\n    },\n    {\n      title: \"Total Spent\",\n      value: \"$487\",\n      icon: DollarSign,\n      iconColor: \"text-df-gold\",\n      bgColor: \"bg-df-gold bg-opacity-20\",\n      change: \"+$89 this month\",\n      changeType: \"neutral\" as const,\n      testId: \"stat-total-spent\"\n    },\n    {\n      title: \"Content Viewed\",\n      value: \"1,234\",\n      icon: Eye,\n      iconColor: \"text-df-snow\",\n      bgColor: \"bg-df-steel bg-opacity-20\",\n      change: \"+156 this week\",\n      changeType: \"positive\" as const,\n      testId: \"stat-content-viewed\"\n    },\n    {\n      title: \"Messages Sent\",\n      value: \"89\",\n      icon: Clock,\n      iconColor: \"text-df-cyan\",\n      bgColor: \"bg-df-cyan bg-opacity-20\",\n      change: \"+12 this week\",\n      changeType: \"positive\" as const,\n      testId: \"stat-messages\"\n    },\n  ];\n\n  const stats = isCreator ? creatorStats : fanStats;\n\n  const getChangeIcon = (changeType: \"positive\" | \"negative\" | \"neutral\") => {\n    if (changeType === \"positive\") {\n      return <TrendingUp className=\"h-3 w-3 text-green-400\" />;\n    } else if (changeType === \"negative\") {\n      return <TrendingDown className=\"h-3 w-3 text-red-400\" />;\n    }\n    return null;\n  };\n\n  const getChangeColor = (changeType: \"positive\" | \"negative\" | \"neutral\") => {\n    if (changeType === \"positive\") return \"text-green-400\";\n    if (changeType === \"negative\") return \"text-red-400\";\n    return \"text-df-cyan\";\n  };\n\n  return (\n    <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8\">\n      {stats.map((stat, index) => (\n        <Card key={index} className=\"card-df shadow-inner-glow\">\n          <CardContent className=\"p-6\">\n            <div className=\"flex items-center justify-between\">\n              <div>\n                <p className=\"text-df-fog text-sm font-medium\">{stat.title}</p>\n                <p \n                  className={`text-3xl font-display font-bold ${stat.iconColor}`}\n                  data-testid={stat.testId}\n                >\n                  {stat.value}\n                </p>\n              </div>\n              <div className={`${stat.bgColor} p-3 rounded-full`}>\n                <stat.icon className={`${stat.iconColor} text-xl`} />\n              </div>\n            </div>\n            <div className={`flex items-center space-x-1 mt-2 ${getChangeColor(stat.changeType)}`}>\n              {getChangeIcon(stat.changeType)}\n              <span className=\"text-sm\">{stat.change}</span>\n            </div>\n          </CardContent>\n        </Card>\n      ))}\n    </div>\n  );\n}\n","size_bytes":4631},"client/src/components/ui/separator.tsx":{"content":"import * as React from \"react\"\nimport * as SeparatorPrimitive from \"@radix-ui/react-separator\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Separator = React.forwardRef<\n  React.ElementRef<typeof SeparatorPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof SeparatorPrimitive.Root>\n>(\n  (\n    { className, orientation = \"horizontal\", decorative = true, ...props },\n    ref\n  ) => (\n    <SeparatorPrimitive.Root\n      ref={ref}\n      decorative={decorative}\n      orientation={orientation}\n      className={cn(\n        \"shrink-0 bg-border\",\n        orientation === \"horizontal\" ? \"h-[1px] w-full\" : \"h-full w-[1px]\",\n        className\n      )}\n      {...props}\n    />\n  )\n)\nSeparator.displayName = SeparatorPrimitive.Root.displayName\n\nexport { Separator }\n","size_bytes":756},"client/src/hooks/use-mobile.tsx":{"content":"import * as React from \"react\"\n\nconst MOBILE_BREAKPOINT = 768\n\nexport function useIsMobile() {\n  const [isMobile, setIsMobile] = React.useState<boolean | undefined>(undefined)\n\n  React.useEffect(() => {\n    const mql = window.matchMedia(`(max-width: ${MOBILE_BREAKPOINT - 1}px)`)\n    const onChange = () => {\n      setIsMobile(window.innerWidth < MOBILE_BREAKPOINT)\n    }\n    mql.addEventListener(\"change\", onChange)\n    setIsMobile(window.innerWidth < MOBILE_BREAKPOINT)\n    return () => mql.removeEventListener(\"change\", onChange)\n  }, [])\n\n  return !!isMobile\n}\n","size_bytes":565},"server/middleware/cors.ts":{"content":"import { Request, Response, NextFunction } from 'express';\n\nconst ALLOWED_ORIGINS = [\n  'http://localhost:5000',\n  'http://localhost:3000',\n  'https://daddiesfanz.com',\n  'https://www.daddiesfanz.com',\n  'https://fanz.daddiesfanz.com',\n];\n\nif (process.env.REPLIT_DEV_DOMAIN) {\n  ALLOWED_ORIGINS.push(`https://${process.env.REPLIT_DEV_DOMAIN}`);\n}\n\nexport function corsMiddleware(req: Request, res: Response, next: NextFunction) {\n  const origin = req.headers.origin;\n\n  if (origin && ALLOWED_ORIGINS.includes(origin)) {\n    res.setHeader('Access-Control-Allow-Origin', origin);\n  }\n\n  res.setHeader('Access-Control-Allow-Methods', 'GET, POST, PUT, DELETE, PATCH, OPTIONS');\n  res.setHeader('Access-Control-Allow-Headers', 'Content-Type, Authorization, x-csrf-token');\n  res.setHeader('Access-Control-Allow-Credentials', 'true');\n  res.setHeader('Access-Control-Max-Age', '86400');\n\n  if (req.method === 'OPTIONS') {\n    return res.status(204).end();\n  }\n\n  next();\n}\n","size_bytes":967},"server/db.ts":{"content":"import { Pool, neonConfig } from '@neondatabase/serverless';\nimport { drizzle } from 'drizzle-orm/neon-serverless';\nimport ws from \"ws\";\nimport * as schema from \"@shared/schema\";\n\nneonConfig.webSocketConstructor = ws;\n\nif (!process.env.DATABASE_URL) {\n  throw new Error(\n    \"DATABASE_URL must be set. Did you forget to provision a database?\",\n  );\n}\n\nexport const pool = new Pool({ connectionString: process.env.DATABASE_URL });\nexport const db = drizzle({ client: pool, schema });\n","size_bytes":483},"client/src/components/ui/calendar.tsx":{"content":"import * as React from \"react\"\nimport { ChevronLeft, ChevronRight } from \"lucide-react\"\nimport { DayPicker } from \"react-day-picker\"\n\nimport { cn } from \"@/lib/utils\"\nimport { buttonVariants } from \"@/components/ui/button\"\n\nexport type CalendarProps = React.ComponentProps<typeof DayPicker>\n\nfunction Calendar({\n  className,\n  classNames,\n  showOutsideDays = true,\n  ...props\n}: CalendarProps) {\n  return (\n    <DayPicker\n      showOutsideDays={showOutsideDays}\n      className={cn(\"p-3\", className)}\n      classNames={{\n        months: \"flex flex-col sm:flex-row space-y-4 sm:space-x-4 sm:space-y-0\",\n        month: \"space-y-4\",\n        caption: \"flex justify-center pt-1 relative items-center\",\n        caption_label: \"text-sm font-medium\",\n        nav: \"space-x-1 flex items-center\",\n        nav_button: cn(\n          buttonVariants({ variant: \"outline\" }),\n          \"h-7 w-7 bg-transparent p-0 opacity-50 hover:opacity-100\"\n        ),\n        nav_button_previous: \"absolute left-1\",\n        nav_button_next: \"absolute right-1\",\n        table: \"w-full border-collapse space-y-1\",\n        head_row: \"flex\",\n        head_cell:\n          \"text-muted-foreground rounded-md w-9 font-normal text-[0.8rem]\",\n        row: \"flex w-full mt-2\",\n        cell: \"h-9 w-9 text-center text-sm p-0 relative [&:has([aria-selected].day-range-end)]:rounded-r-md [&:has([aria-selected].day-outside)]:bg-accent/50 [&:has([aria-selected])]:bg-accent first:[&:has([aria-selected])]:rounded-l-md last:[&:has([aria-selected])]:rounded-r-md focus-within:relative focus-within:z-20\",\n        day: cn(\n          buttonVariants({ variant: \"ghost\" }),\n          \"h-9 w-9 p-0 font-normal aria-selected:opacity-100\"\n        ),\n        day_range_end: \"day-range-end\",\n        day_selected:\n          \"bg-primary text-primary-foreground hover:bg-primary hover:text-primary-foreground focus:bg-primary focus:text-primary-foreground\",\n        day_today: \"bg-accent text-accent-foreground\",\n        day_outside:\n          \"day-outside text-muted-foreground aria-selected:bg-accent/50 aria-selected:text-muted-foreground\",\n        day_disabled: \"text-muted-foreground opacity-50\",\n        day_range_middle:\n          \"aria-selected:bg-accent aria-selected:text-accent-foreground\",\n        day_hidden: \"invisible\",\n        ...classNames,\n      }}\n      components={{\n        IconLeft: ({ className, ...props }) => (\n          <ChevronLeft className={cn(\"h-4 w-4\", className)} {...props} />\n        ),\n        IconRight: ({ className, ...props }) => (\n          <ChevronRight className={cn(\"h-4 w-4\", className)} {...props} />\n        ),\n      }}\n      {...props}\n    />\n  )\n}\nCalendar.displayName = \"Calendar\"\n\nexport { Calendar }\n","size_bytes":2695},"client/src/components/ui/toaster.tsx":{"content":"import { useToast } from \"@/hooks/use-toast\"\nimport {\n  Toast,\n  ToastClose,\n  ToastDescription,\n  ToastProvider,\n  ToastTitle,\n  ToastViewport,\n} from \"@/components/ui/toast\"\n\nexport function Toaster() {\n  const { toasts } = useToast()\n\n  return (\n    <ToastProvider>\n      {toasts.map(function ({ id, title, description, action, ...props }) {\n        return (\n          <Toast key={id} {...props}>\n            <div className=\"grid gap-1\">\n              {title && <ToastTitle>{title}</ToastTitle>}\n              {description && (\n                <ToastDescription>{description}</ToastDescription>\n              )}\n            </div>\n            {action}\n            <ToastClose />\n          </Toast>\n        )\n      })}\n      <ToastViewport />\n    </ToastProvider>\n  )\n}\n","size_bytes":772},"client/src/components/ui/popover.tsx":{"content":"import * as React from \"react\"\nimport * as PopoverPrimitive from \"@radix-ui/react-popover\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Popover = PopoverPrimitive.Root\n\nconst PopoverTrigger = PopoverPrimitive.Trigger\n\nconst PopoverContent = React.forwardRef<\n  React.ElementRef<typeof PopoverPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof PopoverPrimitive.Content>\n>(({ className, align = \"center\", sideOffset = 4, ...props }, ref) => (\n  <PopoverPrimitive.Portal>\n    <PopoverPrimitive.Content\n      ref={ref}\n      align={align}\n      sideOffset={sideOffset}\n      className={cn(\n        \"z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-popover-content-transform-origin]\",\n        className\n      )}\n      {...props}\n    />\n  </PopoverPrimitive.Portal>\n))\nPopoverContent.displayName = PopoverPrimitive.Content.displayName\n\nexport { Popover, PopoverTrigger, PopoverContent }\n","size_bytes":1280},"server/services/notificationService.ts":{"content":"import { logger } from \"../logger\";\nimport { storage } from \"../storage\";\n\ninterface PushNotification {\n  title: string;\n  body: string;\n  data?: Record<string, any>;\n  badge?: number;\n  sound?: string;\n  clickAction?: string;\n}\n\ninterface NotificationTarget {\n  userId: string;\n  deviceTokens: string[];\n  preferences: NotificationPreferences;\n}\n\ninterface NotificationPreferences {\n  pushEnabled: boolean;\n  emailEnabled: boolean;\n  newMessages: boolean;\n  newSubscribers: boolean;\n  paymentUpdates: boolean;\n  contentApproved: boolean;\n  contentRejected: boolean;\n  payoutProcessed: boolean;\n}\n\ninterface NotificationTemplate {\n  type: \"new_message\" | \"new_subscriber\" | \"payment_received\" | \"content_approved\" | \"content_rejected\" | \"payout_processed\";\n  title: string;\n  body: string;\n  data?: Record<string, any>;\n}\n\nclass NotificationService {\n  private templates: Record<string, NotificationTemplate> = {\n    new_message: {\n      type: \"new_message\",\n      title: \"New Message\",\n      body: \"You have a new message from {{senderName}}\",\n      data: { action: \"open_messages\" },\n    },\n    new_subscriber: {\n      type: \"new_subscriber\",\n      title: \"New Subscriber! 🎉\",\n      body: \"{{fanName}} just subscribed to your content\",\n      data: { action: \"open_dashboard\" },\n    },\n    payment_received: {\n      type: \"payment_received\",\n      title: \"Payment Received 💰\",\n      body: \"You received {{amount}} from {{fanName}}\",\n      data: { action: \"open_earnings\" },\n    },\n    content_approved: {\n      type: \"content_approved\",\n      title: \"Content Approved ✅\",\n      body: \"Your content '{{contentTitle}}' has been approved\",\n      data: { action: \"open_content\" },\n    },\n    content_rejected: {\n      type: \"content_rejected\",\n      title: \"Content Needs Review ⚠️\",\n      body: \"Your content '{{contentTitle}}' needs revision\",\n      data: { action: \"open_content\" },\n    },\n    payout_processed: {\n      type: \"payout_processed\",\n      title: \"Payout Processed 🏦\",\n      body: \"Your payout of {{amount}} has been processed\",\n      data: { action: \"open_earnings\" },\n    },\n  };\n\n  constructor() {\n    this.validateConfiguration();\n  }\n\n  private validateConfiguration() {\n    // Check if push notification services are configured\n    const fcmServerKey = process.env.FCM_SERVER_KEY;\n    const apnsCertPath = process.env.APNS_CERT_PATH;\n    \n    if (!fcmServerKey && !apnsCertPath) {\n      logger.debug(\"Push notification services not configured (optional feature)\");\n    }\n\n    logger.info(\"Notification service initialized\", {\n      fcmConfigured: !!fcmServerKey,\n      apnsConfigured: !!apnsCertPath,\n    });\n  }\n\n  async sendNotification(\n    target: NotificationTarget,\n    templateType: keyof typeof this.templates,\n    variables: Record<string, string> = {}\n  ): Promise<void> {\n    try {\n      const template = this.templates[templateType];\n      if (!template) {\n        throw new Error(`Unknown notification template: ${templateType}`);\n      }\n\n      // Check user preferences\n      if (!this.shouldSendNotification(target.preferences, template.type)) {\n        logger.debug(\"Notification skipped due to user preferences\", {\n          userId: target.userId,\n          type: template.type,\n        });\n        return;\n      }\n\n      // Render template with variables\n      const notification = this.renderTemplate(template, variables);\n\n      // Send push notifications\n      if (target.preferences.pushEnabled && target.deviceTokens.length > 0) {\n        await this.sendPushNotification(target.deviceTokens, notification);\n      }\n\n      // Send email notifications (if enabled)\n      if (target.preferences.emailEnabled) {\n        await this.sendEmailNotification(target.userId, notification);\n      }\n\n      logger.info(\"Notification sent successfully\", {\n        userId: target.userId,\n        type: template.type,\n        pushSent: target.preferences.pushEnabled && target.deviceTokens.length > 0,\n        emailSent: target.preferences.emailEnabled,\n      });\n    } catch (error) {\n      logger.error(\"Failed to send notification\", {\n        error,\n        userId: target.userId,\n        templateType,\n      });\n    }\n  }\n\n  private shouldSendNotification(preferences: NotificationPreferences, type: string): boolean {\n    if (!preferences.pushEnabled && !preferences.emailEnabled) {\n      return false;\n    }\n\n    switch (type) {\n      case \"new_message\":\n        return preferences.newMessages;\n      case \"new_subscriber\":\n        return preferences.newSubscribers;\n      case \"payment_received\":\n        return preferences.paymentUpdates;\n      case \"content_approved\":\n        return preferences.contentApproved;\n      case \"content_rejected\":\n        return preferences.contentRejected;\n      case \"payout_processed\":\n        return preferences.payoutProcessed;\n      default:\n        return true;\n    }\n  }\n\n  private renderTemplate(template: NotificationTemplate, variables: Record<string, string>): PushNotification {\n    let title = template.title;\n    let body = template.body;\n\n    // Replace variables in template\n    for (const [key, value] of Object.entries(variables)) {\n      const placeholder = `{{${key}}}`;\n      title = title.replace(new RegExp(placeholder, 'g'), value);\n      body = body.replace(new RegExp(placeholder, 'g'), value);\n    }\n\n    return {\n      title,\n      body,\n      data: template.data,\n      badge: 1,\n      sound: \"default\",\n    };\n  }\n\n  private async sendPushNotification(deviceTokens: string[], notification: PushNotification): Promise<void> {\n    try {\n      // Firebase Cloud Messaging (FCM)\n      await this.sendFCMNotification(deviceTokens, notification);\n      \n      // Apple Push Notification Service (APNS) - if iOS tokens detected\n      const iosTokens = deviceTokens.filter(token => this.isIOSToken(token));\n      if (iosTokens.length > 0) {\n        await this.sendAPNSNotification(iosTokens, notification);\n      }\n    } catch (error) {\n      logger.error(\"Push notification failed\", { error, deviceTokens: deviceTokens.length });\n      throw error;\n    }\n  }\n\n  private async sendFCMNotification(deviceTokens: string[], notification: PushNotification): Promise<void> {\n    const fcmServerKey = process.env.FCM_SERVER_KEY;\n    if (!fcmServerKey) {\n      logger.debug(\"FCM not configured, skipping push notification\");\n      return;\n    }\n\n    // Filter out iOS tokens for FCM (FCM handles Android)\n    const androidTokens = deviceTokens.filter(token => !this.isIOSToken(token));\n    if (androidTokens.length === 0) return;\n\n    const payload = {\n      registration_ids: androidTokens,\n      notification: {\n        title: notification.title,\n        body: notification.body,\n        sound: notification.sound,\n        badge: notification.badge,\n        click_action: notification.clickAction,\n      },\n      data: notification.data || {},\n    };\n\n    try {\n      const response = await fetch(\"https://fcm.googleapis.com/fcm/send\", {\n        method: \"POST\",\n        headers: {\n          \"Authorization\": `key=${fcmServerKey}`,\n          \"Content-Type\": \"application/json\",\n        },\n        body: JSON.stringify(payload),\n      });\n\n      if (!response.ok) {\n        throw new Error(`FCM request failed: ${response.status}`);\n      }\n\n      const result = await response.json();\n      logger.debug(\"FCM notification sent\", { \n        success: result.success, \n        failure: result.failure,\n        tokens: androidTokens.length,\n      });\n    } catch (error) {\n      logger.error(\"FCM notification failed\", { error });\n      throw error;\n    }\n  }\n\n  private async sendAPNSNotification(deviceTokens: string[], notification: PushNotification): Promise<void> {\n    const apnsCertPath = process.env.APNS_CERT_PATH;\n    if (!apnsCertPath) {\n      logger.debug(\"APNS not configured, skipping iOS push notification\");\n      return;\n    }\n\n    // TODO: Implement APNS using node-apn or similar library\n    logger.debug(\"APNS notification would be sent\", { tokens: deviceTokens.length });\n  }\n\n  private async sendEmailNotification(userId: string, notification: PushNotification): Promise<void> {\n    // TODO: Implement email notifications using SendGrid, AWS SES, or similar\n    logger.debug(\"Email notification would be sent\", { userId, title: notification.title });\n  }\n\n  private isIOSToken(token: string): boolean {\n    // iOS tokens are typically 64 characters of hexadecimal\n    return /^[a-f0-9]{64}$/i.test(token);\n  }\n\n  async registerDeviceToken(userId: string, token: string, platform: \"ios\" | \"android\"): Promise<void> {\n    try {\n      // TODO: Store device tokens in database\n      // This would require adding a device_tokens table to the schema\n      logger.info(\"Device token registered\", { userId, platform, tokenLength: token.length });\n    } catch (error) {\n      logger.error(\"Failed to register device token\", { error, userId });\n      throw error;\n    }\n  }\n\n  async updateNotificationPreferences(userId: string, preferences: Partial<NotificationPreferences>): Promise<void> {\n    try {\n      // TODO: Store preferences in user profile or separate table\n      logger.info(\"Notification preferences updated\", { userId, preferences });\n    } catch (error) {\n      logger.error(\"Failed to update notification preferences\", { error, userId });\n      throw error;\n    }\n  }\n\n  async sendBulkNotification(\n    userIds: string[],\n    templateType: keyof typeof this.templates,\n    variables: Record<string, string> = {}\n  ): Promise<void> {\n    logger.info(\"Sending bulk notification\", {\n      recipientCount: userIds.length,\n      templateType,\n    });\n\n    const promises = userIds.map(async (userId) => {\n      try {\n        // TODO: Get user's device tokens and preferences from database\n        const target: NotificationTarget = {\n          userId,\n          deviceTokens: [], // Would fetch from database\n          preferences: {\n            pushEnabled: true,\n            emailEnabled: true,\n            newMessages: true,\n            newSubscribers: true,\n            paymentUpdates: true,\n            contentApproved: true,\n            contentRejected: true,\n            payoutProcessed: true,\n          },\n        };\n\n        await this.sendNotification(target, templateType, variables);\n      } catch (error) {\n        logger.error(\"Failed to send notification to user\", { error, userId });\n      }\n    });\n\n    await Promise.all(promises);\n    logger.info(\"Bulk notification completed\", { userIds: userIds.length });\n  }\n\n  // Helper methods for common notification scenarios\n  async notifyNewMessage(recipientId: string, senderName: string): Promise<void> {\n    // TODO: Get recipient's notification target from database\n    const target: NotificationTarget = {\n      userId: recipientId,\n      deviceTokens: [],\n      preferences: { pushEnabled: true, emailEnabled: true, newMessages: true } as NotificationPreferences,\n    };\n\n    await this.sendNotification(target, \"new_message\", { senderName });\n  }\n\n  async notifyNewSubscriber(creatorId: string, fanName: string): Promise<void> {\n    const target: NotificationTarget = {\n      userId: creatorId,\n      deviceTokens: [],\n      preferences: { pushEnabled: true, emailEnabled: true, newSubscribers: true } as NotificationPreferences,\n    };\n\n    await this.sendNotification(target, \"new_subscriber\", { fanName });\n  }\n\n  async notifyPaymentReceived(creatorId: string, amount: string, fanName: string): Promise<void> {\n    const target: NotificationTarget = {\n      userId: creatorId,\n      deviceTokens: [],\n      preferences: { pushEnabled: true, emailEnabled: true, paymentUpdates: true } as NotificationPreferences,\n    };\n\n    await this.sendNotification(target, \"payment_received\", { amount, fanName });\n  }\n}\n\nexport const notificationService = new NotificationService();\n","size_bytes":11760}},"version":2}