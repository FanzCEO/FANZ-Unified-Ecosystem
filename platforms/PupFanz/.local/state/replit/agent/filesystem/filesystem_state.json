{"file_contents":{"client/src/pages/Home.tsx":{"content":"import { useAuth } from \"@/hooks/useAuth\";\nimport Header from \"@/components/layout/Header\";\nimport Footer from \"@/components/layout/Footer\";\nimport FanzInfinityScrollFeed from \"@/components/feed/FanzInfinityScrollFeed\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { TrendingUp, Shield, Heart, Users } from \"lucide-react\";\n\nexport default function Home() {\n  const { user } = useAuth();\n\n  return (\n    <div className=\"min-h-screen\">\n      <Header />\n      \n      <main className=\"pt-20 md:pt-32\">\n        <div className=\"max-w-7xl mx-auto px-3 sm:px-4 md:px-6 lg:px-8\">\n          {/* Welcome Banner */}\n          <section className=\"py-4 md:py-8 mb-4 md:mb-8\">\n            <div className=\"flex flex-col gap-3 md:gap-4\">\n              <div>\n                <h1 className=\"neon-heading text-2xl sm:text-3xl md:text-4xl mb-2\">\n                  Welcome to Your\n                  <span className=\"neon-text-accent ml-2\">Pack Feed</span>\n                </h1>\n                <p className=\"text-sm md:text-base text-muted\">\n                  {(user as any)?.role === 'creator' \n                    ? \"Share your content and connect with your pack\"\n                    : \"Discover amazing content from creators you love\"\n                  }\n                </p>\n              </div>\n              \n              {/* Safety Indicators - Scrollable on mobile */}\n              <div className=\"flex gap-2 overflow-x-auto pb-2 md:pb-0\">\n                <Badge className=\"safety-badge safety-badge-verified whitespace-nowrap\" data-testid=\"badge-age-verified\">\n                  <Shield className=\"mr-1 h-3 w-3\" />\n                  <span className=\"hidden sm:inline\">18+ Verified</span>\n                  <span className=\"sm:hidden\">18+</span>\n                </Badge>\n                <Badge className=\"safety-badge safety-badge-consent whitespace-nowrap\" data-testid=\"badge-consent-clear\">\n                  <Heart className=\"mr-1 h-3 w-3\" />\n                  <span className=\"hidden sm:inline\">Consent-Clear</span>\n                  <span className=\"sm:hidden\">Consent</span>\n                </Badge>\n                <Badge className=\"safety-badge safety-badge-aftercare whitespace-nowrap\" data-testid=\"badge-pack-safe\">\n                  <Users className=\"mr-1 h-3 w-3\" />\n                  <span className=\"hidden sm:inline\">Pack-Safe</span>\n                  <span className=\"sm:hidden\">Safe</span>\n                </Badge>\n              </div>\n            </div>\n          </section>\n\n          {/* Main Feed Container */}\n          <div className=\"grid grid-cols-1 lg:grid-cols-4 gap-4 md:gap-6\">\n            {/* Main Feed - Takes up most space */}\n            <div className=\"lg:col-span-3 order-2 lg:order-1\">\n              <FanzInfinityScrollFeed />\n            </div>\n\n            {/* Sidebar - Stats & Info - Stacks on mobile */}\n            <div className=\"space-y-4 md:space-y-6 order-1 lg:order-2\">\n              {/* Pack Stats */}\n              {(user as any)?.role === 'creator' && (\n                <Card className=\"pack-card\">\n                  <CardHeader>\n                    <CardTitle className=\"flex items-center text-lg\">\n                      <TrendingUp className=\"mr-2 h-4 w-4\" />\n                      Your Stats\n                    </CardTitle>\n                  </CardHeader>\n                  <CardContent className=\"space-y-4\">\n                    <div>\n                      <p className=\"text-2xl font-bold text-primary\" data-testid=\"text-pack-members\">0</p>\n                      <p className=\"text-xs text-muted\">Pack Members</p>\n                    </div>\n                    <div>\n                      <p className=\"text-2xl font-bold text-secondary\" data-testid=\"text-total-posts\">0</p>\n                      <p className=\"text-xs text-muted\">Total Posts</p>\n                    </div>\n                    <div>\n                      <p className=\"text-2xl font-bold text-accent\" data-testid=\"text-total-engagement\">0</p>\n                      <p className=\"text-xs text-muted\">Engagement</p>\n                    </div>\n                  </CardContent>\n                </Card>\n              )}\n\n              {/* Safety Reminder */}\n              <Card className=\"pack-card bg-gradient-to-br from-volt/10 to-cobalt/10\">\n                <CardHeader>\n                  <CardTitle className=\"flex items-center text-lg\">\n                    <Shield className=\"mr-2 h-4 w-4\" />\n                    Pack Safety\n                  </CardTitle>\n                </CardHeader>\n                <CardContent className=\"space-y-2\">\n                  <p className=\"text-sm text-muted-foreground\">\n                    All content is age-verified via VerifyMy\n                  </p>\n                  <div className=\"space-y-1\">\n                    <div className=\"flex items-center justify-between text-sm\">\n                      <span>Age Verified</span>\n                      <Badge variant=\"outline\" className=\"text-xs\">âœ“</Badge>\n                    </div>\n                    <div className=\"flex items-center justify-between text-sm\">\n                      <span>Consent Clear</span>\n                      <Badge variant=\"outline\" className=\"text-xs\">âœ“</Badge>\n                    </div>\n                  </div>\n                </CardContent>\n              </Card>\n\n              {/* Feed Info */}\n              <Card className=\"pack-card\">\n                <CardHeader>\n                  <CardTitle className=\"text-lg\">Feed Info</CardTitle>\n                </CardHeader>\n                <CardContent className=\"space-y-2 text-sm text-muted-foreground\">\n                  <p>ðŸ”„ Infinite scroll enabled</p>\n                  <p>ðŸ“¢ Sponsored content every 4 posts</p>\n                  <p>ðŸ”’ Locked content requires subscription</p>\n                  <p>ðŸ†“ Free posts available for all</p>\n                </CardContent>\n              </Card>\n            </div>\n          </div>\n        </div>\n      </main>\n\n      <Footer />\n    </div>\n  );\n}\n","size_bytes":6065},"client/src/pages/not-found.tsx":{"content":"import { Card, CardContent } from \"@/components/ui/card\";\nimport { AlertCircle } from \"lucide-react\";\n\nexport default function NotFound() {\n  return (\n    <div className=\"min-h-screen w-full flex items-center justify-center bg-gray-50\">\n      <Card className=\"w-full max-w-md mx-4\">\n        <CardContent className=\"pt-6\">\n          <div className=\"flex mb-4 gap-2\">\n            <AlertCircle className=\"h-8 w-8 text-red-500\" />\n            <h1 className=\"text-2xl font-bold text-gray-900\">404 Page Not Found</h1>\n          </div>\n\n          <p className=\"mt-4 text-sm text-gray-600\">\n            Did you forget to add the page to the router?\n          </p>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","size_bytes":711},"client/src/components/ui/dialog.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as DialogPrimitive from \"@radix-ui/react-dialog\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Dialog = DialogPrimitive.Root\n\nconst DialogTrigger = DialogPrimitive.Trigger\n\nconst DialogPortal = DialogPrimitive.Portal\n\nconst DialogClose = DialogPrimitive.Close\n\nconst DialogOverlay = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Overlay\n    ref={ref}\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n  />\n))\nDialogOverlay.displayName = DialogPrimitive.Overlay.displayName\n\nconst DialogContent = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <DialogPortal>\n    <DialogOverlay />\n    <DialogPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg\",\n        className\n      )}\n      {...props}\n    >\n      {children}\n      <DialogPrimitive.Close className=\"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground\">\n        <X className=\"h-4 w-4\" />\n        <span className=\"sr-only\">Close</span>\n      </DialogPrimitive.Close>\n    </DialogPrimitive.Content>\n  </DialogPortal>\n))\nDialogContent.displayName = DialogPrimitive.Content.displayName\n\nconst DialogHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-1.5 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nDialogHeader.displayName = \"DialogHeader\"\n\nconst DialogFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nDialogFooter.displayName = \"DialogFooter\"\n\nconst DialogTitle = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Title\n    ref={ref}\n    className={cn(\n      \"text-lg font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nDialogTitle.displayName = DialogPrimitive.Title.displayName\n\nconst DialogDescription = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nDialogDescription.displayName = DialogPrimitive.Description.displayName\n\nexport {\n  Dialog,\n  DialogPortal,\n  DialogOverlay,\n  DialogClose,\n  DialogTrigger,\n  DialogContent,\n  DialogHeader,\n  DialogFooter,\n  DialogTitle,\n  DialogDescription,\n}\n","size_bytes":3848},"shared/schema.ts":{"content":"import { sql } from 'drizzle-orm';\nimport {\n  index,\n  uniqueIndex,\n  jsonb,\n  pgTable,\n  timestamp,\n  varchar,\n  text,\n  integer,\n  boolean,\n  decimal,\n  bigserial,\n  inet,\n} from \"drizzle-orm/pg-core\";\nimport { relations } from \"drizzle-orm\";\nimport { createInsertSchema } from \"drizzle-zod\";\nimport { z } from \"zod\";\n\n// Session storage table (mandatory for Replit Auth)\nexport const sessions = pgTable(\n  \"sessions\",\n  {\n    sid: varchar(\"sid\").primaryKey(),\n    sess: jsonb(\"sess\").notNull(),\n    expire: timestamp(\"expire\").notNull(),\n  },\n  (table) => [index(\"IDX_session_expire\").on(table.expire)],\n);\n\n// =============================================================================\n// PACK COMMUNITY SYSTEM\n// =============================================================================\n\n// Packs - Community groups that users can create and join\nexport const packs = pgTable(\"packs\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  name: varchar(\"name\", { length: 100 }).notNull(),\n  slug: varchar(\"slug\", { length: 100 }).unique().notNull(),\n  description: text(\"description\"),\n  creatorId: varchar(\"creator_id\").references(() => users.id).notNull(),\n  avatarUrl: varchar(\"avatar_url\"),\n  bannerUrl: varchar(\"banner_url\"),\n  packType: varchar(\"pack_type\", { enum: ['alpha', 'playful', 'supportive', 'training'] }).default('alpha'),\n  isPublic: boolean(\"is_public\").default(true),\n  memberCount: integer(\"member_count\").default(0),\n  maxMembers: integer(\"max_members\").default(1000),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n}, (table) => [\n  index(\"idx_pack_creator\").on(table.creatorId),\n  index(\"idx_pack_slug\").on(table.slug),\n  index(\"idx_pack_type\").on(table.packType),\n]);\n\n// Pack Members - Track membership in packs\nexport const packMembers = pgTable(\"pack_members\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  packId: varchar(\"pack_id\").references(() => packs.id).notNull(),\n  userId: varchar(\"user_id\").references(() => users.id).notNull(),\n  role: varchar(\"role\", { enum: ['owner', 'moderator', 'member'] }).default('member'),\n  joinedAt: timestamp(\"joined_at\").defaultNow(),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n}, (table) => [\n  index(\"idx_pack_member_pack\").on(table.packId),\n  index(\"idx_pack_member_user\").on(table.userId),\n  uniqueIndex(\"idx_pack_member_unique\").on(table.packId, table.userId),\n]);\n\n// =============================================================================\n// EXISTING TABLES (UNCHANGED)\n// =============================================================================\n\n// Keep existing users table\nexport const users = pgTable(\"users\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  username: varchar(\"username\").unique(),\n  email: varchar(\"email\").unique(),\n  password: text(\"password\"),\n  firstName: varchar(\"first_name\"),\n  lastName: varchar(\"last_name\"),\n  profileImageUrl: varchar(\"profile_image_url\"),\n  role: varchar(\"role\", { enum: ['fan', 'creator', 'admin'] }).default('fan'),\n  authProvider: varchar(\"auth_provider\", { enum: ['local', 'replit'] }).default('local'),\n  status: varchar(\"status\", { enum: ['active', 'suspended', 'pending'] }).default('pending'),\n  // Onboarding tracking fields\n  onboardingCompleted: boolean(\"onboarding_completed\").default(false),\n  onboardingStep: integer(\"onboarding_step\").default(0),\n  preferredInterests: jsonb(\"preferred_interests\").default([]), // For Fanz personalization\n  pronouns: varchar(\"pronouns\"), // For Creator profile\n  stageName: varchar(\"stage_name\"), // For Creator profile\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\n// Keep existing profiles table\nexport const profiles = pgTable(\"profiles\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  userId: varchar(\"user_id\").references(() => users.id).notNull(),\n  displayName: varchar(\"display_name\"),\n  bio: text(\"bio\"),\n  avatarUrl: varchar(\"avatar_url\"),\n  bannerUrl: varchar(\"banner_url\"),\n  kycStatus: varchar(\"kyc_status\", { enum: ['pending', 'verified', 'rejected'] }).default('pending'),\n  ageVerified: boolean(\"age_verified\").default(false),\n  allowsFreeAccess: boolean(\"allows_free_access\").default(false),\n  packType: varchar(\"pack_type\", { enum: ['alpha', 'playful', 'supportive', 'training'] }).default('alpha'),\n  isAftercareFriendly: boolean(\"is_aftercare_friendly\").default(false),\n  safetyBadges: jsonb(\"safety_badges\").default([]),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\n// Keep existing media_assets table\nexport const mediaAssets = pgTable(\"media_assets\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  ownerId: varchar(\"owner_id\").references(() => users.id).notNull(),\n  title: varchar(\"title\").notNull(),\n  description: text(\"description\"),\n  objectPath: varchar(\"object_path\").notNull(),\n  mimeType: varchar(\"mime_type\").notNull(),\n  fileSize: integer(\"file_size\"),\n  status: varchar(\"status\", { enum: ['pending', 'approved', 'rejected', 'flagged'] }).default('pending'),\n  forensicSignature: varchar(\"forensic_signature\"),\n  accessLevel: varchar(\"access_level\", { enum: ['pack', 'premium', 'ppv'] }).default('pack'),\n  price: decimal(\"price\", { precision: 10, scale: 2 }),\n  tags: jsonb(\"tags\").default([]),\n  viewCount: integer(\"view_count\").default(0),\n  likeCount: integer(\"like_count\").default(0),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\n// Keep existing tables\nexport const kycVerifications = pgTable(\"kyc_verifications\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  userId: varchar(\"user_id\").references(() => users.id).notNull(),\n  provider: varchar(\"provider\").notNull().default('verifymy'),\n  verificationId: varchar(\"verification_id\").notNull(),\n  status: varchar(\"status\", { enum: ['pending', 'verified', 'rejected'] }).default('pending'),\n  dataJson: jsonb(\"data_json\"),\n  documentPath: varchar(\"document_path\"),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\nexport const records2257 = pgTable(\"records_2257\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  userId: varchar(\"user_id\").references(() => users.id).notNull(),\n  docType: varchar(\"doc_type\", { enum: ['drivers_license', 'passport', 'state_id'] }).notNull(),\n  documentPath: varchar(\"document_path\").notNull(),\n  checksum: varchar(\"checksum\").notNull(),\n  expirationDate: timestamp(\"expiration_date\"),\n  verifiedAt: timestamp(\"verified_at\"),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n});\n\n// Co-Star/Collaborator Verification System\nexport const coStarVerifications = pgTable(\"co_star_verifications\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  creatorId: varchar(\"creator_id\").references(() => users.id).notNull(),\n  coStarUserId: varchar(\"co_star_user_id\").references(() => users.id), // null if not yet registered\n  coStarEmail: varchar(\"co_star_email\"), // For invitations before registration\n  status: varchar(\"status\", { \n    enum: ['pending_invite', 'invited', 'pending_kyc', 'verified', 'rejected', 'expired'] \n  }).default('pending_invite'),\n  verificationType: varchar(\"verification_type\", { \n    enum: ['live_stream', 'video_collab', 'photo_shoot', 'general'] \n  }).notNull(),\n  contentId: varchar(\"content_id\").references(() => content.id), // Optional: specific content\n  invitationToken: varchar(\"invitation_token\").unique().notNull(), // Secure token for invitation link (required, unique)\n  kycVerificationId: varchar(\"kyc_verification_id\").references(() => kycVerifications.id), // Link to co-star's KYC\n  tokenConsumed: boolean(\"token_consumed\").default(false), // Single-use token enforcement\n  expiresAt: timestamp(\"expires_at\"), // Invitation expiration\n  verifiedAt: timestamp(\"verified_at\"),\n  invitedAt: timestamp(\"invited_at\"),\n  notes: text(\"notes\"), // Creator notes about collaboration\n  metadata: jsonb(\"metadata\").default({}), // Additional details (shoot date, location, etc.)\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n}, (table) => [\n  index(\"idx_costar_creator\").on(table.creatorId, table.status),\n  index(\"idx_costar_user\").on(table.coStarUserId),\n  index(\"idx_costar_token\").on(table.invitationToken),\n  index(\"idx_costar_email\").on(table.coStarEmail),\n  // Ensure at least one of coStarUserId or coStarEmail is present\n  sql`CONSTRAINT costar_identifier_check CHECK (\n    co_star_user_id IS NOT NULL OR co_star_email IS NOT NULL\n  )`,\n]);\n\n// =============================================================================\n// MULTI-PLATFORM DISTRIBUTION SYSTEM\n// =============================================================================\n\n// Social Media Accounts - Store connected platform accounts for creators\nexport const socialMediaAccounts = pgTable(\"social_media_accounts\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  creatorUserId: varchar(\"creator_user_id\").references(() => users.id).notNull(),\n  platform: varchar(\"platform\", { \n    enum: ['twitter', 'instagram', 'tiktok', 'onlyfans', 'fansly', 'reddit', 'tumblr', 'manyvids'] \n  }).notNull(),\n  platformUserId: varchar(\"platform_user_id\"), // Platform-specific user ID\n  platformUsername: varchar(\"platform_username\"), // Display username\n  accessToken: text(\"access_token\"), // Encrypted access token\n  refreshToken: text(\"refresh_token\"), // Encrypted refresh token\n  tokenExpiresAt: timestamp(\"token_expires_at\"),\n  status: varchar(\"status\", { enum: ['connected', 'expired', 'error', 'revoked'] }).default('connected'),\n  lastSyncAt: timestamp(\"last_sync_at\"),\n  metadata: jsonb(\"metadata\").default({}), // Platform-specific settings\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n}, (table) => [\n  index(\"idx_social_creator\").on(table.creatorUserId, table.platform),\n  index(\"idx_social_platform\").on(table.platform, table.status),\n  // Prevent duplicate platform connections for the same user\n  uniqueIndex(\"idx_social_unique\").on(table.creatorUserId, table.platform, table.platformUserId),\n]);\n\n// Distribution Jobs - Track content distribution to external platforms\nexport const distributionJobs = pgTable(\"distribution_jobs\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  contentId: varchar(\"content_id\").references(() => content.id).notNull(),\n  creatorUserId: varchar(\"creator_user_id\").references(() => users.id).notNull(),\n  socialMediaAccountId: varchar(\"social_media_account_id\").references(() => socialMediaAccounts.id).notNull(),\n  platform: varchar(\"platform\").notNull(), // Duplicated for easy querying\n  status: varchar(\"status\", { \n    enum: ['queued', 'processing', 'published', 'failed', 'cancelled', 'scheduled'] \n  }).default('queued'),\n  scheduledFor: timestamp(\"scheduled_for\"), // For scheduled posts\n  publishedAt: timestamp(\"published_at\"),\n  platformPostId: varchar(\"platform_post_id\"), // ID from the platform\n  platformUrl: varchar(\"platform_url\"), // Direct link to the post\n  errorMessage: text(\"error_message\"),\n  retryCount: integer(\"retry_count\").default(0),\n  metadata: jsonb(\"metadata\").default({}), // Platform-specific data\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n}, (table) => [\n  index(\"idx_dist_content\").on(table.contentId),\n  index(\"idx_dist_creator\").on(table.creatorUserId, table.status),\n  index(\"idx_dist_scheduled\").on(table.scheduledFor),\n  index(\"idx_dist_platform\").on(table.platform, table.status),\n]);\n\n// QR Codes - Generate and track QR codes for content sharing\nexport const qrCodes = pgTable(\"qr_codes\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  contentId: varchar(\"content_id\").references(() => content.id), // Optional: can be for profile too\n  creatorUserId: varchar(\"creator_user_id\").references(() => users.id).notNull(),\n  targetType: varchar(\"target_type\", { enum: ['content', 'profile', 'subscription', 'custom'] }).notNull(),\n  targetUrl: varchar(\"target_url\").notNull(), // URL the QR code points to\n  qrCodeImagePath: varchar(\"qr_code_image_path\").notNull(), // Path to generated QR image\n  scanCount: integer(\"scan_count\").default(0),\n  lastScannedAt: timestamp(\"last_scanned_at\"),\n  metadata: jsonb(\"metadata\").default({}), // Custom styling, branding options\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n}, (table) => [\n  index(\"idx_qr_creator\").on(table.creatorUserId),\n  index(\"idx_qr_content\").on(table.contentId),\n  index(\"idx_qr_target\").on(table.targetType),\n]);\n\n// Smart Links - Track smart links with analytics\nexport const smartLinks = pgTable(\"smart_links\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  shortCode: varchar(\"short_code\").unique().notNull(), // e.g., \"abc123\"\n  contentId: varchar(\"content_id\").references(() => content.id), // Optional\n  creatorUserId: varchar(\"creator_user_id\").references(() => users.id).notNull(),\n  targetUrl: varchar(\"target_url\").notNull(), // Original URL\n  title: varchar(\"title\"), // Link title for display\n  description: text(\"description\"), // Link description\n  clickCount: integer(\"click_count\").default(0),\n  uniqueClickCount: integer(\"unique_click_count\").default(0),\n  lastClickedAt: timestamp(\"last_clicked_at\"),\n  expiresAt: timestamp(\"expires_at\"), // Optional expiration\n  status: varchar(\"status\", { enum: ['active', 'expired', 'disabled'] }).default('active'),\n  metadata: jsonb(\"metadata\").default({}), // UTM params, custom tracking data\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n}, (table) => [\n  index(\"idx_link_short\").on(table.shortCode),\n  index(\"idx_link_creator\").on(table.creatorUserId),\n  index(\"idx_link_content\").on(table.contentId),\n  index(\"idx_link_status\").on(table.status, table.expiresAt),\n]);\n\n// =============================================================================\n// LIVE STREAM INFRASTRUCTURE\n// =============================================================================\n\n// Live Streams - Real-time streaming sessions\nexport const liveStreams = pgTable(\"live_streams\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  creatorUserId: varchar(\"creator_user_id\").references(() => users.id).notNull(),\n  title: varchar(\"title\").notNull(),\n  description: text(\"description\"),\n  status: varchar(\"status\", { \n    enum: ['scheduled', 'live', 'ended', 'cancelled'] \n  }).default('scheduled'),\n  requiresCoStarVerification: boolean(\"requires_co_star_verification\").default(false),\n  scheduledStartTime: timestamp(\"scheduled_start_time\"),\n  actualStartTime: timestamp(\"actual_start_time\"),\n  endedAt: timestamp(\"ended_at\"),\n  viewerCount: integer(\"viewer_count\").default(0),\n  peakViewerCount: integer(\"peak_viewer_count\").default(0),\n  totalTipsAmount: decimal(\"total_tips_amount\", { precision: 10, scale: 2 }).default('0'),\n  streamKey: varchar(\"stream_key\"), // For RTMP/WebRTC authentication\n  streamUrl: varchar(\"stream_url\"), // Public viewing URL\n  recordingEnabled: boolean(\"recording_enabled\").default(true),\n  autoHighlightsEnabled: boolean(\"auto_highlights_enabled\").default(true),\n  chatEnabled: boolean(\"chat_enabled\").default(true),\n  tipsEnabled: boolean(\"tips_enabled\").default(true),\n  visibility: varchar(\"visibility\", { enum: ['public', 'subscribers', 'private'] }).default('public'),\n  metadata: jsonb(\"metadata\").default({}), // Platform-specific settings\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n}, (table) => [\n  index(\"idx_stream_creator\").on(table.creatorUserId, table.status),\n  index(\"idx_stream_status\").on(table.status, table.scheduledStartTime),\n  index(\"idx_stream_scheduled\").on(table.scheduledStartTime),\n]);\n\n// Stream Participants - Track viewers and co-stars in streams\nexport const streamParticipants = pgTable(\"stream_participants\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  streamId: varchar(\"stream_id\").references(() => liveStreams.id).notNull(),\n  userId: varchar(\"user_id\").references(() => users.id).notNull(),\n  role: varchar(\"role\", { enum: ['host', 'co_star', 'viewer', 'moderator'] }).notNull(),\n  coStarVerificationId: varchar(\"co_star_verification_id\").references(() => coStarVerifications.id), // Required for co_star role\n  joinedAt: timestamp(\"joined_at\").defaultNow(),\n  leftAt: timestamp(\"left_at\"),\n  watchTimeSeconds: integer(\"watch_time_seconds\").default(0),\n  tipsSentAmount: decimal(\"tips_sent_amount\", { precision: 10, scale: 2 }).default('0'),\n  messagesSent: integer(\"messages_sent\").default(0),\n  metadata: jsonb(\"metadata\").default({}),\n}, (table) => [\n  index(\"idx_participant_stream\").on(table.streamId, table.role),\n  index(\"idx_participant_user\").on(table.userId, table.streamId),\n  uniqueIndex(\"idx_participant_unique\").on(table.streamId, table.userId),\n]);\n\n// Stream Recordings - Recorded streams and auto-generated highlights\nexport const streamRecordings = pgTable(\"stream_recordings\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  streamId: varchar(\"stream_id\").references(() => liveStreams.id).notNull(),\n  type: varchar(\"type\", { enum: ['full_recording', 'highlight', 'clip'] }).notNull(),\n  title: varchar(\"title\").notNull(),\n  description: text(\"description\"),\n  objectPath: varchar(\"object_path\").notNull(), // Object storage path\n  duration: integer(\"duration\"), // Duration in seconds\n  fileSize: integer(\"file_size\"),\n  thumbnailPath: varchar(\"thumbnail_path\"),\n  viewCount: integer(\"view_count\").default(0),\n  status: varchar(\"status\", { enum: ['processing', 'ready', 'failed'] }).default('processing'),\n  startTime: integer(\"start_time\"), // Offset from stream start (for highlights)\n  endTime: integer(\"end_time\"), // Offset from stream start (for highlights)\n  aiGenerated: boolean(\"ai_generated\").default(false), // Auto-generated by AI\n  metadata: jsonb(\"metadata\").default({}),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n}, (table) => [\n  index(\"idx_recording_stream\").on(table.streamId, table.type),\n  index(\"idx_recording_status\").on(table.status),\n  index(\"idx_recording_created\").on(table.createdAt),\n]);\n\n// =============================================================================\n// AI MARKETING AUTOMATION\n// =============================================================================\n\n// Marketing Campaigns - Automated marketing campaigns\nexport const marketingCampaigns = pgTable(\"marketing_campaigns\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  creatorId: varchar(\"creator_id\").references(() => users.id).notNull(),\n  name: varchar(\"name\").notNull(),\n  type: varchar(\"type\", { \n    enum: ['push_notification', 'email', 'social_post', 'retargeting', 'automated'] \n  }).notNull(),\n  status: varchar(\"status\", { \n    enum: ['draft', 'active', 'paused', 'completed', 'archived'] \n  }).default('draft'),\n  trigger: varchar(\"trigger\", { \n    enum: ['manual', 'subscription_created', 'subscription_cancelled', 'content_liked', 'content_viewed', \n           'tip_received', 'milestone_reached', 'inactivity', 'scheduled'] \n  }).notNull(),\n  triggerConditions: jsonb(\"trigger_conditions\").default({}), // Trigger configuration\n  targetSegmentId: varchar(\"target_segment_id\").references(() => fanSegments.id),\n  targetAllFans: boolean(\"target_all_fans\").default(false),\n  messageTemplate: text(\"message_template\").notNull(),\n  subject: varchar(\"subject\"), // For email campaigns\n  mediaPath: varchar(\"media_path\"), // Attached media for notifications/posts\n  ctaText: varchar(\"cta_text\"), // Call-to-action text\n  ctaUrl: varchar(\"cta_url\"), // Call-to-action URL\n  scheduledFor: timestamp(\"scheduled_for\"), // For scheduled campaigns\n  startDate: timestamp(\"start_date\"),\n  endDate: timestamp(\"end_date\"),\n  maxExecutions: integer(\"max_executions\"), // Max times to run automated campaigns\n  executionCount: integer(\"execution_count\").default(0),\n  lastExecutedAt: timestamp(\"last_executed_at\"),\n  // Analytics\n  totalSent: integer(\"total_sent\").default(0),\n  totalOpened: integer(\"total_opened\").default(0),\n  totalClicked: integer(\"total_clicked\").default(0),\n  totalConverted: integer(\"total_converted\").default(0),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n}, (table) => [\n  index(\"idx_campaign_creator\").on(table.creatorId, table.status),\n  index(\"idx_campaign_status\").on(table.status, table.scheduledFor),\n  index(\"idx_campaign_trigger\").on(table.trigger, table.status),\n]);\n\n// Fan Segments - Targeted audience groups for campaigns\nexport const fanSegments = pgTable(\"fan_segments\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  creatorId: varchar(\"creator_id\").references(() => users.id).notNull(),\n  name: varchar(\"name\").notNull(),\n  description: text(\"description\"),\n  segmentType: varchar(\"segment_type\", { \n    enum: ['manual', 'auto_rule', 'behavioral', 'demographic'] \n  }).notNull(),\n  rules: jsonb(\"rules\").default({}), // Segment rules for auto segments\n  // Rule examples:\n  // { subscription_tier: ['premium', 'vip'] }\n  // { inactivity_days: { gte: 30 } }\n  // { total_spent: { gte: 100 } }\n  // { last_visit: { lte: '2025-01-01' } }\n  isActive: boolean(\"is_active\").default(true),\n  fanCount: integer(\"fan_count\").default(0),\n  lastRecalculatedAt: timestamp(\"last_recalculated_at\"),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n}, (table) => [\n  index(\"idx_segment_creator\").on(table.creatorId, table.isActive),\n  index(\"idx_segment_type\").on(table.segmentType),\n]);\n\n// Fan Segment Members - Many-to-many relationship\nexport const fanSegmentMembers = pgTable(\"fan_segment_members\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  segmentId: varchar(\"segment_id\").references(() => fanSegments.id).notNull(),\n  fanId: varchar(\"fan_id\").references(() => users.id).notNull(),\n  addedAt: timestamp(\"added_at\").defaultNow(),\n  metadata: jsonb(\"metadata\").default({}), // Qualification scores, etc.\n}, (table) => [\n  uniqueIndex(\"idx_segment_member_unique\").on(table.segmentId, table.fanId),\n  index(\"idx_segment_member_segment\").on(table.segmentId),\n  index(\"idx_segment_member_fan\").on(table.fanId),\n]);\n\n// Campaign Executions - Track individual campaign runs\nexport const campaignExecutions = pgTable(\"campaign_executions\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  campaignId: varchar(\"campaign_id\").references(() => marketingCampaigns.id).notNull(),\n  recipientId: varchar(\"recipient_id\").references(() => users.id).notNull(),\n  status: varchar(\"status\", { \n    enum: ['queued', 'sent', 'delivered', 'opened', 'clicked', 'converted', 'failed', 'bounced'] \n  }).default('queued'),\n  deliveredAt: timestamp(\"delivered_at\"),\n  openedAt: timestamp(\"opened_at\"),\n  clickedAt: timestamp(\"clicked_at\"),\n  convertedAt: timestamp(\"converted_at\"),\n  errorMessage: text(\"error_message\"),\n  metadata: jsonb(\"metadata\").default({}), // Tracking IDs, device info, etc.\n  createdAt: timestamp(\"created_at\").defaultNow(),\n}, (table) => [\n  index(\"idx_execution_campaign\").on(table.campaignId, table.status),\n  index(\"idx_execution_recipient\").on(table.recipientId, table.campaignId),\n  index(\"idx_execution_status\").on(table.status, table.createdAt),\n]);\n\n// Social Post Queue - Track scheduled social media posts (integrates with distribution system)\nexport const socialPostQueue = pgTable(\"social_post_queue\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  campaignId: varchar(\"campaign_id\").references(() => marketingCampaigns.id),\n  creatorId: varchar(\"creator_id\").references(() => users.id).notNull(),\n  platforms: jsonb(\"platforms\").notNull(), // ['twitter', 'instagram', etc.]\n  postContent: text(\"post_content\").notNull(),\n  mediaPath: varchar(\"media_path\"),\n  scheduledFor: timestamp(\"scheduled_for\").notNull(),\n  status: varchar(\"status\", { \n    enum: ['scheduled', 'queued', 'posting', 'posted', 'failed', 'cancelled'] \n  }).default('scheduled'),\n  distributionJobId: varchar(\"distribution_job_id\").references(() => distributionJobs.id), // Link to distribution system\n  postedAt: timestamp(\"posted_at\"),\n  errorMessage: text(\"error_message\"),\n  analytics: jsonb(\"analytics\").default({}), // Engagement stats from platforms\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n}, (table) => [\n  index(\"idx_social_post_scheduled\").on(table.status, table.scheduledFor),\n  index(\"idx_social_post_creator\").on(table.creatorId, table.status),\n  index(\"idx_social_post_campaign\").on(table.campaignId),\n]);\n\nexport const moderationQueue = pgTable(\"moderation_queue\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  mediaId: varchar(\"media_id\").references(() => mediaAssets.id).notNull(),\n  status: varchar(\"status\", { enum: ['pending', 'approved', 'rejected'] }).default('pending'),\n  reviewerId: varchar(\"reviewer_id\").references(() => users.id),\n  aiConfidence: decimal(\"ai_confidence\", { precision: 5, scale: 2 }),\n  notes: text(\"notes\"),\n  priority: varchar(\"priority\", { enum: ['low', 'medium', 'high', 'urgent'] }).default('medium'),\n  reviewedAt: timestamp(\"reviewed_at\"),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n});\n\nexport const auditLogs = pgTable(\"audit_logs\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  actorId: varchar(\"actor_id\").references(() => users.id),\n  action: varchar(\"action\").notNull(),\n  targetType: varchar(\"target_type\").notNull(),\n  targetId: varchar(\"target_id\").notNull(),\n  metadata: jsonb(\"metadata\"),\n  ipAddress: varchar(\"ip_address\"),\n  userAgent: varchar(\"user_agent\"),\n  timestamp: timestamp(\"timestamp\").defaultNow(),\n});\n\nexport const subscriptions = pgTable(\"subscriptions\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  fanId: varchar(\"fan_id\").references(() => users.id).notNull(),\n  creatorId: varchar(\"creator_id\").references(() => users.id).notNull(),\n  tier: varchar(\"tier\", { enum: ['basic', 'premium', 'vip'] }).default('basic'),\n  status: varchar(\"status\", { enum: ['active', 'cancelled', 'expired'] }).default('active'),\n  price: decimal(\"price\", { precision: 10, scale: 2 }).notNull(),\n  startDate: timestamp(\"start_date\").defaultNow(),\n  endDate: timestamp(\"end_date\"),\n  autoRenew: boolean(\"auto_renew\").default(true),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n});\n\nexport const tips = pgTable(\"tips\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  fromUserId: varchar(\"from_user_id\").references(() => users.id).notNull(),\n  toUserId: varchar(\"to_user_id\").references(() => users.id).notNull(),\n  amount: decimal(\"amount\", { precision: 10, scale: 2 }).notNull(),\n  currency: varchar(\"currency\").default('USD'),\n  message: text(\"message\"),\n  mediaId: varchar(\"media_id\").references(() => mediaAssets.id),\n  streamId: varchar(\"stream_id\").references(() => liveStreams.id), // For tips during streams\n  processorRef: varchar(\"processor_ref\"),\n  status: varchar(\"status\", { enum: ['pending', 'completed', 'failed', 'refunded'] }).default('pending'),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n}, (table) => [\n  index(\"idx_tip_stream\").on(table.streamId, table.createdAt),\n]);\n\nexport const messages = pgTable(\"messages\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  fromUserId: varchar(\"from_user_id\").references(() => users.id).notNull(),\n  toUserId: varchar(\"to_user_id\").references(() => users.id).notNull(),\n  content: text(\"content\").notNull(),\n  messageType: varchar(\"message_type\", { enum: ['text', 'image', 'tip', 'system'] }).default('text'),\n  mediaPath: varchar(\"media_path\"),\n  tipId: varchar(\"tip_id\").references(() => tips.id),\n  readAt: timestamp(\"read_at\"),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n});\n\nexport const consentRecords = pgTable(\"consent_records\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  userId: varchar(\"user_id\").references(() => users.id).notNull(),\n  consentType: varchar(\"consent_type\").notNull(),\n  granted: boolean(\"granted\").notNull(),\n  details: jsonb(\"details\"),\n  ipAddress: varchar(\"ip_address\"),\n  revokedAt: timestamp(\"revoked_at\"),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n});\n\n// =============================================================================\n// NEW MULTI-TENANT TABLES\n// =============================================================================\n\n// Core tenants table - GirlFanz, PupFanz, DaddyFanz\nexport const tenants = pgTable(\"tenants\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  slug: varchar(\"slug\").unique().notNull(),\n  name: varchar(\"name\").notNull(),\n  settings: jsonb(\"settings\").default({}),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\n// Enhanced content system for cross-posting\nexport const content = pgTable(\"content\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  creatorUserId: varchar(\"creator_user_id\").references(() => users.id).notNull(),\n  title: varchar(\"title\").notNull(),\n  caption: text(\"caption\"),\n  priceCents: integer(\"price_cents\").default(0),\n  visibility: varchar(\"visibility\", { enum: ['public', 'subscribers', 'ppv'] }).default('public'),\n  canonicalTenant: varchar(\"canonical_tenant\").references(() => tenants.id).notNull(),\n  tags: jsonb(\"tags\").default([]),\n  mediaAssetIds: jsonb(\"media_asset_ids\").default([]), // Array of existing media_assets.id\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\n// Cross-tenant content mapping\nexport const contentTenantMap = pgTable(\"content_tenant_map\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  contentId: varchar(\"content_id\").references(() => content.id).notNull(),\n  tenantId: varchar(\"tenant_id\").references(() => tenants.id).notNull(),\n  status: varchar(\"status\", { enum: ['published', 'scheduled', 'hidden'] }).default('published'),\n  publishedAt: timestamp(\"published_at\"),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n}, (table) => [\n  index(\"idx_content_tenant_unique\").on(table.contentId, table.tenantId),\n]);\n\n// Enhanced subscription plans with tenant support\nexport const subscriptionPlans = pgTable(\"subscription_plans\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  creatorUserId: varchar(\"creator_user_id\").references(() => users.id).notNull(),\n  tenantId: varchar(\"tenant_id\").references(() => tenants.id).notNull(),\n  priceCents: integer(\"price_cents\").notNull(),\n  interval: varchar(\"interval\", { enum: ['monthly', 'yearly'] }).notNull(),\n  perks: jsonb(\"perks\").default({}),\n  active: boolean(\"active\").default(true),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n});\n\n// Enhanced audit logs with tenant support\nexport const tenantAuditLogs = pgTable(\"tenant_audit_logs\", {\n  id: bigserial(\"id\", { mode: \"number\" }).primaryKey(),\n  actorUserId: varchar(\"actor_user_id\").references(() => users.id),\n  tenantId: varchar(\"tenant_id\").references(() => tenants.id),\n  action: varchar(\"action\").notNull(),\n  subjectTable: varchar(\"subject_table\").notNull(),\n  subjectId: varchar(\"subject_id\").notNull(),\n  ip: inet(\"ip\"),\n  userAgent: varchar(\"user_agent\"),\n  at: timestamp(\"at\").defaultNow(),\n  data: jsonb(\"data\").default({}),\n});\n\n// =============================================================================\n// AI-POWERED RECOMMENDATION ENGINE\n// =============================================================================\n\n// User interaction tracking for AI recommendations\nexport const userInteractions = pgTable(\"user_interactions\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  userId: varchar(\"user_id\").references(() => users.id).notNull(),\n  contentId: varchar(\"content_id\").references(() => content.id).notNull(),\n  interactionType: varchar(\"interaction_type\", { enum: ['view', 'like', 'share', 'save', 'skip', 'report'] }).notNull(),\n  durationSeconds: integer(\"duration_seconds\"), // For views\n  metadata: jsonb(\"metadata\").default({}),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n}, (table) => [\n  index(\"idx_user_interactions_user\").on(table.userId),\n  index(\"idx_user_interactions_content\").on(table.contentId),\n  index(\"idx_user_interactions_type\").on(table.interactionType),\n]);\n\n// Pre-computed content engagement scores for faster recommendations\nexport const contentEngagementScores = pgTable(\"content_engagement_scores\", {\n  contentId: varchar(\"content_id\").references(() => content.id).primaryKey(),\n  viewCount: integer(\"view_count\").default(0),\n  likeCount: integer(\"like_count\").default(0),\n  shareCount: integer(\"share_count\").default(0),\n  saveCount: integer(\"save_count\").default(0),\n  avgViewDuration: decimal(\"avg_view_duration\", { precision: 10, scale: 2 }),\n  engagementScore: decimal(\"engagement_score\", { precision: 10, scale: 4 }), // Computed score\n  trendingScore: decimal(\"trending_score\", { precision: 10, scale: 4 }), // Time-weighted score\n  lastUpdated: timestamp(\"last_updated\").defaultNow(),\n});\n\n// User preference profiles learned from interactions\nexport const userPreferenceProfiles = pgTable(\"user_preference_profiles\", {\n  userId: varchar(\"user_id\").references(() => users.id).primaryKey(),\n  preferredCreators: jsonb(\"preferred_creators\").default([]), // Array of creator IDs with scores\n  preferredTags: jsonb(\"preferred_tags\").default([]), // Array of tags with scores\n  preferredPackTypes: jsonb(\"preferred_pack_types\").default([]), // Pack type preferences\n  interactionVector: jsonb(\"interaction_vector\").default({}), // ML feature vector\n  lastUpdated: timestamp(\"last_updated\").defaultNow(),\n});\n\n// Creator similarity matrix for collaborative filtering\nexport const creatorSimilarity = pgTable(\"creator_similarity\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  creatorId1: varchar(\"creator_id_1\").references(() => users.id).notNull(),\n  creatorId2: varchar(\"creator_id_2\").references(() => users.id).notNull(),\n  similarityScore: decimal(\"similarity_score\", { precision: 10, scale: 4 }).notNull(),\n  computedAt: timestamp(\"computed_at\").defaultNow(),\n}, (table) => [\n  index(\"idx_creator_similarity\").on(table.creatorId1, table.creatorId2),\n]);\n\n// =============================================================================\n// CREATOR ANALYTICS DASHBOARD\n// =============================================================================\n\n// Daily revenue and metrics snapshots\nexport const creatorDailyMetrics = pgTable(\"creator_daily_metrics\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  creatorId: varchar(\"creator_id\").references(() => users.id).notNull(),\n  date: timestamp(\"date\").notNull(),\n  subscriptionRevenue: decimal(\"subscription_revenue\", { precision: 12, scale: 2 }).default('0'),\n  tipRevenue: decimal(\"tip_revenue\", { precision: 12, scale: 2 }).default('0'),\n  ppvRevenue: decimal(\"ppv_revenue\", { precision: 12, scale: 2 }).default('0'),\n  totalRevenue: decimal(\"total_revenue\", { precision: 12, scale: 2 }).default('0'),\n  newSubscribers: integer(\"new_subscribers\").default(0),\n  lostSubscribers: integer(\"lost_subscribers\").default(0),\n  totalSubscribers: integer(\"total_subscribers\").default(0),\n  contentViews: integer(\"content_views\").default(0),\n  contentLikes: integer(\"content_likes\").default(0),\n  contentShares: integer(\"content_shares\").default(0),\n  messagesReceived: integer(\"messages_received\").default(0),\n  engagementRate: decimal(\"engagement_rate\", { precision: 5, scale: 2 }),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n}, (table) => [\n  index(\"idx_creator_daily_metrics\").on(table.creatorId, table.date),\n]);\n\n// Audience demographics and insights\nexport const creatorAudienceInsights = pgTable(\"creator_audience_insights\", {\n  creatorId: varchar(\"creator_id\").references(() => users.id).primaryKey(),\n  topFanIds: jsonb(\"top_fan_ids\").default([]), // Top 10 fans by spending\n  packTypeDistribution: jsonb(\"pack_type_distribution\").default({}), // {alpha: 30, playful: 45, ...}\n  geographicDistribution: jsonb(\"geographic_distribution\").default({}), // Countries/regions\n  averageSubscriptionLength: decimal(\"avg_subscription_length\", { precision: 10, scale: 2 }), // Days\n  averageTipAmount: decimal(\"avg_tip_amount\", { precision: 10, scale: 2 }),\n  retentionRate: decimal(\"retention_rate\", { precision: 5, scale: 2 }), // Percentage\n  churnRate: decimal(\"churn_rate\", { precision: 5, scale: 2 }), // Percentage\n  lastUpdated: timestamp(\"last_updated\").defaultNow(),\n});\n\n// Revenue forecasting data\nexport const creatorRevenueForecasts = pgTable(\"creator_revenue_forecasts\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  creatorId: varchar(\"creator_id\").references(() => users.id).notNull(),\n  forecastMonth: timestamp(\"forecast_month\").notNull(),\n  predictedRevenue: decimal(\"predicted_revenue\", { precision: 12, scale: 2 }).notNull(),\n  confidenceLevel: decimal(\"confidence_level\", { precision: 5, scale: 2 }), // 0-100%\n  growthRate: decimal(\"growth_rate\", { precision: 5, scale: 2 }), // Percentage\n  modelVersion: varchar(\"model_version\"),\n  computedAt: timestamp(\"computed_at\").defaultNow(),\n}, (table) => [\n  index(\"idx_revenue_forecasts\").on(table.creatorId, table.forecastMonth),\n]);\n\n// Content performance analytics\nexport const contentPerformanceMetrics = pgTable(\"content_performance_metrics\", {\n  contentId: varchar(\"content_id\").references(() => content.id).primaryKey(),\n  totalViews: integer(\"total_views\").default(0),\n  uniqueViewers: integer(\"unique_viewers\").default(0),\n  averageViewDuration: decimal(\"avg_view_duration\", { precision: 10, scale: 2 }),\n  completionRate: decimal(\"completion_rate\", { precision: 5, scale: 2 }), // Percentage\n  likeCount: integer(\"like_count\").default(0),\n  shareCount: integer(\"share_count\").default(0),\n  saveCount: integer(\"save_count\").default(0),\n  commentCount: integer(\"comment_count\").default(0),\n  tipCount: integer(\"tip_count\").default(0),\n  totalTipRevenue: decimal(\"total_tip_revenue\", { precision: 12, scale: 2 }).default('0'),\n  conversionRate: decimal(\"conversion_rate\", { precision: 5, scale: 2 }), // Free to paid\n  lastUpdated: timestamp(\"last_updated\").defaultNow(),\n});\n\n// =============================================================================\n// GAMIFICATION SYSTEM\n// =============================================================================\n\n// Achievement definitions\nexport const achievements = pgTable(\"achievements\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  category: varchar(\"category\", { enum: ['creator', 'fan', 'engagement', 'milestone', 'special'] }).notNull(),\n  name: varchar(\"name\").notNull(),\n  description: text(\"description\"),\n  iconUrl: varchar(\"icon_url\"),\n  badgeColor: varchar(\"badge_color\"),\n  requirement: jsonb(\"requirement\").notNull(), // {type: 'subscriber_count', threshold: 1000}\n  points: integer(\"points\").default(100),\n  tier: varchar(\"tier\", { enum: ['bronze', 'silver', 'gold', 'platinum', 'diamond'] }).default('bronze'),\n  isSecret: boolean(\"is_secret\").default(false), // Hidden until unlocked\n  createdAt: timestamp(\"created_at\").defaultNow(),\n}, (table) => [\n  index(\"idx_achievements_category\").on(table.category, table.tier),\n]);\n\n// User achievements (tracking unlocked achievements)\nexport const userAchievements = pgTable(\"user_achievements\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  userId: varchar(\"user_id\").references(() => users.id).notNull(),\n  achievementId: varchar(\"achievement_id\").references(() => achievements.id).notNull(),\n  unlockedAt: timestamp(\"unlocked_at\").defaultNow(),\n  progress: integer(\"progress\").default(100), // Percentage 0-100\n  metadata: jsonb(\"metadata\"), // Additional context like exact value when unlocked\n}, (table) => [\n  index(\"idx_user_achievements\").on(table.userId, table.achievementId),\n]);\n\n// Creator tier progression\nexport const creatorTiers = pgTable(\"creator_tiers\", {\n  userId: varchar(\"user_id\").references(() => users.id).primaryKey(),\n  currentTier: varchar(\"current_tier\", { \n    enum: ['starter', 'bronze', 'silver', 'gold', 'platinum', 'diamond', 'legend'] \n  }).default('starter'),\n  tierPoints: integer(\"tier_points\").default(0),\n  nextTierThreshold: integer(\"next_tier_threshold\").default(1000),\n  lifetimeEarnings: decimal(\"lifetime_earnings\", { precision: 12, scale: 2 }).default('0'),\n  totalSubscribers: integer(\"total_subscribers\").default(0),\n  totalContent: integer(\"total_content\").default(0),\n  engagementScore: decimal(\"engagement_score\", { precision: 10, scale: 2 }).default('0'),\n  tierBenefits: jsonb(\"tier_benefits\").default([]), // Custom perks per tier\n  lastTierUpdate: timestamp(\"last_tier_update\").defaultNow(),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n}, (table) => [\n  index(\"idx_creator_tiers\").on(table.currentTier, table.tierPoints),\n]);\n\n// Fan engagement rewards and points\nexport const fanEngagementRewards = pgTable(\"fan_engagement_rewards\", {\n  userId: varchar(\"user_id\").references(() => users.id).primaryKey(),\n  loyaltyPoints: integer(\"loyalty_points\").default(0),\n  streakDays: integer(\"streak_days\").default(0), // Daily login streak\n  lastCheckIn: timestamp(\"last_check_in\"),\n  totalTipped: decimal(\"total_tipped\", { precision: 12, scale: 2 }).default('0'),\n  totalSubscribed: integer(\"total_subscribed\").default(0),\n  favoriteCreatorIds: jsonb(\"favorite_creator_ids\").default([]),\n  rewardTier: varchar(\"reward_tier\", { enum: ['bronze', 'silver', 'gold', 'vip'] }).default('bronze'),\n  availableRewards: jsonb(\"available_rewards\").default([]), // Unlocked perks\n  lastRewardClaimed: timestamp(\"last_reward_claimed\"),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n}, (table) => [\n  index(\"idx_fan_rewards\").on(table.rewardTier, table.loyaltyPoints),\n]);\n\n// Leaderboards (daily/weekly/monthly rankings)\nexport const leaderboards = pgTable(\"leaderboards\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  period: varchar(\"period\", { enum: ['daily', 'weekly', 'monthly', 'alltime'] }).notNull(),\n  category: varchar(\"category\", { \n    enum: ['top_creators', 'top_earners', 'top_fans', 'trending', 'rising_stars'] \n  }).notNull(),\n  userId: varchar(\"user_id\").references(() => users.id).notNull(),\n  rank: integer(\"rank\").notNull(),\n  score: decimal(\"score\", { precision: 12, scale: 2 }).notNull(),\n  metadata: jsonb(\"metadata\"), // Additional stats\n  periodStart: timestamp(\"period_start\").notNull(),\n  periodEnd: timestamp(\"period_end\").notNull(),\n  computedAt: timestamp(\"computed_at\").defaultNow(),\n}, (table) => [\n  index(\"idx_leaderboards\").on(table.period, table.category, table.rank),\n  index(\"idx_leaderboards_user\").on(table.userId, table.period),\n]);\n\n// =============================================================================\n// REAL-TIME NOTIFICATION SYSTEM\n// =============================================================================\n\n// Notifications table\nexport const notifications = pgTable(\"notifications\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  userId: varchar(\"user_id\").references(() => users.id).notNull(),\n  type: varchar(\"type\", { \n    enum: ['tip', 'subscription', 'message', 'like', 'comment', 'achievement', 'system', 'milestone'] \n  }).notNull(),\n  title: varchar(\"title\").notNull(),\n  message: text(\"message\"),\n  actionUrl: varchar(\"action_url\"), // Link to related content\n  metadata: jsonb(\"metadata\"), // Additional context (tip amount, achievement details, etc.)\n  isRead: boolean(\"is_read\").default(false),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n}, (table) => [\n  index(\"idx_notifications_user\").on(table.userId, table.isRead, table.createdAt),\n]);\n\n// User notification preferences\nexport const notificationPreferences = pgTable(\"notification_preferences\", {\n  userId: varchar(\"user_id\").references(() => users.id).primaryKey(),\n  emailNotifications: boolean(\"email_notifications\").default(true),\n  pushNotifications: boolean(\"push_notifications\").default(true),\n  tipsEnabled: boolean(\"tips_enabled\").default(true),\n  subscriptionsEnabled: boolean(\"subscriptions_enabled\").default(true),\n  messagesEnabled: boolean(\"messages_enabled\").default(true),\n  likesEnabled: boolean(\"likes_enabled\").default(true),\n  commentsEnabled: boolean(\"comments_enabled\").default(false),\n  achievementsEnabled: boolean(\"achievements_enabled\").default(true),\n  systemEnabled: boolean(\"system_enabled\").default(true),\n  quietHoursStart: varchar(\"quiet_hours_start\"), // e.g., \"22:00\"\n  quietHoursEnd: varchar(\"quiet_hours_end\"), // e.g., \"08:00\"\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\n// =============================================================================\n// CONTENT MODERATION & SAFETY SYSTEM\n// =============================================================================\n\n// Safety reports (user-generated reports)\nexport const safetyReports = pgTable(\"safety_reports\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  reporterId: varchar(\"reporter_id\").references(() => users.id).notNull(),\n  contentId: varchar(\"content_id\").references(() => mediaAssets.id),\n  userId: varchar(\"user_id\").references(() => users.id), // Reported user\n  messageId: varchar(\"message_id\").references(() => messages.id), // Reported message\n  reportType: varchar(\"report_type\", { \n    enum: ['underage', 'non_consensual', 'violence', 'hate_speech', 'spam', 'copyright', 'impersonation', 'other'] \n  }).notNull(),\n  severity: varchar(\"severity\", { enum: ['low', 'medium', 'high', 'critical'] }).default('medium'),\n  description: text(\"description\"),\n  evidence: jsonb(\"evidence\"), // Screenshots, URLs, etc.\n  status: varchar(\"status\", { \n    enum: ['pending', 'under_review', 'resolved', 'dismissed', 'escalated'] \n  }).default('pending'),\n  reviewedBy: varchar(\"reviewed_by\").references(() => users.id),\n  reviewedAt: timestamp(\"reviewed_at\"),\n  resolution: text(\"resolution\"),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n}, (table) => [\n  index(\"idx_safety_reports_status\").on(table.status, table.createdAt),\n  index(\"idx_safety_reports_content\").on(table.contentId),\n  // Ensure at least one target is specified\n  sql`CONSTRAINT safety_reports_target_check CHECK (\n    content_id IS NOT NULL OR user_id IS NOT NULL OR message_id IS NOT NULL\n  )`,\n]);\n\n// AI content flags (automated moderation)\nexport const aiContentFlags = pgTable(\"ai_content_flags\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  contentId: varchar(\"content_id\").references(() => mediaAssets.id).notNull(),\n  flagType: varchar(\"flag_type\", { \n    enum: ['nsfw_extreme', 'potential_minor', 'violence', 'hate_symbols', 'suspicious_text', 'deepfake'] \n  }).notNull(),\n  confidence: decimal(\"confidence\", { precision: 5, scale: 2 }).notNull(), // 0.00 to 100.00\n  model: varchar(\"model\"), // AI model used (e.g., \"claude-3\", \"custom-v1\")\n  details: jsonb(\"details\"), // Raw AI analysis results\n  isReviewed: boolean(\"is_reviewed\").default(false),\n  reviewerOverride: boolean(\"reviewer_override\"), // Human override decision\n  createdAt: timestamp(\"created_at\").defaultNow(),\n}, (table) => [\n  index(\"idx_ai_flags_content\").on(table.contentId, table.isReviewed),\n  index(\"idx_ai_flags_type\").on(table.flagType, table.confidence),\n]);\n\n// Moderation actions\nexport const moderationActions = pgTable(\"moderation_actions\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  reportId: varchar(\"report_id\").references(() => safetyReports.id),\n  moderatorId: varchar(\"moderator_id\").references(() => users.id).notNull(),\n  targetUserId: varchar(\"target_user_id\").references(() => users.id),\n  targetContentId: varchar(\"target_content_id\").references(() => mediaAssets.id),\n  actionType: varchar(\"action_type\", { \n    enum: ['warning', 'content_removal', 'account_suspension', 'account_ban', 'age_reverification', 'monetization_disable'] \n  }).notNull(),\n  duration: integer(\"duration\"), // In days for temporary actions\n  reason: text(\"reason\").notNull(),\n  publicReason: text(\"public_reason\"), // Sanitized reason shown to user\n  internalNotes: text(\"internal_notes\"),\n  reversedBy: varchar(\"reversed_by\").references(() => users.id),\n  reversedAt: timestamp(\"reversed_at\"),\n  expiresAt: timestamp(\"expires_at\"),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n}, (table) => [\n  index(\"idx_moderation_actions_user\").on(table.targetUserId, table.createdAt),\n  index(\"idx_moderation_actions_type\").on(table.actionType),\n]);\n\n// Community votes on reports (democratic moderation)\nexport const communityVotes = pgTable(\"community_votes\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  reportId: varchar(\"report_id\").references(() => safetyReports.id).notNull(),\n  voterId: varchar(\"voter_id\").references(() => users.id).notNull(),\n  vote: varchar(\"vote\", { enum: ['valid', 'invalid', 'unsure'] }).notNull(),\n  voterReputation: integer(\"voter_reputation\").default(100), // Trust score\n  reason: text(\"reason\"),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n}, (table) => [\n  index(\"idx_community_votes_report\").on(table.reportId, table.vote),\n  index(\"idx_community_votes_voter\").on(table.voterId),\n]);\n\n// Content safety scores (aggregate safety rating)\nexport const contentSafetyScores = pgTable(\"content_safety_scores\", {\n  contentId: varchar(\"content_id\").references(() => mediaAssets.id).primaryKey(),\n  overallScore: decimal(\"overall_score\", { precision: 5, scale: 2 }).default('100.00'), // 0-100, higher is safer\n  reportCount: integer(\"report_count\").default(0),\n  aiFlags: integer(\"ai_flags\").default(0),\n  communityTrust: decimal(\"community_trust\", { precision: 5, scale: 2 }).default('100.00'),\n  humanReviewStatus: varchar(\"human_review_status\", { \n    enum: ['not_reviewed', 'approved', 'flagged', 'removed'] \n  }).default('not_reviewed'),\n  lastReviewedBy: varchar(\"last_reviewed_by\").references(() => users.id),\n  lastReviewedAt: timestamp(\"last_reviewed_at\"),\n  autoActionTaken: boolean(\"auto_action_taken\").default(false),\n  riskLevel: varchar(\"risk_level\", { enum: ['safe', 'low', 'medium', 'high', 'critical'] }).default('safe'),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n}, (table) => [\n  index(\"idx_safety_scores_risk\").on(table.riskLevel, table.overallScore),\n]);\n\n// Moderator reputation and performance\nexport const moderatorStats = pgTable(\"moderator_stats\", {\n  userId: varchar(\"user_id\").references(() => users.id).primaryKey(),\n  totalReviews: integer(\"total_reviews\").default(0),\n  accuracyRate: decimal(\"accuracy_rate\", { precision: 5, scale: 2 }).default('0'), // Percentage\n  averageResponseTime: integer(\"avg_response_time\"), // In minutes\n  overturned: integer(\"overturned\").default(0), // Actions reversed by higher authority\n  commendations: integer(\"commendations\").default(0),\n  isSeniorModerator: boolean(\"is_senior_moderator\").default(false),\n  canEscalate: boolean(\"can_escalate\").default(true),\n  lastActiveAt: timestamp(\"last_active_at\").defaultNow(),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n}, (table) => [\n  index(\"idx_moderator_stats\").on(table.accuracyRate, table.totalReviews),\n]);\n\n// =============================================================================\n// INSERT SCHEMAS\n// =============================================================================\n\n// Pack schemas\nexport const insertPackSchema = createInsertSchema(packs).omit({ id: true, createdAt: true, updatedAt: true });\nexport const insertPackMemberSchema = createInsertSchema(packMembers).omit({ id: true, createdAt: true, joinedAt: true });\n\n// Existing schemas\nexport const insertUserSchema = createInsertSchema(users).omit({ id: true, createdAt: true, updatedAt: true });\nexport const insertProfileSchema = createInsertSchema(profiles).omit({ id: true, createdAt: true, updatedAt: true });\nexport const insertMediaAssetSchema = createInsertSchema(mediaAssets).omit({ id: true, createdAt: true, updatedAt: true });\nexport const insertSubscriptionSchema = createInsertSchema(subscriptions).omit({ id: true, createdAt: true });\nexport const insertTipSchema = createInsertSchema(tips).omit({ id: true, createdAt: true });\nexport const insertMessageSchema = createInsertSchema(messages).omit({ id: true, createdAt: true });\nexport const insertConsentRecordSchema = createInsertSchema(consentRecords).omit({ id: true, createdAt: true });\nexport const insertCoStarVerificationSchema = createInsertSchema(coStarVerifications).omit({ id: true, createdAt: true, updatedAt: true });\n\n// Multi-platform distribution schemas\nexport const insertSocialMediaAccountSchema = createInsertSchema(socialMediaAccounts).omit({ id: true, createdAt: true, updatedAt: true });\nexport const insertDistributionJobSchema = createInsertSchema(distributionJobs).omit({ id: true, createdAt: true, updatedAt: true });\nexport const insertQrCodeSchema = createInsertSchema(qrCodes).omit({ id: true, createdAt: true, updatedAt: true });\nexport const insertSmartLinkSchema = createInsertSchema(smartLinks).omit({ id: true, createdAt: true, updatedAt: true });\n\n// Live stream infrastructure schemas\nexport const insertLiveStreamSchema = createInsertSchema(liveStreams).omit({ id: true, createdAt: true, updatedAt: true });\nexport const insertStreamParticipantSchema = createInsertSchema(streamParticipants).omit({ id: true, joinedAt: true });\nexport const insertStreamRecordingSchema = createInsertSchema(streamRecordings).omit({ id: true, createdAt: true, updatedAt: true });\n\n// AI Marketing Automation schemas\nexport const insertMarketingCampaignSchema = createInsertSchema(marketingCampaigns).omit({ id: true, createdAt: true, updatedAt: true });\nexport const insertFanSegmentSchema = createInsertSchema(fanSegments).omit({ id: true, createdAt: true, updatedAt: true });\nexport const insertFanSegmentMemberSchema = createInsertSchema(fanSegmentMembers).omit({ id: true, addedAt: true });\nexport const insertCampaignExecutionSchema = createInsertSchema(campaignExecutions).omit({ id: true, createdAt: true });\nexport const insertSocialPostQueueSchema = createInsertSchema(socialPostQueue).omit({ id: true, createdAt: true, updatedAt: true });\n\n// New multi-tenant schemas\nexport const insertTenantSchema = createInsertSchema(tenants).omit({ id: true, createdAt: true, updatedAt: true });\nexport const insertContentSchema = createInsertSchema(content).omit({ id: true, createdAt: true, updatedAt: true });\nexport const insertContentTenantMapSchema = createInsertSchema(contentTenantMap).omit({ id: true, createdAt: true });\nexport const insertSubscriptionPlanSchema = createInsertSchema(subscriptionPlans).omit({ id: true, createdAt: true });\n\n// AI recommendation engine schemas\nexport const insertUserInteractionSchema = createInsertSchema(userInteractions).omit({ id: true, createdAt: true });\nexport const insertContentEngagementScoreSchema = createInsertSchema(contentEngagementScores).omit({ lastUpdated: true });\nexport const insertUserPreferenceProfileSchema = createInsertSchema(userPreferenceProfiles).omit({ lastUpdated: true });\nexport const insertCreatorSimilaritySchema = createInsertSchema(creatorSimilarity).omit({ id: true, computedAt: true });\n\n// Creator analytics schemas\nexport const insertCreatorDailyMetricsSchema = createInsertSchema(creatorDailyMetrics).omit({ id: true, createdAt: true });\nexport const insertCreatorAudienceInsightsSchema = createInsertSchema(creatorAudienceInsights).omit({ lastUpdated: true });\nexport const insertCreatorRevenueForecastSchema = createInsertSchema(creatorRevenueForecasts).omit({ id: true, computedAt: true });\nexport const insertContentPerformanceMetricsSchema = createInsertSchema(contentPerformanceMetrics).omit({ lastUpdated: true });\n\n// Gamification schemas\nexport const insertAchievementSchema = createInsertSchema(achievements).omit({ id: true, createdAt: true });\nexport const insertUserAchievementSchema = createInsertSchema(userAchievements).omit({ id: true, unlockedAt: true });\nexport const insertCreatorTierSchema = createInsertSchema(creatorTiers).omit({ lastTierUpdate: true, createdAt: true });\nexport const insertFanEngagementRewardSchema = createInsertSchema(fanEngagementRewards).omit({ createdAt: true });\nexport const insertLeaderboardSchema = createInsertSchema(leaderboards).omit({ id: true, computedAt: true });\n\n// Notification schemas\nexport const insertNotificationSchema = createInsertSchema(notifications).omit({ id: true, createdAt: true });\nexport const insertNotificationPreferencesSchema = createInsertSchema(notificationPreferences).omit({ updatedAt: true });\n\n// Content moderation schemas\nexport const insertSafetyReportSchema = createInsertSchema(safetyReports).omit({ id: true, createdAt: true });\nexport const insertAIContentFlagSchema = createInsertSchema(aiContentFlags).omit({ id: true, createdAt: true });\nexport const insertModerationActionSchema = createInsertSchema(moderationActions).omit({ id: true, createdAt: true });\nexport const insertCommunityVoteSchema = createInsertSchema(communityVotes).omit({ id: true, createdAt: true });\nexport const insertContentSafetyScoreSchema = createInsertSchema(contentSafetyScores).omit({ updatedAt: true });\nexport const insertModeratorStatsSchema = createInsertSchema(moderatorStats).omit({ lastActiveAt: true, createdAt: true });\n\n// =============================================================================\n// TYPES\n// =============================================================================\n\n// Pack types\nexport type Pack = typeof packs.$inferSelect;\nexport type InsertPack = z.infer<typeof insertPackSchema>;\nexport type PackMember = typeof packMembers.$inferSelect;\nexport type InsertPackMember = z.infer<typeof insertPackMemberSchema>;\n\n// Existing types\nexport type User = typeof users.$inferSelect;\nexport type InsertUser = z.infer<typeof insertUserSchema>;\nexport type Profile = typeof profiles.$inferSelect;\nexport type InsertProfile = z.infer<typeof insertProfileSchema>;\nexport type MediaAsset = typeof mediaAssets.$inferSelect;\nexport type InsertMediaAsset = z.infer<typeof insertMediaAssetSchema>;\nexport type Subscription = typeof subscriptions.$inferSelect;\nexport type InsertSubscription = z.infer<typeof insertSubscriptionSchema>;\nexport type Tip = typeof tips.$inferSelect;\nexport type InsertTip = z.infer<typeof insertTipSchema>;\nexport type Message = typeof messages.$inferSelect;\nexport type InsertMessage = z.infer<typeof insertMessageSchema>;\nexport type ConsentRecord = typeof consentRecords.$inferSelect;\nexport type InsertConsentRecord = z.infer<typeof insertConsentRecordSchema>;\nexport type CoStarVerification = typeof coStarVerifications.$inferSelect;\nexport type InsertCoStarVerification = z.infer<typeof insertCoStarVerificationSchema>;\n\n// Multi-platform distribution types\nexport type SocialMediaAccount = typeof socialMediaAccounts.$inferSelect;\nexport type InsertSocialMediaAccount = z.infer<typeof insertSocialMediaAccountSchema>;\nexport type DistributionJob = typeof distributionJobs.$inferSelect;\nexport type InsertDistributionJob = z.infer<typeof insertDistributionJobSchema>;\nexport type QrCode = typeof qrCodes.$inferSelect;\nexport type InsertQrCode = z.infer<typeof insertQrCodeSchema>;\nexport type SmartLink = typeof smartLinks.$inferSelect;\nexport type InsertSmartLink = z.infer<typeof insertSmartLinkSchema>;\n\n// Live stream infrastructure types\nexport type LiveStream = typeof liveStreams.$inferSelect;\nexport type InsertLiveStream = z.infer<typeof insertLiveStreamSchema>;\nexport type StreamParticipant = typeof streamParticipants.$inferSelect;\nexport type InsertStreamParticipant = z.infer<typeof insertStreamParticipantSchema>;\nexport type StreamRecording = typeof streamRecordings.$inferSelect;\nexport type InsertStreamRecording = z.infer<typeof insertStreamRecordingSchema>;\n\n// New multi-tenant types\nexport type Tenant = typeof tenants.$inferSelect;\nexport type InsertTenant = z.infer<typeof insertTenantSchema>;\nexport type Content = typeof content.$inferSelect;\nexport type InsertContent = z.infer<typeof insertContentSchema>;\nexport type ContentTenantMap = typeof contentTenantMap.$inferSelect;\nexport type InsertContentTenantMap = z.infer<typeof insertContentTenantMapSchema>;\nexport type SubscriptionPlan = typeof subscriptionPlans.$inferSelect;\nexport type InsertSubscriptionPlan = z.infer<typeof insertSubscriptionPlanSchema>;\nexport type TenantAuditLog = typeof tenantAuditLogs.$inferSelect;\n\n// AI recommendation engine types\nexport type UserInteraction = typeof userInteractions.$inferSelect;\nexport type InsertUserInteraction = z.infer<typeof insertUserInteractionSchema>;\nexport type ContentEngagementScore = typeof contentEngagementScores.$inferSelect;\nexport type InsertContentEngagementScore = z.infer<typeof insertContentEngagementScoreSchema>;\nexport type UserPreferenceProfile = typeof userPreferenceProfiles.$inferSelect;\nexport type InsertUserPreferenceProfile = z.infer<typeof insertUserPreferenceProfileSchema>;\nexport type CreatorSimilarity = typeof creatorSimilarity.$inferSelect;\nexport type InsertCreatorSimilarity = z.infer<typeof insertCreatorSimilaritySchema>;\n\n// Creator analytics types\nexport type CreatorDailyMetrics = typeof creatorDailyMetrics.$inferSelect;\nexport type InsertCreatorDailyMetrics = z.infer<typeof insertCreatorDailyMetricsSchema>;\nexport type CreatorAudienceInsights = typeof creatorAudienceInsights.$inferSelect;\nexport type InsertCreatorAudienceInsights = z.infer<typeof insertCreatorAudienceInsightsSchema>;\nexport type CreatorRevenueForecast = typeof creatorRevenueForecasts.$inferSelect;\nexport type InsertCreatorRevenueForecast = z.infer<typeof insertCreatorRevenueForecastSchema>;\nexport type ContentPerformanceMetrics = typeof contentPerformanceMetrics.$inferSelect;\nexport type InsertContentPerformanceMetrics = z.infer<typeof insertContentPerformanceMetricsSchema>;\n\n// Gamification types\nexport type Achievement = typeof achievements.$inferSelect;\nexport type InsertAchievement = z.infer<typeof insertAchievementSchema>;\nexport type UserAchievement = typeof userAchievements.$inferSelect;\nexport type InsertUserAchievement = z.infer<typeof insertUserAchievementSchema>;\nexport type CreatorTier = typeof creatorTiers.$inferSelect;\nexport type InsertCreatorTier = z.infer<typeof insertCreatorTierSchema>;\nexport type FanEngagementReward = typeof fanEngagementRewards.$inferSelect;\nexport type InsertFanEngagementReward = z.infer<typeof insertFanEngagementRewardSchema>;\nexport type Leaderboard = typeof leaderboards.$inferSelect;\nexport type InsertLeaderboard = z.infer<typeof insertLeaderboardSchema>;\n\n// Notification types\nexport type Notification = typeof notifications.$inferSelect;\nexport type InsertNotification = z.infer<typeof insertNotificationSchema>;\nexport type NotificationPreferences = typeof notificationPreferences.$inferSelect;\nexport type InsertNotificationPreferences = z.infer<typeof insertNotificationPreferencesSchema>;\n\n// Content moderation types\nexport type SafetyReport = typeof safetyReports.$inferSelect;\nexport type InsertSafetyReport = z.infer<typeof insertSafetyReportSchema>;\nexport type AIContentFlag = typeof aiContentFlags.$inferSelect;\nexport type InsertAIContentFlag = z.infer<typeof insertAIContentFlagSchema>;\nexport type ModerationAction = typeof moderationActions.$inferSelect;\nexport type InsertModerationAction = z.infer<typeof insertModerationActionSchema>;\nexport type CommunityVote = typeof communityVotes.$inferSelect;\nexport type InsertCommunityVote = z.infer<typeof insertCommunityVoteSchema>;\nexport type ContentSafetyScore = typeof contentSafetyScores.$inferSelect;\nexport type InsertContentSafetyScore = z.infer<typeof insertContentSafetyScoreSchema>;\nexport type ModeratorStats = typeof moderatorStats.$inferSelect;\nexport type InsertModeratorStats = z.infer<typeof insertModeratorStatsSchema>;\n\n// =============================================================================\n// RELATIONS\n// =============================================================================\n\n// Existing relations\nexport const usersRelations = relations(users, ({ one, many }) => ({\n  profile: one(profiles, {\n    fields: [users.id],\n    references: [profiles.userId],\n  }),\n  ownedMedia: many(mediaAssets),\n  subscriptionsAsFan: many(subscriptions, { relationName: \"fanSubscriptions\" }),\n  subscriptionsAsCreator: many(subscriptions, { relationName: \"creatorSubscriptions\" }),\n  sentTips: many(tips, { relationName: \"sentTips\" }),\n  receivedTips: many(tips, { relationName: \"receivedTips\" }),\n  sentMessages: many(messages, { relationName: \"sentMessages\" }),\n  receivedMessages: many(messages, { relationName: \"receivedMessages\" }),\n  kycVerifications: many(kycVerifications),\n  records2257: many(records2257),\n  consentRecords: many(consentRecords),\n  reportsMade: many(safetyReports, { relationName: \"reportsBy\" }),\n  reportsAgainst: many(safetyReports, { relationName: \"reportsAbout\" }),\n  auditLogs: many(auditLogs),\n  // New multi-tenant relations\n  createdContent: many(content),\n  subscriptionPlans: many(subscriptionPlans),\n  tenantAuditLogs: many(tenantAuditLogs),\n}));\n\nexport const profilesRelations = relations(profiles, ({ one }) => ({\n  user: one(users, {\n    fields: [profiles.userId],\n    references: [users.id],\n  }),\n}));\n\nexport const mediaAssetsRelations = relations(mediaAssets, ({ one, many }) => ({\n  owner: one(users, {\n    fields: [mediaAssets.ownerId],\n    references: [users.id],\n  }),\n  moderationItems: many(moderationQueue),\n  tipsForContent: many(tips),\n  reportsAbout: many(safetyReports),\n}));\n\n// New multi-tenant relations\nexport const tenantsRelations = relations(tenants, ({ many }) => ({\n  contentTenantMaps: many(contentTenantMap),\n  canonicalContent: many(content),\n  subscriptionPlans: many(subscriptionPlans),\n  auditLogs: many(tenantAuditLogs),\n}));\n\nexport const contentRelations = relations(content, ({ one, many }) => ({\n  creator: one(users, {\n    fields: [content.creatorUserId],\n    references: [users.id],\n  }),\n  canonicalTenantRef: one(tenants, {\n    fields: [content.canonicalTenant],\n    references: [tenants.id],\n  }),\n  tenantMaps: many(contentTenantMap),\n}));\n\nexport const subscriptionPlansRelations = relations(subscriptionPlans, ({ one }) => ({\n  creator: one(users, {\n    fields: [subscriptionPlans.creatorUserId],\n    references: [users.id],\n  }),\n  tenant: one(tenants, {\n    fields: [subscriptionPlans.tenantId],\n    references: [tenants.id],\n  }),\n}));\n\n// Keep existing relations\nexport const subscriptionsRelations = relations(subscriptions, ({ one }) => ({\n  fan: one(users, {\n    fields: [subscriptions.fanId],\n    references: [users.id],\n    relationName: \"fanSubscriptions\",\n  }),\n  creator: one(users, {\n    fields: [subscriptions.creatorId],\n    references: [users.id],\n    relationName: \"creatorSubscriptions\",\n  }),\n}));\n\nexport const tipsRelations = relations(tips, ({ one }) => ({\n  fromUser: one(users, {\n    fields: [tips.fromUserId],\n    references: [users.id],\n    relationName: \"sentTips\",\n  }),\n  toUser: one(users, {\n    fields: [tips.toUserId],\n    references: [users.id],\n    relationName: \"receivedTips\",\n  }),\n  media: one(mediaAssets, {\n    fields: [tips.mediaId],\n    references: [mediaAssets.id],\n  }),\n}));\n\nexport const messagesRelations = relations(messages, ({ one }) => ({\n  fromUser: one(users, {\n    fields: [messages.fromUserId],\n    references: [users.id],\n    relationName: \"sentMessages\",\n  }),\n  toUser: one(users, {\n    fields: [messages.toUserId],\n    references: [users.id],\n    relationName: \"receivedMessages\",\n  }),\n  tip: one(tips, {\n    fields: [messages.tipId],\n    references: [tips.id],\n  }),\n}));\n\nexport const kycVerificationsRelations = relations(kycVerifications, ({ one }) => ({\n  user: one(users, {\n    fields: [kycVerifications.userId],\n    references: [users.id],\n  }),\n}));\n\nexport const records2257Relations = relations(records2257, ({ one }) => ({\n  user: one(users, {\n    fields: [records2257.userId],\n    references: [users.id],\n  }),\n}));\n\nexport const coStarVerificationsRelations = relations(coStarVerifications, ({ one }) => ({\n  creator: one(users, {\n    fields: [coStarVerifications.creatorId],\n    references: [users.id],\n    relationName: \"creatorCoStars\",\n  }),\n  coStar: one(users, {\n    fields: [coStarVerifications.coStarUserId],\n    references: [users.id],\n    relationName: \"coStarInvitations\",\n  }),\n  content: one(content, {\n    fields: [coStarVerifications.contentId],\n    references: [content.id],\n  }),\n  kycVerification: one(kycVerifications, {\n    fields: [coStarVerifications.kycVerificationId],\n    references: [kycVerifications.id],\n  }),\n}));\n\nexport const moderationQueueRelations = relations(moderationQueue, ({ one }) => ({\n  media: one(mediaAssets, {\n    fields: [moderationQueue.mediaId],\n    references: [mediaAssets.id],\n  }),\n  reviewer: one(users, {\n    fields: [moderationQueue.reviewerId],\n    references: [users.id],\n  }),\n}));\n\nexport const consentRecordsRelations = relations(consentRecords, ({ one }) => ({\n  user: one(users, {\n    fields: [consentRecords.userId],\n    references: [users.id],\n  }),\n}));\n\nexport const safetyReportsRelations = relations(safetyReports, ({ one }) => ({\n  reporter: one(users, {\n    fields: [safetyReports.reporterId],\n    references: [users.id],\n    relationName: \"reportsBy\",\n  }),\n  reportedUser: one(users, {\n    fields: [safetyReports.userId],\n    references: [users.id],\n    relationName: \"reportsAbout\",\n  }),\n  reportedContent: one(mediaAssets, {\n    fields: [safetyReports.contentId],\n    references: [mediaAssets.id],\n  }),\n  reportedMessage: one(messages, {\n    fields: [safetyReports.messageId],\n    references: [messages.id],\n  }),\n  reviewer: one(users, {\n    fields: [safetyReports.reviewedBy],\n    references: [users.id],\n  }),\n}));\n\nexport const auditLogsRelations = relations(auditLogs, ({ one }) => ({\n  actor: one(users, {\n    fields: [auditLogs.actorId],\n    references: [users.id],\n  }),\n}));\n\n// =============================================================================\n// BLOCKCHAIN & NFT TABLES - Content Ownership System\n// =============================================================================\n\nexport const nftCollections = pgTable(\"nft_collections\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  creatorId: varchar(\"creator_id\").references(() => users.id).notNull(),\n  name: varchar(\"name\").notNull(),\n  symbol: varchar(\"symbol\").notNull(), // e.g., \"PUPFANZ\"\n  description: text(\"description\"),\n  contractAddress: varchar(\"contract_address\"), // Blockchain contract address\n  blockchain: varchar(\"blockchain\", { enum: ['ethereum', 'polygon', 'solana', 'base'] }).default('polygon'),\n  royaltyPercentage: decimal(\"royalty_percentage\", { precision: 5, scale: 2 }).default('10.00'), // Creator royalties\n  totalSupply: integer(\"total_supply\").default(0),\n  floorPrice: decimal(\"floor_price\", { precision: 18, scale: 8 }),\n  totalVolume: decimal(\"total_volume\", { precision: 18, scale: 8 }).default('0'),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\nexport const nfts = pgTable(\"nfts\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  collectionId: varchar(\"collection_id\").references(() => nftCollections.id).notNull(),\n  contentId: varchar(\"content_id\").references(() => content.id), // Links to actual content\n  tokenId: varchar(\"token_id\").notNull(), // On-chain token ID\n  tokenUri: text(\"token_uri\"), // IPFS or metadata URL\n  name: varchar(\"name\").notNull(),\n  description: text(\"description\"),\n  mintedBy: varchar(\"minted_by\").references(() => users.id).notNull(),\n  currentOwner: varchar(\"current_owner\").references(() => users.id).notNull(),\n  mintPrice: decimal(\"mint_price\", { precision: 18, scale: 8 }),\n  lastSalePrice: decimal(\"last_sale_price\", { precision: 18, scale: 8 }),\n  isListed: boolean(\"is_listed\").default(false),\n  listPrice: decimal(\"list_price\", { precision: 18, scale: 8 }),\n  rarity: varchar(\"rarity\", { enum: ['common', 'rare', 'epic', 'legendary'] }).default('common'),\n  metadata: jsonb(\"metadata\").default({}), // Additional attributes\n  transactionHash: varchar(\"transaction_hash\"), // Minting transaction\n  mintedAt: timestamp(\"minted_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\nexport const nftOwnershipHistory = pgTable(\"nft_ownership_history\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  nftId: varchar(\"nft_id\").references(() => nfts.id).notNull(),\n  fromOwner: varchar(\"from_owner\").references(() => users.id), // null for minting\n  toOwner: varchar(\"to_owner\").references(() => users.id).notNull(),\n  transactionType: varchar(\"transaction_type\", { enum: ['mint', 'sale', 'transfer', 'gift'] }).notNull(),\n  price: decimal(\"price\", { precision: 18, scale: 8 }), // Sale price if applicable\n  transactionHash: varchar(\"transaction_hash\"),\n  blockchain: varchar(\"blockchain\").notNull(),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n});\n\nexport const nftRoyalties = pgTable(\"nft_royalties\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  nftId: varchar(\"nft_id\").references(() => nfts.id).notNull(),\n  collectionId: varchar(\"collection_id\").references(() => nftCollections.id).notNull(),\n  creatorId: varchar(\"creator_id\").references(() => users.id).notNull(),\n  saleId: varchar(\"sale_id\").references(() => nftOwnershipHistory.id).notNull(),\n  salePrice: decimal(\"sale_price\", { precision: 18, scale: 8 }).notNull(),\n  royaltyAmount: decimal(\"royalty_amount\", { precision: 18, scale: 8 }).notNull(),\n  royaltyPercentage: decimal(\"royalty_percentage\", { precision: 5, scale: 2 }).notNull(),\n  status: varchar(\"status\", { enum: ['pending', 'paid', 'failed'] }).default('pending'),\n  transactionHash: varchar(\"transaction_hash\"), // Payment transaction\n  paidAt: timestamp(\"paid_at\"),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n});\n\n// Insert schemas for NFT tables\nexport const insertNftCollectionSchema = createInsertSchema(nftCollections).omit({ id: true, createdAt: true, updatedAt: true });\nexport const insertNftSchema = createInsertSchema(nfts).omit({ id: true, mintedAt: true, updatedAt: true });\nexport const insertNftOwnershipHistorySchema = createInsertSchema(nftOwnershipHistory).omit({ id: true, createdAt: true });\nexport const insertNftRoyaltySchema = createInsertSchema(nftRoyalties).omit({ id: true, createdAt: true });\n\n// Types\nexport type NftCollection = typeof nftCollections.$inferSelect;\nexport type InsertNftCollection = z.infer<typeof insertNftCollectionSchema>;\nexport type Nft = typeof nfts.$inferSelect;\nexport type InsertNft = z.infer<typeof insertNftSchema>;\nexport type NftOwnershipHistory = typeof nftOwnershipHistory.$inferSelect;\nexport type InsertNftOwnershipHistory = z.infer<typeof insertNftOwnershipHistorySchema>;\nexport type NftRoyalty = typeof nftRoyalties.$inferSelect;\nexport type InsertNftRoyalty = z.infer<typeof insertNftRoyaltySchema>;\n\n// Relations\nexport const nftCollectionsRelations = relations(nftCollections, ({ one, many }) => ({\n  creator: one(users, {\n    fields: [nftCollections.creatorId],\n    references: [users.id],\n  }),\n  nfts: many(nfts),\n  royalties: many(nftRoyalties),\n}));\n\nexport const nftsRelations = relations(nfts, ({ one, many }) => ({\n  collection: one(nftCollections, {\n    fields: [nfts.collectionId],\n    references: [nftCollections.id],\n  }),\n  content: one(content, {\n    fields: [nfts.contentId],\n    references: [content.id],\n  }),\n  minter: one(users, {\n    fields: [nfts.mintedBy],\n    references: [users.id],\n    relationName: \"mintedNfts\",\n  }),\n  owner: one(users, {\n    fields: [nfts.currentOwner],\n    references: [users.id],\n    relationName: \"ownedNfts\",\n  }),\n  ownershipHistory: many(nftOwnershipHistory),\n  royalties: many(nftRoyalties),\n}));\n\nexport const nftOwnershipHistoryRelations = relations(nftOwnershipHistory, ({ one }) => ({\n  nft: one(nfts, {\n    fields: [nftOwnershipHistory.nftId],\n    references: [nfts.id],\n  }),\n  from: one(users, {\n    fields: [nftOwnershipHistory.fromOwner],\n    references: [users.id],\n    relationName: \"nftsSold\",\n  }),\n  to: one(users, {\n    fields: [nftOwnershipHistory.toOwner],\n    references: [users.id],\n    relationName: \"nftsPurchased\",\n  }),\n}));\n\nexport const nftRoyaltiesRelations = relations(nftRoyalties, ({ one }) => ({\n  nft: one(nfts, {\n    fields: [nftRoyalties.nftId],\n    references: [nfts.id],\n  }),\n  collection: one(nftCollections, {\n    fields: [nftRoyalties.collectionId],\n    references: [nftCollections.id],\n  }),\n  creator: one(users, {\n    fields: [nftRoyalties.creatorId],\n    references: [users.id],\n  }),\n  sale: one(nftOwnershipHistory, {\n    fields: [nftRoyalties.saleId],\n    references: [nftOwnershipHistory.id],\n  }),\n}));\n\n// =============================================================================\n// AI VOICE CLONING TABLES - Personalized Voice Messages\n// =============================================================================\n\nexport const voiceModels = pgTable(\"voice_models\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  creatorId: varchar(\"creator_id\").references(() => users.id).notNull(),\n  name: varchar(\"name\").notNull(),\n  description: text(\"description\"),\n  status: varchar(\"status\", { enum: ['training', 'ready', 'failed'] }).default('training'),\n  modelProvider: varchar(\"model_provider\", { enum: ['elevenlabs', 'playht', 'murf', 'resemble'] }).default('elevenlabs'),\n  modelId: varchar(\"model_id\"), // External provider model ID\n  voiceSamples: jsonb(\"voice_samples\").default([]), // URLs to training audio\n  modelSettings: jsonb(\"model_settings\").default({}), // Pitch, speed, etc.\n  usageCount: integer(\"usage_count\").default(0),\n  totalDuration: integer(\"total_duration\").default(0), // Total seconds generated\n  isActive: boolean(\"is_active\").default(true),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\nexport const voiceMessages = pgTable(\"voice_messages\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  voiceModelId: varchar(\"voice_model_id\").references(() => voiceModels.id).notNull(),\n  creatorId: varchar(\"creator_id\").references(() => users.id).notNull(),\n  recipientId: varchar(\"recipient_id\").references(() => users.id), // null for templates\n  messageType: varchar(\"message_type\", { \n    enum: ['dm', 'welcome', 'milestone', 'birthday', 'custom', 'bulk'] \n  }).notNull(),\n  scriptText: text(\"script_text\").notNull(),\n  audioUrl: varchar(\"audio_url\"), // Generated audio file URL\n  duration: integer(\"duration\"), // Duration in seconds\n  status: varchar(\"status\", { enum: ['pending', 'generating', 'ready', 'sent', 'failed'] }).default('pending'),\n  metadata: jsonb(\"metadata\").default({}), // Fan name placeholders, etc.\n  sentAt: timestamp(\"sent_at\"),\n  error: text(\"error\"),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n});\n\nexport const voiceAutomation = pgTable(\"voice_automation\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  creatorId: varchar(\"creator_id\").references(() => users.id).notNull(),\n  voiceModelId: varchar(\"voice_model_id\").references(() => voiceModels.id).notNull(),\n  triggerType: varchar(\"trigger_type\", { \n    enum: ['new_subscriber', 'tip_received', 'milestone', 'birthday', 'anniversary'] \n  }).notNull(),\n  scriptTemplate: text(\"script_template\").notNull(), // With {fanName}, {amount}, etc.\n  isActive: boolean(\"is_active\").default(true),\n  minTipAmount: decimal(\"min_tip_amount\", { precision: 10, scale: 2 }), // For tip triggers\n  settings: jsonb(\"settings\").default({}), // Additional trigger conditions\n  usageCount: integer(\"usage_count\").default(0),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\nexport const voiceMessageQueue = pgTable(\"voice_message_queue\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  voiceMessageId: varchar(\"voice_message_id\").references(() => voiceMessages.id).notNull(),\n  priority: integer(\"priority\").default(5), // 1-10, higher = more urgent\n  attempts: integer(\"attempts\").default(0),\n  lastAttempt: timestamp(\"last_attempt\"),\n  scheduledFor: timestamp(\"scheduled_for\").defaultNow(),\n  status: varchar(\"status\", { enum: ['queued', 'processing', 'completed', 'failed'] }).default('queued'),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n});\n\n// Insert schemas\nexport const insertVoiceModelSchema = createInsertSchema(voiceModels).omit({ id: true, createdAt: true, updatedAt: true });\nexport const insertVoiceMessageSchema = createInsertSchema(voiceMessages).omit({ id: true, createdAt: true });\nexport const insertVoiceAutomationSchema = createInsertSchema(voiceAutomation).omit({ id: true, createdAt: true, updatedAt: true });\nexport const insertVoiceMessageQueueSchema = createInsertSchema(voiceMessageQueue).omit({ id: true, createdAt: true });\n\n// Types\nexport type VoiceModel = typeof voiceModels.$inferSelect;\nexport type InsertVoiceModel = z.infer<typeof insertVoiceModelSchema>;\nexport type VoiceMessage = typeof voiceMessages.$inferSelect;\nexport type InsertVoiceMessage = z.infer<typeof insertVoiceMessageSchema>;\nexport type VoiceAutomation = typeof voiceAutomation.$inferSelect;\nexport type InsertVoiceAutomation = z.infer<typeof insertVoiceAutomationSchema>;\nexport type VoiceMessageQueue = typeof voiceMessageQueue.$inferSelect;\nexport type InsertVoiceMessageQueue = z.infer<typeof insertVoiceMessageQueueSchema>;\n\n// Relations\nexport const voiceModelsRelations = relations(voiceModels, ({ one, many }) => ({\n  creator: one(users, {\n    fields: [voiceModels.creatorId],\n    references: [users.id],\n  }),\n  messages: many(voiceMessages),\n  automations: many(voiceAutomation),\n}));\n\nexport const voiceMessagesRelations = relations(voiceMessages, ({ one }) => ({\n  voiceModel: one(voiceModels, {\n    fields: [voiceMessages.voiceModelId],\n    references: [voiceModels.id],\n  }),\n  creator: one(users, {\n    fields: [voiceMessages.creatorId],\n    references: [users.id],\n    relationName: \"creatorVoiceMessages\",\n  }),\n  recipient: one(users, {\n    fields: [voiceMessages.recipientId],\n    references: [users.id],\n    relationName: \"receivedVoiceMessages\",\n  }),\n  queue: one(voiceMessageQueue, {\n    fields: [voiceMessages.id],\n    references: [voiceMessageQueue.voiceMessageId],\n  }),\n}));\n\nexport const voiceAutomationRelations = relations(voiceAutomation, ({ one }) => ({\n  creator: one(users, {\n    fields: [voiceAutomation.creatorId],\n    references: [users.id],\n  }),\n  voiceModel: one(voiceModels, {\n    fields: [voiceAutomation.voiceModelId],\n    references: [voiceModels.id],\n  }),\n}));\n\nexport const voiceMessageQueueRelations = relations(voiceMessageQueue, ({ one }) => ({\n  voiceMessage: one(voiceMessages, {\n    fields: [voiceMessageQueue.voiceMessageId],\n    references: [voiceMessages.id],\n  }),\n}));\n\n// =============================================================================\n// HOLOGRAPHIC STREAMING INFRASTRUCTURE\n// =============================================================================\n\nexport const avatarModels = pgTable(\"avatar_models\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  creatorId: varchar(\"creator_id\").references(() => users.id).notNull(),\n  name: varchar(\"name\").notNull(),\n  description: text(\"description\"),\n  modelFormat: varchar(\"model_format\", { \n    enum: ['glb', 'fbx', 'usdz', 'vrm'] \n  }).default('glb'),\n  modelUrl: varchar(\"model_url\").notNull(),\n  textureUrls: jsonb(\"texture_urls\").default([]),\n  animationData: jsonb(\"animation_data\").default({}), // Gesture/pose animations\n  riggingData: jsonb(\"rigging_data\").default({}), // Skeleton/bone structure\n  thumbnailUrl: varchar(\"thumbnail_url\"),\n  polyCount: integer(\"poly_count\"), // Model complexity\n  fileSize: integer(\"file_size\"), // Bytes\n  isActive: boolean(\"is_active\").default(true),\n  usageCount: integer(\"usage_count\").default(0),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\nexport const holographicStreams = pgTable(\"holographic_streams\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  creatorId: varchar(\"creator_id\").references(() => users.id).notNull(),\n  avatarModelId: varchar(\"avatar_model_id\").references(() => avatarModels.id),\n  title: varchar(\"title\").notNull(),\n  description: text(\"description\"),\n  streamType: varchar(\"stream_type\", { \n    enum: ['vr', 'ar', 'mixed_reality', 'hologram'] \n  }).notNull(),\n  status: varchar(\"status\", { \n    enum: ['scheduled', 'live', 'ended', 'processing'] \n  }).default('scheduled'),\n  spatialAudioEnabled: boolean(\"spatial_audio_enabled\").default(true),\n  viewerCount: integer(\"viewer_count\").default(0),\n  peakViewerCount: integer(\"peak_viewer_count\").default(0),\n  maxViewers: integer(\"max_viewers\").default(100),\n  qualitySettings: jsonb(\"quality_settings\").default({\n    resolution: '4k',\n    frameRate: 60,\n    bitrate: 'auto'\n  }),\n  environmentSettings: jsonb(\"environment_settings\").default({\n    skybox: 'default',\n    lighting: 'natural',\n    atmosphere: 'clear'\n  }),\n  interactionSettings: jsonb(\"interaction_settings\").default({\n    allowGestures: true,\n    allowVoiceChat: true,\n    allowTipping: true\n  }),\n  recordingUrl: varchar(\"recording_url\"), // Post-stream recording\n  highlightsUrl: varchar(\"highlights_url\"), // AI-generated highlights\n  scheduledFor: timestamp(\"scheduled_for\"),\n  startedAt: timestamp(\"started_at\"),\n  endedAt: timestamp(\"ended_at\"),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\nexport const holographicViewers = pgTable(\"holographic_viewers\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  streamId: varchar(\"stream_id\").references(() => holographicStreams.id).notNull(),\n  userId: varchar(\"user_id\").references(() => users.id).notNull(),\n  deviceType: varchar(\"device_type\", { \n    enum: ['oculus_quest', 'oculus_rift', 'hololens', 'apple_vision_pro', 'psvr', 'vive', 'index', 'mobile_ar', 'web_vr'] \n  }).notNull(),\n  viewerPosition: jsonb(\"viewer_position\").default({ x: 0, y: 0, z: 0 }), // 3D coordinates\n  viewerOrientation: jsonb(\"viewer_orientation\").default({ pitch: 0, yaw: 0, roll: 0 }), // Euler angles\n  viewQuality: varchar(\"view_quality\", { \n    enum: ['low', 'medium', 'high', 'ultra'] \n  }).default('high'),\n  interactionMode: varchar(\"interaction_mode\", { \n    enum: ['spectator', 'interactive', 'vip'] \n  }).default('spectator'),\n  joinedAt: timestamp(\"joined_at\").defaultNow(),\n  leftAt: timestamp(\"left_at\"),\n  watchTime: integer(\"watch_time\").default(0), // Seconds\n  tipsGiven: decimal(\"tips_given\", { precision: 10, scale: 2 }).default('0'),\n  gesturesUsed: jsonb(\"gestures_used\").default([]), // Wave, heart, applause, etc.\n});\n\nexport const spatialAudioTracks = pgTable(\"spatial_audio_tracks\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  streamId: varchar(\"stream_id\").references(() => holographicStreams.id).notNull(),\n  trackType: varchar(\"track_type\", { \n    enum: ['voice', 'music', 'ambient', 'effects'] \n  }).notNull(),\n  trackName: varchar(\"track_name\").notNull(),\n  audioUrl: varchar(\"audio_url\").notNull(),\n  position: jsonb(\"position\").default({ x: 0, y: 1.6, z: 0 }), // 3D position (y=1.6 is head height)\n  volume: decimal(\"volume\", { precision: 3, scale: 2 }).default('1.00'), // 0.00-1.00\n  spatialRange: decimal(\"spatial_range\", { precision: 5, scale: 2 }).default('10.00'), // Meters\n  attenuationModel: varchar(\"attenuation_model\", { \n    enum: ['linear', 'inverse', 'exponential'] \n  }).default('inverse'),\n  directionalCone: jsonb(\"directional_cone\").default({\n    innerAngle: 360,\n    outerAngle: 360,\n    outerGain: 0.3\n  }),\n  isActive: boolean(\"is_active\").default(true),\n  startTime: timestamp(\"start_time\"),\n  endTime: timestamp(\"end_time\"),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n});\n\n// Insert schemas\nexport const insertAvatarModelSchema = createInsertSchema(avatarModels).omit({ id: true, createdAt: true, updatedAt: true });\nexport const insertHolographicStreamSchema = createInsertSchema(holographicStreams).omit({ id: true, createdAt: true, updatedAt: true });\nexport const insertHolographicViewerSchema = createInsertSchema(holographicViewers).omit({ id: true });\nexport const insertSpatialAudioTrackSchema = createInsertSchema(spatialAudioTracks).omit({ id: true, createdAt: true });\n\n// Types\nexport type AvatarModel = typeof avatarModels.$inferSelect;\nexport type InsertAvatarModel = z.infer<typeof insertAvatarModelSchema>;\nexport type HolographicStream = typeof holographicStreams.$inferSelect;\nexport type InsertHolographicStream = z.infer<typeof insertHolographicStreamSchema>;\nexport type HolographicViewer = typeof holographicViewers.$inferSelect;\nexport type InsertHolographicViewer = z.infer<typeof insertHolographicViewerSchema>;\nexport type SpatialAudioTrack = typeof spatialAudioTracks.$inferSelect;\nexport type InsertSpatialAudioTrack = z.infer<typeof insertSpatialAudioTrackSchema>;\n\n// Relations\nexport const avatarModelsRelations = relations(avatarModels, ({ one, many }) => ({\n  creator: one(users, {\n    fields: [avatarModels.creatorId],\n    references: [users.id],\n  }),\n  streams: many(holographicStreams),\n}));\n\nexport const holographicStreamsRelations = relations(holographicStreams, ({ one, many }) => ({\n  creator: one(users, {\n    fields: [holographicStreams.creatorId],\n    references: [users.id],\n  }),\n  avatarModel: one(avatarModels, {\n    fields: [holographicStreams.avatarModelId],\n    references: [avatarModels.id],\n  }),\n  viewers: many(holographicViewers),\n  audioTracks: many(spatialAudioTracks),\n}));\n\nexport const holographicViewersRelations = relations(holographicViewers, ({ one }) => ({\n  stream: one(holographicStreams, {\n    fields: [holographicViewers.streamId],\n    references: [holographicStreams.id],\n  }),\n  user: one(users, {\n    fields: [holographicViewers.userId],\n    references: [users.id],\n  }),\n}));\n\nexport const spatialAudioTracksRelations = relations(spatialAudioTracks, ({ one }) => ({\n  stream: one(holographicStreams, {\n    fields: [spatialAudioTracks.streamId],\n    references: [holographicStreams.id],\n  }),\n}));\n\n// =============================================================================\n// DYNAMIC PRICING AI\n// =============================================================================\n\nexport const pricingStrategies = pgTable(\"pricing_strategies\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  creatorId: varchar(\"creator_id\").references(() => users.id).notNull(),\n  contentId: varchar(\"content_id\").references(() => mediaAssets.id), // null = global strategy\n  strategyType: varchar(\"strategy_type\", { \n    enum: ['surge', 'demand_curve', 'time_decay', 'engagement_based', 'auction', 'personalized'] \n  }).notNull(),\n  basePrice: decimal(\"base_price\", { precision: 10, scale: 2 }).notNull(),\n  minPrice: decimal(\"min_price\", { precision: 10, scale: 2 }).notNull(),\n  maxPrice: decimal(\"max_price\", { precision: 10, scale: 2 }).notNull(),\n  demandMultiplier: decimal(\"demand_multiplier\", { precision: 5, scale: 2 }).default('1.00'), // 1.0 = normal, 2.0 = 2x price\n  engagementWeights: jsonb(\"engagement_weights\").default({\n    views: 0.3,\n    likes: 0.4,\n    comments: 0.2,\n    shares: 0.1\n  }),\n  timeDecayRate: decimal(\"time_decay_rate\", { precision: 5, scale: 4 }).default('0.0500'), // 5% decrease per day\n  surgeThreshold: integer(\"surge_threshold\").default(100), // Viewers needed for surge\n  auctionSettings: jsonb(\"auction_settings\").default({\n    startingBid: 10,\n    bidIncrement: 1,\n    duration: 3600\n  }),\n  isActive: boolean(\"is_active\").default(true),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\nexport const priceHistory = pgTable(\"price_history\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  contentId: varchar(\"content_id\").references(() => mediaAssets.id).notNull(),\n  strategyId: varchar(\"strategy_id\").references(() => pricingStrategies.id),\n  previousPrice: decimal(\"previous_price\", { precision: 10, scale: 2 }).notNull(),\n  newPrice: decimal(\"new_price\", { precision: 10, scale: 2 }).notNull(),\n  priceChangeReason: varchar(\"price_change_reason\", { \n    enum: ['demand_surge', 'low_demand', 'engagement_boost', 'time_decay', 'manual_override', 'auction_result', 'ai_optimization'] \n  }).notNull(),\n  demandScore: decimal(\"demand_score\", { precision: 5, scale: 2 }), // 0-100\n  engagementScore: decimal(\"engagement_score\", { precision: 5, scale: 2 }), // 0-100\n  viewersActive: integer(\"viewers_active\"), // Concurrent viewers at time of change\n  purchaseRate: decimal(\"purchase_rate\", { precision: 5, scale: 2 }), // % of viewers who purchased\n  revenueImpact: decimal(\"revenue_impact\", { precision: 10, scale: 2 }), // Expected revenue change\n  timestamp: timestamp(\"timestamp\").defaultNow(),\n});\n\nexport const demandMetrics = pgTable(\"demand_metrics\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  contentId: varchar(\"content_id\").references(() => mediaAssets.id).notNull(),\n  creatorId: varchar(\"creator_id\").references(() => users.id).notNull(),\n  viewCount: integer(\"view_count\").default(0),\n  uniqueViewers: integer(\"unique_viewers\").default(0),\n  avgWatchTime: integer(\"avg_watch_time\").default(0), // Seconds\n  likeCount: integer(\"like_count\").default(0),\n  commentCount: integer(\"comment_count\").default(0),\n  shareCount: integer(\"share_count\").default(0),\n  purchaseCount: integer(\"purchase_count\").default(0),\n  revenue: decimal(\"revenue\", { precision: 10, scale: 2 }).default('0'),\n  demandScore: decimal(\"demand_score\", { precision: 5, scale: 2 }).default('0'), // AI-calculated 0-100\n  trendingScore: decimal(\"trending_score\", { precision: 5, scale: 2 }).default('0'), // Velocity of engagement\n  competitorPriceAvg: decimal(\"competitor_price_avg\", { precision: 10, scale: 2 }), // Similar content avg price\n  lastUpdated: timestamp(\"last_updated\").defaultNow(),\n});\n\nexport const priceOptimization = pgTable(\"price_optimization\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  strategyId: varchar(\"strategy_id\").references(() => pricingStrategies.id).notNull(),\n  contentId: varchar(\"content_id\").references(() => mediaAssets.id).notNull(),\n  currentPrice: decimal(\"current_price\", { precision: 10, scale: 2 }).notNull(),\n  recommendedPrice: decimal(\"recommended_price\", { precision: 10, scale: 2 }).notNull(),\n  expectedRevenue: decimal(\"expected_revenue\", { precision: 10, scale: 2 }), // Projected revenue at recommended price\n  confidenceScore: decimal(\"confidence_score\", { precision: 3, scale: 2 }), // 0.00-1.00\n  optimizationFactors: jsonb(\"optimization_factors\").default({\n    demandWeight: 0.4,\n    engagementWeight: 0.3,\n    competitionWeight: 0.2,\n    timeWeight: 0.1\n  }),\n  priceElasticity: decimal(\"price_elasticity\", { precision: 5, scale: 3 }), // Demand sensitivity to price changes\n  optimalPriceRange: jsonb(\"optimal_price_range\").default({\n    low: 10,\n    high: 50,\n    sweet_spot: 25\n  }),\n  status: varchar(\"status\", { \n    enum: ['pending', 'applied', 'rejected', 'testing'] \n  }).default('pending'),\n  appliedAt: timestamp(\"applied_at\"),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n});\n\n// Insert schemas\nexport const insertPricingStrategySchema = createInsertSchema(pricingStrategies).omit({ id: true, createdAt: true, updatedAt: true });\nexport const insertPriceHistorySchema = createInsertSchema(priceHistory).omit({ id: true, timestamp: true });\nexport const insertDemandMetricSchema = createInsertSchema(demandMetrics).omit({ id: true, lastUpdated: true });\nexport const insertPriceOptimizationSchema = createInsertSchema(priceOptimization).omit({ id: true, createdAt: true });\n\n// Types\nexport type PricingStrategy = typeof pricingStrategies.$inferSelect;\nexport type InsertPricingStrategy = z.infer<typeof insertPricingStrategySchema>;\nexport type PriceHistory = typeof priceHistory.$inferSelect;\nexport type InsertPriceHistory = z.infer<typeof insertPriceHistorySchema>;\nexport type DemandMetric = typeof demandMetrics.$inferSelect;\nexport type InsertDemandMetric = z.infer<typeof insertDemandMetricSchema>;\nexport type PriceOptimization = typeof priceOptimization.$inferSelect;\nexport type InsertPriceOptimization = z.infer<typeof insertPriceOptimizationSchema>;\n\n// Relations\nexport const pricingStrategiesRelations = relations(pricingStrategies, ({ one, many }) => ({\n  creator: one(users, {\n    fields: [pricingStrategies.creatorId],\n    references: [users.id],\n  }),\n  content: one(mediaAssets, {\n    fields: [pricingStrategies.contentId],\n    references: [mediaAssets.id],\n  }),\n  optimizations: many(priceOptimization),\n  priceHistory: many(priceHistory),\n}));\n\nexport const priceHistoryRelations = relations(priceHistory, ({ one }) => ({\n  content: one(mediaAssets, {\n    fields: [priceHistory.contentId],\n    references: [mediaAssets.id],\n  }),\n  strategy: one(pricingStrategies, {\n    fields: [priceHistory.strategyId],\n    references: [pricingStrategies.id],\n  }),\n}));\n\nexport const demandMetricsRelations = relations(demandMetrics, ({ one }) => ({\n  content: one(mediaAssets, {\n    fields: [demandMetrics.contentId],\n    references: [mediaAssets.id],\n  }),\n  creator: one(users, {\n    fields: [demandMetrics.creatorId],\n    references: [users.id],\n  }),\n}));\n\nexport const priceOptimizationRelations = relations(priceOptimization, ({ one }) => ({\n  strategy: one(pricingStrategies, {\n    fields: [priceOptimization.strategyId],\n    references: [pricingStrategies.id],\n  }),\n  content: one(mediaAssets, {\n    fields: [priceOptimization.contentId],\n    references: [mediaAssets.id],\n  }),\n}));\n\n// =============================================================================\n// FAN-TO-CREATOR MICROLENDING SYSTEM\n// =============================================================================\n\nexport const loanListings = pgTable(\"loan_listings\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  creatorId: varchar(\"creator_id\").references(() => users.id).notNull(),\n  title: varchar(\"title\", { length: 255 }).notNull(),\n  description: text(\"description\").notNull(),\n  requestedAmount: decimal(\"requested_amount\", { precision: 10, scale: 2 }).notNull(),\n  purpose: varchar(\"purpose\", { \n    enum: ['equipment', 'production', 'marketing', 'studio_rental', 'costumes', 'props', 'software', 'other'] \n  }).notNull(),\n  interestRate: decimal(\"interest_rate\", { precision: 5, scale: 2 }).notNull(),\n  termMonths: integer(\"term_months\").notNull(),\n  collateralType: varchar(\"collateral_type\", {\n    enum: ['future_earnings', 'content_rights', 'revenue_share', 'equipment', 'none']\n  }).notNull(),\n  collateralDescription: text(\"collateral_description\"),\n  collateralValue: decimal(\"collateral_value\", { precision: 10, scale: 2 }),\n  minLoanAmount: decimal(\"min_loan_amount\", { precision: 10, scale: 2 }).notNull(),\n  maxLoanAmount: decimal(\"max_loan_amount\", { precision: 10, scale: 2 }).notNull(),\n  creditScore: integer(\"credit_score\").default(0),\n  riskLevel: varchar(\"risk_level\", { enum: ['low', 'medium', 'high', 'very_high'] }).default('medium'),\n  status: varchar(\"status\", { \n    enum: ['draft', 'active', 'funded', 'cancelled', 'expired'] \n  }).default('draft'),\n  fundingDeadline: timestamp(\"funding_deadline\"),\n  totalOffered: decimal(\"total_offered\", { precision: 10, scale: 2 }).default('0'),\n  offerCount: integer(\"offer_count\").default(0),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\nexport const loanOffers = pgTable(\"loan_offers\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  listingId: varchar(\"listing_id\").references(() => loanListings.id).notNull(),\n  lenderId: varchar(\"lender_id\").references(() => users.id).notNull(),\n  amount: decimal(\"amount\", { precision: 10, scale: 2 }).notNull(),\n  proposedInterestRate: decimal(\"proposed_interest_rate\", { precision: 5, scale: 2 }),\n  proposedTermMonths: integer(\"proposed_term_months\"),\n  message: text(\"message\"),\n  status: varchar(\"status\", {\n    enum: ['pending', 'accepted', 'rejected', 'withdrawn', 'expired']\n  }).default('pending'),\n  expiresAt: timestamp(\"expires_at\"),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\nexport const activeLoans = pgTable(\"active_loans\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  listingId: varchar(\"listing_id\").references(() => loanListings.id).notNull(),\n  offerId: varchar(\"offer_id\").references(() => loanOffers.id),\n  creatorId: varchar(\"creator_id\").references(() => users.id).notNull(),\n  lenderId: varchar(\"lender_id\").references(() => users.id).notNull(),\n  principalAmount: decimal(\"principal_amount\", { precision: 10, scale: 2 }).notNull(),\n  interestRate: decimal(\"interest_rate\", { precision: 5, scale: 2 }).notNull(),\n  termMonths: integer(\"term_months\").notNull(),\n  monthlyPayment: decimal(\"monthly_payment\", { precision: 10, scale: 2 }).notNull(),\n  totalRepayment: decimal(\"total_repayment\", { precision: 10, scale: 2 }).notNull(),\n  amountPaid: decimal(\"amount_paid\", { precision: 10, scale: 2 }).default('0'),\n  remainingBalance: decimal(\"remaining_balance\", { precision: 10, scale: 2 }).notNull(),\n  nextPaymentDue: timestamp(\"next_payment_due\"),\n  paymentsRemaining: integer(\"payments_remaining\").notNull(),\n  status: varchar(\"status\", {\n    enum: ['active', 'paid_off', 'defaulted', 'restructured', 'forgiven']\n  }).default('active'),\n  collateralType: varchar(\"collateral_type\", {\n    enum: ['future_earnings', 'content_rights', 'revenue_share', 'equipment', 'none']\n  }).notNull(),\n  collateralDetails: jsonb(\"collateral_details\"),\n  defaultedAt: timestamp(\"defaulted_at\"),\n  defaultReason: text(\"default_reason\"),\n  latePaymentCount: integer(\"late_payment_count\").default(0),\n  gracePeriodDays: integer(\"grace_period_days\").default(7),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\nexport const loanPayments = pgTable(\"loan_payments\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  loanId: varchar(\"loan_id\").references(() => activeLoans.id).notNull(),\n  amount: decimal(\"amount\", { precision: 10, scale: 2 }).notNull(),\n  principalAmount: decimal(\"principal_amount\", { precision: 10, scale: 2 }).notNull(),\n  interestAmount: decimal(\"interest_amount\", { precision: 10, scale: 2 }).notNull(),\n  paymentType: varchar(\"payment_type\", {\n    enum: ['scheduled', 'early', 'late', 'partial', 'final']\n  }).notNull(),\n  status: varchar(\"status\", {\n    enum: ['pending', 'processing', 'completed', 'failed', 'refunded']\n  }).default('pending'),\n  paymentMethod: varchar(\"payment_method\", { length: 100 }),\n  transactionId: varchar(\"transaction_id\", { length: 255 }),\n  dueDate: timestamp(\"due_date\").notNull(),\n  paidAt: timestamp(\"paid_at\"),\n  lateFee: decimal(\"late_fee\", { precision: 10, scale: 2 }).default('0'),\n  daysLate: integer(\"days_late\").default(0),\n  notes: text(\"notes\"),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n});\n\nexport const loanCollateral = pgTable(\"loan_collateral\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  loanId: varchar(\"loan_id\").references(() => activeLoans.id).notNull(),\n  collateralType: varchar(\"collateral_type\", {\n    enum: ['future_earnings', 'content_rights', 'revenue_share', 'equipment', 'none']\n  }).notNull(),\n  assetId: varchar(\"asset_id\"),\n  assetType: varchar(\"asset_type\", { length: 100 }),\n  valuationAmount: decimal(\"valuation_amount\", { precision: 10, scale: 2 }).notNull(),\n  valuationDate: timestamp(\"valuation_date\").defaultNow(),\n  earningsPercentage: decimal(\"earnings_percentage\", { precision: 5, scale: 2 }),\n  earningsMonths: integer(\"earnings_months\"),\n  contentRightsDetails: jsonb(\"content_rights_details\"),\n  equipmentDetails: jsonb(\"equipment_details\"),\n  status: varchar(\"status\", {\n    enum: ['active', 'released', 'seized', 'sold', 'transferred']\n  }).default('active'),\n  seizureDate: timestamp(\"seizure_date\"),\n  releaseDate: timestamp(\"release_date\"),\n  notes: text(\"notes\"),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\nexport const loanListingsRelations = relations(loanListings, ({ one, many }) => ({\n  creator: one(users, {\n    fields: [loanListings.creatorId],\n    references: [users.id],\n  }),\n  offers: many(loanOffers),\n  loans: many(activeLoans),\n}));\n\nexport const loanOffersRelations = relations(loanOffers, ({ one }) => ({\n  listing: one(loanListings, {\n    fields: [loanOffers.listingId],\n    references: [loanListings.id],\n  }),\n  lender: one(users, {\n    fields: [loanOffers.lenderId],\n    references: [users.id],\n  }),\n  loan: one(activeLoans, {\n    fields: [loanOffers.id],\n    references: [activeLoans.offerId],\n  }),\n}));\n\nexport const activeLoansRelations = relations(activeLoans, ({ one, many }) => ({\n  listing: one(loanListings, {\n    fields: [activeLoans.listingId],\n    references: [loanListings.id],\n  }),\n  offer: one(loanOffers, {\n    fields: [activeLoans.offerId],\n    references: [loanOffers.id],\n  }),\n  creator: one(users, {\n    fields: [activeLoans.creatorId],\n    references: [users.id],\n  }),\n  lender: one(users, {\n    fields: [activeLoans.lenderId],\n    references: [users.id],\n  }),\n  payments: many(loanPayments),\n  collateral: many(loanCollateral),\n}));\n\nexport const loanPaymentsRelations = relations(loanPayments, ({ one }) => ({\n  loan: one(activeLoans, {\n    fields: [loanPayments.loanId],\n    references: [activeLoans.id],\n  }),\n}));\n\nexport const loanCollateralRelations = relations(loanCollateral, ({ one }) => ({\n  loan: one(activeLoans, {\n    fields: [loanCollateral.loanId],\n    references: [activeLoans.id],\n  }),\n}));\n\n// =============================================================================\n// DEEPFAKE DETECTION SYSTEM\n// =============================================================================\n\nexport const deepfakeScans = pgTable(\"deepfake_scans\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  contentId: varchar(\"content_id\").references(() => mediaAssets.id).notNull(),\n  creatorId: varchar(\"creator_id\").references(() => users.id).notNull(),\n  scanType: varchar(\"scan_type\", {\n    enum: ['facial_analysis', 'voice_analysis', 'metadata_check', 'blockchain_verify', 'ai_detection', 'full_scan']\n  }).notNull(),\n  deepfakeScore: decimal(\"deepfake_score\", { precision: 5, scale: 2 }).notNull(),\n  authenticityScore: decimal(\"authenticity_score\", { precision: 5, scale: 2 }).notNull(),\n  confidence: decimal(\"confidence\", { precision: 5, scale: 2 }).notNull(),\n  detectionMethod: varchar(\"detection_method\", {\n    enum: ['facial_landmarks', 'audio_spectrogram', 'gan_detection', 'temporal_consistency', 'metadata_analysis', 'hybrid']\n  }).notNull(),\n  anomaliesDetected: jsonb(\"anomalies_detected\").default([]),\n  facialInconsistencies: jsonb(\"facial_inconsistencies\").default([]),\n  audioAnomalies: jsonb(\"audio_anomalies\").default([]),\n  metadataFlags: jsonb(\"metadata_flags\").default([]),\n  verdict: varchar(\"verdict\", {\n    enum: ['authentic', 'likely_authentic', 'suspicious', 'likely_deepfake', 'confirmed_deepfake']\n  }).notNull(),\n  riskLevel: varchar(\"risk_level\", {\n    enum: ['none', 'low', 'medium', 'high', 'critical']\n  }).default('none'),\n  processingTime: integer(\"processing_time_ms\"),\n  modelVersion: varchar(\"model_version\", { length: 50 }),\n  scanCompleted: boolean(\"scan_completed\").default(false),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\nexport const authenticitySignatures = pgTable(\"authenticity_signatures\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  contentId: varchar(\"content_id\").references(() => mediaAssets.id).notNull(),\n  creatorId: varchar(\"creator_id\").references(() => users.id).notNull(),\n  signatureHash: text(\"signature_hash\").notNull(),\n  signatureType: varchar(\"signature_type\", {\n    enum: ['blockchain', 'cryptographic', 'biometric', 'watermark', 'multi_factor']\n  }).notNull(),\n  blockchainTxId: varchar(\"blockchain_tx_id\", { length: 255 }),\n  blockchainNetwork: varchar(\"blockchain_network\", { length: 100 }),\n  verificationCode: varchar(\"verification_code\", { length: 100 }).notNull(),\n  biometricData: jsonb(\"biometric_data\"),\n  watermarkData: jsonb(\"watermark_data\"),\n  cryptoKeyFingerprint: text(\"crypto_key_fingerprint\"),\n  issuedAt: timestamp(\"issued_at\").defaultNow(),\n  expiresAt: timestamp(\"expires_at\"),\n  verified: boolean(\"verified\").default(true),\n  verificationCount: integer(\"verification_count\").default(0),\n  lastVerifiedAt: timestamp(\"last_verified_at\"),\n  revokedAt: timestamp(\"revoked_at\"),\n  revocationReason: text(\"revocation_reason\"),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\nexport const deepfakeReports = pgTable(\"deepfake_reports\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  contentId: varchar(\"content_id\").references(() => mediaAssets.id).notNull(),\n  reportedContentUrl: text(\"reported_content_url\").notNull(),\n  reporterId: varchar(\"reporter_id\").references(() => users.id).notNull(),\n  targetCreatorId: varchar(\"target_creator_id\").references(() => users.id),\n  reportType: varchar(\"report_type\", {\n    enum: ['unauthorized_deepfake', 'identity_theft', 'manipulated_content', 'impersonation', 'fake_voice', 'other']\n  }).notNull(),\n  description: text(\"description\").notNull(),\n  evidence: jsonb(\"evidence\").default([]),\n  suspectedSource: text(\"suspected_source\"),\n  priority: varchar(\"priority\", {\n    enum: ['low', 'medium', 'high', 'urgent']\n  }).default('medium'),\n  status: varchar(\"status\", {\n    enum: ['pending', 'under_review', 'investigating', 'confirmed', 'dismissed', 'resolved']\n  }).default('pending'),\n  aiVerificationScore: decimal(\"ai_verification_score\", { precision: 5, scale: 2 }),\n  moderatorNotes: text(\"moderator_notes\"),\n  moderatorId: varchar(\"moderator_id\").references(() => users.id),\n  actionTaken: varchar(\"action_taken\", {\n    enum: ['none', 'content_removed', 'account_suspended', 'legal_action', 'dmca_filed', 'warning_issued']\n  }),\n  resolution: text(\"resolution\"),\n  resolvedAt: timestamp(\"resolved_at\"),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\nexport const deepfakeScansRelations = relations(deepfakeScans, ({ one }) => ({\n  content: one(mediaAssets, {\n    fields: [deepfakeScans.contentId],\n    references: [mediaAssets.id],\n  }),\n  creator: one(users, {\n    fields: [deepfakeScans.creatorId],\n    references: [users.id],\n  }),\n}));\n\nexport const authenticitySignaturesRelations = relations(authenticitySignatures, ({ one }) => ({\n  content: one(mediaAssets, {\n    fields: [authenticitySignatures.contentId],\n    references: [mediaAssets.id],\n  }),\n  creator: one(users, {\n    fields: [authenticitySignatures.creatorId],\n    references: [users.id],\n  }),\n}));\n\nexport const deepfakeReportsRelations = relations(deepfakeReports, ({ one }) => ({\n  content: one(mediaAssets, {\n    fields: [deepfakeReports.contentId],\n    references: [mediaAssets.id],\n  }),\n  reporter: one(users, {\n    fields: [deepfakeReports.reporterId],\n    references: [users.id],\n  }),\n  targetCreator: one(users, {\n    fields: [deepfakeReports.targetCreatorId],\n    references: [users.id],\n  }),\n  moderator: one(users, {\n    fields: [deepfakeReports.moderatorId],\n    references: [users.id],\n  }),\n}));\n\n// =============================================================================\n// EMOTIONAL AI ENGINE TABLES\n// =============================================================================\n\nexport const emotionalAnalyses = pgTable(\"emotional_analyses\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  userId: varchar(\"user_id\").references(() => users.id).notNull(),\n  interactionType: varchar(\"interaction_type\", { \n    enum: ['message', 'comment', 'tip', 'purchase', 'subscription', 'content_view'] \n  }).notNull(),\n  interactionId: varchar(\"interaction_id\"),\n  messageContent: text(\"message_content\"),\n  sentimentScore: decimal(\"sentiment_score\", { precision: 5, scale: 2 }).notNull(),\n  dominantEmotion: varchar(\"dominant_emotion\", { \n    enum: ['joy', 'sadness', 'anger', 'fear', 'surprise', 'love', 'excitement', 'frustration', 'neutral'] \n  }).notNull(),\n  emotionScores: jsonb(\"emotion_scores\").notNull(),\n  urgency: varchar(\"urgency\", { enum: ['low', 'medium', 'high', 'critical'] }).default('medium'),\n  responseRecommended: boolean(\"response_recommended\").default(false),\n  engagementPotential: decimal(\"engagement_potential\", { precision: 5, scale: 2 }).notNull(),\n  toxicityScore: decimal(\"toxicity_score\", { precision: 5, scale: 2 }).default('0'),\n  keywords: jsonb(\"keywords\").default([]),\n  context: jsonb(\"context\").default({}),\n  creatorId: varchar(\"creator_id\").references(() => users.id),\n  analyzedAt: timestamp(\"analyzed_at\").defaultNow(),\n});\n\nexport const moodProfiles = pgTable(\"mood_profiles\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  userId: varchar(\"user_id\").references(() => users.id).notNull(),\n  currentMood: varchar(\"current_mood\", { \n    enum: ['positive', 'neutral', 'negative', 'excited', 'calm', 'stressed'] \n  }).notNull(),\n  moodScore: decimal(\"mood_score\", { precision: 5, scale: 2 }).notNull(),\n  moodTrend: varchar(\"mood_trend\", { enum: ['improving', 'stable', 'declining'] }).default('stable'),\n  emotionalJourney: jsonb(\"emotional_journey\").default([]),\n  interactionFrequency: integer(\"interaction_frequency\").default(0),\n  positiveInteractions: integer(\"positive_interactions\").default(0),\n  negativeInteractions: integer(\"negative_interactions\").default(0),\n  averageSentiment: decimal(\"average_sentiment\", { precision: 5, scale: 2 }).default('0'),\n  lastInteractionEmotion: varchar(\"last_interaction_emotion\"),\n  engagementLevel: varchar(\"engagement_level\", { \n    enum: ['disengaged', 'casual', 'regular', 'highly_engaged', 'super_fan'] \n  }).default('casual'),\n  churnRisk: decimal(\"churn_risk\", { precision: 5, scale: 2 }).default('0'),\n  recommendedActions: jsonb(\"recommended_actions\").default([]),\n  creatorId: varchar(\"creator_id\").references(() => users.id),\n  lastUpdated: timestamp(\"last_updated\").defaultNow(),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n});\n\nexport const responseRecommendations = pgTable(\"response_recommendations\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  analysisId: varchar(\"analysis_id\").references(() => emotionalAnalyses.id).notNull(),\n  userId: varchar(\"user_id\").references(() => users.id).notNull(),\n  creatorId: varchar(\"creator_id\").references(() => users.id).notNull(),\n  recommendationType: varchar(\"recommendation_type\", { \n    enum: ['empathetic_response', 'engagement_boost', 'upsell_opportunity', 'retention_action', 'emergency_response'] \n  }).notNull(),\n  priority: varchar(\"priority\", { enum: ['low', 'medium', 'high', 'urgent'] }).default('medium'),\n  suggestedResponse: text(\"suggested_response\"),\n  responseVariants: jsonb(\"response_variants\").default([]),\n  actionItems: jsonb(\"action_items\").default([]),\n  expectedOutcome: text(\"expected_outcome\"),\n  confidenceScore: decimal(\"confidence_score\", { precision: 5, scale: 2 }).notNull(),\n  emotionalContext: jsonb(\"emotional_context\").notNull(),\n  personalizationTags: jsonb(\"personalization_tags\").default([]),\n  used: boolean(\"used\").default(false),\n  effectiveness: decimal(\"effectiveness\", { precision: 5, scale: 2 }),\n  userFeedback: text(\"user_feedback\"),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  usedAt: timestamp(\"used_at\"),\n});\n\nexport const emotionalAnalysesRelations = relations(emotionalAnalyses, ({ one }) => ({\n  user: one(users, {\n    fields: [emotionalAnalyses.userId],\n    references: [users.id],\n  }),\n  creator: one(users, {\n    fields: [emotionalAnalyses.creatorId],\n    references: [users.id],\n  }),\n}));\n\nexport const moodProfilesRelations = relations(moodProfiles, ({ one }) => ({\n  user: one(users, {\n    fields: [moodProfiles.userId],\n    references: [users.id],\n  }),\n  creator: one(users, {\n    fields: [moodProfiles.creatorId],\n    references: [users.id],\n  }),\n}));\n\nexport const responseRecommendationsRelations = relations(responseRecommendations, ({ one }) => ({\n  analysis: one(emotionalAnalyses, {\n    fields: [responseRecommendations.analysisId],\n    references: [emotionalAnalyses.id],\n  }),\n  user: one(users, {\n    fields: [responseRecommendations.userId],\n    references: [users.id],\n  }),\n  creator: one(users, {\n    fields: [responseRecommendations.creatorId],\n    references: [users.id],\n  }),\n}));","size_bytes":117493},"server/aiModerationService.ts":{"content":"import { db } from \"./db\";\nimport { \n  aiContentFlags, contentSafetyScores, mediaAssets,\n  type InsertAIContentFlag \n} from \"@shared/schema\";\nimport { eq, and } from \"drizzle-orm\";\n\n// AI Moderation Service for automated content analysis\nexport class AIModerationService {\n  \n  // Confidence thresholds for auto-actions\n  private readonly THRESHOLDS = {\n    CRITICAL: 90.0, // Auto-block content\n    HIGH: 75.0,     // Flag for human review\n    MEDIUM: 60.0,   // Monitor closely\n    LOW: 40.0,      // Log for pattern analysis\n  };\n\n  // Flag types and their severity\n  private readonly FLAG_SEVERITY = {\n    potential_minor: 'CRITICAL',\n    violence: 'CRITICAL',        // Violence should be CRITICAL\n    nsfw_extreme: 'CRITICAL',    // Extreme NSFW should be CRITICAL\n    hate_symbols: 'HIGH',\n    deepfake: 'MEDIUM',\n    suspicious_text: 'LOW',\n  };\n\n  // =============================================================================\n  // CONTENT ANALYSIS\n  // =============================================================================\n\n  /**\n   * Analyze image content for prohibited categories\n   * In production, this would call real AI vision models\n   */\n  async analyzeImage(contentId: string, imageUrl: string): Promise<void> {\n    // Simulate AI vision analysis\n    // In production: Call Claude Vision, GPT-4 Vision, or custom ML model\n    const analysisResults = await this.simulateImageAnalysis(imageUrl);\n\n    // Store each flag if confidence exceeds threshold\n    for (const [flagType, confidence] of Object.entries(analysisResults)) {\n      if (confidence > this.THRESHOLDS.LOW) {\n        await this.createFlag({\n          contentId,\n          flagType: flagType as any,\n          confidence: confidence.toString(),\n          model: 'ai-vision-v1',\n          details: {\n            imageUrl,\n            analysisTimestamp: new Date().toISOString(),\n            rawScores: analysisResults,\n          },\n        });\n      }\n    }\n\n    // Update content safety score\n    await this.updateContentSafetyScore(contentId);\n  }\n\n  /**\n   * Analyze video content\n   */\n  async analyzeVideo(contentId: string, videoUrl: string): Promise<void> {\n    // Simulate video analysis (sample frames + audio)\n    const analysisResults = await this.simulateVideoAnalysis(videoUrl);\n\n    for (const [flagType, confidence] of Object.entries(analysisResults)) {\n      if (confidence > this.THRESHOLDS.LOW) {\n        await this.createFlag({\n          contentId,\n          flagType: flagType as any,\n          confidence: confidence.toString(),\n          model: 'ai-video-v1',\n          details: {\n            videoUrl,\n            framesAnalyzed: 10, // Sample frames\n            audioAnalyzed: true,\n            rawScores: analysisResults,\n          },\n        });\n      }\n    }\n\n    await this.updateContentSafetyScore(contentId);\n  }\n\n  /**\n   * Analyze text content (captions, descriptions)\n   */\n  async analyzeText(contentId: string, text: string): Promise<void> {\n    const analysisResults = await this.simulateTextAnalysis(text);\n\n    if (analysisResults.suspicious_text > this.THRESHOLDS.LOW) {\n      await this.createFlag({\n        contentId,\n        flagType: 'suspicious_text',\n        confidence: analysisResults.suspicious_text.toString(),\n        model: 'ai-text-v1',\n        details: {\n          textLength: text.length,\n          flaggedPhrases: analysisResults.flaggedPhrases || [],\n          sentimentScore: analysisResults.sentiment || 0,\n        },\n      });\n    }\n\n    await this.updateContentSafetyScore(contentId);\n  }\n\n  /**\n   * Comprehensive content analysis (all media types)\n   */\n  async analyzeContent(contentId: string): Promise<void> {\n    const content = await db\n      .select()\n      .from(mediaAssets)\n      .where(eq(mediaAssets.id, contentId))\n      .limit(1);\n\n    if (!content[0]) {\n      throw new Error('Content not found');\n    }\n\n    const asset = content[0];\n    const internalPath = asset.objectPath;\n\n    if (!internalPath) {\n      console.warn(`No path found for content ${contentId}`);\n      return;\n    }\n\n    // Get publicly accessible URL for AI services\n    const accessibleUrl = await this.getAccessibleUrl(internalPath);\n\n    // Determine media type from mimeType\n    const isImage = asset.mimeType?.startsWith('image/');\n    const isVideo = asset.mimeType?.startsWith('video/');\n\n    // Analyze based on media type\n    if (isImage) {\n      await this.analyzeImage(contentId, accessibleUrl);\n    } else if (isVideo) {\n      await this.analyzeVideo(contentId, accessibleUrl);\n    }\n\n    // Always analyze text if present\n    if (asset.description) {\n      await this.analyzeText(contentId, asset.description);\n    }\n  }\n\n  // =============================================================================\n  // FLAG MANAGEMENT\n  // =============================================================================\n\n  /**\n   * Create an AI flag\n   */\n  async createFlag(data: InsertAIContentFlag) {\n    const [flag] = await db\n      .insert(aiContentFlags)\n      .values(data)\n      .returning();\n\n    console.log(`AI Flag created: ${flag.flagType} (${data.confidence}% confidence) for content ${data.contentId}`);\n\n    // Check if auto-action is needed for CRITICAL-severity flags\n    const confidence = parseFloat(data.confidence);\n    const severity = this.FLAG_SEVERITY[flag.flagType as keyof typeof this.FLAG_SEVERITY];\n    \n    // Trigger auto-action if:\n    // 1. Flag has CRITICAL severity (potential_minor, violence, nsfw_extreme), OR\n    // 2. Confidence meets CRITICAL threshold (â‰¥90%) regardless of severity\n    if (severity === 'CRITICAL' || confidence >= this.THRESHOLDS.CRITICAL) {\n      await this.triggerAutoAction(data.contentId, flag.flagType, confidence);\n    }\n\n    return flag;\n  }\n\n  /**\n   * Get all flags for content\n   */\n  async getContentFlags(contentId: string) {\n    return await db\n      .select()\n      .from(aiContentFlags)\n      .where(eq(aiContentFlags.contentId, contentId));\n  }\n\n  /**\n   * Mark flag as reviewed by human moderator\n   */\n  async reviewFlag(flagId: string, override: boolean) {\n    await db\n      .update(aiContentFlags)\n      .set({\n        isReviewed: true,\n        reviewerOverride: override,\n      })\n      .where(eq(aiContentFlags.id, flagId));\n  }\n\n  // =============================================================================\n  // SAFETY SCORING\n  // =============================================================================\n\n  /**\n   * Update content safety score based on AI flags\n   */\n  async updateContentSafetyScore(contentId: string) {\n    const flags = await this.getContentFlags(contentId);\n    \n    // Calculate overall safety score (100 = safest, 0 = most dangerous)\n    let overallScore = 100.0;\n    let criticalFlags = 0;\n    let highFlags = 0;\n    \n    for (const flag of flags) {\n      const confidence = parseFloat(flag.confidence);\n      const confidenceRatio = confidence / 100.0; // Normalize to 0-1 range\n      const severity = this.FLAG_SEVERITY[flag.flagType as keyof typeof this.FLAG_SEVERITY];\n      \n      // Deduct points based on severity and normalized confidence\n      // Maximum deduction per flag: CRITICAL=80, HIGH=50, MEDIUM=30, LOW=10\n      if (severity === 'CRITICAL') {\n        overallScore -= confidenceRatio * 80; // Max 80 points\n        criticalFlags++;\n      } else if (severity === 'HIGH') {\n        overallScore -= confidenceRatio * 50; // Max 50 points\n        highFlags++;\n      } else if (severity === 'MEDIUM') {\n        overallScore -= confidenceRatio * 30; // Max 30 points\n      } else {\n        overallScore -= confidenceRatio * 10; // Max 10 points\n      }\n    }\n\n    overallScore = Math.max(0, overallScore); // Floor at 0\n\n    // Determine risk level\n    let riskLevel: 'safe' | 'low' | 'medium' | 'high' | 'critical' = 'safe';\n    if (overallScore < 20 || criticalFlags > 0) riskLevel = 'critical';\n    else if (overallScore < 40 || highFlags > 2) riskLevel = 'high';\n    else if (overallScore < 60) riskLevel = 'medium';\n    else if (overallScore < 80) riskLevel = 'low';\n\n    // Upsert safety score\n    const existing = await db\n      .select()\n      .from(contentSafetyScores)\n      .where(eq(contentSafetyScores.contentId, contentId))\n      .limit(1);\n\n    if (existing[0]) {\n      await db\n        .update(contentSafetyScores)\n        .set({\n          overallScore: overallScore.toFixed(2),\n          aiFlags: flags.length,\n          riskLevel,\n          updatedAt: new Date(),\n        })\n        .where(eq(contentSafetyScores.contentId, contentId));\n    } else {\n      await db\n        .insert(contentSafetyScores)\n        .values({\n          contentId,\n          overallScore: overallScore.toFixed(2),\n          aiFlags: flags.length,\n          riskLevel,\n        });\n    }\n\n    return { overallScore, riskLevel, flagCount: flags.length };\n  }\n\n  /**\n   * Get content safety score\n   */\n  async getSafetyScore(contentId: string) {\n    const score = await db\n      .select()\n      .from(contentSafetyScores)\n      .where(eq(contentSafetyScores.contentId, contentId))\n      .limit(1);\n\n    return score[0] || null;\n  }\n\n  /**\n   * Get auto-action status for content\n   */\n  async getAutoActionStatus(contentId: string) {\n    const score = await this.getSafetyScore(contentId);\n    \n    if (!score) {\n      return {\n        autoActionTaken: false,\n        humanReviewStatus: null,\n        message: \"No safety score found\"\n      };\n    }\n\n    return {\n      autoActionTaken: score.autoActionTaken || false,\n      humanReviewStatus: score.humanReviewStatus || null,\n      riskLevel: score.riskLevel,\n      overallScore: score.overallScore,\n    };\n  }\n\n  /**\n   * Resolve auto-action (approve or reject auto-hidden content)\n   */\n  async resolveAutoAction(contentId: string, action: 'approve' | 'reject') {\n    const score = await this.getSafetyScore(contentId);\n    \n    if (!score) {\n      throw new Error('No safety score found for this content');\n    }\n\n    if (!score.autoActionTaken) {\n      throw new Error('No auto-action was taken for this content');\n    }\n\n    // Update human review status based on action\n    const newStatus = action === 'approve' ? 'approved' : 'rejected';\n    \n    // If approving, clear the auto-action flag to unhide content\n    const updateData: any = {\n      humanReviewStatus: newStatus,\n      updatedAt: new Date(),\n    };\n    \n    if (action === 'approve') {\n      updateData.autoActionTaken = false; // Clear flag to unhide content\n    }\n    \n    await db\n      .update(contentSafetyScores)\n      .set(updateData)\n      .where(eq(contentSafetyScores.contentId, contentId));\n\n    // Return updated score\n    const updatedScore = await this.getSafetyScore(contentId);\n\n    return {\n      contentId,\n      action,\n      humanReviewStatus: newStatus,\n      autoActionTaken: updatedScore?.autoActionTaken || false,\n      message: action === 'approve' \n        ? 'Content approved and unhidden' \n        : 'Content rejected and remains hidden',\n      safetyScore: updatedScore,\n    };\n  }\n\n  // =============================================================================\n  // AUTO-ACTIONS\n  // =============================================================================\n\n  /**\n   * Trigger automatic moderation action for critical flags\n   */\n  private async triggerAutoAction(contentId: string, flagType: string, confidence: number) {\n    console.log(`CRITICAL FLAG: ${flagType} (${confidence}%) on content ${contentId} - Auto-action triggered`);\n\n    // Ensure safety score exists first\n    const existing = await db\n      .select()\n      .from(contentSafetyScores)\n      .where(eq(contentSafetyScores.contentId, contentId))\n      .limit(1);\n\n    if (existing[0]) {\n      // Update existing score\n      await db\n        .update(contentSafetyScores)\n        .set({\n          autoActionTaken: true,\n          humanReviewStatus: 'flagged',\n        })\n        .where(eq(contentSafetyScores.contentId, contentId));\n    } else {\n      // Create new score with auto-action flag\n      await db\n        .insert(contentSafetyScores)\n        .values({\n          contentId,\n          overallScore: '0.00', // Critical flag = 0 score\n          riskLevel: 'critical',\n          autoActionTaken: true,\n          humanReviewStatus: 'flagged',\n          aiFlags: 1,\n        });\n    }\n\n    // In production: Could auto-hide content, notify moderators, etc.\n    // For now, just log and flag for review\n  }\n\n  // =============================================================================\n  // MEDIA URL HELPERS\n  // =============================================================================\n\n  /**\n   * Get publicly accessible URL for media analysis\n   * In production: Generate signed CDN URLs or fetch bytes from storage\n   */\n  private async getAccessibleUrl(internalPath: string): Promise<string> {\n    // TODO: In production, replace with:\n    // 1. Generate signed GCS URL: await objectStorageService.getSignedUrl(internalPath)\n    // 2. Or use CDN URL if available\n    // 3. Or fetch bytes and convert to base64 data URL for AI services\n    \n    // For now, return the path as-is for development\n    // In production, this would fail with external AI services\n    return internalPath;\n  }\n\n  // =============================================================================\n  // SIMULATED AI ANALYSIS\n  // =============================================================================\n  // âš ï¸ WARNING: This section uses SIMULATED analysis with random scores\n  // âš ï¸ DO NOT USE IN PRODUCTION - Replace with real AI model integrations\n  // \n  // Production Integration Points:\n  // 1. Claude Vision API: https://docs.anthropic.com/claude/docs/vision\n  // 2. OpenAI GPT-4 Vision: https://platform.openai.com/docs/guides/vision\n  // 3. Custom ML Model: Your trained content moderation model\n  // 4. Third-party Services: ModerateContent, Sightengine, etc.\n  // =============================================================================\n\n  private async simulateImageAnalysis(imageUrl: string) {\n    // âš ï¸ PLACEHOLDER: Replace with real AI vision model\n    // Real implementation example:\n    // const response = await anthropic.messages.create({\n    //   model: \"claude-3-5-sonnet-20241022\",\n    //   max_tokens: 1024,\n    //   messages: [{\n    //     role: \"user\",\n    //     content: [\n    //       { type: \"image\", source: { type: \"url\", url: imageUrl } },\n    //       { type: \"text\", text: \"Analyze this image for prohibited content...\" }\n    //     ]\n    //   }]\n    // });\n    \n    // Deterministic stub for testing (based on URL hash)\n    const hash = imageUrl.split('').reduce((a, b) => {\n      a = ((a << 5) - a) + b.charCodeAt(0);\n      return a & a;\n    }, 0);\n    \n    const seed = Math.abs(hash) / 1000000;\n    \n    return {\n      nsfw_extreme: (seed * 30) % 30,\n      potential_minor: (seed * 10) % 10,\n      violence: (seed * 20) % 20,\n      hate_symbols: (seed * 15) % 15,\n      deepfake: (seed * 25) % 25,\n    };\n  }\n\n  private async simulateVideoAnalysis(videoUrl: string) {\n    // âš ï¸ PLACEHOLDER: Replace with real AI video model\n    // Deterministic stub for testing\n    const hash = videoUrl.split('').reduce((a, b) => {\n      a = ((a << 5) - a) + b.charCodeAt(0);\n      return a & a;\n    }, 0);\n    \n    const seed = Math.abs(hash) / 1000000;\n    \n    return {\n      nsfw_extreme: (seed * 30) % 30,\n      potential_minor: (seed * 10) % 10,\n      violence: (seed * 25) % 25,\n      hate_symbols: (seed * 15) % 15,\n      deepfake: (seed * 40) % 40, // Higher for video\n    };\n  }\n\n  private async simulateTextAnalysis(text: string) {\n    // âš ï¸ PLACEHOLDER: Replace with real AI text model\n    // Check for suspicious patterns (deterministic)\n    const suspiciousPatterns = [\n      /\\b(under|teen|young|minor)\\b/i,\n      /\\b(contact|meet|dm)\\b.*\\b(price|sell|buy)\\b/i,\n      /\\b(hate|kill|violence)\\b/i,\n    ];\n\n    let suspicionScore = 0;\n    const flaggedPhrases: string[] = [];\n\n    for (const pattern of suspiciousPatterns) {\n      if (pattern.test(text)) {\n        suspicionScore += 30;\n        flaggedPhrases.push(pattern.source);\n      }\n    }\n\n    // Deterministic sentiment based on text length\n    const sentimentSeed = (text.length * 7) % 100;\n\n    return {\n      suspicious_text: Math.min(100, suspicionScore),\n      flaggedPhrases,\n      sentiment: sentimentSeed - 50, // -50 to 50\n    };\n  }\n\n  // =============================================================================\n  // BATCH ANALYSIS\n  // =============================================================================\n\n  /**\n   * Analyze multiple content items in batch\n   */\n  async batchAnalyze(contentIds: string[]) {\n    const results = [];\n    \n    for (const contentId of contentIds) {\n      try {\n        await this.analyzeContent(contentId);\n        const score = await this.getSafetyScore(contentId);\n        results.push({ contentId, success: true, score });\n      } catch (error) {\n        console.error(`Failed to analyze content ${contentId}:`, error);\n        results.push({ contentId, success: false, error: (error as Error).message });\n      }\n    }\n\n    return results;\n  }\n\n  /**\n   * Re-analyze all unreviewed flagged content\n   */\n  async reanalyzeUnreviewed() {\n    const unreviewedFlags = await db\n      .select()\n      .from(aiContentFlags)\n      .where(eq(aiContentFlags.isReviewed, false));\n\n    const uniqueContentIds = Array.from(new Set(unreviewedFlags.map(f => f.contentId)));\n    \n    console.log(`Re-analyzing ${uniqueContentIds.length} pieces of flagged content...`);\n    return await this.batchAnalyze(uniqueContentIds);\n  }\n}\n\nexport const aiModerationService = new AIModerationService();\n","size_bytes":17639},"server/vite.ts":{"content":"import express, { type Express } from \"express\";\nimport fs from \"fs\";\nimport path from \"path\";\nimport { createServer as createViteServer, createLogger } from \"vite\";\nimport { type Server } from \"http\";\nimport viteConfig from \"../vite.config\";\nimport { nanoid } from \"nanoid\";\n\nconst viteLogger = createLogger();\n\nexport function log(message: string, source = \"express\") {\n  const formattedTime = new Date().toLocaleTimeString(\"en-US\", {\n    hour: \"numeric\",\n    minute: \"2-digit\",\n    second: \"2-digit\",\n    hour12: true,\n  });\n\n  console.log(`${formattedTime} [${source}] ${message}`);\n}\n\nexport async function setupVite(app: Express, server: Server) {\n  const serverOptions = {\n    middlewareMode: true,\n    hmr: { server },\n    allowedHosts: true as const,\n  };\n\n  const vite = await createViteServer({\n    ...viteConfig,\n    configFile: false,\n    customLogger: {\n      ...viteLogger,\n      error: (msg, options) => {\n        viteLogger.error(msg, options);\n        process.exit(1);\n      },\n    },\n    server: serverOptions,\n    appType: \"custom\",\n  });\n\n  app.use(vite.middlewares);\n  app.use(\"*\", async (req, res, next) => {\n    const url = req.originalUrl;\n\n    try {\n      const clientTemplate = path.resolve(\n        import.meta.dirname,\n        \"..\",\n        \"client\",\n        \"index.html\",\n      );\n\n      // always reload the index.html file from disk incase it changes\n      let template = await fs.promises.readFile(clientTemplate, \"utf-8\");\n      template = template.replace(\n        `src=\"/src/main.tsx\"`,\n        `src=\"/src/main.tsx?v=${nanoid()}\"`,\n      );\n      const page = await vite.transformIndexHtml(url, template);\n      res.status(200).set({ \"Content-Type\": \"text/html\" }).end(page);\n    } catch (e) {\n      vite.ssrFixStacktrace(e as Error);\n      next(e);\n    }\n  });\n}\n\nexport function serveStatic(app: Express) {\n  const distPath = path.resolve(import.meta.dirname, \"public\");\n\n  if (!fs.existsSync(distPath)) {\n    throw new Error(\n      `Could not find the build directory: ${distPath}, make sure to build the client first`,\n    );\n  }\n\n  app.use(express.static(distPath));\n\n  // fall through to index.html if the file doesn't exist\n  app.use(\"*\", (_req, res) => {\n    res.sendFile(path.resolve(distPath, \"index.html\"));\n  });\n}\n","size_bytes":2263},"client/src/components/layout/Footer.tsx":{"content":"import { Link } from \"wouter\";\nimport { Twitter, Instagram, MessageCircle, Send } from \"lucide-react\";\nimport pupfanzLogo from \"@/assets/pupfanz-logo.jpeg\";\nimport { Badge } from \"@/components/ui/badge\";\n\nexport default function Footer() {\n  const platformLinks = [\n    { name: 'Discover Creators', href: '/discover' },\n    { name: 'Become a Creator', href: '/creator-signup' },\n    { name: 'Pack Communities', href: '/packs' },\n    { name: 'Live Streams', href: '/live' },\n  ];\n\n  const safetyLinks = [\n    { name: 'Safety Center', href: '/safety' },\n    { name: 'Community Guidelines', href: '/guidelines' },\n    { name: 'Report Abuse', href: '/report' },\n    { name: 'Contact Support', href: '/support' },\n  ];\n\n  const legalLinks = [\n    { name: 'Terms of Service', href: '/terms' },\n    { name: 'Privacy Policy', href: '/privacy' },\n    { name: 'DMCA Policy', href: '/dmca' },\n    { name: '2257 Compliance', href: '/2257' },\n  ];\n\n  const socialLinks = [\n    { name: 'Twitter', href: '#', icon: Twitter },\n    { name: 'Instagram', href: '#', icon: Instagram },\n    { name: 'Discord', href: '#', icon: MessageCircle },\n    { name: 'Telegram', href: '#', icon: Send },\n  ];\n\n  return (\n    <footer className=\"bg-card border-t border-border py-12\">\n      <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8\">\n        <div className=\"grid md:grid-cols-4 gap-8 mb-8\">\n          {/* Brand */}\n          <div className=\"md:col-span-1\">\n            <div className=\"mb-4\">\n              <img \n                src={pupfanzLogo} \n                alt=\"PupFanz Logo\" \n                className=\"h-32 w-auto rounded-lg\"\n                data-testid=\"logo-footer\"\n              />\n            </div>\n            <p className=\"text-muted text-sm mb-4\">\n              The pack-centric creator platform where safety meets authentic connections. Built for the wild, high-energy community.\n            </p>\n            <div className=\"flex space-x-4\">\n              {socialLinks.map((social) => (\n                <a\n                  key={social.name}\n                  href={social.href}\n                  className=\"text-muted hover:text-primary transition-colors\"\n                  aria-label={social.name}\n                  data-testid={`social-${social.name.toLowerCase()}`}\n                >\n                  <social.icon className=\"h-5 w-5\" />\n                </a>\n              ))}\n            </div>\n          </div>\n\n          {/* Platform Links */}\n          <div>\n            <h4 className=\"neon-text-primary mb-4\">Platform</h4>\n            <ul className=\"space-y-2 text-sm\">\n              {platformLinks.map((link) => (\n                <li key={link.name}>\n                  <Link\n                    href={link.href}\n                    className=\"text-muted hover:text-foreground transition-colors\"\n                    data-testid={`footer-${link.name.toLowerCase().replace(/\\s+/g, '-')}`}\n                  >\n                    {link.name}\n                  </Link>\n                </li>\n              ))}\n            </ul>\n          </div>\n\n          {/* Safety Links */}\n          <div>\n            <h4 className=\"neon-text-secondary mb-4\">Safety & Support</h4>\n            <ul className=\"space-y-2 text-sm\">\n              {safetyLinks.map((link) => (\n                <li key={link.name}>\n                  <Link\n                    href={link.href}\n                    className=\"text-muted hover:text-foreground transition-colors\"\n                    data-testid={`footer-${link.name.toLowerCase().replace(/\\s+/g, '-')}`}\n                  >\n                    {link.name}\n                  </Link>\n                </li>\n              ))}\n            </ul>\n          </div>\n\n          {/* Legal Links */}\n          <div>\n            <h4 className=\"neon-text-accent mb-4\">Legal</h4>\n            <ul className=\"space-y-2 text-sm\">\n              {legalLinks.map((link) => (\n                <li key={link.name}>\n                  <Link\n                    href={link.href}\n                    className=\"text-muted hover:text-foreground transition-colors\"\n                    data-testid={`footer-${link.name.toLowerCase().replace(/\\s+/g, '-')}`}\n                  >\n                    {link.name}\n                  </Link>\n                </li>\n              ))}\n            </ul>\n          </div>\n        </div>\n\n        {/* Footer Bottom */}\n        <div className=\"pt-8 border-t border-border flex flex-col md:flex-row md:items-center md:justify-between\">\n          <p className=\"text-sm text-muted mb-4 md:mb-0\">\n            Â© 2024 PupFanz. All rights reserved. | 18+ Adult Content Platform\n          </p>\n          <div className=\"flex items-center space-x-4\">\n            <Badge className=\"safety-badge safety-badge-verified\">\n              <span className=\"mr-2\">ðŸ›¡ï¸</span>\n              2257 Compliant\n            </Badge>\n            <Badge className=\"safety-badge safety-badge-consent\">\n              <span className=\"mr-2\">ðŸ”’</span>\n              SSL Secured\n            </Badge>\n          </div>\n        </div>\n      </div>\n    </footer>\n  );\n}\n","size_bytes":5072},"client/src/pages/Dashboard.tsx":{"content":"import { useQuery } from \"@tanstack/react-query\";\nimport { useAuth } from \"@/hooks/useAuth\";\nimport Header from \"@/components/layout/Header\";\nimport Footer from \"@/components/layout/Footer\";\nimport EarningsCard from \"@/components/creator/EarningsCard\";\nimport ContentUpload from \"@/components/creator/ContentUpload\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport { TrendingUp, Users, Eye, Heart, Upload, MessageCircle, Settings, MoreHorizontal } from \"lucide-react\";\nimport { useEffect } from \"react\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { isUnauthorizedError } from \"@/lib/authUtils\";\n\nexport default function Dashboard() {\n  const { user, isAuthenticated } = useAuth();\n  const { toast } = useToast();\n\n  // Redirect to home if not authenticated\n  useEffect(() => {\n    if (!isAuthenticated) {\n      toast({\n        title: \"Unauthorized\",\n        description: \"You are logged out. Logging in again...\",\n        variant: \"destructive\",\n      });\n      setTimeout(() => {\n        window.location.href = \"/api/login\";\n      }, 500);\n      return;\n    }\n  }, [isAuthenticated, toast]);\n\n  const { data: stats, isLoading: statsLoading, error: statsError } = useQuery({\n    queryKey: ['/api/analytics/stats'],\n    enabled: isAuthenticated,\n  });\n\n  const { data: earnings, isLoading: earningsLoading, error: earningsError } = useQuery({\n    queryKey: ['/api/analytics/earnings/month'],\n    enabled: isAuthenticated,\n  });\n\n  const { data: content, isLoading: contentLoading, error: contentError } = useQuery({\n    queryKey: ['/api/content', user?.id],\n    enabled: isAuthenticated && !!user?.id,\n  });\n\n  // Handle errors\n  useEffect(() => {\n    const errors = [statsError, earningsError, contentError].filter(Boolean);\n    errors.forEach(error => {\n      if (error && isUnauthorizedError(error as Error)) {\n        toast({\n          title: \"Unauthorized\",\n          description: \"You are logged out. Logging in again...\",\n          variant: \"destructive\",\n        });\n        setTimeout(() => {\n          window.location.href = \"/api/login\";\n        }, 500);\n      }\n    });\n  }, [statsError, earningsError, contentError, toast]);\n\n  if (!isAuthenticated) {\n    return null; // Will redirect\n  }\n\n  return (\n    <div className=\"min-h-screen\">\n      <Header />\n      \n      <main className=\"pt-20 md:pt-32\">\n        <div className=\"max-w-7xl mx-auto px-3 sm:px-4 md:px-6 lg:px-8\">\n          {/* Dashboard Header */}\n          <div className=\"flex flex-col lg:flex-row lg:items-center lg:justify-between mb-6 md:mb-8\">\n            <div className=\"flex items-center space-x-3 md:space-x-4 mb-4 lg:mb-0\">\n              <div className=\"w-12 h-12 md:w-16 md:h-16 bg-gradient-to-br from-primary/20 to-secondary/20 rounded-xl flex items-center justify-center border-2 border-primary/30\">\n                {user?.profileImageUrl ? (\n                  <img \n                    src={user.profileImageUrl} \n                    alt=\"Profile\" \n                    className=\"w-full h-full rounded-xl object-cover\"\n                  />\n                ) : (\n                  <Users className=\"h-6 w-6 md:h-8 md:w-8 text-primary\" />\n                )}\n              </div>\n              <div>\n                <h1 className=\"font-display font-bold text-xl md:text-2xl text-foreground\" data-testid=\"text-username\">\n                  {user?.username || 'Creator'}\n                </h1>\n                <div className=\"flex items-center space-x-1 md:space-x-2 mt-1\">\n                  <Badge className=\"safety-badge safety-badge-verified text-xs\">\n                    <span className=\"hidden sm:inline\">Verified</span>\n                    <span className=\"sm:hidden\">âœ“</span>\n                  </Badge>\n                  <Badge className=\"safety-badge safety-badge-consent text-xs\">\n                    <span className=\"hidden sm:inline\">Consent-Clear</span>\n                    <span className=\"sm:hidden\">Safe</span>\n                  </Badge>\n                </div>\n              </div>\n            </div>\n            \n            <div className=\"flex items-center gap-2 sm:gap-4\">\n              <Button className=\"bg-accent text-accent-foreground hover:bg-accent/90 text-sm sm:text-base\" data-testid=\"button-upload-content\">\n                <Upload className=\"mr-2 h-4 w-4\" />\n                <span className=\"hidden sm:inline\">Upload Content</span>\n                <span className=\"sm:hidden\">Upload</span>\n              </Button>\n              <Button variant=\"outline\" size=\"icon\" data-testid=\"button-settings\">\n                <Settings className=\"h-4 w-4\" />\n              </Button>\n            </div>\n          </div>\n\n          {/* Stats Overview */}\n          <div className=\"grid grid-cols-2 md:grid-cols-4 gap-3 sm:gap-4 md:gap-6 mb-6 md:mb-8\">\n            <Card className=\"pack-card\">\n              <CardContent className=\"p-6\">\n                <div className=\"flex items-center justify-between\">\n                  <div>\n                    <p className=\"text-sm text-muted\">Pack Members</p>\n                    {statsLoading ? (\n                      <Skeleton className=\"h-8 w-16\" />\n                    ) : (\n                      <p className=\"text-2xl font-bold text-secondary\" data-testid=\"text-subscribers\">\n                        {stats?.subscribers || 0}\n                      </p>\n                    )}\n                  </div>\n                  <div className=\"w-12 h-12 bg-secondary/20 rounded-lg flex items-center justify-center\">\n                    <Users className=\"h-6 w-6 text-secondary\" />\n                  </div>\n                </div>\n              </CardContent>\n            </Card>\n\n            <Card className=\"pack-card\">\n              <CardContent className=\"p-6\">\n                <div className=\"flex items-center justify-between\">\n                  <div>\n                    <p className=\"text-sm text-muted\">Content Posts</p>\n                    {statsLoading ? (\n                      <Skeleton className=\"h-8 w-16\" />\n                    ) : (\n                      <p className=\"text-2xl font-bold text-accent\" data-testid=\"text-content-count\">\n                        {stats?.contentCount || 0}\n                      </p>\n                    )}\n                  </div>\n                  <div className=\"w-12 h-12 bg-accent/20 rounded-lg flex items-center justify-center\">\n                    <Upload className=\"h-6 w-6 text-accent\" />\n                  </div>\n                </div>\n              </CardContent>\n            </Card>\n\n            <Card className=\"pack-card\">\n              <CardContent className=\"p-6\">\n                <div className=\"flex items-center justify-between\">\n                  <div>\n                    <p className=\"text-sm text-muted\">Total Views</p>\n                    {statsLoading ? (\n                      <Skeleton className=\"h-8 w-16\" />\n                    ) : (\n                      <p className=\"text-2xl font-bold text-primary\" data-testid=\"text-total-views\">\n                        {stats?.totalViews || 0}\n                      </p>\n                    )}\n                  </div>\n                  <div className=\"w-12 h-12 bg-primary/20 rounded-lg flex items-center justify-center\">\n                    <Eye className=\"h-6 w-6 text-primary\" />\n                  </div>\n                </div>\n              </CardContent>\n            </Card>\n\n            <Card className=\"pack-card\">\n              <CardContent className=\"p-6\">\n                <div className=\"flex items-center justify-between\">\n                  <div>\n                    <p className=\"text-sm text-muted\">This Month</p>\n                    {earningsLoading ? (\n                      <Skeleton className=\"h-8 w-20\" />\n                    ) : (\n                      <p className=\"text-2xl font-bold text-success\" data-testid=\"text-monthly-earnings\">\n                        ${earnings?.totalEarnings?.toFixed(2) || '0.00'}\n                      </p>\n                    )}\n                  </div>\n                  <div className=\"w-12 h-12 bg-success/20 rounded-lg flex items-center justify-center\">\n                    <TrendingUp className=\"h-6 w-6 text-success\" />\n                  </div>\n                </div>\n              </CardContent>\n            </Card>\n          </div>\n\n          <div className=\"grid lg:grid-cols-3 gap-8\">\n            {/* Main Content */}\n            <div className=\"lg:col-span-2 space-y-8\">\n              {/* Earnings Overview */}\n              <EarningsCard />\n\n              {/* Recent Content */}\n              <Card className=\"pack-card\">\n                <CardHeader>\n                  <CardTitle>Recent Content</CardTitle>\n                </CardHeader>\n                <CardContent>\n                  {contentLoading ? (\n                    <div className=\"space-y-4\">\n                      <Skeleton className=\"h-20\" />\n                      <Skeleton className=\"h-20\" />\n                      <Skeleton className=\"h-20\" />\n                    </div>\n                  ) : content?.length > 0 ? (\n                    <div className=\"space-y-4\">\n                      {content.slice(0, 5).map((item: any) => (\n                        <div key={item.id} className=\"flex items-center space-x-4 p-4 bg-background rounded-lg border border-border hover:border-primary/30 transition-colors\">\n                          <div className=\"w-16 h-16 bg-gradient-to-br from-primary/20 to-secondary/20 rounded-lg flex items-center justify-center\">\n                            {item.mimeType?.startsWith('image/') ? (\n                              <Eye className=\"h-6 w-6 text-primary\" />\n                            ) : (\n                              <Upload className=\"h-6 w-6 text-accent\" />\n                            )}\n                          </div>\n                          <div className=\"flex-1 min-w-0\">\n                            <h5 className=\"font-medium text-foreground truncate\" data-testid=\"text-content-title\">\n                              {item.title || 'Untitled'}\n                            </h5>\n                            <p className=\"text-sm text-muted\" data-testid=\"text-content-stats\">\n                              {item.viewCount || 0} views â€¢ {item.likeCount || 0} likes â€¢ \n                              {new Date(item.createdAt).toLocaleDateString()}\n                            </p>\n                          </div>\n                          <div className=\"flex items-center space-x-2\">\n                            <span className=\"text-sm font-medium text-primary\" data-testid=\"text-content-earnings\">\n                              ${item.price || '0.00'}\n                            </span>\n                            <Button variant=\"ghost\" size=\"sm\" data-testid=\"button-content-options\">\n                              <MoreHorizontal className=\"h-4 w-4\" />\n                            </Button>\n                          </div>\n                        </div>\n                      ))}\n                    </div>\n                  ) : (\n                    <div className=\"text-center py-8\">\n                      <Upload className=\"h-12 w-12 text-muted mx-auto mb-4\" />\n                      <p className=\"text-muted mb-4\">No content uploaded yet</p>\n                      <Button className=\"btn-primary\" data-testid=\"button-upload-first-content\">\n                        Upload Your First Content\n                      </Button>\n                    </div>\n                  )}\n                </CardContent>\n              </Card>\n            </div>\n\n            {/* Sidebar */}\n            <div className=\"space-y-6\">\n              {/* Pack Activity */}\n              <Card className=\"pack-card\">\n                <CardHeader>\n                  <CardTitle>Pack Activity</CardTitle>\n                </CardHeader>\n                <CardContent className=\"space-y-4\">\n                  <div className=\"p-4 bg-background rounded-lg border border-border\">\n                    <div className=\"flex items-center space-x-3 mb-2\">\n                      <div className=\"w-8 h-8 bg-primary/20 rounded-full flex items-center justify-center\">\n                        <Users className=\"text-primary text-xs\" />\n                      </div>\n                      <div>\n                        <p className=\"text-sm font-medium text-foreground\">New Pack Member</p>\n                        <p className=\"text-xs text-muted\">PupLover99 joined</p>\n                      </div>\n                    </div>\n                  </div>\n                  \n                  <div className=\"p-4 bg-background rounded-lg border border-border\">\n                    <div className=\"flex items-center space-x-3 mb-2\">\n                      <div className=\"w-8 h-8 bg-accent/20 rounded-full flex items-center justify-center\">\n                        <Heart className=\"text-accent text-xs\" />\n                      </div>\n                      <div>\n                        <p className=\"text-sm font-medium text-foreground\">Tip Received</p>\n                        <p className=\"text-xs text-muted\">$25 from GoodBoi47</p>\n                      </div>\n                    </div>\n                  </div>\n\n                  <div className=\"p-4 bg-background rounded-lg border border-border\">\n                    <div className=\"flex items-center space-x-3 mb-2\">\n                      <div className=\"w-8 h-8 bg-secondary/20 rounded-full flex items-center justify-center\">\n                        <MessageCircle className=\"text-secondary text-xs\" />\n                      </div>\n                      <div>\n                        <p className=\"text-sm font-medium text-foreground\">New Comment</p>\n                        <p className=\"text-xs text-muted\">Amazing content! ðŸ¾</p>\n                      </div>\n                    </div>\n                  </div>\n                </CardContent>\n              </Card>\n\n              {/* Content Upload Widget */}\n              <ContentUpload />\n            </div>\n          </div>\n        </div>\n      </main>\n\n      <Footer />\n    </div>\n  );\n}\n","size_bytes":14186},"client/src/pages/Safety.tsx":{"content":"import { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { \n  Shield, \n  Lock, \n  AlertTriangle,\n  Eye,\n  UserCheck,\n  FileText,\n  HelpCircle\n} from \"lucide-react\";\nimport { useLocation } from \"wouter\";\n\nconst safetyFeatures = [\n  {\n    icon: UserCheck,\n    title: \"Age Verification\",\n    description: \"All users must verify they are 18+ through our secure KYC process using government-issued ID\"\n  },\n  {\n    icon: Lock,\n    title: \"Content Protection\",\n    description: \"Advanced watermarking and DMCA takedown tools to protect your original content\"\n  },\n  {\n    icon: Eye,\n    title: \"AI Moderation\",\n    description: \"Automated content screening with human review to maintain community standards\"\n  },\n  {\n    icon: Shield,\n    title: \"Privacy Controls\",\n    description: \"Granular privacy settings and consent management for all content and interactions\"\n  }\n];\n\nconst safetyResources = [\n  {\n    title: \"Report Abuse\",\n    description: \"Report content or behavior that violates our guidelines\",\n    link: \"/report\",\n    icon: AlertTriangle\n  },\n  {\n    title: \"Community Guidelines\",\n    description: \"Review our community standards and policies\",\n    link: \"/guidelines\",\n    icon: FileText\n  },\n  {\n    title: \"Contact Support\",\n    description: \"Get help with safety or security concerns\",\n    link: \"/support\",\n    icon: HelpCircle\n  }\n];\n\nexport default function Safety() {\n  const [, setLocation] = useLocation();\n\n  return (\n    <div className=\"container mx-auto p-6 max-w-6xl\">\n      <div className=\"mb-12 text-center\">\n        <div className=\"flex items-center justify-center gap-2 mb-4\">\n          <Shield className=\"h-10 w-10 text-primary\" />\n          <h1 className=\"text-4xl font-bold\">Safety Center</h1>\n        </div>\n        <p className=\"text-muted-foreground text-xl max-w-3xl mx-auto\">\n          Your safety and security are our top priorities. Learn about our comprehensive safety features and resources.\n        </p>\n      </div>\n\n      <div className=\"grid gap-6 md:grid-cols-2 mb-12\">\n        {safetyFeatures.map((feature) => {\n          const IconComponent = feature.icon;\n          return (\n            <Card key={feature.title} data-testid={`feature-${feature.title.toLowerCase().replace(/\\s+/g, '-')}`}>\n              <CardHeader>\n                <IconComponent className=\"h-8 w-8 text-primary mb-2\" />\n                <CardTitle>{feature.title}</CardTitle>\n              </CardHeader>\n              <CardContent>\n                <p className=\"text-muted-foreground\">{feature.description}</p>\n              </CardContent>\n            </Card>\n          );\n        })}\n      </div>\n\n      <div className=\"mb-12\">\n        <h2 className=\"text-2xl font-bold mb-6\">Safety Resources</h2>\n        <div className=\"grid gap-4 md:grid-cols-3\">\n          {safetyResources.map((resource) => {\n            const IconComponent = resource.icon;\n            return (\n              <Card key={resource.title} className=\"hover:shadow-lg transition-shadow\" data-testid={`resource-${resource.title.toLowerCase().replace(/\\s+/g, '-')}`}>\n                <CardHeader>\n                  <IconComponent className=\"h-6 w-6 text-primary mb-2\" />\n                  <CardTitle className=\"text-lg\">{resource.title}</CardTitle>\n                  <CardDescription>{resource.description}</CardDescription>\n                </CardHeader>\n                <CardContent>\n                  <Button \n                    variant=\"outline\" \n                    className=\"w-full\"\n                    onClick={() => setLocation(resource.link)}\n                    data-testid={`button-${resource.title.toLowerCase().replace(/\\s+/g, '-')}`}\n                  >\n                    Learn More\n                  </Button>\n                </CardContent>\n              </Card>\n            );\n          })}\n        </div>\n      </div>\n\n      <Card>\n        <CardHeader>\n          <CardTitle>Our Commitment to Safety</CardTitle>\n        </CardHeader>\n        <CardContent className=\"space-y-4\">\n          <p className=\"text-muted-foreground\">\n            We are committed to providing a safe, secure, and respectful environment for all users. Our safety measures include:\n          </p>\n          <ul className=\"space-y-3\">\n            <li className=\"flex items-start gap-3\">\n              <Shield className=\"h-5 w-5 text-primary mt-0.5 flex-shrink-0\" />\n              <div>\n                <span className=\"font-medium\">Proactive Monitoring:</span> 24/7 AI-powered content moderation with human oversight\n              </div>\n            </li>\n            <li className=\"flex items-start gap-3\">\n              <Shield className=\"h-5 w-5 text-primary mt-0.5 flex-shrink-0\" />\n              <div>\n                <span className=\"font-medium\">Zero Tolerance:</span> Strict enforcement against illegal content, harassment, and violations\n              </div>\n            </li>\n            <li className=\"flex items-start gap-3\">\n              <Shield className=\"h-5 w-5 text-primary mt-0.5 flex-shrink-0\" />\n              <div>\n                <span className=\"font-medium\">User Empowerment:</span> Comprehensive tools for blocking, reporting, and privacy control\n              </div>\n            </li>\n            <li className=\"flex items-start gap-3\">\n              <Shield className=\"h-5 w-5 text-primary mt-0.5 flex-shrink-0\" />\n              <div>\n                <span className=\"font-medium\">Transparency:</span> Clear policies and regular updates about safety improvements\n              </div>\n            </li>\n          </ul>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","size_bytes":5671},"server/routes.ts":{"content":"import type { Express } from \"express\";\nimport { createServer, type Server } from \"http\";\nimport { WebSocketServer, WebSocket } from \"ws\";\nimport { z } from \"zod\";\nimport { storage } from \"./storage\";\nimport { db } from \"./db\";\nimport { users, coStarVerifications, kycVerifications, content } from \"@shared/schema\";\nimport { eq, and, or, desc } from \"drizzle-orm\";\nimport { setupAuth, isAuthenticated } from \"./replitAuth\";\nimport { ObjectStorageService, ObjectNotFoundError } from \"./objectStorage\";\nimport { ObjectPermission } from \"./objectAcl\";\nimport { recommendationEngine } from \"./recommendationEngine\";\nimport { creatorAnalytics } from \"./creatorAnalytics\";\nimport { gamificationService } from \"./gamificationService\";\nimport { notificationService, wsManager } from \"./notificationService\";\nimport { aiModerationService } from \"./aiModerationService\";\nimport { communityModerationService } from \"./communityModerationService\";\nimport { aiContentProcessingService } from \"./aiContentProcessingService\";\nimport { distributionService } from \"./distributionService\";\nimport { liveStreamService } from \"./liveStreamService\";\nimport { marketingAutomationService } from \"./marketingAutomationService\";\nimport { blockchainService } from \"./blockchainService\";\nimport { voiceCloningService } from \"./voiceCloningService\";\nimport { holographicStreamingService } from \"./holographicStreamingService\";\nimport { dynamicPricingService } from \"./dynamicPricingService\";\nimport { microlendingService } from \"./microlendingService\";\nimport { deepfakeDetectionService } from \"./deepfakeDetectionService\";\nimport { emotionalAIService } from \"./emotionalAIService\";\nimport { \n  insertUserSchema, \n  insertProfileSchema, \n  insertMediaAssetSchema, \n  insertTipSchema, \n  insertMessageSchema, \n  insertConsentRecordSchema, \n  insertSafetyReportSchema,\n  insertCommunityVoteSchema,\n  insertContentSchema,\n  insertContentTenantMapSchema,\n  insertSubscriptionPlanSchema,\n  insertSocialMediaAccountSchema,\n  insertDistributionJobSchema,\n  insertQrCodeSchema,\n  insertSmartLinkSchema,\n  insertNftCollectionSchema,\n  insertNftSchema,\n  insertPackSchema,\n  insertPackMemberSchema,\n} from \"@shared/schema\";\nimport bcrypt from \"bcrypt\";\nimport jwt from \"jsonwebtoken\";\n\nconst JWT_SECRET = process.env.JWT_SECRET || \"temp-dev-secret-key-64-chars-minimum-replace-in-production-env\";\n\nexport async function registerRoutes(app: Express): Promise<Server> {\n  // Auth middleware\n  await setupAuth(app);\n\n  // Auth routes\n  app.get('/api/auth/user', async (req: any, res) => {\n    try {\n      // Check if user is authenticated\n      if (!req.user || !req.user.claims || !req.user.claims.sub) {\n        return res.status(401).json({ message: \"Unauthorized\" });\n      }\n      \n      const userId = req.user.claims.sub;\n      const user = await storage.getUser(userId);\n      if (!user) {\n        return res.status(404).json({ message: \"User not found\" });\n      }\n      \n      const profile = await storage.getProfile(userId);\n      res.json({ ...user, profile });\n    } catch (error) {\n      console.error(\"Error fetching user:\", error);\n      res.status(500).json({ message: \"Failed to fetch user\" });\n    }\n  });\n\n  // Local authentication routes\n  app.post('/api/auth/register', async (req, res) => {\n    try {\n      const validatedData = insertUserSchema.parse(req.body);\n      \n      // Check if email already exists\n      const existingEmailUser = await storage.getUserByEmail(validatedData.email!);\n      if (existingEmailUser) {\n        return res.status(409).json({ \n          message: \"Email already registered\", \n          field: \"email\" \n        });\n      }\n\n      // Check if username already exists (if provided)\n      if (validatedData.username) {\n        const existingUsernameUser = await storage.getUserByUsername(validatedData.username);\n        if (existingUsernameUser) {\n          return res.status(409).json({ \n            message: \"Username already taken\", \n            field: \"username\" \n          });\n        }\n      }\n\n      // Hash password\n      const hashedPassword = await bcrypt.hash(validatedData.password!, 10);\n      \n      // Create user\n      const user = await storage.createUser({\n        ...validatedData,\n        password: hashedPassword,\n        authProvider: 'local',\n        status: 'pending', // Requires age verification\n      });\n\n      // Generate JWT\n      const token = jwt.sign({ userId: user.id }, JWT_SECRET, { expiresIn: '7d' });\n      \n      res.json({ user: { ...user, password: undefined }, token });\n    } catch (error) {\n      console.error(\"Registration error:\", error);\n      \n      // Handle database constraint errors specifically\n      if (error && typeof error === 'object' && 'code' in error) {\n        const dbError = error as any; // PostgreSQL error object\n        if (dbError.code === '23505') { // Unique constraint violation\n          if (dbError.detail?.includes('username')) {\n            return res.status(409).json({ \n              message: \"Username already taken\", \n              field: \"username\" \n            });\n          }\n          if (dbError.detail?.includes('email')) {\n            return res.status(409).json({ \n              message: \"Email already registered\", \n              field: \"email\" \n            });\n          }\n        }\n      }\n      \n      // Handle Zod validation errors\n      if (error && typeof error === 'object' && 'issues' in error) {\n        return res.status(400).json({ \n          message: \"Invalid registration data\", \n          errors: error.issues \n        });\n      }\n      \n      res.status(500).json({ message: \"Registration failed\" });\n    }\n  });\n\n  app.post('/api/auth/login', async (req, res) => {\n    try {\n      const { email, password } = req.body;\n      \n      const user = await storage.getUserByEmail(email);\n      if (!user || !user.password) {\n        return res.status(401).json({ message: \"Invalid credentials\" });\n      }\n\n      const validPassword = await bcrypt.compare(password, user.password);\n      if (!validPassword) {\n        return res.status(401).json({ message: \"Invalid credentials\" });\n      }\n\n      const token = jwt.sign({ userId: user.id }, JWT_SECRET, { expiresIn: '7d' });\n      \n      res.json({ user: { ...user, password: undefined }, token });\n    } catch (error) {\n      console.error(\"Login error:\", error);\n      res.status(500).json({ message: \"Login failed\" });\n    }\n  });\n\n  // Profile routes\n  app.get('/api/profile/:userId', async (req, res) => {\n    try {\n      const { userId } = req.params;\n      const user = await storage.getUser(userId);\n      const profile = await storage.getProfile(userId);\n      \n      if (!user) {\n        return res.status(404).json({ message: \"User not found\" });\n      }\n\n      // Match the frontend expected structure\n      res.json({ \n        ...user, \n        password: undefined, \n        profile: profile || null \n      });\n    } catch (error) {\n      console.error(\"Error fetching profile:\", error);\n      res.status(500).json({ message: \"Failed to fetch profile\" });\n    }\n  });\n\n  app.put('/api/profile', isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const profileData = insertProfileSchema.parse({ ...req.body, userId });\n      \n      const existingProfile = await storage.getProfile(userId);\n      let profile;\n      \n      if (existingProfile) {\n        profile = await storage.updateProfile(userId, profileData);\n      } else {\n        profile = await storage.createProfile(profileData);\n      }\n      \n      // Return updated user with profile for frontend consistency\n      const user = await storage.getUser(userId);\n      res.json({ \n        ...user, \n        password: undefined, \n        profile \n      });\n    } catch (error) {\n      console.error(\"Error updating profile:\", error);\n      res.status(500).json({ message: \"Failed to update profile\" });\n    }\n  });\n\n  // PACK ROUTES\n  app.get('/api/packs', async (req, res) => {\n    try {\n      const packs = await storage.getAllPacks();\n      res.json(packs);\n    } catch (error) {\n      console.error(\"Error fetching packs:\", error);\n      res.status(500).json({ message: \"Failed to fetch packs\" });\n    }\n  });\n\n  app.get('/api/packs/:id', async (req, res) => {\n    try {\n      const { id } = req.params;\n      const pack = await storage.getPack(id);\n      if (!pack) {\n        return res.status(404).json({ message: \"Pack not found\" });\n      }\n      res.json(pack);\n    } catch (error) {\n      console.error(\"Error fetching pack:\", error);\n      res.status(500).json({ message: \"Failed to fetch pack\" });\n    }\n  });\n\n  app.post('/api/packs', isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const packData = insertPackSchema.parse({ ...req.body, creatorId: userId });\n      \n      const pack = await storage.createPack(packData);\n      res.json(pack);\n    } catch (error) {\n      console.error(\"Error creating pack:\", error);\n      res.status(500).json({ message: \"Failed to create pack\" });\n    }\n  });\n\n  app.post('/api/packs/:id/join', isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const { id: packId } = req.params;\n      \n      // Check if already a member\n      const isMember = await storage.isPackMember(packId, userId);\n      if (isMember) {\n        return res.status(400).json({ message: \"Already a member of this pack\" });\n      }\n      \n      const membership = await storage.joinPack(packId, userId);\n      res.json(membership);\n    } catch (error) {\n      console.error(\"Error joining pack:\", error);\n      res.status(500).json({ message: \"Failed to join pack\" });\n    }\n  });\n\n  app.post('/api/packs/:id/leave', isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const { id: packId } = req.params;\n      \n      await storage.leavePack(packId, userId);\n      res.json({ message: \"Successfully left pack\" });\n    } catch (error) {\n      console.error(\"Error leaving pack:\", error);\n      res.status(500).json({ message: \"Failed to leave pack\" });\n    }\n  });\n\n  app.get('/api/packs/:id/members', async (req, res) => {\n    try {\n      const { id: packId } = req.params;\n      const members = await storage.getPackMembers(packId);\n      res.json(members);\n    } catch (error) {\n      console.error(\"Error fetching pack members:\", error);\n      res.status(500).json({ message: \"Failed to fetch pack members\" });\n    }\n  });\n\n  app.get('/api/users/:userId/packs', async (req, res) => {\n    try {\n      const { userId } = req.params;\n      const packs = await storage.getUserPacks(userId);\n      res.json(packs);\n    } catch (error) {\n      console.error(\"Error fetching user packs:\", error);\n      res.status(500).json({ message: \"Failed to fetch user packs\" });\n    }\n  });\n\n  // ONBOARDING ROUTES\n  app.post('/api/onboarding/select-role', isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      \n      // Validate role selection\n      const roleSchema = z.object({\n        role: z.enum(['creator', 'fan']),\n      });\n      \n      const { role } = roleSchema.parse(req.body);\n\n      await db.update(users).set({ \n        role,\n        onboardingStep: 1\n        // Don't set status='active' yet - wait for verification\n      }).where(eq(users.id, userId));\n\n      res.json({ role, message: \"Role selected successfully\" });\n    } catch (error) {\n      if (error instanceof z.ZodError) {\n        return res.status(400).json({ \n          message: \"Invalid role. Must be 'creator' or 'fan'\",\n          errors: error.errors \n        });\n      }\n      console.error(\"Error selecting role:\", error);\n      res.status(500).json({ message: \"Failed to select role\" });\n    }\n  });\n\n  app.post('/api/onboarding/update', isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      \n      // Validate onboarding update payload\n      const onboardingUpdateSchema = z.object({\n        step: z.number().int().min(1).max(10),\n        data: z.object({\n          displayName: z.string().optional(),\n          stageName: z.string().optional(),\n          pronouns: z.string().optional(),\n          bio: z.string().optional(),\n          interests: z.array(z.string()).optional(),\n          niche: z.array(z.string()).optional(),\n          paymentMethod: z.string().optional(),\n        }),\n      });\n      \n      const { step, data } = onboardingUpdateSchema.parse(req.body);\n\n      const updateData: any = { \n        onboardingStep: step \n      };\n\n      // Save step-specific data\n      if (data.displayName || data.stageName || data.pronouns) {\n        if (data.displayName) updateData.firstName = data.displayName;\n        if (data.stageName) updateData.stageName = data.stageName;\n        if (data.pronouns) updateData.pronouns = data.pronouns;\n      }\n\n      if (data.interests) {\n        updateData.preferredInterests = data.interests; // Store as array directly (jsonb column)\n      }\n\n      await db.update(users).set(updateData).where(eq(users.id, userId));\n\n      // Also update profile if bio is provided\n      if (data.bio) {\n        const existingProfile = await storage.getProfile(userId);\n        if (existingProfile) {\n          await storage.updateProfile(userId, { bio: data.bio });\n        } else {\n          await storage.createProfile({ userId, bio: data.bio });\n        }\n      }\n\n      // Store niche/paymentMethod in profile (will add to schema next)\n      if (data.niche || data.paymentMethod) {\n        const existingProfile = await storage.getProfile(userId);\n        const profileUpdate: any = {};\n        \n        if (data.niche) profileUpdate.niche = data.niche;\n        if (data.paymentMethod) profileUpdate.paymentMethod = data.paymentMethod;\n        \n        if (existingProfile) {\n          await storage.updateProfile(userId, profileUpdate);\n        } else {\n          await storage.createProfile({ userId, ...profileUpdate });\n        }\n      }\n\n      res.json({ message: \"Onboarding progress saved\" });\n    } catch (error) {\n      if (error instanceof z.ZodError) {\n        return res.status(400).json({ \n          message: \"Invalid onboarding data\",\n          errors: error.errors \n        });\n      }\n      console.error(\"Error updating onboarding:\", error);\n      res.status(500).json({ message: \"Failed to update onboarding\" });\n    }\n  });\n\n  app.post('/api/onboarding/complete', isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n\n      await db.update(users).set({ \n        onboardingCompleted: true,\n        status: 'active'\n      }).where(eq(users.id, userId));\n\n      res.json({ message: \"Onboarding completed successfully\" });\n    } catch (error) {\n      console.error(\"Error completing onboarding:\", error);\n      res.status(500).json({ message: \"Failed to complete onboarding\" });\n    }\n  });\n\n  // Discovery routes\n  app.get('/api/discover/creators', async (req, res) => {\n    try {\n      const { q = '', packType, aftercareFriendly } = req.query;\n      \n      let creators;\n      if (q) {\n        creators = await storage.searchCreators(q as string);\n      } else {\n        creators = await storage.getFeaturedCreators();\n      }\n\n      // Apply filters\n      if (packType && packType !== 'all') {\n        creators = creators.filter(c => c.profile?.packType === packType);\n      }\n      \n      if (aftercareFriendly === 'true') {\n        creators = creators.filter(c => c.profile?.isAftercareFriendly);\n      }\n\n      res.json(creators);\n    } catch (error) {\n      console.error(\"Error fetching creators:\", error);\n      res.status(500).json({ message: \"Failed to fetch creators\" });\n    }\n  });\n\n  // Media/Content routes\n  app.get('/api/content/:userId', async (req, res) => {\n    try {\n      const { userId } = req.params;\n      const content = await storage.getMediaAssetsByOwner(userId);\n      res.json(content);\n    } catch (error) {\n      console.error(\"Error fetching content:\", error);\n      res.status(500).json({ message: \"Failed to fetch content\" });\n    }\n  });\n\n  app.post('/api/content', isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const contentData = insertMediaAssetSchema.parse({ ...req.body, ownerId: userId });\n      \n      const content = await storage.createMediaAsset(contentData);\n      res.json(content);\n    } catch (error) {\n      console.error(\"Error creating content:\", error);\n      res.status(500).json({ message: \"Failed to create content\" });\n    }\n  });\n\n  // Object storage routes for media uploads\n  app.get(\"/objects/:objectPath(*)\", isAuthenticated, async (req: any, res) => {\n    const userId = req.user?.claims?.sub;\n    const objectStorageService = new ObjectStorageService();\n    try {\n      const objectFile = await objectStorageService.getObjectEntityFile(req.path);\n      const canAccess = await objectStorageService.canAccessObjectEntity({\n        objectFile,\n        userId: userId,\n        requestedPermission: ObjectPermission.READ,\n      });\n      if (!canAccess) {\n        return res.sendStatus(401);\n      }\n      objectStorageService.downloadObject(objectFile, res);\n    } catch (error) {\n      console.error(\"Error checking object access:\", error);\n      if (error instanceof ObjectNotFoundError) {\n        return res.sendStatus(404);\n      }\n      return res.sendStatus(500);\n    }\n  });\n\n  app.post(\"/api/objects/upload\", isAuthenticated, async (req, res) => {\n    const objectStorageService = new ObjectStorageService();\n    const uploadURL = await objectStorageService.getObjectEntityUploadURL();\n    res.json({ uploadURL });\n  });\n\n  app.put(\"/api/media-upload\", isAuthenticated, async (req: any, res) => {\n    if (!req.body.mediaUrl) {\n      return res.status(400).json({ error: \"mediaUrl is required\" });\n    }\n\n    const userId = req.user?.claims?.sub;\n    const fileInfo = req.body.fileInfo || {};\n\n    try {\n      const objectStorageService = new ObjectStorageService();\n      const objectPath = await objectStorageService.trySetObjectEntityAclPolicy(\n        req.body.mediaUrl,\n        {\n          owner: userId,\n          visibility: \"private\", // Content should be private by default\n        },\n      );\n\n      // Return enhanced file information for client use\n      res.status(200).json({ \n        objectPath,\n        fileInfo: {\n          name: fileInfo.name || 'uploaded-file',\n          size: fileInfo.size || 0,\n          type: fileInfo.type || 'application/octet-stream'\n        }\n      });\n    } catch (error) {\n      console.error(\"Error setting media ACL:\", error);\n      res.status(500).json({ error: \"Internal server error\" });\n    }\n  });\n\n  // Media management routes\n  app.get(\"/api/media\", isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user?.claims?.sub;\n      const mediaAssets = await storage.getUserMediaAssets(userId);\n      res.json(mediaAssets);\n    } catch (error) {\n      console.error(\"Error fetching media assets:\", error);\n      res.status(500).json({ error: \"Internal server error\" });\n    }\n  });\n\n  app.delete(\"/api/media/:mediaId\", isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user?.claims?.sub;\n      const { mediaId } = req.params;\n      \n      // Verify ownership before deletion\n      const media = await storage.getMediaAsset(mediaId);\n      if (!media || media.ownerId !== userId) {\n        return res.status(404).json({ error: \"Media not found or unauthorized\" });\n      }\n\n      // Delete from storage\n      const objectStorageService = new ObjectStorageService();\n      try {\n        await objectStorageService.deleteObject(media.objectPath);\n      } catch (error) {\n        console.warn(\"Failed to delete object from storage:\", error);\n        // Continue with database deletion even if storage deletion fails\n      }\n\n      // Delete from database\n      await storage.deleteMediaAsset(mediaId);\n      res.json({ success: true, message: \"Media deleted successfully\" });\n    } catch (error) {\n      console.error(\"Error deleting media:\", error);\n      res.status(500).json({ error: \"Internal server error\" });\n    }\n  });\n\n  app.get(\"/api/media/:mediaId\", isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user?.claims?.sub;\n      const { mediaId } = req.params;\n      \n      const media = await storage.getMediaAsset(mediaId);\n      if (!media) {\n        return res.status(404).json({ error: \"Media not found\" });\n      }\n\n      // Check if user has access to this media\n      if (media.ownerId !== userId && media.accessLevel !== 'pack') {\n        // Check if user has subscription or has paid for PPV content\n        const hasAccess = await storage.checkMediaAccess(userId, mediaId);\n        if (!hasAccess) {\n          return res.status(403).json({ error: \"Access denied\" });\n        }\n      }\n\n      res.json(media);\n    } catch (error) {\n      console.error(\"Error fetching media:\", error);\n      res.status(500).json({ error: \"Internal server error\" });\n    }\n  });\n\n  // Legacy subscription routes (keep for backward compatibility)\n  app.post('/api/subscriptions', isAuthenticated, async (req: any, res) => {\n    try {\n      const fanId = req.user.claims.sub;\n      const { creatorId, tier = 'basic', price } = req.body;\n      \n      const subscription = await storage.createSubscription({\n        fanId,\n        creatorId,\n        tier,\n        price,\n      });\n      \n      res.json(subscription);\n    } catch (error) {\n      console.error(\"Error creating subscription:\", error);\n      res.status(500).json({ message: \"Failed to create subscription\" });\n    }\n  });\n\n  app.get('/api/subscriptions/mine', isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const subscriptions = await storage.getSubscriptionsByFan(userId);\n      res.json(subscriptions);\n    } catch (error) {\n      console.error(\"Error fetching subscriptions:\", error);\n      res.status(500).json({ message: \"Failed to fetch subscriptions\" });\n    }\n  });\n\n  // Tips routes\n  app.post('/api/tips', isAuthenticated, async (req: any, res) => {\n    try {\n      const fromUserId = req.user.claims.sub;\n      const tipData = insertTipSchema.parse({ ...req.body, fromUserId });\n      \n      const tip = await storage.createTip(tipData);\n      res.json(tip);\n    } catch (error) {\n      console.error(\"Error creating tip:\", error);\n      res.status(500).json({ message: \"Failed to create tip\" });\n    }\n  });\n\n  // Analytics routes\n  app.get('/api/analytics/earnings/:period', isAuthenticated, async (req: any, res) => {\n    try {\n      const creatorId = req.user.claims.sub;\n      const { period } = req.params;\n      \n      const earnings = await storage.getCreatorEarnings(creatorId, period);\n      res.json(earnings);\n    } catch (error) {\n      console.error(\"Error fetching earnings:\", error);\n      res.status(500).json({ message: \"Failed to fetch earnings\" });\n    }\n  });\n\n  app.get('/api/analytics/stats', isAuthenticated, async (req: any, res) => {\n    try {\n      const creatorId = req.user.claims.sub;\n      const stats = await storage.getCreatorStats(creatorId);\n      res.json(stats);\n    } catch (error) {\n      console.error(\"Error fetching stats:\", error);\n      res.status(500).json({ message: \"Failed to fetch stats\" });\n    }\n  });\n\n  // Messaging routes\n  app.get('/api/messages/conversations', isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const conversations = await storage.getConversations(userId);\n      res.json(conversations);\n    } catch (error) {\n      console.error(\"Error fetching conversations:\", error);\n      res.status(500).json({ message: \"Failed to fetch conversations\" });\n    }\n  });\n\n  app.get('/api/messages/:otherUserId', isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const { otherUserId } = req.params;\n      \n      const messages = await storage.getMessagesBetweenUsers(userId, otherUserId);\n      res.json(messages);\n    } catch (error) {\n      console.error(\"Error fetching messages:\", error);\n      res.status(500).json({ message: \"Failed to fetch messages\" });\n    }\n  });\n\n  app.post('/api/messages', isAuthenticated, async (req: any, res) => {\n    try {\n      const fromUserId = req.user.claims.sub;\n      const messageData = insertMessageSchema.parse({ ...req.body, fromUserId });\n      \n      const message = await storage.createMessage(messageData);\n      \n      // Broadcast to WebSocket clients\n      wss.clients.forEach(client => {\n        if (client.readyState === WebSocket.OPEN) {\n          client.send(JSON.stringify({\n            type: 'new_message',\n            message\n          }));\n        }\n      });\n      \n      res.json(message);\n    } catch (error) {\n      console.error(\"Error sending message:\", error);\n      res.status(500).json({ message: \"Failed to send message\" });\n    }\n  });\n\n  // =============================================================================\n  // MULTI-TENANT ROUTES\n  // =============================================================================\n\n  // Tenant discovery and management\n  app.get('/api/tenants', async (req, res) => {\n    try {\n      const tenants = await storage.getTenants();\n      res.json(tenants);\n    } catch (error) {\n      console.error('Error fetching tenants:', error);\n      res.status(500).json({ message: 'Failed to fetch tenants' });\n    }\n  });\n\n  app.get('/api/tenants/:slug', async (req, res) => {\n    try {\n      const { slug } = req.params;\n      const tenant = await storage.getTenantBySlug(slug);\n      if (!tenant) {\n        return res.status(404).json({ message: 'Tenant not found' });\n      }\n      res.json(tenant);\n    } catch (error) {\n      console.error('Error fetching tenant:', error);\n      res.status(500).json({ message: 'Failed to fetch tenant' });\n    }\n  });\n\n  // Enhanced content routes with cross-posting\n  app.post('/api/content', isAuthenticated, async (req: any, res) => {\n    try {\n      const creatorUserId = req.user.claims.sub;\n      const contentData = insertContentSchema.parse({ ...req.body, creatorUserId });\n      \n      const contentItem = await storage.createContent(contentData);\n      \n      // Automatically publish to canonical tenant\n      await storage.publishContentToTenant(contentItem.id, contentData.canonicalTenant);\n      \n      res.json(contentItem);\n    } catch (error) {\n      console.error('Error creating content:', error);\n      res.status(500).json({ message: 'Failed to create content' });\n    }\n  });\n\n  app.get('/api/content/:contentId', async (req, res) => {\n    try {\n      const { contentId } = req.params;\n      const contentItem = await storage.getContent(contentId);\n      if (!contentItem) {\n        return res.status(404).json({ message: 'Content not found' });\n      }\n      res.json(contentItem);\n    } catch (error) {\n      console.error('Error fetching content:', error);\n      res.status(500).json({ message: 'Failed to fetch content' });\n    }\n  });\n\n  app.get('/api/content/creator/:creatorId', async (req, res) => {\n    try {\n      const { creatorId } = req.params;\n      const { tenantId } = req.query;\n      const content = await storage.getContentByCreator(creatorId, tenantId as string);\n      res.json(content);\n    } catch (error) {\n      console.error('Error fetching creator content:', error);\n      res.status(500).json({ message: 'Failed to fetch creator content' });\n    }\n  });\n\n  app.get('/api/content/tenant/:tenantId', async (req, res) => {\n    try {\n      const { tenantId } = req.params;\n      const content = await storage.getContentByTenant(tenantId);\n      res.json(content);\n    } catch (error) {\n      console.error('Error fetching tenant content:', error);\n      res.status(500).json({ message: 'Failed to fetch tenant content' });\n    }\n  });\n\n  app.put('/api/content/:contentId', isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const { contentId } = req.params;\n      \n      // Verify ownership\n      const existingContent = await storage.getContent(contentId);\n      if (!existingContent || existingContent.creatorUserId !== userId) {\n        return res.status(404).json({ message: 'Content not found or unauthorized' });\n      }\n      \n      const updates = insertContentSchema.partial().parse(req.body);\n      const contentItem = await storage.updateContent(contentId, updates);\n      \n      res.json(contentItem);\n    } catch (error) {\n      console.error('Error updating content:', error);\n      res.status(500).json({ message: 'Failed to update content' });\n    }\n  });\n\n  app.delete('/api/content/:contentId', isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const { contentId } = req.params;\n      \n      // Verify ownership\n      const existingContent = await storage.getContent(contentId);\n      if (!existingContent || existingContent.creatorUserId !== userId) {\n        return res.status(404).json({ message: 'Content not found or unauthorized' });\n      }\n      \n      await storage.deleteContent(contentId);\n      res.json({ success: true, message: 'Content deleted successfully' });\n    } catch (error) {\n      console.error('Error deleting content:', error);\n      res.status(500).json({ message: 'Failed to delete content' });\n    }\n  });\n\n  // Cross-posting management\n  app.post('/api/content/:contentId/publish/:tenantId', isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const { contentId, tenantId } = req.params;\n      \n      // Verify ownership\n      const existingContent = await storage.getContent(contentId);\n      if (!existingContent || existingContent.creatorUserId !== userId) {\n        return res.status(404).json({ message: 'Content not found or unauthorized' });\n      }\n      \n      const mapping = await storage.publishContentToTenant(contentId, tenantId);\n      res.json(mapping);\n    } catch (error) {\n      console.error('Error publishing content to tenant:', error);\n      res.status(500).json({ message: 'Failed to publish content to tenant' });\n    }\n  });\n\n  app.delete('/api/content/:contentId/publish/:tenantId', isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const { contentId, tenantId } = req.params;\n      \n      // Verify ownership\n      const existingContent = await storage.getContent(contentId);\n      if (!existingContent || existingContent.creatorUserId !== userId) {\n        return res.status(404).json({ message: 'Content not found or unauthorized' });\n      }\n      \n      await storage.unpublishContentFromTenant(contentId, tenantId);\n      res.json({ success: true, message: 'Content unpublished from tenant' });\n    } catch (error) {\n      console.error('Error unpublishing content from tenant:', error);\n      res.status(500).json({ message: 'Failed to unpublish content from tenant' });\n    }\n  });\n\n  app.get('/api/content/:contentId/tenants', async (req, res) => {\n    try {\n      const { contentId } = req.params;\n      const tenants = await storage.getContentTenants(contentId);\n      res.json(tenants);\n    } catch (error) {\n      console.error('Error fetching content tenants:', error);\n      res.status(500).json({ message: 'Failed to fetch content tenants' });\n    }\n  });\n\n  // Enhanced subscription plans with tenant support\n  app.post('/api/subscription-plans', isAuthenticated, async (req: any, res) => {\n    try {\n      const creatorUserId = req.user.claims.sub;\n      const planData = insertSubscriptionPlanSchema.parse({ ...req.body, creatorUserId });\n      \n      const plan = await storage.createSubscriptionPlan(planData);\n      res.json(plan);\n    } catch (error) {\n      console.error('Error creating subscription plan:', error);\n      res.status(500).json({ message: 'Failed to create subscription plan' });\n    }\n  });\n\n  app.get('/api/subscription-plans/creator/:creatorId', async (req, res) => {\n    try {\n      const { creatorId } = req.params;\n      const { tenantId } = req.query;\n      const plans = await storage.getSubscriptionPlans(creatorId, tenantId as string);\n      res.json(plans);\n    } catch (error) {\n      console.error('Error fetching subscription plans:', error);\n      res.status(500).json({ message: 'Failed to fetch subscription plans' });\n    }\n  });\n\n  app.get('/api/subscription-plans/:planId', async (req, res) => {\n    try {\n      const { planId } = req.params;\n      const plan = await storage.getSubscriptionPlan(planId);\n      if (!plan) {\n        return res.status(404).json({ message: 'Subscription plan not found' });\n      }\n      res.json(plan);\n    } catch (error) {\n      console.error('Error fetching subscription plan:', error);\n      res.status(500).json({ message: 'Failed to fetch subscription plan' });\n    }\n  });\n\n  app.put('/api/subscription-plans/:planId', isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const { planId } = req.params;\n      \n      // Verify ownership\n      const existingPlan = await storage.getSubscriptionPlan(planId);\n      if (!existingPlan || existingPlan.creatorUserId !== userId) {\n        return res.status(404).json({ message: 'Subscription plan not found or unauthorized' });\n      }\n      \n      const updates = insertSubscriptionPlanSchema.partial().parse(req.body);\n      const plan = await storage.updateSubscriptionPlan(planId, updates);\n      \n      res.json(plan);\n    } catch (error) {\n      console.error('Error updating subscription plan:', error);\n      res.status(500).json({ message: 'Failed to update subscription plan' });\n    }\n  });\n\n  app.delete('/api/subscription-plans/:planId', isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const { planId } = req.params;\n      \n      // Verify ownership\n      const existingPlan = await storage.getSubscriptionPlan(planId);\n      if (!existingPlan || existingPlan.creatorUserId !== userId) {\n        return res.status(404).json({ message: 'Subscription plan not found or unauthorized' });\n      }\n      \n      await storage.deleteSubscriptionPlan(planId);\n      res.json({ success: true, message: 'Subscription plan deleted successfully' });\n    } catch (error) {\n      console.error('Error deleting subscription plan:', error);\n      res.status(500).json({ message: 'Failed to delete subscription plan' });\n    }\n  });\n\n  // Discovery routes enhanced for multi-tenant\n  app.get('/api/discover/:tenantSlug/creators', async (req, res) => {\n    try {\n      const { tenantSlug } = req.params;\n      const { q = '', packType, aftercareFriendly } = req.query;\n      \n      // Verify tenant exists\n      const tenant = await storage.getTenantBySlug(tenantSlug);\n      if (!tenant) {\n        return res.status(404).json({ message: 'Tenant not found' });\n      }\n      \n      let creators;\n      if (q) {\n        creators = await storage.searchCreators(q as string);\n      } else {\n        creators = await storage.getFeaturedCreators();\n      }\n\n      // Apply filters\n      if (packType && packType !== 'all') {\n        creators = creators.filter(c => c.profile?.packType === packType);\n      }\n      \n      if (aftercareFriendly === 'true') {\n        creators = creators.filter(c => c.profile?.isAftercareFriendly);\n      }\n\n      res.json(creators);\n    } catch (error) {\n      console.error('Error fetching tenant creators:', error);\n      res.status(500).json({ message: 'Failed to fetch tenant creators' });\n    }\n  });\n\n  // =============================================================================\n  // EXISTING SAFETY ROUTES (ENHANCED)\n  // =============================================================================\n\n  // Safety routes\n  app.post('/api/consent', isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const consentData = insertConsentRecordSchema.parse({ \n        ...req.body, \n        userId,\n        ipAddress: req.ip \n      });\n      \n      const consent = await storage.createConsentRecord(consentData);\n      res.json(consent);\n    } catch (error) {\n      console.error(\"Error recording consent:\", error);\n      res.status(500).json({ message: \"Failed to record consent\" });\n    }\n  });\n\n  app.get('/api/consent', isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const consents = await storage.getConsentRecords(userId);\n      res.json(consents);\n    } catch (error) {\n      console.error(\"Error fetching consents:\", error);\n      res.status(500).json({ message: \"Failed to fetch consents\" });\n    }\n  });\n\n  app.post('/api/safety/report', isAuthenticated, async (req: any, res) => {\n    try {\n      const reporterId = req.user.claims.sub;\n      const reportData = insertSafetyReportSchema.parse({ ...req.body, reporterId });\n      \n      const report = await storage.createSafetyReport(reportData);\n      res.json(report);\n    } catch (error) {\n      console.error(\"Error creating safety report:\", error);\n      res.status(500).json({ message: \"Failed to create safety report\" });\n    }\n  });\n\n  // =============================================================================\n  // AI RECOMMENDATION ENGINE\n  // =============================================================================\n\n  // Track user interaction\n  app.post('/api/interactions', isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const { contentId, interactionType, durationSeconds, metadata } = req.body;\n\n      await recommendationEngine.trackInteraction({\n        userId,\n        contentId,\n        interactionType,\n        durationSeconds,\n        metadata,\n      });\n\n      res.json({ success: true });\n    } catch (error) {\n      console.error(\"Error tracking interaction:\", error);\n      res.status(500).json({ message: \"Failed to track interaction\" });\n    }\n  });\n\n  // Get personalized recommendations\n  app.get('/api/recommendations', isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const limit = parseInt(req.query.limit as string) || 20;\n      const excludeContentIds = req.query.exclude ? (req.query.exclude as string).split(',') : [];\n\n      const recommendations = await recommendationEngine.getRecommendations({\n        userId,\n        limit,\n        excludeContentIds,\n      });\n\n      res.json(recommendations);\n    } catch (error) {\n      console.error(\"Error getting recommendations:\", error);\n      res.status(500).json({ message: \"Failed to get recommendations\" });\n    }\n  });\n\n  // =============================================================================\n  // CREATOR ANALYTICS DASHBOARD\n  // =============================================================================\n\n  // Get analytics summary for creator\n  app.get('/api/analytics/summary', isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const summary = await creatorAnalytics.getAnalyticsSummary(userId);\n      res.json(summary);\n    } catch (error) {\n      console.error(\"Error getting analytics summary:\", error);\n      res.status(500).json({ message: \"Failed to get analytics summary\" });\n    }\n  });\n\n  // Get daily metrics for date range\n  app.get('/api/analytics/daily', isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const startDate = new Date(req.query.startDate as string);\n      const endDate = new Date(req.query.endDate as string);\n      \n      const metrics = await creatorAnalytics.getDailyMetrics(userId, startDate, endDate);\n      res.json(metrics);\n    } catch (error) {\n      console.error(\"Error getting daily metrics:\", error);\n      res.status(500).json({ message: \"Failed to get daily metrics\" });\n    }\n  });\n\n  // Get audience insights\n  app.get('/api/analytics/audience', isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const insights = await creatorAnalytics.getAudienceInsights(userId);\n      res.json(insights || {});\n    } catch (error) {\n      console.error(\"Error getting audience insights:\", error);\n      res.status(500).json({ message: \"Failed to get audience insights\" });\n    }\n  });\n\n  // Generate revenue forecast\n  app.post('/api/analytics/forecast', isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const monthsAhead = parseInt(req.body.monthsAhead) || 3;\n      \n      const forecast = await creatorAnalytics.generateRevenueForecast(userId, monthsAhead);\n      res.json(forecast);\n    } catch (error) {\n      console.error(\"Error generating forecast:\", error);\n      res.status(500).json({ message: \"Failed to generate forecast\" });\n    }\n  });\n\n  // Compute daily metrics manually (for testing/admin)\n  app.post('/api/analytics/compute-daily', isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const date = req.body.date ? new Date(req.body.date) : new Date();\n      \n      const metrics = await creatorAnalytics.computeDailyMetrics(userId, date);\n      res.json(metrics);\n    } catch (error) {\n      console.error(\"Error computing daily metrics:\", error);\n      res.status(500).json({ message: \"Failed to compute daily metrics\" });\n    }\n  });\n\n  // Compute audience insights manually\n  app.post('/api/analytics/compute-audience', isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const insights = await creatorAnalytics.computeAudienceInsights(userId);\n      res.json(insights);\n    } catch (error) {\n      console.error(\"Error computing audience insights:\", error);\n      res.status(500).json({ message: \"Failed to compute audience insights\" });\n    }\n  });\n\n  // Get content performance\n  app.get('/api/analytics/content', isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const performance = await creatorAnalytics.getContentPerformance(userId);\n      res.json(performance);\n    } catch (error) {\n      console.error(\"Error getting content performance:\", error);\n      res.status(500).json({ message: \"Failed to get content performance\" });\n    }\n  });\n\n  // =============================================================================\n  // INFINITY SCROLL FEED\n  // =============================================================================\n\n  app.get('/api/feed', async (req: any, res) => {\n    try {\n      const page = parseInt(req.query.page as string) || 1;\n      const limit = parseInt(req.query.limit as string) || 12;\n      const userId = req.user?.claims?.sub;\n\n      const feedPosts = await storage.getFeedPosts(userId, page, limit);\n      res.json(feedPosts);\n    } catch (error) {\n      console.error(\"Error fetching feed:\", error);\n      res.status(500).json({ message: \"Failed to fetch feed\" });\n    }\n  });\n\n  // =============================================================================\n  // NOTIFICATION SYSTEM\n  // =============================================================================\n\n  // Get user notifications\n  app.get('/api/notifications', isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const limit = parseInt(req.query.limit as string) || 50;\n      const offset = parseInt(req.query.offset as string) || 0;\n\n      const notifications = await notificationService.getUserNotifications(userId, limit, offset);\n      res.json(notifications);\n    } catch (error) {\n      console.error(\"Error fetching notifications:\", error);\n      res.status(500).json({ message: \"Failed to fetch notifications\" });\n    }\n  });\n\n  // Get unread notification count\n  app.get('/api/notifications/unread-count', isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const count = await notificationService.getUnreadCount(userId);\n      res.json({ count });\n    } catch (error) {\n      console.error(\"Error fetching unread count:\", error);\n      res.status(500).json({ message: \"Failed to fetch unread count\" });\n    }\n  });\n\n  // Mark notification as read\n  app.patch('/api/notifications/:id/read', isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const notificationId = req.params.id;\n      await notificationService.markAsRead(notificationId, userId);\n      res.json({ success: true });\n    } catch (error) {\n      console.error(\"Error marking notification as read:\", error);\n      res.status(500).json({ message: \"Failed to mark notification as read\" });\n    }\n  });\n\n  // Mark all notifications as read\n  app.post('/api/notifications/read-all', isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      await notificationService.markAllAsRead(userId);\n      res.json({ success: true });\n    } catch (error) {\n      console.error(\"Error marking all notifications as read:\", error);\n      res.status(500).json({ message: \"Failed to mark all notifications as read\" });\n    }\n  });\n\n  // Delete notification\n  app.delete('/api/notifications/:id', isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const notificationId = req.params.id;\n      await notificationService.deleteNotification(notificationId, userId);\n      res.json({ success: true });\n    } catch (error) {\n      console.error(\"Error deleting notification:\", error);\n      res.status(500).json({ message: \"Failed to delete notification\" });\n    }\n  });\n\n  // Get notification preferences\n  app.get('/api/notifications/preferences', isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      let prefs = await notificationService.getUserPreferences(userId);\n      if (!prefs) {\n        prefs = await notificationService.initializePreferences(userId);\n      }\n      res.json(prefs);\n    } catch (error) {\n      console.error(\"Error fetching notification preferences:\", error);\n      res.status(500).json({ message: \"Failed to fetch notification preferences\" });\n    }\n  });\n\n  // Update notification preferences\n  app.patch('/api/notifications/preferences', isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const prefs = await notificationService.updatePreferences(userId, req.body);\n      res.json(prefs);\n    } catch (error) {\n      console.error(\"Error updating notification preferences:\", error);\n      res.status(500).json({ message: \"Failed to update notification preferences\" });\n    }\n  });\n\n  // =============================================================================\n  // AI MODERATION SYSTEM\n  // =============================================================================\n\n  // Analyze content (trigger AI analysis)\n  app.post('/api/moderation/analyze/:contentId', isAuthenticated, async (req: any, res) => {\n    try {\n      const contentId = req.params.contentId;\n      await aiModerationService.analyzeContent(contentId);\n      const safetyScore = await aiModerationService.getSafetyScore(contentId);\n      res.json({ \n        success: true, \n        message: 'Content analyzed successfully',\n        safetyScore \n      });\n    } catch (error) {\n      console.error(\"Error analyzing content:\", error);\n      res.status(500).json({ message: \"Failed to analyze content\" });\n    }\n  });\n\n  // Batch analyze content\n  app.post('/api/moderation/batch-analyze', isAuthenticated, async (req: any, res) => {\n    try {\n      const { contentIds } = req.body;\n      if (!Array.isArray(contentIds)) {\n        return res.status(400).json({ message: \"contentIds must be an array\" });\n      }\n      \n      const results = await aiModerationService.batchAnalyze(contentIds);\n      res.json({ results });\n    } catch (error) {\n      console.error(\"Error batch analyzing content:\", error);\n      res.status(500).json({ message: \"Failed to batch analyze content\" });\n    }\n  });\n\n  // Get content AI flags\n  app.get('/api/moderation/flags/:contentId', isAuthenticated, async (req: any, res) => {\n    try {\n      const contentId = req.params.contentId;\n      const flags = await aiModerationService.getContentFlags(contentId);\n      res.json(flags);\n    } catch (error) {\n      console.error(\"Error fetching content flags:\", error);\n      res.status(500).json({ message: \"Failed to fetch content flags\" });\n    }\n  });\n\n  // Review a flag (moderator action)\n  app.patch('/api/moderation/flags/:flagId/review', isAuthenticated, async (req: any, res) => {\n    try {\n      const flagId = req.params.flagId;\n      const { override } = req.body;\n      await aiModerationService.reviewFlag(flagId, override === true);\n      res.json({ success: true });\n    } catch (error) {\n      console.error(\"Error reviewing flag:\", error);\n      res.status(500).json({ message: \"Failed to review flag\" });\n    }\n  });\n\n  // Get content safety score\n  app.get('/api/moderation/safety-score/:contentId', isAuthenticated, async (req: any, res) => {\n    try {\n      const contentId = req.params.contentId;\n      const score = await aiModerationService.getSafetyScore(contentId);\n      res.json(score || { message: \"No safety score found\" });\n    } catch (error) {\n      console.error(\"Error fetching safety score:\", error);\n      res.status(500).json({ message: \"Failed to fetch safety score\" });\n    }\n  });\n\n  // Get auto-action status for content\n  app.get('/api/moderation/auto-action-status/:contentId', isAuthenticated, async (req: any, res) => {\n    try {\n      const contentId = req.params.contentId;\n      const status = await aiModerationService.getAutoActionStatus(contentId);\n      res.json(status);\n    } catch (error) {\n      console.error(\"Error fetching auto-action status:\", error);\n      res.status(500).json({ message: \"Failed to fetch auto-action status\" });\n    }\n  });\n\n  // Resolve auto-action (approve or reject auto-hidden content)\n  app.post('/api/moderation/resolve-auto-action/:contentId', isAuthenticated, async (req: any, res) => {\n    try {\n      const contentId = req.params.contentId;\n      \n      // Validate action parameter\n      const actionSchema = z.object({\n        action: z.enum(['approve', 'reject']),\n      });\n      \n      const { action } = actionSchema.parse(req.body);\n      \n      const result = await aiModerationService.resolveAutoAction(contentId, action);\n      res.json(result);\n    } catch (error) {\n      if (error instanceof z.ZodError) {\n        return res.status(400).json({ \n          message: \"Invalid action. Must be 'approve' or 'reject'\",\n          errors: error.errors \n        });\n      }\n      console.error(\"Error resolving auto-action:\", error);\n      res.status(500).json({ message: \"Failed to resolve auto-action\" });\n    }\n  });\n\n  // Re-analyze all unreviewed flagged content (admin only)\n  app.post('/api/moderation/reanalyze-unreviewed', isAuthenticated, async (req: any, res) => {\n    try {\n      // In production: Add admin role check\n      const results = await aiModerationService.reanalyzeUnreviewed();\n      res.json({ \n        success: true,\n        analyzed: results.length,\n        results \n      });\n    } catch (error) {\n      console.error(\"Error reanalyzing content:\", error);\n      res.status(500).json({ message: \"Failed to reanalyze content\" });\n    }\n  });\n\n  // =============================================================================\n  // COMMUNITY MODERATION SYSTEM\n  // =============================================================================\n\n  // Create a safety report\n  app.post('/api/moderation/reports', isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const reportData = insertSafetyReportSchema.parse({\n        ...req.body,\n        reporterId: userId,\n      });\n      \n      const report = await communityModerationService.createSafetyReport(reportData);\n      res.status(201).json(report);\n    } catch (error) {\n      console.error(\"Error creating safety report:\", error);\n      res.status(500).json({ message: \"Failed to create safety report\" });\n    }\n  });\n\n  // Get pending reports for community review\n  app.get('/api/moderation/reports/pending', isAuthenticated, async (req: any, res) => {\n    try {\n      const limit = req.query.limit ? parseInt(req.query.limit as string) : 20;\n      const reports = await communityModerationService.getPendingReportsForReview(limit);\n      res.json(reports);\n    } catch (error) {\n      console.error(\"Error fetching pending reports:\", error);\n      res.status(500).json({ message: \"Failed to fetch pending reports\" });\n    }\n  });\n\n  // Get reports about a specific user\n  app.get('/api/moderation/reports/user/:userId', isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.params.userId;\n      const status = req.query.status as string | undefined;\n      const reports = await communityModerationService.getReportsByUser(userId, status);\n      res.json(reports);\n    } catch (error) {\n      console.error(\"Error fetching user reports:\", error);\n      res.status(500).json({ message: \"Failed to fetch user reports\" });\n    }\n  });\n\n  // Get reports submitted by current user\n  app.get('/api/moderation/reports/my-submissions', isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const limit = req.query.limit ? parseInt(req.query.limit as string) : 50;\n      const reports = await communityModerationService.getReportsSubmittedBy(userId, limit);\n      res.json(reports);\n    } catch (error) {\n      console.error(\"Error fetching submitted reports:\", error);\n      res.status(500).json({ message: \"Failed to fetch submitted reports\" });\n    }\n  });\n\n  // Submit a community vote on a report\n  app.post('/api/moderation/reports/:reportId/vote', isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const reportId = req.params.reportId;\n      const voteData = insertCommunityVoteSchema.parse({\n        ...req.body,\n        reportId,\n        voterId: userId,\n      });\n      \n      const vote = await communityModerationService.submitCommunityVote(voteData);\n      res.json(vote);\n    } catch (error) {\n      console.error(\"Error submitting vote:\", error);\n      res.status(500).json({ message: \"Failed to submit vote\" });\n    }\n  });\n\n  // Get voting stats for a report\n  app.get('/api/moderation/reports/:reportId/stats', isAuthenticated, async (req: any, res) => {\n    try {\n      const reportId = req.params.reportId;\n      const stats = await communityModerationService.getReportVotingStats(reportId);\n      res.json(stats);\n    } catch (error) {\n      console.error(\"Error fetching voting stats:\", error);\n      res.status(500).json({ message: \"Failed to fetch voting stats\" });\n    }\n  });\n\n  // Get user's voting history\n  app.get('/api/moderation/votes/my-history', isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const limit = req.query.limit ? parseInt(req.query.limit as string) : 50;\n      const votes = await communityModerationService.getUserVotingHistory(userId, limit);\n      res.json(votes);\n    } catch (error) {\n      console.error(\"Error fetching voting history:\", error);\n      res.status(500).json({ message: \"Failed to fetch voting history\" });\n    }\n  });\n\n  // Get user's reputation score\n  app.get('/api/moderation/reputation/:userId', isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.params.userId || req.user.claims.sub;\n      const reputation = await communityModerationService.getVoterReputation(userId);\n      res.json({ userId, reputation });\n    } catch (error) {\n      console.error(\"Error fetching reputation:\", error);\n      res.status(500).json({ message: \"Failed to fetch reputation\" });\n    }\n  });\n\n  // Moderator: Resolve a report\n  app.patch('/api/moderation/reports/:reportId/resolve', isAuthenticated, async (req: any, res) => {\n    try {\n      const moderatorId = req.user.claims.sub;\n      const reportId = req.params.reportId;\n      const { resolution, action } = req.body;\n      \n      if (!['resolved', 'dismissed', 'escalated'].includes(action)) {\n        return res.status(400).json({ message: \"Invalid action. Must be 'resolved', 'dismissed', or 'escalated'\" });\n      }\n      \n      const report = await communityModerationService.resolveReport(\n        reportId,\n        moderatorId,\n        resolution,\n        action\n      );\n      res.json(report);\n    } catch (error) {\n      console.error(\"Error resolving report:\", error);\n      res.status(500).json({ message: \"Failed to resolve report\" });\n    }\n  });\n\n  // Get moderator leaderboard\n  app.get('/api/moderation/moderators/leaderboard', isAuthenticated, async (req: any, res) => {\n    try {\n      const limit = req.query.limit ? parseInt(req.query.limit as string) : 10;\n      const leaderboard = await communityModerationService.getModeratorLeaderboard(limit);\n      res.json(leaderboard);\n    } catch (error) {\n      console.error(\"Error fetching moderator leaderboard:\", error);\n      res.status(500).json({ message: \"Failed to fetch moderator leaderboard\" });\n    }\n  });\n\n  // =============================================================================\n  // GAMIFICATION SYSTEM\n  // =============================================================================\n\n  // Get user achievements\n  app.get('/api/gamification/achievements', isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const achievements = await gamificationService.getUserAchievements(userId);\n      res.json(achievements);\n    } catch (error) {\n      console.error(\"Error fetching achievements:\", error);\n      res.status(500).json({ message: \"Failed to fetch achievements\" });\n    }\n  });\n\n  // Check and unlock achievements\n  app.post('/api/gamification/achievements/check', isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const newAchievements = await gamificationService.checkAndUnlockAchievements(userId);\n      res.json({ newAchievements });\n    } catch (error) {\n      console.error(\"Error checking achievements:\", error);\n      res.status(500).json({ message: \"Failed to check achievements\" });\n    }\n  });\n\n  // Get creator tier info\n  app.get('/api/gamification/creator-tier', isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const tierInfo = await gamificationService.initializeCreatorTier(userId);\n      res.json(tierInfo);\n    } catch (error) {\n      console.error(\"Error fetching creator tier:\", error);\n      res.status(500).json({ message: \"Failed to fetch creator tier\" });\n    }\n  });\n\n  // Get fan engagement rewards\n  app.get('/api/gamification/fan-rewards', isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const rewards = await gamificationService.initializeFanRewards(userId);\n      res.json(rewards);\n    } catch (error) {\n      console.error(\"Error fetching fan rewards:\", error);\n      res.status(500).json({ message: \"Failed to fetch fan rewards\" });\n    }\n  });\n\n  // Daily check-in\n  app.post('/api/gamification/checkin', isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const result = await gamificationService.updateDailyCheckIn(userId);\n      res.json(result);\n    } catch (error) {\n      console.error(\"Error updating daily check-in:\", error);\n      res.status(500).json({ message: \"Failed to update daily check-in\" });\n    }\n  });\n\n  // Get leaderboard\n  app.get('/api/gamification/leaderboard', async (req: any, res) => {\n    try {\n      const category = req.query.category as string || 'top_creators';\n      const period = req.query.period as string || 'monthly';\n      const limit = parseInt(req.query.limit as string) || 100;\n\n      const leaderboard = await gamificationService.getLeaderboard(category, period, limit);\n      res.json(leaderboard);\n    } catch (error) {\n      console.error(\"Error fetching leaderboard:\", error);\n      res.status(500).json({ message: \"Failed to fetch leaderboard\" });\n    }\n  });\n\n  // Get user rank in leaderboard\n  app.get('/api/gamification/my-rank', isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const category = req.query.category as string || 'top_creators';\n      const period = req.query.period as string || 'monthly';\n\n      const rank = await gamificationService.getUserRank(userId, category, period);\n      res.json(rank || { rank: null, message: \"Not ranked yet\" });\n    } catch (error) {\n      console.error(\"Error fetching user rank:\", error);\n      res.status(500).json({ message: \"Failed to fetch user rank\" });\n    }\n  });\n\n  const httpServer = createServer(app);\n\n  // WebSocket server for real-time notifications and messaging\n  const wss = new WebSocketServer({ server: httpServer, path: '/ws' });\n\n  wss.on('connection', (ws: any) => {\n    console.log('WebSocket client connected');\n    let userId: string | null = null;\n\n    ws.on('message', (data: any) => {\n      try {\n        const message = JSON.parse(data.toString());\n        \n        // Handle authentication\n        if (message.type === 'auth' && message.userId) {\n          userId = message.userId as string;\n          wsManager.addConnection(userId, ws);\n          console.log(`WebSocket authenticated for user: ${userId}`);\n          \n          // Send confirmation\n          ws.send(JSON.stringify({ \n            type: 'auth_success',\n            message: 'Connected to notification system' \n          }));\n          return;\n        }\n\n        // Handle different message types\n        switch (message.type) {\n          case 'message':\n            // Broadcast to specific user or all\n            if (message.to) {\n              wsManager.sendToUser(message.to, message);\n            } else {\n              wsManager.broadcast(message);\n            }\n            break;\n\n          case 'ping':\n            ws.send(JSON.stringify({ type: 'pong' }));\n            break;\n\n          default:\n            console.log('Unknown message type:', message.type);\n        }\n      } catch (error) {\n        console.error('WebSocket message error:', error);\n      }\n    });\n\n    ws.on('close', () => {\n      if (userId) {\n        wsManager.removeConnection(userId, ws);\n        console.log(`WebSocket disconnected for user: ${userId}`);\n      } else {\n        console.log('WebSocket client disconnected');\n      }\n    });\n\n    ws.on('error', (error: any) => {\n      console.error('WebSocket error:', error);\n    });\n  });\n\n  // =============================================================================\n  // CO-STAR VERIFICATION SYSTEM\n  // =============================================================================\n\n  // Invite a co-star/collaborator\n  app.post('/api/costar/invite', isAuthenticated, async (req: any, res) => {\n    try {\n      const creatorId = req.user.claims.sub;\n      \n      const inviteSchema = z.object({\n        coStarEmail: z.string().email(),\n        verificationType: z.enum(['live_stream', 'video_collab', 'photo_shoot', 'general']),\n        contentId: z.string().optional(),\n        notes: z.string().optional(),\n        metadata: z.record(z.any()).optional(),\n      });\n\n      const inviteData = inviteSchema.parse(req.body);\n      \n      // Generate invitation token\n      const { nanoid } = await import('nanoid');\n      const invitationToken = nanoid(32);\n      \n      // Set expiration to 7 days from now\n      const expiresAt = new Date();\n      expiresAt.setDate(expiresAt.getDate() + 7);\n\n      // Check if co-star is already a user\n      const [existingUser] = await db.select().from(users).where(eq(users.email, inviteData.coStarEmail));\n\n      const [invitation] = await db.insert(coStarVerifications).values({\n        creatorId,\n        coStarUserId: existingUser?.id || null,\n        coStarEmail: inviteData.coStarEmail,\n        status: existingUser ? 'invited' : 'pending_invite',\n        verificationType: inviteData.verificationType,\n        contentId: inviteData.contentId || null,\n        invitationToken,\n        expiresAt,\n        invitedAt: new Date(),\n        notes: inviteData.notes || null,\n        metadata: inviteData.metadata || {},\n      }).returning();\n\n      res.json({ \n        invitation,\n        invitationUrl: `${process.env.REPL_SLUG ? 'https://' + process.env.REPL_SLUG + '.repl.co' : 'http://localhost:5000'}/costar-invite/${invitationToken}`\n      });\n    } catch (error) {\n      if (error instanceof z.ZodError) {\n        return res.status(400).json({ message: \"Invalid input\", errors: error.errors });\n      }\n      console.error(\"Error creating co-star invitation:\", error);\n      res.status(500).json({ message: \"Failed to create invitation\" });\n    }\n  });\n\n  // Get all co-star invitations (sent or received)\n  app.get('/api/costar/invitations', isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      \n      // Get user's email\n      const [user] = await db.select().from(users).where(eq(users.id, userId));\n      if (!user) {\n        return res.status(404).json({ message: \"User not found\" });\n      }\n\n      // Get invitations sent by user (as creator)\n      let sent = await db.select().from(coStarVerifications)\n        .where(eq(coStarVerifications.creatorId, userId))\n        .orderBy(desc(coStarVerifications.createdAt));\n\n      // Get invitations received by user (as co-star)\n      let received = await db.select().from(coStarVerifications)\n        .where(\n          or(\n            eq(coStarVerifications.coStarUserId, userId),\n            eq(coStarVerifications.coStarEmail, user.email || '')\n          )\n        )\n        .orderBy(desc(coStarVerifications.createdAt));\n\n      // Mark expired invitations\n      const now = new Date();\n      const toExpire = [...sent, ...received].filter(inv => \n        inv.expiresAt && \n        new Date(inv.expiresAt) < now && \n        inv.status !== 'expired' &&\n        inv.status !== 'verified' &&\n        inv.status !== 'rejected'\n      );\n\n      if (toExpire.length > 0) {\n        await Promise.all(\n          toExpire.map(inv =>\n            db.update(coStarVerifications)\n              .set({ status: 'expired', updatedAt: new Date() })\n              .where(eq(coStarVerifications.id, inv.id))\n          )\n        );\n        // Refetch to get updated status\n        sent = await db.select().from(coStarVerifications)\n          .where(eq(coStarVerifications.creatorId, userId))\n          .orderBy(desc(coStarVerifications.createdAt));\n        received = await db.select().from(coStarVerifications)\n          .where(\n            or(\n              eq(coStarVerifications.coStarUserId, userId),\n              eq(coStarVerifications.coStarEmail, user.email || '')\n            )\n          )\n          .orderBy(desc(coStarVerifications.createdAt));\n      }\n\n      res.json({ sent, received });\n    } catch (error) {\n      console.error(\"Error fetching co-star invitations:\", error);\n      res.status(500).json({ message: \"Failed to fetch invitations\" });\n    }\n  });\n\n  // Get specific invitation by token\n  app.get('/api/costar/invitation/:token', async (req, res) => {\n    try {\n      const { token } = req.params;\n      \n      const [invitation] = await db.select()\n        .from(coStarVerifications)\n        .where(eq(coStarVerifications.invitationToken, token));\n\n      if (!invitation) {\n        return res.status(404).json({ message: \"Invitation not found\" });\n      }\n\n      // Check if expired\n      if (invitation.expiresAt && new Date(invitation.expiresAt) < new Date()) {\n        await db.update(coStarVerifications)\n          .set({ status: 'expired' })\n          .where(eq(coStarVerifications.id, invitation.id));\n        return res.status(410).json({ message: \"Invitation expired\" });\n      }\n\n      // Get creator info\n      const [creator] = await db.select().from(users).where(eq(users.id, invitation.creatorId));\n\n      res.json({ \n        invitation,\n        creator: {\n          id: creator.id,\n          username: creator.username,\n          stageName: creator.stageName,\n          profileImageUrl: creator.profileImageUrl\n        }\n      });\n    } catch (error) {\n      console.error(\"Error fetching invitation:\", error);\n      res.status(500).json({ message: \"Failed to fetch invitation\" });\n    }\n  });\n\n  // Accept invitation (co-star accepts and starts KYC)\n  app.post('/api/costar/:invitationId/accept', isAuthenticated, async (req: any, res) => {\n    try {\n      const { invitationId } = req.params;\n      const userId = req.user.claims.sub;\n\n      const [invitation] = await db.select()\n        .from(coStarVerifications)\n        .where(eq(coStarVerifications.id, invitationId));\n\n      if (!invitation) {\n        return res.status(404).json({ message: \"Invitation not found\" });\n      }\n\n      // Check if token already consumed\n      if (invitation.tokenConsumed) {\n        return res.status(410).json({ message: \"Invitation already used\" });\n      }\n\n      // Check if expired\n      if (invitation.expiresAt && new Date(invitation.expiresAt) < new Date()) {\n        // Mark as expired\n        await db.update(coStarVerifications)\n          .set({ status: 'expired', updatedAt: new Date() })\n          .where(eq(coStarVerifications.id, invitationId));\n        return res.status(410).json({ message: \"Invitation expired\" });\n      }\n\n      // Get user's email to verify invitation\n      const [user] = await db.select().from(users).where(eq(users.id, userId));\n      if (!user) {\n        return res.status(404).json({ message: \"User not found\" });\n      }\n\n      // Verify this user is the invited co-star\n      if (invitation.coStarEmail !== user.email && invitation.coStarUserId !== userId) {\n        return res.status(403).json({ message: \"Not authorized for this invitation\" });\n      }\n\n      // Update invitation with user ID, status, and consume token\n      await db.update(coStarVerifications)\n        .set({ \n          coStarUserId: userId,\n          status: 'pending_kyc',\n          tokenConsumed: true,\n          updatedAt: new Date()\n        })\n        .where(eq(coStarVerifications.id, invitationId));\n\n      res.json({ \n        success: true,\n        message: \"Invitation accepted. Please complete KYC verification.\",\n        redirectTo: \"/verification\"\n      });\n    } catch (error) {\n      console.error(\"Error accepting invitation:\", error);\n      res.status(500).json({ message: \"Failed to accept invitation\" });\n    }\n  });\n\n  // Link KYC verification to co-star invitation\n  app.post('/api/costar/:invitationId/complete-kyc', isAuthenticated, async (req: any, res) => {\n    try {\n      const { invitationId } = req.params;\n      const userId = req.user.claims.sub;\n\n      const kycSchema = z.object({\n        kycVerificationId: z.string(),\n      });\n\n      const { kycVerificationId } = kycSchema.parse(req.body);\n\n      // Verify KYC belongs to user\n      const [kyc] = await db.select().from(kycVerifications)\n        .where(and(\n          eq(kycVerifications.id, kycVerificationId),\n          eq(kycVerifications.userId, userId),\n          eq(kycVerifications.status, 'verified')\n        ));\n\n      if (!kyc) {\n        return res.status(404).json({ message: \"Valid KYC verification not found\" });\n      }\n\n      // Update invitation\n      const [updated] = await db.update(coStarVerifications)\n        .set({ \n          kycVerificationId,\n          status: 'verified',\n          verifiedAt: new Date(),\n          updatedAt: new Date()\n        })\n        .where(and(\n          eq(coStarVerifications.id, invitationId),\n          eq(coStarVerifications.coStarUserId, userId)\n        ))\n        .returning();\n\n      if (!updated) {\n        return res.status(403).json({ message: \"Not authorized or invitation not found\" });\n      }\n\n      res.json({ success: true, invitation: updated });\n    } catch (error) {\n      if (error instanceof z.ZodError) {\n        return res.status(400).json({ message: \"Invalid input\", errors: error.errors });\n      }\n      console.error(\"Error completing KYC for co-star:\", error);\n      res.status(500).json({ message: \"Failed to complete KYC verification\" });\n    }\n  });\n\n  // Cancel/reject invitation\n  app.delete('/api/costar/:invitationId', isAuthenticated, async (req: any, res) => {\n    try {\n      const { invitationId } = req.params;\n      const userId = req.user.claims.sub;\n\n      const [invitation] = await db.select()\n        .from(coStarVerifications)\n        .where(eq(coStarVerifications.id, invitationId));\n\n      if (!invitation) {\n        return res.status(404).json({ message: \"Invitation not found\" });\n      }\n\n      // Only creator or co-star can cancel\n      if (invitation.creatorId !== userId && invitation.coStarUserId !== userId) {\n        return res.status(403).json({ message: \"Not authorized to cancel this invitation\" });\n      }\n\n      await db.update(coStarVerifications)\n        .set({ status: 'rejected', updatedAt: new Date() })\n        .where(eq(coStarVerifications.id, invitationId));\n\n      res.json({ success: true });\n    } catch (error) {\n      console.error(\"Error canceling invitation:\", error);\n      res.status(500).json({ message: \"Failed to cancel invitation\" });\n    }\n  });\n\n  // Check if co-star is verified for specific content/stream\n  app.get('/api/costar/verify/:contentId', isAuthenticated, async (req: any, res) => {\n    try {\n      const { contentId } = req.params;\n      const userId = req.user.claims.sub;\n\n      const verifications = await db.select()\n        .from(coStarVerifications)\n        .where(and(\n          eq(coStarVerifications.contentId, contentId),\n          or(\n            eq(coStarVerifications.creatorId, userId),\n            eq(coStarVerifications.coStarUserId, userId)\n          ),\n          eq(coStarVerifications.status, 'verified')\n        ));\n\n      res.json({ \n        isVerified: verifications.length > 0,\n        verifications \n      });\n    } catch (error) {\n      console.error(\"Error checking co-star verification:\", error);\n      res.status(500).json({ message: \"Failed to check verification\" });\n    }\n  });\n\n  // =============================================================================\n  // AI CONTENT PROCESSING SYSTEM\n  // =============================================================================\n\n  // Queue content processing job\n  app.post('/api/content/process', isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      \n      const processSchema = z.object({\n        contentId: z.string(),\n        sourceVideoPath: z.string(),\n        options: z.object({\n          autoEdit: z.boolean().optional(),\n          aspectRatios: z.array(z.enum(['9:16', '16:9', '1:1'])).optional(),\n          generateGif: z.boolean().optional(),\n          generateTrailer: z.boolean().optional(),\n          trailerDuration: z.number().min(10).max(60).optional(),\n          generateHighlights: z.boolean().optional(),\n          addBranding: z.boolean().optional(),\n          customBranding: z.object({\n            introPath: z.string().optional(),\n            outroPath: z.string().optional(),\n            logoPath: z.string().optional(),\n          }).optional(),\n        }),\n      });\n\n      const { contentId, sourceVideoPath, options } = processSchema.parse(req.body);\n      \n      // Verify user owns this content\n      const [contentItem] = await db.select().from(content)\n        .where(and(\n          eq(content.id, contentId),\n          eq(content.creatorUserId, userId)\n        ));\n\n      if (!contentItem) {\n        return res.status(403).json({ message: \"Content not found or access denied\" });\n      }\n\n      const job = await aiContentProcessingService.queueProcessing(\n        contentId,\n        sourceVideoPath,\n        options\n      );\n\n      res.json({ \n        success: true,\n        job\n      });\n    } catch (error) {\n      if (error instanceof z.ZodError) {\n        return res.status(400).json({ message: \"Invalid input\", errors: error.errors });\n      }\n      console.error(\"Error queuing content processing:\", error);\n      res.status(500).json({ message: \"Failed to queue processing job\" });\n    }\n  });\n\n  // Get processing job status\n  app.get('/api/content/process/:jobId', isAuthenticated, async (req: any, res) => {\n    try {\n      const { jobId } = req.params;\n      const userId = req.user.claims.sub;\n      \n      const job = await aiContentProcessingService.getJobStatus(jobId);\n      \n      if (!job) {\n        return res.status(404).json({ message: \"Job not found\" });\n      }\n\n      // Verify user owns the content associated with this job\n      const [contentItem] = await db.select().from(content)\n        .where(and(\n          eq(content.id, job.contentId),\n          eq(content.creatorUserId, userId)\n        ));\n\n      if (!contentItem) {\n        return res.status(403).json({ message: \"Access denied\" });\n      }\n\n      res.json(job);\n    } catch (error) {\n      console.error(\"Error fetching job status:\", error);\n      res.status(500).json({ message: \"Failed to fetch job status\" });\n    }\n  });\n\n  // Get all processing jobs for content\n  app.get('/api/content/:contentId/processing', isAuthenticated, async (req: any, res) => {\n    try {\n      const { contentId } = req.params;\n      const userId = req.user.claims.sub;\n\n      // Verify user owns this content\n      const [contentItem] = await db.select().from(content)\n        .where(and(\n          eq(content.id, contentId),\n          eq(content.creatorUserId, userId)\n        ));\n\n      if (!contentItem) {\n        return res.status(403).json({ message: \"Content not found or access denied\" });\n      }\n\n      const jobs = await aiContentProcessingService.getContentJobs(contentId);\n      res.json({ jobs });\n    } catch (error) {\n      console.error(\"Error fetching content jobs:\", error);\n      res.status(500).json({ message: \"Failed to fetch content jobs\" });\n    }\n  });\n\n  // Cancel processing job\n  app.delete('/api/content/process/:jobId', isAuthenticated, async (req: any, res) => {\n    try {\n      const { jobId } = req.params;\n      const userId = req.user.claims.sub;\n      \n      const job = await aiContentProcessingService.getJobStatus(jobId);\n      \n      if (!job) {\n        return res.status(404).json({ message: \"Job not found\" });\n      }\n\n      // Verify user owns the content associated with this job\n      const [contentItem] = await db.select().from(content)\n        .where(and(\n          eq(content.id, job.contentId),\n          eq(content.creatorUserId, userId)\n        ));\n\n      if (!contentItem) {\n        return res.status(403).json({ message: \"Access denied\" });\n      }\n\n      const cancelled = await aiContentProcessingService.cancelJob(jobId);\n      \n      if (!cancelled) {\n        return res.status(400).json({ message: \"Job cannot be cancelled\" });\n      }\n\n      res.json({ success: true });\n    } catch (error) {\n      console.error(\"Error cancelling job:\", error);\n      res.status(500).json({ message: \"Failed to cancel job\" });\n    }\n  });\n\n  // =============================================================================\n  // MULTI-PLATFORM DISTRIBUTION ROUTES\n  // =============================================================================\n\n  // Connect social media account\n  app.post('/api/distribution/accounts', isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      \n      // Validate platform and credentials\n      const connectSchema = z.object({\n        platform: z.enum(['twitter', 'instagram', 'tiktok', 'onlyfans', 'fansly', 'reddit', 'tumblr', 'manyvids']),\n        credentials: z.object({\n          platformUserId: z.string().optional(),\n          platformUsername: z.string().optional(),\n          accessToken: z.string(),\n          refreshToken: z.string().optional(),\n          tokenExpiresAt: z.string().optional(),\n        }),\n      });\n\n      const validatedData = connectSchema.parse(req.body);\n\n      const account = await distributionService.connectAccount(\n        userId,\n        validatedData.platform,\n        {\n          ...validatedData.credentials,\n          tokenExpiresAt: validatedData.credentials.tokenExpiresAt \n            ? new Date(validatedData.credentials.tokenExpiresAt)\n            : undefined,\n        }\n      );\n      res.json(account);\n    } catch (error) {\n      if (error instanceof z.ZodError) {\n        return res.status(400).json({ message: \"Invalid request data\", errors: error.errors });\n      }\n      console.error(\"Error connecting account:\", error);\n      res.status(500).json({ message: \"Failed to connect account\" });\n    }\n  });\n\n  // Get connected accounts\n  app.get('/api/distribution/accounts', isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const accounts = await distributionService.getConnectedAccounts(userId);\n      res.json(accounts);\n    } catch (error) {\n      console.error(\"Error fetching accounts:\", error);\n      res.status(500).json({ message: \"Failed to fetch accounts\" });\n    }\n  });\n\n  // Disconnect account\n  app.delete('/api/distribution/accounts/:accountId', isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const { accountId } = req.params;\n      \n      const success = await distributionService.disconnectAccount(accountId, userId);\n      if (!success) {\n        return res.status(404).json({ message: \"Account not found\" });\n      }\n      \n      res.json({ success: true });\n    } catch (error) {\n      console.error(\"Error disconnecting account:\", error);\n      res.status(500).json({ message: \"Failed to disconnect account\" });\n    }\n  });\n\n  // Distribute content to platforms\n  app.post('/api/distribution/content/:contentId/distribute', isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const { contentId } = req.params;\n      const { caption, scheduledFor, platforms, mediaUrls } = req.body;\n\n      const jobs = await distributionService.distributeContent(contentId, userId, {\n        caption,\n        scheduledFor: scheduledFor ? new Date(scheduledFor) : undefined,\n        platforms,\n        mediaUrls,\n      });\n\n      res.json(jobs);\n    } catch (error) {\n      console.error(\"Error distributing content:\", error);\n      res.status(500).json({ \n        message: error instanceof Error ? error.message : \"Failed to distribute content\" \n      });\n    }\n  });\n\n  // Get distribution jobs for content\n  app.get('/api/distribution/content/:contentId/jobs', isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const { contentId } = req.params;\n\n      const jobs = await distributionService.getContentDistributionJobs(contentId, userId);\n      res.json(jobs);\n    } catch (error) {\n      console.error(\"Error fetching distribution jobs:\", error);\n      res.status(500).json({ message: \"Failed to fetch distribution jobs\" });\n    }\n  });\n\n  // Cancel distribution job\n  app.delete('/api/distribution/jobs/:jobId', isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const { jobId } = req.params;\n\n      const success = await distributionService.cancelDistributionJob(jobId, userId);\n      if (!success) {\n        return res.status(404).json({ message: \"Job not found or cannot be cancelled\" });\n      }\n\n      res.json({ success: true });\n    } catch (error) {\n      console.error(\"Error cancelling job:\", error);\n      res.status(500).json({ message: \"Failed to cancel job\" });\n    }\n  });\n\n  // Generate QR code\n  app.post('/api/distribution/qr-codes', isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const { targetType, targetUrl, contentId, options } = req.body;\n\n      if (!targetType || !targetUrl) {\n        return res.status(400).json({ message: \"Target type and URL required\" });\n      }\n\n      const qrCode = await distributionService.generateQRCode(\n        userId,\n        targetType,\n        targetUrl,\n        contentId,\n        options\n      );\n\n      res.json(qrCode);\n    } catch (error) {\n      console.error(\"Error generating QR code:\", error);\n      res.status(500).json({ message: \"Failed to generate QR code\" });\n    }\n  });\n\n  // Get QR codes\n  app.get('/api/distribution/qr-codes', isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const qrCodes = await distributionService.getCreatorQRCodes(userId);\n      res.json(qrCodes);\n    } catch (error) {\n      console.error(\"Error fetching QR codes:\", error);\n      res.status(500).json({ message: \"Failed to fetch QR codes\" });\n    }\n  });\n\n  // Track QR code scan\n  app.post('/api/distribution/qr-codes/:qrCodeId/scan', async (req: any, res) => {\n    try {\n      const { qrCodeId } = req.params;\n      await distributionService.trackQRCodeScan(qrCodeId);\n      res.json({ success: true });\n    } catch (error) {\n      console.error(\"Error tracking QR scan:\", error);\n      res.status(500).json({ message: \"Failed to track scan\" });\n    }\n  });\n\n  // Create smart link\n  app.post('/api/distribution/smart-links', isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const { targetUrl, contentId, title, description, expiresAt, metadata } = req.body;\n\n      if (!targetUrl) {\n        return res.status(400).json({ message: \"Target URL required\" });\n      }\n\n      const link = await distributionService.createSmartLink(userId, targetUrl, contentId, {\n        title,\n        description,\n        expiresAt: expiresAt ? new Date(expiresAt) : undefined,\n        metadata,\n      });\n\n      res.json(link);\n    } catch (error) {\n      console.error(\"Error creating smart link:\", error);\n      res.status(500).json({ message: \"Failed to create smart link\" });\n    }\n  });\n\n  // Get smart links\n  app.get('/api/distribution/smart-links', isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const links = await distributionService.getCreatorSmartLinks(userId);\n      res.json(links);\n    } catch (error) {\n      console.error(\"Error fetching smart links:\", error);\n      res.status(500).json({ message: \"Failed to fetch smart links\" });\n    }\n  });\n\n  // Redirect smart link (public)\n  app.get('/l/:shortCode', async (req: any, res) => {\n    try {\n      const { shortCode } = req.params;\n      const link = await distributionService.trackLinkClick(shortCode, true);\n\n      if (!link || link.status !== 'active') {\n        return res.status(404).send('Link not found or expired');\n      }\n\n      res.redirect(link.targetUrl);\n    } catch (error) {\n      console.error(\"Error redirecting link:\", error);\n      res.status(500).send('Error redirecting');\n    }\n  });\n\n  // Get smart link analytics\n  app.get('/api/distribution/smart-links/:linkId/analytics', isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const { linkId } = req.params;\n\n      const analytics = await distributionService.getSmartLinkAnalytics(linkId, userId);\n      if (!analytics) {\n        return res.status(404).json({ message: \"Link not found\" });\n      }\n\n      res.json(analytics);\n    } catch (error) {\n      console.error(\"Error fetching analytics:\", error);\n      res.status(500).json({ message: \"Failed to fetch analytics\" });\n    }\n  });\n\n  // =============================================================================\n  // LIVE STREAM INFRASTRUCTURE ROUTES\n  // =============================================================================\n\n  // Create live stream\n  app.post('/api/streams', isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const { title, description, scheduledStartTime, requiresCoStarVerification, recordingEnabled, autoHighlightsEnabled, visibility } = req.body;\n\n      if (!title) {\n        return res.status(400).json({ message: \"Title is required\" });\n      }\n\n      const stream = await liveStreamService.createStream(userId, {\n        title,\n        description,\n        scheduledStartTime: scheduledStartTime ? new Date(scheduledStartTime) : undefined,\n        requiresCoStarVerification,\n        recordingEnabled,\n        autoHighlightsEnabled,\n        visibility,\n      });\n\n      res.json(stream);\n    } catch (error) {\n      console.error(\"Error creating stream:\", error);\n      res.status(500).json({ message: \"Failed to create stream\" });\n    }\n  });\n\n  // Start live stream\n  app.post('/api/streams/:streamId/start', isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const { streamId } = req.params;\n\n      const stream = await liveStreamService.startStream(streamId, userId);\n      res.json(stream);\n    } catch (error) {\n      console.error(\"Error starting stream:\", error);\n      res.status(500).json({ \n        message: error instanceof Error ? error.message : \"Failed to start stream\" \n      });\n    }\n  });\n\n  // End live stream\n  app.post('/api/streams/:streamId/end', isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const { streamId } = req.params;\n\n      const stream = await liveStreamService.endStream(streamId, userId);\n      res.json(stream);\n    } catch (error) {\n      console.error(\"Error ending stream:\", error);\n      res.status(500).json({ \n        message: error instanceof Error ? error.message : \"Failed to end stream\" \n      });\n    }\n  });\n\n  // Join stream\n  app.post('/api/streams/:streamId/join', isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const { streamId } = req.params;\n      const { role, coStarVerificationId } = req.body;\n\n      const participant = await liveStreamService.joinStream(streamId, userId, {\n        role: role || 'viewer',\n        coStarVerificationId,\n      });\n\n      res.json(participant);\n    } catch (error) {\n      console.error(\"Error joining stream:\", error);\n      res.status(500).json({ \n        message: error instanceof Error ? error.message : \"Failed to join stream\" \n      });\n    }\n  });\n\n  // Leave stream\n  app.post('/api/streams/:streamId/leave', isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const { streamId } = req.params;\n\n      await liveStreamService.leaveStream(streamId, userId);\n      res.json({ success: true });\n    } catch (error) {\n      console.error(\"Error leaving stream:\", error);\n      res.status(500).json({ message: \"Failed to leave stream\" });\n    }\n  });\n\n  // Send tip during stream\n  app.post('/api/streams/:streamId/tip', isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const { streamId } = req.params;\n      const { toUserId, amount, message } = req.body;\n\n      if (!toUserId || !amount) {\n        return res.status(400).json({ message: \"Recipient and amount required\" });\n      }\n\n      const tip = await liveStreamService.sendStreamTip(streamId, userId, toUserId, amount, message);\n      res.json(tip);\n    } catch (error) {\n      console.error(\"Error sending stream tip:\", error);\n      res.status(500).json({ \n        message: error instanceof Error ? error.message : \"Failed to send tip\" \n      });\n    }\n  });\n\n  // Get stream details\n  app.get('/api/streams/:streamId', async (req: any, res) => {\n    try {\n      const { streamId } = req.params;\n      const stream = await liveStreamService.getStream(streamId);\n\n      if (!stream) {\n        return res.status(404).json({ message: \"Stream not found\" });\n      }\n\n      res.json(stream);\n    } catch (error) {\n      console.error(\"Error fetching stream:\", error);\n      res.status(500).json({ message: \"Failed to fetch stream\" });\n    }\n  });\n\n  // Get creator streams\n  app.get('/api/streams/creator/:creatorId', async (req: any, res) => {\n    try {\n      const { creatorId } = req.params;\n      const streams = await liveStreamService.getCreatorStreams(creatorId);\n      res.json(streams);\n    } catch (error) {\n      console.error(\"Error fetching creator streams:\", error);\n      res.status(500).json({ message: \"Failed to fetch creator streams\" });\n    }\n  });\n\n  // Get live streams\n  app.get('/api/streams/live', async (req: any, res) => {\n    try {\n      const streams = await liveStreamService.getLiveStreams();\n      res.json(streams);\n    } catch (error) {\n      console.error(\"Error fetching live streams:\", error);\n      res.status(500).json({ message: \"Failed to fetch live streams\" });\n    }\n  });\n\n  // Get stream participants\n  app.get('/api/streams/:streamId/participants', async (req: any, res) => {\n    try {\n      const { streamId } = req.params;\n      const participants = await liveStreamService.getStreamParticipants(streamId);\n      res.json(participants);\n    } catch (error) {\n      console.error(\"Error fetching participants:\", error);\n      res.status(500).json({ message: \"Failed to fetch participants\" });\n    }\n  });\n\n  // Get stream recordings\n  app.get('/api/streams/:streamId/recordings', async (req: any, res) => {\n    try {\n      const { streamId } = req.params;\n      const recordings = await liveStreamService.getStreamRecordings(streamId);\n      res.json(recordings);\n    } catch (error) {\n      console.error(\"Error fetching recordings:\", error);\n      res.status(500).json({ message: \"Failed to fetch recordings\" });\n    }\n  });\n\n  // =============================================================================\n  // AI MARKETING AUTOMATION ROUTES\n  // =============================================================================\n\n  // Create marketing campaign\n  app.post('/api/campaigns', isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const { \n        name, type, trigger, triggerConditions, targetSegmentId, targetAllFans, \n        messageTemplate, subject, mediaPath, ctaText, ctaUrl, scheduledFor, \n        startDate, endDate, maxExecutions \n      } = req.body;\n\n      if (!name || !type || !trigger || !messageTemplate) {\n        return res.status(400).json({ message: \"Missing required fields\" });\n      }\n\n      const campaign = await marketingAutomationService.createCampaign(userId, {\n        name,\n        type,\n        trigger,\n        triggerConditions,\n        targetSegmentId,\n        targetAllFans,\n        messageTemplate,\n        subject,\n        mediaPath,\n        ctaText,\n        ctaUrl,\n        scheduledFor: scheduledFor ? new Date(scheduledFor) : undefined,\n        startDate: startDate ? new Date(startDate) : undefined,\n        endDate: endDate ? new Date(endDate) : undefined,\n        maxExecutions,\n      });\n\n      res.json(campaign);\n    } catch (error) {\n      console.error(\"Error creating campaign:\", error);\n      res.status(500).json({ message: \"Failed to create campaign\" });\n    }\n  });\n\n  // Activate campaign\n  app.post('/api/campaigns/:campaignId/activate', isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const { campaignId } = req.params;\n\n      const result = await marketingAutomationService.activateCampaign(campaignId, userId);\n      res.json(result);\n    } catch (error) {\n      console.error(\"Error activating campaign:\", error);\n      res.status(500).json({ \n        message: error instanceof Error ? error.message : \"Failed to activate campaign\" \n      });\n    }\n  });\n\n  // Pause campaign\n  app.post('/api/campaigns/:campaignId/pause', isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const { campaignId } = req.params;\n\n      const result = await marketingAutomationService.pauseCampaign(campaignId, userId);\n      res.json(result);\n    } catch (error) {\n      console.error(\"Error pausing campaign:\", error);\n      res.status(500).json({ \n        message: error instanceof Error ? error.message : \"Failed to pause campaign\" \n      });\n    }\n  });\n\n  // Get campaign analytics\n  app.get('/api/campaigns/:campaignId/analytics', isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const { campaignId } = req.params;\n\n      const analytics = await marketingAutomationService.getCampaignAnalytics(campaignId, userId);\n      res.json(analytics);\n    } catch (error) {\n      console.error(\"Error fetching campaign analytics:\", error);\n      res.status(500).json({ \n        message: error instanceof Error ? error.message : \"Failed to fetch analytics\" \n      });\n    }\n  });\n\n  // Create fan segment\n  app.post('/api/segments', isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const { name, description, segmentType, rules } = req.body;\n\n      if (!name || !segmentType) {\n        return res.status(400).json({ message: \"Name and segment type are required\" });\n      }\n\n      const segment = await marketingAutomationService.createSegment(userId, {\n        name,\n        description,\n        segmentType,\n        rules,\n      });\n\n      res.json(segment);\n    } catch (error) {\n      console.error(\"Error creating segment:\", error);\n      res.status(500).json({ message: \"Failed to create segment\" });\n    }\n  });\n\n  // Add fan to segment\n  app.post('/api/segments/:segmentId/fans/:fanId', isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const { segmentId, fanId } = req.params;\n\n      const result = await marketingAutomationService.addFanToSegment(segmentId, fanId, userId);\n      res.json(result);\n    } catch (error) {\n      console.error(\"Error adding fan to segment:\", error);\n      res.status(500).json({ \n        message: error instanceof Error ? error.message : \"Failed to add fan\" \n      });\n    }\n  });\n\n  // Remove fan from segment\n  app.delete('/api/segments/:segmentId/fans/:fanId', isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const { segmentId, fanId } = req.params;\n\n      const result = await marketingAutomationService.removeFanFromSegment(segmentId, fanId, userId);\n      res.json(result);\n    } catch (error) {\n      console.error(\"Error removing fan from segment:\", error);\n      res.status(500).json({ \n        message: error instanceof Error ? error.message : \"Failed to remove fan\" \n      });\n    }\n  });\n\n  // Recalculate segment\n  app.post('/api/segments/:segmentId/recalculate', isAuthenticated, async (req: any, res) => {\n    try {\n      const { segmentId } = req.params;\n\n      await marketingAutomationService.recalculateSegment(segmentId);\n      res.json({ success: true });\n    } catch (error) {\n      console.error(\"Error recalculating segment:\", error);\n      res.status(500).json({ message: \"Failed to recalculate segment\" });\n    }\n  });\n\n  // Get creator segments\n  app.get('/api/segments', isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const segments = await marketingAutomationService.getCreatorSegments(userId);\n      res.json(segments);\n    } catch (error) {\n      console.error(\"Error fetching segments:\", error);\n      res.status(500).json({ message: \"Failed to fetch segments\" });\n    }\n  });\n\n  // Get segment members\n  app.get('/api/segments/:segmentId/members', isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const { segmentId } = req.params;\n\n      const members = await marketingAutomationService.getSegmentMembers(segmentId, userId);\n      res.json(members);\n    } catch (error) {\n      console.error(\"Error fetching segment members:\", error);\n      res.status(500).json({ \n        message: error instanceof Error ? error.message : \"Failed to fetch members\" \n      });\n    }\n  });\n\n  // Schedule social post\n  app.post('/api/social-posts', isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const { platforms, postContent, mediaPath, scheduledFor, campaignId } = req.body;\n\n      if (!platforms || !postContent || !scheduledFor) {\n        return res.status(400).json({ message: \"Platforms, content, and schedule time are required\" });\n      }\n\n      const post = await marketingAutomationService.scheduleSocialPost(userId, {\n        platforms,\n        postContent,\n        mediaPath,\n        scheduledFor: new Date(scheduledFor),\n        campaignId,\n      });\n\n      res.json(post);\n    } catch (error) {\n      console.error(\"Error scheduling social post:\", error);\n      res.status(500).json({ message: \"Failed to schedule post\" });\n    }\n  });\n\n  // Cancel social post\n  app.post('/api/social-posts/:postId/cancel', isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const { postId } = req.params;\n\n      const result = await marketingAutomationService.cancelSocialPost(postId, userId);\n      res.json(result);\n    } catch (error) {\n      console.error(\"Error cancelling social post:\", error);\n      res.status(500).json({ \n        message: error instanceof Error ? error.message : \"Failed to cancel post\" \n      });\n    }\n  });\n\n  // Get scheduled posts\n  app.get('/api/social-posts', isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const posts = await marketingAutomationService.getScheduledPosts(userId);\n      res.json(posts);\n    } catch (error) {\n      console.error(\"Error fetching scheduled posts:\", error);\n      res.status(500).json({ message: \"Failed to fetch posts\" });\n    }\n  });\n\n  // =============================================================================\n  // CREATOR CONTROL DASHBOARD - QUICK PUBLISH\n  // =============================================================================\n\n  // =============================================================================\n  // BLOCKCHAIN & NFT ENDPOINTS - Content Ownership System\n  // =============================================================================\n\n  // Create NFT collection\n  app.post('/api/nft/collections', isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const validatedData = insertNftCollectionSchema.omit({ creatorId: true }).parse(req.body);\n      const collection = await blockchainService.createCollection(userId, validatedData);\n      res.json(collection);\n    } catch (error) {\n      console.error(\"Error creating NFT collection:\", error);\n      if (error instanceof z.ZodError) {\n        return res.status(400).json({ message: \"Invalid collection data\", errors: error.errors });\n      }\n      res.status(500).json({ message: \"Failed to create collection\" });\n    }\n  });\n\n  // Get creator's collections\n  app.get('/api/nft/collections', isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const collections = await blockchainService.getCreatorCollections(userId);\n      res.json(collections);\n    } catch (error) {\n      console.error(\"Error fetching collections:\", error);\n      res.status(500).json({ message: \"Failed to fetch collections\" });\n    }\n  });\n\n  // Get collection details\n  app.get('/api/nft/collections/:id', async (req: any, res) => {\n    try {\n      const collection = await blockchainService.getCollection(req.params.id);\n      if (!collection) {\n        return res.status(404).json({ message: \"Collection not found\" });\n      }\n      res.json(collection);\n    } catch (error) {\n      console.error(\"Error fetching collection:\", error);\n      res.status(500).json({ message: \"Failed to fetch collection\" });\n    }\n  });\n\n  // Mint NFT\n  app.post('/api/nft/mint', isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      \n      const validatedData = insertNftSchema\n        .omit({ tokenId: true, mintedBy: true, currentOwner: true })\n        .parse(req.body);\n\n      const collection = await blockchainService.getCollection(validatedData.collectionId);\n      if (!collection) {\n        return res.status(404).json({ message: \"Collection not found\" });\n      }\n\n      if (collection.creatorId !== userId) {\n        return res.status(403).json({ message: \"Unauthorized: Not the collection creator\" });\n      }\n\n      const nft = await blockchainService.mintNFT({\n        ...validatedData,\n        mintedBy: userId,\n        currentOwner: userId,\n      }, req.body.blockchain);\n      res.json(nft);\n    } catch (error) {\n      console.error(\"Error minting NFT:\", error);\n      if (error instanceof z.ZodError) {\n        return res.status(400).json({ message: \"Invalid NFT data\", errors: error.errors });\n      }\n      res.status(500).json({ message: \"Failed to mint NFT\" });\n    }\n  });\n\n  // Get NFT details\n  app.get('/api/nft/:id', async (req: any, res) => {\n    try {\n      const nft = await blockchainService.getNFT(req.params.id);\n      if (!nft) {\n        return res.status(404).json({ message: \"NFT not found\" });\n      }\n      res.json(nft);\n    } catch (error) {\n      console.error(\"Error fetching NFT:\", error);\n      res.status(500).json({ message: \"Failed to fetch NFT\" });\n    }\n  });\n\n  // Get user's NFTs\n  app.get('/api/nft/user/:userId', async (req: any, res) => {\n    try {\n      const nfts = await blockchainService.getUserNFTs(req.params.userId);\n      res.json(nfts);\n    } catch (error) {\n      console.error(\"Error fetching user NFTs:\", error);\n      res.status(500).json({ message: \"Failed to fetch NFTs\" });\n    }\n  });\n\n  // Get collection NFTs\n  app.get('/api/nft/collection/:collectionId/nfts', async (req: any, res) => {\n    try {\n      const nfts = await blockchainService.getCollectionNFTs(req.params.collectionId);\n      res.json(nfts);\n    } catch (error) {\n      console.error(\"Error fetching collection NFTs:\", error);\n      res.status(500).json({ message: \"Failed to fetch NFTs\" });\n    }\n  });\n\n  // Transfer/Sell NFT\n  app.post('/api/nft/:id/transfer', isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const { toUserId, transactionType, price, transactionHash, blockchain } = req.body;\n\n      await blockchainService.transferNFT(\n        req.params.id,\n        userId,\n        toUserId,\n        transactionType,\n        price,\n        transactionHash,\n        blockchain\n      );\n\n      res.json({ message: \"NFT transferred successfully\" });\n    } catch (error) {\n      console.error(\"Error transferring NFT:\", error);\n      res.status(500).json({ \n        message: error instanceof Error ? error.message : \"Failed to transfer NFT\" \n      });\n    }\n  });\n\n  // List NFT for sale\n  app.post('/api/nft/:id/list', isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const { listPrice } = req.body;\n\n      await blockchainService.listNFT(req.params.id, userId, listPrice);\n      res.json({ message: \"NFT listed successfully\" });\n    } catch (error) {\n      console.error(\"Error listing NFT:\", error);\n      res.status(500).json({ \n        message: error instanceof Error ? error.message : \"Failed to list NFT\" \n      });\n    }\n  });\n\n  // Delist NFT\n  app.post('/api/nft/:id/delist', isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      await blockchainService.delistNFT(req.params.id, userId);\n      res.json({ message: \"NFT delisted successfully\" });\n    } catch (error) {\n      console.error(\"Error delisting NFT:\", error);\n      res.status(500).json({ \n        message: error instanceof Error ? error.message : \"Failed to delist NFT\" \n      });\n    }\n  });\n\n  // Get marketplace listings\n  app.get('/api/nft/marketplace', async (req: any, res) => {\n    try {\n      const listings = await blockchainService.getMarketplaceListings();\n      res.json(listings);\n    } catch (error) {\n      console.error(\"Error fetching marketplace:\", error);\n      res.status(500).json({ message: \"Failed to fetch marketplace\" });\n    }\n  });\n\n  // Get creator royalties\n  app.get('/api/nft/royalties', isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const royalties = await blockchainService.getRoyaltiesForCreator(userId);\n      res.json(royalties);\n    } catch (error) {\n      console.error(\"Error fetching royalties:\", error);\n      res.status(500).json({ message: \"Failed to fetch royalties\" });\n    }\n  });\n\n  // Update royalty payment status\n  app.patch('/api/nft/royalties/:id', isAuthenticated, async (req: any, res) => {\n    try {\n      const { status, transactionHash } = req.body;\n      await blockchainService.updateRoyaltyStatus(req.params.id, status, transactionHash);\n      res.json({ message: \"Royalty status updated\" });\n    } catch (error) {\n      console.error(\"Error updating royalty:\", error);\n      res.status(500).json({ message: \"Failed to update royalty\" });\n    }\n  });\n\n  // Get NFT ownership history\n  app.get('/api/nft/:id/history', async (req: any, res) => {\n    try {\n      const history = await blockchainService.getOwnershipHistory(req.params.id);\n      res.json(history);\n    } catch (error) {\n      console.error(\"Error fetching ownership history:\", error);\n      res.status(500).json({ message: \"Failed to fetch history\" });\n    }\n  });\n\n  // Get NFT metadata (for blockchain integration)\n  app.get('/api/nft/:id/metadata', async (req: any, res) => {\n    try {\n      const nft = await blockchainService.getNFT(req.params.id);\n      if (!nft) {\n        return res.status(404).json({ message: \"NFT not found\" });\n      }\n      \n      const metadata = await blockchainService.generateMetadata(nft);\n      res.json(metadata);\n    } catch (error) {\n      console.error(\"Error generating metadata:\", error);\n      res.status(500).json({ message: \"Failed to generate metadata\" });\n    }\n  });\n\n  // =============================================================================\n  // AI VOICE CLONING ENDPOINTS - Personalized Voice Messages\n  // =============================================================================\n\n  // Create voice model\n  app.post('/api/voice/models', isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const model = await voiceCloningService.createVoiceModel(userId, req.body);\n      res.json(model);\n    } catch (error) {\n      console.error(\"Error creating voice model:\", error);\n      res.status(500).json({ message: \"Failed to create voice model\" });\n    }\n  });\n\n  // Get creator's voice models\n  app.get('/api/voice/models', isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const models = await voiceCloningService.getCreatorVoiceModels(userId);\n      res.json(models);\n    } catch (error) {\n      console.error(\"Error fetching voice models:\", error);\n      res.status(500).json({ message: \"Failed to fetch voice models\" });\n    }\n  });\n\n  // Get voice model details\n  app.get('/api/voice/models/:id', isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const model = await voiceCloningService.getVoiceModel(req.params.id);\n      if (!model) {\n        return res.status(404).json({ message: \"Voice model not found\" });\n      }\n      \n      if (model.creatorId !== userId) {\n        return res.status(403).json({ message: \"Unauthorized: Not the model owner\" });\n      }\n      \n      res.json(model);\n    } catch (error) {\n      console.error(\"Error fetching voice model:\", error);\n      res.status(500).json({ message: \"Failed to fetch voice model\" });\n    }\n  });\n\n  // Update voice model\n  app.patch('/api/voice/models/:id', isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const model = await voiceCloningService.getVoiceModel(req.params.id);\n      if (!model) {\n        return res.status(404).json({ message: \"Voice model not found\" });\n      }\n      \n      if (model.creatorId !== userId) {\n        return res.status(403).json({ message: \"Unauthorized: Not the model owner\" });\n      }\n\n      const allowedUpdates = {\n        name: req.body.name,\n        description: req.body.description,\n        modelSettings: req.body.modelSettings,\n        isActive: req.body.isActive,\n      };\n\n      await voiceCloningService.updateVoiceModel(req.params.id, allowedUpdates);\n      res.json({ message: \"Voice model updated successfully\" });\n    } catch (error) {\n      console.error(\"Error updating voice model:\", error);\n      res.status(500).json({ message: \"Failed to update voice model\" });\n    }\n  });\n\n  // Delete voice model\n  app.delete('/api/voice/models/:id', isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const model = await voiceCloningService.getVoiceModel(req.params.id);\n      if (!model) {\n        return res.status(404).json({ message: \"Voice model not found\" });\n      }\n      \n      if (model.creatorId !== userId) {\n        return res.status(403).json({ message: \"Unauthorized: Not the model owner\" });\n      }\n      \n      await voiceCloningService.deleteVoiceModel(req.params.id);\n      res.json({ message: \"Voice model deleted successfully\" });\n    } catch (error) {\n      console.error(\"Error deleting voice model:\", error);\n      res.status(500).json({ message: \"Failed to delete voice model\" });\n    }\n  });\n\n  // Create voice message\n  app.post('/api/voice/messages', isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      \n      const model = await voiceCloningService.getVoiceModel(req.body.voiceModelId);\n      if (!model) {\n        return res.status(404).json({ message: \"Voice model not found\" });\n      }\n      \n      if (model.creatorId !== userId) {\n        return res.status(403).json({ message: \"Unauthorized: Not the model owner\" });\n      }\n      \n      const message = await voiceCloningService.createVoiceMessage({\n        ...req.body,\n        creatorId: userId,\n      });\n      res.json(message);\n    } catch (error) {\n      console.error(\"Error creating voice message:\", error);\n      res.status(500).json({ message: \"Failed to create voice message\" });\n    }\n  });\n\n  // Get voice message\n  app.get('/api/voice/messages/:id', isAuthenticated, async (req: any, res) => {\n    try {\n      const message = await voiceCloningService.getVoiceMessage(req.params.id);\n      if (!message) {\n        return res.status(404).json({ message: \"Voice message not found\" });\n      }\n      res.json(message);\n    } catch (error) {\n      console.error(\"Error fetching voice message:\", error);\n      res.status(500).json({ message: \"Failed to fetch voice message\" });\n    }\n  });\n\n  // Get creator's voice messages\n  app.get('/api/voice/messages/creator/:creatorId', isAuthenticated, async (req: any, res) => {\n    try {\n      const messages = await voiceCloningService.getCreatorVoiceMessages(req.params.creatorId);\n      res.json(messages);\n    } catch (error) {\n      console.error(\"Error fetching creator messages:\", error);\n      res.status(500).json({ message: \"Failed to fetch messages\" });\n    }\n  });\n\n  // Get recipient's voice messages\n  app.get('/api/voice/messages/recipient/:recipientId', isAuthenticated, async (req: any, res) => {\n    try {\n      const messages = await voiceCloningService.getRecipientVoiceMessages(req.params.recipientId);\n      res.json(messages);\n    } catch (error) {\n      console.error(\"Error fetching recipient messages:\", error);\n      res.status(500).json({ message: \"Failed to fetch messages\" });\n    }\n  });\n\n  // Bulk create voice messages\n  app.post('/api/voice/messages/bulk', isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const { voiceModelId, recipients, scriptTemplate } = req.body;\n\n      if (!recipients || !Array.isArray(recipients)) {\n        return res.status(400).json({ message: \"Recipients array is required\" });\n      }\n\n      const model = await voiceCloningService.getVoiceModel(voiceModelId);\n      if (!model) {\n        return res.status(404).json({ message: \"Voice model not found\" });\n      }\n      \n      if (model.creatorId !== userId) {\n        return res.status(403).json({ message: \"Unauthorized: Not the model owner\" });\n      }\n\n      const messages = await voiceCloningService.bulkCreateMessages(\n        userId,\n        voiceModelId,\n        recipients,\n        scriptTemplate\n      );\n\n      res.json({ \n        message: `${messages.length} voice messages created successfully`,\n        messages \n      });\n    } catch (error) {\n      console.error(\"Error creating bulk messages:\", error);\n      res.status(500).json({ message: \"Failed to create bulk messages\" });\n    }\n  });\n\n  // Create automation\n  app.post('/api/voice/automation', isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const automation = await voiceCloningService.createAutomation({\n        ...req.body,\n        creatorId: userId,\n      });\n      res.json(automation);\n    } catch (error) {\n      console.error(\"Error creating automation:\", error);\n      res.status(500).json({ message: \"Failed to create automation\" });\n    }\n  });\n\n  // Get creator's automations\n  app.get('/api/voice/automation', isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const automations = await voiceCloningService.getCreatorAutomations(userId);\n      res.json(automations);\n    } catch (error) {\n      console.error(\"Error fetching automations:\", error);\n      res.status(500).json({ message: \"Failed to fetch automations\" });\n    }\n  });\n\n  // Toggle automation\n  app.patch('/api/voice/automation/:id/toggle', isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const { isActive } = req.body;\n      \n      const automation = await voiceCloningService.getAutomation(req.params.id);\n      if (!automation) {\n        return res.status(404).json({ message: \"Automation not found\" });\n      }\n      \n      if (automation.creatorId !== userId) {\n        return res.status(403).json({ message: \"Unauthorized: Not the automation owner\" });\n      }\n      \n      await voiceCloningService.toggleAutomation(req.params.id, isActive);\n      res.json({ message: \"Automation toggled successfully\" });\n    } catch (error) {\n      console.error(\"Error toggling automation:\", error);\n      res.status(500).json({ message: \"Failed to toggle automation\" });\n    }\n  });\n\n  // Get queue status\n  app.get('/api/voice/queue/status', isAuthenticated, async (req: any, res) => {\n    try {\n      const status = await voiceCloningService.getQueueStatus();\n      res.json(status);\n    } catch (error) {\n      console.error(\"Error fetching queue status:\", error);\n      res.status(500).json({ message: \"Failed to fetch queue status\" });\n    }\n  });\n\n  // ============================================================================\n  // HOLOGRAPHIC STREAMING ROUTES\n  // ============================================================================\n\n  // Create avatar model\n  app.post('/api/holographic/avatars', isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const avatar = await holographicStreamingService.createAvatarModel({\n        ...req.body,\n        creatorId: userId,\n      });\n      res.json(avatar);\n    } catch (error) {\n      console.error(\"Error creating avatar model:\", error);\n      res.status(500).json({ message: \"Failed to create avatar model\" });\n    }\n  });\n\n  // Get creator's avatars\n  app.get('/api/holographic/avatars', isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const avatars = await holographicStreamingService.getCreatorAvatars(userId);\n      res.json(avatars);\n    } catch (error) {\n      console.error(\"Error fetching avatars:\", error);\n      res.status(500).json({ message: \"Failed to fetch avatars\" });\n    }\n  });\n\n  // Get avatar details\n  app.get('/api/holographic/avatars/:id', isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const avatar = await holographicStreamingService.getAvatarModel(req.params.id);\n      if (!avatar) {\n        return res.status(404).json({ message: \"Avatar not found\" });\n      }\n      \n      if (avatar.creatorId !== userId) {\n        return res.status(403).json({ message: \"Unauthorized: Not the avatar owner\" });\n      }\n      \n      res.json(avatar);\n    } catch (error) {\n      console.error(\"Error fetching avatar:\", error);\n      res.status(500).json({ message: \"Failed to fetch avatar\" });\n    }\n  });\n\n  // Update avatar\n  app.patch('/api/holographic/avatars/:id', isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const avatar = await holographicStreamingService.getAvatarModel(req.params.id);\n      if (!avatar) {\n        return res.status(404).json({ message: \"Avatar not found\" });\n      }\n      \n      if (avatar.creatorId !== userId) {\n        return res.status(403).json({ message: \"Unauthorized: Not the avatar owner\" });\n      }\n\n      const allowedUpdates = {\n        name: req.body.name,\n        description: req.body.description,\n        textureUrls: req.body.textureUrls,\n        animationData: req.body.animationData,\n        isActive: req.body.isActive,\n      };\n\n      await holographicStreamingService.updateAvatarModel(req.params.id, allowedUpdates);\n      res.json({ message: \"Avatar updated successfully\" });\n    } catch (error) {\n      console.error(\"Error updating avatar:\", error);\n      res.status(500).json({ message: \"Failed to update avatar\" });\n    }\n  });\n\n  // Delete avatar\n  app.delete('/api/holographic/avatars/:id', isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const avatar = await holographicStreamingService.getAvatarModel(req.params.id);\n      if (!avatar) {\n        return res.status(404).json({ message: \"Avatar not found\" });\n      }\n      \n      if (avatar.creatorId !== userId) {\n        return res.status(403).json({ message: \"Unauthorized: Not the avatar owner\" });\n      }\n      \n      await holographicStreamingService.deleteAvatarModel(req.params.id);\n      res.json({ message: \"Avatar deleted successfully\" });\n    } catch (error) {\n      console.error(\"Error deleting avatar:\", error);\n      res.status(500).json({ message: \"Failed to delete avatar\" });\n    }\n  });\n\n  // Create holographic stream\n  app.post('/api/holographic/streams', isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      \n      if (req.body.avatarModelId) {\n        const avatar = await holographicStreamingService.getAvatarModel(req.body.avatarModelId);\n        if (!avatar) {\n          return res.status(404).json({ message: \"Avatar model not found\" });\n        }\n        \n        if (avatar.creatorId !== userId) {\n          return res.status(403).json({ message: \"Unauthorized: Not the avatar owner\" });\n        }\n      }\n      \n      const stream = await holographicStreamingService.createStream({\n        ...req.body,\n        creatorId: userId,\n      });\n      res.json(stream);\n    } catch (error) {\n      console.error(\"Error creating holographic stream:\", error);\n      res.status(500).json({ message: \"Failed to create holographic stream\" });\n    }\n  });\n\n  // Get live streams\n  app.get('/api/holographic/streams/live', async (req: any, res) => {\n    try {\n      const streams = await holographicStreamingService.getLiveStreams();\n      res.json(streams);\n    } catch (error) {\n      console.error(\"Error fetching live streams:\", error);\n      res.status(500).json({ message: \"Failed to fetch live streams\" });\n    }\n  });\n\n  // Get stream details\n  app.get('/api/holographic/streams/:id', async (req: any, res) => {\n    try {\n      const stream = await holographicStreamingService.getStream(req.params.id);\n      if (!stream) {\n        return res.status(404).json({ message: \"Stream not found\" });\n      }\n      res.json(stream);\n    } catch (error) {\n      console.error(\"Error fetching stream:\", error);\n      res.status(500).json({ message: \"Failed to fetch stream\" });\n    }\n  });\n\n  // Update stream\n  app.patch('/api/holographic/streams/:id', isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const stream = await holographicStreamingService.getStream(req.params.id);\n      if (!stream) {\n        return res.status(404).json({ message: \"Stream not found\" });\n      }\n      \n      if (stream.creatorId !== userId) {\n        return res.status(403).json({ message: \"Unauthorized: Not the stream owner\" });\n      }\n\n      const allowedUpdates = {\n        title: req.body.title,\n        description: req.body.description,\n        qualitySettings: req.body.qualitySettings,\n        environmentSettings: req.body.environmentSettings,\n        interactionSettings: req.body.interactionSettings,\n      };\n\n      await holographicStreamingService.updateStream(req.params.id, allowedUpdates);\n      res.json({ message: \"Stream updated successfully\" });\n    } catch (error) {\n      console.error(\"Error updating stream:\", error);\n      res.status(500).json({ message: \"Failed to update stream\" });\n    }\n  });\n\n  // Start stream\n  app.post('/api/holographic/streams/:id/start', isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const stream = await holographicStreamingService.getStream(req.params.id);\n      if (!stream) {\n        return res.status(404).json({ message: \"Stream not found\" });\n      }\n      \n      if (stream.creatorId !== userId) {\n        return res.status(403).json({ message: \"Unauthorized: Not the stream owner\" });\n      }\n\n      if (stream.avatarModelId) {\n        await holographicStreamingService.incrementAvatarUsage(stream.avatarModelId);\n      }\n      \n      await holographicStreamingService.startStream(req.params.id);\n      res.json({ message: \"Stream started successfully\" });\n    } catch (error) {\n      console.error(\"Error starting stream:\", error);\n      res.status(500).json({ message: \"Failed to start stream\" });\n    }\n  });\n\n  // End stream\n  app.post('/api/holographic/streams/:id/end', isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const stream = await holographicStreamingService.getStream(req.params.id);\n      if (!stream) {\n        return res.status(404).json({ message: \"Stream not found\" });\n      }\n      \n      if (stream.creatorId !== userId) {\n        return res.status(403).json({ message: \"Unauthorized: Not the stream owner\" });\n      }\n      \n      await holographicStreamingService.endStream(req.params.id);\n      \n      const highlightsUrl = await holographicStreamingService.generateHighlights(req.params.id);\n      \n      res.json({ \n        message: \"Stream ended successfully\",\n        highlightsUrl \n      });\n    } catch (error) {\n      console.error(\"Error ending stream:\", error);\n      res.status(500).json({ message: \"Failed to end stream\" });\n    }\n  });\n\n  // Join stream as viewer\n  app.post('/api/holographic/viewers/join', isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const viewer = await holographicStreamingService.viewerJoin({\n        ...req.body,\n        userId,\n      });\n      res.json(viewer);\n    } catch (error) {\n      console.error(\"Error joining stream:\", error);\n      res.status(500).json({ message: \"Failed to join stream\" });\n    }\n  });\n\n  // Leave stream\n  app.post('/api/holographic/viewers/:id/leave', isAuthenticated, async (req: any, res) => {\n    try {\n      await holographicStreamingService.viewerLeave(req.params.id);\n      res.json({ message: \"Left stream successfully\" });\n    } catch (error) {\n      console.error(\"Error leaving stream:\", error);\n      res.status(500).json({ message: \"Failed to leave stream\" });\n    }\n  });\n\n  // Update viewer position/orientation\n  app.patch('/api/holographic/viewers/:id/position', isAuthenticated, async (req: any, res) => {\n    try {\n      const { position, orientation } = req.body;\n      await holographicStreamingService.updateViewerPosition(req.params.id, position, orientation);\n      res.json({ message: \"Position updated successfully\" });\n    } catch (error) {\n      console.error(\"Error updating viewer position:\", error);\n      res.status(500).json({ message: \"Failed to update viewer position\" });\n    }\n  });\n\n  // Record viewer gesture\n  app.post('/api/holographic/viewers/:id/gesture', isAuthenticated, async (req: any, res) => {\n    try {\n      const { gesture } = req.body;\n      await holographicStreamingService.recordViewerGesture(req.params.id, gesture);\n      res.json({ message: \"Gesture recorded successfully\" });\n    } catch (error) {\n      console.error(\"Error recording gesture:\", error);\n      res.status(500).json({ message: \"Failed to record gesture\" });\n    }\n  });\n\n  // Record viewer tip\n  app.post('/api/holographic/viewers/:id/tip', isAuthenticated, async (req: any, res) => {\n    try {\n      const { amount } = req.body;\n      await holographicStreamingService.recordViewerTip(req.params.id, amount);\n      res.json({ message: \"Tip recorded successfully\" });\n    } catch (error) {\n      console.error(\"Error recording tip:\", error);\n      res.status(500).json({ message: \"Failed to record tip\" });\n    }\n  });\n\n  // Add spatial audio track\n  app.post('/api/holographic/audio', isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const stream = await holographicStreamingService.getStream(req.body.streamId);\n      if (!stream) {\n        return res.status(404).json({ message: \"Stream not found\" });\n      }\n      \n      if (stream.creatorId !== userId) {\n        return res.status(403).json({ message: \"Unauthorized: Not the stream owner\" });\n      }\n      \n      const track = await holographicStreamingService.addSpatialAudio(req.body);\n      res.json(track);\n    } catch (error) {\n      console.error(\"Error adding spatial audio:\", error);\n      res.status(500).json({ message: \"Failed to add spatial audio\" });\n    }\n  });\n\n  // Update spatial audio\n  app.patch('/api/holographic/audio/:id', isAuthenticated, async (req: any, res) => {\n    try {\n      const allowedUpdates = {\n        position: req.body.position,\n        volume: req.body.volume,\n        isActive: req.body.isActive,\n      };\n      \n      await holographicStreamingService.updateSpatialAudio(req.params.id, allowedUpdates);\n      res.json({ message: \"Spatial audio updated successfully\" });\n    } catch (error) {\n      console.error(\"Error updating spatial audio:\", error);\n      res.status(500).json({ message: \"Failed to update spatial audio\" });\n    }\n  });\n\n  // Remove spatial audio\n  app.delete('/api/holographic/audio/:id', isAuthenticated, async (req: any, res) => {\n    try {\n      await holographicStreamingService.removeSpatialAudio(req.params.id);\n      res.json({ message: \"Spatial audio removed successfully\" });\n    } catch (error) {\n      console.error(\"Error removing spatial audio:\", error);\n      res.status(500).json({ message: \"Failed to remove spatial audio\" });\n    }\n  });\n\n  // Get stream analytics\n  app.get('/api/holographic/streams/:id/analytics', isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const stream = await holographicStreamingService.getStream(req.params.id);\n      if (!stream) {\n        return res.status(404).json({ message: \"Stream not found\" });\n      }\n      \n      if (stream.creatorId !== userId) {\n        return res.status(403).json({ message: \"Unauthorized: Not the stream owner\" });\n      }\n      \n      const analytics = await holographicStreamingService.getStreamAnalytics(req.params.id);\n      res.json(analytics);\n    } catch (error) {\n      console.error(\"Error fetching stream analytics:\", error);\n      res.status(500).json({ message: \"Failed to fetch stream analytics\" });\n    }\n  });\n\n  // ============================================================================\n  // DYNAMIC PRICING AI ROUTES\n  // ============================================================================\n\n  // Create pricing strategy\n  app.post('/api/pricing/strategies', isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      \n      if (req.body.contentId) {\n        const content = await db.query.mediaAssets.findFirst({\n          where: eq(mediaAssets.id, req.body.contentId)\n        });\n        \n        if (!content) {\n          return res.status(404).json({ message: \"Content not found\" });\n        }\n        \n        if (content.ownerId !== userId) {\n          return res.status(403).json({ message: \"Unauthorized: Not the content owner\" });\n        }\n      }\n      \n      const strategy = await dynamicPricingService.createStrategy({\n        ...req.body,\n        creatorId: userId,\n      });\n      res.json(strategy);\n    } catch (error) {\n      console.error(\"Error creating pricing strategy:\", error);\n      res.status(500).json({ message: \"Failed to create pricing strategy\" });\n    }\n  });\n\n  // Get creator's pricing strategies\n  app.get('/api/pricing/strategies', isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const strategies = await dynamicPricingService.getCreatorStrategies(userId);\n      res.json(strategies);\n    } catch (error) {\n      console.error(\"Error fetching pricing strategies:\", error);\n      res.status(500).json({ message: \"Failed to fetch pricing strategies\" });\n    }\n  });\n\n  // Get strategy details\n  app.get('/api/pricing/strategies/:id', isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const strategy = await dynamicPricingService.getStrategy(req.params.id);\n      if (!strategy) {\n        return res.status(404).json({ message: \"Strategy not found\" });\n      }\n      \n      if (strategy.creatorId !== userId) {\n        return res.status(403).json({ message: \"Unauthorized: Not the strategy owner\" });\n      }\n      \n      res.json(strategy);\n    } catch (error) {\n      console.error(\"Error fetching strategy:\", error);\n      res.status(500).json({ message: \"Failed to fetch strategy\" });\n    }\n  });\n\n  // Update pricing strategy\n  app.patch('/api/pricing/strategies/:id', isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const strategy = await dynamicPricingService.getStrategy(req.params.id);\n      if (!strategy) {\n        return res.status(404).json({ message: \"Strategy not found\" });\n      }\n      \n      if (strategy.creatorId !== userId) {\n        return res.status(403).json({ message: \"Unauthorized: Not the strategy owner\" });\n      }\n\n      const allowedUpdates = {\n        basePrice: req.body.basePrice,\n        minPrice: req.body.minPrice,\n        maxPrice: req.body.maxPrice,\n        demandMultiplier: req.body.demandMultiplier,\n        engagementWeights: req.body.engagementWeights,\n        timeDecayRate: req.body.timeDecayRate,\n        surgeThreshold: req.body.surgeThreshold,\n        isActive: req.body.isActive,\n      };\n\n      await dynamicPricingService.updateStrategy(req.params.id, allowedUpdates);\n      res.json({ message: \"Strategy updated successfully\" });\n    } catch (error) {\n      console.error(\"Error updating strategy:\", error);\n      res.status(500).json({ message: \"Failed to update strategy\" });\n    }\n  });\n\n  // Delete pricing strategy\n  app.delete('/api/pricing/strategies/:id', isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const strategy = await dynamicPricingService.getStrategy(req.params.id);\n      if (!strategy) {\n        return res.status(404).json({ message: \"Strategy not found\" });\n      }\n      \n      if (strategy.creatorId !== userId) {\n        return res.status(403).json({ message: \"Unauthorized: Not the strategy owner\" });\n      }\n      \n      await dynamicPricingService.deleteStrategy(req.params.id);\n      res.json({ message: \"Strategy deleted successfully\" });\n    } catch (error) {\n      console.error(\"Error deleting strategy:\", error);\n      res.status(500).json({ message: \"Failed to delete strategy\" });\n    }\n  });\n\n  // Update demand metrics\n  app.post('/api/pricing/demand', isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const { contentId, ...metrics } = req.body;\n      \n      const content = await db.query.mediaAssets.findFirst({\n        where: eq(mediaAssets.id, contentId)\n      });\n      \n      if (!content) {\n        return res.status(404).json({ message: \"Content not found\" });\n      }\n      \n      if (content.ownerId !== userId) {\n        return res.status(403).json({ message: \"Unauthorized: Not the content owner\" });\n      }\n      \n      const updated = await dynamicPricingService.updateDemandMetrics(contentId, {\n        ...metrics,\n        creatorId: userId,\n        contentId,\n      });\n      \n      res.json(updated);\n    } catch (error) {\n      console.error(\"Error updating demand metrics:\", error);\n      res.status(500).json({ message: \"Failed to update demand metrics\" });\n    }\n  });\n\n  // Get demand metrics\n  app.get('/api/pricing/demand/:contentId', isAuthenticated, async (req: any, res) => {\n    try {\n      const [metrics] = await db\n        .select()\n        .from(demandMetrics)\n        .where(eq(demandMetrics.contentId, req.params.contentId));\n      \n      if (!metrics) {\n        return res.status(404).json({ message: \"Demand metrics not found\" });\n      }\n      \n      res.json(metrics);\n    } catch (error) {\n      console.error(\"Error fetching demand metrics:\", error);\n      res.status(500).json({ message: \"Failed to fetch demand metrics\" });\n    }\n  });\n\n  // Calculate optimal price\n  app.post('/api/pricing/calculate/:strategyId/:contentId', isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const { strategyId, contentId } = req.params;\n      \n      const strategy = await dynamicPricingService.getStrategy(strategyId);\n      if (!strategy) {\n        return res.status(404).json({ message: \"Strategy not found\" });\n      }\n      \n      if (strategy.creatorId !== userId) {\n        return res.status(403).json({ message: \"Unauthorized: Not the strategy owner\" });\n      }\n      \n      const optimalPrice = await dynamicPricingService.calculateOptimalPrice(strategyId, contentId);\n      res.json({ optimalPrice });\n    } catch (error) {\n      console.error(\"Error calculating optimal price:\", error);\n      res.status(500).json({ message: \"Failed to calculate optimal price\" });\n    }\n  });\n\n  // Create optimization\n  app.post('/api/pricing/optimize/:strategyId/:contentId', isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const { strategyId, contentId } = req.params;\n      \n      const strategy = await dynamicPricingService.getStrategy(strategyId);\n      if (!strategy) {\n        return res.status(404).json({ message: \"Strategy not found\" });\n      }\n      \n      if (strategy.creatorId !== userId) {\n        return res.status(403).json({ message: \"Unauthorized: Not the strategy owner\" });\n      }\n      \n      const optimization = await dynamicPricingService.createOptimization(strategyId, contentId);\n      res.json(optimization);\n    } catch (error) {\n      console.error(\"Error creating optimization:\", error);\n      res.status(500).json({ message: \"Failed to create optimization\" });\n    }\n  });\n\n  // Get optimizations\n  app.get('/api/pricing/optimizations/:strategyId', isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const strategy = await dynamicPricingService.getStrategy(req.params.strategyId);\n      if (!strategy) {\n        return res.status(404).json({ message: \"Strategy not found\" });\n      }\n      \n      if (strategy.creatorId !== userId) {\n        return res.status(403).json({ message: \"Unauthorized: Not the strategy owner\" });\n      }\n      \n      const optimizations = await dynamicPricingService.getOptimizations(req.params.strategyId);\n      res.json(optimizations);\n    } catch (error) {\n      console.error(\"Error fetching optimizations:\", error);\n      res.status(500).json({ message: \"Failed to fetch optimizations\" });\n    }\n  });\n\n  // Apply optimization\n  app.post('/api/pricing/apply/:optimizationId', isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const [optimization] = await db\n        .select()\n        .from(priceOptimization)\n        .where(eq(priceOptimization.id, req.params.optimizationId));\n      \n      if (!optimization) {\n        return res.status(404).json({ message: \"Optimization not found\" });\n      }\n      \n      const strategy = await dynamicPricingService.getStrategy(optimization.strategyId);\n      if (!strategy) {\n        return res.status(404).json({ message: \"Strategy not found\" });\n      }\n      \n      if (strategy.creatorId !== userId) {\n        return res.status(403).json({ message: \"Unauthorized: Not the strategy owner\" });\n      }\n      \n      await dynamicPricingService.applyOptimization(req.params.optimizationId);\n      res.json({ message: \"Optimization applied successfully\" });\n    } catch (error) {\n      console.error(\"Error applying optimization:\", error);\n      res.status(500).json({ message: \"Failed to apply optimization\" });\n    }\n  });\n\n  // Get price history\n  app.get('/api/pricing/history/:contentId', isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const content = await db.query.mediaAssets.findFirst({\n        where: eq(mediaAssets.id, req.params.contentId)\n      });\n      \n      if (!content) {\n        return res.status(404).json({ message: \"Content not found\" });\n      }\n      \n      if (content.ownerId !== userId) {\n        return res.status(403).json({ message: \"Unauthorized: Not the content owner\" });\n      }\n      \n      const history = await dynamicPricingService.getPriceHistory(req.params.contentId);\n      res.json(history);\n    } catch (error) {\n      console.error(\"Error fetching price history:\", error);\n      res.status(500).json({ message: \"Failed to fetch price history\" });\n    }\n  });\n\n  // Record manual price change\n  app.post('/api/pricing/record-change', isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const { contentId, strategyId, previousPrice, newPrice } = req.body;\n      \n      const content = await db.query.mediaAssets.findFirst({\n        where: eq(mediaAssets.id, contentId)\n      });\n      \n      if (!content) {\n        return res.status(404).json({ message: \"Content not found\" });\n      }\n      \n      if (content.ownerId !== userId) {\n        return res.status(403).json({ message: \"Unauthorized: Not the content owner\" });\n      }\n      \n      const history = await dynamicPricingService.recordPriceChange(\n        contentId,\n        strategyId,\n        previousPrice,\n        newPrice,\n        'manual_override'\n      );\n      \n      res.json(history);\n    } catch (error) {\n      console.error(\"Error recording price change:\", error);\n      res.status(500).json({ message: \"Failed to record price change\" });\n    }\n  });\n\n  // ============================================================================\n  // DEEPFAKE DETECTION SYSTEM ROUTES\n  // ============================================================================\n\n  // Scan content for deepfakes\n  app.post('/api/deepfake/scan', isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const { contentId, scanType } = req.body;\n      \n      const content = await db.query.mediaAssets.findFirst({\n        where: eq(mediaAssets.id, contentId)\n      });\n      \n      if (!content) {\n        return res.status(404).json({ message: \"Content not found\" });\n      }\n      \n      if (content.ownerId !== userId) {\n        return res.status(403).json({ message: \"Unauthorized: Not the content owner\" });\n      }\n      \n      const scan = await deepfakeDetectionService.scanContent(contentId, userId, scanType);\n      res.json(scan);\n    } catch (error) {\n      console.error(\"Error scanning content:\", error);\n      res.status(500).json({ message: \"Failed to scan content\" });\n    }\n  });\n\n  // Get scan results\n  app.get('/api/deepfake/scans/:scanId', isAuthenticated, async (req: any, res) => {\n    try {\n      const scan = await deepfakeDetectionService.getScan(req.params.scanId);\n      if (!scan) {\n        return res.status(404).json({ message: \"Scan not found\" });\n      }\n      res.json(scan);\n    } catch (error) {\n      console.error(\"Error fetching scan:\", error);\n      res.status(500).json({ message: \"Failed to fetch scan\" });\n    }\n  });\n\n  // Get content scans\n  app.get('/api/deepfake/content/:contentId/scans', isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const content = await db.query.mediaAssets.findFirst({\n        where: eq(mediaAssets.id, req.params.contentId)\n      });\n      \n      if (!content) {\n        return res.status(404).json({ message: \"Content not found\" });\n      }\n      \n      if (content.ownerId !== userId) {\n        return res.status(403).json({ message: \"Unauthorized: Not the content owner\" });\n      }\n      \n      const scans = await deepfakeDetectionService.getContentScans(req.params.contentId);\n      res.json(scans);\n    } catch (error) {\n      console.error(\"Error fetching content scans:\", error);\n      res.status(500).json({ message: \"Failed to fetch content scans\" });\n    }\n  });\n\n  // Get creator scans\n  app.get('/api/deepfake/creator/:creatorId/scans', isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      if (req.params.creatorId !== userId) {\n        return res.status(403).json({ message: \"Unauthorized: Not the creator\" });\n      }\n      \n      const scans = await deepfakeDetectionService.getCreatorScans(req.params.creatorId);\n      res.json(scans);\n    } catch (error) {\n      console.error(\"Error fetching creator scans:\", error);\n      res.status(500).json({ message: \"Failed to fetch creator scans\" });\n    }\n  });\n\n  // Generate authenticity signature\n  app.post('/api/deepfake/signature', isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const { contentId, signatureType } = req.body;\n      \n      const content = await db.query.mediaAssets.findFirst({\n        where: eq(mediaAssets.id, contentId)\n      });\n      \n      if (!content) {\n        return res.status(404).json({ message: \"Content not found\" });\n      }\n      \n      if (content.ownerId !== userId) {\n        return res.status(403).json({ message: \"Unauthorized: Not the content owner\" });\n      }\n      \n      const signature = await deepfakeDetectionService.generateAuthenticitySignature(\n        contentId, \n        userId, \n        signatureType\n      );\n      res.json(signature);\n    } catch (error) {\n      console.error(\"Error generating signature:\", error);\n      res.status(500).json({ message: \"Failed to generate signature\" });\n    }\n  });\n\n  // Verify content authenticity\n  app.post('/api/deepfake/verify', isAuthenticated, async (req: any, res) => {\n    try {\n      const { contentId, verificationCode } = req.body;\n      \n      const result = await deepfakeDetectionService.verifyContentAuthenticity(\n        contentId, \n        verificationCode\n      );\n      res.json(result);\n    } catch (error) {\n      console.error(\"Error verifying content:\", error);\n      res.status(500).json({ message: \"Failed to verify content\" });\n    }\n  });\n\n  // Get content signature\n  app.get('/api/deepfake/signature/:contentId', isAuthenticated, async (req: any, res) => {\n    try {\n      const signature = await deepfakeDetectionService.getContentSignature(req.params.contentId);\n      if (!signature) {\n        return res.status(404).json({ message: \"No signature found for this content\" });\n      }\n      res.json(signature);\n    } catch (error) {\n      console.error(\"Error fetching signature:\", error);\n      res.status(500).json({ message: \"Failed to fetch signature\" });\n    }\n  });\n\n  // Revoke signature\n  app.post('/api/deepfake/signature/:signatureId/revoke', isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const signature = await deepfakeDetectionService.getSignature(req.params.signatureId);\n      \n      if (!signature) {\n        return res.status(404).json({ message: \"Signature not found\" });\n      }\n      \n      if (signature.creatorId !== userId) {\n        return res.status(403).json({ message: \"Unauthorized: Not the signature owner\" });\n      }\n      \n      await deepfakeDetectionService.revokeSignature(req.params.signatureId, req.body.reason);\n      res.json({ message: \"Signature revoked successfully\" });\n    } catch (error) {\n      console.error(\"Error revoking signature:\", error);\n      res.status(500).json({ message: \"Failed to revoke signature\" });\n    }\n  });\n\n  // Create deepfake report\n  app.post('/api/deepfake/report', isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const report = await deepfakeDetectionService.createReport({\n        ...req.body,\n        reporterId: userId,\n      });\n      res.json(report);\n    } catch (error) {\n      console.error(\"Error creating report:\", error);\n      res.status(500).json({ message: \"Failed to create report\" });\n    }\n  });\n\n  // Get report\n  app.get('/api/deepfake/reports/:reportId', isAuthenticated, async (req: any, res) => {\n    try {\n      const report = await deepfakeDetectionService.getReport(req.params.reportId);\n      if (!report) {\n        return res.status(404).json({ message: \"Report not found\" });\n      }\n      res.json(report);\n    } catch (error) {\n      console.error(\"Error fetching report:\", error);\n      res.status(500).json({ message: \"Failed to fetch report\" });\n    }\n  });\n\n  // Get creator reports\n  app.get('/api/deepfake/creator/:creatorId/reports', isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      if (req.params.creatorId !== userId) {\n        return res.status(403).json({ message: \"Unauthorized: Not the creator\" });\n      }\n      \n      const reports = await deepfakeDetectionService.getCreatorReports(req.params.creatorId);\n      res.json(reports);\n    } catch (error) {\n      console.error(\"Error fetching creator reports:\", error);\n      res.status(500).json({ message: \"Failed to fetch creator reports\" });\n    }\n  });\n\n  // Get user reports\n  app.get('/api/deepfake/user/:userId/reports', isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      if (req.params.userId !== userId) {\n        return res.status(403).json({ message: \"Unauthorized\" });\n      }\n      \n      const reports = await deepfakeDetectionService.getUserReports(req.params.userId);\n      res.json(reports);\n    } catch (error) {\n      console.error(\"Error fetching user reports:\", error);\n      res.status(500).json({ message: \"Failed to fetch user reports\" });\n    }\n  });\n\n  // Get pending reports (moderators)\n  app.get('/api/deepfake/reports/pending', isAuthenticated, async (req: any, res) => {\n    try {\n      const reports = await deepfakeDetectionService.getPendingReports();\n      res.json(reports);\n    } catch (error) {\n      console.error(\"Error fetching pending reports:\", error);\n      res.status(500).json({ message: \"Failed to fetch pending reports\" });\n    }\n  });\n\n  // Update report\n  app.patch('/api/deepfake/reports/:reportId', isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const report = await deepfakeDetectionService.getReport(req.params.reportId);\n      \n      if (!report) {\n        return res.status(404).json({ message: \"Report not found\" });\n      }\n      \n      if (report.reporterId !== userId && report.moderatorId !== userId) {\n        return res.status(403).json({ message: \"Unauthorized\" });\n      }\n\n      const allowedUpdates = {\n        status: req.body.status,\n        priority: req.body.priority,\n        moderatorNotes: req.body.moderatorNotes,\n        aiVerificationScore: req.body.aiVerificationScore,\n      };\n      \n      await deepfakeDetectionService.updateReport(req.params.reportId, allowedUpdates);\n      res.json({ message: \"Report updated successfully\" });\n    } catch (error) {\n      console.error(\"Error updating report:\", error);\n      res.status(500).json({ message: \"Failed to update report\" });\n    }\n  });\n\n  // Resolve report\n  app.post('/api/deepfake/reports/:reportId/resolve', isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const { resolution, actionTaken } = req.body;\n      \n      await deepfakeDetectionService.resolveReport(\n        req.params.reportId, \n        resolution, \n        actionTaken, \n        userId\n      );\n      res.json({ message: \"Report resolved successfully\" });\n    } catch (error) {\n      console.error(\"Error resolving report:\", error);\n      res.status(500).json({ message: \"Failed to resolve report\" });\n    }\n  });\n\n  // ============================================================================\n  // FAN-TO-CREATOR MICROLENDING ROUTES\n  // ============================================================================\n\n  // Create loan listing\n  app.post('/api/loans/listings', isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const listing = await microlendingService.createLoanListing({\n        ...req.body,\n        creatorId: userId,\n      });\n      res.json(listing);\n    } catch (error) {\n      console.error(\"Error creating loan listing:\", error);\n      res.status(500).json({ message: \"Failed to create loan listing\" });\n    }\n  });\n\n  // Get creator's loan listings\n  app.get('/api/loans/listings/creator/:creatorId', isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      if (req.params.creatorId !== userId) {\n        return res.status(403).json({ message: \"Unauthorized: Not the creator\" });\n      }\n      \n      const listings = await microlendingService.getCreatorListings(req.params.creatorId);\n      res.json(listings);\n    } catch (error) {\n      console.error(\"Error fetching creator listings:\", error);\n      res.status(500).json({ message: \"Failed to fetch creator listings\" });\n    }\n  });\n\n  // Get all active loan listings\n  app.get('/api/loans/listings/active', isAuthenticated, async (req: any, res) => {\n    try {\n      const listings = await microlendingService.getActiveListings();\n      res.json(listings);\n    } catch (error) {\n      console.error(\"Error fetching active listings:\", error);\n      res.status(500).json({ message: \"Failed to fetch active listings\" });\n    }\n  });\n\n  // Get loan listing details\n  app.get('/api/loans/listings/:id', isAuthenticated, async (req: any, res) => {\n    try {\n      const listing = await microlendingService.getListing(req.params.id);\n      if (!listing) {\n        return res.status(404).json({ message: \"Listing not found\" });\n      }\n      res.json(listing);\n    } catch (error) {\n      console.error(\"Error fetching listing:\", error);\n      res.status(500).json({ message: \"Failed to fetch listing\" });\n    }\n  });\n\n  // Update loan listing\n  app.patch('/api/loans/listings/:id', isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const listing = await microlendingService.getListing(req.params.id);\n      if (!listing) {\n        return res.status(404).json({ message: \"Listing not found\" });\n      }\n      \n      if (listing.creatorId !== userId) {\n        return res.status(403).json({ message: \"Unauthorized: Not the listing owner\" });\n      }\n\n      const allowedUpdates = {\n        title: req.body.title,\n        description: req.body.description,\n        requestedAmount: req.body.requestedAmount,\n        interestRate: req.body.interestRate,\n        termMonths: req.body.termMonths,\n        collateralDescription: req.body.collateralDescription,\n        collateralValue: req.body.collateralValue,\n        status: req.body.status,\n      };\n\n      await microlendingService.updateListing(req.params.id, allowedUpdates);\n      res.json({ message: \"Listing updated successfully\" });\n    } catch (error) {\n      console.error(\"Error updating listing:\", error);\n      res.status(500).json({ message: \"Failed to update listing\" });\n    }\n  });\n\n  // Delete loan listing\n  app.delete('/api/loans/listings/:id', isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const listing = await microlendingService.getListing(req.params.id);\n      if (!listing) {\n        return res.status(404).json({ message: \"Listing not found\" });\n      }\n      \n      if (listing.creatorId !== userId) {\n        return res.status(403).json({ message: \"Unauthorized: Not the listing owner\" });\n      }\n      \n      await microlendingService.deleteListing(req.params.id);\n      res.json({ message: \"Listing deleted successfully\" });\n    } catch (error) {\n      console.error(\"Error deleting listing:\", error);\n      res.status(500).json({ message: \"Failed to delete listing\" });\n    }\n  });\n\n  // Create loan offer\n  app.post('/api/loans/offers', isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const offer = await microlendingService.createOffer({\n        ...req.body,\n        lenderId: userId,\n      });\n      res.json(offer);\n    } catch (error) {\n      console.error(\"Error creating loan offer:\", error);\n      res.status(500).json({ message: \"Failed to create loan offer\" });\n    }\n  });\n\n  // Get offers for a listing\n  app.get('/api/loans/listings/:listingId/offers', isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const listing = await microlendingService.getListing(req.params.listingId);\n      if (!listing) {\n        return res.status(404).json({ message: \"Listing not found\" });\n      }\n      \n      if (listing.creatorId !== userId) {\n        return res.status(403).json({ message: \"Unauthorized: Not the listing owner\" });\n      }\n      \n      const offers = await microlendingService.getListingOffers(req.params.listingId);\n      res.json(offers);\n    } catch (error) {\n      console.error(\"Error fetching listing offers:\", error);\n      res.status(500).json({ message: \"Failed to fetch listing offers\" });\n    }\n  });\n\n  // Get lender's offers\n  app.get('/api/loans/offers/lender/:lenderId', isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      if (req.params.lenderId !== userId) {\n        return res.status(403).json({ message: \"Unauthorized: Not the lender\" });\n      }\n      \n      const offers = await microlendingService.getLenderOffers(req.params.lenderId);\n      res.json(offers);\n    } catch (error) {\n      console.error(\"Error fetching lender offers:\", error);\n      res.status(500).json({ message: \"Failed to fetch lender offers\" });\n    }\n  });\n\n  // Accept loan offer\n  app.post('/api/loans/offers/:offerId/accept', isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const offer = await microlendingService.getOffer(req.params.offerId);\n      if (!offer) {\n        return res.status(404).json({ message: \"Offer not found\" });\n      }\n      \n      const listing = await microlendingService.getListing(offer.listingId);\n      if (!listing) {\n        return res.status(404).json({ message: \"Listing not found\" });\n      }\n      \n      if (listing.creatorId !== userId) {\n        return res.status(403).json({ message: \"Unauthorized: Not the listing owner\" });\n      }\n      \n      const loan = await microlendingService.acceptOffer(req.params.offerId);\n      res.json(loan);\n    } catch (error) {\n      console.error(\"Error accepting offer:\", error);\n      res.status(500).json({ message: \"Failed to accept offer\" });\n    }\n  });\n\n  // Reject loan offer\n  app.post('/api/loans/offers/:offerId/reject', isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const offer = await microlendingService.getOffer(req.params.offerId);\n      if (!offer) {\n        return res.status(404).json({ message: \"Offer not found\" });\n      }\n      \n      const listing = await microlendingService.getListing(offer.listingId);\n      if (!listing) {\n        return res.status(404).json({ message: \"Listing not found\" });\n      }\n      \n      if (listing.creatorId !== userId) {\n        return res.status(403).json({ message: \"Unauthorized: Not the listing owner\" });\n      }\n      \n      await microlendingService.updateOffer(req.params.offerId, 'rejected');\n      res.json({ message: \"Offer rejected successfully\" });\n    } catch (error) {\n      console.error(\"Error rejecting offer:\", error);\n      res.status(500).json({ message: \"Failed to reject offer\" });\n    }\n  });\n\n  // Get creator's loans\n  app.get('/api/loans/creator/:creatorId', isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      if (req.params.creatorId !== userId) {\n        return res.status(403).json({ message: \"Unauthorized: Not the creator\" });\n      }\n      \n      const loans = await microlendingService.getCreatorLoans(req.params.creatorId);\n      res.json(loans);\n    } catch (error) {\n      console.error(\"Error fetching creator loans:\", error);\n      res.status(500).json({ message: \"Failed to fetch creator loans\" });\n    }\n  });\n\n  // Get lender's loans\n  app.get('/api/loans/lender/:lenderId', isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      if (req.params.lenderId !== userId) {\n        return res.status(403).json({ message: \"Unauthorized: Not the lender\" });\n      }\n      \n      const loans = await microlendingService.getLenderLoans(req.params.lenderId);\n      res.json(loans);\n    } catch (error) {\n      console.error(\"Error fetching lender loans:\", error);\n      res.status(500).json({ message: \"Failed to fetch lender loans\" });\n    }\n  });\n\n  // Get loan details\n  app.get('/api/loans/:loanId', isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const loan = await microlendingService.getLoan(req.params.loanId);\n      if (!loan) {\n        return res.status(404).json({ message: \"Loan not found\" });\n      }\n      \n      if (loan.creatorId !== userId && loan.lenderId !== userId) {\n        return res.status(403).json({ message: \"Unauthorized: Not involved in this loan\" });\n      }\n      \n      res.json(loan);\n    } catch (error) {\n      console.error(\"Error fetching loan:\", error);\n      res.status(500).json({ message: \"Failed to fetch loan\" });\n    }\n  });\n\n  // Make loan payment\n  app.post('/api/loans/:loanId/payment', isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const loan = await microlendingService.getLoan(req.params.loanId);\n      if (!loan) {\n        return res.status(404).json({ message: \"Loan not found\" });\n      }\n      \n      if (loan.creatorId !== userId) {\n        return res.status(403).json({ message: \"Unauthorized: Not the borrower\" });\n      }\n      \n      const payment = await microlendingService.makePayment(req.params.loanId, req.body.amount);\n      res.json(payment);\n    } catch (error) {\n      console.error(\"Error making payment:\", error);\n      res.status(500).json({ message: \"Failed to make payment\" });\n    }\n  });\n\n  // Get loan payments\n  app.get('/api/loans/:loanId/payments', isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const loan = await microlendingService.getLoan(req.params.loanId);\n      if (!loan) {\n        return res.status(404).json({ message: \"Loan not found\" });\n      }\n      \n      if (loan.creatorId !== userId && loan.lenderId !== userId) {\n        return res.status(403).json({ message: \"Unauthorized: Not involved in this loan\" });\n      }\n      \n      const payments = await microlendingService.getLoanPayments(req.params.loanId);\n      res.json(payments);\n    } catch (error) {\n      console.error(\"Error fetching loan payments:\", error);\n      res.status(500).json({ message: \"Failed to fetch loan payments\" });\n    }\n  });\n\n  // Mark loan as defaulted\n  app.post('/api/loans/:loanId/default', isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const loan = await microlendingService.getLoan(req.params.loanId);\n      if (!loan) {\n        return res.status(404).json({ message: \"Loan not found\" });\n      }\n      \n      if (loan.lenderId !== userId) {\n        return res.status(403).json({ message: \"Unauthorized: Only lender can mark as defaulted\" });\n      }\n      \n      await microlendingService.markLoanAsDefaulted(req.params.loanId, req.body.reason);\n      res.json({ message: \"Loan marked as defaulted\" });\n    } catch (error) {\n      console.error(\"Error marking loan as defaulted:\", error);\n      res.status(500).json({ message: \"Failed to mark loan as defaulted\" });\n    }\n  });\n\n  // Get loan collateral\n  app.get('/api/loans/:loanId/collateral', isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const loan = await microlendingService.getLoan(req.params.loanId);\n      if (!loan) {\n        return res.status(404).json({ message: \"Loan not found\" });\n      }\n      \n      if (loan.creatorId !== userId && loan.lenderId !== userId) {\n        return res.status(403).json({ message: \"Unauthorized: Not involved in this loan\" });\n      }\n      \n      const collateral = await microlendingService.getLoanCollateral(req.params.loanId);\n      res.json(collateral);\n    } catch (error) {\n      console.error(\"Error fetching loan collateral:\", error);\n      res.status(500).json({ message: \"Failed to fetch loan collateral\" });\n    }\n  });\n\n  // Get loan analytics\n  app.get('/api/loans/analytics/:userId', isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      if (req.params.userId !== userId) {\n        return res.status(403).json({ message: \"Unauthorized\" });\n      }\n      \n      const userType = req.query.type as 'creator' | 'lender';\n      if (!userType || !['creator', 'lender'].includes(userType)) {\n        return res.status(400).json({ message: \"Invalid user type. Must be 'creator' or 'lender'\" });\n      }\n      \n      const analytics = await microlendingService.getLoanAnalytics(req.params.userId, userType);\n      res.json(analytics);\n    } catch (error) {\n      console.error(\"Error fetching loan analytics:\", error);\n      res.status(500).json({ message: \"Failed to fetch loan analytics\" });\n    }\n  });\n\n  // Quick publish endpoint - orchestrates content processing and distribution\n  app.post('/api/dashboard/quick-publish', isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const { \n        contentId, \n        platforms, \n        customCaption, \n        autoEdit, \n        aspectRatios, \n        generateGif, \n        scheduledFor \n      } = req.body;\n\n      if (!contentId) {\n        return res.status(400).json({ message: \"Content ID is required\" });\n      }\n\n      const results: any = {\n        contentId,\n        processingJob: null,\n        distributionJobs: [],\n        success: true,\n        errors: [],\n      };\n\n      // Step 1: Auto-process content if enabled\n      if (autoEdit || (aspectRatios && aspectRatios.length > 0) || generateGif) {\n        try {\n          const processingJob = await aiContentProcessingService.queueProcessing(\n            contentId,\n            `/content/${contentId}/original.mp4`,\n            {\n              autoEdit: autoEdit || false,\n              aspectRatios: aspectRatios || [],\n              generateGif: generateGif || false,\n              generateTrailer: false,\n              generateHighlights: false,\n              addBranding: false,\n            }\n          );\n\n          results.processingJob = processingJob;\n        } catch (error) {\n          console.error(\"Error creating processing job:\", error);\n          results.errors.push(`Processing: ${error instanceof Error ? error.message : 'Unknown error'}`);\n        }\n      }\n\n      // Step 2: Distribute content to platforms\n      try {\n        const distributionOptions: any = {\n          platforms: platforms && platforms.length > 0 ? platforms : undefined,\n          caption: customCaption || undefined,\n          scheduledFor: scheduledFor ? new Date(scheduledFor) : undefined,\n        };\n\n        const distributionJobs = await distributionService.distributeContent(\n          contentId,\n          userId,\n          distributionOptions\n        );\n\n        results.distributionJobs = distributionJobs;\n      } catch (error) {\n        console.error(\"Error creating distribution jobs:\", error);\n        results.errors.push(`Distribution: ${error instanceof Error ? error.message : 'Unknown error'}`);\n        results.success = false;\n      }\n\n      // Return comprehensive results\n      if (results.success && results.errors.length === 0) {\n        res.json({\n          ...results,\n          message: \"Content published successfully!\",\n        });\n      } else {\n        res.status(207).json({\n          ...results,\n          message: \"Content published with some errors\",\n        });\n      }\n    } catch (error) {\n      console.error(\"Error in quick publish:\", error);\n      res.status(500).json({ \n        message: \"Failed to publish content\",\n        error: error instanceof Error ? error.message : \"Unknown error\"\n      });\n    }\n  });\n\n  // ============================================================================\n  // EMOTIONAL AI ENGINE ROUTES\n  // ============================================================================\n\n  // Analyze interaction (sentiment analysis)\n  app.post('/api/emotional-ai/analyze', isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const { interactionType, messageContent, interactionId, creatorId } = req.body;\n      \n      const analysis = await emotionalAIService.analyzeInteraction(\n        userId,\n        interactionType,\n        messageContent,\n        interactionId,\n        creatorId\n      );\n      res.json(analysis);\n    } catch (error) {\n      console.error(\"Error analyzing interaction:\", error);\n      res.status(500).json({ message: \"Failed to analyze interaction\" });\n    }\n  });\n\n  // Get analysis by ID\n  app.get('/api/emotional-ai/analysis/:analysisId', isAuthenticated, async (req: any, res) => {\n    try {\n      const analysis = await emotionalAIService.getAnalysis(req.params.analysisId);\n      if (!analysis) {\n        return res.status(404).json({ message: \"Analysis not found\" });\n      }\n      res.json(analysis);\n    } catch (error) {\n      console.error(\"Error fetching analysis:\", error);\n      res.status(500).json({ message: \"Failed to fetch analysis\" });\n    }\n  });\n\n  // Get user analyses\n  app.get('/api/emotional-ai/user/:userId/analyses', isAuthenticated, async (req: any, res) => {\n    try {\n      const loggedInUserId = req.user.claims.sub;\n      if (req.params.userId !== loggedInUserId) {\n        return res.status(403).json({ message: \"Unauthorized: Not the user\" });\n      }\n      \n      const limit = parseInt(req.query.limit as string) || 50;\n      const analyses = await emotionalAIService.getUserAnalyses(req.params.userId, limit);\n      res.json(analyses);\n    } catch (error) {\n      console.error(\"Error fetching user analyses:\", error);\n      res.status(500).json({ message: \"Failed to fetch user analyses\" });\n    }\n  });\n\n  // Get creator analyses\n  app.get('/api/emotional-ai/creator/:creatorId/analyses', isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      if (req.params.creatorId !== userId) {\n        return res.status(403).json({ message: \"Unauthorized: Not the creator\" });\n      }\n      \n      const limit = parseInt(req.query.limit as string) || 100;\n      const analyses = await emotionalAIService.getCreatorAnalyses(req.params.creatorId, limit);\n      res.json(analyses);\n    } catch (error) {\n      console.error(\"Error fetching creator analyses:\", error);\n      res.status(500).json({ message: \"Failed to fetch creator analyses\" });\n    }\n  });\n\n  // Get mood profile\n  app.get('/api/emotional-ai/mood/:userId', isAuthenticated, async (req: any, res) => {\n    try {\n      const loggedInUserId = req.user.claims.sub;\n      if (req.params.userId !== loggedInUserId) {\n        return res.status(403).json({ message: \"Unauthorized: Not the user\" });\n      }\n      \n      const profile = await emotionalAIService.getMoodProfile(req.params.userId);\n      if (!profile) {\n        return res.status(404).json({ message: \"Mood profile not found\" });\n      }\n      res.json(profile);\n    } catch (error) {\n      console.error(\"Error fetching mood profile:\", error);\n      res.status(500).json({ message: \"Failed to fetch mood profile\" });\n    }\n  });\n\n  // Get creator mood profiles\n  app.get('/api/emotional-ai/creator/:creatorId/moods', isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      if (req.params.creatorId !== userId) {\n        return res.status(403).json({ message: \"Unauthorized: Not the creator\" });\n      }\n      \n      const limit = parseInt(req.query.limit as string) || 100;\n      const profiles = await emotionalAIService.getCreatorMoodProfiles(req.params.creatorId, limit);\n      res.json(profiles);\n    } catch (error) {\n      console.error(\"Error fetching creator mood profiles:\", error);\n      res.status(500).json({ message: \"Failed to fetch creator mood profiles\" });\n    }\n  });\n\n  // Get recommendation by ID\n  app.get('/api/emotional-ai/recommendation/:recommendationId', isAuthenticated, async (req: any, res) => {\n    try {\n      const recommendation = await emotionalAIService.getRecommendation(req.params.recommendationId);\n      if (!recommendation) {\n        return res.status(404).json({ message: \"Recommendation not found\" });\n      }\n      res.json(recommendation);\n    } catch (error) {\n      console.error(\"Error fetching recommendation:\", error);\n      res.status(500).json({ message: \"Failed to fetch recommendation\" });\n    }\n  });\n\n  // Get creator recommendations\n  app.get('/api/emotional-ai/creator/:creatorId/recommendations', isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      if (req.params.creatorId !== userId) {\n        return res.status(403).json({ message: \"Unauthorized: Not the creator\" });\n      }\n      \n      const onlyUnused = req.query.onlyUnused === 'true';\n      const limit = parseInt(req.query.limit as string) || 50;\n      const recommendations = await emotionalAIService.getCreatorRecommendations(\n        req.params.creatorId, \n        onlyUnused, \n        limit\n      );\n      res.json(recommendations);\n    } catch (error) {\n      console.error(\"Error fetching creator recommendations:\", error);\n      res.status(500).json({ message: \"Failed to fetch creator recommendations\" });\n    }\n  });\n\n  // Mark recommendation as used\n  app.post('/api/emotional-ai/recommendation/:recommendationId/use', isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const recommendation = await emotionalAIService.getRecommendation(req.params.recommendationId);\n      \n      if (!recommendation) {\n        return res.status(404).json({ message: \"Recommendation not found\" });\n      }\n      \n      if (recommendation.creatorId !== userId) {\n        return res.status(403).json({ message: \"Unauthorized: Not the recommendation owner\" });\n      }\n      \n      const { effectiveness, feedback } = req.body;\n      await emotionalAIService.markRecommendationUsed(\n        req.params.recommendationId, \n        effectiveness, \n        feedback\n      );\n      res.json({ message: \"Recommendation marked as used\" });\n    } catch (error) {\n      console.error(\"Error marking recommendation as used:\", error);\n      res.status(500).json({ message: \"Failed to mark recommendation as used\" });\n    }\n  });\n\n  // Get high priority recommendations\n  app.get('/api/emotional-ai/creator/:creatorId/priority-recommendations', isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      if (req.params.creatorId !== userId) {\n        return res.status(403).json({ message: \"Unauthorized: Not the creator\" });\n      }\n      \n      const recommendations = await emotionalAIService.getHighPriorityRecommendations(req.params.creatorId);\n      res.json(recommendations);\n    } catch (error) {\n      console.error(\"Error fetching priority recommendations:\", error);\n      res.status(500).json({ message: \"Failed to fetch priority recommendations\" });\n    }\n  });\n\n  return httpServer;\n}\n","size_bytes":177422},"client/src/components/creator/EarningsCard.tsx":{"content":"import { useQuery } from \"@tanstack/react-query\";\nimport { useState } from \"react\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport { TrendingUp, DollarSign, Users, Heart, ArrowUpIcon, ArrowDownIcon } from \"lucide-react\";\n\nexport default function EarningsCard() {\n  const [period, setPeriod] = useState(\"month\");\n\n  const { data: earnings, isLoading } = useQuery({\n    queryKey: ['/api/analytics/earnings', period],\n  });\n\n  const formatCurrency = (amount: number) => {\n    return new Intl.NumberFormat('en-US', {\n      style: 'currency',\n      currency: 'USD',\n    }).format(amount);\n  };\n\n  const periodLabels = {\n    day: \"Today\",\n    week: \"This Week\", \n    month: \"This Month\"\n  };\n\n  return (\n    <Card className=\"pack-card\">\n      <CardHeader>\n        <div className=\"flex items-center justify-between\">\n          <CardTitle className=\"flex items-center\">\n            <TrendingUp className=\"mr-2 h-5 w-5\" />\n            Earnings Overview\n          </CardTitle>\n          <Select value={period} onValueChange={setPeriod}>\n            <SelectTrigger className=\"w-32\" data-testid=\"select-earnings-period\">\n              <SelectValue />\n            </SelectTrigger>\n            <SelectContent>\n              <SelectItem value=\"day\">Today</SelectItem>\n              <SelectItem value=\"week\">This Week</SelectItem>\n              <SelectItem value=\"month\">This Month</SelectItem>\n            </SelectContent>\n          </Select>\n        </div>\n      </CardHeader>\n      <CardContent>\n        {isLoading ? (\n          <div className=\"space-y-6\">\n            <Skeleton className=\"h-20\" />\n            <div className=\"grid md:grid-cols-3 gap-4\">\n              <Skeleton className=\"h-16\" />\n              <Skeleton className=\"h-16\" />\n              <Skeleton className=\"h-16\" />\n            </div>\n          </div>\n        ) : (\n          <div className=\"space-y-6\">\n            {/* Total Earnings */}\n            <div className=\"text-center p-6 bg-background rounded-lg border border-border\">\n              <p className=\"text-sm text-muted mb-2\">{periodLabels[period as keyof typeof periodLabels]} Earnings</p>\n              <p className=\"text-4xl font-bold text-primary mb-2\" data-testid=\"text-total-earnings\">\n                {formatCurrency(earnings?.totalEarnings || 0)}\n              </p>\n              <div className=\"flex items-center justify-center space-x-2 text-sm\">\n                <ArrowUpIcon className=\"h-4 w-4 text-success\" />\n                <span className=\"text-success\">+15.3% from last {period}</span>\n              </div>\n            </div>\n\n            {/* Earnings Breakdown */}\n            <div className=\"grid md:grid-cols-3 gap-4\">\n              <div className=\"p-4 bg-background rounded-lg border border-border\">\n                <div className=\"flex items-center justify-between mb-2\">\n                  <DollarSign className=\"h-5 w-5 text-secondary\" />\n                  <span className=\"text-xs text-muted\">Subscriptions</span>\n                </div>\n                <p className=\"text-2xl font-bold text-secondary\" data-testid=\"text-subscription-earnings\">\n                  {formatCurrency(earnings?.subscriptionEarnings || 0)}\n                </p>\n                <div className=\"flex items-center space-x-1 text-xs text-muted mt-1\">\n                  <ArrowUpIcon className=\"h-3 w-3 text-success\" />\n                  <span>+8.2%</span>\n                </div>\n              </div>\n\n              <div className=\"p-4 bg-background rounded-lg border border-border\">\n                <div className=\"flex items-center justify-between mb-2\">\n                  <Heart className=\"h-5 w-5 text-accent\" />\n                  <span className=\"text-xs text-muted\">Tips</span>\n                </div>\n                <p className=\"text-2xl font-bold text-accent\" data-testid=\"text-tip-earnings\">\n                  {formatCurrency(earnings?.tipEarnings || 0)}\n                </p>\n                <div className=\"flex items-center space-x-1 text-xs text-muted mt-1\">\n                  <ArrowUpIcon className=\"h-3 w-3 text-success\" />\n                  <span>+23.1%</span>\n                </div>\n              </div>\n\n              <div className=\"p-4 bg-background rounded-lg border border-border\">\n                <div className=\"flex items-center justify-between mb-2\">\n                  <Users className=\"h-5 w-5 text-success\" />\n                  <span className=\"text-xs text-muted\">PPV Content</span>\n                </div>\n                <p className=\"text-2xl font-bold text-success\" data-testid=\"text-ppv-earnings\">\n                  {formatCurrency(earnings?.ppvEarnings || 0)}\n                </p>\n                <div className=\"flex items-center space-x-1 text-xs text-muted mt-1\">\n                  <ArrowDownIcon className=\"h-3 w-3 text-destructive\" />\n                  <span>-2.1%</span>\n                </div>\n              </div>\n            </div>\n\n            {/* Quick Actions */}\n            <div className=\"flex flex-col sm:flex-row gap-3\">\n              <Button variant=\"outline\" className=\"flex-1\" data-testid=\"button-view-analytics\">\n                <TrendingUp className=\"mr-2 h-4 w-4\" />\n                View Detailed Analytics\n              </Button>\n              <Button variant=\"outline\" className=\"flex-1\" data-testid=\"button-payout-settings\">\n                <DollarSign className=\"mr-2 h-4 w-4\" />\n                Payout Settings\n              </Button>\n            </div>\n\n            {/* Earnings History Chart Placeholder */}\n            <div className=\"h-32 bg-gradient-to-r from-primary/10 via-secondary/10 to-accent/10 rounded-lg flex items-center justify-center border border-border\">\n              <div className=\"text-center\">\n                <TrendingUp className=\"h-8 w-8 text-muted mx-auto mb-2\" />\n                <p className=\"text-sm text-muted\">Earnings chart coming soon</p>\n              </div>\n            </div>\n          </div>\n        )}\n      </CardContent>\n    </Card>\n  );\n}\n","size_bytes":6198},"client/src/components/onboarding/OnboardingWizard.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogDescription,\n  DialogHeader,\n  DialogTitle,\n} from \"@/components/ui/dialog\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card } from \"@/components/ui/card\";\nimport { Star, Users, Sparkles, Heart } from \"lucide-react\";\nimport CreatorOnboarding from \"./CreatorOnboarding\";\nimport FanzOnboarding from \"./FanzOnboarding\";\n\ninterface OnboardingWizardProps {\n  isOpen: boolean;\n  onComplete: () => void;\n}\n\nexport default function OnboardingWizard({ isOpen, onComplete }: OnboardingWizardProps) {\n  const { toast } = useToast();\n  const [selectedRole, setSelectedRole] = useState<'creator' | 'fan' | null>(null);\n\n  // Fetch current user to check onboarding status\n  const { data: user } = useQuery<any>({\n    queryKey: ['/api/auth/user'],\n    enabled: isOpen,\n  });\n\n  const selectRoleMutation = useMutation({\n    mutationFn: async (role: 'creator' | 'fan') => {\n      const response = await apiRequest('POST', '/api/onboarding/select-role', { role });\n      return response.json();\n    },\n    onSuccess: (data) => {\n      setSelectedRole(data.role);\n      queryClient.invalidateQueries({ queryKey: ['/api/auth/user'] });\n    },\n    onError: (error) => {\n      toast({\n        title: \"Error\",\n        description: \"Failed to select role. Please try again.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const handleRoleSelect = (role: 'creator' | 'fan') => {\n    selectRoleMutation.mutate(role);\n  };\n\n  // If user already completed onboarding or has a role selected\n  useEffect(() => {\n    if (user?.onboardingCompleted) {\n      onComplete();\n    } else if (user?.role && user?.role !== 'admin') {\n      setSelectedRole(user.role as 'creator' | 'fan');\n    }\n  }, [user, onComplete]);\n\n  // Role selection screen\n  if (!selectedRole) {\n    return (\n      <Dialog open={isOpen} onOpenChange={() => {}}>\n        <DialogContent className=\"max-w-[95vw] sm:max-w-3xl max-h-[90vh] overflow-y-auto bg-card border border-border p-4 sm:p-6\" data-testid=\"dialog-role-selection\">\n          <DialogHeader>\n            <DialogTitle className=\"text-center font-display text-xl sm:text-2xl md:text-3xl\">\n              Welcome to the FUN Empire! ðŸŽ‰\n            </DialogTitle>\n            <DialogDescription className=\"text-center text-sm sm:text-base md:text-lg mt-2\">\n              Choose your path and start your journey\n            </DialogDescription>\n          </DialogHeader>\n\n          <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4 sm:gap-6 mt-4 sm:mt-6\">\n            {/* Creator Path */}\n            <Card \n              className=\"p-6 cursor-pointer border-2 hover:border-primary transition-all hover:scale-105\"\n              onClick={() => handleRoleSelect('creator')}\n              data-testid=\"card-select-creator\"\n            >\n              <div className=\"text-center space-y-4\">\n                <div className=\"w-20 h-20 mx-auto bg-primary/10 rounded-full flex items-center justify-center\">\n                  <Star className=\"w-10 h-10 text-primary\" />\n                </div>\n                <h3 className=\"font-display text-2xl\">I'm a Creator</h3>\n                <p className=\"text-muted-foreground\">\n                  Claim your star power and build your empire\n                </p>\n                <ul className=\"text-sm space-y-2 text-left\">\n                  <li className=\"flex items-center gap-2\">\n                    <Sparkles className=\"w-4 h-4 text-primary\" />\n                    100% of your earnings\n                  </li>\n                  <li className=\"flex items-center gap-2\">\n                    <Sparkles className=\"w-4 h-4 text-primary\" />\n                    Full content ownership\n                  </li>\n                  <li className=\"flex items-center gap-2\">\n                    <Sparkles className=\"w-4 h-4 text-primary\" />\n                    Advanced creator tools\n                  </li>\n                  <li className=\"flex items-center gap-2\">\n                    <Sparkles className=\"w-4 h-4 text-primary\" />\n                    Community support\n                  </li>\n                </ul>\n                <Button className=\"w-full btn-primary\" disabled={selectRoleMutation.isPending}>\n                  {selectRoleMutation.isPending ? 'Selecting...' : 'Claim Your Star Power â†’'}\n                </Button>\n              </div>\n            </Card>\n\n            {/* Fanz Path */}\n            <Card \n              className=\"p-6 cursor-pointer border-2 hover:border-primary transition-all hover:scale-105\"\n              onClick={() => handleRoleSelect('fan')}\n              data-testid=\"card-select-fanz\"\n            >\n              <div className=\"text-center space-y-4\">\n                <div className=\"w-20 h-20 mx-auto bg-secondary/10 rounded-full flex items-center justify-center\">\n                  <Users className=\"w-10 h-10 text-secondary\" />\n                </div>\n                <h3 className=\"font-display text-2xl\">I'm a Fanz</h3>\n                <p className=\"text-muted-foreground\">\n                  Discover, connect, and support your favorite creators\n                </p>\n                <ul className=\"text-sm space-y-2 text-left\">\n                  <li className=\"flex items-center gap-2\">\n                    <Heart className=\"w-4 h-4 text-secondary\" />\n                    Personalized discovery feed\n                  </li>\n                  <li className=\"flex items-center gap-2\">\n                    <Heart className=\"w-4 h-4 text-secondary\" />\n                    Direct creator access\n                  </li>\n                  <li className=\"flex items-center gap-2\">\n                    <Heart className=\"w-4 h-4 text-secondary\" />\n                    Exclusive content\n                  </li>\n                  <li className=\"flex items-center gap-2\">\n                    <Heart className=\"w-4 h-4 text-secondary\" />\n                    Safe & secure platform\n                  </li>\n                </ul>\n                <Button className=\"w-full btn-secondary\" disabled={selectRoleMutation.isPending}>\n                  {selectRoleMutation.isPending ? 'Selecting...' : 'Start Discovering â†’'}\n                </Button>\n              </div>\n            </Card>\n          </div>\n\n          <p className=\"text-center text-sm text-muted-foreground mt-4\">\n            Single account system - you can upgrade from Fanz to Creator anytime\n          </p>\n        </DialogContent>\n      </Dialog>\n    );\n  }\n\n  // Show appropriate onboarding flow based on selected role\n  if (selectedRole === 'creator') {\n    return <CreatorOnboarding isOpen={isOpen} onComplete={onComplete} />;\n  }\n\n  if (selectedRole === 'fan') {\n    return <FanzOnboarding isOpen={isOpen} onComplete={onComplete} />;\n  }\n\n  return null;\n}\n","size_bytes":6968},"client/src/components/ui/toggle.tsx":{"content":"import * as React from \"react\"\nimport * as TogglePrimitive from \"@radix-ui/react-toggle\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst toggleVariants = cva(\n  \"inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors hover:bg-muted hover:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=on]:bg-accent data-[state=on]:text-accent-foreground [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0 gap-2\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-transparent\",\n        outline:\n          \"border border-input bg-transparent hover:bg-accent hover:text-accent-foreground\",\n      },\n      size: {\n        default: \"h-10 px-3 min-w-10\",\n        sm: \"h-9 px-2.5 min-w-9\",\n        lg: \"h-11 px-5 min-w-11\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n)\n\nconst Toggle = React.forwardRef<\n  React.ElementRef<typeof TogglePrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof TogglePrimitive.Root> &\n    VariantProps<typeof toggleVariants>\n>(({ className, variant, size, ...props }, ref) => (\n  <TogglePrimitive.Root\n    ref={ref}\n    className={cn(toggleVariants({ variant, size, className }))}\n    {...props}\n  />\n))\n\nToggle.displayName = TogglePrimitive.Root.displayName\n\nexport { Toggle, toggleVariants }\n","size_bytes":1527},"server/replitAuth.ts":{"content":"import * as client from \"openid-client\";\nimport { Strategy, type VerifyFunction } from \"openid-client/passport\";\n\nimport passport from \"passport\";\nimport session from \"express-session\";\nimport type { Express, RequestHandler } from \"express\";\nimport memoize from \"memoizee\";\nimport connectPg from \"connect-pg-simple\";\nimport { storage } from \"./storage\";\n\nif (!process.env.REPLIT_DOMAINS) {\n  throw new Error(\"Environment variable REPLIT_DOMAINS not provided\");\n}\n\nconst getOidcConfig = memoize(\n  async () => {\n    return await client.discovery(\n      new URL(process.env.ISSUER_URL ?? \"https://replit.com/oidc\"),\n      process.env.REPL_ID!\n    );\n  },\n  { maxAge: 3600 * 1000 }\n);\n\nexport function getSession() {\n  const sessionTtl = 7 * 24 * 60 * 60 * 1000; // 1 week\n  const pgStore = connectPg(session);\n  const sessionStore = new pgStore({\n    conString: process.env.DATABASE_URL,\n    createTableIfMissing: false,\n    ttl: sessionTtl,\n    tableName: \"sessions\",\n  });\n  return session({\n    secret: process.env.SESSION_SECRET!,\n    store: sessionStore,\n    resave: false,\n    saveUninitialized: false,\n    cookie: {\n      httpOnly: true,\n      secure: true,\n      maxAge: sessionTtl,\n    },\n  });\n}\n\nfunction updateUserSession(\n  user: any,\n  tokens: client.TokenEndpointResponse & client.TokenEndpointResponseHelpers\n) {\n  user.claims = tokens.claims();\n  user.access_token = tokens.access_token;\n  user.refresh_token = tokens.refresh_token;\n  user.expires_at = user.claims?.exp;\n}\n\nasync function upsertUser(\n  claims: any,\n) {\n  await storage.upsertUser({\n    id: claims[\"sub\"],\n    email: claims[\"email\"],\n    firstName: claims[\"first_name\"],\n    lastName: claims[\"last_name\"],\n    profileImageUrl: claims[\"profile_image_url\"],\n  });\n}\n\nexport async function setupAuth(app: Express) {\n  app.set(\"trust proxy\", 1);\n  app.use(getSession());\n  app.use(passport.initialize());\n  app.use(passport.session());\n\n  const config = await getOidcConfig();\n\n  const verify: VerifyFunction = async (\n    tokens: client.TokenEndpointResponse & client.TokenEndpointResponseHelpers,\n    verified: passport.AuthenticateCallback\n  ) => {\n    const user = {};\n    updateUserSession(user, tokens);\n    await upsertUser(tokens.claims());\n    verified(null, user);\n  };\n\n  for (const domain of process.env\n    .REPLIT_DOMAINS!.split(\",\")) {\n    const strategy = new Strategy(\n      {\n        name: `replitauth:${domain}`,\n        config,\n        scope: \"openid email profile offline_access\",\n        callbackURL: `https://${domain}/api/callback`,\n      },\n      verify,\n    );\n    passport.use(strategy);\n  }\n\n  passport.serializeUser((user: Express.User, cb) => cb(null, user));\n  passport.deserializeUser((user: Express.User, cb) => cb(null, user));\n\n  app.get(\"/api/login\", (req, res, next) => {\n    passport.authenticate(`replitauth:${req.hostname}`, {\n      prompt: \"login consent\",\n      scope: [\"openid\", \"email\", \"profile\", \"offline_access\"],\n    })(req, res, next);\n  });\n\n  app.get(\"/api/callback\", (req, res, next) => {\n    passport.authenticate(`replitauth:${req.hostname}`, {\n      successReturnToOrRedirect: \"/\",\n      failureRedirect: \"/api/login\",\n    })(req, res, next);\n  });\n\n  app.get(\"/api/logout\", (req, res) => {\n    req.logout(() => {\n      res.redirect(\n        client.buildEndSessionUrl(config, {\n          client_id: process.env.REPL_ID!,\n          post_logout_redirect_uri: `${req.protocol}://${req.hostname}`,\n        }).href\n      );\n    });\n  });\n}\n\nexport const isAuthenticated: RequestHandler = async (req, res, next) => {\n  const user = req.user as any;\n\n  if (!req.isAuthenticated() || !user.expires_at) {\n    return res.status(401).json({ message: \"Unauthorized\" });\n  }\n\n  const now = Math.floor(Date.now() / 1000);\n  if (now <= user.expires_at) {\n    return next();\n  }\n\n  const refreshToken = user.refresh_token;\n  if (!refreshToken) {\n    res.status(401).json({ message: \"Unauthorized\" });\n    return;\n  }\n\n  try {\n    const config = await getOidcConfig();\n    const tokenResponse = await client.refreshTokenGrant(config, refreshToken);\n    updateUserSession(user, tokenResponse);\n    return next();\n  } catch (error) {\n    res.status(401).json({ message: \"Unauthorized\" });\n    return;\n  }\n};\n","size_bytes":4221},"client/src/pages/Support.tsx":{"content":"import { useState } from \"react\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { \n  HelpCircle, \n  MessageCircle, \n  Bug, \n  Lightbulb, \n  Shield, \n  CreditCard,\n  User,\n  Settings,\n  Send\n} from \"lucide-react\";\nimport { useAuth } from \"@/hooks/useAuth\";\n\nconst supportCategories = [\n  { id: \"technical\", label: \"Technical Issue\", icon: Bug, description: \"Bugs, errors, or technical problems\" },\n  { id: \"account\", label: \"Account & Profile\", icon: User, description: \"Login, profile, or account settings\" },\n  { id: \"billing\", label: \"Billing & Payments\", icon: CreditCard, description: \"Subscriptions, payments, or refunds\" },\n  { id: \"safety\", label: \"Safety & Moderation\", icon: Shield, description: \"Report inappropriate content or behavior\" },\n  { id: \"feature\", label: \"Feature Request\", icon: Lightbulb, description: \"Suggest new features or improvements\" },\n  { id: \"general\", label: \"General Support\", icon: HelpCircle, description: \"Other questions or concerns\" },\n];\n\nconst priorityLevels = [\n  { value: \"low\", label: \"Low - General question\" },\n  { value: \"medium\", label: \"Medium - Issue affecting experience\" },\n  { value: \"high\", label: \"High - Blocking issue\" },\n  { value: \"urgent\", label: \"Urgent - Security or safety concern\" },\n];\n\nexport default function Support() {\n  const { user } = useAuth();\n  const { toast } = useToast();\n  const [selectedCategory, setSelectedCategory] = useState<string>(\"\");\n  const [priority, setPriority] = useState<string>(\"medium\");\n  const [subject, setSubject] = useState(\"\");\n  const [description, setDescription] = useState(\"\");\n  const [isSubmitting, setIsSubmitting] = useState(false);\n\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault();\n    if (!selectedCategory || !subject || !description) {\n      toast({\n        title: \"Please fill in all fields\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    setIsSubmitting(true);\n    \n    try {\n      // Simulate API call - replace with actual endpoint\n      await new Promise(resolve => setTimeout(resolve, 1000));\n      \n      toast({\n        title: \"Support ticket submitted\",\n        description: \"We'll get back to you within 24 hours.\",\n      });\n      \n      // Reset form\n      setSelectedCategory(\"\");\n      setSubject(\"\");\n      setDescription(\"\");\n      setPriority(\"medium\");\n    } catch (error) {\n      toast({\n        title: \"Failed to submit ticket\",\n        description: \"Please try again later.\",\n        variant: \"destructive\",\n      });\n    } finally {\n      setIsSubmitting(false);\n    }\n  };\n\n  return (\n    <div className=\"container mx-auto p-6 max-w-4xl\">\n      <div className=\"mb-8\">\n        <div className=\"flex items-center gap-2 mb-4\">\n          <MessageCircle className=\"h-8 w-8 text-primary\" />\n          <h1 className=\"text-3xl font-bold\">Help & Support</h1>\n        </div>\n        <p className=\"text-muted-foreground text-lg\">\n          Get help with technical issues, feature requests, or general questions\n        </p>\n      </div>\n\n      <div className=\"grid gap-8 lg:grid-cols-3\">\n        {/* Quick Help Categories */}\n        <div className=\"lg:col-span-1\">\n          <h2 className=\"text-xl font-semibold mb-4\">Quick Help</h2>\n          <div className=\"space-y-3\">\n            {supportCategories.map((category) => {\n              const IconComponent = category.icon;\n              return (\n                <Card key={category.id} \n                      className={`hover:shadow-md transition-shadow cursor-pointer ${\n                        selectedCategory === category.id ? 'ring-2 ring-primary' : ''\n                      }`}\n                      onClick={() => setSelectedCategory(category.id)}\n                      data-testid={`support-category-${category.id}`}>\n                  <CardContent className=\"p-4\">\n                    <div className=\"flex items-start gap-3\">\n                      <IconComponent className=\"h-5 w-5 text-primary mt-1\" />\n                      <div>\n                        <div className=\"font-medium text-sm\">{category.label}</div>\n                        <div className=\"text-xs text-muted-foreground mt-1\">\n                          {category.description}\n                        </div>\n                      </div>\n                    </div>\n                  </CardContent>\n                </Card>\n              );\n            })}\n          </div>\n        </div>\n\n        {/* Support Ticket Form */}\n        <div className=\"lg:col-span-2\">\n          <Card>\n            <CardHeader>\n              <CardTitle>Submit a Support Ticket</CardTitle>\n              <CardDescription>\n                Provide details about your issue and we'll help you resolve it\n              </CardDescription>\n            </CardHeader>\n            <CardContent>\n              <form onSubmit={handleSubmit} className=\"space-y-6\">\n                <div>\n                  <label className=\"text-sm font-medium mb-2 block\">Category</label>\n                  <Select value={selectedCategory} onValueChange={setSelectedCategory}>\n                    <SelectTrigger data-testid=\"support-category-select\">\n                      <SelectValue placeholder=\"Select a category\" />\n                    </SelectTrigger>\n                    <SelectContent>\n                      {supportCategories.map((category) => (\n                        <SelectItem key={category.id} value={category.id}>\n                          {category.label}\n                        </SelectItem>\n                      ))}\n                    </SelectContent>\n                  </Select>\n                </div>\n\n                <div>\n                  <label className=\"text-sm font-medium mb-2 block\">Priority</label>\n                  <Select value={priority} onValueChange={setPriority}>\n                    <SelectTrigger data-testid=\"support-priority-select\">\n                      <SelectValue />\n                    </SelectTrigger>\n                    <SelectContent>\n                      {priorityLevels.map((level) => (\n                        <SelectItem key={level.value} value={level.value}>\n                          {level.label}\n                        </SelectItem>\n                      ))}\n                    </SelectContent>\n                  </Select>\n                </div>\n\n                <div>\n                  <label className=\"text-sm font-medium mb-2 block\">Subject</label>\n                  <Input\n                    value={subject}\n                    onChange={(e) => setSubject(e.target.value)}\n                    placeholder=\"Brief description of your issue\"\n                    data-testid=\"support-subject\"\n                  />\n                </div>\n\n                <div>\n                  <label className=\"text-sm font-medium mb-2 block\">Description</label>\n                  <Textarea\n                    value={description}\n                    onChange={(e) => setDescription(e.target.value)}\n                    placeholder=\"Provide detailed information about your issue, including any error messages or steps to reproduce...\"\n                    rows={6}\n                    data-testid=\"support-description\"\n                  />\n                </div>\n\n                {user && (\n                  <div className=\"bg-muted p-4 rounded-lg\">\n                    <div className=\"text-sm text-muted-foreground\">\n                      Submitting as: <span className=\"font-medium text-foreground\">\n                        {(user as any)?.username || (user as any)?.email || 'User'}\n                      </span>\n                    </div>\n                  </div>\n                )}\n\n                <Button \n                  type=\"submit\" \n                  disabled={isSubmitting}\n                  className=\"w-full\"\n                  data-testid=\"support-submit\"\n                >\n                  <Send className=\"h-4 w-4 mr-2\" />\n                  {isSubmitting ? \"Submitting...\" : \"Submit Ticket\"}\n                </Button>\n              </form>\n            </CardContent>\n          </Card>\n\n          {/* Contact Options */}\n          <Card className=\"mt-6\">\n            <CardHeader>\n              <CardTitle className=\"text-lg\">Other Ways to Get Help</CardTitle>\n            </CardHeader>\n            <CardContent className=\"space-y-4\">\n              <div className=\"flex items-center gap-3\">\n                <MessageCircle className=\"h-5 w-5 text-primary\" />\n                <div>\n                  <div className=\"font-medium\">Live Chat</div>\n                  <div className=\"text-sm text-muted-foreground\">\n                    Available 24/7 for urgent issues\n                  </div>\n                </div>\n                <Badge variant=\"outline\" className=\"ml-auto\">Coming Soon</Badge>\n              </div>\n              \n              <div className=\"flex items-center gap-3\">\n                <HelpCircle className=\"h-5 w-5 text-primary\" />\n                <div>\n                  <div className=\"font-medium\">Knowledge Base</div>\n                  <div className=\"text-sm text-muted-foreground\">\n                    Search our comprehensive wiki\n                  </div>\n                </div>\n                <Button variant=\"outline\" size=\"sm\" className=\"ml-auto\">\n                  Browse Wiki\n                </Button>\n              </div>\n            </CardContent>\n          </Card>\n        </div>\n      </div>\n    </div>\n  );\n}","size_bytes":9768},"client/src/components/ui/checkbox.tsx":{"content":"import * as React from \"react\"\nimport * as CheckboxPrimitive from \"@radix-ui/react-checkbox\"\nimport { Check } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Checkbox = React.forwardRef<\n  React.ElementRef<typeof CheckboxPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof CheckboxPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <CheckboxPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground\",\n      className\n    )}\n    {...props}\n  >\n    <CheckboxPrimitive.Indicator\n      className={cn(\"flex items-center justify-center text-current\")}\n    >\n      <Check className=\"h-4 w-4\" />\n    </CheckboxPrimitive.Indicator>\n  </CheckboxPrimitive.Root>\n))\nCheckbox.displayName = CheckboxPrimitive.Root.displayName\n\nexport { Checkbox }\n","size_bytes":1056},"client/src/pages/DMCA.tsx":{"content":"import { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { FileText, Shield, AlertCircle } from \"lucide-react\";\n\nexport default function DMCA() {\n  return (\n    <div className=\"container mx-auto p-6 max-w-4xl\">\n      <div className=\"mb-8\">\n        <div className=\"flex items-center gap-2 mb-4\">\n          <FileText className=\"h-8 w-8 text-primary\" />\n          <h1 className=\"text-3xl font-bold\">DMCA Policy</h1>\n        </div>\n        <p className=\"text-muted-foreground\">\n          Digital Millennium Copyright Act Notice and Takedown Procedure\n        </p>\n      </div>\n\n      <Card className=\"mb-6\">\n        <CardContent className=\"pt-6\">\n          <div className=\"flex items-start gap-3\">\n            <Shield className=\"h-5 w-5 text-primary mt-0.5 flex-shrink-0\" />\n            <p className=\"text-muted-foreground\">\n              We respect the intellectual property rights of others and expect our users to do the same. \n              In accordance with the Digital Millennium Copyright Act (DMCA), we will respond to valid notices \n              of alleged copyright infringement.\n            </p>\n          </div>\n        </CardContent>\n      </Card>\n\n      <div className=\"space-y-6\">\n        <Card data-testid=\"section-filing-notice\">\n          <CardHeader>\n            <CardTitle className=\"text-lg\">Filing a DMCA Notice</CardTitle>\n          </CardHeader>\n          <CardContent className=\"space-y-4\">\n            <p className=\"text-muted-foreground\">\n              If you believe that your copyrighted work has been copied in a way that constitutes copyright infringement, \n              please provide our Copyright Agent with the following information:\n            </p>\n            <ul className=\"space-y-2 text-muted-foreground\">\n              <li className=\"flex items-start gap-2\">\n                <span className=\"font-medium text-foreground\">1.</span>\n                <span>A physical or electronic signature of the copyright owner or authorized representative</span>\n              </li>\n              <li className=\"flex items-start gap-2\">\n                <span className=\"font-medium text-foreground\">2.</span>\n                <span>Identification of the copyrighted work claimed to have been infringed</span>\n              </li>\n              <li className=\"flex items-start gap-2\">\n                <span className=\"font-medium text-foreground\">3.</span>\n                <span>Identification of the material that is claimed to be infringing, with information reasonably sufficient to permit us to locate the material</span>\n              </li>\n              <li className=\"flex items-start gap-2\">\n                <span className=\"font-medium text-foreground\">4.</span>\n                <span>Your contact information, including address, telephone number, and email address</span>\n              </li>\n              <li className=\"flex items-start gap-2\">\n                <span className=\"font-medium text-foreground\">5.</span>\n                <span>A statement that you have a good faith belief that use of the material is not authorized by the copyright owner</span>\n              </li>\n              <li className=\"flex items-start gap-2\">\n                <span className=\"font-medium text-foreground\">6.</span>\n                <span>A statement, under penalty of perjury, that the information in the notification is accurate and that you are authorized to act on behalf of the copyright owner</span>\n              </li>\n            </ul>\n          </CardContent>\n        </Card>\n\n        <Card data-testid=\"section-counter-notice\">\n          <CardHeader>\n            <CardTitle className=\"text-lg\">Counter-Notification</CardTitle>\n          </CardHeader>\n          <CardContent className=\"space-y-4\">\n            <p className=\"text-muted-foreground\">\n              If you believe that your content was removed by mistake or misidentification, you may file a counter-notification containing:\n            </p>\n            <ul className=\"space-y-2 text-muted-foreground\">\n              <li className=\"flex items-start gap-2\">\n                <span className=\"font-medium text-foreground\">1.</span>\n                <span>Your physical or electronic signature</span>\n              </li>\n              <li className=\"flex items-start gap-2\">\n                <span className=\"font-medium text-foreground\">2.</span>\n                <span>Identification of the material that has been removed and the location where it appeared before removal</span>\n              </li>\n              <li className=\"flex items-start gap-2\">\n                <span className=\"font-medium text-foreground\">3.</span>\n                <span>A statement under penalty of perjury that you have a good faith belief the material was removed by mistake or misidentification</span>\n              </li>\n              <li className=\"flex items-start gap-2\">\n                <span className=\"font-medium text-foreground\">4.</span>\n                <span>Your name, address, telephone number, and a statement that you consent to jurisdiction of Federal District Court</span>\n              </li>\n            </ul>\n          </CardContent>\n        </Card>\n\n        <Card data-testid=\"section-repeat-infringers\">\n          <CardHeader>\n            <CardTitle className=\"text-lg\">Repeat Infringer Policy</CardTitle>\n          </CardHeader>\n          <CardContent>\n            <p className=\"text-muted-foreground\">\n              In accordance with the DMCA and other applicable law, we have adopted a policy of terminating, \n              in appropriate circumstances and at our sole discretion, accounts of users who are deemed to be repeat infringers. \n              We may also, at our sole discretion, limit access to the platform and/or terminate the accounts of any users \n              who infringe any intellectual property rights of others, whether or not there is any repeat infringement.\n            </p>\n          </CardContent>\n        </Card>\n\n        <Card data-testid=\"section-false-claims\">\n          <CardHeader>\n            <CardTitle className=\"text-lg\">\n              <div className=\"flex items-center gap-2\">\n                <AlertCircle className=\"h-5 w-5 text-orange-500\" />\n                False Claims Warning\n              </div>\n            </CardTitle>\n          </CardHeader>\n          <CardContent>\n            <p className=\"text-muted-foreground\">\n              Please be aware that under Section 512(f) of the DMCA, any person who knowingly materially misrepresents \n              that material or activity is infringing, or that material or activity was removed or disabled by mistake or \n              misidentification, may be subject to liability. We reserve the right to seek damages from any party that \n              submits a notification or counter-notification in violation of the law.\n            </p>\n          </CardContent>\n        </Card>\n\n        <Card data-testid=\"section-contact\">\n          <CardHeader>\n            <CardTitle className=\"text-lg\">Copyright Agent Contact</CardTitle>\n          </CardHeader>\n          <CardContent className=\"space-y-4\">\n            <p className=\"text-muted-foreground\">\n              All DMCA notices and counter-notifications should be sent to our designated Copyright Agent:\n            </p>\n            <div className=\"bg-muted p-4 rounded-lg\">\n              <div className=\"space-y-2 text-sm\">\n                <p><span className=\"font-medium\">Email:</span> dmca@platform.com</p>\n                <p><span className=\"font-medium\">Subject Line:</span> DMCA Notice or DMCA Counter-Notice</p>\n              </div>\n            </div>\n            <Button className=\"w-full\" data-testid=\"button-contact-agent\">\n              Contact Copyright Agent\n            </Button>\n          </CardContent>\n        </Card>\n      </div>\n    </div>\n  );\n}\n","size_bytes":7881},"client/src/components/auth/AuthModal.tsx":{"content":"import { useState } from \"react\";\nimport { useMutation } from \"@tanstack/react-query\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogDescription,\n  DialogHeader,\n  DialogTitle,\n} from \"@/components/ui/dialog\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Checkbox } from \"@/components/ui/checkbox\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Loader2, PawPrint, Shield, Eye, EyeOff } from \"lucide-react\";\n\ninterface AuthModalProps {\n  isOpen: boolean;\n  onClose: () => void;\n  mode: 'login' | 'register';\n  onModeChange: (mode: 'login' | 'register') => void;\n}\n\nexport default function AuthModal({ isOpen, onClose, mode, onModeChange }: AuthModalProps) {\n  const { toast } = useToast();\n  const [showPassword, setShowPassword] = useState(false);\n  const [formData, setFormData] = useState({\n    username: '',\n    email: '',\n    password: '',\n    confirmPassword: '',\n    agreeTerms: false,\n    ageVerified: false,\n  });\n\n  const loginMutation = useMutation({\n    mutationFn: async (data: { email: string; password: string }) => {\n      const response = await apiRequest('POST', '/api/auth/login', data);\n      return response.json();\n    },\n    onSuccess: (data) => {\n      localStorage.setItem('auth_token', data.token);\n      toast({\n        title: \"Welcome back!\",\n        description: \"Successfully logged in to your pack.\",\n      });\n      window.location.reload(); // Refresh to update auth state\n    },\n    onError: (error) => {\n      toast({\n        title: \"Login Failed\",\n        description: \"Invalid email or password. Please try again.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const registerMutation = useMutation({\n    mutationFn: async (data: { username: string; email: string; password: string }) => {\n      const response = await apiRequest('POST', '/api/auth/register', data);\n      if (!response.ok) {\n        const errorData = await response.json();\n        throw { status: response.status, ...errorData };\n      }\n      return response.json();\n    },\n    onSuccess: (data) => {\n      localStorage.setItem('auth_token', data.token);\n      toast({\n        title: \"Welcome to the pack!\",\n        description: \"Account created successfully. Please complete age verification.\",\n      });\n      window.location.reload(); // Refresh to update auth state\n    },\n    onError: (error: any) => {\n      let title = \"Registration Failed\";\n      let description = \"Failed to create account. Please try again.\";\n      \n      if (error?.status === 409) {\n        if (error?.field === 'email') {\n          title = \"Email Already Registered\";\n          description = \"This email is already registered. Please use a different email or try logging in.\";\n        } else if (error?.field === 'username') {\n          title = \"Username Taken\";\n          description = \"This username is already taken. Please choose a different username.\";\n        }\n      } else if (error?.message) {\n        description = error.message;\n      }\n      \n      toast({\n        title,\n        description,\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const handleInputChange = (field: string, value: any) => {\n    setFormData(prev => ({ ...prev, [field]: value }));\n  };\n\n  const handleLogin = (e: React.FormEvent) => {\n    e.preventDefault();\n    if (!formData.email || !formData.password) {\n      toast({\n        title: \"Missing Information\",\n        description: \"Please fill in all fields.\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n    loginMutation.mutate({\n      email: formData.email,\n      password: formData.password,\n    });\n  };\n\n  const handleRegister = (e: React.FormEvent) => {\n    e.preventDefault();\n    \n    // Validation\n    if (!formData.username || !formData.email || !formData.password) {\n      toast({\n        title: \"Missing Information\",\n        description: \"Please fill in all fields.\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    if (formData.password !== formData.confirmPassword) {\n      toast({\n        title: \"Password Mismatch\",\n        description: \"Passwords do not match.\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    if (formData.password.length < 8) {\n      toast({\n        title: \"Weak Password\",\n        description: \"Password must be at least 8 characters long.\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    if (!formData.agreeTerms) {\n      toast({\n        title: \"Terms Required\",\n        description: \"You must agree to the terms of service.\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    if (!formData.ageVerified) {\n      toast({\n        title: \"Age Verification Required\",\n        description: \"You must confirm you are 18 or older.\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    registerMutation.mutate({\n      username: formData.username,\n      email: formData.email,\n      password: formData.password,\n    });\n  };\n\n  const handleReplitAuth = () => {\n    window.location.href = '/api/login';\n  };\n\n  return (\n    <Dialog open={isOpen} onOpenChange={onClose}>\n      <DialogContent className=\"sm:max-w-md bg-card border border-border\">\n        <DialogHeader>\n          <DialogTitle className=\"text-center font-display\">\n            {mode === 'login' ? 'Welcome Back to Your Pack' : 'Join the Pack'}\n          </DialogTitle>\n          <DialogDescription className=\"text-center\">\n            {mode === 'login' \n              ? 'Sign in to continue your pack journey'\n              : 'Create your account and start connecting with the community'\n            }\n          </DialogDescription>\n        </DialogHeader>\n\n        <Tabs value={mode} onValueChange={(value) => onModeChange(value as 'login' | 'register')}>\n          <TabsList className=\"grid w-full grid-cols-2 bg-background\">\n            <TabsTrigger \n              value=\"login\" \n              className=\"data-[state=active]:bg-primary data-[state=active]:text-primary-foreground\"\n              data-testid=\"tab-login\"\n            >\n              Sign In\n            </TabsTrigger>\n            <TabsTrigger \n              value=\"register\"\n              className=\"data-[state=active]:bg-primary data-[state=active]:text-primary-foreground\"\n              data-testid=\"tab-register\"\n            >\n              Join Pack\n            </TabsTrigger>\n          </TabsList>\n\n          <TabsContent value=\"login\" className=\"space-y-4\">\n            <form onSubmit={handleLogin} className=\"space-y-4\">\n              <div>\n                <Label htmlFor=\"login-email\">Email</Label>\n                <Input\n                  id=\"login-email\"\n                  type=\"email\"\n                  placeholder=\"pup@example.com\"\n                  value={formData.email}\n                  onChange={(e) => handleInputChange('email', e.target.value)}\n                  className=\"form-input\"\n                  data-testid=\"input-login-email\"\n                />\n              </div>\n\n              <div>\n                <Label htmlFor=\"login-password\">Password</Label>\n                <div className=\"relative\">\n                  <Input\n                    id=\"login-password\"\n                    type={showPassword ? \"text\" : \"password\"}\n                    placeholder=\"â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢\"\n                    value={formData.password}\n                    onChange={(e) => handleInputChange('password', e.target.value)}\n                    className=\"form-input pr-10\"\n                    data-testid=\"input-login-password\"\n                  />\n                  <Button\n                    type=\"button\"\n                    variant=\"ghost\"\n                    size=\"sm\"\n                    className=\"absolute right-2 top-1/2 transform -translate-y-1/2 p-1\"\n                    onClick={() => setShowPassword(!showPassword)}\n                    data-testid=\"button-toggle-password\"\n                  >\n                    {showPassword ? <EyeOff className=\"h-4 w-4\" /> : <Eye className=\"h-4 w-4\" />}\n                  </Button>\n                </div>\n              </div>\n\n              <Button \n                type=\"submit\" \n                className=\"w-full btn-primary\"\n                disabled={loginMutation.isPending}\n                data-testid=\"button-login-submit\"\n              >\n                {loginMutation.isPending ? (\n                  <>\n                    <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />\n                    Signing In...\n                  </>\n                ) : (\n                  'Sign In'\n                )}\n              </Button>\n            </form>\n\n            <div className=\"text-center\">\n              <Button variant=\"link\" className=\"text-sm\" data-testid=\"button-forgot-password\">\n                Forgot your password?\n              </Button>\n            </div>\n          </TabsContent>\n\n          <TabsContent value=\"register\" className=\"space-y-4\">\n            <form onSubmit={handleRegister} className=\"space-y-4\">\n              <div>\n                <Label htmlFor=\"register-username\">Pack Name</Label>\n                <Input\n                  id=\"register-username\"\n                  type=\"text\"\n                  placeholder=\"YourPackName\"\n                  value={formData.username}\n                  onChange={(e) => handleInputChange('username', e.target.value)}\n                  className=\"form-input\"\n                  data-testid=\"input-register-username\"\n                />\n              </div>\n\n              <div>\n                <Label htmlFor=\"register-email\">Email</Label>\n                <Input\n                  id=\"register-email\"\n                  type=\"email\"\n                  placeholder=\"pup@example.com\"\n                  value={formData.email}\n                  onChange={(e) => handleInputChange('email', e.target.value)}\n                  className=\"form-input\"\n                  data-testid=\"input-register-email\"\n                />\n              </div>\n\n              <div>\n                <Label htmlFor=\"register-password\">Password</Label>\n                <div className=\"relative\">\n                  <Input\n                    id=\"register-password\"\n                    type={showPassword ? \"text\" : \"password\"}\n                    placeholder=\"â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢\"\n                    value={formData.password}\n                    onChange={(e) => handleInputChange('password', e.target.value)}\n                    className=\"form-input pr-10\"\n                    data-testid=\"input-register-password\"\n                  />\n                  <Button\n                    type=\"button\"\n                    variant=\"ghost\"\n                    size=\"sm\"\n                    className=\"absolute right-2 top-1/2 transform -translate-y-1/2 p-1\"\n                    onClick={() => setShowPassword(!showPassword)}\n                  >\n                    {showPassword ? <EyeOff className=\"h-4 w-4\" /> : <Eye className=\"h-4 w-4\" />}\n                  </Button>\n                </div>\n              </div>\n\n              <div>\n                <Label htmlFor=\"register-confirm-password\">Confirm Password</Label>\n                <Input\n                  id=\"register-confirm-password\"\n                  type={showPassword ? \"text\" : \"password\"}\n                  placeholder=\"â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢\"\n                  value={formData.confirmPassword}\n                  onChange={(e) => handleInputChange('confirmPassword', e.target.value)}\n                  className=\"form-input\"\n                  data-testid=\"input-register-confirm-password\"\n                />\n              </div>\n\n              {/* Age Verification Notice */}\n              <div className=\"flex items-center space-x-3 p-4 bg-warning/10 border border-warning/20 rounded-lg\">\n                <Shield className=\"h-5 w-5 text-warning flex-shrink-0\" />\n                <div className=\"text-sm\">\n                  <span className=\"font-medium\">18+ Verification Required</span>\n                  <p className=\"text-muted\">You'll need to upload valid ID after registration</p>\n                </div>\n              </div>\n\n              {/* Terms and Age Checkboxes */}\n              <div className=\"space-y-3\">\n                <div className=\"flex items-start space-x-2\">\n                  <Checkbox\n                    id=\"age-verify\"\n                    checked={formData.ageVerified}\n                    onCheckedChange={(checked) => handleInputChange('ageVerified', checked)}\n                    data-testid=\"checkbox-age-verified\"\n                  />\n                  <Label htmlFor=\"age-verify\" className=\"text-sm\">\n                    I confirm that I am 18 years of age or older\n                  </Label>\n                </div>\n\n                <div className=\"flex items-start space-x-2\">\n                  <Checkbox\n                    id=\"agree-terms\"\n                    checked={formData.agreeTerms}\n                    onCheckedChange={(checked) => handleInputChange('agreeTerms', checked)}\n                    data-testid=\"checkbox-agree-terms\"\n                  />\n                  <Label htmlFor=\"agree-terms\" className=\"text-sm\">\n                    I agree to the{' '}\n                    <a href=\"/terms\" className=\"text-primary hover:underline\">Terms of Service</a>\n                    {' '}and{' '}\n                    <a href=\"/privacy\" className=\"text-primary hover:underline\">Privacy Policy</a>\n                  </Label>\n                </div>\n              </div>\n\n              <Button \n                type=\"submit\" \n                className=\"w-full btn-primary\"\n                disabled={registerMutation.isPending}\n                data-testid=\"button-register-submit\"\n              >\n                {registerMutation.isPending ? (\n                  <>\n                    <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />\n                    Creating Account...\n                  </>\n                ) : (\n                  'Join the Pack'\n                )}\n              </Button>\n            </form>\n          </TabsContent>\n        </Tabs>\n\n        {/* Replit OAuth Alternative */}\n        <div className=\"mt-6 pt-6 border-t border-border\">\n          <Button \n            variant=\"outline\"\n            className=\"w-full btn-secondary\"\n            onClick={handleReplitAuth}\n            data-testid=\"button-replit-oauth\"\n          >\n            <PawPrint className=\"mr-3 h-5 w-5\" />\n            Continue with Replit\n          </Button>\n        </div>\n      </DialogContent>\n    </Dialog>\n  );\n}\n","size_bytes":14708},"client/src/components/ui/resizable.tsx":{"content":"\"use client\"\n\nimport { GripVertical } from \"lucide-react\"\nimport * as ResizablePrimitive from \"react-resizable-panels\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ResizablePanelGroup = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof ResizablePrimitive.PanelGroup>) => (\n  <ResizablePrimitive.PanelGroup\n    className={cn(\n      \"flex h-full w-full data-[panel-group-direction=vertical]:flex-col\",\n      className\n    )}\n    {...props}\n  />\n)\n\nconst ResizablePanel = ResizablePrimitive.Panel\n\nconst ResizableHandle = ({\n  withHandle,\n  className,\n  ...props\n}: React.ComponentProps<typeof ResizablePrimitive.PanelResizeHandle> & {\n  withHandle?: boolean\n}) => (\n  <ResizablePrimitive.PanelResizeHandle\n    className={cn(\n      \"relative flex w-px items-center justify-center bg-border after:absolute after:inset-y-0 after:left-1/2 after:w-1 after:-translate-x-1/2 focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring focus-visible:ring-offset-1 data-[panel-group-direction=vertical]:h-px data-[panel-group-direction=vertical]:w-full data-[panel-group-direction=vertical]:after:left-0 data-[panel-group-direction=vertical]:after:h-1 data-[panel-group-direction=vertical]:after:w-full data-[panel-group-direction=vertical]:after:-translate-y-1/2 data-[panel-group-direction=vertical]:after:translate-x-0 [&[data-panel-group-direction=vertical]>div]:rotate-90\",\n      className\n    )}\n    {...props}\n  >\n    {withHandle && (\n      <div className=\"z-10 flex h-4 w-3 items-center justify-center rounded-sm border bg-border\">\n        <GripVertical className=\"h-2.5 w-2.5\" />\n      </div>\n    )}\n  </ResizablePrimitive.PanelResizeHandle>\n)\n\nexport { ResizablePanelGroup, ResizablePanel, ResizableHandle }\n","size_bytes":1723},"client/src/pages/Report.tsx":{"content":"import { useState } from \"react\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { \n  AlertTriangle, \n  Shield,\n  FileText,\n  User,\n  Image,\n  MessageCircle\n} from \"lucide-react\";\n\nconst reportCategories = [\n  { value: \"harassment\", label: \"Harassment or Bullying\", icon: User },\n  { value: \"illegal\", label: \"Illegal Content\", icon: AlertTriangle },\n  { value: \"copyright\", label: \"Copyright Infringement\", icon: FileText },\n  { value: \"spam\", label: \"Spam or Scam\", icon: MessageCircle },\n  { value: \"inappropriate\", label: \"Inappropriate Content\", icon: Image },\n  { value: \"other\", label: \"Other Violation\", icon: Shield },\n];\n\nexport default function Report() {\n  const { toast } = useToast();\n  const [category, setCategory] = useState(\"\");\n  const [contentUrl, setContentUrl] = useState(\"\");\n  const [description, setDescription] = useState(\"\");\n  const [isSubmitting, setIsSubmitting] = useState(false);\n\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault();\n    \n    if (!category || !description) {\n      toast({\n        title: \"Please fill in all required fields\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    setIsSubmitting(true);\n\n    try {\n      await new Promise(resolve => setTimeout(resolve, 1000));\n      \n      toast({\n        title: \"Report submitted successfully\",\n        description: \"Our moderation team will review your report within 24 hours.\",\n      });\n      \n      setCategory(\"\");\n      setContentUrl(\"\");\n      setDescription(\"\");\n    } catch (error) {\n      toast({\n        title: \"Failed to submit report\",\n        description: \"Please try again later.\",\n        variant: \"destructive\",\n      });\n    } finally {\n      setIsSubmitting(false);\n    }\n  };\n\n  return (\n    <div className=\"container mx-auto p-6 max-w-4xl\">\n      <div className=\"mb-8\">\n        <div className=\"flex items-center gap-2 mb-4\">\n          <AlertTriangle className=\"h-8 w-8 text-primary\" />\n          <h1 className=\"text-3xl font-bold\">Report Abuse</h1>\n        </div>\n        <p className=\"text-muted-foreground text-lg\">\n          Help us maintain a safe community by reporting violations of our guidelines\n        </p>\n      </div>\n\n      <div className=\"grid gap-8 lg:grid-cols-3\">\n        <div className=\"lg:col-span-2\">\n          <Card>\n            <CardHeader>\n              <CardTitle>Submit a Report</CardTitle>\n              <CardDescription>\n                Provide as much detail as possible to help us investigate\n              </CardDescription>\n            </CardHeader>\n            <CardContent>\n              <form onSubmit={handleSubmit} className=\"space-y-6\">\n                <div>\n                  <label className=\"text-sm font-medium mb-2 block\">Violation Type *</label>\n                  <Select value={category} onValueChange={setCategory}>\n                    <SelectTrigger data-testid=\"select-report-category\">\n                      <SelectValue placeholder=\"Select a violation type\" />\n                    </SelectTrigger>\n                    <SelectContent>\n                      {reportCategories.map((cat) => (\n                        <SelectItem key={cat.value} value={cat.value}>\n                          {cat.label}\n                        </SelectItem>\n                      ))}\n                    </SelectContent>\n                  </Select>\n                </div>\n\n                <div>\n                  <label className=\"text-sm font-medium mb-2 block\">Content URL (Optional)</label>\n                  <Input\n                    value={contentUrl}\n                    onChange={(e) => setContentUrl(e.target.value)}\n                    placeholder=\"https://example.com/content/...\"\n                    data-testid=\"input-content-url\"\n                  />\n                  <p className=\"text-xs text-muted-foreground mt-2\">\n                    If reporting specific content, paste the URL here\n                  </p>\n                </div>\n\n                <div>\n                  <label className=\"text-sm font-medium mb-2 block\">Description *</label>\n                  <Textarea\n                    value={description}\n                    onChange={(e) => setDescription(e.target.value)}\n                    placeholder=\"Provide detailed information about the violation, including what happened, when it occurred, and any other relevant context...\"\n                    rows={8}\n                    data-testid=\"textarea-description\"\n                  />\n                </div>\n\n                <div className=\"bg-muted p-4 rounded-lg\">\n                  <div className=\"flex items-start gap-3\">\n                    <Shield className=\"h-5 w-5 text-primary mt-0.5 flex-shrink-0\" />\n                    <div className=\"text-sm\">\n                      <div className=\"font-medium mb-1\">Anonymous Reporting</div>\n                      <div className=\"text-muted-foreground\">\n                        Your report will be reviewed confidentially. The reported user will not know who submitted the report.\n                      </div>\n                    </div>\n                  </div>\n                </div>\n\n                <Button \n                  type=\"submit\" \n                  disabled={isSubmitting}\n                  className=\"w-full\"\n                  data-testid=\"button-submit-report\"\n                >\n                  {isSubmitting ? \"Submitting...\" : \"Submit Report\"}\n                </Button>\n              </form>\n            </CardContent>\n          </Card>\n        </div>\n\n        <div className=\"lg:col-span-1\">\n          <Card>\n            <CardHeader>\n              <CardTitle className=\"text-lg\">What Happens Next?</CardTitle>\n            </CardHeader>\n            <CardContent className=\"space-y-4\">\n              <div>\n                <div className=\"font-medium mb-1\">1. Review</div>\n                <p className=\"text-sm text-muted-foreground\">\n                  Our moderation team reviews your report within 24 hours\n                </p>\n              </div>\n              <div>\n                <div className=\"font-medium mb-1\">2. Investigation</div>\n                <p className=\"text-sm text-muted-foreground\">\n                  We thoroughly investigate the reported content or behavior\n                </p>\n              </div>\n              <div>\n                <div className=\"font-medium mb-1\">3. Action</div>\n                <p className=\"text-sm text-muted-foreground\">\n                  Appropriate action is taken based on our guidelines\n                </p>\n              </div>\n              <div>\n                <div className=\"font-medium mb-1\">4. Follow-up</div>\n                <p className=\"text-sm text-muted-foreground\">\n                  You'll receive an update on the outcome of your report\n                </p>\n              </div>\n            </CardContent>\n          </Card>\n\n          <Card className=\"mt-4\">\n            <CardHeader>\n              <CardTitle className=\"text-lg\">Emergency?</CardTitle>\n            </CardHeader>\n            <CardContent>\n              <p className=\"text-sm text-muted-foreground mb-3\">\n                If you or someone else is in immediate danger, contact local law enforcement immediately.\n              </p>\n              <Button variant=\"destructive\" className=\"w-full\" data-testid=\"button-emergency\">\n                Emergency Resources\n              </Button>\n            </CardContent>\n          </Card>\n        </div>\n      </div>\n    </div>\n  );\n}\n","size_bytes":7801},"client/src/components/ui/drawer.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport { Drawer as DrawerPrimitive } from \"vaul\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Drawer = ({\n  shouldScaleBackground = true,\n  ...props\n}: React.ComponentProps<typeof DrawerPrimitive.Root>) => (\n  <DrawerPrimitive.Root\n    shouldScaleBackground={shouldScaleBackground}\n    {...props}\n  />\n)\nDrawer.displayName = \"Drawer\"\n\nconst DrawerTrigger = DrawerPrimitive.Trigger\n\nconst DrawerPortal = DrawerPrimitive.Portal\n\nconst DrawerClose = DrawerPrimitive.Close\n\nconst DrawerOverlay = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Overlay\n    ref={ref}\n    className={cn(\"fixed inset-0 z-50 bg-black/80\", className)}\n    {...props}\n  />\n))\nDrawerOverlay.displayName = DrawerPrimitive.Overlay.displayName\n\nconst DrawerContent = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <DrawerPortal>\n    <DrawerOverlay />\n    <DrawerPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed inset-x-0 bottom-0 z-50 mt-24 flex h-auto flex-col rounded-t-[10px] border bg-background\",\n        className\n      )}\n      {...props}\n    >\n      <div className=\"mx-auto mt-4 h-2 w-[100px] rounded-full bg-muted\" />\n      {children}\n    </DrawerPrimitive.Content>\n  </DrawerPortal>\n))\nDrawerContent.displayName = \"DrawerContent\"\n\nconst DrawerHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\"grid gap-1.5 p-4 text-center sm:text-left\", className)}\n    {...props}\n  />\n)\nDrawerHeader.displayName = \"DrawerHeader\"\n\nconst DrawerFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\"mt-auto flex flex-col gap-2 p-4\", className)}\n    {...props}\n  />\n)\nDrawerFooter.displayName = \"DrawerFooter\"\n\nconst DrawerTitle = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Title\n    ref={ref}\n    className={cn(\n      \"text-lg font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nDrawerTitle.displayName = DrawerPrimitive.Title.displayName\n\nconst DrawerDescription = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nDrawerDescription.displayName = DrawerPrimitive.Description.displayName\n\nexport {\n  Drawer,\n  DrawerPortal,\n  DrawerOverlay,\n  DrawerTrigger,\n  DrawerClose,\n  DrawerContent,\n  DrawerHeader,\n  DrawerFooter,\n  DrawerTitle,\n  DrawerDescription,\n}\n","size_bytes":3021},"client/src/components/ui/button.tsx":{"content":"import * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst buttonVariants = cva(\n  \"inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-primary text-primary-foreground hover:bg-primary/90\",\n        destructive:\n          \"bg-destructive text-destructive-foreground hover:bg-destructive/90\",\n        outline:\n          \"border border-input bg-background hover:bg-accent hover:text-accent-foreground\",\n        secondary:\n          \"bg-secondary text-secondary-foreground hover:bg-secondary/80\",\n        ghost: \"hover:bg-accent hover:text-accent-foreground\",\n        link: \"text-primary underline-offset-4 hover:underline\",\n      },\n      size: {\n        default: \"h-10 px-4 py-2\",\n        sm: \"h-9 rounded-md px-3\",\n        lg: \"h-11 rounded-md px-8\",\n        icon: \"h-10 w-10\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n)\n\nexport interface ButtonProps\n  extends React.ButtonHTMLAttributes<HTMLButtonElement>,\n    VariantProps<typeof buttonVariants> {\n  asChild?: boolean\n}\n\nconst Button = React.forwardRef<HTMLButtonElement, ButtonProps>(\n  ({ className, variant, size, asChild = false, ...props }, ref) => {\n    const Comp = asChild ? Slot : \"button\"\n    return (\n      <Comp\n        className={cn(buttonVariants({ variant, size, className }))}\n        ref={ref}\n        {...props}\n      />\n    )\n  }\n)\nButton.displayName = \"Button\"\n\nexport { Button, buttonVariants }\n","size_bytes":1901},"client/src/components/ui/switch.tsx":{"content":"import * as React from \"react\"\nimport * as SwitchPrimitives from \"@radix-ui/react-switch\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Switch = React.forwardRef<\n  React.ElementRef<typeof SwitchPrimitives.Root>,\n  React.ComponentPropsWithoutRef<typeof SwitchPrimitives.Root>\n>(({ className, ...props }, ref) => (\n  <SwitchPrimitives.Root\n    className={cn(\n      \"peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  >\n    <SwitchPrimitives.Thumb\n      className={cn(\n        \"pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0\"\n      )}\n    />\n  </SwitchPrimitives.Root>\n))\nSwitch.displayName = SwitchPrimitives.Root.displayName\n\nexport { Switch }\n","size_bytes":1139},"client/src/components/ui/alert.tsx":{"content":"import * as React from \"react\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst alertVariants = cva(\n  \"relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-background text-foreground\",\n        destructive:\n          \"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nconst Alert = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement> & VariantProps<typeof alertVariants>\n>(({ className, variant, ...props }, ref) => (\n  <div\n    ref={ref}\n    role=\"alert\"\n    className={cn(alertVariants({ variant }), className)}\n    {...props}\n  />\n))\nAlert.displayName = \"Alert\"\n\nconst AlertTitle = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLHeadingElement>\n>(({ className, ...props }, ref) => (\n  <h5\n    ref={ref}\n    className={cn(\"mb-1 font-medium leading-none tracking-tight\", className)}\n    {...props}\n  />\n))\nAlertTitle.displayName = \"AlertTitle\"\n\nconst AlertDescription = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"text-sm [&_p]:leading-relaxed\", className)}\n    {...props}\n  />\n))\nAlertDescription.displayName = \"AlertDescription\"\n\nexport { Alert, AlertTitle, AlertDescription }\n","size_bytes":1584},"drizzle.config.ts":{"content":"import { defineConfig } from \"drizzle-kit\";\n\nif (!process.env.DATABASE_URL) {\n  throw new Error(\"DATABASE_URL, ensure the database is provisioned\");\n}\n\nexport default defineConfig({\n  out: \"./migrations\",\n  schema: \"./shared/schema.ts\",\n  dialect: \"postgresql\",\n  dbCredentials: {\n    url: process.env.DATABASE_URL,\n  },\n});\n","size_bytes":325},"client/src/components/feed/FanzInfinityScrollFeed.tsx":{"content":"import { useEffect, useState, useRef } from \"react\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { useAuth } from \"@/hooks/useAuth\";\nimport { Card, CardContent } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Avatar, AvatarImage, AvatarFallback } from \"@/components/ui/avatar\";\nimport { LoaderCircle, Heart, MessageCircle, Share2, Lock, Eye, DollarSign } from \"lucide-react\";\nimport { Link } from \"wouter\";\n\nconst POSTS_PER_PAGE = 12;\nconst AD_FREQUENCY = 4;\n\ninterface FeedPost {\n  id: string;\n  creatorUserId: string;\n  creatorName: string;\n  creatorAvatar: string;\n  creatorIsAgeVerified: boolean;\n  creatorAllowsFree: boolean;\n  title: string;\n  caption: string;\n  visibility: 'public' | 'subscribers' | 'ppv';\n  priceCents: number;\n  mediaUrl?: string;\n  mediaType?: string;\n  isSubscribed: boolean;\n  isFree: boolean;\n  tags: string[];\n  likeCount: number;\n  commentCount: number;\n  createdAt: string;\n}\n\nexport default function FanzInfinityScrollFeed() {\n  const { user } = useAuth();\n  const [page, setPage] = useState(1);\n  const [allPosts, setAllPosts] = useState<FeedPost[]>([]);\n  const [hasMore, setHasMore] = useState(true);\n  const loader = useRef<HTMLDivElement>(null);\n\n  // Reset feed when user changes\n  useEffect(() => {\n    setPage(1);\n    setAllPosts([]);\n    setHasMore(true);\n  }, [(user as any)?.id]);\n\n  const { data, isLoading, isFetching } = useQuery<FeedPost[]>({\n    queryKey: ['/api/feed', page],\n    queryFn: async () => {\n      const response = await fetch(`/api/feed?page=${page}&limit=${POSTS_PER_PAGE}`);\n      if (!response.ok) throw new Error('Failed to fetch feed');\n      return response.json();\n    },\n    enabled: page > 0 && hasMore,\n  });\n\n  useEffect(() => {\n    if (data) {\n      // Check if this is the last page\n      if (data.length < POSTS_PER_PAGE) {\n        setHasMore(false);\n      }\n      \n      // Deduplicate posts by ID\n      setAllPosts(prev => {\n        if (page === 1) return data;\n        const existingIds = new Set(prev.map(p => p.id));\n        const newPosts = data.filter(p => !existingIds.has(p.id));\n        return [...prev, ...newPosts];\n      });\n    }\n  }, [data, page]);\n\n  useEffect(() => {\n    const observer = new IntersectionObserver(\n      (entries) => {\n        if (entries[0].isIntersecting && !isFetching && hasMore && data && data.length > 0) {\n          setPage(prev => prev + 1);\n        }\n      },\n      { threshold: 1.0 }\n    );\n    \n    if (loader.current) {\n      observer.observe(loader.current);\n    }\n    \n    return () => {\n      if (loader.current) {\n        observer.unobserve(loader.current);\n      }\n    };\n  }, [isFetching, hasMore, data]);\n\n  const renderPost = (post: FeedPost, index: number) => {\n    const canView = post.isFree || post.isSubscribed || post.visibility === 'public';\n    const isBlurred = !canView || (post.creatorAllowsFree && !post.creatorIsAgeVerified);\n\n    return (\n      <>\n        <Card key={post.id} className=\"pack-card overflow-hidden hover:shadow-xl transition-shadow duration-300\" data-testid={`feed-post-${post.id}`}>\n          <CardContent className=\"p-0\">\n            {/* Creator Header */}\n            <div className=\"p-4 flex items-center gap-3\">\n              <Link href={`/profile/${post.creatorUserId}`}>\n                <Avatar className=\"h-10 w-10 cursor-pointer\">\n                  <AvatarImage src={post.creatorAvatar} alt={post.creatorName} />\n                  <AvatarFallback>{post.creatorName[0]}</AvatarFallback>\n                </Avatar>\n              </Link>\n              <div className=\"flex-1\">\n                <Link href={`/profile/${post.creatorUserId}`}>\n                  <div className=\"flex items-center gap-2\">\n                    <h3 className=\"font-semibold hover:text-primary cursor-pointer\" data-testid={`creator-name-${post.id}`}>\n                      {post.creatorName}\n                    </h3>\n                    {(post as any).packName && (\n                      <Badge variant=\"outline\" className=\"text-xs\" data-testid={`pack-badge-${post.id}`}>\n                        {(post as any).packName}\n                      </Badge>\n                    )}\n                  </div>\n                </Link>\n                <p className=\"text-xs text-muted-foreground\">\n                  {new Date(post.createdAt).toLocaleDateString()}\n                </p>\n              </div>\n              {post.visibility === 'ppv' && (\n                <Badge className=\"safety-badge safety-badge-aftercare\" data-testid={`badge-ppv-${post.id}`}>\n                  <DollarSign className=\"h-3 w-3 mr-1\" />\n                  ${(post.priceCents / 100).toFixed(2)}\n                </Badge>\n              )}\n            </div>\n\n            {/* Title and Caption */}\n            {post.title && (\n              <div className=\"px-4 pb-2\">\n                <h4 className=\"font-medium text-lg\" data-testid={`post-title-${post.id}`}>{post.title}</h4>\n              </div>\n            )}\n            {post.caption && (\n              <div className=\"px-4 pb-3\">\n                <p className=\"text-sm text-foreground/80\" data-testid={`post-caption-${post.id}`}>{post.caption}</p>\n              </div>\n            )}\n\n            {/* Media Content */}\n            {post.mediaUrl && (\n              <div className=\"relative\">\n                {canView && !isBlurred ? (\n                  post.mediaType?.startsWith('video') ? (\n                    <video \n                      controls \n                      className=\"w-full max-h-[500px] object-cover bg-black\"\n                      data-testid={`post-video-${post.id}`}\n                    >\n                      <source src={post.mediaUrl} type={post.mediaType} />\n                    </video>\n                  ) : (\n                    <img \n                      src={post.mediaUrl} \n                      alt={post.title} \n                      className=\"w-full max-h-[500px] object-cover\"\n                      data-testid={`post-image-${post.id}`}\n                    />\n                  )\n                ) : (\n                  <div className=\"w-full h-64 bg-moonyard flex flex-col items-center justify-center text-muted-foreground border-y border-border/50\">\n                    <Lock className=\"h-12 w-12 mb-3 opacity-50\" />\n                    <p className=\"text-sm font-medium\" data-testid={`post-locked-${post.id}`}>\n                      {!post.creatorIsAgeVerified && post.creatorAllowsFree\n                        ? \"Pending Age Verification via VerifyMy\"\n                        : post.visibility === 'ppv'\n                        ? `Unlock for $${(post.priceCents / 100).toFixed(2)}`\n                        : \"Subscribe to View\"}\n                    </p>\n                  </div>\n                )}\n              </div>\n            )}\n\n            {/* Tags */}\n            {post.tags && post.tags.length > 0 && (\n              <div className=\"px-4 py-2 flex gap-2 flex-wrap\">\n                {post.tags.map((tag, i) => (\n                  <Badge key={i} variant=\"outline\" className=\"text-xs\" data-testid={`tag-${tag}-${post.id}`}>\n                    #{tag}\n                  </Badge>\n                ))}\n              </div>\n            )}\n\n            {/* Actions */}\n            <div className=\"px-4 py-3 flex items-center gap-4 border-t border-border/50\">\n              <Button variant=\"ghost\" size=\"sm\" className=\"gap-2\" data-testid={`button-like-${post.id}`}>\n                <Heart className=\"h-4 w-4\" />\n                <span className=\"text-sm\">{post.likeCount || 0}</span>\n              </Button>\n              <Button variant=\"ghost\" size=\"sm\" className=\"gap-2\" data-testid={`button-comment-${post.id}`}>\n                <MessageCircle className=\"h-4 w-4\" />\n                <span className=\"text-sm\">{post.commentCount || 0}</span>\n              </Button>\n              <Button variant=\"ghost\" size=\"sm\" className=\"gap-2\" data-testid={`button-share-${post.id}`}>\n                <Share2 className=\"h-4 w-4\" />\n              </Button>\n              {!canView && (\n                <Button \n                  size=\"sm\" \n                  className=\"ml-auto btn-primary\"\n                  data-testid={`button-unlock-${post.id}`}\n                >\n                  {post.visibility === 'ppv' ? 'Unlock' : 'Subscribe'}\n                </Button>\n              )}\n            </div>\n          </CardContent>\n        </Card>\n\n        {/* Ad Insertion every 4th post */}\n        {(index + 1) % AD_FREQUENCY === 0 && (\n          <Card className=\"pack-card overflow-hidden bg-gradient-to-br from-volt/20 to-cobalt/20\" data-testid={`ad-slot-${index}`}>\n            <CardContent className=\"p-6 text-center\">\n              <p className=\"text-xs uppercase tracking-wider text-muted-foreground mb-2\">Sponsored</p>\n              <div className=\"min-h-[200px] flex items-center justify-center\">\n                <div className=\"text-center space-y-2\">\n                  <Eye className=\"h-8 w-8 mx-auto opacity-50\" />\n                  <p className=\"text-sm font-medium\">Ad Placement</p>\n                  <p className=\"text-xs text-muted-foreground\">\n                    Creative promotional content\n                  </p>\n                </div>\n              </div>\n            </CardContent>\n          </Card>\n        )}\n      </>\n    );\n  };\n\n  if (isLoading && page === 1) {\n    return (\n      <div className=\"flex justify-center items-center min-h-[400px]\">\n        <LoaderCircle className=\"animate-spin h-8 w-8 text-primary\" />\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"space-y-6\">\n      <div className=\"grid gap-6 grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4\">\n        {allPosts.map((post, idx) => renderPost(post, idx))}\n      </div>\n      \n      <div ref={loader} className=\"flex justify-center py-8\">\n        {isFetching && <LoaderCircle className=\"animate-spin h-6 w-6 text-primary\" />}\n      </div>\n\n      {!isFetching && allPosts.length === 0 && (\n        <div className=\"text-center py-12\">\n          <p className=\"text-muted-foreground\">No posts to display. Follow some creators to see their content!</p>\n        </div>\n      )}\n    </div>\n  );\n}\n","size_bytes":10186},"client/src/components/ui/toggle-group.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as ToggleGroupPrimitive from \"@radix-ui/react-toggle-group\"\nimport { type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\nimport { toggleVariants } from \"@/components/ui/toggle\"\n\nconst ToggleGroupContext = React.createContext<\n  VariantProps<typeof toggleVariants>\n>({\n  size: \"default\",\n  variant: \"default\",\n})\n\nconst ToggleGroup = React.forwardRef<\n  React.ElementRef<typeof ToggleGroupPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ToggleGroupPrimitive.Root> &\n    VariantProps<typeof toggleVariants>\n>(({ className, variant, size, children, ...props }, ref) => (\n  <ToggleGroupPrimitive.Root\n    ref={ref}\n    className={cn(\"flex items-center justify-center gap-1\", className)}\n    {...props}\n  >\n    <ToggleGroupContext.Provider value={{ variant, size }}>\n      {children}\n    </ToggleGroupContext.Provider>\n  </ToggleGroupPrimitive.Root>\n))\n\nToggleGroup.displayName = ToggleGroupPrimitive.Root.displayName\n\nconst ToggleGroupItem = React.forwardRef<\n  React.ElementRef<typeof ToggleGroupPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof ToggleGroupPrimitive.Item> &\n    VariantProps<typeof toggleVariants>\n>(({ className, children, variant, size, ...props }, ref) => {\n  const context = React.useContext(ToggleGroupContext)\n\n  return (\n    <ToggleGroupPrimitive.Item\n      ref={ref}\n      className={cn(\n        toggleVariants({\n          variant: context.variant || variant,\n          size: context.size || size,\n        }),\n        className\n      )}\n      {...props}\n    >\n      {children}\n    </ToggleGroupPrimitive.Item>\n  )\n})\n\nToggleGroupItem.displayName = ToggleGroupPrimitive.Item.displayName\n\nexport { ToggleGroup, ToggleGroupItem }\n","size_bytes":1753},"client/src/pages/Messages.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { useAuth } from \"@/hooks/useAuth\";\nimport { useWebSocket } from \"@/hooks/useWebSocket\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { isUnauthorizedError } from \"@/lib/authUtils\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport Header from \"@/components/layout/Header\";\nimport Footer from \"@/components/layout/Footer\";\nimport ChatInterface from \"@/components/messaging/ChatInterface\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Input } from \"@/components/ui/input\";\nimport { Button } from \"@/components/ui/button\";\nimport { Avatar, AvatarImage, AvatarFallback } from \"@/components/ui/avatar\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport { \n  MessageCircle, \n  Search, \n  Users, \n  Phone, \n  Video, \n  MoreHorizontal,\n  Heart,\n  Star,\n  Send\n} from \"lucide-react\";\n\nexport default function Messages() {\n  const { user, isAuthenticated } = useAuth();\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n  const [selectedConversation, setSelectedConversation] = useState<string | null>(null);\n  const [searchQuery, setSearchQuery] = useState(\"\");\n\n  // Redirect if not authenticated\n  useEffect(() => {\n    if (!isAuthenticated) {\n      toast({\n        title: \"Unauthorized\",\n        description: \"You are logged out. Logging in again...\",\n        variant: \"destructive\",\n      });\n      setTimeout(() => {\n        window.location.href = \"/api/login\";\n      }, 500);\n      return;\n    }\n  }, [isAuthenticated, toast]);\n\n  const { data: conversations, isLoading: conversationsLoading, error: conversationsError } = useQuery({\n    queryKey: ['/api/messages/conversations'],\n    enabled: isAuthenticated,\n  });\n\n  const { data: messages, isLoading: messagesLoading } = useQuery({\n    queryKey: ['/api/messages', selectedConversation],\n    enabled: isAuthenticated && !!selectedConversation,\n  });\n\n  const sendMessageMutation = useMutation({\n    mutationFn: async (data: { toUserId: string; content: string; messageType?: string }) => {\n      await apiRequest('POST', '/api/messages', data);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['/api/messages', selectedConversation] });\n      queryClient.invalidateQueries({ queryKey: ['/api/messages/conversations'] });\n    },\n    onError: (error) => {\n      if (isUnauthorizedError(error as Error)) {\n        toast({\n          title: \"Unauthorized\",\n          description: \"You are logged out. Logging in again...\",\n          variant: \"destructive\",\n        });\n        setTimeout(() => {\n          window.location.href = \"/api/login\";\n        }, 500);\n        return;\n      }\n      toast({\n        title: \"Error\",\n        description: \"Failed to send message. Please try again.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  // WebSocket for real-time messages\n  useWebSocket({\n    onMessage: (data) => {\n      if (data.type === 'new_message') {\n        queryClient.invalidateQueries({ queryKey: ['/api/messages'] });\n        queryClient.invalidateQueries({ queryKey: ['/api/messages/conversations'] });\n      }\n    },\n  });\n\n  // Handle errors\n  useEffect(() => {\n    if (conversationsError && isUnauthorizedError(conversationsError as Error)) {\n      toast({\n        title: \"Unauthorized\",\n        description: \"You are logged out. Logging in again...\",\n        variant: \"destructive\",\n      });\n      setTimeout(() => {\n        window.location.href = \"/api/login\";\n      }, 500);\n    }\n  }, [conversationsError, toast]);\n\n  const handleSendMessage = (content: string) => {\n    if (!selectedConversation || !content.trim()) return;\n    \n    sendMessageMutation.mutate({\n      toUserId: selectedConversation,\n      content: content.trim(),\n      messageType: 'text'\n    });\n  };\n\n  if (!isAuthenticated) {\n    return null;\n  }\n\n  return (\n    <div className=\"min-h-screen\">\n      <Header />\n      \n      <main className=\"pt-40 pb-4\">\n        <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8\">\n          <div className=\"mb-6\">\n            <h1 className=\"neon-heading text-3xl mb-2\">\n              Pack\n              <span className=\"neon-text-accent ml-2\">Messages</span>\n            </h1>\n            <p className=\"text-muted\">Stay connected with your pack through real-time messaging</p>\n          </div>\n\n          <Card className=\"pack-card h-[calc(100vh-12rem)]\">\n            <div className=\"grid lg:grid-cols-3 h-full\">\n              {/* Conversation List */}\n              <div className=\"border-r border-border bg-background\">\n                <div className=\"p-4 border-b border-border\">\n                  <h3 className=\"font-semibold text-foreground mb-3\">Messages</h3>\n                  <div className=\"relative\">\n                    <Input\n                      type=\"text\"\n                      placeholder=\"Search conversations...\"\n                      value={searchQuery}\n                      onChange={(e) => setSearchQuery(e.target.value)}\n                      className=\"form-input pl-10\"\n                      data-testid=\"input-search-conversations\"\n                    />\n                    <Search className=\"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted\" />\n                  </div>\n                </div>\n                \n                <div className=\"overflow-y-auto h-full\">\n                  {conversationsLoading ? (\n                    <div className=\"space-y-1\">\n                      {Array.from({ length: 5 }).map((_, i) => (\n                        <div key={i} className=\"p-4\">\n                          <div className=\"flex items-center space-x-3\">\n                            <Skeleton className=\"w-10 h-10 rounded-lg\" />\n                            <div className=\"flex-1\">\n                              <Skeleton className=\"h-4 w-24 mb-2\" />\n                              <Skeleton className=\"h-3 w-32\" />\n                            </div>\n                          </div>\n                        </div>\n                      ))}\n                    </div>\n                  ) : conversations?.length > 0 ? (\n                    conversations.map((conversation: any) => (\n                      <div\n                        key={conversation.otherUserId}\n                        className={`p-4 border-b border-border hover:bg-card/50 transition-colors cursor-pointer ${\n                          selectedConversation === conversation.otherUserId ? 'bg-card/50' : ''\n                        }`}\n                        onClick={() => setSelectedConversation(conversation.otherUserId)}\n                        data-testid={`conversation-${conversation.otherUserId}`}\n                      >\n                        <div className=\"flex items-center space-x-3\">\n                          <div className=\"relative\">\n                            <Avatar className=\"w-10 h-10\">\n                              <AvatarImage src={`https://images.unsplash.com/photo-${Math.random() > 0.5 ? '1566753323558-f4e0952af115' : '1507003211169-0a1dd7228f2d'}?ixlib=rb-4.0.3&auto=format&fit=crop&w=40&h=40`} />\n                              <AvatarFallback>\n                                {conversation.otherUserId.charAt(0).toUpperCase()}\n                              </AvatarFallback>\n                            </Avatar>\n                            <div className=\"absolute -bottom-1 -right-1 w-3 h-3 bg-success rounded-full border-2 border-background\"></div>\n                          </div>\n                          <div className=\"flex-1 min-w-0\">\n                            <p className=\"font-medium text-foreground truncate\" data-testid=\"text-conversation-name\">\n                              Creator_{conversation.otherUserId.slice(-4)}\n                            </p>\n                            <p className=\"text-sm text-muted truncate\" data-testid=\"text-last-message\">\n                              {conversation.lastMessage || \"Start a conversation\"}\n                            </p>\n                          </div>\n                          <div className=\"text-xs text-muted\">\n                            {conversation.unreadCount > 0 && (\n                              <Badge className=\"bg-primary text-primary-foreground text-xs\">\n                                {conversation.unreadCount}\n                              </Badge>\n                            )}\n                          </div>\n                        </div>\n                      </div>\n                    ))\n                  ) : (\n                    <div className=\"text-center py-8\">\n                      <MessageCircle className=\"h-12 w-12 text-muted mx-auto mb-4\" />\n                      <p className=\"text-muted\">No conversations yet</p>\n                      <p className=\"text-sm text-muted mt-2\">Start chatting with creators!</p>\n                    </div>\n                  )}\n                </div>\n              </div>\n\n              {/* Chat Area */}\n              <div className=\"lg:col-span-2 flex flex-col\">\n                {selectedConversation ? (\n                  <>\n                    {/* Chat Header */}\n                    <div className=\"p-4 border-b border-border bg-background flex items-center justify-between\">\n                      <div className=\"flex items-center space-x-3\">\n                        <Avatar className=\"w-10 h-10\">\n                          <AvatarImage src={`https://images.unsplash.com/photo-${Math.random() > 0.5 ? '1566753323558-f4e0952af115' : '1507003211169-0a1dd7228f2d'}?ixlib=rb-4.0.3&auto=format&fit=crop&w=40&h=40`} />\n                          <AvatarFallback>\n                            {selectedConversation.charAt(0).toUpperCase()}\n                          </AvatarFallback>\n                        </Avatar>\n                        <div>\n                          <p className=\"font-medium text-foreground\" data-testid=\"text-chat-partner\">\n                            Creator_{selectedConversation.slice(-4)}\n                          </p>\n                          <p className=\"text-sm text-success\">Online now</p>\n                        </div>\n                      </div>\n                      <div className=\"flex items-center space-x-2\">\n                        <Button variant=\"ghost\" size=\"sm\" data-testid=\"button-video-call\">\n                          <Video className=\"h-4 w-4\" />\n                        </Button>\n                        <Button variant=\"ghost\" size=\"sm\" data-testid=\"button-voice-call\">\n                          <Phone className=\"h-4 w-4\" />\n                        </Button>\n                        <Button variant=\"ghost\" size=\"sm\" data-testid=\"button-more-options\">\n                          <MoreHorizontal className=\"h-4 w-4\" />\n                        </Button>\n                      </div>\n                    </div>\n\n                    {/* Chat Interface */}\n                    <ChatInterface\n                      messages={messages || []}\n                      isLoading={messagesLoading}\n                      onSendMessage={handleSendMessage}\n                      isOwnMessage={(msg: any) => msg.fromUserId === user?.id}\n                    />\n                  </>\n                ) : (\n                  <div className=\"flex-1 flex items-center justify-center\">\n                    <div className=\"text-center\">\n                      <MessageCircle className=\"h-16 w-16 text-muted mx-auto mb-4\" />\n                      <h3 className=\"font-semibold text-xl mb-2\">Welcome to Pack Messages</h3>\n                      <p className=\"text-muted max-w-sm\">\n                        Select a conversation from the left to start chatting with your pack members\n                      </p>\n                    </div>\n                  </div>\n                )}\n              </div>\n            </div>\n          </Card>\n        </div>\n      </main>\n\n      <Footer />\n    </div>\n  );\n}\n","size_bytes":12000},"client/src/pages/Wiki.tsx":{"content":"import { useState } from \"react\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Input } from \"@/components/ui/input\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Search, Brain, BookOpen, Users, Shield, Heart, Zap } from \"lucide-react\";\n\nconst wikiCategories = [\n  {\n    id: \"getting-started\",\n    title: \"Getting Started\",\n    icon: BookOpen,\n    description: \"Learn the basics of the FUN Empire platform\",\n    articles: [\n      { title: \"Welcome to FUN Empire\", slug: \"welcome\", tags: [\"basics\", \"intro\"] },\n      { title: \"Setting up your Profile\", slug: \"profile-setup\", tags: [\"profile\", \"basics\"] },\n      { title: \"Understanding Tenants\", slug: \"tenants\", tags: [\"girlfanz\", \"pupfanz\", \"daddyfanz\"] },\n      { title: \"Content Creation Guide\", slug: \"content-creation\", tags: [\"content\", \"creators\"] },\n    ]\n  },\n  {\n    id: \"safety\",\n    title: \"Safety & Compliance\",\n    icon: Shield,\n    description: \"Important safety guidelines and compliance information\",\n    articles: [\n      { title: \"Community Guidelines\", slug: \"guidelines\", tags: [\"safety\", \"rules\"] },\n      { title: \"Age Verification Process\", slug: \"age-verification\", tags: [\"kyc\", \"compliance\"] },\n      { title: \"Content Moderation\", slug: \"moderation\", tags: [\"safety\", \"content\"] },\n      { title: \"Reporting Issues\", slug: \"reporting\", tags: [\"safety\", \"support\"] },\n    ]\n  },\n  {\n    id: \"creators\",\n    title: \"For Creators\",\n    icon: Users,\n    description: \"Guides for content creators and performers\",\n    articles: [\n      { title: \"Creator Dashboard\", slug: \"dashboard\", tags: [\"creators\", \"analytics\"] },\n      { title: \"Monetization Strategies\", slug: \"monetization\", tags: [\"creators\", \"revenue\"] },\n      { title: \"Cross-posting Content\", slug: \"cross-posting\", tags: [\"content\", \"tenants\"] },\n      { title: \"Building Your Audience\", slug: \"audience\", tags: [\"creators\", \"growth\"] },\n    ]\n  },\n  {\n    id: \"fans\",\n    title: \"For Fans\",\n    icon: Heart,\n    description: \"How to enjoy and support your favorite creators\",\n    articles: [\n      { title: \"Discovering Creators\", slug: \"discovery\", tags: [\"fans\", \"discovery\"] },\n      { title: \"Subscription Plans\", slug: \"subscriptions\", tags: [\"fans\", \"payments\"] },\n      { title: \"Messaging & Tips\", slug: \"messaging\", tags: [\"fans\", \"interaction\"] },\n      { title: \"Privacy & Security\", slug: \"privacy\", tags: [\"fans\", \"security\"] },\n    ]\n  },\n  {\n    id: \"technical\",\n    title: \"Technical\",\n    icon: Zap,\n    description: \"Technical features and troubleshooting\",\n    articles: [\n      { title: \"Media Upload Guidelines\", slug: \"uploads\", tags: [\"technical\", \"media\"] },\n      { title: \"Browser Compatibility\", slug: \"browsers\", tags: [\"technical\", \"support\"] },\n      { title: \"Mobile App Features\", slug: \"mobile\", tags: [\"technical\", \"mobile\"] },\n      { title: \"API Documentation\", slug: \"api\", tags: [\"technical\", \"developers\"] },\n    ]\n  }\n];\n\nexport default function Wiki() {\n  const [searchQuery, setSearchQuery] = useState(\"\");\n  const [selectedCategory, setSelectedCategory] = useState<string | null>(null);\n\n  const filteredCategories = wikiCategories.filter(category => {\n    if (!searchQuery) return true;\n    return category.title.toLowerCase().includes(searchQuery.toLowerCase()) ||\n           category.description.toLowerCase().includes(searchQuery.toLowerCase()) ||\n           category.articles.some(article => \n             article.title.toLowerCase().includes(searchQuery.toLowerCase()) ||\n             article.tags.some(tag => tag.toLowerCase().includes(searchQuery.toLowerCase()))\n           );\n  });\n\n  const selectedCategoryData = selectedCategory \n    ? wikiCategories.find(c => c.id === selectedCategory)\n    : null;\n\n  return (\n    <div className=\"container mx-auto p-6 max-w-6xl\">\n      <div className=\"mb-8\">\n        <div className=\"flex items-center gap-2 mb-4\">\n          <Brain className=\"h-8 w-8 text-primary\" />\n          <h1 className=\"text-3xl font-bold\">AI-Powered Knowledge Base</h1>\n        </div>\n        <p className=\"text-muted-foreground text-lg\">\n          Everything you need to know about the FUN Empire platform\n        </p>\n      </div>\n\n      <div className=\"mb-6\">\n        <div className=\"relative\">\n          <Search className=\"absolute left-3 top-3 h-4 w-4 text-muted-foreground\" />\n          <Input\n            placeholder=\"Search knowledge base...\"\n            value={searchQuery}\n            onChange={(e) => setSearchQuery(e.target.value)}\n            className=\"pl-10\"\n            data-testid=\"wiki-search\"\n          />\n        </div>\n      </div>\n\n      {!selectedCategory ? (\n        <div className=\"grid gap-6 md:grid-cols-2 lg:grid-cols-3\">\n          {filteredCategories.map((category) => {\n            const IconComponent = category.icon;\n            return (\n              <Card key={category.id} className=\"hover:shadow-lg transition-shadow cursor-pointer\"\n                    onClick={() => setSelectedCategory(category.id)}\n                    data-testid={`wiki-category-${category.id}`}>\n                <CardHeader>\n                  <CardTitle className=\"flex items-center gap-2\">\n                    <IconComponent className=\"h-5 w-5 text-primary\" />\n                    {category.title}\n                  </CardTitle>\n                  <CardDescription>{category.description}</CardDescription>\n                </CardHeader>\n                <CardContent>\n                  <div className=\"space-y-2\">\n                    {category.articles.slice(0, 3).map((article) => (\n                      <div key={article.slug} className=\"text-sm\">\n                        <div className=\"font-medium\">{article.title}</div>\n                        <div className=\"flex gap-1 mt-1\">\n                          {article.tags.slice(0, 2).map((tag) => (\n                            <Badge key={tag} variant=\"outline\" className=\"text-xs\">\n                              {tag}\n                            </Badge>\n                          ))}\n                        </div>\n                      </div>\n                    ))}\n                    {category.articles.length > 3 && (\n                      <div className=\"text-xs text-muted-foreground\">\n                        +{category.articles.length - 3} more articles\n                      </div>\n                    )}\n                  </div>\n                </CardContent>\n              </Card>\n            );\n          })}\n        </div>\n      ) : (\n        <div>\n          <Button \n            variant=\"ghost\" \n            onClick={() => setSelectedCategory(null)}\n            className=\"mb-4\"\n            data-testid=\"wiki-back-button\"\n          >\n            â† Back to Categories\n          </Button>\n          \n          {selectedCategoryData && (\n            <div>\n              <div className=\"flex items-center gap-2 mb-6\">\n                <selectedCategoryData.icon className=\"h-6 w-6 text-primary\" />\n                <h2 className=\"text-2xl font-bold\">{selectedCategoryData.title}</h2>\n              </div>\n              \n              <div className=\"grid gap-4 md:grid-cols-2\">\n                {selectedCategoryData.articles.map((article) => (\n                  <Card key={article.slug} className=\"hover:shadow-lg transition-shadow cursor-pointer\"\n                        data-testid={`wiki-article-${article.slug}`}>\n                    <CardHeader>\n                      <CardTitle className=\"text-lg\">{article.title}</CardTitle>\n                    </CardHeader>\n                    <CardContent>\n                      <div className=\"flex gap-1\">\n                        {article.tags.map((tag) => (\n                          <Badge key={tag} variant=\"outline\" className=\"text-xs\">\n                            {tag}\n                          </Badge>\n                        ))}\n                      </div>\n                    </CardContent>\n                  </Card>\n                ))}\n              </div>\n            </div>\n          )}\n        </div>\n      )}\n    </div>\n  );\n}","size_bytes":8082},"client/src/components/ui/chart.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as RechartsPrimitive from \"recharts\"\n\nimport { cn } from \"@/lib/utils\"\n\n// Format: { THEME_NAME: CSS_SELECTOR }\nconst THEMES = { light: \"\", dark: \".dark\" } as const\n\nexport type ChartConfig = {\n  [k in string]: {\n    label?: React.ReactNode\n    icon?: React.ComponentType\n  } & (\n    | { color?: string; theme?: never }\n    | { color?: never; theme: Record<keyof typeof THEMES, string> }\n  )\n}\n\ntype ChartContextProps = {\n  config: ChartConfig\n}\n\nconst ChartContext = React.createContext<ChartContextProps | null>(null)\n\nfunction useChart() {\n  const context = React.useContext(ChartContext)\n\n  if (!context) {\n    throw new Error(\"useChart must be used within a <ChartContainer />\")\n  }\n\n  return context\n}\n\nconst ChartContainer = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> & {\n    config: ChartConfig\n    children: React.ComponentProps<\n      typeof RechartsPrimitive.ResponsiveContainer\n    >[\"children\"]\n  }\n>(({ id, className, children, config, ...props }, ref) => {\n  const uniqueId = React.useId()\n  const chartId = `chart-${id || uniqueId.replace(/:/g, \"\")}`\n\n  return (\n    <ChartContext.Provider value={{ config }}>\n      <div\n        data-chart={chartId}\n        ref={ref}\n        className={cn(\n          \"flex aspect-video justify-center text-xs [&_.recharts-cartesian-axis-tick_text]:fill-muted-foreground [&_.recharts-cartesian-grid_line[stroke='#ccc']]:stroke-border/50 [&_.recharts-curve.recharts-tooltip-cursor]:stroke-border [&_.recharts-dot[stroke='#fff']]:stroke-transparent [&_.recharts-layer]:outline-none [&_.recharts-polar-grid_[stroke='#ccc']]:stroke-border [&_.recharts-radial-bar-background-sector]:fill-muted [&_.recharts-rectangle.recharts-tooltip-cursor]:fill-muted [&_.recharts-reference-line_[stroke='#ccc']]:stroke-border [&_.recharts-sector[stroke='#fff']]:stroke-transparent [&_.recharts-sector]:outline-none [&_.recharts-surface]:outline-none\",\n          className\n        )}\n        {...props}\n      >\n        <ChartStyle id={chartId} config={config} />\n        <RechartsPrimitive.ResponsiveContainer>\n          {children}\n        </RechartsPrimitive.ResponsiveContainer>\n      </div>\n    </ChartContext.Provider>\n  )\n})\nChartContainer.displayName = \"Chart\"\n\nconst ChartStyle = ({ id, config }: { id: string; config: ChartConfig }) => {\n  const colorConfig = Object.entries(config).filter(\n    ([, config]) => config.theme || config.color\n  )\n\n  if (!colorConfig.length) {\n    return null\n  }\n\n  return (\n    <style\n      dangerouslySetInnerHTML={{\n        __html: Object.entries(THEMES)\n          .map(\n            ([theme, prefix]) => `\n${prefix} [data-chart=${id}] {\n${colorConfig\n  .map(([key, itemConfig]) => {\n    const color =\n      itemConfig.theme?.[theme as keyof typeof itemConfig.theme] ||\n      itemConfig.color\n    return color ? `  --color-${key}: ${color};` : null\n  })\n  .join(\"\\n\")}\n}\n`\n          )\n          .join(\"\\n\"),\n      }}\n    />\n  )\n}\n\nconst ChartTooltip = RechartsPrimitive.Tooltip\n\nconst ChartTooltipContent = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<typeof RechartsPrimitive.Tooltip> &\n    React.ComponentProps<\"div\"> & {\n      hideLabel?: boolean\n      hideIndicator?: boolean\n      indicator?: \"line\" | \"dot\" | \"dashed\"\n      nameKey?: string\n      labelKey?: string\n    }\n>(\n  (\n    {\n      active,\n      payload,\n      className,\n      indicator = \"dot\",\n      hideLabel = false,\n      hideIndicator = false,\n      label,\n      labelFormatter,\n      labelClassName,\n      formatter,\n      color,\n      nameKey,\n      labelKey,\n    },\n    ref\n  ) => {\n    const { config } = useChart()\n\n    const tooltipLabel = React.useMemo(() => {\n      if (hideLabel || !payload?.length) {\n        return null\n      }\n\n      const [item] = payload\n      const key = `${labelKey || item?.dataKey || item?.name || \"value\"}`\n      const itemConfig = getPayloadConfigFromPayload(config, item, key)\n      const value =\n        !labelKey && typeof label === \"string\"\n          ? config[label as keyof typeof config]?.label || label\n          : itemConfig?.label\n\n      if (labelFormatter) {\n        return (\n          <div className={cn(\"font-medium\", labelClassName)}>\n            {labelFormatter(value, payload)}\n          </div>\n        )\n      }\n\n      if (!value) {\n        return null\n      }\n\n      return <div className={cn(\"font-medium\", labelClassName)}>{value}</div>\n    }, [\n      label,\n      labelFormatter,\n      payload,\n      hideLabel,\n      labelClassName,\n      config,\n      labelKey,\n    ])\n\n    if (!active || !payload?.length) {\n      return null\n    }\n\n    const nestLabel = payload.length === 1 && indicator !== \"dot\"\n\n    return (\n      <div\n        ref={ref}\n        className={cn(\n          \"grid min-w-[8rem] items-start gap-1.5 rounded-lg border border-border/50 bg-background px-2.5 py-1.5 text-xs shadow-xl\",\n          className\n        )}\n      >\n        {!nestLabel ? tooltipLabel : null}\n        <div className=\"grid gap-1.5\">\n          {payload.map((item, index) => {\n            const key = `${nameKey || item.name || item.dataKey || \"value\"}`\n            const itemConfig = getPayloadConfigFromPayload(config, item, key)\n            const indicatorColor = color || item.payload.fill || item.color\n\n            return (\n              <div\n                key={item.dataKey}\n                className={cn(\n                  \"flex w-full flex-wrap items-stretch gap-2 [&>svg]:h-2.5 [&>svg]:w-2.5 [&>svg]:text-muted-foreground\",\n                  indicator === \"dot\" && \"items-center\"\n                )}\n              >\n                {formatter && item?.value !== undefined && item.name ? (\n                  formatter(item.value, item.name, item, index, item.payload)\n                ) : (\n                  <>\n                    {itemConfig?.icon ? (\n                      <itemConfig.icon />\n                    ) : (\n                      !hideIndicator && (\n                        <div\n                          className={cn(\n                            \"shrink-0 rounded-[2px] border-[--color-border] bg-[--color-bg]\",\n                            {\n                              \"h-2.5 w-2.5\": indicator === \"dot\",\n                              \"w-1\": indicator === \"line\",\n                              \"w-0 border-[1.5px] border-dashed bg-transparent\":\n                                indicator === \"dashed\",\n                              \"my-0.5\": nestLabel && indicator === \"dashed\",\n                            }\n                          )}\n                          style={\n                            {\n                              \"--color-bg\": indicatorColor,\n                              \"--color-border\": indicatorColor,\n                            } as React.CSSProperties\n                          }\n                        />\n                      )\n                    )}\n                    <div\n                      className={cn(\n                        \"flex flex-1 justify-between leading-none\",\n                        nestLabel ? \"items-end\" : \"items-center\"\n                      )}\n                    >\n                      <div className=\"grid gap-1.5\">\n                        {nestLabel ? tooltipLabel : null}\n                        <span className=\"text-muted-foreground\">\n                          {itemConfig?.label || item.name}\n                        </span>\n                      </div>\n                      {item.value && (\n                        <span className=\"font-mono font-medium tabular-nums text-foreground\">\n                          {item.value.toLocaleString()}\n                        </span>\n                      )}\n                    </div>\n                  </>\n                )}\n              </div>\n            )\n          })}\n        </div>\n      </div>\n    )\n  }\n)\nChartTooltipContent.displayName = \"ChartTooltip\"\n\nconst ChartLegend = RechartsPrimitive.Legend\n\nconst ChartLegendContent = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> &\n    Pick<RechartsPrimitive.LegendProps, \"payload\" | \"verticalAlign\"> & {\n      hideIcon?: boolean\n      nameKey?: string\n    }\n>(\n  (\n    { className, hideIcon = false, payload, verticalAlign = \"bottom\", nameKey },\n    ref\n  ) => {\n    const { config } = useChart()\n\n    if (!payload?.length) {\n      return null\n    }\n\n    return (\n      <div\n        ref={ref}\n        className={cn(\n          \"flex items-center justify-center gap-4\",\n          verticalAlign === \"top\" ? \"pb-3\" : \"pt-3\",\n          className\n        )}\n      >\n        {payload.map((item) => {\n          const key = `${nameKey || item.dataKey || \"value\"}`\n          const itemConfig = getPayloadConfigFromPayload(config, item, key)\n\n          return (\n            <div\n              key={item.value}\n              className={cn(\n                \"flex items-center gap-1.5 [&>svg]:h-3 [&>svg]:w-3 [&>svg]:text-muted-foreground\"\n              )}\n            >\n              {itemConfig?.icon && !hideIcon ? (\n                <itemConfig.icon />\n              ) : (\n                <div\n                  className=\"h-2 w-2 shrink-0 rounded-[2px]\"\n                  style={{\n                    backgroundColor: item.color,\n                  }}\n                />\n              )}\n              {itemConfig?.label}\n            </div>\n          )\n        })}\n      </div>\n    )\n  }\n)\nChartLegendContent.displayName = \"ChartLegend\"\n\n// Helper to extract item config from a payload.\nfunction getPayloadConfigFromPayload(\n  config: ChartConfig,\n  payload: unknown,\n  key: string\n) {\n  if (typeof payload !== \"object\" || payload === null) {\n    return undefined\n  }\n\n  const payloadPayload =\n    \"payload\" in payload &&\n    typeof payload.payload === \"object\" &&\n    payload.payload !== null\n      ? payload.payload\n      : undefined\n\n  let configLabelKey: string = key\n\n  if (\n    key in payload &&\n    typeof payload[key as keyof typeof payload] === \"string\"\n  ) {\n    configLabelKey = payload[key as keyof typeof payload] as string\n  } else if (\n    payloadPayload &&\n    key in payloadPayload &&\n    typeof payloadPayload[key as keyof typeof payloadPayload] === \"string\"\n  ) {\n    configLabelKey = payloadPayload[\n      key as keyof typeof payloadPayload\n    ] as string\n  }\n\n  return configLabelKey in config\n    ? config[configLabelKey]\n    : config[key as keyof typeof config]\n}\n\nexport {\n  ChartContainer,\n  ChartTooltip,\n  ChartTooltipContent,\n  ChartLegend,\n  ChartLegendContent,\n  ChartStyle,\n}\n","size_bytes":10481},"client/src/components/ui/toast.tsx":{"content":"import * as React from \"react\"\nimport * as ToastPrimitives from \"@radix-ui/react-toast\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ToastProvider = ToastPrimitives.Provider\n\nconst ToastViewport = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Viewport>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Viewport>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Viewport\n    ref={ref}\n    className={cn(\n      \"fixed top-0 z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:right-0 sm:top-auto sm:flex-col md:max-w-[420px]\",\n      className\n    )}\n    {...props}\n  />\n))\nToastViewport.displayName = ToastPrimitives.Viewport.displayName\n\nconst toastVariants = cva(\n  \"group pointer-events-auto relative flex w-full items-center justify-between space-x-4 overflow-hidden rounded-md border p-6 pr-8 shadow-lg transition-all data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-right-full data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full\",\n  {\n    variants: {\n      variant: {\n        default: \"border bg-background text-foreground\",\n        destructive:\n          \"destructive group border-destructive bg-destructive text-destructive-foreground\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nconst Toast = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Root>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Root> &\n    VariantProps<typeof toastVariants>\n>(({ className, variant, ...props }, ref) => {\n  return (\n    <ToastPrimitives.Root\n      ref={ref}\n      className={cn(toastVariants({ variant }), className)}\n      {...props}\n    />\n  )\n})\nToast.displayName = ToastPrimitives.Root.displayName\n\nconst ToastAction = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Action>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Action>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Action\n    ref={ref}\n    className={cn(\n      \"inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium ring-offset-background transition-colors hover:bg-secondary focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 group-[.destructive]:border-muted/40 group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground group-[.destructive]:focus:ring-destructive\",\n      className\n    )}\n    {...props}\n  />\n))\nToastAction.displayName = ToastPrimitives.Action.displayName\n\nconst ToastClose = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Close>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Close>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Close\n    ref={ref}\n    className={cn(\n      \"absolute right-2 top-2 rounded-md p-1 text-foreground/50 opacity-0 transition-opacity hover:text-foreground focus:opacity-100 focus:outline-none focus:ring-2 group-hover:opacity-100 group-[.destructive]:text-red-300 group-[.destructive]:hover:text-red-50 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600\",\n      className\n    )}\n    toast-close=\"\"\n    {...props}\n  >\n    <X className=\"h-4 w-4\" />\n  </ToastPrimitives.Close>\n))\nToastClose.displayName = ToastPrimitives.Close.displayName\n\nconst ToastTitle = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Title>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Title>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Title\n    ref={ref}\n    className={cn(\"text-sm font-semibold\", className)}\n    {...props}\n  />\n))\nToastTitle.displayName = ToastPrimitives.Title.displayName\n\nconst ToastDescription = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Description>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Description>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Description\n    ref={ref}\n    className={cn(\"text-sm opacity-90\", className)}\n    {...props}\n  />\n))\nToastDescription.displayName = ToastPrimitives.Description.displayName\n\ntype ToastProps = React.ComponentPropsWithoutRef<typeof Toast>\n\ntype ToastActionElement = React.ReactElement<typeof ToastAction>\n\nexport {\n  type ToastProps,\n  type ToastActionElement,\n  ToastProvider,\n  ToastViewport,\n  Toast,\n  ToastTitle,\n  ToastDescription,\n  ToastClose,\n  ToastAction,\n}\n","size_bytes":4845},"client/src/pages/Privacy.tsx":{"content":"import { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Lock } from \"lucide-react\";\n\nconst sections = [\n  {\n    title: \"1. Information We Collect\",\n    content: \"We collect information you provide directly to us, including your name, email address, username, password, profile information, payment information, and any content you create or upload. We also collect information automatically such as your IP address, browser type, device information, and usage data through cookies and similar technologies.\"\n  },\n  {\n    title: \"2. How We Use Your Information\",\n    content: \"We use the information we collect to: provide, maintain, and improve our services; process transactions and send related information; send you technical notices, updates, security alerts, and support messages; respond to your comments, questions, and customer service requests; communicate with you about products, services, offers, and events; monitor and analyze trends, usage, and activities; detect, investigate, and prevent fraudulent transactions and other illegal activities; personalize and improve your experience on our platform.\"\n  },\n  {\n    title: \"3. Information Sharing\",\n    content: \"We do not sell your personal information. We may share your information with: service providers who perform services on our behalf; business partners when you choose to use integrated services; other users as part of the social features of our platform; in response to legal requests or to protect rights and safety; in connection with a business transaction such as a merger or acquisition; with your consent or at your direction.\"\n  },\n  {\n    title: \"4. Data Security\",\n    content: \"We implement appropriate technical and organizational measures to protect your personal information against unauthorized or unlawful processing, accidental loss, destruction, or damage. This includes encryption of data in transit and at rest, regular security audits, and access controls. However, no method of transmission over the internet or electronic storage is 100% secure.\"\n  },\n  {\n    title: \"5. Your Rights and Choices\",\n    content: \"You have the right to: access, update, or delete your personal information; object to processing of your personal information; request restriction of processing; request data portability; withdraw consent at any time; lodge a complaint with a supervisory authority. You can exercise these rights through your account settings or by contacting us.\"\n  },\n  {\n    title: \"6. Cookies and Tracking\",\n    content: \"We use cookies and similar tracking technologies to track activity on our platform and hold certain information. Cookies are files with small amounts of data which may include an anonymous unique identifier. You can instruct your browser to refuse all cookies or to indicate when a cookie is being sent. However, if you do not accept cookies, you may not be able to use some portions of our platform.\"\n  },\n  {\n    title: \"7. Data Retention\",\n    content: \"We retain your personal information for as long as necessary to fulfill the purposes outlined in this Privacy Policy, unless a longer retention period is required or permitted by law. When we no longer need your information, we will securely delete or anonymize it. Content you upload may be retained for archival purposes even after account deletion, as required by legal and regulatory obligations.\"\n  },\n  {\n    title: \"8. International Data Transfers\",\n    content: \"Your information may be transferred to and maintained on computers located outside of your state, province, country, or other governmental jurisdiction where data protection laws may differ. By using our platform, you consent to the transfer of information to jurisdictions outside your country of residence.\"\n  },\n  {\n    title: \"9. Children's Privacy\",\n    content: \"Our platform is not intended for anyone under the age of 18. We do not knowingly collect personal information from children under 18. If you are a parent or guardian and you are aware that your child has provided us with personal information, please contact us immediately. If we become aware that we have collected personal information from children without verification of parental consent, we take steps to remove that information.\"\n  },\n  {\n    title: \"10. Age Verification\",\n    content: \"To ensure compliance with legal requirements, we implement age verification processes. This may include collection of government-issued identification documents. We use third-party age verification services that process this information securely and in compliance with applicable laws. Verification data is encrypted and stored securely.\"\n  },\n  {\n    title: \"11. Third-Party Links\",\n    content: \"Our platform may contain links to third-party websites or services that are not owned or controlled by us. We have no control over and assume no responsibility for the content, privacy policies, or practices of any third-party sites or services. We encourage you to review the privacy policy of every site you visit.\"\n  },\n  {\n    title: \"12. Changes to Privacy Policy\",\n    content: \"We may update our Privacy Policy from time to time. We will notify you of any changes by posting the new Privacy Policy on this page and updating the 'Last updated' date. You are advised to review this Privacy Policy periodically for any changes. Changes to this Privacy Policy are effective when they are posted on this page.\"\n  }\n];\n\nexport default function Privacy() {\n  return (\n    <div className=\"container mx-auto p-6 max-w-4xl\">\n      <div className=\"mb-8\">\n        <div className=\"flex items-center gap-2 mb-4\">\n          <Lock className=\"h-8 w-8 text-primary\" />\n          <h1 className=\"text-3xl font-bold\">Privacy Policy</h1>\n        </div>\n        <p className=\"text-muted-foreground\">\n          Last updated: {new Date().toLocaleDateString('en-US', { month: 'long', day: 'numeric', year: 'numeric' })}\n        </p>\n      </div>\n\n      <Card className=\"mb-6\">\n        <CardContent className=\"pt-6\">\n          <p className=\"text-muted-foreground\">\n            This Privacy Policy describes how we collect, use, and share your personal information when you use our platform. \n            We are committed to protecting your privacy and ensuring the security of your personal information.\n          </p>\n        </CardContent>\n      </Card>\n\n      <div className=\"space-y-6\">\n        {sections.map((section) => (\n          <Card key={section.title} data-testid={`section-${section.title.toLowerCase().replace(/[^a-z0-9]+/g, '-')}`}>\n            <CardHeader>\n              <CardTitle className=\"text-lg\">{section.title}</CardTitle>\n            </CardHeader>\n            <CardContent>\n              <p className=\"text-muted-foreground\">{section.content}</p>\n            </CardContent>\n          </Card>\n        ))}\n      </div>\n\n      <Card className=\"mt-8\">\n        <CardHeader>\n          <CardTitle>Contact Us</CardTitle>\n        </CardHeader>\n        <CardContent>\n          <p className=\"text-muted-foreground\">\n            If you have any questions about this Privacy Policy or our data practices, please contact our privacy team \n            through the Help & Support page.\n          </p>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","size_bytes":7285},"client/src/components/ui/avatar.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as AvatarPrimitive from \"@radix-ui/react-avatar\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Avatar = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full\",\n      className\n    )}\n    {...props}\n  />\n))\nAvatar.displayName = AvatarPrimitive.Root.displayName\n\nconst AvatarImage = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Image>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Image>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Image\n    ref={ref}\n    className={cn(\"aspect-square h-full w-full\", className)}\n    {...props}\n  />\n))\nAvatarImage.displayName = AvatarPrimitive.Image.displayName\n\nconst AvatarFallback = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Fallback>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Fallback>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Fallback\n    ref={ref}\n    className={cn(\n      \"flex h-full w-full items-center justify-center rounded-full bg-muted\",\n      className\n    )}\n    {...props}\n  />\n))\nAvatarFallback.displayName = AvatarPrimitive.Fallback.displayName\n\nexport { Avatar, AvatarImage, AvatarFallback }\n","size_bytes":1419},"client/src/components/ui/navigation-menu.tsx":{"content":"import * as React from \"react\"\nimport * as NavigationMenuPrimitive from \"@radix-ui/react-navigation-menu\"\nimport { cva } from \"class-variance-authority\"\nimport { ChevronDown } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst NavigationMenu = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Root>\n>(({ className, children, ...props }, ref) => (\n  <NavigationMenuPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative z-10 flex max-w-max flex-1 items-center justify-center\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <NavigationMenuViewport />\n  </NavigationMenuPrimitive.Root>\n))\nNavigationMenu.displayName = NavigationMenuPrimitive.Root.displayName\n\nconst NavigationMenuList = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.List\n    ref={ref}\n    className={cn(\n      \"group flex flex-1 list-none items-center justify-center space-x-1\",\n      className\n    )}\n    {...props}\n  />\n))\nNavigationMenuList.displayName = NavigationMenuPrimitive.List.displayName\n\nconst NavigationMenuItem = NavigationMenuPrimitive.Item\n\nconst navigationMenuTriggerStyle = cva(\n  \"group inline-flex h-10 w-max items-center justify-center rounded-md bg-background px-4 py-2 text-sm font-medium transition-colors hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground focus:outline-none disabled:pointer-events-none disabled:opacity-50 data-[state=open]:text-accent-foreground data-[state=open]:bg-accent/50 data-[state=open]:hover:bg-accent data-[state=open]:focus:bg-accent\"\n)\n\nconst NavigationMenuTrigger = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <NavigationMenuPrimitive.Trigger\n    ref={ref}\n    className={cn(navigationMenuTriggerStyle(), \"group\", className)}\n    {...props}\n  >\n    {children}{\" \"}\n    <ChevronDown\n      className=\"relative top-[1px] ml-1 h-3 w-3 transition duration-200 group-data-[state=open]:rotate-180\"\n      aria-hidden=\"true\"\n    />\n  </NavigationMenuPrimitive.Trigger>\n))\nNavigationMenuTrigger.displayName = NavigationMenuPrimitive.Trigger.displayName\n\nconst NavigationMenuContent = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.Content\n    ref={ref}\n    className={cn(\n      \"left-0 top-0 w-full data-[motion^=from-]:animate-in data-[motion^=to-]:animate-out data-[motion^=from-]:fade-in data-[motion^=to-]:fade-out data-[motion=from-end]:slide-in-from-right-52 data-[motion=from-start]:slide-in-from-left-52 data-[motion=to-end]:slide-out-to-right-52 data-[motion=to-start]:slide-out-to-left-52 md:absolute md:w-auto \",\n      className\n    )}\n    {...props}\n  />\n))\nNavigationMenuContent.displayName = NavigationMenuPrimitive.Content.displayName\n\nconst NavigationMenuLink = NavigationMenuPrimitive.Link\n\nconst NavigationMenuViewport = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Viewport>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Viewport>\n>(({ className, ...props }, ref) => (\n  <div className={cn(\"absolute left-0 top-full flex justify-center\")}>\n    <NavigationMenuPrimitive.Viewport\n      className={cn(\n        \"origin-top-center relative mt-1.5 h-[var(--radix-navigation-menu-viewport-height)] w-full overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-90 md:w-[var(--radix-navigation-menu-viewport-width)]\",\n        className\n      )}\n      ref={ref}\n      {...props}\n    />\n  </div>\n))\nNavigationMenuViewport.displayName =\n  NavigationMenuPrimitive.Viewport.displayName\n\nconst NavigationMenuIndicator = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Indicator>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Indicator>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.Indicator\n    ref={ref}\n    className={cn(\n      \"top-full z-[1] flex h-1.5 items-end justify-center overflow-hidden data-[state=visible]:animate-in data-[state=hidden]:animate-out data-[state=hidden]:fade-out data-[state=visible]:fade-in\",\n      className\n    )}\n    {...props}\n  >\n    <div className=\"relative top-[60%] h-2 w-2 rotate-45 rounded-tl-sm bg-border shadow-md\" />\n  </NavigationMenuPrimitive.Indicator>\n))\nNavigationMenuIndicator.displayName =\n  NavigationMenuPrimitive.Indicator.displayName\n\nexport {\n  navigationMenuTriggerStyle,\n  NavigationMenu,\n  NavigationMenuList,\n  NavigationMenuItem,\n  NavigationMenuContent,\n  NavigationMenuTrigger,\n  NavigationMenuLink,\n  NavigationMenuIndicator,\n  NavigationMenuViewport,\n}\n","size_bytes":5128},"client/src/pages/Settings.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { useAuth } from \"@/hooks/useAuth\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { isUnauthorizedError } from \"@/lib/authUtils\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { ObjectUploader } from \"@/components/ObjectUploader\";\nimport Header from \"@/components/layout/Header\";\nimport Footer from \"@/components/layout/Footer\";\nimport AgeVerification from \"@/components/safety/AgeVerification\";\nimport ConsentManagement from \"@/components/safety/ConsentManagement\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Switch } from \"@/components/ui/switch\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { Avatar, AvatarImage, AvatarFallback } from \"@/components/ui/avatar\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { \n  Settings as SettingsIcon, \n  User, \n  Shield, \n  Bell, \n  CreditCard,\n  Lock,\n  Eye,\n  Upload,\n  Trash2,\n  Save,\n  Camera\n} from \"lucide-react\";\n\nexport default function Settings() {\n  const { user, isAuthenticated } = useAuth();\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n  const [activeTab, setActiveTab] = useState(\"profile\");\n\n  // Profile form state\n  const [profileForm, setProfileForm] = useState({\n    displayName: \"\",\n    bio: \"\",\n    packType: \"\",\n    isAftercareFriendly: false,\n    allowsFreeAccess: false,\n    avatarUrl: \"\",\n    bannerUrl: \"\",\n  });\n\n  // Redirect if not authenticated\n  useEffect(() => {\n    if (!isAuthenticated) {\n      toast({\n        title: \"Unauthorized\",\n        description: \"You are logged out. Logging in again...\",\n        variant: \"destructive\",\n      });\n      setTimeout(() => {\n        window.location.href = \"/api/login\";\n      }, 500);\n      return;\n    }\n  }, [isAuthenticated, toast]);\n\n  const { data: profile, isLoading: profileLoading } = useQuery({\n    queryKey: ['/api/profile', user?.id],\n    enabled: isAuthenticated && !!user?.id,\n  });\n\n  const { data: consents } = useQuery({\n    queryKey: ['/api/consent'],\n    enabled: isAuthenticated,\n  });\n\n  // Update form when profile loads\n  useEffect(() => {\n    if (profile?.profile) {\n      setProfileForm({\n        displayName: profile.profile.displayName || \"\",\n        bio: profile.profile.bio || \"\",\n        packType: profile.profile.packType || \"\",\n        isAftercareFriendly: profile.profile.isAftercareFriendly || false,\n        allowsFreeAccess: profile.profile.allowsFreeAccess || false,\n        avatarUrl: profile.profile.avatarUrl || \"\",\n        bannerUrl: profile.profile.bannerUrl || \"\",\n      });\n    }\n  }, [profile]);\n\n  const updateProfileMutation = useMutation({\n    mutationFn: async (data: any) => {\n      await apiRequest('PUT', '/api/profile', data);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['/api/profile'] });\n      toast({\n        title: \"Success!\",\n        description: \"Profile updated successfully!\",\n      });\n    },\n    onError: (error) => {\n      if (isUnauthorizedError(error as Error)) {\n        toast({\n          title: \"Unauthorized\",\n          description: \"You are logged out. Logging in again...\",\n          variant: \"destructive\",\n        });\n        setTimeout(() => {\n          window.location.href = \"/api/login\";\n        }, 500);\n        return;\n      }\n      toast({\n        title: \"Error\",\n        description: \"Failed to update profile. Please try again.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const handleProfileSubmit = (e: React.FormEvent) => {\n    e.preventDefault();\n    updateProfileMutation.mutate(profileForm);\n  };\n\n  const handleInputChange = (field: string, value: any) => {\n    setProfileForm(prev => ({ ...prev, [field]: value }));\n  };\n\n  // Handle file upload completion\n  const handleUploadComplete = async (result: any, type: 'avatar' | 'banner') => {\n    if (result.successful && result.successful.length > 0) {\n      try {\n        const uploadedFile = result.successful[0];\n        const response = await apiRequest('PUT', '/api/media-upload', {\n          mediaUrl: uploadedFile.uploadURL\n        }) as { objectPath: string };\n        \n        const objectPath = response.objectPath;\n        \n        // Update form with new image URL\n        setProfileForm(prev => ({\n          ...prev,\n          [type === 'avatar' ? 'avatarUrl' : 'bannerUrl']: objectPath\n        }));\n        \n        toast({\n          title: \"Upload Successful!\",\n          description: `${type === 'avatar' ? 'Avatar' : 'Banner'} uploaded successfully!`,\n        });\n      } catch (error) {\n        console.error('Error finalizing upload:', error);\n        toast({\n          title: \"Upload Error\",\n          description: \"Failed to finalize upload. Please try again.\",\n          variant: \"destructive\",\n        });\n      }\n    }\n  };\n\n  // Get upload parameters for ObjectUploader\n  const getUploadParameters = async () => {\n    try {\n      const response = await apiRequest('POST', '/api/objects/upload');\n      const data = await response.json();\n      return {\n        method: 'PUT' as const,\n        url: data.uploadURL,\n      };\n    } catch (error) {\n      console.error('Error getting upload parameters:', error);\n      throw error;\n    }\n  };\n\n  if (!isAuthenticated) {\n    return null;\n  }\n\n  return (\n    <div className=\"min-h-screen\">\n      <Header />\n      \n      <main className=\"pt-40 pb-16\">\n        <div className=\"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8\">\n          <div className=\"mb-8\">\n            <h1 className=\"neon-heading text-3xl mb-2\">\n              Pack\n              <span className=\"neon-text-accent ml-2\">Settings</span>\n            </h1>\n            <p className=\"text-muted\">Manage your profile, safety settings, and preferences</p>\n          </div>\n\n          <Tabs value={activeTab} onValueChange={setActiveTab} className=\"space-y-6\">\n            <TabsList className=\"grid w-full grid-cols-5 bg-card border border-border\">\n              <TabsTrigger value=\"profile\" data-testid=\"tab-profile\">\n                <User className=\"h-4 w-4 mr-2\" />\n                Profile\n              </TabsTrigger>\n              <TabsTrigger value=\"safety\" data-testid=\"tab-safety\">\n                <Shield className=\"h-4 w-4 mr-2\" />\n                Safety\n              </TabsTrigger>\n              <TabsTrigger value=\"notifications\" data-testid=\"tab-notifications\">\n                <Bell className=\"h-4 w-4 mr-2\" />\n                Notifications\n              </TabsTrigger>\n              <TabsTrigger value=\"privacy\" data-testid=\"tab-privacy\">\n                <Eye className=\"h-4 w-4 mr-2\" />\n                Privacy\n              </TabsTrigger>\n              <TabsTrigger value=\"account\" data-testid=\"tab-account\">\n                <Lock className=\"h-4 w-4 mr-2\" />\n                Account\n              </TabsTrigger>\n            </TabsList>\n\n            {/* Profile Settings */}\n            <TabsContent value=\"profile\" className=\"space-y-6\">\n              <Card className=\"pack-card\">\n                <CardHeader>\n                  <CardTitle>Profile Information</CardTitle>\n                </CardHeader>\n                <CardContent>\n                  <form onSubmit={handleProfileSubmit} className=\"space-y-6\">\n                    {/* Avatar Section */}\n                    <div className=\"flex items-center space-x-6\">\n                      <Avatar className=\"w-20 h-20 border-2 border-primary/30\">\n                        <AvatarImage src={profileForm.avatarUrl || profile?.profileImageUrl} />\n                        <AvatarFallback className=\"text-xl\">\n                          {(profileForm.displayName || user?.username)?.charAt(0).toUpperCase()}\n                        </AvatarFallback>\n                      </Avatar>\n                      <div>\n                        <ObjectUploader\n                          maxNumberOfFiles={1}\n                          maxFileSize={5 * 1024 * 1024} // 5MB\n                          onGetUploadParameters={getUploadParameters}\n                          onComplete={(result) => handleUploadComplete(result, 'avatar')}\n                          buttonClassName=\"btn-outline\"\n                        >\n                          <Camera className=\"h-4 w-4 mr-2\" />\n                          Upload New Avatar\n                        </ObjectUploader>\n                        <p className=\"text-sm text-muted mt-2\">JPG, PNG up to 5MB</p>\n                      </div>\n                    </div>\n\n                    {/* Banner Section */}\n                    <div className=\"space-y-3\">\n                      <Label>Profile Banner</Label>\n                      <div className=\"relative h-32 bg-moonyard rounded-lg overflow-hidden border-2 border-dashed border-border\">\n                        {profileForm.bannerUrl ? (\n                          <img \n                            src={profileForm.bannerUrl} \n                            alt=\"Profile banner\"\n                            className=\"w-full h-full object-cover\"\n                          />\n                        ) : (\n                          <div className=\"flex items-center justify-center h-full text-muted\">\n                            <div className=\"text-center\">\n                              <Upload className=\"h-8 w-8 mx-auto mb-2\" />\n                              <p>Upload a banner image</p>\n                            </div>\n                          </div>\n                        )}\n                        <div className=\"absolute bottom-3 right-3\">\n                          <ObjectUploader\n                            maxNumberOfFiles={1}\n                            maxFileSize={10 * 1024 * 1024} // 10MB for banners\n                            onGetUploadParameters={getUploadParameters}\n                            onComplete={(result) => handleUploadComplete(result, 'banner')}\n                            buttonClassName=\"btn-outline btn-sm\"\n                          >\n                            <Camera className=\"h-4 w-4 mr-2\" />\n                            Upload Banner\n                          </ObjectUploader>\n                        </div>\n                      </div>\n                    </div>\n\n                    <div className=\"grid md:grid-cols-2 gap-6\">\n                      <div>\n                        <Label htmlFor=\"displayName\">Display Name</Label>\n                        <Input\n                          id=\"displayName\"\n                          value={profileForm.displayName}\n                          onChange={(e) => handleInputChange('displayName', e.target.value)}\n                          placeholder=\"Your pack name\"\n                          className=\"form-input\"\n                          data-testid=\"input-display-name\"\n                        />\n                      </div>\n\n                      <div>\n                        <Label htmlFor=\"packType\">Pack Type</Label>\n                        <Select \n                          value={profileForm.packType} \n                          onValueChange={(value) => handleInputChange('packType', value)}\n                        >\n                          <SelectTrigger className=\"form-select\" data-testid=\"select-pack-type\">\n                            <SelectValue placeholder=\"Select your pack type\" />\n                          </SelectTrigger>\n                          <SelectContent>\n                            <SelectItem value=\"alpha\">Alpha Leader</SelectItem>\n                            <SelectItem value=\"playful\">Playful Pup</SelectItem>\n                            <SelectItem value=\"supportive\">Supportive Pack</SelectItem>\n                            <SelectItem value=\"training\">Training Focus</SelectItem>\n                          </SelectContent>\n                        </Select>\n                      </div>\n                    </div>\n\n                    <div>\n                      <Label htmlFor=\"bio\">Bio</Label>\n                      <Textarea\n                        id=\"bio\"\n                        value={profileForm.bio}\n                        onChange={(e) => handleInputChange('bio', e.target.value)}\n                        placeholder=\"Tell your pack about yourself...\"\n                        rows={4}\n                        className=\"form-textarea\"\n                        data-testid=\"textarea-bio\"\n                      />\n                    </div>\n\n                    <div className=\"flex items-center space-x-3\">\n                      <Switch\n                        id=\"aftercare\"\n                        checked={profileForm.isAftercareFriendly}\n                        onCheckedChange={(checked) => handleInputChange('isAftercareFriendly', checked)}\n                        data-testid=\"switch-aftercare\"\n                      />\n                      <div>\n                        <Label htmlFor=\"aftercare\" className=\"font-medium\">Aftercare-Friendly</Label>\n                        <p className=\"text-sm text-muted\">Show that you prioritize aftercare in your content</p>\n                      </div>\n                    </div>\n\n                    {user?.role === 'creator' && (\n                      <div className=\"flex items-center space-x-3\">\n                        <Switch\n                          id=\"freeAccess\"\n                          checked={profileForm.allowsFreeAccess}\n                          onCheckedChange={(checked) => handleInputChange('allowsFreeAccess', checked)}\n                          data-testid=\"switch-free-access\"\n                        />\n                        <div>\n                          <Label htmlFor=\"freeAccess\" className=\"font-medium\">Allow Free Preview Access</Label>\n                          <p className=\"text-sm text-muted\">Allow age-verified fans to preview your content for free (requires VerifyMy age verification)</p>\n                        </div>\n                      </div>\n                    )}\n\n                    <Button \n                      type=\"submit\" \n                      className=\"btn-primary\"\n                      disabled={updateProfileMutation.isPending}\n                      data-testid=\"button-save-profile\"\n                    >\n                      <Save className=\"h-4 w-4 mr-2\" />\n                      {updateProfileMutation.isPending ? 'Saving...' : 'Save Changes'}\n                    </Button>\n                  </form>\n                </CardContent>\n              </Card>\n\n              {/* Current Status */}\n              <Card className=\"pack-card\">\n                <CardHeader>\n                  <CardTitle>Pack Status</CardTitle>\n                </CardHeader>\n                <CardContent>\n                  <div className=\"space-y-4\">\n                    <div className=\"flex items-center justify-between\">\n                      <span>Age Verification</span>\n                      <Badge className={profile?.profile?.ageVerified ? \"safety-badge-verified\" : \"bg-warning/20 text-warning\"}>\n                        {profile?.profile?.ageVerified ? \"Verified\" : \"Pending\"}\n                      </Badge>\n                    </div>\n                    <div className=\"flex items-center justify-between\">\n                      <span>KYC Status</span>\n                      <Badge className={profile?.profile?.kycStatus === 'verified' ? \"safety-badge-consent\" : \"bg-warning/20 text-warning\"}>\n                        {profile?.profile?.kycStatus || \"Pending\"}\n                      </Badge>\n                    </div>\n                    <div className=\"flex items-center justify-between\">\n                      <span>Account Type</span>\n                      <Badge variant=\"outline\">{user?.role || \"Fan\"}</Badge>\n                    </div>\n                  </div>\n                </CardContent>\n              </Card>\n            </TabsContent>\n\n            {/* Safety Settings */}\n            <TabsContent value=\"safety\" className=\"space-y-6\">\n              <AgeVerification />\n              <ConsentManagement />\n              \n              <Card className=\"pack-card\">\n                <CardHeader>\n                  <CardTitle>Content Safety</CardTitle>\n                </CardHeader>\n                <CardContent className=\"space-y-4\">\n                  <div className=\"flex items-center justify-between\">\n                    <div>\n                      <p className=\"font-medium\">Content Warnings</p>\n                      <p className=\"text-sm text-muted\">Automatically add content warnings to uploads</p>\n                    </div>\n                    <Switch defaultChecked data-testid=\"switch-content-warnings\" />\n                  </div>\n                  \n                  <div className=\"flex items-center justify-between\">\n                    <div>\n                      <p className=\"font-medium\">Safe Mode</p>\n                      <p className=\"text-sm text-muted\">Filter potentially sensitive content</p>\n                    </div>\n                    <Switch data-testid=\"switch-safe-mode\" />\n                  </div>\n                </CardContent>\n              </Card>\n            </TabsContent>\n\n            {/* Notifications */}\n            <TabsContent value=\"notifications\" className=\"space-y-6\">\n              <Card className=\"pack-card\">\n                <CardHeader>\n                  <CardTitle>Pack Notifications</CardTitle>\n                </CardHeader>\n                <CardContent className=\"space-y-4\">\n                  <div className=\"flex items-center justify-between\">\n                    <div>\n                      <p className=\"font-medium\">New Pack Members</p>\n                      <p className=\"text-sm text-muted\">Get notified when someone joins your pack</p>\n                    </div>\n                    <Switch defaultChecked data-testid=\"switch-new-members\" />\n                  </div>\n                  \n                  <div className=\"flex items-center justify-between\">\n                    <div>\n                      <p className=\"font-medium\">Tips & Payments</p>\n                      <p className=\"text-sm text-muted\">Notifications for tips and subscription payments</p>\n                    </div>\n                    <Switch defaultChecked data-testid=\"switch-payments\" />\n                  </div>\n                  \n                  <div className=\"flex items-center justify-between\">\n                    <div>\n                      <p className=\"font-medium\">Messages</p>\n                      <p className=\"text-sm text-muted\">New message notifications</p>\n                    </div>\n                    <Switch defaultChecked data-testid=\"switch-messages\" />\n                  </div>\n                  \n                  <div className=\"flex items-center justify-between\">\n                    <div>\n                      <p className=\"font-medium\">Content Updates</p>\n                      <p className=\"text-sm text-muted\">Notifications when creators you follow post new content</p>\n                    </div>\n                    <Switch defaultChecked data-testid=\"switch-content-updates\" />\n                  </div>\n                </CardContent>\n              </Card>\n\n              <Card className=\"pack-card\">\n                <CardHeader>\n                  <CardTitle>Delivery Preferences</CardTitle>\n                </CardHeader>\n                <CardContent className=\"space-y-4\">\n                  <div className=\"flex items-center justify-between\">\n                    <div>\n                      <p className=\"font-medium\">Email Notifications</p>\n                      <p className=\"text-sm text-muted\">Receive notifications via email</p>\n                    </div>\n                    <Switch defaultChecked data-testid=\"switch-email\" />\n                  </div>\n                  \n                  <div className=\"flex items-center justify-between\">\n                    <div>\n                      <p className=\"font-medium\">Push Notifications</p>\n                      <p className=\"text-sm text-muted\">Browser and mobile push notifications</p>\n                    </div>\n                    <Switch defaultChecked data-testid=\"switch-push\" />\n                  </div>\n                </CardContent>\n              </Card>\n            </TabsContent>\n\n            {/* Privacy */}\n            <TabsContent value=\"privacy\" className=\"space-y-6\">\n              <Card className=\"pack-card\">\n                <CardHeader>\n                  <CardTitle>Profile Privacy</CardTitle>\n                </CardHeader>\n                <CardContent className=\"space-y-4\">\n                  <div className=\"flex items-center justify-between\">\n                    <div>\n                      <p className=\"font-medium\">Show Online Status</p>\n                      <p className=\"text-sm text-muted\">Let others see when you're online</p>\n                    </div>\n                    <Switch defaultChecked data-testid=\"switch-online-status\" />\n                  </div>\n                  \n                  <div className=\"flex items-center justify-between\">\n                    <div>\n                      <p className=\"font-medium\">Public Profile</p>\n                      <p className=\"text-sm text-muted\">Make your profile visible to non-subscribers</p>\n                    </div>\n                    <Switch defaultChecked data-testid=\"switch-public-profile\" />\n                  </div>\n                  \n                  <div className=\"flex items-center justify-between\">\n                    <div>\n                      <p className=\"font-medium\">Show Pack Count</p>\n                      <p className=\"text-sm text-muted\">Display your subscriber count publicly</p>\n                    </div>\n                    <Switch defaultChecked data-testid=\"switch-pack-count\" />\n                  </div>\n                </CardContent>\n              </Card>\n\n              <Card className=\"pack-card\">\n                <CardHeader>\n                  <CardTitle>Data & Privacy</CardTitle>\n                </CardHeader>\n                <CardContent className=\"space-y-4\">\n                  <Button variant=\"outline\" className=\"w-full justify-start\" data-testid=\"button-download-data\">\n                    <Upload className=\"h-4 w-4 mr-2\" />\n                    Download My Data\n                  </Button>\n                  <Button variant=\"outline\" className=\"w-full justify-start\" data-testid=\"button-privacy-settings\">\n                    <Shield className=\"h-4 w-4 mr-2\" />\n                    Advanced Privacy Settings\n                  </Button>\n                </CardContent>\n              </Card>\n            </TabsContent>\n\n            {/* Account */}\n            <TabsContent value=\"account\" className=\"space-y-6\">\n              <Card className=\"pack-card\">\n                <CardHeader>\n                  <CardTitle>Account Security</CardTitle>\n                </CardHeader>\n                <CardContent className=\"space-y-4\">\n                  <div className=\"space-y-3\">\n                    <Label>Change Password</Label>\n                    <Input type=\"password\" placeholder=\"Current password\" className=\"form-input\" data-testid=\"input-current-password\" />\n                    <Input type=\"password\" placeholder=\"New password\" className=\"form-input\" data-testid=\"input-new-password\" />\n                    <Input type=\"password\" placeholder=\"Confirm new password\" className=\"form-input\" data-testid=\"input-confirm-password\" />\n                    <Button variant=\"outline\" data-testid=\"button-change-password\">\n                      Update Password\n                    </Button>\n                  </div>\n                  \n                  <div className=\"pt-4 border-t border-border\">\n                    <div className=\"flex items-center justify-between\">\n                      <div>\n                        <p className=\"font-medium\">Two-Factor Authentication</p>\n                        <p className=\"text-sm text-muted\">Add an extra layer of security to your account</p>\n                      </div>\n                      <Button variant=\"outline\" data-testid=\"button-enable-2fa\">\n                        Enable\n                      </Button>\n                    </div>\n                  </div>\n                </CardContent>\n              </Card>\n\n              <Card className=\"pack-card border-destructive/50\">\n                <CardHeader>\n                  <CardTitle className=\"text-destructive\">Danger Zone</CardTitle>\n                </CardHeader>\n                <CardContent className=\"space-y-4\">\n                  <div className=\"flex items-center justify-between\">\n                    <div>\n                      <p className=\"font-medium\">Deactivate Account</p>\n                      <p className=\"text-sm text-muted\">Temporarily disable your account</p>\n                    </div>\n                    <Button variant=\"outline\" className=\"text-destructive border-destructive hover:bg-destructive/10\" data-testid=\"button-deactivate\">\n                      Deactivate\n                    </Button>\n                  </div>\n                  \n                  <div className=\"flex items-center justify-between\">\n                    <div>\n                      <p className=\"font-medium\">Delete Account</p>\n                      <p className=\"text-sm text-muted\">Permanently delete your account and all data</p>\n                    </div>\n                    <Button variant=\"destructive\" data-testid=\"button-delete-account\">\n                      <Trash2 className=\"h-4 w-4 mr-2\" />\n                      Delete Account\n                    </Button>\n                  </div>\n                </CardContent>\n              </Card>\n            </TabsContent>\n          </Tabs>\n        </div>\n      </main>\n\n      <Footer />\n    </div>\n  );\n}\n","size_bytes":26008},"client/src/components/onboarding/CreatorOnboarding.tsx":{"content":"import { useState } from \"react\";\nimport { useMutation, useQuery } from \"@tanstack/react-query\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogDescription,\n  DialogHeader,\n  DialogTitle,\n} from \"@/components/ui/dialog\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Progress } from \"@/components/ui/progress\";\nimport { \n  Star, Upload, Shield, DollarSign, Sparkles, \n  ArrowRight, ArrowLeft, CheckCircle \n} from \"lucide-react\";\n\ninterface CreatorOnboardingProps {\n  isOpen: boolean;\n  onComplete: () => void;\n}\n\nexport default function CreatorOnboarding({ isOpen, onComplete }: CreatorOnboardingProps) {\n  const { toast } = useToast();\n  const [currentStep, setCurrentStep] = useState(1);\n  const totalSteps = 5;\n\n  const [formData, setFormData] = useState({\n    displayName: '',\n    stageName: '',\n    pronouns: '',\n    bio: '',\n    niche: [] as string[],\n    paymentMethod: '',\n  });\n\n  const { data: user } = useQuery({\n    queryKey: ['/api/auth/user'],\n  });\n\n  const updateOnboardingMutation = useMutation({\n    mutationFn: async (data: any) => {\n      const response = await apiRequest('POST', '/api/onboarding/update', data);\n      return response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['/api/auth/user'] });\n    },\n    onError: (error) => {\n      toast({\n        title: \"Error\",\n        description: \"Failed to save progress. Please try again.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const completeOnboardingMutation = useMutation({\n    mutationFn: async () => {\n      const response = await apiRequest('POST', '/api/onboarding/complete', {});\n      return response.json();\n    },\n    onSuccess: () => {\n      toast({\n        title: \"Welcome to the creator community! ðŸŽ‰\",\n        description: \"Your profile is all set. Let's start creating!\",\n      });\n      queryClient.invalidateQueries({ queryKey: ['/api/auth/user'] });\n      onComplete();\n    },\n    onError: (error) => {\n      toast({\n        title: \"Error\",\n        description: \"Failed to complete onboarding. Please try again.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const handleNext = () => {\n    // Save current step data\n    updateOnboardingMutation.mutate({\n      step: currentStep,\n      data: formData,\n    });\n\n    if (currentStep < totalSteps) {\n      setCurrentStep(currentStep + 1);\n    }\n  };\n\n  const handleBack = () => {\n    if (currentStep > 1) {\n      setCurrentStep(currentStep - 1);\n    }\n  };\n\n  const handleComplete = () => {\n    updateOnboardingMutation.mutate({\n      step: currentStep,\n      data: formData,\n    });\n    setTimeout(() => {\n      completeOnboardingMutation.mutate();\n    }, 500);\n  };\n\n  const progress = (currentStep / totalSteps) * 100;\n\n  return (\n    <Dialog open={isOpen} onOpenChange={() => {}}>\n      <DialogContent className=\"sm:max-w-2xl bg-card border border-border\" data-testid=\"dialog-creator-onboarding\">\n        <DialogHeader>\n          <div className=\"flex items-center justify-center gap-2 mb-2\">\n            <Star className=\"w-6 h-6 text-primary\" />\n            <DialogTitle className=\"font-display text-2xl\">Creator Onboarding</DialogTitle>\n          </div>\n          <Progress value={progress} className=\"h-2\" data-testid=\"progress-onboarding\" />\n          <DialogDescription className=\"text-center mt-2\">\n            Step {currentStep} of {totalSteps}\n          </DialogDescription>\n        </DialogHeader>\n\n        <div className=\"mt-6\">\n          {/* Step 1: Welcome */}\n          {currentStep === 1 && (\n            <div className=\"space-y-6\" data-testid=\"step-welcome\">\n              <div className=\"text-center space-y-4\">\n                <Sparkles className=\"w-16 h-16 mx-auto text-primary\" />\n                <h3 className=\"font-display text-2xl\">Claim Your Star Power! â­</h3>\n                <p className=\"text-muted-foreground max-w-md mx-auto\">\n                  You're joining a creator-first platform where you keep 100% of your earnings, \n                  own all your content, and get the tools you need to succeed.\n                </p>\n                <div className=\"bg-primary/10 p-4 rounded-lg mt-4\">\n                  <h4 className=\"font-semibold mb-2\">What you'll get:</h4>\n                  <ul className=\"text-sm space-y-2 text-left max-w-sm mx-auto\">\n                    <li className=\"flex items-center gap-2\">\n                      <CheckCircle className=\"w-4 h-4 text-primary\" />\n                      100% earnings (you keep everything)\n                    </li>\n                    <li className=\"flex items-center gap-2\">\n                      <CheckCircle className=\"w-4 h-4 text-primary\" />\n                      Full content ownership\n                    </li>\n                    <li className=\"flex items-center gap-2\">\n                      <CheckCircle className=\"w-4 h-4 text-primary\" />\n                      Advanced creator dashboard\n                    </li>\n                    <li className=\"flex items-center gap-2\">\n                      <CheckCircle className=\"w-4 h-4 text-primary\" />\n                      Direct fan engagement tools\n                    </li>\n                  </ul>\n                </div>\n              </div>\n            </div>\n          )}\n\n          {/* Step 2: Profile Setup */}\n          {currentStep === 2 && (\n            <div className=\"space-y-4\" data-testid=\"step-profile\">\n              <h3 className=\"font-display text-xl text-center mb-4\">Let's set up your profile</h3>\n              <div>\n                <Label htmlFor=\"displayName\">Display Name *</Label>\n                <Input\n                  id=\"displayName\"\n                  value={formData.displayName}\n                  onChange={(e) => setFormData({ ...formData, displayName: e.target.value })}\n                  placeholder=\"Your name\"\n                  data-testid=\"input-display-name\"\n                />\n              </div>\n              <div>\n                <Label htmlFor=\"stageName\">Stage Name</Label>\n                <Input\n                  id=\"stageName\"\n                  value={formData.stageName}\n                  onChange={(e) => setFormData({ ...formData, stageName: e.target.value })}\n                  placeholder=\"Your creator/artist name (optional)\"\n                  data-testid=\"input-stage-name\"\n                />\n              </div>\n              <div>\n                <Label htmlFor=\"pronouns\">Pronouns</Label>\n                <Input\n                  id=\"pronouns\"\n                  value={formData.pronouns}\n                  onChange={(e) => setFormData({ ...formData, pronouns: e.target.value })}\n                  placeholder=\"e.g., she/her, he/him, they/them\"\n                  data-testid=\"input-pronouns\"\n                />\n              </div>\n              <div>\n                <Label htmlFor=\"bio\">Bio</Label>\n                <Textarea\n                  id=\"bio\"\n                  value={formData.bio}\n                  onChange={(e) => setFormData({ ...formData, bio: e.target.value })}\n                  placeholder=\"Tell your fans about yourself...\"\n                  rows={4}\n                  data-testid=\"textarea-bio\"\n                />\n              </div>\n            </div>\n          )}\n\n          {/* Step 3: Verification */}\n          {currentStep === 3 && (\n            <div className=\"space-y-6\" data-testid=\"step-verification\">\n              <div className=\"text-center\">\n                <Shield className=\"w-16 h-16 mx-auto text-primary mb-4\" />\n                <h3 className=\"font-display text-xl mb-2\">Verification & Compliance</h3>\n                <p className=\"text-muted-foreground mb-4\">\n                  To ensure safety and compliance, we need to verify your identity\n                </p>\n              </div>\n              <div className=\"bg-muted/50 p-6 rounded-lg space-y-4\">\n                <div className=\"flex items-start gap-3\">\n                  <div className=\"w-8 h-8 bg-primary/10 rounded-full flex items-center justify-center flex-shrink-0\">\n                    <span className=\"text-primary font-semibold\">1</span>\n                  </div>\n                  <div>\n                    <h4 className=\"font-semibold mb-1\">ID Verification</h4>\n                    <p className=\"text-sm text-muted-foreground\">\n                      Upload a valid government ID (seamless photo + selfie match)\n                    </p>\n                  </div>\n                </div>\n                <div className=\"flex items-start gap-3\">\n                  <div className=\"w-8 h-8 bg-primary/10 rounded-full flex items-center justify-center flex-shrink-0\">\n                    <span className=\"text-primary font-semibold\">2</span>\n                  </div>\n                  <div>\n                    <h4 className=\"font-semibold mb-1\">Age/Consent Forms</h4>\n                    <p className=\"text-sm text-muted-foreground\">\n                      Complete required consent forms (clear + supportive guidance)\n                    </p>\n                  </div>\n                </div>\n                <Button className=\"w-full mt-4\" variant=\"outline\" data-testid=\"button-start-verification\">\n                  <Upload className=\"w-4 h-4 mr-2\" />\n                  Start Verification Process\n                </Button>\n                <p className=\"text-xs text-center text-muted-foreground mt-2\">\n                  You can complete this step later from your dashboard\n                </p>\n              </div>\n            </div>\n          )}\n\n          {/* Step 4: Monetization */}\n          {currentStep === 4 && (\n            <div className=\"space-y-6\" data-testid=\"step-monetization\">\n              <div className=\"text-center\">\n                <DollarSign className=\"w-16 h-16 mx-auto text-primary mb-4\" />\n                <h3 className=\"font-display text-xl mb-2\">Monetization Setup</h3>\n                <p className=\"text-muted-foreground mb-4\">\n                  Set up how you'll receive your earnings\n                </p>\n              </div>\n              <div className=\"bg-primary/10 p-4 rounded-lg mb-4\">\n                <p className=\"text-center font-semibold\">\n                  100% of your earnings go directly to you!\n                </p>\n              </div>\n              <div>\n                <Label htmlFor=\"paymentMethod\">Payment Method</Label>\n                <select\n                  id=\"paymentMethod\"\n                  value={formData.paymentMethod}\n                  onChange={(e) => setFormData({ ...formData, paymentMethod: e.target.value })}\n                  className=\"w-full px-3 py-2 border rounded-md\"\n                  data-testid=\"select-payment-method\"\n                >\n                  <option value=\"\">Select payment method...</option>\n                  <option value=\"bank\">Bank Transfer</option>\n                  <option value=\"crypto\">Cryptocurrency</option>\n                  <option value=\"other\">Other (Setup later)</option>\n                </select>\n              </div>\n              <p className=\"text-xs text-center text-muted-foreground\">\n                You can update payment details anytime from settings\n              </p>\n            </div>\n          )}\n\n          {/* Step 5: Dashboard Intro */}\n          {currentStep === 5 && (\n            <div className=\"space-y-6\" data-testid=\"step-dashboard\">\n              <div className=\"text-center\">\n                <Sparkles className=\"w-16 h-16 mx-auto text-primary mb-4\" />\n                <h3 className=\"font-display text-2xl mb-2\">You're All Set! ðŸŽ‰</h3>\n                <p className=\"text-muted-foreground mb-4\">\n                  Your creator dashboard is ready. Here's what you can do:\n                </p>\n              </div>\n              <div className=\"space-y-3\">\n                <div className=\"flex items-start gap-3 p-3 bg-muted/50 rounded-lg\">\n                  <Upload className=\"w-5 h-5 text-primary mt-0.5\" />\n                  <div>\n                    <h4 className=\"font-semibold\">Upload Content</h4>\n                    <p className=\"text-sm text-muted-foreground\">\n                      Share photos, videos, and go live with your fans\n                    </p>\n                  </div>\n                </div>\n                <div className=\"flex items-start gap-3 p-3 bg-muted/50 rounded-lg\">\n                  <DollarSign className=\"w-5 h-5 text-primary mt-0.5\" />\n                  <div>\n                    <h4 className=\"font-semibold\">Set Your Prices</h4>\n                    <p className=\"text-sm text-muted-foreground\">\n                      Control subscriptions, tips, and exclusive content pricing\n                    </p>\n                  </div>\n                </div>\n                <div className=\"flex items-start gap-3 p-3 bg-muted/50 rounded-lg\">\n                  <Star className=\"w-5 h-5 text-primary mt-0.5\" />\n                  <div>\n                    <h4 className=\"font-semibold\">Engage Your Pack</h4>\n                    <p className=\"text-sm text-muted-foreground\">\n                      Chat with fans, respond to messages, and build your community\n                    </p>\n                  </div>\n                </div>\n              </div>\n            </div>\n          )}\n        </div>\n\n        {/* Navigation */}\n        <div className=\"flex justify-between mt-6\">\n          <Button\n            variant=\"outline\"\n            onClick={handleBack}\n            disabled={currentStep === 1}\n            data-testid=\"button-back\"\n          >\n            <ArrowLeft className=\"w-4 h-4 mr-2\" />\n            Back\n          </Button>\n          \n          {currentStep < totalSteps ? (\n            <Button\n              onClick={handleNext}\n              disabled={updateOnboardingMutation.isPending}\n              data-testid=\"button-next\"\n            >\n              {updateOnboardingMutation.isPending ? 'Saving...' : 'Next'}\n              <ArrowRight className=\"w-4 h-4 ml-2\" />\n            </Button>\n          ) : (\n            <Button\n              onClick={handleComplete}\n              disabled={completeOnboardingMutation.isPending}\n              className=\"btn-primary\"\n              data-testid=\"button-complete\"\n            >\n              {completeOnboardingMutation.isPending ? 'Completing...' : 'Complete Setup'}\n              <CheckCircle className=\"w-4 h-4 ml-2\" />\n            </Button>\n          )}\n        </div>\n      </DialogContent>\n    </Dialog>\n  );\n}\n","size_bytes":14610},"client/src/pages/Landing.tsx":{"content":"import { useState } from \"react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Card, CardContent } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport AuthModal from \"@/components/auth/AuthModal\";\nimport Header from \"@/components/layout/Header\";\nimport Footer from \"@/components/layout/Footer\";\nimport { PawPrint, Bolt, Shield, Heart, Users, Upload, Eye, Star } from \"lucide-react\";\n\nexport default function Landing() {\n  const [showAuthModal, setShowAuthModal] = useState(false);\n  const [authMode, setAuthMode] = useState<'login' | 'register'>('register');\n\n  const handleAuthClick = (mode: 'login' | 'register') => {\n    setAuthMode(mode);\n    setShowAuthModal(true);\n  };\n\n  return (\n    <div className=\"min-h-screen\">\n      <Header onAuthClick={handleAuthClick} />\n      \n      {/* Hero Section */}\n      <section className=\"relative pt-40 pb-16 bg-moonyard overflow-hidden\">\n        <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8\">\n          <div className=\"grid lg:grid-cols-2 gap-12 items-center\">\n            <div className=\"text-center lg:text-left\">\n              <h1 className=\"neon-heading text-5xl sm:text-6xl lg:text-7xl leading-tight mb-6\">\n                Find Your\n                <span className=\"neon-text-accent animate-pack-howl ml-4\">Pack</span>\n              </h1>\n              <p className=\"text-xl neon-text-secondary mb-8 max-w-2xl\">\n                The wild, high-energy creator platform where pups connect, share content, and build supportive communities. Safety-first, pack-centric, and built for authentic connections.\n              </p>\n              \n              {/* Dual Auth Options */}\n              <div className=\"flex flex-col sm:flex-row gap-4 mb-8\">\n                <Button \n                  className=\"btn-primary px-8 py-4 text-lg\"\n                  onClick={() => window.location.href = '/api/login'}\n                  data-testid=\"button-replit-auth\"\n                >\n                  <Bolt className=\"mr-2 h-5 w-5\" />\n                  Quick Start with Replit\n                </Button>\n                <Button \n                  variant=\"outline\" \n                  className=\"px-8 py-4 text-lg border-2 border-secondary text-secondary hover:bg-secondary/10\"\n                  onClick={() => handleAuthClick('register')}\n                  data-testid=\"button-register\"\n                >\n                  Create New Account\n                </Button>\n              </div>\n\n              {/* Safety Features */}\n              <div className=\"flex flex-wrap gap-3 justify-center lg:justify-start\">\n                <Badge className=\"safety-badge safety-badge-verified\" data-testid=\"badge-verified\">\n                  <Shield className=\"mr-2 h-3 w-3\" />\n                  18+ Verified\n                </Badge>\n                <Badge className=\"safety-badge safety-badge-consent\" data-testid=\"badge-consent\">\n                  <Heart className=\"mr-2 h-3 w-3\" />\n                  Consent-Clear\n                </Badge>\n                <Badge className=\"safety-badge safety-badge-aftercare\" data-testid=\"badge-pack-safe\">\n                  <Users className=\"mr-2 h-3 w-3\" />\n                  Pack-Safe\n                </Badge>\n              </div>\n            </div>\n\n            {/* Auth Preview */}\n            <div className=\"lg:max-w-md mx-auto w-full\">\n              <Card className=\"pack-card shadow-2xl\">\n                <CardContent className=\"p-6\">\n                  <div className=\"flex space-x-1 mb-6 bg-background rounded-lg p-1\">\n                    <Button \n                      className=\"flex-1 py-2 px-4 text-sm font-medium bg-primary text-primary-foreground rounded-md\"\n                      onClick={() => handleAuthClick('register')}\n                      data-testid=\"button-join-pack\"\n                    >\n                      Join Pack\n                    </Button>\n                    <Button \n                      variant=\"ghost\"\n                      className=\"flex-1 py-2 px-4 text-sm font-medium text-muted rounded-md hover:bg-background/50\"\n                      onClick={() => handleAuthClick('login')}\n                      data-testid=\"button-sign-in\"\n                    >\n                      Sign In\n                    </Button>\n                  </div>\n\n                  {/* Registration Form Preview */}\n                  <div className=\"space-y-4\">\n                    <div>\n                      <Label className=\"block text-sm font-medium text-foreground mb-2\">Pack Name</Label>\n                      <Input \n                        placeholder=\"YourPackName\" \n                        className=\"form-input\"\n                        data-testid=\"input-pack-name\"\n                      />\n                    </div>\n                    <div>\n                      <Label className=\"block text-sm font-medium text-foreground mb-2\">Email</Label>\n                      <Input \n                        type=\"email\" \n                        placeholder=\"pup@example.com\" \n                        className=\"form-input\"\n                        data-testid=\"input-email\"\n                      />\n                    </div>\n                    <div>\n                      <Label className=\"block text-sm font-medium text-foreground mb-2\">Password</Label>\n                      <Input \n                        type=\"password\" \n                        placeholder=\"â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢\" \n                        className=\"form-input\"\n                        data-testid=\"input-password\"\n                      />\n                    </div>\n\n                    {/* Age Verification Notice */}\n                    <div className=\"flex items-center space-x-3 p-4 bg-warning/10 border border-warning/20 rounded-lg\">\n                      <Shield className=\"h-5 w-5 text-warning\" />\n                      <div className=\"text-sm\">\n                        <span className=\"font-medium\">18+ Verification Required</span>\n                        <p className=\"text-muted\">Upload valid ID for age verification</p>\n                      </div>\n                    </div>\n\n                    <Button \n                      className=\"w-full btn-primary py-3\"\n                      onClick={() => handleAuthClick('register')}\n                      data-testid=\"button-join-pack-submit\"\n                    >\n                      Join the Pack\n                    </Button>\n                  </div>\n\n                  {/* Replit OAuth Alternative */}\n                  <div className=\"mt-6 pt-6 border-t border-border\">\n                    <Button \n                      className=\"w-full btn-secondary py-3\"\n                      onClick={() => window.location.href = '/api/login'}\n                      data-testid=\"button-replit-oauth\"\n                    >\n                      <PawPrint className=\"mr-3 h-5 w-5\" />\n                      Continue with Replit\n                    </Button>\n                  </div>\n                </CardContent>\n              </Card>\n            </div>\n          </div>\n        </div>\n      </section>\n\n      {/* Features Preview */}\n      <section className=\"py-16 bg-background\">\n        <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8\">\n          <div className=\"text-center mb-12\">\n            <h2 className=\"neon-heading text-4xl mb-4\">Built for Pack Energy</h2>\n            <p className=\"text-xl text-muted max-w-2xl mx-auto\">Everything you need to create, connect, and earn in a safe, supportive environment</p>\n          </div>\n\n          <div className=\"grid md:grid-cols-3 gap-8\">\n            <Card className=\"pack-card p-6 text-center\">\n              <div className=\"w-16 h-16 bg-primary/20 rounded-xl flex items-center justify-center mx-auto mb-4\">\n                <Upload className=\"h-8 w-8 text-primary\" />\n              </div>\n              <h3 className=\"neon-text-primary text-xl mb-2\">Content Creation</h3>\n              <p className=\"text-muted\">Upload and monetize your content with our creator-friendly tools and fair revenue sharing</p>\n            </Card>\n\n            <Card className=\"pack-card p-6 text-center\">\n              <div className=\"w-16 h-16 bg-secondary/20 rounded-xl flex items-center justify-center mx-auto mb-4\">\n                <Users className=\"h-8 w-8 text-secondary\" />\n              </div>\n              <h3 className=\"neon-text-secondary text-xl mb-2\">Pack Discovery</h3>\n              <p className=\"text-muted\">Find creators and communities that match your energy with our pack-based filtering system</p>\n            </Card>\n\n            <Card className=\"pack-card p-6 text-center\">\n              <div className=\"w-16 h-16 bg-accent/20 rounded-xl flex items-center justify-center mx-auto mb-4\">\n                <Shield className=\"h-8 w-8 text-accent\" />\n              </div>\n              <h3 className=\"neon-text-accent text-xl mb-2\">Safety First</h3>\n              <p className=\"text-muted\">Comprehensive safety features including age verification, consent management, and 24/7 moderation</p>\n            </Card>\n          </div>\n        </div>\n      </section>\n\n      {/* Creator Success Stories */}\n      <section className=\"py-16 bg-card/30\">\n        <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8\">\n          <div className=\"text-center mb-12\">\n            <h2 className=\"neon-heading text-4xl mb-4\">Success in the Pack</h2>\n            <p className=\"text-xl text-muted max-w-2xl mx-auto\">Real creators achieving their goals on PupFanz</p>\n          </div>\n\n          <div className=\"grid md:grid-cols-3 gap-8\">\n            <Card className=\"pack-card p-6\">\n              <div className=\"flex items-center space-x-4 mb-4\">\n                <div className=\"w-12 h-12 bg-gradient-to-br from-primary/20 to-secondary/20 rounded-xl flex items-center justify-center\">\n                  <PawPrint className=\"h-6 w-6 text-primary\" />\n                </div>\n                <div>\n                  <h4 className=\"font-semibold text-foreground\">AlphaWolf_Prime</h4>\n                  <div className=\"flex items-center space-x-2\">\n                    <Badge className=\"safety-badge safety-badge-verified\">Verified</Badge>\n                    <Badge className=\"safety-badge safety-badge-aftercare\">Aftercare</Badge>\n                  </div>\n                </div>\n              </div>\n              <div className=\"grid grid-cols-3 gap-2 mb-4\">\n                <div className=\"aspect-square bg-gradient-to-br from-primary/20 to-secondary/20 rounded-lg flex items-center justify-center\">\n                  <Eye className=\"h-4 w-4 text-primary\" />\n                </div>\n                <div className=\"aspect-square bg-gradient-to-br from-accent/20 to-primary/20 rounded-lg flex items-center justify-center\">\n                  <Star className=\"h-4 w-4 text-accent\" />\n                </div>\n                <div className=\"aspect-square bg-gradient-to-br from-secondary/20 to-accent/20 rounded-lg flex items-center justify-center\">\n                  <Heart className=\"h-4 w-4 text-secondary\" />\n                </div>\n              </div>\n              <div className=\"flex items-center justify-between text-sm text-muted\">\n                <span data-testid=\"text-subscribers\">2.3K pack</span>\n                <span data-testid=\"text-earnings\">$4.2K earned</span>\n              </div>\n            </Card>\n\n            <Card className=\"pack-card p-6\">\n              <div className=\"flex items-center space-x-4 mb-4\">\n                <div className=\"w-12 h-12 bg-gradient-to-br from-accent/20 to-secondary/20 rounded-xl flex items-center justify-center\">\n                  <PawPrint className=\"h-6 w-6 text-accent\" />\n                </div>\n                <div>\n                  <h4 className=\"font-semibold text-foreground\">PlayfulPup_99</h4>\n                  <div className=\"flex items-center space-x-2\">\n                    <Badge className=\"safety-badge safety-badge-verified\">Verified</Badge>\n                    <Badge className=\"safety-badge safety-badge-consent\">Safe</Badge>\n                  </div>\n                </div>\n              </div>\n              <div className=\"grid grid-cols-3 gap-2 mb-4\">\n                <div className=\"aspect-square bg-gradient-to-br from-accent/20 to-secondary/20 rounded-lg flex items-center justify-center\">\n                  <Eye className=\"h-4 w-4 text-accent\" />\n                </div>\n                <div className=\"aspect-square bg-gradient-to-br from-primary/20 to-accent/20 rounded-lg flex items-center justify-center\">\n                  <Star className=\"h-4 w-4 text-primary\" />\n                </div>\n                <div className=\"aspect-square bg-gradient-to-br from-secondary/20 to-primary/20 rounded-lg flex items-center justify-center\">\n                  <Heart className=\"h-4 w-4 text-secondary\" />\n                </div>\n              </div>\n              <div className=\"flex items-center justify-between text-sm text-muted\">\n                <span data-testid=\"text-subscribers\">1.8K pack</span>\n                <span data-testid=\"text-earnings\">$3.1K earned</span>\n              </div>\n            </Card>\n\n            <Card className=\"pack-card p-6\">\n              <div className=\"flex items-center space-x-4 mb-4\">\n                <div className=\"w-12 h-12 bg-gradient-to-br from-secondary/20 to-primary/20 rounded-xl flex items-center justify-center\">\n                  <PawPrint className=\"h-6 w-6 text-secondary\" />\n                </div>\n                <div>\n                  <h4 className=\"font-semibold text-foreground\">GamerPup_Elite</h4>\n                  <div className=\"flex items-center space-x-2\">\n                    <Badge className=\"safety-badge safety-badge-verified\">Verified</Badge>\n                    <Badge className=\"safety-badge-consent\">Gaming</Badge>\n                  </div>\n                </div>\n              </div>\n              <div className=\"grid grid-cols-3 gap-2 mb-4\">\n                <div className=\"aspect-square bg-gradient-to-br from-secondary/20 to-primary/20 rounded-lg flex items-center justify-center\">\n                  <Eye className=\"h-4 w-4 text-secondary\" />\n                </div>\n                <div className=\"aspect-square bg-gradient-to-br from-primary/20 to-secondary/20 rounded-lg flex items-center justify-center\">\n                  <Star className=\"h-4 w-4 text-primary\" />\n                </div>\n                <div className=\"aspect-square bg-gradient-to-br from-accent/20 to-primary/20 rounded-lg flex items-center justify-center\">\n                  <Heart className=\"h-4 w-4 text-accent\" />\n                </div>\n              </div>\n              <div className=\"flex items-center justify-between text-sm text-muted\">\n                <span data-testid=\"text-subscribers\">945 pack</span>\n                <span data-testid=\"text-earnings\">$1.9K earned</span>\n              </div>\n            </Card>\n          </div>\n        </div>\n      </section>\n\n      <Footer />\n\n      {/* Auth Modal */}\n      <AuthModal \n        isOpen={showAuthModal}\n        onClose={() => setShowAuthModal(false)}\n        mode={authMode}\n        onModeChange={setAuthMode}\n      />\n    </div>\n  );\n}\n","size_bytes":15222},"client/src/pages/Moderation.tsx":{"content":"import { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { queryClient, apiRequest } from \"@/lib/queryClient\";\nimport { useAuth } from \"@/hooks/useAuth\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Dialog, DialogContent, DialogDescription, DialogFooter, DialogHeader, DialogTitle } from \"@/components/ui/dialog\";\nimport { Label } from \"@/components/ui/label\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { \n  Shield, AlertTriangle, CheckCircle, XCircle, \n  ThumbsUp, ThumbsDown, HelpCircle, Award, TrendingUp \n} from \"lucide-react\";\nimport { useState } from \"react\";\nimport { formatDistanceToNow } from \"date-fns\";\n\ninterface Report {\n  id: string;\n  reportType: string;\n  severity: string;\n  status: string;\n  description: string;\n  createdAt: string;\n  reporter: { id: string; username: string };\n  reportedUser?: { id: string; username: string };\n  reportedContent?: { id: string; title: string; mimeType: string };\n  contentId?: string;\n  votingStats: {\n    totalVotes: number;\n    validVotes: number;\n    invalidVotes: number;\n    unsureVotes: number;\n    avgVoterReputation: number;\n    weightedValidPercent: number;\n    weightedInvalidPercent: number;\n  };\n}\n\ninterface SafetyScore {\n  contentId: string;\n  overallScore: number;\n  reportCount: number;\n  aiFlags: number;\n  communityTrust: number;\n  humanReviewStatus: string;\n  riskLevel: string;\n}\n\ninterface AIFlag {\n  id: string;\n  flagType: string;\n  confidence: number;\n  details: any;\n  reviewed: boolean;\n  override: boolean;\n}\n\nexport default function Moderation() {\n  const { user } = useAuth();\n  const { toast } = useToast();\n  const [selectedReport, setSelectedReport] = useState<Report | null>(null);\n  const [resolveDialogOpen, setResolveDialogOpen] = useState(false);\n  const [voteDialogOpen, setVoteDialogOpen] = useState(false);\n  const [voteType, setVoteType] = useState<'valid' | 'invalid' | 'unsure'>('valid');\n  const [voteReason, setVoteReason] = useState('');\n  const [resolveAction, setResolveAction] = useState<'resolved' | 'dismissed' | 'escalated'>('resolved');\n  const [resolution, setResolution] = useState('');\n  const [createReportOpen, setCreateReportOpen] = useState(false);\n  const [reportType, setReportType] = useState('underage');\n  const [reportDescription, setReportDescription] = useState('');\n  const [reportTargetType, setReportTargetType] = useState<'content' | 'user' | 'message'>('content');\n  const [reportTargetId, setReportTargetId] = useState('');\n\n  // Fetch pending reports\n  const { data: reports = [], isLoading: reportsLoading } = useQuery<Report[]>({\n    queryKey: ['/api/moderation/reports/pending'],\n  });\n\n  // Fetch user reputation\n  const { data: reputationData } = useQuery<{ userId: string; reputation: number }>({\n    queryKey: ['/api/moderation/reputation', (user as any)?.id],\n    enabled: !!(user as any)?.id,\n  });\n\n  // Fetch moderator leaderboard\n  const { data: leaderboard = [] } = useQuery<any[]>({\n    queryKey: ['/api/moderation/moderators/leaderboard'],\n  });\n\n  // Fetch user's voting history\n  const { data: votingHistory = [] } = useQuery<any[]>({\n    queryKey: ['/api/moderation/votes/my-history'],\n  });\n\n  // Submit vote mutation\n  const voteMutation = useMutation({\n    mutationFn: async (data: { reportId: string; vote: string; reason?: string }) => {\n      return await apiRequest('POST', `/api/moderation/reports/${data.reportId}/vote`, {\n        vote: data.vote,\n        reason: data.reason,\n      });\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['/api/moderation/reports/pending'] });\n      queryClient.invalidateQueries({ queryKey: ['/api/moderation/reputation', (user as any)?.id] });\n      queryClient.invalidateQueries({ queryKey: ['/api/moderation/votes/my-history'] });\n      toast({\n        title: \"Vote submitted\",\n        description: \"Your vote has been recorded successfully\",\n      });\n      setVoteDialogOpen(false);\n      setVoteReason('');\n    },\n    onError: () => {\n      toast({\n        title: \"Error\",\n        description: \"Failed to submit vote\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  // Resolve report mutation\n  const resolveMutation = useMutation({\n    mutationFn: async (data: { reportId: string; action: string; resolution: string }) => {\n      return await apiRequest('PATCH', `/api/moderation/reports/${data.reportId}/resolve`, {\n        action: data.action,\n        resolution: data.resolution,\n      });\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['/api/moderation/reports/pending'] });\n      queryClient.invalidateQueries({ queryKey: ['/api/moderation/moderators/leaderboard'] });\n      toast({\n        title: \"Report resolved\",\n        description: \"The report has been resolved successfully\",\n      });\n      setResolveDialogOpen(false);\n      setResolution('');\n    },\n    onError: () => {\n      toast({\n        title: \"Error\",\n        description: \"Failed to resolve report\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  // Create report mutation\n  const createReportMutation = useMutation({\n    mutationFn: async (data: any) => {\n      return await apiRequest('POST', '/api/moderation/reports', data);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['/api/moderation/reports/pending'] });\n      queryClient.invalidateQueries({ queryKey: ['/api/moderation/reports/my-submissions'] });\n      toast({\n        title: \"Report created\",\n        description: \"Your safety report has been submitted\",\n      });\n      setCreateReportOpen(false);\n      setReportDescription('');\n      setReportTargetId('');\n    },\n    onError: () => {\n      toast({\n        title: \"Error\",\n        description: \"Failed to create report\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const handleVote = () => {\n    if (!selectedReport) return;\n    voteMutation.mutate({\n      reportId: selectedReport.id,\n      vote: voteType,\n      reason: voteReason,\n    });\n  };\n\n  const handleResolve = () => {\n    if (!selectedReport) return;\n    resolveMutation.mutate({\n      reportId: selectedReport.id,\n      action: resolveAction,\n      resolution,\n    });\n  };\n\n  const handleCreateReport = () => {\n    const reportData: any = {\n      reportType,\n      description: reportDescription,\n      severity: 'medium',\n    };\n\n    // Add appropriate target based on type\n    if (reportTargetType === 'content') {\n      reportData.contentId = reportTargetId;\n    } else if (reportTargetType === 'user') {\n      reportData.userId = reportTargetId;\n    } else if (reportTargetType === 'message') {\n      reportData.messageId = reportTargetId;\n    }\n\n    createReportMutation.mutate(reportData);\n  };\n\n  const getSeverityColor = (severity: string) => {\n    switch (severity) {\n      case 'critical': return 'destructive';\n      case 'high': return 'destructive';\n      case 'medium': return 'default';\n      case 'low': return 'secondary';\n      default: return 'secondary';\n    }\n  };\n\n  const getStatusIcon = (status: string) => {\n    switch (status) {\n      case 'pending': return <HelpCircle className=\"h-4 w-4\" />;\n      case 'escalated': return <AlertTriangle className=\"h-4 w-4\" />;\n      case 'resolved': return <CheckCircle className=\"h-4 w-4\" />;\n      case 'dismissed': return <XCircle className=\"h-4 w-4\" />;\n      default: return <Shield className=\"h-4 w-4\" />;\n    }\n  };\n\n  return (\n    <div className=\"container mx-auto p-6 space-y-6\">\n      <div className=\"flex items-center justify-between\">\n        <div>\n          <h1 className=\"text-3xl font-bold flex items-center gap-2\" data-testid=\"heading-moderation\">\n            <Shield className=\"h-8 w-8 text-primary\" />\n            Community Moderation\n          </h1>\n          <p className=\"text-muted-foreground mt-1\">\n            Help keep PupFanz safe by reviewing reports and voting on community concerns\n          </p>\n        </div>\n        <div className=\"flex items-center gap-4\">\n          <Button onClick={() => setCreateReportOpen(true)} data-testid=\"button-create-report\">\n            <AlertTriangle className=\"h-4 w-4 mr-2\" />\n            Report Safety Issue\n          </Button>\n          {reputationData && (\n            <Card>\n              <CardHeader className=\"pb-3\">\n                <CardTitle className=\"text-sm font-medium\">Your Reputation</CardTitle>\n              </CardHeader>\n              <CardContent>\n                <div className=\"flex items-center gap-2\">\n                <Award className=\"h-5 w-5 text-primary\" />\n                <span className=\"text-2xl font-bold\" data-testid=\"text-reputation-score\">\n                  {reputationData.reputation}\n                </span>\n                <span className=\"text-sm text-muted-foreground\">/200</span>\n              </div>\n            </CardContent>\n          </Card>\n        )}\n        </div>\n      </div>\n\n      <Tabs defaultValue=\"reports\" className=\"w-full\">\n        <TabsList>\n          <TabsTrigger value=\"reports\" data-testid=\"tab-reports\">\n            Reports Queue ({reports.length})\n          </TabsTrigger>\n          <TabsTrigger value=\"history\" data-testid=\"tab-history\">\n            My Votes\n          </TabsTrigger>\n          <TabsTrigger value=\"leaderboard\" data-testid=\"tab-leaderboard\">\n            Moderators\n          </TabsTrigger>\n        </TabsList>\n\n        <TabsContent value=\"reports\" className=\"space-y-4\">\n          {reportsLoading ? (\n            <div className=\"text-center py-12\">Loading reports...</div>\n          ) : reports.length === 0 ? (\n            <Card>\n              <CardContent className=\"py-12 text-center\">\n                <Shield className=\"h-12 w-12 mx-auto mb-4 text-muted-foreground\" />\n                <p className=\"text-muted-foreground\">No reports pending review</p>\n              </CardContent>\n            </Card>\n          ) : (\n            reports.map((report) => (\n              <Card key={report.id} data-testid={`card-report-${report.id}`}>\n                <CardHeader>\n                  <div className=\"flex items-start justify-between\">\n                    <div className=\"space-y-1\">\n                      <CardTitle className=\"flex items-center gap-2\">\n                        {getStatusIcon(report.status)}\n                        <span className=\"capitalize\">{report.reportType.replace('_', ' ')}</span>\n                        <Badge variant={getSeverityColor(report.severity)}>\n                          {report.severity}\n                        </Badge>\n                        {report.status === 'escalated' && (\n                          <Badge variant=\"outline\">Auto-Escalated</Badge>\n                        )}\n                      </CardTitle>\n                      <CardDescription>\n                        Reported by @{report.reporter.username} â€¢{' '}\n                        {formatDistanceToNow(new Date(report.createdAt), { addSuffix: true })}\n                      </CardDescription>\n                    </div>\n                  </div>\n                </CardHeader>\n                <CardContent className=\"space-y-4\">\n                  <div>\n                    <p className=\"text-sm mb-2\"><strong>Description:</strong></p>\n                    <p className=\"text-sm text-muted-foreground\">{report.description}</p>\n                  </div>\n\n                  {report.reportedUser && (\n                    <div>\n                      <p className=\"text-sm\">\n                        <strong>Reported User:</strong> @{report.reportedUser.username}\n                      </p>\n                    </div>\n                  )}\n\n                  {report.reportedContent && (\n                    <div>\n                      <p className=\"text-sm\">\n                        <strong>Reported Content:</strong> {report.reportedContent.title}\n                      </p>\n                    </div>\n                  )}\n\n                  <div className=\"border-t pt-4\">\n                    <p className=\"text-sm font-medium mb-2\">Community Voting</p>\n                    <div className=\"grid grid-cols-3 gap-4 text-sm\">\n                      <div>\n                        <div className=\"flex items-center gap-1 text-green-600 dark:text-green-400\">\n                          <ThumbsUp className=\"h-4 w-4\" />\n                          Valid: {report.votingStats.validVotes}\n                        </div>\n                        <p className=\"text-xs text-muted-foreground\">\n                          {report.votingStats.weightedValidPercent}% weighted\n                        </p>\n                      </div>\n                      <div>\n                        <div className=\"flex items-center gap-1 text-red-600 dark:text-red-400\">\n                          <ThumbsDown className=\"h-4 w-4\" />\n                          Invalid: {report.votingStats.invalidVotes}\n                        </div>\n                        <p className=\"text-xs text-muted-foreground\">\n                          {report.votingStats.weightedInvalidPercent}% weighted\n                        </p>\n                      </div>\n                      <div>\n                        <div className=\"flex items-center gap-1\">\n                          <HelpCircle className=\"h-4 w-4\" />\n                          Unsure: {report.votingStats.unsureVotes}\n                        </div>\n                        <p className=\"text-xs text-muted-foreground\">\n                          Avg rep: {report.votingStats.avgVoterReputation}\n                        </p>\n                      </div>\n                    </div>\n                  </div>\n\n                  <div className=\"flex gap-2 pt-2\">\n                    <Button\n                      variant=\"outline\"\n                      size=\"sm\"\n                      onClick={() => {\n                        setSelectedReport(report);\n                        setVoteDialogOpen(true);\n                      }}\n                      data-testid={`button-vote-${report.id}`}\n                    >\n                      <ThumbsUp className=\"h-4 w-4 mr-2\" />\n                      Vote\n                    </Button>\n                    <Button\n                      variant=\"outline\"\n                      size=\"sm\"\n                      onClick={() => {\n                        setSelectedReport(report);\n                        setResolveDialogOpen(true);\n                      }}\n                      data-testid={`button-resolve-${report.id}`}\n                    >\n                      <CheckCircle className=\"h-4 w-4 mr-2\" />\n                      Resolve\n                    </Button>\n                  </div>\n                </CardContent>\n              </Card>\n            ))\n          )}\n        </TabsContent>\n\n        <TabsContent value=\"history\" className=\"space-y-4\">\n          {votingHistory.length === 0 ? (\n            <Card>\n              <CardContent className=\"py-12 text-center\">\n                <ThumbsUp className=\"h-12 w-12 mx-auto mb-4 text-muted-foreground\" />\n                <p className=\"text-muted-foreground\">No voting history yet</p>\n              </CardContent>\n            </Card>\n          ) : (\n            votingHistory.map((vote: any) => (\n              <Card key={vote.id} data-testid={`card-vote-${vote.id}`}>\n                <CardContent className=\"py-4\">\n                  <div className=\"flex items-center justify-between\">\n                    <div>\n                      <p className=\"font-medium\">\n                        Voted: <Badge variant={vote.vote === 'valid' ? 'default' : vote.vote === 'invalid' ? 'destructive' : 'secondary'}>\n                          {vote.vote}\n                        </Badge>\n                      </p>\n                      <p className=\"text-sm text-muted-foreground mt-1\">\n                        {formatDistanceToNow(new Date(vote.createdAt), { addSuffix: true })}\n                      </p>\n                      {vote.reason && (\n                        <p className=\"text-sm text-muted-foreground mt-2\">\n                          Reason: {vote.reason}\n                        </p>\n                      )}\n                    </div>\n                    <div className=\"text-right\">\n                      <p className=\"text-sm text-muted-foreground\">Reputation at vote</p>\n                      <p className=\"text-xl font-bold\">{vote.voterReputation}</p>\n                    </div>\n                  </div>\n                </CardContent>\n              </Card>\n            ))\n          )}\n        </TabsContent>\n\n        <TabsContent value=\"leaderboard\" className=\"space-y-4\">\n          <Card>\n            <CardHeader>\n              <CardTitle className=\"flex items-center gap-2\">\n                <TrendingUp className=\"h-5 w-5\" />\n                Top Moderators\n              </CardTitle>\n              <CardDescription>\n                Community members who help keep PupFanz safe\n              </CardDescription>\n            </CardHeader>\n            <CardContent>\n              {leaderboard.length === 0 ? (\n                <p className=\"text-center py-8 text-muted-foreground\">No moderators yet</p>\n              ) : (\n                <div className=\"space-y-3\">\n                  {leaderboard.map((mod: any, index: number) => (\n                    <div\n                      key={mod.userId}\n                      className=\"flex items-center justify-between p-3 border rounded-lg\"\n                      data-testid={`moderator-${mod.userId}`}\n                    >\n                      <div className=\"flex items-center gap-3\">\n                        <div className=\"text-2xl font-bold text-muted-foreground\">\n                          #{index + 1}\n                        </div>\n                        <div>\n                          <p className=\"font-medium\">@{mod.user.username}</p>\n                          <p className=\"text-sm text-muted-foreground\">\n                            {mod.totalReviews} reviews\n                          </p>\n                        </div>\n                      </div>\n                      {mod.isSeniorModerator && (\n                        <Badge variant=\"default\">\n                          <Award className=\"h-3 w-3 mr-1\" />\n                          Senior\n                        </Badge>\n                      )}\n                    </div>\n                  ))}\n                </div>\n              )}\n            </CardContent>\n          </Card>\n        </TabsContent>\n      </Tabs>\n\n      {/* Vote Dialog */}\n      <Dialog open={voteDialogOpen} onOpenChange={setVoteDialogOpen}>\n        <DialogContent data-testid=\"dialog-vote\">\n          <DialogHeader>\n            <DialogTitle>Submit Your Vote</DialogTitle>\n            <DialogDescription>\n              Your reputation score affects the weight of your vote\n            </DialogDescription>\n          </DialogHeader>\n          <div className=\"space-y-4\">\n            <div>\n              <Label>Vote</Label>\n              <Select value={voteType} onValueChange={(v: any) => setVoteType(v)}>\n                <SelectTrigger data-testid=\"select-vote-type\">\n                  <SelectValue />\n                </SelectTrigger>\n                <SelectContent>\n                  <SelectItem value=\"valid\" data-testid=\"option-valid\">Valid - This report has merit</SelectItem>\n                  <SelectItem value=\"invalid\" data-testid=\"option-invalid\">Invalid - This is not a real concern</SelectItem>\n                  <SelectItem value=\"unsure\" data-testid=\"option-unsure\">Unsure - Need more information</SelectItem>\n                </SelectContent>\n              </Select>\n            </div>\n            <div>\n              <Label>Reason (optional)</Label>\n              <Textarea\n                value={voteReason}\n                onChange={(e) => setVoteReason(e.target.value)}\n                placeholder=\"Explain your vote...\"\n                data-testid=\"textarea-vote-reason\"\n              />\n            </div>\n          </div>\n          <DialogFooter>\n            <Button variant=\"outline\" onClick={() => setVoteDialogOpen(false)} data-testid=\"button-cancel-vote\">\n              Cancel\n            </Button>\n            <Button onClick={handleVote} disabled={voteMutation.isPending} data-testid=\"button-submit-vote\">\n              {voteMutation.isPending ? 'Submitting...' : 'Submit Vote'}\n            </Button>\n          </DialogFooter>\n        </DialogContent>\n      </Dialog>\n\n      {/* Resolve Dialog */}\n      <Dialog open={resolveDialogOpen} onOpenChange={setResolveDialogOpen}>\n        <DialogContent data-testid=\"dialog-resolve\">\n          <DialogHeader>\n            <DialogTitle>Resolve Report</DialogTitle>\n            <DialogDescription>\n              Make a final decision on this report\n            </DialogDescription>\n          </DialogHeader>\n          <div className=\"space-y-4\">\n            <div>\n              <Label>Action</Label>\n              <Select value={resolveAction} onValueChange={(v: any) => setResolveAction(v)}>\n                <SelectTrigger data-testid=\"select-resolve-action\">\n                  <SelectValue />\n                </SelectTrigger>\n                <SelectContent>\n                  <SelectItem value=\"resolved\" data-testid=\"option-resolved\">Resolved - Action taken</SelectItem>\n                  <SelectItem value=\"dismissed\" data-testid=\"option-dismissed\">Dismissed - No action needed</SelectItem>\n                  <SelectItem value=\"escalated\" data-testid=\"option-escalated\">Escalate - Needs senior review</SelectItem>\n                </SelectContent>\n              </Select>\n            </div>\n            <div>\n              <Label>Resolution Notes</Label>\n              <Textarea\n                value={resolution}\n                onChange={(e) => setResolution(e.target.value)}\n                placeholder=\"Explain the resolution...\"\n                required\n                data-testid=\"textarea-resolution\"\n              />\n            </div>\n          </div>\n          <DialogFooter>\n            <Button variant=\"outline\" onClick={() => setResolveDialogOpen(false)} data-testid=\"button-cancel-resolve\">\n              Cancel\n            </Button>\n            <Button \n              onClick={handleResolve} \n              disabled={resolveMutation.isPending || !resolution.trim()}\n              data-testid=\"button-submit-resolve\"\n            >\n              {resolveMutation.isPending ? 'Resolving...' : 'Resolve Report'}\n            </Button>\n          </DialogFooter>\n        </DialogContent>\n      </Dialog>\n\n      {/* Create Report Dialog */}\n      <Dialog open={createReportOpen} onOpenChange={setCreateReportOpen}>\n        <DialogContent data-testid=\"dialog-create-report\">\n          <DialogHeader>\n            <DialogTitle>Report Safety Issue</DialogTitle>\n            <DialogDescription>\n              Help keep the community safe by reporting violations\n            </DialogDescription>\n          </DialogHeader>\n          <div className=\"space-y-4\">\n            <div>\n              <Label>Report Type</Label>\n              <Select value={reportType} onValueChange={setReportType}>\n                <SelectTrigger data-testid=\"select-report-type\">\n                  <SelectValue />\n                </SelectTrigger>\n                <SelectContent>\n                  <SelectItem value=\"underage\">Underage Content</SelectItem>\n                  <SelectItem value=\"non_consensual\">Non-Consensual Content</SelectItem>\n                  <SelectItem value=\"violence\">Violence</SelectItem>\n                  <SelectItem value=\"hate_speech\">Hate Speech</SelectItem>\n                  <SelectItem value=\"spam\">Spam</SelectItem>\n                  <SelectItem value=\"copyright\">Copyright Violation</SelectItem>\n                  <SelectItem value=\"impersonation\">Impersonation</SelectItem>\n                  <SelectItem value=\"other\">Other</SelectItem>\n                </SelectContent>\n              </Select>\n            </div>\n            <div>\n              <Label>Target Type</Label>\n              <Select value={reportTargetType} onValueChange={(v: any) => setReportTargetType(v)}>\n                <SelectTrigger data-testid=\"select-target-type\">\n                  <SelectValue />\n                </SelectTrigger>\n                <SelectContent>\n                  <SelectItem value=\"content\">Content</SelectItem>\n                  <SelectItem value=\"user\">User</SelectItem>\n                  <SelectItem value=\"message\">Message</SelectItem>\n                </SelectContent>\n              </Select>\n            </div>\n            <div>\n              <Label>Target ID</Label>\n              <input\n                type=\"text\"\n                value={reportTargetId}\n                onChange={(e) => setReportTargetId(e.target.value)}\n                placeholder={`Enter ${reportTargetType} ID`}\n                className=\"w-full px-3 py-2 border rounded-md\"\n                data-testid=\"input-target-id\"\n              />\n            </div>\n            <div>\n              <Label>Description</Label>\n              <Textarea\n                value={reportDescription}\n                onChange={(e) => setReportDescription(e.target.value)}\n                placeholder=\"Describe the safety concern...\"\n                required\n                data-testid=\"textarea-report-description\"\n              />\n            </div>\n          </div>\n          <DialogFooter>\n            <Button variant=\"outline\" onClick={() => setCreateReportOpen(false)} data-testid=\"button-cancel-create\">\n              Cancel\n            </Button>\n            <Button \n              onClick={handleCreateReport} \n              disabled={createReportMutation.isPending || !reportDescription.trim() || !reportTargetId.trim()}\n              data-testid=\"button-submit-create\"\n            >\n              {createReportMutation.isPending ? 'Submitting...' : 'Submit Report'}\n            </Button>\n          </DialogFooter>\n        </DialogContent>\n      </Dialog>\n    </div>\n  );\n}\n","size_bytes":26219},"client/src/components/ui/aspect-ratio.tsx":{"content":"import * as AspectRatioPrimitive from \"@radix-ui/react-aspect-ratio\"\n\nconst AspectRatio = AspectRatioPrimitive.Root\n\nexport { AspectRatio }\n","size_bytes":140},"client/src/components/discovery/CreatorCard.tsx":{"content":"import { Link } from \"wouter\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Button } from \"@/components/ui/button\";\nimport { Avatar, AvatarImage, AvatarFallback } from \"@/components/ui/avatar\";\nimport { \n  Heart, \n  Eye, \n  Users, \n  Verified, \n  Shield,\n  Star\n} from \"lucide-react\";\n\ninterface Creator {\n  id: string;\n  username: string;\n  email?: string;\n  profileImageUrl?: string;\n  profile?: {\n    displayName?: string;\n    bio?: string;\n    avatarUrl?: string;\n    packType?: string;\n    ageVerified?: boolean;\n    kycStatus?: string;\n    isAftercareFriendly?: boolean;\n    safetyBadges?: string[];\n  };\n}\n\ninterface CreatorCardProps {\n  creator: Creator;\n  compact?: boolean;\n}\n\nexport default function CreatorCard({ creator, compact = false }: CreatorCardProps) {\n  const displayName = creator.profile?.displayName || creator.username;\n  const avatarUrl = creator.profile?.avatarUrl || creator.profileImageUrl;\n  const bio = creator.profile?.bio;\n\n  // Mock stats - in real app these would come from API\n  const mockStats = {\n    subscribers: Math.floor(Math.random() * 3000) + 500,\n    content: Math.floor(Math.random() * 50) + 10,\n    views: Math.floor(Math.random() * 50000) + 5000,\n  };\n\n  const formatNumber = (num: number) => {\n    if (num >= 1000) {\n      return `${(num / 1000).toFixed(1)}K`;\n    }\n    return num.toString();\n  };\n\n  const getPackTypeColor = (packType?: string) => {\n    switch (packType) {\n      case 'alpha': return 'bg-primary/20 text-primary';\n      case 'playful': return 'bg-secondary/20 text-secondary';\n      case 'supportive': return 'bg-accent/20 text-accent';\n      case 'training': return 'bg-success/20 text-success';\n      default: return 'bg-muted/20 text-muted';\n    }\n  };\n\n  if (compact) {\n    return (\n      <Link href={`/profile/${creator.id}`}>\n        <div className=\"pack-card p-4 cursor-pointer\" data-testid={`creator-card-${creator.id}`}>\n          <div className=\"flex items-center space-x-3\">\n            <Avatar className=\"w-12 h-12 border border-primary/30\">\n              <AvatarImage src={avatarUrl} alt={displayName} />\n              <AvatarFallback className=\"bg-primary/20 text-primary\">\n                {displayName.charAt(0).toUpperCase()}\n              </AvatarFallback>\n            </Avatar>\n            \n            <div className=\"flex-1 min-w-0\">\n              <h3 className=\"font-semibold text-foreground truncate\" data-testid=\"text-creator-name\">\n                {displayName}\n              </h3>\n              <div className=\"flex items-center space-x-2 text-sm\">\n                <span className=\"text-muted\" data-testid=\"text-pack-count\">\n                  {formatNumber(mockStats.subscribers)} pack\n                </span>\n                {creator.profile?.ageVerified && (\n                  <Badge className=\"safety-badge safety-badge-verified text-xs\">\n                    <Verified className=\"h-2 w-2 mr-1\" />\n                    Verified\n                  </Badge>\n                )}\n              </div>\n            </div>\n          </div>\n        </div>\n      </Link>\n    );\n  }\n\n  return (\n    <div className=\"pack-card overflow-hidden group\" data-testid={`creator-card-${creator.id}`}>\n      <div className=\"p-6\">\n        <div className=\"flex items-start space-x-4 mb-4\">\n          <Avatar className=\"w-16 h-16 border-2 border-primary/30 group-hover:border-primary transition-colors\">\n            <AvatarImage src={avatarUrl} alt={displayName} />\n            <AvatarFallback className=\"text-lg bg-primary/20 text-primary\">\n              {displayName.charAt(0).toUpperCase()}\n            </AvatarFallback>\n          </Avatar>\n          \n          <div className=\"flex-1 min-w-0\">\n            <h3 className=\"font-semibold text-lg text-foreground truncate mb-1\" data-testid=\"text-creator-name\">\n              {displayName}\n            </h3>\n            <p className=\"text-sm text-muted mb-2\">@{creator.username}</p>\n            \n            {/* Safety Badges */}\n            <div className=\"flex flex-wrap items-center gap-1 mb-2\">\n              {creator.profile?.ageVerified && (\n                <Badge className=\"safety-badge safety-badge-verified text-xs\">\n                  <Verified className=\"mr-1 h-2 w-2\" />\n                  18+ Verified\n                </Badge>\n              )}\n              {creator.profile?.kycStatus === 'verified' && (\n                <Badge className=\"safety-badge safety-badge-consent text-xs\">\n                  <Shield className=\"mr-1 h-2 w-2\" />\n                  KYC Verified\n                </Badge>\n              )}\n              {creator.profile?.isAftercareFriendly && (\n                <Badge className=\"safety-badge safety-badge-aftercare text-xs\">\n                  <Heart className=\"mr-1 h-2 w-2\" />\n                  Aftercare\n                </Badge>\n              )}\n              {creator.profile?.packType && (\n                <Badge \n                  variant=\"outline\" \n                  className={`text-xs ${getPackTypeColor(creator.profile.packType)}`}\n                >\n                  {creator.profile.packType}\n                </Badge>\n              )}\n            </div>\n          </div>\n        </div>\n\n        {/* Bio */}\n        {bio && (\n          <p className=\"text-sm text-muted mb-4 line-clamp-2\" data-testid=\"text-creator-bio\">\n            {bio}\n          </p>\n        )}\n\n        {/* Content Preview Grid */}\n        <div className=\"grid grid-cols-3 gap-2 mb-4\">\n          {[1, 2, 3].map((i) => (\n            <div \n              key={i}\n              className=\"aspect-square bg-gradient-to-br from-primary/20 to-secondary/20 rounded-lg flex items-center justify-center group-hover:from-primary/30 group-hover:to-secondary/30 transition-colors\"\n            >\n              <Eye className=\"h-4 w-4 text-primary opacity-60\" />\n            </div>\n          ))}\n        </div>\n\n        {/* Stats */}\n        <div className=\"flex items-center justify-between mb-4 text-sm text-muted\">\n          <div className=\"flex items-center space-x-1\">\n            <Users className=\"h-4 w-4\" />\n            <span data-testid=\"text-subscribers\">{formatNumber(mockStats.subscribers)} pack</span>\n          </div>\n          <div className=\"flex items-center space-x-1\">\n            <Star className=\"h-4 w-4\" />\n            <span data-testid=\"text-content-count\">{mockStats.content} posts</span>\n          </div>\n          <div className=\"flex items-center space-x-1\">\n            <Eye className=\"h-4 w-4\" />\n            <span data-testid=\"text-total-views\">{formatNumber(mockStats.views)} views</span>\n          </div>\n        </div>\n\n        {/* Actions */}\n        <div className=\"flex space-x-2\">\n          <Link href={`/profile/${creator.id}`} className=\"flex-1\">\n            <Button className=\"w-full btn-primary\" data-testid=\"button-view-profile\">\n              <Heart className=\"mr-2 h-4 w-4\" />\n              Join Pack\n            </Button>\n          </Link>\n          <Button variant=\"outline\" size=\"sm\" data-testid=\"button-message\">\n            ðŸ’¬\n          </Button>\n        </div>\n      </div>\n    </div>\n  );\n}\n","size_bytes":7073},"client/src/components/ui/popover.tsx":{"content":"import * as React from \"react\"\nimport * as PopoverPrimitive from \"@radix-ui/react-popover\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Popover = PopoverPrimitive.Root\n\nconst PopoverTrigger = PopoverPrimitive.Trigger\n\nconst PopoverContent = React.forwardRef<\n  React.ElementRef<typeof PopoverPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof PopoverPrimitive.Content>\n>(({ className, align = \"center\", sideOffset = 4, ...props }, ref) => (\n  <PopoverPrimitive.Portal>\n    <PopoverPrimitive.Content\n      ref={ref}\n      align={align}\n      sideOffset={sideOffset}\n      className={cn(\n        \"z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-popover-content-transform-origin]\",\n        className\n      )}\n      {...props}\n    />\n  </PopoverPrimitive.Portal>\n))\nPopoverContent.displayName = PopoverPrimitive.Content.displayName\n\nexport { Popover, PopoverTrigger, PopoverContent }\n","size_bytes":1280},"client/src/components/ObjectUploader.tsx":{"content":"import { useState } from \"react\";\nimport type { ReactNode } from \"react\";\nimport Uppy from \"@uppy/core\";\nimport { DashboardModal } from \"@uppy/react\";\n// CSS imports handled in main.tsx to avoid Vite module resolution issues\n// import \"@uppy/core/dist/style.min.css\";\n// import \"@uppy/dashboard/dist/style.min.css\";\nimport AwsS3 from \"@uppy/aws-s3\";\nimport type { UploadResult } from \"@uppy/core\";\nimport { Button } from \"@/components/ui/button\";\n\ninterface ObjectUploaderProps {\n  maxNumberOfFiles?: number;\n  maxFileSize?: number;\n  onGetUploadParameters: () => Promise<{\n    method: \"PUT\";\n    url: string;\n  }>;\n  onComplete?: (\n    result: UploadResult<Record<string, unknown>, Record<string, unknown>>\n  ) => void;\n  buttonClassName?: string;\n  children: ReactNode;\n}\n\n/**\n * A file upload component that renders as a button and provides a modal interface for\n * file management.\n * \n * Features:\n * - Renders as a customizable button that opens a file upload modal\n * - Provides a modal interface for:\n *   - File selection\n *   - File preview\n *   - Upload progress tracking\n *   - Upload status display\n * \n * The component uses Uppy under the hood to handle all file upload functionality.\n * All file management features are automatically handled by the Uppy dashboard modal.\n * \n * @param props - Component props\n * @param props.maxNumberOfFiles - Maximum number of files allowed to be uploaded\n *   (default: 1)\n * @param props.maxFileSize - Maximum file size in bytes (default: 10MB)\n * @param props.onGetUploadParameters - Function to get upload parameters (method and URL).\n *   Typically used to fetch a presigned URL from the backend server for direct-to-S3\n *   uploads.\n * @param props.onComplete - Callback function called when upload is complete. Typically\n *   used to make post-upload API calls to update server state and set object ACL\n *   policies.\n * @param props.buttonClassName - Optional CSS class name for the button\n * @param props.children - Content to be rendered inside the button\n */\nexport function ObjectUploader({\n  maxNumberOfFiles = 1,\n  maxFileSize = 10485760, // 10MB default\n  onGetUploadParameters,\n  onComplete,\n  buttonClassName,\n  children,\n}: ObjectUploaderProps) {\n  const [showModal, setShowModal] = useState(false);\n  const [uppy] = useState(() =>\n    new Uppy({\n      restrictions: {\n        maxNumberOfFiles,\n        maxFileSize,\n      },\n      autoProceed: false,\n    })\n      .use(AwsS3, {\n        shouldUseMultipart: false,\n        getUploadParameters: onGetUploadParameters,\n      })\n      .on(\"complete\", (result) => {\n        onComplete?.(result);\n      })\n  );\n\n  return (\n    <div>\n      <Button onClick={() => setShowModal(true)} className={buttonClassName} data-testid=\"button-open-uploader\">\n        {children}\n      </Button>\n\n      <DashboardModal\n        uppy={uppy}\n        open={showModal}\n        onRequestClose={() => setShowModal(false)}\n        proudlyDisplayPoweredByUppy={false}\n      />\n    </div>\n  );\n}\n","size_bytes":2982},"client/src/pages/Terms.tsx":{"content":"import { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { FileText } from \"lucide-react\";\n\nconst sections = [\n  {\n    title: \"1. Acceptance of Terms\",\n    content: \"By accessing and using this platform, you accept and agree to be bound by the terms and provision of this agreement. If you do not agree to abide by the above, please do not use this service.\"\n  },\n  {\n    title: \"2. Use License\",\n    content: \"Permission is granted to temporarily access the materials (information or software) on our platform for personal, non-commercial transitory viewing only. This is the grant of a license, not a transfer of title, and under this license you may not: modify or copy the materials; use the materials for any commercial purpose; attempt to decompile or reverse engineer any software contained on the platform; remove any copyright or other proprietary notations from the materials; or transfer the materials to another person.\"\n  },\n  {\n    title: \"3. Age Restriction\",\n    content: \"You must be at least 18 years of age to use this platform. By using this platform, you warrant that you are at least 18 years of age and you agree to provide valid proof of age upon request. We reserve the right to verify your age and to suspend or terminate your account if we discover you are underage.\"\n  },\n  {\n    title: \"4. User Accounts\",\n    content: \"When you create an account with us, you must provide information that is accurate, complete, and current at all times. Failure to do so constitutes a breach of the Terms, which may result in immediate termination of your account. You are responsible for safeguarding the password that you use to access the Service and for any activities or actions under your password.\"\n  },\n  {\n    title: \"5. Content\",\n    content: \"Our platform allows you to post, link, store, share and otherwise make available certain information, text, graphics, videos, or other material ('Content'). You are responsible for the Content that you post to the Service, including its legality, reliability, and appropriateness. By posting Content, you grant us the right and license to use, modify, publicly perform, publicly display, reproduce, and distribute such Content on and through the Service.\"\n  },\n  {\n    title: \"6. Prohibited Uses\",\n    content: \"You may not use our platform: for any unlawful purpose or to solicit others to perform or participate in any unlawful acts; to violate any international, federal, provincial or state regulations, rules, laws, or local ordinances; to infringe upon or violate our intellectual property rights or the intellectual property rights of others; to harass, abuse, insult, harm, defame, slander, disparage, intimidate, or discriminate; to submit false or misleading information; to upload or transmit viruses or any other type of malicious code.\"\n  },\n  {\n    title: \"7. Intellectual Property\",\n    content: \"The platform and its original content (excluding Content provided by users), features and functionality are and will remain the exclusive property of the platform and its licensors. The platform is protected by copyright, trademark, and other laws of both the country and foreign countries. Our trademarks and trade dress may not be used in connection with any product or service without our prior written consent.\"\n  },\n  {\n    title: \"8. Copyright Policy\",\n    content: \"We respect the intellectual property rights of others. It is our policy to respond to any claim that Content posted on the platform infringes the copyright or other intellectual property infringement of any person. If you believe that any Content violates your copyright, please see our DMCA Policy for information on how to file a notice.\"\n  },\n  {\n    title: \"9. Termination\",\n    content: \"We may terminate or suspend your account immediately, without prior notice or liability, for any reason whatsoever, including without limitation if you breach the Terms. Upon termination, your right to use the platform will immediately cease. If you wish to terminate your account, you may simply discontinue using the platform.\"\n  },\n  {\n    title: \"10. Limitation of Liability\",\n    content: \"In no event shall the platform, nor its directors, employees, partners, agents, suppliers, or affiliates, be liable for any indirect, incidental, special, consequential or punitive damages, including without limitation, loss of profits, data, use, goodwill, or other intangible losses, resulting from your access to or use of or inability to access or use the platform.\"\n  },\n  {\n    title: \"11. Governing Law\",\n    content: \"These Terms shall be governed and construed in accordance with the laws without regard to its conflict of law provisions. Our failure to enforce any right or provision of these Terms will not be considered a waiver of those rights.\"\n  },\n  {\n    title: \"12. Changes to Terms\",\n    content: \"We reserve the right, at our sole discretion, to modify or replace these Terms at any time. If a revision is material we will try to provide at least 30 days notice prior to any new terms taking effect. What constitutes a material change will be determined at our sole discretion.\"\n  }\n];\n\nexport default function Terms() {\n  return (\n    <div className=\"container mx-auto p-6 max-w-4xl\">\n      <div className=\"mb-8\">\n        <div className=\"flex items-center gap-2 mb-4\">\n          <FileText className=\"h-8 w-8 text-primary\" />\n          <h1 className=\"text-3xl font-bold\">Terms of Service</h1>\n        </div>\n        <p className=\"text-muted-foreground\">\n          Last updated: {new Date().toLocaleDateString('en-US', { month: 'long', day: 'numeric', year: 'numeric' })}\n        </p>\n      </div>\n\n      <Card className=\"mb-6\">\n        <CardContent className=\"pt-6\">\n          <p className=\"text-muted-foreground\">\n            Please read these Terms of Service carefully before using our platform. By accessing or using the platform, \n            you agree to be bound by these Terms. If you disagree with any part of the terms, then you may not access the platform.\n          </p>\n        </CardContent>\n      </Card>\n\n      <div className=\"space-y-6\">\n        {sections.map((section) => (\n          <Card key={section.title} data-testid={`section-${section.title.toLowerCase().replace(/[^a-z0-9]+/g, '-')}`}>\n            <CardHeader>\n              <CardTitle className=\"text-lg\">{section.title}</CardTitle>\n            </CardHeader>\n            <CardContent>\n              <p className=\"text-muted-foreground\">{section.content}</p>\n            </CardContent>\n          </Card>\n        ))}\n      </div>\n\n      <Card className=\"mt-8\">\n        <CardHeader>\n          <CardTitle>Contact Us</CardTitle>\n        </CardHeader>\n        <CardContent>\n          <p className=\"text-muted-foreground\">\n            If you have any questions about these Terms, please contact our support team through the Help & Support page.\n          </p>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","size_bytes":6977},"client/src/components/ui/input-otp.tsx":{"content":"import * as React from \"react\"\nimport { OTPInput, OTPInputContext } from \"input-otp\"\nimport { Dot } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst InputOTP = React.forwardRef<\n  React.ElementRef<typeof OTPInput>,\n  React.ComponentPropsWithoutRef<typeof OTPInput>\n>(({ className, containerClassName, ...props }, ref) => (\n  <OTPInput\n    ref={ref}\n    containerClassName={cn(\n      \"flex items-center gap-2 has-[:disabled]:opacity-50\",\n      containerClassName\n    )}\n    className={cn(\"disabled:cursor-not-allowed\", className)}\n    {...props}\n  />\n))\nInputOTP.displayName = \"InputOTP\"\n\nconst InputOTPGroup = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\">\n>(({ className, ...props }, ref) => (\n  <div ref={ref} className={cn(\"flex items-center\", className)} {...props} />\n))\nInputOTPGroup.displayName = \"InputOTPGroup\"\n\nconst InputOTPSlot = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\"> & { index: number }\n>(({ index, className, ...props }, ref) => {\n  const inputOTPContext = React.useContext(OTPInputContext)\n  const { char, hasFakeCaret, isActive } = inputOTPContext.slots[index]\n\n  return (\n    <div\n      ref={ref}\n      className={cn(\n        \"relative flex h-10 w-10 items-center justify-center border-y border-r border-input text-sm transition-all first:rounded-l-md first:border-l last:rounded-r-md\",\n        isActive && \"z-10 ring-2 ring-ring ring-offset-background\",\n        className\n      )}\n      {...props}\n    >\n      {char}\n      {hasFakeCaret && (\n        <div className=\"pointer-events-none absolute inset-0 flex items-center justify-center\">\n          <div className=\"h-4 w-px animate-caret-blink bg-foreground duration-1000\" />\n        </div>\n      )}\n    </div>\n  )\n})\nInputOTPSlot.displayName = \"InputOTPSlot\"\n\nconst InputOTPSeparator = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\">\n>(({ ...props }, ref) => (\n  <div ref={ref} role=\"separator\" {...props}>\n    <Dot />\n  </div>\n))\nInputOTPSeparator.displayName = \"InputOTPSeparator\"\n\nexport { InputOTP, InputOTPGroup, InputOTPSlot, InputOTPSeparator }\n","size_bytes":2154},"client/src/components/ui/alert-dialog.tsx":{"content":"import * as React from \"react\"\nimport * as AlertDialogPrimitive from \"@radix-ui/react-alert-dialog\"\n\nimport { cn } from \"@/lib/utils\"\nimport { buttonVariants } from \"@/components/ui/button\"\n\nconst AlertDialog = AlertDialogPrimitive.Root\n\nconst AlertDialogTrigger = AlertDialogPrimitive.Trigger\n\nconst AlertDialogPortal = AlertDialogPrimitive.Portal\n\nconst AlertDialogOverlay = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Overlay\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  />\n))\nAlertDialogOverlay.displayName = AlertDialogPrimitive.Overlay.displayName\n\nconst AlertDialogContent = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPortal>\n    <AlertDialogOverlay />\n    <AlertDialogPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg\",\n        className\n      )}\n      {...props}\n    />\n  </AlertDialogPortal>\n))\nAlertDialogContent.displayName = AlertDialogPrimitive.Content.displayName\n\nconst AlertDialogHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-2 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nAlertDialogHeader.displayName = \"AlertDialogHeader\"\n\nconst AlertDialogFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nAlertDialogFooter.displayName = \"AlertDialogFooter\"\n\nconst AlertDialogTitle = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Title\n    ref={ref}\n    className={cn(\"text-lg font-semibold\", className)}\n    {...props}\n  />\n))\nAlertDialogTitle.displayName = AlertDialogPrimitive.Title.displayName\n\nconst AlertDialogDescription = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nAlertDialogDescription.displayName =\n  AlertDialogPrimitive.Description.displayName\n\nconst AlertDialogAction = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Action>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Action>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Action\n    ref={ref}\n    className={cn(buttonVariants(), className)}\n    {...props}\n  />\n))\nAlertDialogAction.displayName = AlertDialogPrimitive.Action.displayName\n\nconst AlertDialogCancel = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Cancel>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Cancel>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Cancel\n    ref={ref}\n    className={cn(\n      buttonVariants({ variant: \"outline\" }),\n      \"mt-2 sm:mt-0\",\n      className\n    )}\n    {...props}\n  />\n))\nAlertDialogCancel.displayName = AlertDialogPrimitive.Cancel.displayName\n\nexport {\n  AlertDialog,\n  AlertDialogPortal,\n  AlertDialogOverlay,\n  AlertDialogTrigger,\n  AlertDialogContent,\n  AlertDialogHeader,\n  AlertDialogFooter,\n  AlertDialogTitle,\n  AlertDialogDescription,\n  AlertDialogAction,\n  AlertDialogCancel,\n}\n","size_bytes":4420},"vite.config.ts":{"content":"import { defineConfig } from \"vite\";\nimport react from \"@vitejs/plugin-react\";\nimport path from \"path\";\nimport runtimeErrorOverlay from \"@replit/vite-plugin-runtime-error-modal\";\n\nexport default defineConfig({\n  plugins: [\n    react(),\n    runtimeErrorOverlay(),\n    ...(process.env.NODE_ENV !== \"production\" &&\n    process.env.REPL_ID !== undefined\n      ? [\n          await import(\"@replit/vite-plugin-cartographer\").then((m) =>\n            m.cartographer(),\n          ),\n          await import(\"@replit/vite-plugin-dev-banner\").then((m) =>\n            m.devBanner(),\n          ),\n        ]\n      : []),\n  ],\n  resolve: {\n    alias: {\n      \"@\": path.resolve(import.meta.dirname, \"client\", \"src\"),\n      \"@shared\": path.resolve(import.meta.dirname, \"shared\"),\n      \"@assets\": path.resolve(import.meta.dirname, \"attached_assets\"),\n    },\n  },\n  root: path.resolve(import.meta.dirname, \"client\"),\n  build: {\n    outDir: path.resolve(import.meta.dirname, \"dist/public\"),\n    emptyOutDir: true,\n  },\n  server: {\n    fs: {\n      strict: true,\n      deny: [\"**/.*\"],\n    },\n  },\n});\n","size_bytes":1080},"client/src/hooks/useWebSocket.ts":{"content":"import { useEffect, useRef, useState } from 'react';\n\ninterface UseWebSocketProps {\n  onMessage?: (data: any) => void;\n  onConnect?: () => void;\n  onDisconnect?: () => void;\n}\n\nexport function useWebSocket({ onMessage, onConnect, onDisconnect }: UseWebSocketProps = {}) {\n  const ws = useRef<WebSocket | null>(null);\n  const [isConnected, setIsConnected] = useState(false);\n\n  useEffect(() => {\n    const protocol = window.location.protocol === \"https:\" ? \"wss:\" : \"ws:\";\n    const wsUrl = `${protocol}//${window.location.host}/ws`;\n    \n    ws.current = new WebSocket(wsUrl);\n\n    ws.current.onopen = () => {\n      setIsConnected(true);\n      onConnect?.();\n    };\n\n    ws.current.onclose = () => {\n      setIsConnected(false);\n      onDisconnect?.();\n    };\n\n    ws.current.onmessage = (event) => {\n      try {\n        const data = JSON.parse(event.data);\n        onMessage?.(data);\n      } catch (error) {\n        console.error('WebSocket message parse error:', error);\n      }\n    };\n\n    return () => {\n      ws.current?.close();\n    };\n  }, [onMessage, onConnect, onDisconnect]);\n\n  const sendMessage = (data: any) => {\n    if (ws.current?.readyState === WebSocket.OPEN) {\n      ws.current.send(JSON.stringify(data));\n    }\n  };\n\n  return {\n    isConnected,\n    sendMessage,\n  };\n}\n","size_bytes":1288},"client/src/components/ui/select.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as SelectPrimitive from \"@radix-ui/react-select\"\nimport { Check, ChevronDown, ChevronUp } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Select = SelectPrimitive.Root\n\nconst SelectGroup = SelectPrimitive.Group\n\nconst SelectValue = SelectPrimitive.Value\n\nconst SelectTrigger = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <SelectPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background data-[placeholder]:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <SelectPrimitive.Icon asChild>\n      <ChevronDown className=\"h-4 w-4 opacity-50\" />\n    </SelectPrimitive.Icon>\n  </SelectPrimitive.Trigger>\n))\nSelectTrigger.displayName = SelectPrimitive.Trigger.displayName\n\nconst SelectScrollUpButton = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.ScrollUpButton>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.ScrollUpButton>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.ScrollUpButton\n    ref={ref}\n    className={cn(\n      \"flex cursor-default items-center justify-center py-1\",\n      className\n    )}\n    {...props}\n  >\n    <ChevronUp className=\"h-4 w-4\" />\n  </SelectPrimitive.ScrollUpButton>\n))\nSelectScrollUpButton.displayName = SelectPrimitive.ScrollUpButton.displayName\n\nconst SelectScrollDownButton = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.ScrollDownButton>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.ScrollDownButton>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.ScrollDownButton\n    ref={ref}\n    className={cn(\n      \"flex cursor-default items-center justify-center py-1\",\n      className\n    )}\n    {...props}\n  >\n    <ChevronDown className=\"h-4 w-4\" />\n  </SelectPrimitive.ScrollDownButton>\n))\nSelectScrollDownButton.displayName =\n  SelectPrimitive.ScrollDownButton.displayName\n\nconst SelectContent = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Content>\n>(({ className, children, position = \"popper\", ...props }, ref) => (\n  <SelectPrimitive.Portal>\n    <SelectPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"relative z-50 max-h-[--radix-select-content-available-height] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-select-content-transform-origin]\",\n        position === \"popper\" &&\n          \"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1\",\n        className\n      )}\n      position={position}\n      {...props}\n    >\n      <SelectScrollUpButton />\n      <SelectPrimitive.Viewport\n        className={cn(\n          \"p-1\",\n          position === \"popper\" &&\n            \"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]\"\n        )}\n      >\n        {children}\n      </SelectPrimitive.Viewport>\n      <SelectScrollDownButton />\n    </SelectPrimitive.Content>\n  </SelectPrimitive.Portal>\n))\nSelectContent.displayName = SelectPrimitive.Content.displayName\n\nconst SelectLabel = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Label>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.Label\n    ref={ref}\n    className={cn(\"py-1.5 pl-8 pr-2 text-sm font-semibold\", className)}\n    {...props}\n  />\n))\nSelectLabel.displayName = SelectPrimitive.Label.displayName\n\nconst SelectItem = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Item>\n>(({ className, children, ...props }, ref) => (\n  <SelectPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <SelectPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </SelectPrimitive.ItemIndicator>\n    </span>\n\n    <SelectPrimitive.ItemText>{children}</SelectPrimitive.ItemText>\n  </SelectPrimitive.Item>\n))\nSelectItem.displayName = SelectPrimitive.Item.displayName\n\nconst SelectSeparator = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nSelectSeparator.displayName = SelectPrimitive.Separator.displayName\n\nexport {\n  Select,\n  SelectGroup,\n  SelectValue,\n  SelectTrigger,\n  SelectContent,\n  SelectLabel,\n  SelectItem,\n  SelectSeparator,\n  SelectScrollUpButton,\n  SelectScrollDownButton,\n}\n","size_bytes":5742},"client/src/components/ui/table.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Table = React.forwardRef<\n  HTMLTableElement,\n  React.HTMLAttributes<HTMLTableElement>\n>(({ className, ...props }, ref) => (\n  <div className=\"relative w-full overflow-auto\">\n    <table\n      ref={ref}\n      className={cn(\"w-full caption-bottom text-sm\", className)}\n      {...props}\n    />\n  </div>\n))\nTable.displayName = \"Table\"\n\nconst TableHeader = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <thead ref={ref} className={cn(\"[&_tr]:border-b\", className)} {...props} />\n))\nTableHeader.displayName = \"TableHeader\"\n\nconst TableBody = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <tbody\n    ref={ref}\n    className={cn(\"[&_tr:last-child]:border-0\", className)}\n    {...props}\n  />\n))\nTableBody.displayName = \"TableBody\"\n\nconst TableFooter = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <tfoot\n    ref={ref}\n    className={cn(\n      \"border-t bg-muted/50 font-medium [&>tr]:last:border-b-0\",\n      className\n    )}\n    {...props}\n  />\n))\nTableFooter.displayName = \"TableFooter\"\n\nconst TableRow = React.forwardRef<\n  HTMLTableRowElement,\n  React.HTMLAttributes<HTMLTableRowElement>\n>(({ className, ...props }, ref) => (\n  <tr\n    ref={ref}\n    className={cn(\n      \"border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted\",\n      className\n    )}\n    {...props}\n  />\n))\nTableRow.displayName = \"TableRow\"\n\nconst TableHead = React.forwardRef<\n  HTMLTableCellElement,\n  React.ThHTMLAttributes<HTMLTableCellElement>\n>(({ className, ...props }, ref) => (\n  <th\n    ref={ref}\n    className={cn(\n      \"h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0\",\n      className\n    )}\n    {...props}\n  />\n))\nTableHead.displayName = \"TableHead\"\n\nconst TableCell = React.forwardRef<\n  HTMLTableCellElement,\n  React.TdHTMLAttributes<HTMLTableCellElement>\n>(({ className, ...props }, ref) => (\n  <td\n    ref={ref}\n    className={cn(\"p-4 align-middle [&:has([role=checkbox])]:pr-0\", className)}\n    {...props}\n  />\n))\nTableCell.displayName = \"TableCell\"\n\nconst TableCaption = React.forwardRef<\n  HTMLTableCaptionElement,\n  React.HTMLAttributes<HTMLTableCaptionElement>\n>(({ className, ...props }, ref) => (\n  <caption\n    ref={ref}\n    className={cn(\"mt-4 text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nTableCaption.displayName = \"TableCaption\"\n\nexport {\n  Table,\n  TableHeader,\n  TableBody,\n  TableFooter,\n  TableHead,\n  TableRow,\n  TableCell,\n  TableCaption,\n}\n","size_bytes":2765},"client/src/main.tsx":{"content":"import { createRoot } from \"react-dom/client\";\nimport App from \"./App\";\nimport \"./index.css\";\n\ncreateRoot(document.getElementById(\"root\")!).render(<App />);\n","size_bytes":157},"client/src/components/ui/pagination.tsx":{"content":"import * as React from \"react\"\nimport { ChevronLeft, ChevronRight, MoreHorizontal } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { ButtonProps, buttonVariants } from \"@/components/ui/button\"\n\nconst Pagination = ({ className, ...props }: React.ComponentProps<\"nav\">) => (\n  <nav\n    role=\"navigation\"\n    aria-label=\"pagination\"\n    className={cn(\"mx-auto flex w-full justify-center\", className)}\n    {...props}\n  />\n)\nPagination.displayName = \"Pagination\"\n\nconst PaginationContent = React.forwardRef<\n  HTMLUListElement,\n  React.ComponentProps<\"ul\">\n>(({ className, ...props }, ref) => (\n  <ul\n    ref={ref}\n    className={cn(\"flex flex-row items-center gap-1\", className)}\n    {...props}\n  />\n))\nPaginationContent.displayName = \"PaginationContent\"\n\nconst PaginationItem = React.forwardRef<\n  HTMLLIElement,\n  React.ComponentProps<\"li\">\n>(({ className, ...props }, ref) => (\n  <li ref={ref} className={cn(\"\", className)} {...props} />\n))\nPaginationItem.displayName = \"PaginationItem\"\n\ntype PaginationLinkProps = {\n  isActive?: boolean\n} & Pick<ButtonProps, \"size\"> &\n  React.ComponentProps<\"a\">\n\nconst PaginationLink = ({\n  className,\n  isActive,\n  size = \"icon\",\n  ...props\n}: PaginationLinkProps) => (\n  <a\n    aria-current={isActive ? \"page\" : undefined}\n    className={cn(\n      buttonVariants({\n        variant: isActive ? \"outline\" : \"ghost\",\n        size,\n      }),\n      className\n    )}\n    {...props}\n  />\n)\nPaginationLink.displayName = \"PaginationLink\"\n\nconst PaginationPrevious = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof PaginationLink>) => (\n  <PaginationLink\n    aria-label=\"Go to previous page\"\n    size=\"default\"\n    className={cn(\"gap-1 pl-2.5\", className)}\n    {...props}\n  >\n    <ChevronLeft className=\"h-4 w-4\" />\n    <span>Previous</span>\n  </PaginationLink>\n)\nPaginationPrevious.displayName = \"PaginationPrevious\"\n\nconst PaginationNext = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof PaginationLink>) => (\n  <PaginationLink\n    aria-label=\"Go to next page\"\n    size=\"default\"\n    className={cn(\"gap-1 pr-2.5\", className)}\n    {...props}\n  >\n    <span>Next</span>\n    <ChevronRight className=\"h-4 w-4\" />\n  </PaginationLink>\n)\nPaginationNext.displayName = \"PaginationNext\"\n\nconst PaginationEllipsis = ({\n  className,\n  ...props\n}: React.ComponentProps<\"span\">) => (\n  <span\n    aria-hidden\n    className={cn(\"flex h-9 w-9 items-center justify-center\", className)}\n    {...props}\n  >\n    <MoreHorizontal className=\"h-4 w-4\" />\n    <span className=\"sr-only\">More pages</span>\n  </span>\n)\nPaginationEllipsis.displayName = \"PaginationEllipsis\"\n\nexport {\n  Pagination,\n  PaginationContent,\n  PaginationEllipsis,\n  PaginationItem,\n  PaginationLink,\n  PaginationNext,\n  PaginationPrevious,\n}\n","size_bytes":2751},"client/src/components/ui/input.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Input = React.forwardRef<HTMLInputElement, React.ComponentProps<\"input\">>(\n  ({ className, type, ...props }, ref) => {\n    return (\n      <input\n        type={type}\n        className={cn(\n          \"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm\",\n          className\n        )}\n        ref={ref}\n        {...props}\n      />\n    )\n  }\n)\nInput.displayName = \"Input\"\n\nexport { Input }\n","size_bytes":791},"client/src/components/ui/skeleton.tsx":{"content":"import { cn } from \"@/lib/utils\"\n\nfunction Skeleton({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) {\n  return (\n    <div\n      className={cn(\"animate-pulse rounded-md bg-muted\", className)}\n      {...props}\n    />\n  )\n}\n\nexport { Skeleton }\n","size_bytes":261},"client/src/components/ui/calendar.tsx":{"content":"import * as React from \"react\"\nimport { ChevronLeft, ChevronRight } from \"lucide-react\"\nimport { DayPicker } from \"react-day-picker\"\n\nimport { cn } from \"@/lib/utils\"\nimport { buttonVariants } from \"@/components/ui/button\"\n\nexport type CalendarProps = React.ComponentProps<typeof DayPicker>\n\nfunction Calendar({\n  className,\n  classNames,\n  showOutsideDays = true,\n  ...props\n}: CalendarProps) {\n  return (\n    <DayPicker\n      showOutsideDays={showOutsideDays}\n      className={cn(\"p-3\", className)}\n      classNames={{\n        months: \"flex flex-col sm:flex-row space-y-4 sm:space-x-4 sm:space-y-0\",\n        month: \"space-y-4\",\n        caption: \"flex justify-center pt-1 relative items-center\",\n        caption_label: \"text-sm font-medium\",\n        nav: \"space-x-1 flex items-center\",\n        nav_button: cn(\n          buttonVariants({ variant: \"outline\" }),\n          \"h-7 w-7 bg-transparent p-0 opacity-50 hover:opacity-100\"\n        ),\n        nav_button_previous: \"absolute left-1\",\n        nav_button_next: \"absolute right-1\",\n        table: \"w-full border-collapse space-y-1\",\n        head_row: \"flex\",\n        head_cell:\n          \"text-muted-foreground rounded-md w-9 font-normal text-[0.8rem]\",\n        row: \"flex w-full mt-2\",\n        cell: \"h-9 w-9 text-center text-sm p-0 relative [&:has([aria-selected].day-range-end)]:rounded-r-md [&:has([aria-selected].day-outside)]:bg-accent/50 [&:has([aria-selected])]:bg-accent first:[&:has([aria-selected])]:rounded-l-md last:[&:has([aria-selected])]:rounded-r-md focus-within:relative focus-within:z-20\",\n        day: cn(\n          buttonVariants({ variant: \"ghost\" }),\n          \"h-9 w-9 p-0 font-normal aria-selected:opacity-100\"\n        ),\n        day_range_end: \"day-range-end\",\n        day_selected:\n          \"bg-primary text-primary-foreground hover:bg-primary hover:text-primary-foreground focus:bg-primary focus:text-primary-foreground\",\n        day_today: \"bg-accent text-accent-foreground\",\n        day_outside:\n          \"day-outside text-muted-foreground aria-selected:bg-accent/50 aria-selected:text-muted-foreground\",\n        day_disabled: \"text-muted-foreground opacity-50\",\n        day_range_middle:\n          \"aria-selected:bg-accent aria-selected:text-accent-foreground\",\n        day_hidden: \"invisible\",\n        ...classNames,\n      }}\n      components={{\n        IconLeft: ({ className, ...props }) => (\n          <ChevronLeft className={cn(\"h-4 w-4\", className)} {...props} />\n        ),\n        IconRight: ({ className, ...props }) => (\n          <ChevronRight className={cn(\"h-4 w-4\", className)} {...props} />\n        ),\n      }}\n      {...props}\n    />\n  )\n}\nCalendar.displayName = \"Calendar\"\n\nexport { Calendar }\n","size_bytes":2695},"server/emotionalAIService.ts":{"content":"import { db } from './db';\nimport { emotionalAnalyses, moodProfiles, responseRecommendations } from \"@shared/schema\";\nimport { eq, and, desc } from \"drizzle-orm\";\n\nexport const emotionalAIService = {\n  async analyzeInteraction(\n    userId: string,\n    interactionType: string,\n    messageContent: string,\n    interactionId?: string,\n    creatorId?: string\n  ) {\n    const sentimentResult = this.analyzeSentiment(messageContent);\n    const emotionResult = this.detectEmotion(messageContent);\n    const toxicity = this.calculateToxicity(messageContent);\n    const keywords = this.extractKeywords(messageContent);\n    const urgency = this.determineUrgency(emotionResult, sentimentResult.score, toxicity);\n    const engagementPotential = this.calculateEngagementPotential(\n      emotionResult,\n      sentimentResult.score,\n      interactionType\n    );\n\n    const [analysis] = await db.insert(emotionalAnalyses).values({\n      userId,\n      interactionType: interactionType as any,\n      interactionId,\n      messageContent,\n      sentimentScore: sentimentResult.score.toFixed(2),\n      dominantEmotion: emotionResult.dominantEmotion as any,\n      emotionScores: emotionResult.scores,\n      urgency: urgency as any,\n      responseRecommended: urgency === 'high' || urgency === 'critical',\n      engagementPotential: engagementPotential.toFixed(2),\n      toxicityScore: toxicity.toFixed(2),\n      keywords,\n      context: { interactionType, timestamp: new Date().toISOString() },\n      creatorId,\n    } as any).returning();\n\n    await this.updateMoodProfile(userId, emotionResult.dominantEmotion, sentimentResult.score, creatorId);\n\n    if (analysis.responseRecommended) {\n      await this.generateResponseRecommendation(analysis.id, userId, creatorId || '', analysis);\n    }\n\n    return analysis;\n  },\n\n  analyzeSentiment(text: string): { score: number; label: string } {\n    const positiveWords = ['love', 'amazing', 'great', 'awesome', 'fantastic', 'wonderful', 'excited', 'happy', 'perfect', 'excellent', 'best', 'beautiful', 'enjoy'];\n    const negativeWords = ['hate', 'terrible', 'awful', 'bad', 'worst', 'horrible', 'sad', 'angry', 'disappointed', 'frustrating', 'annoying', 'poor', 'upset'];\n    \n    const lowerText = text.toLowerCase();\n    let score = 50;\n    \n    positiveWords.forEach(word => {\n      if (lowerText.includes(word)) {\n        score += 10;\n      }\n    });\n    \n    negativeWords.forEach(word => {\n      if (lowerText.includes(word)) {\n        score -= 10;\n      }\n    });\n\n    if (lowerText.includes('!')) score += 5;\n    if (lowerText.includes('?') && score > 50) score += 3;\n    \n    score = Math.max(0, Math.min(100, score));\n    \n    const label = score >= 60 ? 'positive' : score <= 40 ? 'negative' : 'neutral';\n    \n    return { score, label };\n  },\n\n  detectEmotion(text: string): { dominantEmotion: string; scores: any } {\n    const emotionKeywords = {\n      joy: ['happy', 'excited', 'amazing', 'love', 'wonderful', 'great', 'yay', 'awesome'],\n      sadness: ['sad', 'depressed', 'unhappy', 'miss', 'lonely', 'crying', 'hurt'],\n      anger: ['angry', 'mad', 'furious', 'hate', 'annoyed', 'pissed'],\n      fear: ['scared', 'afraid', 'worried', 'anxious', 'nervous', 'terrified'],\n      surprise: ['wow', 'omg', 'shocking', 'unexpected', 'amazing', 'incredible'],\n      love: ['love', 'adore', 'cherish', 'romantic', 'hearts', 'kiss'],\n      excitement: ['excited', 'pumped', 'hyped', 'thrilled', 'eager', 'can\\'t wait'],\n      frustration: ['frustrated', 'annoying', 'irritating', 'ugh', 'seriously'],\n      neutral: ['okay', 'fine', 'sure', 'alright', 'whatever']\n    };\n\n    const scores: any = {};\n    const lowerText = text.toLowerCase();\n    \n    Object.entries(emotionKeywords).forEach(([emotion, keywords]) => {\n      let score = 0;\n      keywords.forEach(keyword => {\n        if (lowerText.includes(keyword)) {\n          score += 15;\n        }\n      });\n      scores[emotion] = Math.min(100, score);\n    });\n\n    const dominantEmotion = Object.entries(scores).reduce((a, b) => \n      scores[a[0]] > scores[b[0]] ? a : b\n    )[0];\n\n    return { dominantEmotion, scores };\n  },\n\n  calculateToxicity(text: string): number {\n    const toxicWords = ['stupid', 'idiot', 'dumb', 'loser', 'ugly', 'fat', 'worthless', 'trash', 'disgusting'];\n    const lowerText = text.toLowerCase();\n    \n    let toxicity = 0;\n    toxicWords.forEach(word => {\n      if (lowerText.includes(word)) {\n        toxicity += 20;\n      }\n    });\n\n    if (lowerText.includes('!!')) toxicity += 5;\n    if (lowerText.match(/[A-Z]{3,}/)) toxicity += 10;\n    \n    return Math.min(100, toxicity);\n  },\n\n  extractKeywords(text: string): string[] {\n    const stopWords = ['the', 'is', 'at', 'which', 'on', 'a', 'an', 'as', 'are', 'was', 'were', 'be', 'have', 'has', 'had', 'do', 'does', 'did', 'will', 'would', 'should', 'could', 'may', 'might', 'must', 'can'];\n    const words = text.toLowerCase().split(/\\W+/).filter(word => \n      word.length > 3 && !stopWords.includes(word)\n    );\n    \n    const frequency: { [key: string]: number } = {};\n    words.forEach(word => {\n      frequency[word] = (frequency[word] || 0) + 1;\n    });\n    \n    return Object.entries(frequency)\n      .sort((a, b) => b[1] - a[1])\n      .slice(0, 10)\n      .map(([word]) => word);\n  },\n\n  determineUrgency(\n    emotionResult: any, \n    sentimentScore: number, \n    toxicity: number\n  ): string {\n    if (toxicity > 50 || emotionResult.dominantEmotion === 'anger') return 'critical';\n    if (emotionResult.dominantEmotion === 'sadness' || sentimentScore < 30) return 'high';\n    if (emotionResult.dominantEmotion === 'frustration' || sentimentScore < 40) return 'medium';\n    return 'low';\n  },\n\n  calculateEngagementPotential(\n    emotionResult: any, \n    sentimentScore: number, \n    interactionType: string\n  ): number {\n    let potential = 50;\n    \n    const highEngagementEmotions = ['love', 'excitement', 'joy'];\n    if (highEngagementEmotions.includes(emotionResult.dominantEmotion)) {\n      potential += 30;\n    }\n    \n    if (sentimentScore > 70) potential += 20;\n    if (sentimentScore < 30) potential -= 20;\n    \n    if (interactionType === 'tip') potential += 25;\n    if (interactionType === 'subscription') potential += 20;\n    if (interactionType === 'message') potential += 10;\n    \n    return Math.max(0, Math.min(100, potential));\n  },\n\n  async updateMoodProfile(\n    userId: string, \n    emotion: string, \n    sentimentScore: number,\n    creatorId?: string\n  ) {\n    const existingProfile = await db.query.moodProfiles.findFirst({\n      where: creatorId \n        ? and(eq(moodProfiles.userId, userId), eq(moodProfiles.creatorId, creatorId))\n        : eq(moodProfiles.userId, userId)\n    });\n\n    if (existingProfile) {\n      const currentFreq = existingProfile.interactionFrequency || 0;\n      const currentPositive = existingProfile.positiveInteractions || 0;\n      const currentNegative = existingProfile.negativeInteractions || 0;\n      \n      const newInteractionCount = currentFreq + 1;\n      const newPositive = sentimentScore > 60 ? currentPositive + 1 : currentPositive;\n      const newNegative = sentimentScore < 40 ? currentNegative + 1 : currentNegative;\n      const newAvgSentiment = ((parseFloat(existingProfile.averageSentiment || '50') * currentFreq) + sentimentScore) / newInteractionCount;\n\n      const emotionalJourney = Array.isArray(existingProfile.emotionalJourney) \n        ? existingProfile.emotionalJourney \n        : [];\n      emotionalJourney.push({\n        timestamp: new Date().toISOString(),\n        emotion,\n        sentimentScore,\n      });\n\n      const currentMood = this.determineMood(emotion, sentimentScore);\n      const moodScore = this.calculateMoodScore(emotion, sentimentScore);\n      const moodTrend = this.calculateMoodTrend(emotionalJourney);\n      const engagementLevel = this.determineEngagementLevel(newInteractionCount, newAvgSentiment);\n      const churnRisk = this.calculateChurnRisk(moodTrend, newAvgSentiment, newInteractionCount);\n\n      await db.update(moodProfiles)\n        .set({\n          currentMood: currentMood as any,\n          moodScore: moodScore.toFixed(2),\n          moodTrend: moodTrend as any,\n          emotionalJourney: emotionalJourney.slice(-50),\n          interactionFrequency: newInteractionCount,\n          positiveInteractions: newPositive,\n          negativeInteractions: newNegative,\n          averageSentiment: newAvgSentiment.toFixed(2),\n          lastInteractionEmotion: emotion,\n          engagementLevel: engagementLevel as any,\n          churnRisk: churnRisk.toFixed(2),\n          recommendedActions: this.generateRecommendedActions(moodTrend, churnRisk, engagementLevel),\n          lastUpdated: new Date(),\n        } as any)\n        .where(eq(moodProfiles.id, existingProfile.id));\n    } else {\n      const currentMood = this.determineMood(emotion, sentimentScore);\n      const moodScore = this.calculateMoodScore(emotion, sentimentScore);\n\n      await db.insert(moodProfiles).values({\n        userId,\n        currentMood: currentMood as any,\n        moodScore: moodScore.toFixed(2),\n        moodTrend: 'stable',\n        emotionalJourney: [{\n          timestamp: new Date().toISOString(),\n          emotion,\n          sentimentScore,\n        }],\n        interactionFrequency: 1,\n        positiveInteractions: sentimentScore > 60 ? 1 : 0,\n        negativeInteractions: sentimentScore < 40 ? 1 : 0,\n        averageSentiment: sentimentScore.toFixed(2),\n        lastInteractionEmotion: emotion,\n        engagementLevel: 'casual',\n        churnRisk: '0',\n        recommendedActions: [],\n        creatorId,\n      } as any);\n    }\n  },\n\n  determineMood(emotion: string, sentimentScore: number): string {\n    if (['excitement', 'joy', 'love'].includes(emotion)) return 'excited';\n    if (sentimentScore > 70) return 'positive';\n    if (sentimentScore < 30) return 'negative';\n    if (['anger', 'frustration'].includes(emotion)) return 'stressed';\n    if (sentimentScore >= 45 && sentimentScore <= 55) return 'calm';\n    return 'neutral';\n  },\n\n  calculateMoodScore(emotion: string, sentimentScore: number): number {\n    const emotionBonus: { [key: string]: number } = {\n      joy: 20,\n      love: 25,\n      excitement: 20,\n      neutral: 0,\n      sadness: -20,\n      anger: -25,\n      fear: -15,\n      frustration: -15,\n    };\n\n    let score = sentimentScore + (emotionBonus[emotion] || 0);\n    return Math.max(0, Math.min(100, score));\n  },\n\n  calculateMoodTrend(emotionalJourney: any[]): string {\n    if (emotionalJourney.length < 5) return 'stable';\n    \n    const recent = emotionalJourney.slice(-5);\n    const avgRecent = recent.reduce((sum, entry) => sum + entry.sentimentScore, 0) / recent.length;\n    \n    const older = emotionalJourney.slice(-10, -5);\n    if (older.length === 0) return 'stable';\n    \n    const avgOlder = older.reduce((sum, entry) => sum + entry.sentimentScore, 0) / older.length;\n    \n    if (avgRecent > avgOlder + 10) return 'improving';\n    if (avgRecent < avgOlder - 10) return 'declining';\n    return 'stable';\n  },\n\n  determineEngagementLevel(interactionCount: number, avgSentiment: number): string {\n    if (interactionCount > 100 && avgSentiment > 70) return 'super_fan';\n    if (interactionCount > 50 && avgSentiment > 60) return 'highly_engaged';\n    if (interactionCount > 20) return 'regular';\n    if (interactionCount > 5) return 'casual';\n    return 'disengaged';\n  },\n\n  calculateChurnRisk(moodTrend: string, avgSentiment: number, interactionCount: number): number {\n    let risk = 0;\n    \n    if (moodTrend === 'declining') risk += 40;\n    if (avgSentiment < 40) risk += 30;\n    if (interactionCount < 10) risk += 20;\n    if (avgSentiment < 30) risk += 10;\n    \n    return Math.min(100, risk);\n  },\n\n  generateRecommendedActions(moodTrend: string, churnRisk: number, engagementLevel: string): string[] {\n    const actions = [];\n    \n    if (moodTrend === 'declining') {\n      actions.push('Send personalized check-in message');\n      actions.push('Offer exclusive content as appreciation');\n    }\n    \n    if (churnRisk > 50) {\n      actions.push('Priority response to next message');\n      actions.push('Consider special discount or offer');\n    }\n    \n    if (engagementLevel === 'super_fan') {\n      actions.push('Invite to exclusive community');\n      actions.push('Offer personalized content opportunity');\n    }\n    \n    if (engagementLevel === 'disengaged') {\n      actions.push('Re-engagement campaign');\n      actions.push('Survey to understand preferences');\n    }\n    \n    return actions;\n  },\n\n  async generateResponseRecommendation(\n    analysisId: string,\n    userId: string,\n    creatorId: string,\n    analysis: any\n  ) {\n    const recommendationType = this.determineRecommendationType(analysis);\n    const priority = this.determinePriority(analysis.urgency, analysis.toxicityScore);\n    const suggestedResponse = this.generateSuggestedResponse(analysis);\n    const responseVariants = this.generateResponseVariants(analysis);\n    const actionItems = this.generateActionItems(analysis);\n    const expectedOutcome = this.generateExpectedOutcome(recommendationType);\n    const confidenceScore = this.calculateConfidence(analysis);\n\n    await db.insert(responseRecommendations).values({\n      analysisId,\n      userId,\n      creatorId,\n      recommendationType: recommendationType as any,\n      priority: priority as any,\n      suggestedResponse,\n      responseVariants,\n      actionItems,\n      expectedOutcome,\n      confidenceScore: confidenceScore.toFixed(2),\n      emotionalContext: {\n        emotion: analysis.dominantEmotion,\n        sentiment: analysis.sentimentScore,\n        urgency: analysis.urgency,\n      },\n      personalizationTags: this.generatePersonalizationTags(analysis),\n    } as any);\n  },\n\n  determineRecommendationType(analysis: any): string {\n    if (parseFloat(analysis.toxicityScore) > 50) return 'emergency_response';\n    if (analysis.dominantEmotion === 'sadness') return 'empathetic_response';\n    if (parseFloat(analysis.engagementPotential) > 70) return 'engagement_boost';\n    if (analysis.interactionType === 'tip' || analysis.interactionType === 'purchase') return 'upsell_opportunity';\n    if (parseFloat(analysis.sentimentScore) < 40) return 'retention_action';\n    return 'empathetic_response';\n  },\n\n  determinePriority(urgency: string, toxicityScore: string): string {\n    if (urgency === 'critical' || parseFloat(toxicityScore) > 60) return 'urgent';\n    if (urgency === 'high') return 'high';\n    if (urgency === 'medium') return 'medium';\n    return 'low';\n  },\n\n  generateSuggestedResponse(analysis: any): string {\n    const responses: { [key: string]: string[] } = {\n      joy: [\n        \"I'm so glad you're enjoying this! Your happiness means everything to me! ðŸ’™\",\n        \"Your energy is contagious! Thank you for being such an amazing supporter!\",\n      ],\n      love: [\n        \"Your love and support mean the world to me! Thank you for being here! â¤ï¸\",\n        \"I appreciate you so much! Your messages always make my day!\",\n      ],\n      sadness: [\n        \"I'm here for you. Thank you for sharing what you're feeling with me. ðŸ’™\",\n        \"Sending you so much love and support. You're not alone in this.\",\n      ],\n      anger: [\n        \"I hear you, and I'm sorry you're frustrated. Let's work through this together.\",\n        \"Your feelings are valid. How can I make this better for you?\",\n      ],\n      excitement: [\n        \"Your excitement is everything! Let's keep this energy going! ðŸ”¥\",\n        \"I love your enthusiasm! Can't wait to share more with you!\",\n      ],\n      frustration: [\n        \"I understand your frustration, and I'm here to help. What can I do to improve?\",\n        \"Thank you for your patience. Let me make this right for you.\",\n      ],\n      neutral: [\n        \"Thanks for reaching out! How can I make your experience even better?\",\n        \"I appreciate you being here! What would you like to see more of?\",\n      ],\n    };\n\n    const emotion = analysis.dominantEmotion;\n    const options = responses[emotion] || responses.neutral;\n    return options[Math.floor(Math.random() * options.length)];\n  },\n\n  generateResponseVariants(analysis: any): string[] {\n    const variants = [];\n    const emotion = analysis.dominantEmotion;\n    \n    if (['joy', 'love', 'excitement'].includes(emotion)) {\n      variants.push(\"Your support lights up my day! Thank you!\");\n      variants.push(\"I'm grateful to have you here with me!\");\n      variants.push(\"You're amazing! Thanks for being you!\");\n    } else if (['sadness', 'frustration'].includes(emotion)) {\n      variants.push(\"I'm sending you love and understanding. You matter to me.\");\n      variants.push(\"Your feelings are important. I'm here to listen.\");\n      variants.push(\"Thank you for trusting me with how you feel.\");\n    } else {\n      variants.push(\"I appreciate you reaching out!\");\n      variants.push(\"Thanks for being part of this journey!\");\n      variants.push(\"Your thoughts mean a lot to me!\");\n    }\n    \n    return variants;\n  },\n\n  generateActionItems(analysis: any): string[] {\n    const actions = [];\n    \n    if (parseFloat(analysis.toxicityScore) > 40) {\n      actions.push('Flag for moderation review');\n      actions.push('Set boundaries if needed');\n    }\n    \n    if (parseFloat(analysis.engagementPotential) > 70) {\n      actions.push('Follow up with exclusive content');\n      actions.push('Invite to special event or community');\n    }\n    \n    if (analysis.dominantEmotion === 'sadness') {\n      actions.push('Send supportive follow-up message');\n      actions.push('Offer personalized attention');\n    }\n    \n    if (analysis.interactionType === 'tip') {\n      actions.push('Send personalized thank you');\n      actions.push('Consider offering tipper exclusive benefit');\n    }\n    \n    return actions;\n  },\n\n  generateExpectedOutcome(recommendationType: string): string {\n    const outcomes: { [key: string]: string } = {\n      empathetic_response: 'Strengthen emotional connection and build trust',\n      engagement_boost: 'Increase interaction frequency and content engagement',\n      upsell_opportunity: 'Drive additional purchases and increase revenue',\n      retention_action: 'Reduce churn risk and improve satisfaction',\n      emergency_response: 'De-escalate situation and maintain safety',\n    };\n    \n    return outcomes[recommendationType] || 'Improve overall relationship quality';\n  },\n\n  calculateConfidence(analysis: any): number {\n    let confidence = 70;\n    \n    if (analysis.keywords && analysis.keywords.length > 5) confidence += 10;\n    if (parseFloat(analysis.sentimentScore) > 70 || parseFloat(analysis.sentimentScore) < 30) confidence += 10;\n    if (analysis.dominantEmotion !== 'neutral') confidence += 10;\n    \n    return Math.min(100, confidence);\n  },\n\n  generatePersonalizationTags(analysis: any): string[] {\n    const tags = [];\n    \n    tags.push(analysis.dominantEmotion);\n    tags.push(analysis.interactionType);\n    \n    if (parseFloat(analysis.sentimentScore) > 70) tags.push('positive_sentiment');\n    if (parseFloat(analysis.sentimentScore) < 40) tags.push('negative_sentiment');\n    if (parseFloat(analysis.engagementPotential) > 70) tags.push('high_engagement');\n    if (parseFloat(analysis.toxicityScore) > 40) tags.push('needs_moderation');\n    \n    return tags;\n  },\n\n  async getAnalysis(analysisId: string) {\n    return await db.query.emotionalAnalyses.findFirst({\n      where: eq(emotionalAnalyses.id, analysisId)\n    });\n  },\n\n  async getUserAnalyses(userId: string, limit: number = 50) {\n    return await db.query.emotionalAnalyses.findMany({\n      where: eq(emotionalAnalyses.userId, userId),\n      orderBy: [desc(emotionalAnalyses.analyzedAt)],\n      limit\n    });\n  },\n\n  async getCreatorAnalyses(creatorId: string, limit: number = 100) {\n    return await db.query.emotionalAnalyses.findMany({\n      where: eq(emotionalAnalyses.creatorId, creatorId),\n      orderBy: [desc(emotionalAnalyses.analyzedAt)],\n      limit\n    });\n  },\n\n  async getMoodProfile(userId: string, creatorId?: string) {\n    return await db.query.moodProfiles.findFirst({\n      where: creatorId \n        ? and(eq(moodProfiles.userId, userId), eq(moodProfiles.creatorId, creatorId))\n        : eq(moodProfiles.userId, userId)\n    });\n  },\n\n  async getCreatorMoodProfiles(creatorId: string, limit: number = 100) {\n    return await db.query.moodProfiles.findMany({\n      where: eq(moodProfiles.creatorId, creatorId),\n      orderBy: [desc(moodProfiles.lastUpdated)],\n      limit\n    });\n  },\n\n  async getRecommendation(recommendationId: string) {\n    return await db.query.responseRecommendations.findFirst({\n      where: eq(responseRecommendations.id, recommendationId)\n    });\n  },\n\n  async getCreatorRecommendations(creatorId: string, onlyUnused: boolean = false, limit: number = 50) {\n    return await db.query.responseRecommendations.findMany({\n      where: onlyUnused \n        ? and(eq(responseRecommendations.creatorId, creatorId), eq(responseRecommendations.used, false))\n        : eq(responseRecommendations.creatorId, creatorId),\n      orderBy: [desc(responseRecommendations.createdAt)],\n      limit\n    });\n  },\n\n  async markRecommendationUsed(recommendationId: string, effectiveness?: number, feedback?: string) {\n    await db.update(responseRecommendations)\n      .set({\n        used: true,\n        usedAt: new Date(),\n        effectiveness: effectiveness?.toFixed(2),\n        userFeedback: feedback,\n      } as any)\n      .where(eq(responseRecommendations.id, recommendationId));\n  },\n\n  async getHighPriorityRecommendations(creatorId: string) {\n    return await db.query.responseRecommendations.findMany({\n      where: and(\n        eq(responseRecommendations.creatorId, creatorId),\n        eq(responseRecommendations.used, false)\n      ),\n      orderBy: [desc(responseRecommendations.createdAt)],\n      limit: 20\n    });\n  },\n};\n","size_bytes":21852},"client/src/pages/Tutorials.tsx":{"content":"import { useState } from \"react\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Progress } from \"@/components/ui/progress\";\nimport { \n  Play, \n  BookOpen, \n  CheckCircle, \n  Clock, \n  Users, \n  Star,\n  Video,\n  FileText,\n  Zap\n} from \"lucide-react\";\n\nconst tutorialCategories = [\n  {\n    id: \"getting-started\",\n    title: \"Getting Started\",\n    description: \"Essential tutorials for new users\",\n    color: \"bg-blue-500\",\n  },\n  {\n    id: \"creators\",\n    title: \"Creator Tutorials\",\n    description: \"Guides for content creators\",\n    color: \"bg-purple-500\",\n  },\n  {\n    id: \"fans\",\n    title: \"Fan Tutorials\", \n    description: \"How to support your favorite creators\",\n    color: \"bg-pink-500\",\n  },\n  {\n    id: \"advanced\",\n    title: \"Advanced Features\",\n    description: \"Master advanced platform features\",\n    color: \"bg-green-500\",\n  },\n];\n\nconst tutorials = [\n  // Getting Started\n  {\n    id: \"welcome\",\n    category: \"getting-started\",\n    title: \"Welcome to FUN Empire\",\n    description: \"Learn about GirlFanz, PupFanz, and DaddyFanz platforms\",\n    duration: \"5 min\",\n    type: \"video\",\n    difficulty: \"beginner\",\n    completed: false,\n    rating: 4.8,\n    views: 15420,\n  },\n  {\n    id: \"profile-setup\",\n    category: \"getting-started\", \n    title: \"Setting Up Your Profile\",\n    description: \"Create an attractive profile that stands out\",\n    duration: \"8 min\",\n    type: \"interactive\",\n    difficulty: \"beginner\",\n    completed: true,\n    rating: 4.9,\n    views: 12800,\n  },\n  {\n    id: \"age-verification\",\n    category: \"getting-started\",\n    title: \"Age Verification Process\",\n    description: \"Complete KYC and age verification safely\",\n    duration: \"6 min\", \n    type: \"guide\",\n    difficulty: \"beginner\",\n    completed: false,\n    rating: 4.7,\n    views: 9200,\n  },\n\n  // Creator Tutorials\n  {\n    id: \"content-creation\",\n    category: \"creators\",\n    title: \"Creating Your First Content\",\n    description: \"Upload and manage content across all tenants\",\n    duration: \"12 min\",\n    type: \"video\",\n    difficulty: \"intermediate\",\n    completed: false,\n    rating: 4.8,\n    views: 8500,\n  },\n  {\n    id: \"monetization\",\n    category: \"creators\",\n    title: \"Monetization Strategies\",\n    description: \"Maximize earnings with subscriptions and tips\",\n    duration: \"15 min\",\n    type: \"guide\",\n    difficulty: \"intermediate\",\n    completed: false,\n    rating: 4.9,\n    views: 11200,\n  },\n  {\n    id: \"cross-posting\",\n    category: \"creators\",\n    title: \"Cross-posting Content\",\n    description: \"Share content across GirlFanz, PupFanz, and DaddyFanz\",\n    duration: \"10 min\",\n    type: \"interactive\",\n    difficulty: \"intermediate\",\n    completed: false,\n    rating: 4.6,\n    views: 6800,\n  },\n\n  // Fan Tutorials\n  {\n    id: \"discovering-creators\",\n    category: \"fans\",\n    title: \"Discovering Amazing Creators\",\n    description: \"Find creators that match your interests\",\n    duration: \"7 min\",\n    type: \"video\",\n    difficulty: \"beginner\",\n    completed: false,\n    rating: 4.7,\n    views: 10500,\n  },\n  {\n    id: \"subscriptions\",\n    category: \"fans\",\n    title: \"Managing Subscriptions\",\n    description: \"Subscribe to creators and manage your preferences\",\n    duration: \"9 min\",\n    type: \"guide\",\n    difficulty: \"beginner\",\n    completed: false,\n    rating: 4.8,\n    views: 7200,\n  },\n\n  // Advanced\n  {\n    id: \"analytics\",\n    category: \"advanced\",\n    title: \"Understanding Analytics\",\n    description: \"Use data to grow your audience and earnings\",\n    duration: \"18 min\",\n    type: \"video\",\n    difficulty: \"advanced\",\n    completed: false,\n    rating: 4.9,\n    views: 4500,\n  },\n  {\n    id: \"api-integration\",\n    category: \"advanced\",\n    title: \"API Integration\",\n    description: \"Integrate with third-party tools and services\",\n    duration: \"25 min\",\n    type: \"guide\",\n    difficulty: \"advanced\",\n    completed: false,\n    rating: 4.6,\n    views: 2100,\n  },\n];\n\nexport default function Tutorials() {\n  const [selectedCategory, setSelectedCategory] = useState<string>(\"getting-started\");\n  const [selectedTutorial, setSelectedTutorial] = useState<string | null>(null);\n\n  const filteredTutorials = tutorials.filter(t => t.category === selectedCategory);\n  const completedCount = tutorials.filter(t => t.completed).length;\n  const progressPercentage = (completedCount / tutorials.length) * 100;\n\n  const getDifficultyColor = (difficulty: string) => {\n    switch (difficulty) {\n      case \"beginner\": return \"bg-green-500\";\n      case \"intermediate\": return \"bg-yellow-500\";\n      case \"advanced\": return \"bg-red-500\";\n      default: return \"bg-gray-500\";\n    }\n  };\n\n  const getTypeIcon = (type: string) => {\n    switch (type) {\n      case \"video\": return Video;\n      case \"interactive\": return Zap;\n      case \"guide\": return FileText;\n      default: return BookOpen;\n    }\n  };\n\n  return (\n    <div className=\"container mx-auto p-6 max-w-6xl\">\n      <div className=\"mb-8\">\n        <div className=\"flex items-center gap-2 mb-4\">\n          <BookOpen className=\"h-8 w-8 text-primary\" />\n          <h1 className=\"text-3xl font-bold\">Tutorials & Learning</h1>\n        </div>\n        <p className=\"text-muted-foreground text-lg mb-4\">\n          Master the FUN Empire platform with step-by-step tutorials\n        </p>\n        \n        {/* Progress */}\n        <div className=\"bg-card p-4 rounded-lg\">\n          <div className=\"flex items-center justify-between mb-2\">\n            <span className=\"text-sm font-medium\">Your Progress</span>\n            <span className=\"text-sm text-muted-foreground\">\n              {completedCount}/{tutorials.length} completed\n            </span>\n          </div>\n          <Progress value={progressPercentage} className=\"h-2\" />\n        </div>\n      </div>\n\n      <div className=\"grid gap-8 lg:grid-cols-4\">\n        {/* Categories */}\n        <div className=\"lg:col-span-1\">\n          <h2 className=\"text-xl font-semibold mb-4\">Categories</h2>\n          <div className=\"space-y-2\">\n            {tutorialCategories.map((category) => (\n              <Button\n                key={category.id}\n                variant={selectedCategory === category.id ? \"default\" : \"ghost\"}\n                className=\"w-full justify-start\"\n                onClick={() => setSelectedCategory(category.id)}\n                data-testid={`tutorial-category-${category.id}`}\n              >\n                <div className={`w-3 h-3 rounded-full ${category.color} mr-2`} />\n                <div className=\"text-left\">\n                  <div className=\"font-medium\">{category.title}</div>\n                  <div className=\"text-xs text-muted-foreground\">\n                    {category.description}\n                  </div>\n                </div>\n              </Button>\n            ))}\n          </div>\n        </div>\n\n        {/* Tutorials */}\n        <div className=\"lg:col-span-3\">\n          <div className=\"grid gap-4 md:grid-cols-2\">\n            {filteredTutorials.map((tutorial) => {\n              const TypeIcon = getTypeIcon(tutorial.type);\n              return (\n                <Card key={tutorial.id} \n                      className=\"hover:shadow-lg transition-shadow cursor-pointer\"\n                      onClick={() => setSelectedTutorial(tutorial.id)}\n                      data-testid={`tutorial-${tutorial.id}`}>\n                  <CardHeader className=\"pb-3\">\n                    <div className=\"flex items-start justify-between\">\n                      <div className=\"flex items-center gap-2\">\n                        <TypeIcon className=\"h-5 w-5 text-primary\" />\n                        <Badge variant=\"outline\" className=\"text-xs\">\n                          {tutorial.type}\n                        </Badge>\n                      </div>\n                      {tutorial.completed && (\n                        <CheckCircle className=\"h-5 w-5 text-green-500\" />\n                      )}\n                    </div>\n                    <CardTitle className=\"text-lg leading-tight\">\n                      {tutorial.title}\n                    </CardTitle>\n                    <CardDescription className=\"text-sm\">\n                      {tutorial.description}\n                    </CardDescription>\n                  </CardHeader>\n                  <CardContent className=\"pt-0\">\n                    <div className=\"flex items-center justify-between text-sm text-muted-foreground\">\n                      <div className=\"flex items-center gap-4\">\n                        <div className=\"flex items-center gap-1\">\n                          <Clock className=\"h-4 w-4\" />\n                          {tutorial.duration}\n                        </div>\n                        <div className=\"flex items-center gap-1\">\n                          <Users className=\"h-4 w-4\" />\n                          {tutorial.views.toLocaleString()}\n                        </div>\n                      </div>\n                      <div className=\"flex items-center gap-2\">\n                        <div className=\"flex items-center gap-1\">\n                          <Star className=\"h-4 w-4 fill-yellow-400 text-yellow-400\" />\n                          {tutorial.rating}\n                        </div>\n                      </div>\n                    </div>\n                    \n                    <div className=\"flex items-center justify-between mt-3\">\n                      <Badge variant=\"outline\" className={`text-xs ${getDifficultyColor(tutorial.difficulty)} text-white`}>\n                        {tutorial.difficulty}\n                      </Badge>\n                      <Button size=\"sm\" data-testid={`start-tutorial-${tutorial.id}`}>\n                        <Play className=\"h-4 w-4 mr-1\" />\n                        {tutorial.completed ? \"Review\" : \"Start\"}\n                      </Button>\n                    </div>\n                  </CardContent>\n                </Card>\n              );\n            })}\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}","size_bytes":10069},"server/gamificationService.ts":{"content":"import { db } from \"./db\";\nimport { \n  achievements, userAchievements, creatorTiers, fanEngagementRewards, \n  leaderboards, users, subscriptions, tips, content, userInteractions,\n  type Achievement, type UserAchievement, type CreatorTier, type FanEngagementReward\n} from \"@shared/schema\";\nimport { eq, and, gte, lte, desc, sql, count } from \"drizzle-orm\";\n\nexport class GamificationService {\n  \n  // ============================================================================\n  // ACHIEVEMENT SYSTEM\n  // ============================================================================\n\n  // Check and unlock achievements for a user\n  async checkAndUnlockAchievements(userId: string) {\n    const user = await db.select().from(users).where(eq(users.id, userId)).limit(1);\n    if (!user.length) return [];\n\n    const userRole = user[0].role;\n    // Get all achievements - we'll filter by applicability in the loop\n    const allAchievements = await db\n      .select()\n      .from(achievements);\n\n    const unlockedAchievements = await db\n      .select()\n      .from(userAchievements)\n      .where(eq(userAchievements.userId, userId));\n\n    const unlockedIds = new Set(unlockedAchievements.map(ua => ua.achievementId));\n    const newlyUnlocked: Achievement[] = [];\n\n    for (const achievement of allAchievements) {\n      if (!achievement.id || unlockedIds.has(achievement.id)) continue;\n\n      const requirement = achievement.requirement as any;\n      const meetsRequirement = await this.checkAchievementRequirement(userId, requirement, userRole);\n\n      if (meetsRequirement && achievement.id) {\n        // Unlock the achievement\n        await db.insert(userAchievements).values({\n          userId,\n          achievementId: achievement.id,\n          progress: 100,\n          metadata: { unlockedValue: meetsRequirement.value }\n        });\n\n        // Update tier points for creators\n        if (userRole === 'creator') {\n          await this.addCreatorTierPoints(userId, achievement.points || 100);\n        } else {\n          // Update loyalty points for fans\n          await this.addFanLoyaltyPoints(userId, achievement.points || 100);\n        }\n\n        newlyUnlocked.push(achievement);\n      }\n    }\n\n    return newlyUnlocked;\n  }\n\n  // Check if a user meets an achievement requirement\n  async checkAchievementRequirement(userId: string, requirement: any, userRole: string) {\n    const { type, threshold } = requirement;\n\n    switch (type) {\n      case 'subscriber_count': {\n        if (userRole !== 'creator') return null;\n        const subs = await db\n          .select({ count: count() })\n          .from(subscriptions)\n          .where(and(\n            eq(subscriptions.creatorId, userId),\n            eq(subscriptions.status, 'active')\n          ));\n        const value = subs[0]?.count || 0;\n        return value >= threshold ? { value } : null;\n      }\n\n      case 'total_earnings': {\n        if (userRole !== 'creator') return null;\n        const tierData = await db\n          .select()\n          .from(creatorTiers)\n          .where(eq(creatorTiers.userId, userId))\n          .limit(1);\n        const value = parseFloat(tierData[0]?.lifetimeEarnings || '0');\n        return value >= threshold ? { value } : null;\n      }\n\n      case 'content_count': {\n        if (userRole !== 'creator') return null;\n        const contentCount = await db\n          .select({ count: count() })\n          .from(content)\n          .where(eq(content.creatorUserId, userId));\n        const value = contentCount[0]?.count || 0;\n        return value >= threshold ? { value } : null;\n      }\n\n      case 'total_tips': {\n        if (userRole !== 'fan') return null;\n        const fanRewards = await db\n          .select()\n          .from(fanEngagementRewards)\n          .where(eq(fanEngagementRewards.userId, userId))\n          .limit(1);\n        const value = parseFloat(fanRewards[0]?.totalTipped || '0');\n        return value >= threshold ? { value } : null;\n      }\n\n      case 'streak_days': {\n        if (userRole !== 'fan') return null;\n        const fanRewards = await db\n          .select()\n          .from(fanEngagementRewards)\n          .where(eq(fanEngagementRewards.userId, userId))\n          .limit(1);\n        const value = fanRewards[0]?.streakDays || 0;\n        return value >= threshold ? { value } : null;\n      }\n\n      default:\n        return null;\n    }\n  }\n\n  // Get user achievements with progress\n  async getUserAchievements(userId: string) {\n    const unlocked = await db\n      .select({\n        achievement: achievements,\n        userAchievement: userAchievements,\n      })\n      .from(userAchievements)\n      .innerJoin(achievements, eq(userAchievements.achievementId, achievements.id))\n      .where(eq(userAchievements.userId, userId))\n      .orderBy(desc(userAchievements.unlockedAt));\n\n    return unlocked;\n  }\n\n  // ============================================================================\n  // CREATOR TIER SYSTEM\n  // ============================================================================\n\n  // Initialize creator tier for a new creator\n  async initializeCreatorTier(userId: string) {\n    const existing = await db\n      .select()\n      .from(creatorTiers)\n      .where(eq(creatorTiers.userId, userId))\n      .limit(1);\n\n    if (existing.length > 0) return existing[0];\n\n    const newTier = await db.insert(creatorTiers).values({\n      userId,\n      currentTier: 'starter',\n      tierPoints: 0,\n      nextTierThreshold: 1000,\n    }).returning();\n\n    return newTier[0];\n  }\n\n  // Update creator tier based on points\n  async addCreatorTierPoints(userId: string, points: number) {\n    const current = await db\n      .select()\n      .from(creatorTiers)\n      .where(eq(creatorTiers.userId, userId))\n      .limit(1);\n\n    if (!current.length) {\n      await this.initializeCreatorTier(userId);\n      return;\n    }\n\n    const tierData = current[0];\n    const newPoints = (tierData.tierPoints || 0) + points;\n    const { newTier, newThreshold } = this.calculateTierLevel(newPoints);\n\n    await db\n      .update(creatorTiers)\n      .set({\n        tierPoints: newPoints,\n        currentTier: newTier as any,\n        nextTierThreshold: newThreshold,\n        lastTierUpdate: new Date(),\n      })\n      .where(eq(creatorTiers.userId, userId));\n\n    return { tier: newTier, points: newPoints };\n  }\n\n  // Calculate tier level based on points\n  calculateTierLevel(points: number): { newTier: string; newThreshold: number } {\n    if (points >= 50000) return { newTier: 'legend', newThreshold: 999999 };\n    if (points >= 25000) return { newTier: 'diamond', newThreshold: 50000 };\n    if (points >= 10000) return { newTier: 'platinum', newThreshold: 25000 };\n    if (points >= 5000) return { newTier: 'gold', newThreshold: 10000 };\n    if (points >= 2000) return { newTier: 'silver', newThreshold: 5000 };\n    if (points >= 1000) return { newTier: 'bronze', newThreshold: 2000 };\n    return { newTier: 'starter', newThreshold: 1000 };\n  }\n\n  // Update creator stats (call this when creator earns money, gets subscribers, or posts content)\n  async updateCreatorStats(userId: string, updates: Partial<CreatorTier>) {\n    await db\n      .update(creatorTiers)\n      .set(updates)\n      .where(eq(creatorTiers.userId, userId));\n  }\n\n  // ============================================================================\n  // FAN ENGAGEMENT & REWARDS\n  // ============================================================================\n\n  // Initialize fan engagement tracking\n  async initializeFanRewards(userId: string) {\n    const existing = await db\n      .select()\n      .from(fanEngagementRewards)\n      .where(eq(fanEngagementRewards.userId, userId))\n      .limit(1);\n\n    if (existing.length > 0) return existing[0];\n\n    const newReward = await db.insert(fanEngagementRewards).values({\n      userId,\n      loyaltyPoints: 0,\n      streakDays: 0,\n      rewardTier: 'bronze',\n    }).returning();\n\n    return newReward[0];\n  }\n\n  // Add loyalty points to fan\n  async addFanLoyaltyPoints(userId: string, points: number) {\n    const current = await db\n      .select()\n      .from(fanEngagementRewards)\n      .where(eq(fanEngagementRewards.userId, userId))\n      .limit(1);\n\n    if (!current.length) {\n      await this.initializeFanRewards(userId);\n      return;\n    }\n\n    const fanData = current[0];\n    const newPoints = (fanData.loyaltyPoints || 0) + points;\n    const newTier = this.calculateFanRewardTier(newPoints);\n\n    await db\n      .update(fanEngagementRewards)\n      .set({\n        loyaltyPoints: newPoints,\n        rewardTier: newTier as any,\n      })\n      .where(eq(fanEngagementRewards.userId, userId));\n\n    return { tier: newTier, points: newPoints };\n  }\n\n  // Calculate fan reward tier based on loyalty points\n  calculateFanRewardTier(points: number): 'bronze' | 'silver' | 'gold' | 'vip' {\n    if (points >= 10000) return 'vip';\n    if (points >= 5000) return 'gold';\n    if (points >= 2000) return 'silver';\n    return 'bronze';\n  }\n\n  // Update fan daily check-in streak\n  async updateDailyCheckIn(userId: string) {\n    const current = await db\n      .select()\n      .from(fanEngagementRewards)\n      .where(eq(fanEngagementRewards.userId, userId))\n      .limit(1);\n\n    if (!current.length) {\n      await this.initializeFanRewards(userId);\n      return;\n    }\n\n    const fanData = current[0];\n    const now = new Date();\n    const lastCheckIn = fanData.lastCheckIn ? new Date(fanData.lastCheckIn) : null;\n\n    let newStreak = 1;\n    if (lastCheckIn) {\n      const diffDays = Math.floor((now.getTime() - lastCheckIn.getTime()) / (1000 * 60 * 60 * 24));\n      if (diffDays === 1) {\n        // Consecutive day\n        newStreak = (fanData.streakDays || 0) + 1;\n      } else if (diffDays > 1) {\n        // Streak broken\n        newStreak = 1;\n      } else {\n        // Same day, no update\n        return fanData;\n      }\n    }\n\n    // Award bonus points for streaks\n    const bonusPoints = newStreak >= 7 ? 500 : newStreak >= 3 ? 100 : 10;\n\n    await db\n      .update(fanEngagementRewards)\n      .set({\n        streakDays: newStreak,\n        lastCheckIn: now,\n        loyaltyPoints: (fanData.loyaltyPoints || 0) + bonusPoints,\n      })\n      .where(eq(fanEngagementRewards.userId, userId));\n\n    return { streak: newStreak, bonusPoints };\n  }\n\n  // ============================================================================\n  // LEADERBOARDS\n  // ============================================================================\n\n  // Compute and update leaderboards\n  async computeLeaderboards(period: 'daily' | 'weekly' | 'monthly' | 'alltime') {\n    const now = new Date();\n    let periodStart: Date;\n    let periodEnd: Date;\n\n    switch (period) {\n      case 'daily':\n        periodStart = new Date(now.setHours(0, 0, 0, 0));\n        periodEnd = new Date(now.setHours(23, 59, 59, 999));\n        break;\n      case 'weekly':\n        periodStart = new Date(now.setDate(now.getDate() - now.getDay()));\n        periodEnd = new Date(now.setDate(now.getDate() + 6));\n        break;\n      case 'monthly':\n        periodStart = new Date(now.getFullYear(), now.getMonth(), 1);\n        periodEnd = new Date(now.getFullYear(), now.getMonth() + 1, 0);\n        break;\n      default:\n        periodStart = new Date('2000-01-01');\n        periodEnd = new Date();\n    }\n\n    // Top Creators by subscriber count\n    const topCreators = await db\n      .select({\n        userId: subscriptions.creatorId,\n        score: count(),\n      })\n      .from(subscriptions)\n      .where(and(\n        eq(subscriptions.status, 'active'),\n        gte(subscriptions.createdAt, periodStart),\n        lte(subscriptions.createdAt, periodEnd)\n      ))\n      .groupBy(subscriptions.creatorId)\n      .orderBy(desc(count()))\n      .limit(100);\n\n    // Insert leaderboard entries\n    for (let i = 0; i < topCreators.length; i++) {\n      await db.insert(leaderboards).values({\n        period,\n        category: 'top_creators',\n        userId: topCreators[i].userId,\n        rank: i + 1,\n        score: String(topCreators[i].score),\n        periodStart,\n        periodEnd,\n      });\n    }\n\n    // Top Earners (creators)\n    const topEarners = await db\n      .select({\n        userId: creatorTiers.userId,\n        score: creatorTiers.lifetimeEarnings,\n      })\n      .from(creatorTiers)\n      .orderBy(desc(creatorTiers.lifetimeEarnings))\n      .limit(100);\n\n    for (let i = 0; i < topEarners.length; i++) {\n      await db.insert(leaderboards).values({\n        period,\n        category: 'top_earners',\n        userId: topEarners[i].userId,\n        rank: i + 1,\n        score: topEarners[i].score || '0',\n        periodStart,\n        periodEnd,\n      });\n    }\n\n    return { computed: true, period };\n  }\n\n  // Get leaderboard by category and period\n  async getLeaderboard(category: string, period: string, limit = 100) {\n    const leaderboardData = await db\n      .select({\n        leaderboard: leaderboards,\n        user: users,\n      })\n      .from(leaderboards)\n      .innerJoin(users, eq(leaderboards.userId, users.id))\n      .where(and(\n        sql`${leaderboards.category} = ${category}`,\n        sql`${leaderboards.period} = ${period}`\n      ))\n      .orderBy(leaderboards.rank)\n      .limit(limit);\n\n    return leaderboardData;\n  }\n\n  // Get user rank in a specific leaderboard\n  async getUserRank(userId: string, category: string, period: string) {\n    const userRank = await db\n      .select()\n      .from(leaderboards)\n      .where(and(\n        eq(leaderboards.userId, userId),\n        sql`${leaderboards.category} = ${category}`,\n        sql`${leaderboards.period} = ${period}`\n      ))\n      .limit(1);\n\n    return userRank[0] || null;\n  }\n}\n\nexport const gamificationService = new GamificationService();\n","size_bytes":13691},"client/src/pages/Guidelines.tsx":{"content":"import { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { \n  Shield, \n  AlertTriangle,\n  CheckCircle,\n  XCircle,\n  Heart,\n  Users\n} from \"lucide-react\";\n\nconst guidelines = [\n  {\n    title: \"Respect and Consent\",\n    icon: Heart,\n    rules: [\n      \"Always obtain and respect consent for all content and interactions\",\n      \"No harassment, bullying, or threatening behavior\",\n      \"Respect boundaries and privacy of all community members\",\n      \"Zero tolerance for non-consensual content sharing\"\n    ]\n  },\n  {\n    title: \"Age and Identity Verification\",\n    icon: Shield,\n    rules: [\n      \"All users must be 18 years or older\",\n      \"Complete age verification through our KYC process\",\n      \"No misrepresentation of age or identity\",\n      \"Verify co-stars and collaborators before content creation\"\n    ]\n  },\n  {\n    title: \"Prohibited Content\",\n    icon: XCircle,\n    rules: [\n      \"No content involving minors under any circumstances\",\n      \"No non-consensual or illegal activities\",\n      \"No violence, hate speech, or discriminatory content\",\n      \"No copyright infringement or stolen content\"\n    ]\n  },\n  {\n    title: \"Community Standards\",\n    icon: Users,\n    rules: [\n      \"Treat all members with respect and dignity\",\n      \"Use appropriate content warnings and tags\",\n      \"Report violations promptly through proper channels\",\n      \"Maintain authentic and honest interactions\"\n    ]\n  }\n];\n\nconst consequences = [\n  \"First violation: Warning and content removal\",\n  \"Second violation: Temporary account suspension (7-30 days)\",\n  \"Third violation: Permanent account termination\",\n  \"Severe violations: Immediate permanent ban and legal action if applicable\"\n];\n\nexport default function Guidelines() {\n  return (\n    <div className=\"container mx-auto p-6 max-w-4xl\">\n      <div className=\"mb-8\">\n        <div className=\"flex items-center gap-2 mb-4\">\n          <Shield className=\"h-8 w-8 text-primary\" />\n          <h1 className=\"text-3xl font-bold\">Community Guidelines</h1>\n        </div>\n        <p className=\"text-muted-foreground text-lg\">\n          Our community guidelines ensure a safe, respectful, and consensual environment for all users\n        </p>\n      </div>\n\n      <Card className=\"mb-6\">\n        <CardContent className=\"pt-6\">\n          <div className=\"bg-primary/10 border border-primary/20 rounded-lg p-4\">\n            <div className=\"flex items-start gap-3\">\n              <AlertTriangle className=\"h-5 w-5 text-primary mt-0.5 flex-shrink-0\" />\n              <div>\n                <div className=\"font-semibold mb-2\">Important Notice</div>\n                <p className=\"text-sm text-muted-foreground\">\n                  Violations of these guidelines may result in content removal, account suspension, or permanent termination. \n                  Severe violations may be reported to law enforcement.\n                </p>\n              </div>\n            </div>\n          </div>\n        </CardContent>\n      </Card>\n\n      <div className=\"space-y-6 mb-8\">\n        {guidelines.map((section) => {\n          const IconComponent = section.icon;\n          return (\n            <Card key={section.title} data-testid={`section-${section.title.toLowerCase().replace(/\\s+/g, '-')}`}>\n              <CardHeader>\n                <div className=\"flex items-center gap-2\">\n                  <IconComponent className=\"h-6 w-6 text-primary\" />\n                  <CardTitle>{section.title}</CardTitle>\n                </div>\n              </CardHeader>\n              <CardContent>\n                <ul className=\"space-y-3\">\n                  {section.rules.map((rule, index) => (\n                    <li key={index} className=\"flex items-start gap-3\">\n                      <CheckCircle className=\"h-5 w-5 text-primary mt-0.5 flex-shrink-0\" />\n                      <span>{rule}</span>\n                    </li>\n                  ))}\n                </ul>\n              </CardContent>\n            </Card>\n          );\n        })}\n      </div>\n\n      <Card>\n        <CardHeader>\n          <CardTitle>Enforcement and Consequences</CardTitle>\n        </CardHeader>\n        <CardContent>\n          <p className=\"text-muted-foreground mb-4\">\n            We take violations of our community guidelines seriously. Our enforcement policy follows a progressive approach:\n          </p>\n          <ul className=\"space-y-2\">\n            {consequences.map((consequence, index) => (\n              <li key={index} className=\"flex items-start gap-3\">\n                <AlertTriangle className=\"h-5 w-5 text-orange-500 mt-0.5 flex-shrink-0\" />\n                <span>{consequence}</span>\n              </li>\n            ))}\n          </ul>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","size_bytes":4740},"client/src/components/ui/scroll-area.tsx":{"content":"import * as React from \"react\"\nimport * as ScrollAreaPrimitive from \"@radix-ui/react-scroll-area\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ScrollArea = React.forwardRef<\n  React.ElementRef<typeof ScrollAreaPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ScrollAreaPrimitive.Root>\n>(({ className, children, ...props }, ref) => (\n  <ScrollAreaPrimitive.Root\n    ref={ref}\n    className={cn(\"relative overflow-hidden\", className)}\n    {...props}\n  >\n    <ScrollAreaPrimitive.Viewport className=\"h-full w-full rounded-[inherit]\">\n      {children}\n    </ScrollAreaPrimitive.Viewport>\n    <ScrollBar />\n    <ScrollAreaPrimitive.Corner />\n  </ScrollAreaPrimitive.Root>\n))\nScrollArea.displayName = ScrollAreaPrimitive.Root.displayName\n\nconst ScrollBar = React.forwardRef<\n  React.ElementRef<typeof ScrollAreaPrimitive.ScrollAreaScrollbar>,\n  React.ComponentPropsWithoutRef<typeof ScrollAreaPrimitive.ScrollAreaScrollbar>\n>(({ className, orientation = \"vertical\", ...props }, ref) => (\n  <ScrollAreaPrimitive.ScrollAreaScrollbar\n    ref={ref}\n    orientation={orientation}\n    className={cn(\n      \"flex touch-none select-none transition-colors\",\n      orientation === \"vertical\" &&\n        \"h-full w-2.5 border-l border-l-transparent p-[1px]\",\n      orientation === \"horizontal\" &&\n        \"h-2.5 flex-col border-t border-t-transparent p-[1px]\",\n      className\n    )}\n    {...props}\n  >\n    <ScrollAreaPrimitive.ScrollAreaThumb className=\"relative flex-1 rounded-full bg-border\" />\n  </ScrollAreaPrimitive.ScrollAreaScrollbar>\n))\nScrollBar.displayName = ScrollAreaPrimitive.ScrollAreaScrollbar.displayName\n\nexport { ScrollArea, ScrollBar }\n","size_bytes":1642},"client/src/components/ui/progress.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as ProgressPrimitive from \"@radix-ui/react-progress\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Progress = React.forwardRef<\n  React.ElementRef<typeof ProgressPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ProgressPrimitive.Root>\n>(({ className, value, ...props }, ref) => (\n  <ProgressPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative h-4 w-full overflow-hidden rounded-full bg-secondary\",\n      className\n    )}\n    {...props}\n  >\n    <ProgressPrimitive.Indicator\n      className=\"h-full w-full flex-1 bg-primary transition-all\"\n      style={{ transform: `translateX(-${100 - (value || 0)}%)` }}\n    />\n  </ProgressPrimitive.Root>\n))\nProgress.displayName = ProgressPrimitive.Root.displayName\n\nexport { Progress }\n","size_bytes":791},"server/blockchainService.ts":{"content":"import { db } from './db';\nimport { \n  nftCollections, \n  nfts, \n  nftOwnershipHistory, \n  nftRoyalties,\n  type InsertNftCollection,\n  type InsertNft,\n  type InsertNftOwnershipHistory,\n  type InsertNftRoyalty,\n  type NftCollection,\n  type Nft,\n} from \"@shared/schema\";\nimport { eq, and, desc, sql } from \"drizzle-orm\";\nimport { nanoid } from \"nanoid\";\n\nexport class BlockchainService {\n  async createCollection(creatorId: string, data: Omit<InsertNftCollection, 'creatorId'>): Promise<NftCollection> {\n    const [collection] = await db.insert(nftCollections).values({\n      ...data,\n      creatorId,\n    }).returning();\n    \n    return collection;\n  }\n\n  async getCollection(collectionId: string): Promise<NftCollection | undefined> {\n    const [collection] = await db\n      .select()\n      .from(nftCollections)\n      .where(eq(nftCollections.id, collectionId));\n    \n    return collection;\n  }\n\n  async getCreatorCollections(creatorId: string): Promise<NftCollection[]> {\n    return await db\n      .select()\n      .from(nftCollections)\n      .where(eq(nftCollections.creatorId, creatorId))\n      .orderBy(desc(nftCollections.createdAt));\n  }\n\n  async mintNFT(data: Omit<InsertNft, 'tokenId'>, blockchain?: string): Promise<Nft> {\n    const tokenId = `PF-${nanoid(16)}`;\n    \n    const collection = await this.getCollection(data.collectionId);\n    if (!collection) {\n      throw new Error('Collection not found');\n    }\n    \n    const effectiveBlockchain = blockchain || collection.blockchain || 'polygon';\n    \n    const [nft] = await db.insert(nfts).values({\n      ...data,\n      tokenId,\n    }).returning();\n\n    await db.insert(nftOwnershipHistory).values({\n      nftId: nft.id,\n      fromOwner: null,\n      toOwner: nft.currentOwner,\n      transactionType: 'mint',\n      price: nft.mintPrice,\n      transactionHash: nft.transactionHash,\n      blockchain: effectiveBlockchain,\n    });\n\n    await db\n      .update(nftCollections)\n      .set({ \n        totalSupply: sql`${nftCollections.totalSupply} + 1` \n      })\n      .where(eq(nftCollections.id, nft.collectionId));\n\n    return nft;\n  }\n\n  async getNFT(nftId: string): Promise<Nft | undefined> {\n    const [nft] = await db\n      .select()\n      .from(nfts)\n      .where(eq(nfts.id, nftId));\n    \n    return nft;\n  }\n\n  async getUserNFTs(userId: string): Promise<Nft[]> {\n    return await db\n      .select()\n      .from(nfts)\n      .where(eq(nfts.currentOwner, userId))\n      .orderBy(desc(nfts.mintedAt));\n  }\n\n  async getCollectionNFTs(collectionId: string): Promise<Nft[]> {\n    return await db\n      .select()\n      .from(nfts)\n      .where(eq(nfts.collectionId, collectionId))\n      .orderBy(desc(nfts.mintedAt));\n  }\n\n  async transferNFT(\n    nftId: string,\n    fromOwnerId: string,\n    toOwnerId: string,\n    transactionType: 'sale' | 'transfer' | 'gift',\n    price?: string,\n    transactionHash?: string,\n    blockchain?: string\n  ): Promise<void> {\n    const nft = await this.getNFT(nftId);\n    if (!nft) {\n      throw new Error('NFT not found');\n    }\n\n    if (nft.currentOwner !== fromOwnerId) {\n      throw new Error('Unauthorized: Not the current owner');\n    }\n\n    const collection = await this.getCollection(nft.collectionId);\n    const effectiveBlockchain = blockchain || collection?.blockchain || 'polygon';\n\n    await db\n      .update(nfts)\n      .set({ \n        currentOwner: toOwnerId,\n        lastSalePrice: price || nft.lastSalePrice,\n        isListed: false,\n        updatedAt: new Date(),\n      })\n      .where(eq(nfts.id, nftId));\n\n    const [ownershipRecord] = await db.insert(nftOwnershipHistory).values({\n      nftId,\n      fromOwner: fromOwnerId,\n      toOwner: toOwnerId,\n      transactionType,\n      price,\n      transactionHash,\n      blockchain: effectiveBlockchain,\n    }).returning();\n\n    if (transactionType === 'sale' && price) {\n      await this.processRoyalty(nft, ownershipRecord.id, price);\n      await this.updateMarketplaceStats(nft.collectionId, price);\n    }\n  }\n\n  async updateMarketplaceStats(collectionId: string, salePrice: string): Promise<void> {\n    const collectionNfts = await this.getCollectionNFTs(collectionId);\n    const listedNfts = collectionNfts.filter(n => n.isListed);\n    \n    const floorPrice = listedNfts.length > 0\n      ? Math.min(...listedNfts.map(n => parseFloat(n.listPrice || '0')).filter(p => p > 0))\n      : 0;\n\n    await db\n      .update(nftCollections)\n      .set({\n        floorPrice: floorPrice.toFixed(8),\n        totalVolume: sql`${nftCollections.totalVolume} + ${parseFloat(salePrice)}`,\n        updatedAt: new Date(),\n      })\n      .where(eq(nftCollections.id, collectionId));\n  }\n\n  async processRoyalty(nft: Nft, saleId: string, salePrice: string): Promise<void> {\n    const collection = await this.getCollection(nft.collectionId);\n    if (!collection) {\n      throw new Error('Collection not found');\n    }\n\n    const royaltyPercentage = parseFloat(collection.royaltyPercentage || '0');\n    if (royaltyPercentage === 0) {\n      return;\n    }\n\n    const salePriceNum = parseFloat(salePrice);\n    const royaltyAmount = (salePriceNum * royaltyPercentage / 100).toFixed(8);\n\n    await db.insert(nftRoyalties).values({\n      nftId: nft.id,\n      collectionId: nft.collectionId,\n      creatorId: collection.creatorId,\n      saleId,\n      salePrice,\n      royaltyAmount,\n      royaltyPercentage: collection.royaltyPercentage!,\n      status: 'pending',\n    });\n  }\n\n  async listNFT(nftId: string, ownerId: string, listPrice: string): Promise<void> {\n    const nft = await this.getNFT(nftId);\n    if (!nft) {\n      throw new Error('NFT not found');\n    }\n\n    if (nft.currentOwner !== ownerId) {\n      throw new Error('Unauthorized: Not the current owner');\n    }\n\n    await db\n      .update(nfts)\n      .set({ \n        isListed: true,\n        listPrice,\n        updatedAt: new Date(),\n      })\n      .where(eq(nfts.id, nftId));\n  }\n\n  async delistNFT(nftId: string, ownerId: string): Promise<void> {\n    const nft = await this.getNFT(nftId);\n    if (!nft) {\n      throw new Error('NFT not found');\n    }\n\n    if (nft.currentOwner !== ownerId) {\n      throw new Error('Unauthorized: Not the current owner');\n    }\n\n    await db\n      .update(nfts)\n      .set({ \n        isListed: false,\n        listPrice: null,\n        updatedAt: new Date(),\n      })\n      .where(eq(nfts.id, nftId));\n  }\n\n  async getMarketplaceListings(): Promise<Nft[]> {\n    return await db\n      .select()\n      .from(nfts)\n      .where(eq(nfts.isListed, true))\n      .orderBy(desc(nfts.mintedAt));\n  }\n\n  async getRoyaltiesForCreator(creatorId: string) {\n    return await db\n      .select()\n      .from(nftRoyalties)\n      .where(eq(nftRoyalties.creatorId, creatorId))\n      .orderBy(desc(nftRoyalties.createdAt));\n  }\n\n  async updateRoyaltyStatus(\n    royaltyId: string,\n    status: 'paid' | 'failed',\n    transactionHash?: string\n  ): Promise<void> {\n    await db\n      .update(nftRoyalties)\n      .set({ \n        status,\n        transactionHash,\n        paidAt: status === 'paid' ? new Date() : undefined,\n      })\n      .where(eq(nftRoyalties.id, royaltyId));\n  }\n\n  async getOwnershipHistory(nftId: string) {\n    return await db\n      .select()\n      .from(nftOwnershipHistory)\n      .where(eq(nftOwnershipHistory.nftId, nftId))\n      .orderBy(desc(nftOwnershipHistory.createdAt));\n  }\n\n  async generateMetadata(nft: Nft): Promise<object> {\n    return {\n      name: nft.name,\n      description: nft.description,\n      image: nft.tokenUri,\n      attributes: nft.metadata,\n      properties: {\n        tokenId: nft.tokenId,\n        rarity: nft.rarity,\n        mintedBy: nft.mintedBy,\n        mintedAt: nft.mintedAt,\n      },\n    };\n  }\n}\n\nexport const blockchainService = new BlockchainService();\n","size_bytes":7707},"client/src/pages/Compliance2257.tsx":{"content":"import { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Shield, FileCheck, AlertCircle } from \"lucide-react\";\n\nexport default function Compliance2257() {\n  return (\n    <div className=\"container mx-auto p-6 max-w-4xl\">\n      <div className=\"mb-8\">\n        <div className=\"flex items-center gap-2 mb-4\">\n          <Shield className=\"h-8 w-8 text-primary\" />\n          <h1 className=\"text-3xl font-bold\">18 U.S.C. 2257 Compliance</h1>\n        </div>\n        <p className=\"text-muted-foreground\">\n          Record-Keeping Requirements Compliance Statement\n        </p>\n      </div>\n\n      <Card className=\"mb-6\">\n        <CardContent className=\"pt-6\">\n          <div className=\"flex items-start gap-3\">\n            <FileCheck className=\"h-5 w-5 text-primary mt-0.5 flex-shrink-0\" />\n            <div>\n              <p className=\"text-muted-foreground mb-4\">\n                All models, actors, actresses and other persons that appear in any visual depiction of actual or \n                simulated sexually explicit conduct appearing or otherwise contained in this platform were over the \n                age of eighteen (18) years at the time of the creation of such depictions.\n              </p>\n              <p className=\"text-muted-foreground\">\n                All other visual depictions displayed on this platform are exempt from the provision of 18 U.S.C. \n                section 2257 and 28 C.F.R. 75 because said visual depictions do not consist of depictions of conduct \n                as specifically listed in 18 U.S.C section 2256 (2) (A) through (D), but are merely depictions of \n                non-sexually explicit nudity, or are depictions of simulated sexual conduct, or are otherwise exempt \n                because the visual depictions were created prior to July 3, 1995.\n              </p>\n            </div>\n          </div>\n        </CardContent>\n      </Card>\n\n      <div className=\"space-y-6\">\n        <Card data-testid=\"section-records\">\n          <CardHeader>\n            <CardTitle className=\"text-lg\">Custodian of Records</CardTitle>\n          </CardHeader>\n          <CardContent className=\"space-y-4\">\n            <p className=\"text-muted-foreground\">\n              With respect to all visual depictions displayed on this platform, whether of actual or simulated \n              sexually explicit conduct, depictions of non-sexually explicit nudity, or otherwise, the following is \n              the required information and statements prescribed by 18 U.S.C. section 2257 and 28 C.F.R. 75:\n            </p>\n            <div className=\"bg-muted p-4 rounded-lg\">\n              <div className=\"space-y-2\">\n                <p className=\"font-medium\">Custodian of Records Information:</p>\n                <p className=\"text-sm text-muted-foreground\">\n                  Available upon request to authorized government officials\n                </p>\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n\n        <Card data-testid=\"section-verification\">\n          <CardHeader>\n            <CardTitle className=\"text-lg\">Age Verification Process</CardTitle>\n          </CardHeader>\n          <CardContent className=\"space-y-4\">\n            <p className=\"text-muted-foreground\">\n              We maintain strict compliance with 18 U.S.C. 2257 Record-Keeping Requirements through:\n            </p>\n            <ul className=\"space-y-3\">\n              <li className=\"flex items-start gap-3\">\n                <Shield className=\"h-5 w-5 text-primary mt-0.5 flex-shrink-0\" />\n                <div>\n                  <div className=\"font-medium\">Mandatory Identity Verification</div>\n                  <div className=\"text-sm text-muted-foreground\">\n                    All content creators must verify their age through government-issued identification\n                  </div>\n                </div>\n              </li>\n              <li className=\"flex items-start gap-3\">\n                <Shield className=\"h-5 w-5 text-primary mt-0.5 flex-shrink-0\" />\n                <div>\n                  <div className=\"font-medium\">Secure Record Keeping</div>\n                  <div className=\"text-sm text-muted-foreground\">\n                    All required records are maintained securely and are available for inspection by authorized officials\n                  </div>\n                </div>\n              </li>\n              <li className=\"flex items-start gap-3\">\n                <Shield className=\"h-5 w-5 text-primary mt-0.5 flex-shrink-0\" />\n                <div>\n                  <div className=\"font-medium\">Co-Star Verification</div>\n                  <div className=\"text-sm text-muted-foreground\">\n                    All individuals appearing in content must be verified through our co-star verification system\n                  </div>\n                </div>\n              </li>\n            </ul>\n          </CardContent>\n        </Card>\n\n        <Card data-testid=\"section-statement\">\n          <CardHeader>\n            <CardTitle className=\"text-lg\">Compliance Statement</CardTitle>\n          </CardHeader>\n          <CardContent>\n            <p className=\"text-muted-foreground mb-4\">\n              The operators of this platform are committed to full compliance with all applicable federal regulations, \n              including 18 U.S.C. 2257 and 28 C.F.R. 75. We take our legal obligations seriously and maintain \n              comprehensive systems to ensure all content meets legal requirements.\n            </p>\n            <p className=\"text-muted-foreground\">\n              For producers/primary producers who upload content to this platform: You are responsible for maintaining \n              your own records as required by 18 U.S.C. 2257 and making them available to the platform's custodian \n              of records and authorized government officials upon request.\n            </p>\n          </CardContent>\n        </Card>\n\n        <Card data-testid=\"section-disclaimer\">\n          <CardHeader>\n            <CardTitle className=\"text-lg\">\n              <div className=\"flex items-center gap-2\">\n                <AlertCircle className=\"h-5 w-5 text-orange-500\" />\n                Important Legal Notice\n              </div>\n            </CardTitle>\n          </CardHeader>\n          <CardContent>\n            <p className=\"text-muted-foreground\">\n              This platform prohibits and does not tolerate any content involving minors. Any user found to be in \n              violation of this policy will be immediately reported to the National Center for Missing & Exploited \n              Children (NCMEC) and appropriate law enforcement agencies, and their account will be permanently \n              terminated. We actively cooperate with law enforcement in all investigations.\n            </p>\n          </CardContent>\n        </Card>\n      </div>\n    </div>\n  );\n}\n","size_bytes":6878},"server/communityModerationService.ts":{"content":"import { db } from \"./db\";\nimport { \n  safetyReports, communityVotes, moderatorStats,\n  type InsertSafetyReport, type InsertCommunityVote\n} from \"@shared/schema\";\nimport { eq, and, sql, desc } from \"drizzle-orm\";\n\n// Community Moderation Service for user reporting and peer review\nexport class CommunityModerationService {\n\n  // Create a safety report\n  async createSafetyReport(reportData: InsertSafetyReport) {\n    const [report] = await db.insert(safetyReports)\n      .values({\n        ...reportData,\n        status: 'pending',\n        createdAt: new Date(),\n      })\n      .returning();\n\n    return report;\n  }\n\n  // Submit a community vote on a report\n  async submitCommunityVote(voteData: InsertCommunityVote) {\n    // Get voter's current reputation\n    const voterReputation = await this.getVoterReputation(voteData.voterId);\n\n    // Check if user already voted on this report\n    const existingVote = await db.query.communityVotes.findFirst({\n      where: and(\n        eq(communityVotes.reportId, voteData.reportId),\n        eq(communityVotes.voterId, voteData.voterId)\n      ),\n    });\n\n    if (existingVote) {\n      // Update existing vote\n      const [updatedVote] = await db.update(communityVotes)\n        .set({\n          vote: voteData.vote,\n          reason: voteData.reason,\n          voterReputation,\n        })\n        .where(eq(communityVotes.id, existingVote.id))\n        .returning();\n\n      // Recalculate consensus after vote update\n      await this.updateReportBasedOnVotes(voteData.reportId);\n\n      return updatedVote;\n    }\n\n    // Create new vote\n    const [vote] = await db.insert(communityVotes)\n      .values({\n        ...voteData,\n        voterReputation,\n        createdAt: new Date(),\n      })\n      .returning();\n\n    // Update report status based on vote consensus\n    await this.updateReportBasedOnVotes(voteData.reportId);\n\n    return vote;\n  }\n\n  // Get voter's reputation score\n  async getVoterReputation(voterId: string): Promise<number> {\n    // Get historical voting accuracy\n    const votes = await db.query.communityVotes.findMany({\n      where: eq(communityVotes.voterId, voterId),\n    });\n\n    if (votes.length === 0) {\n      return 100; // Default reputation for new voters\n    }\n\n    // Calculate accuracy based on votes that matched final moderator decisions\n    let accurateVotes = 0;\n    let totalResolvedVotes = 0;\n\n    for (const vote of votes) {\n      // Get the associated report\n      const report = await db.query.safetyReports.findFirst({\n        where: eq(safetyReports.id, vote.reportId),\n      });\n\n      if (report && report.status === 'resolved') {\n        totalResolvedVotes++;\n        \n        // Vote was accurate if:\n        // - They voted 'valid' and report was resolved (not dismissed)\n        // - They voted 'invalid' and report was dismissed\n        const wasAccurate = \n          (vote.vote === 'valid' && report.resolution !== 'dismissed') ||\n          (vote.vote === 'invalid' && report.resolution === 'dismissed');\n        \n        if (wasAccurate) {\n          accurateVotes++;\n        }\n      }\n    }\n\n    if (totalResolvedVotes === 0) {\n      return 100; // No resolved votes yet, keep default\n    }\n\n    // Reputation = base 100 + (accuracy - 50%) * 200\n    // This gives: 0% accuracy = 0 rep, 50% = 100 rep, 100% = 200 rep\n    const accuracy = accurateVotes / totalResolvedVotes;\n    const reputation = Math.round(100 + (accuracy - 0.5) * 200);\n    \n    // Clamp between 0 and 200\n    return Math.max(0, Math.min(200, reputation));\n  }\n\n  // Update report status based on vote consensus\n  async updateReportBasedOnVotes(reportId: string) {\n    const votes = await db.query.communityVotes.findMany({\n      where: eq(communityVotes.reportId, reportId),\n    });\n\n    if (votes.length < 3) {\n      return; // Need at least 3 votes for consensus\n    }\n\n    // Calculate weighted vote scores (higher reputation = more weight)\n    let validScore = 0;\n    let invalidScore = 0;\n    let totalWeight = 0;\n\n    for (const vote of votes) {\n      const weight = vote.voterReputation || 100;\n      totalWeight += weight;\n\n      if (vote.vote === 'valid') {\n        validScore += weight;\n      } else if (vote.vote === 'invalid') {\n        invalidScore += weight;\n      }\n    }\n\n    // Calculate percentages\n    const validPercent = totalWeight > 0 ? (validScore / totalWeight) * 100 : 0;\n    const invalidPercent = totalWeight > 0 ? (invalidScore / totalWeight) * 100 : 0;\n\n    // Strong consensus threshold: 70%\n    if (validPercent >= 70) {\n      // Auto-escalate for moderator review (don't set resolution yet - that's for final decision)\n      await db.update(safetyReports)\n        .set({ \n          status: 'escalated',\n          severity: 'high', // Community agrees this is a valid concern\n        })\n        .where(eq(safetyReports.id, reportId));\n    } else if (invalidPercent >= 70) {\n      // Auto-dismiss with community consensus\n      await db.update(safetyReports)\n        .set({ \n          status: 'dismissed',\n          resolution: 'Community consensus: invalid report (70%+ invalid votes)',\n        })\n        .where(eq(safetyReports.id, reportId));\n    }\n  }\n\n  // Get voting statistics for a report\n  async getReportVotingStats(reportId: string) {\n    const votes = await db.query.communityVotes.findMany({\n      where: eq(communityVotes.reportId, reportId),\n    });\n\n    const stats = {\n      totalVotes: votes.length,\n      validVotes: 0,\n      invalidVotes: 0,\n      unsureVotes: 0,\n      avgVoterReputation: 0,\n      weightedValidPercent: 0,\n      weightedInvalidPercent: 0,\n    };\n\n    let totalReputation = 0;\n    let validWeight = 0;\n    let invalidWeight = 0;\n    let totalWeight = 0;\n\n    for (const vote of votes) {\n      const weight = vote.voterReputation || 100;\n      totalReputation += weight;\n      totalWeight += weight;\n\n      if (vote.vote === 'valid') {\n        stats.validVotes++;\n        validWeight += weight;\n      } else if (vote.vote === 'invalid') {\n        stats.invalidVotes++;\n        invalidWeight += weight;\n      } else {\n        stats.unsureVotes++;\n      }\n    }\n\n    stats.avgVoterReputation = votes.length > 0 ? Math.round(totalReputation / votes.length) : 0;\n    stats.weightedValidPercent = totalWeight > 0 ? Math.round((validWeight / totalWeight) * 100) : 0;\n    stats.weightedInvalidPercent = totalWeight > 0 ? Math.round((invalidWeight / totalWeight) * 100) : 0;\n\n    return stats;\n  }\n\n  // Get pending/escalated reports for community review (with vote stats)\n  async getPendingReportsForReview(limit: number = 20) {\n    // Include both 'pending' (new reports) and 'escalated' (auto-escalated by community)\n    const reports = await db.query.safetyReports.findMany({\n      where: sql`${safetyReports.status} IN ('pending', 'escalated')`,\n      orderBy: [desc(safetyReports.createdAt)],\n      limit,\n      with: {\n        reporter: {\n          columns: { id: true, username: true },\n        },\n        reportedUser: {\n          columns: { id: true, username: true },\n        },\n        reportedContent: {\n          columns: { id: true, title: true, mimeType: true },\n        },\n      },\n    });\n\n    // Add voting stats to each report\n    const reportsWithStats = await Promise.all(\n      reports.map(async (report) => {\n        const votingStats = await this.getReportVotingStats(report.id);\n        return {\n          ...report,\n          votingStats,\n        };\n      })\n    );\n\n    return reportsWithStats;\n  }\n\n  // Get reports by user (for checking if someone has been reported)\n  async getReportsByUser(userId: string, status?: string) {\n    const conditions = [eq(safetyReports.userId, userId)];\n    \n    if (status) {\n      conditions.push(eq(safetyReports.status, status as any));\n    }\n\n    const reports = await db.query.safetyReports.findMany({\n      where: and(...conditions),\n      orderBy: [desc(safetyReports.createdAt)],\n      with: {\n        reporter: {\n          columns: { id: true, username: true },\n        },\n      },\n    });\n\n    return reports;\n  }\n\n  // Get reports submitted by user\n  async getReportsSubmittedBy(userId: string, limit: number = 50) {\n    const reports = await db.query.safetyReports.findMany({\n      where: eq(safetyReports.reporterId, userId),\n      orderBy: [desc(safetyReports.createdAt)],\n      limit,\n      with: {\n        reportedUser: {\n          columns: { id: true, username: true },\n        },\n        reportedContent: {\n          columns: { id: true, title: true },\n        },\n      },\n    });\n\n    return reports;\n  }\n\n  // Get user's voting history\n  async getUserVotingHistory(userId: string, limit: number = 50) {\n    const votes = await db.query.communityVotes.findMany({\n      where: eq(communityVotes.voterId, userId),\n      orderBy: [desc(communityVotes.createdAt)],\n      limit,\n      with: {\n        report: {\n          with: {\n            reportedUser: {\n              columns: { id: true, username: true },\n            },\n            reportedContent: {\n              columns: { id: true, title: true },\n            },\n          },\n        },\n      },\n    });\n\n    return votes;\n  }\n\n  // Moderator: Review and resolve a report\n  async resolveReport(\n    reportId: string, \n    moderatorId: string, \n    resolution: string,\n    action: 'resolved' | 'dismissed' | 'escalated'\n  ) {\n    const [report] = await db.update(safetyReports)\n      .set({\n        status: action,\n        resolution,\n        reviewedBy: moderatorId,\n        reviewedAt: new Date(),\n      })\n      .where(eq(safetyReports.id, reportId))\n      .returning();\n\n    // Update moderator stats\n    await this.updateModeratorStats(moderatorId);\n\n    return report;\n  }\n\n  // Update moderator statistics\n  async updateModeratorStats(moderatorId: string) {\n    // Get all reviews by this moderator\n    const reviews = await db.query.safetyReports.findMany({\n      where: and(\n        eq(safetyReports.reviewedBy, moderatorId),\n      ),\n    });\n\n    const totalReviews = reviews.length;\n\n    // Upsert moderator stats\n    await db.insert(moderatorStats)\n      .values({\n        userId: moderatorId,\n        totalReviews,\n        lastActiveAt: new Date(),\n      })\n      .onConflictDoUpdate({\n        target: moderatorStats.userId,\n        set: {\n          totalReviews,\n          lastActiveAt: new Date(),\n        },\n      });\n  }\n\n  // Get moderator leaderboard\n  async getModeratorLeaderboard(limit: number = 10) {\n    const leaderboard = await db.query.moderatorStats.findMany({\n      orderBy: [desc(moderatorStats.totalReviews)],\n      limit,\n      with: {\n        user: {\n          columns: { id: true, username: true, displayName: true },\n        },\n      },\n    });\n\n    return leaderboard;\n  }\n}\n\n// Export singleton instance\nexport const communityModerationService = new CommunityModerationService();\n","size_bytes":10769},"client/src/pages/Live.tsx":{"content":"import { useState } from \"react\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { \n  Video, \n  Users, \n  Radio,\n  Calendar,\n  Bell,\n  Play,\n  Clock\n} from \"lucide-react\";\n\nconst liveStreams = [\n  {\n    id: \"1\",\n    creator: \"AlphaWolf\",\n    title: \"Q&A Session - Ask Me Anything!\",\n    viewers: 234,\n    isLive: true,\n    thumbnail: \"https://images.unsplash.com/photo-1516321318423-f06f85e504b3?w=400&h=225&fit=crop\",\n    category: \"Interactive\"\n  },\n  {\n    id: \"2\",\n    creator: \"MoonlightPup\",\n    title: \"Behind the Scenes Studio Tour\",\n    viewers: 156,\n    isLive: true,\n    thumbnail: \"https://images.unsplash.com/photo-1598488035139-bdbb2231ce04?w=400&h=225&fit=crop\",\n    category: \"Exclusive\"\n  }\n];\n\nconst upcomingStreams = [\n  {\n    id: \"3\",\n    creator: \"StarlightCreator\",\n    title: \"Special Performance Night\",\n    scheduledFor: \"Today at 8:00 PM\",\n    subscribers: 892,\n    category: \"Performance\"\n  },\n  {\n    id: \"4\",\n    creator: \"WildHeart\",\n    title: \"Exclusive Pack Member Stream\",\n    scheduledFor: \"Tomorrow at 7:00 PM\",\n    subscribers: 445,\n    category: \"VIP\"\n  }\n];\n\nexport default function Live() {\n  const [notificationsEnabled, setNotificationsEnabled] = useState(false);\n\n  return (\n    <div className=\"container mx-auto p-6 max-w-6xl\">\n      <div className=\"mb-8\">\n        <div className=\"flex items-center justify-between mb-4\">\n          <div className=\"flex items-center gap-2\">\n            <Video className=\"h-8 w-8 text-primary\" />\n            <h1 className=\"text-3xl font-bold\">Live Streams</h1>\n          </div>\n          <Button\n            variant={notificationsEnabled ? \"default\" : \"outline\"}\n            onClick={() => setNotificationsEnabled(!notificationsEnabled)}\n            data-testid=\"button-notifications\"\n          >\n            <Bell className=\"h-4 w-4 mr-2\" />\n            {notificationsEnabled ? \"Notifications On\" : \"Enable Notifications\"}\n          </Button>\n        </div>\n        <p className=\"text-muted-foreground text-lg\">\n          Watch your favorite creators live and interact in real-time\n        </p>\n      </div>\n\n      {liveStreams.length > 0 && (\n        <div className=\"mb-12\">\n          <div className=\"flex items-center gap-2 mb-4\">\n            <Radio className=\"h-5 w-5 text-primary animate-pulse\" />\n            <h2 className=\"text-2xl font-bold\">Live Now</h2>\n          </div>\n          <div className=\"grid gap-6 md:grid-cols-2\">\n            {liveStreams.map((stream) => (\n              <Card key={stream.id} className=\"overflow-hidden hover:shadow-lg transition-shadow\" data-testid={`card-live-${stream.id}`}>\n                <div className=\"relative\">\n                  <img \n                    src={stream.thumbnail} \n                    alt={stream.title}\n                    className=\"w-full h-48 object-cover\"\n                  />\n                  <Badge className=\"absolute top-3 left-3 bg-red-500\">\n                    <Radio className=\"h-3 w-3 mr-1\" />\n                    LIVE\n                  </Badge>\n                  <div className=\"absolute bottom-3 left-3\">\n                    <div className=\"flex items-center gap-1 bg-black/70 px-2 py-1 rounded text-white text-sm\">\n                      <Users className=\"h-3 w-3\" />\n                      {stream.viewers}\n                    </div>\n                  </div>\n                </div>\n                <CardHeader>\n                  <div className=\"flex items-start justify-between gap-2\">\n                    <div className=\"flex-1\">\n                      <CardTitle className=\"text-lg\">{stream.title}</CardTitle>\n                      <CardDescription className=\"mt-1\">by {stream.creator}</CardDescription>\n                    </div>\n                    <Badge variant=\"outline\">{stream.category}</Badge>\n                  </div>\n                </CardHeader>\n                <CardContent>\n                  <Button className=\"w-full\" data-testid={`button-watch-${stream.id}`}>\n                    <Play className=\"h-4 w-4 mr-2\" />\n                    Watch Now\n                  </Button>\n                </CardContent>\n              </Card>\n            ))}\n          </div>\n        </div>\n      )}\n\n      <div>\n        <div className=\"flex items-center gap-2 mb-4\">\n          <Calendar className=\"h-5 w-5 text-primary\" />\n          <h2 className=\"text-2xl font-bold\">Upcoming Streams</h2>\n        </div>\n        <div className=\"grid gap-4\">\n          {upcomingStreams.map((stream) => (\n            <Card key={stream.id} data-testid={`card-upcoming-${stream.id}`}>\n              <CardContent className=\"p-6\">\n                <div className=\"flex items-center justify-between\">\n                  <div className=\"flex-1\">\n                    <h3 className=\"font-semibold text-lg mb-1\">{stream.title}</h3>\n                    <p className=\"text-muted-foreground mb-2\">by {stream.creator}</p>\n                    <div className=\"flex items-center gap-4 text-sm\">\n                      <div className=\"flex items-center gap-1 text-muted-foreground\">\n                        <Clock className=\"h-4 w-4\" />\n                        {stream.scheduledFor}\n                      </div>\n                      <div className=\"flex items-center gap-1 text-muted-foreground\">\n                        <Users className=\"h-4 w-4\" />\n                        {stream.subscribers} interested\n                      </div>\n                      <Badge variant=\"outline\">{stream.category}</Badge>\n                    </div>\n                  </div>\n                  <Button variant=\"outline\" data-testid={`button-remind-${stream.id}`}>\n                    <Bell className=\"h-4 w-4 mr-2\" />\n                    Remind Me\n                  </Button>\n                </div>\n              </CardContent>\n            </Card>\n          ))}\n        </div>\n      </div>\n\n      <Card className=\"mt-12\">\n        <CardHeader>\n          <CardTitle>About Live Streaming</CardTitle>\n        </CardHeader>\n        <CardContent className=\"space-y-4\">\n          <div className=\"flex items-start gap-3\">\n            <Video className=\"h-5 w-5 text-primary mt-0.5\" />\n            <div>\n              <div className=\"font-medium\">Real-Time Interaction</div>\n              <div className=\"text-sm text-muted-foreground\">\n                Chat with creators and other fans during live streams\n              </div>\n            </div>\n          </div>\n          <div className=\"flex items-start gap-3\">\n            <Users className=\"h-5 w-5 text-primary mt-0.5\" />\n            <div>\n              <div className=\"font-medium\">Exclusive Content</div>\n              <div className=\"text-sm text-muted-foreground\">\n                Access subscriber-only streams and special events\n              </div>\n            </div>\n          </div>\n          <div className=\"flex items-start gap-3\">\n            <Bell className=\"h-5 w-5 text-primary mt-0.5\" />\n            <div>\n              <div className=\"font-medium\">Never Miss a Stream</div>\n              <div className=\"text-sm text-muted-foreground\">\n                Get notified when your favorite creators go live\n              </div>\n            </div>\n          </div>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","size_bytes":7331},"client/src/components/creator/ContentUpload.tsx":{"content":"import { useState } from \"react\";\nimport { useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { isUnauthorizedError } from \"@/lib/authUtils\";\nimport { ObjectUploader } from \"@/components/ObjectUploader\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Checkbox } from \"@/components/ui/checkbox\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { \n  Upload, \n  Shield, \n  DollarSign, \n  Users, \n  Eye,\n  Save,\n  Loader2\n} from \"lucide-react\";\n\nexport default function ContentUpload() {\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n  const [isExpanded, setIsExpanded] = useState(false);\n  const [uploadedFileUrl, setUploadedFileUrl] = useState<string | null>(null);\n  const [uploadedFileInfo, setUploadedFileInfo] = useState<{\n    name: string;\n    size: number;\n    type: string;\n  } | null>(null);\n  \n  const [contentForm, setContentForm] = useState({\n    title: \"\",\n    description: \"\",\n    tags: \"\",\n    accessLevel: \"pack\",\n    price: \"\",\n    ageVerified: false,\n    consentDocumented: false,\n    guidelinesCompliant: false,\n  });\n\n  // File type validation and size limits\n  const getFileConfig = (fileType: string) => {\n    if (fileType.startsWith('video/')) {\n      return {\n        maxSize: 524288000, // 500MB for videos\n        allowedTypes: ['video/mp4', 'video/mov', 'video/avi', 'video/webm', 'video/quicktime'],\n        label: 'Video'\n      };\n    } else if (fileType.startsWith('image/')) {\n      return {\n        maxSize: 52428800, // 50MB for images  \n        allowedTypes: ['image/jpeg', 'image/jpg', 'image/png', 'image/gif', 'image/webp'],\n        label: 'Image'\n      };\n    }\n    return {\n      maxSize: 10485760, // 10MB default\n      allowedTypes: [],\n      label: 'File'\n    };\n  };\n\n  const uploadMutation = useMutation({\n    mutationFn: async () => {\n      const response = await apiRequest('POST', '/api/objects/upload');\n      const data = await response.json();\n      return data as { uploadURL: string };\n    },\n    onError: (error) => {\n      if (isUnauthorizedError(error as Error)) {\n        toast({\n          title: \"Unauthorized\",\n          description: \"You are logged out. Logging in again...\",\n          variant: \"destructive\",\n        });\n        setTimeout(() => {\n          window.location.href = \"/api/login\";\n        }, 500);\n        return;\n      }\n      toast({\n        title: \"Upload Error\",\n        description: \"Failed to get upload URL. Please try again.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const createContentMutation = useMutation({\n    mutationFn: async (data: any) => {\n      await apiRequest('POST', '/api/content', data);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['/api/content'] });\n      toast({\n        title: \"Content Uploaded!\",\n        description: \"Your content has been uploaded and is pending review.\",\n      });\n      // Reset form\n      setContentForm({\n        title: \"\",\n        description: \"\",\n        tags: \"\",\n        accessLevel: \"pack\",\n        price: \"\",\n        ageVerified: false,\n        consentDocumented: false,\n        guidelinesCompliant: false,\n      });\n      setUploadedFileUrl(null);\n      setIsExpanded(false);\n    },\n    onError: (error) => {\n      if (isUnauthorizedError(error as Error)) {\n        toast({\n          title: \"Unauthorized\",\n          description: \"You are logged out. Logging in again...\",\n          variant: \"destructive\",\n        });\n        setTimeout(() => {\n          window.location.href = \"/api/login\";\n        }, 500);\n        return;\n      }\n      toast({\n        title: \"Upload Failed\",\n        description: \"Failed to create content. Please try again.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const handleGetUploadParameters = async () => {\n    const result = await uploadMutation.mutateAsync();\n    return {\n      method: 'PUT' as const,\n      url: result.uploadURL,\n    };\n  };\n\n  const handleUploadComplete = async (result: any) => {\n    if (result.successful?.length > 0) {\n      const uploadedFile = result.successful[0];\n      const uploadUrl = uploadedFile.uploadURL;\n      \n      // Extract file info\n      const fileInfo = {\n        name: uploadedFile.name || 'Uploaded file',\n        size: uploadedFile.size || 0,\n        type: uploadedFile.type || 'application/octet-stream'\n      };\n      \n      setUploadedFileUrl(uploadUrl);\n      setUploadedFileInfo(fileInfo);\n      \n      // Set ACL policy for the uploaded file\n      try {\n        await apiRequest('PUT', '/api/media-upload', {\n          mediaUrl: uploadUrl,\n          fileInfo: fileInfo\n        });\n        \n        toast({\n          title: `${getFileConfig(fileInfo.type).label} Uploaded!`,\n          description: `${fileInfo.name} uploaded successfully. Now add content details.`,\n        });\n        setIsExpanded(true);\n      } catch (error) {\n        toast({\n          title: \"Error\",\n          description: \"File uploaded but failed to set permissions.\",\n          variant: \"destructive\",\n        });\n      }\n    }\n  };\n\n  const handleInputChange = (field: string, value: any) => {\n    setContentForm(prev => ({ ...prev, [field]: value }));\n  };\n\n  const handleSubmit = (e: React.FormEvent) => {\n    e.preventDefault();\n    \n    if (!uploadedFileUrl) {\n      toast({\n        title: \"No File\",\n        description: \"Please upload a file first.\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    if (!contentForm.title.trim()) {\n      toast({\n        title: \"Missing Title\",\n        description: \"Please provide a title for your content.\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    if (!contentForm.ageVerified || !contentForm.consentDocumented || !contentForm.guidelinesCompliant) {\n      toast({\n        title: \"Safety Requirements\",\n        description: \"Please complete all safety verification checkboxes.\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    createContentMutation.mutate({\n      title: contentForm.title,\n      description: contentForm.description,\n      objectPath: uploadedFileUrl,\n      mimeType: uploadedFileInfo?.type || \"application/octet-stream\",\n      fileSize: uploadedFileInfo?.size || 0,\n      accessLevel: contentForm.accessLevel,\n      price: contentForm.accessLevel === 'ppv' ? parseFloat(contentForm.price) || 0 : null,\n      tags: contentForm.tags.split(',').map(tag => tag.trim()).filter(Boolean),\n    });\n  };\n\n  if (!isExpanded) {\n    return (\n      <Card className=\"pack-card\">\n        <CardHeader>\n          <CardTitle className=\"flex items-center\">\n            <Upload className=\"mr-2 h-5 w-5\" />\n            Quick Upload\n          </CardTitle>\n        </CardHeader>\n        <CardContent>\n          <div className=\"text-center\">\n            <ObjectUploader\n              maxNumberOfFiles={1}\n              maxFileSize={524288000} // 500MB to support video uploads\n              onGetUploadParameters={handleGetUploadParameters}\n              onComplete={handleUploadComplete}\n              buttonClassName=\"w-full h-20 border-2 border-dashed border-border hover:border-primary/50 bg-background hover:bg-primary/5 transition-colors\"\n            >\n              <div className=\"flex flex-col items-center space-y-2\">\n                <Upload className=\"h-8 w-8 text-primary\" />\n                <span className=\"font-medium\">Upload Content</span>\n                <span className=\"text-xs text-muted\">Click to select files</span>\n              </div>\n            </ObjectUploader>\n            <p className=\"text-xs text-muted mt-2\">\n              <span className=\"font-medium\">Images:</span> JPG, PNG, GIF, WebP (Max 50MB)<br/>\n              <span className=\"font-medium\">Videos:</span> MP4, MOV, AVI, WebM (Max 500MB)\n            </p>\n          </div>\n        </CardContent>\n      </Card>\n    );\n  }\n\n  return (\n    <Card className=\"pack-card\">\n      <CardHeader>\n        <CardTitle className=\"flex items-center\">\n          <Upload className=\"mr-2 h-5 w-5\" />\n          Content Details\n        </CardTitle>\n      </CardHeader>\n      <CardContent>\n        <form onSubmit={handleSubmit} className=\"space-y-6\">\n          {/* File Status */}\n          {uploadedFileUrl && (\n            <div className=\"flex items-center space-x-3 p-3 bg-success/10 border border-success/20 rounded-lg\">\n              <div className=\"w-8 h-8 bg-success/20 rounded-lg flex items-center justify-center\">\n                <Eye className=\"h-4 w-4 text-success\" />\n              </div>\n              <div className=\"flex-1\">\n                <p className=\"text-sm font-medium text-success\">File uploaded successfully</p>\n                <p className=\"text-xs text-muted\">Ready to add content details</p>\n              </div>\n            </div>\n          )}\n\n          {/* Basic Info */}\n          <div className=\"space-y-4\">\n            <div>\n              <Label htmlFor=\"title\">Content Title</Label>\n              <Input\n                id=\"title\"\n                value={contentForm.title}\n                onChange={(e) => handleInputChange('title', e.target.value)}\n                placeholder=\"Give your content a catchy title...\"\n                className=\"form-input\"\n                data-testid=\"input-content-title\"\n              />\n            </div>\n\n            <div>\n              <Label htmlFor=\"description\">Description</Label>\n              <Textarea\n                id=\"description\"\n                value={contentForm.description}\n                onChange={(e) => handleInputChange('description', e.target.value)}\n                placeholder=\"Describe your content...\"\n                rows={3}\n                className=\"form-textarea\"\n                data-testid=\"textarea-content-description\"\n              />\n            </div>\n\n            <div>\n              <Label htmlFor=\"tags\">Tags</Label>\n              <Input\n                id=\"tags\"\n                value={contentForm.tags}\n                onChange={(e) => handleInputChange('tags', e.target.value)}\n                placeholder=\"fitness, alpha, training...\"\n                className=\"form-input\"\n                data-testid=\"input-content-tags\"\n              />\n              <p className=\"text-xs text-muted mt-1\">Separate tags with commas</p>\n            </div>\n          </div>\n\n          {/* Access & Pricing */}\n          <div className=\"space-y-4\">\n            <div>\n              <Label htmlFor=\"accessLevel\">Access Level</Label>\n              <Select \n                value={contentForm.accessLevel} \n                onValueChange={(value) => handleInputChange('accessLevel', value)}\n              >\n                <SelectTrigger className=\"form-select\" data-testid=\"select-access-level\">\n                  <SelectValue />\n                </SelectTrigger>\n                <SelectContent>\n                  <SelectItem value=\"pack\">Pack Members Only</SelectItem>\n                  <SelectItem value=\"premium\">Premium Pack ($5.99)</SelectItem>\n                  <SelectItem value=\"ppv\">Pay-Per-View</SelectItem>\n                </SelectContent>\n              </Select>\n            </div>\n\n            {contentForm.accessLevel === 'ppv' && (\n              <div>\n                <Label htmlFor=\"price\">PPV Price</Label>\n                <div className=\"relative\">\n                  <DollarSign className=\"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted\" />\n                  <Input\n                    id=\"price\"\n                    type=\"number\"\n                    step=\"0.01\"\n                    min=\"0\"\n                    value={contentForm.price}\n                    onChange={(e) => handleInputChange('price', e.target.value)}\n                    placeholder=\"9.99\"\n                    className=\"form-input pl-10\"\n                    data-testid=\"input-content-price\"\n                  />\n                </div>\n              </div>\n            )}\n          </div>\n\n          {/* Safety Verification */}\n          <div className=\"p-4 bg-warning/10 border border-warning/20 rounded-lg\">\n            <h4 className=\"font-medium text-warning mb-3 flex items-center\">\n              <Shield className=\"mr-2 h-4 w-4\" />\n              Safety Verification\n            </h4>\n            <div className=\"space-y-3\">\n              <div className=\"flex items-start space-x-3\">\n                <Checkbox\n                  id=\"age-verified\"\n                  checked={contentForm.ageVerified}\n                  onCheckedChange={(checked) => handleInputChange('ageVerified', checked)}\n                  data-testid=\"checkbox-age-verified\"\n                />\n                <Label htmlFor=\"age-verified\" className=\"text-sm\">\n                  All participants are 18+ verified\n                </Label>\n              </div>\n              \n              <div className=\"flex items-start space-x-3\">\n                <Checkbox\n                  id=\"consent-documented\"\n                  checked={contentForm.consentDocumented}\n                  onCheckedChange={(checked) => handleInputChange('consentDocumented', checked)}\n                  data-testid=\"checkbox-consent-documented\"\n                />\n                <Label htmlFor=\"consent-documented\" className=\"text-sm\">\n                  Consent documented and stored\n                </Label>\n              </div>\n              \n              <div className=\"flex items-start space-x-3\">\n                <Checkbox\n                  id=\"guidelines-compliant\"\n                  checked={contentForm.guidelinesCompliant}\n                  onCheckedChange={(checked) => handleInputChange('guidelinesCompliant', checked)}\n                  data-testid=\"checkbox-guidelines-compliant\"\n                />\n                <Label htmlFor=\"guidelines-compliant\" className=\"text-sm\">\n                  Content complies with platform guidelines\n                </Label>\n              </div>\n            </div>\n          </div>\n\n          {/* Action Buttons */}\n          <div className=\"flex flex-col sm:flex-row gap-3\">\n            <Button \n              type=\"button\"\n              variant=\"outline\" \n              className=\"flex-1\"\n              onClick={() => setIsExpanded(false)}\n              data-testid=\"button-save-draft\"\n            >\n              <Save className=\"mr-2 h-4 w-4\" />\n              Save as Draft\n            </Button>\n            <Button \n              type=\"submit\" \n              className=\"flex-1 btn-primary\"\n              disabled={createContentMutation.isPending}\n              data-testid=\"button-upload-now\"\n            >\n              {createContentMutation.isPending ? (\n                <>\n                  <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />\n                  Uploading...\n                </>\n              ) : (\n                <>\n                  <Upload className=\"mr-2 h-4 w-4\" />\n                  Upload Now\n                </>\n              )}\n            </Button>\n          </div>\n        </form>\n      </CardContent>\n    </Card>\n  );\n}\n","size_bytes":15361},"client/src/components/ui/context-menu.tsx":{"content":"import * as React from \"react\"\nimport * as ContextMenuPrimitive from \"@radix-ui/react-context-menu\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ContextMenu = ContextMenuPrimitive.Root\n\nconst ContextMenuTrigger = ContextMenuPrimitive.Trigger\n\nconst ContextMenuGroup = ContextMenuPrimitive.Group\n\nconst ContextMenuPortal = ContextMenuPrimitive.Portal\n\nconst ContextMenuSub = ContextMenuPrimitive.Sub\n\nconst ContextMenuRadioGroup = ContextMenuPrimitive.RadioGroup\n\nconst ContextMenuSubTrigger = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <ContextMenuPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto h-4 w-4\" />\n  </ContextMenuPrimitive.SubTrigger>\n))\nContextMenuSubTrigger.displayName = ContextMenuPrimitive.SubTrigger.displayName\n\nconst ContextMenuSubContent = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-context-menu-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuSubContent.displayName = ContextMenuPrimitive.SubContent.displayName\n\nconst ContextMenuContent = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.Portal>\n    <ContextMenuPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"z-50 max-h-[--radix-context-menu-content-available-height] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md animate-in fade-in-80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-context-menu-content-transform-origin]\",\n        className\n      )}\n      {...props}\n    />\n  </ContextMenuPrimitive.Portal>\n))\nContextMenuContent.displayName = ContextMenuPrimitive.Content.displayName\n\nconst ContextMenuItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <ContextMenuPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuItem.displayName = ContextMenuPrimitive.Item.displayName\n\nconst ContextMenuCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <ContextMenuPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <ContextMenuPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </ContextMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </ContextMenuPrimitive.CheckboxItem>\n))\nContextMenuCheckboxItem.displayName =\n  ContextMenuPrimitive.CheckboxItem.displayName\n\nconst ContextMenuRadioItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <ContextMenuPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <ContextMenuPrimitive.ItemIndicator>\n        <Circle className=\"h-2 w-2 fill-current\" />\n      </ContextMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </ContextMenuPrimitive.RadioItem>\n))\nContextMenuRadioItem.displayName = ContextMenuPrimitive.RadioItem.displayName\n\nconst ContextMenuLabel = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <ContextMenuPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold text-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuLabel.displayName = ContextMenuPrimitive.Label.displayName\n\nconst ContextMenuSeparator = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-border\", className)}\n    {...props}\n  />\n))\nContextMenuSeparator.displayName = ContextMenuPrimitive.Separator.displayName\n\nconst ContextMenuShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nContextMenuShortcut.displayName = \"ContextMenuShortcut\"\n\nexport {\n  ContextMenu,\n  ContextMenuTrigger,\n  ContextMenuContent,\n  ContextMenuItem,\n  ContextMenuCheckboxItem,\n  ContextMenuRadioItem,\n  ContextMenuLabel,\n  ContextMenuSeparator,\n  ContextMenuShortcut,\n  ContextMenuGroup,\n  ContextMenuPortal,\n  ContextMenuSub,\n  ContextMenuSubContent,\n  ContextMenuSubTrigger,\n  ContextMenuRadioGroup,\n}\n","size_bytes":7428},"client/src/components/ui/separator.tsx":{"content":"import * as React from \"react\"\nimport * as SeparatorPrimitive from \"@radix-ui/react-separator\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Separator = React.forwardRef<\n  React.ElementRef<typeof SeparatorPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof SeparatorPrimitive.Root>\n>(\n  (\n    { className, orientation = \"horizontal\", decorative = true, ...props },\n    ref\n  ) => (\n    <SeparatorPrimitive.Root\n      ref={ref}\n      decorative={decorative}\n      orientation={orientation}\n      className={cn(\n        \"shrink-0 bg-border\",\n        orientation === \"horizontal\" ? \"h-[1px] w-full\" : \"h-full w-[1px]\",\n        className\n      )}\n      {...props}\n    />\n  )\n)\nSeparator.displayName = SeparatorPrimitive.Root.displayName\n\nexport { Separator }\n","size_bytes":756},"client/src/components/ui/tabs.tsx":{"content":"import * as React from \"react\"\nimport * as TabsPrimitive from \"@radix-ui/react-tabs\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Tabs = TabsPrimitive.Root\n\nconst TabsList = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.List\n    ref={ref}\n    className={cn(\n      \"inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsList.displayName = TabsPrimitive.List.displayName\n\nconst TabsTrigger = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.Trigger>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsTrigger.displayName = TabsPrimitive.Trigger.displayName\n\nconst TabsContent = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.Content\n    ref={ref}\n    className={cn(\n      \"mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsContent.displayName = TabsPrimitive.Content.displayName\n\nexport { Tabs, TabsList, TabsTrigger, TabsContent }\n","size_bytes":1883},"SECURITY.md":{"content":"# Security Policy\n\n## Supported Versions\n\nUse this section to tell people about which versions of your project are\ncurrently being supported with security updates.\n\n| Version | Supported          |\n| ------- | ------------------ |\n| 5.1.x   | :white_check_mark: |\n| 5.0.x   | :x:                |\n| 4.0.x   | :white_check_mark: |\n| < 4.0   | :x:                |\n\n## Reporting a Vulnerability\n\nUse this section to tell people how to report a vulnerability.\n\nTell them where to go, how often they can expect to get an update on a\nreported vulnerability, what to expect if the vulnerability is accepted or\ndeclined, etc.\n","size_bytes":619},"client/src/pages/Discovery.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport Header from \"@/components/layout/Header\";\nimport Footer from \"@/components/layout/Footer\";\nimport CreatorCard from \"@/components/discovery/CreatorCard\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Input } from \"@/components/ui/input\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport { Search, Filter, Users, Star, Heart, Gamepad2, Dumbbell, Sparkles } from \"lucide-react\";\n\nexport default function Discovery() {\n  const [searchQuery, setSearchQuery] = useState(\"\");\n  const [packType, setPackType] = useState(\"all\");\n  const [safetyFilter, setSafetyFilter] = useState(\"all\");\n  const [sortBy, setSortBy] = useState(\"newest\");\n\n  const { data: creators, isLoading } = useQuery({\n    queryKey: ['/api/discover/creators', { q: searchQuery, packType, safetyFilter, sortBy }],\n    queryFn: async () => {\n      const params = new URLSearchParams();\n      if (searchQuery) params.append('q', searchQuery);\n      if (packType !== 'all') params.append('packType', packType);\n      if (safetyFilter === 'aftercare') params.append('aftercareFriendly', 'true');\n      \n      const response = await fetch(`/api/discover/creators?${params.toString()}`, {\n        credentials: 'include'\n      });\n      if (!response.ok) throw new Error('Failed to fetch creators');\n      return response.json();\n    }\n  });\n\n  const quickFilters = [\n    { id: 'active', label: 'ðŸ• Active Today', icon: Sparkles },\n    { id: 'fitness', label: 'ðŸ’ª Fitness Focus', icon: Dumbbell },\n    { id: 'gaming', label: 'ðŸŽ® Gaming Pups', icon: Gamepad2 },\n    { id: 'aftercare', label: 'â¤ï¸ Aftercare-Friendly', icon: Heart },\n  ];\n\n  const handleQuickFilter = (filterId: string) => {\n    if (filterId === 'aftercare') {\n      setSafetyFilter(safetyFilter === 'aftercare' ? 'all' : 'aftercare');\n    }\n    // Add more quick filter logic as needed\n  };\n\n  return (\n    <div className=\"min-h-screen\">\n      <Header />\n      \n      <main className=\"pt-40 pb-16\">\n        <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8\">\n          {/* Header */}\n          <div className=\"text-center mb-12\">\n            <h1 className=\"neon-heading text-4xl mb-4\">\n              Discover Your\n              <span className=\"neon-text-accent ml-2\">Pack</span>\n            </h1>\n            <p className=\"text-xl text-muted max-w-2xl mx-auto\">\n              Find creators and communities that match your energy and interests with our pack-based discovery system\n            </p>\n          </div>\n\n          {/* Discovery Filters */}\n          <Card className=\"pack-card mb-8\">\n            <CardContent className=\"p-6\">\n              <div className=\"grid md:grid-cols-4 gap-6\">\n                {/* Search */}\n                <div className=\"md:col-span-2\">\n                  <label className=\"block text-sm font-medium text-foreground mb-2\">Search Packs</label>\n                  <div className=\"relative\">\n                    <Input\n                      type=\"text\"\n                      placeholder=\"Search creators, interests, or content...\"\n                      value={searchQuery}\n                      onChange={(e) => setSearchQuery(e.target.value)}\n                      className=\"form-input pl-10\"\n                      data-testid=\"input-search\"\n                    />\n                    <Search className=\"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted\" />\n                  </div>\n                </div>\n\n                {/* Pack Type Filter */}\n                <div>\n                  <label className=\"block text-sm font-medium text-foreground mb-2\">Pack Type</label>\n                  <Select value={packType} onValueChange={setPackType}>\n                    <SelectTrigger className=\"form-select\" data-testid=\"select-pack-type\">\n                      <SelectValue placeholder=\"All Packs\" />\n                    </SelectTrigger>\n                    <SelectContent>\n                      <SelectItem value=\"all\">All Packs</SelectItem>\n                      <SelectItem value=\"alpha\">Alpha Leaders</SelectItem>\n                      <SelectItem value=\"playful\">Playful Pups</SelectItem>\n                      <SelectItem value=\"supportive\">Supportive Pack</SelectItem>\n                      <SelectItem value=\"training\">Training Focus</SelectItem>\n                    </SelectContent>\n                  </Select>\n                </div>\n\n                {/* Safety Filter */}\n                <div>\n                  <label className=\"block text-sm font-medium text-foreground mb-2\">Safety Features</label>\n                  <Select value={safetyFilter} onValueChange={setSafetyFilter}>\n                    <SelectTrigger className=\"form-select\" data-testid=\"select-safety\">\n                      <SelectValue placeholder=\"All Creators\" />\n                    </SelectTrigger>\n                    <SelectContent>\n                      <SelectItem value=\"all\">All Creators</SelectItem>\n                      <SelectItem value=\"verified\">Verified Only</SelectItem>\n                      <SelectItem value=\"aftercare\">Aftercare-Friendly</SelectItem>\n                      <SelectItem value=\"consent\">Consent-Clear</SelectItem>\n                    </SelectContent>\n                  </Select>\n                </div>\n              </div>\n\n              {/* Advanced Filters */}\n              <div className=\"mt-6 pt-6 border-t border-border\">\n                <div className=\"flex flex-wrap gap-3\">\n                  <span className=\"text-sm font-medium text-muted mb-2\">Quick Filters:</span>\n                  {quickFilters.map((filter) => (\n                    <Button\n                      key={filter.id}\n                      variant=\"outline\"\n                      size=\"sm\"\n                      onClick={() => handleQuickFilter(filter.id)}\n                      className={`\n                        ${filter.id === 'active' ? 'border-primary/50 text-primary hover:bg-primary/10' : ''}\n                        ${filter.id === 'fitness' ? 'border-secondary/50 text-secondary hover:bg-secondary/10' : ''}\n                        ${filter.id === 'gaming' ? 'border-accent/50 text-accent hover:bg-accent/10' : ''}\n                        ${filter.id === 'aftercare' && safetyFilter === 'aftercare' ? 'bg-success/20 border-success text-success' : filter.id === 'aftercare' ? 'border-success/50 text-success hover:bg-success/10' : ''}\n                      `}\n                      data-testid={`button-filter-${filter.id}`}\n                    >\n                      <filter.icon className=\"h-4 w-4 mr-2\" />\n                      {filter.label}\n                    </Button>\n                  ))}\n                </div>\n              </div>\n            </CardContent>\n          </Card>\n\n          {/* Results */}\n          <div className=\"mb-6 flex items-center justify-between\">\n            <p className=\"text-muted\" data-testid=\"text-results-count\">\n              {isLoading ? 'Loading...' : `${creators?.length || 0} creators found`}\n            </p>\n            <Select value={sortBy} onValueChange={setSortBy}>\n              <SelectTrigger className=\"w-48\" data-testid=\"select-sort\">\n                <SelectValue placeholder=\"Sort by\" />\n              </SelectTrigger>\n              <SelectContent>\n                <SelectItem value=\"newest\">Newest First</SelectItem>\n                <SelectItem value=\"popular\">Most Popular</SelectItem>\n                <SelectItem value=\"active\">Recently Active</SelectItem>\n                <SelectItem value=\"subscribers\">Most Subscribers</SelectItem>\n              </SelectContent>\n            </Select>\n          </div>\n\n          {/* Creator Grid */}\n          {isLoading ? (\n            <div className=\"grid md:grid-cols-2 lg:grid-cols-3 gap-6\">\n              {Array.from({ length: 9 }).map((_, i) => (\n                <Skeleton key={i} className=\"h-80\" />\n              ))}\n            </div>\n          ) : creators?.length > 0 ? (\n            <div className=\"grid md:grid-cols-2 lg:grid-cols-3 gap-6\">\n              {creators.map((creator: any) => (\n                <CreatorCard key={creator.id} creator={creator} />\n              ))}\n            </div>\n          ) : (\n            <div className=\"text-center py-16\">\n              <Users className=\"h-16 w-16 text-muted mx-auto mb-4\" />\n              <h3 className=\"font-semibold text-xl mb-2\">No Creators Found</h3>\n              <p className=\"text-muted mb-6\">\n                {searchQuery \n                  ? `No creators match your search for \"${searchQuery}\"`\n                  : \"No creators match your current filters\"\n                }\n              </p>\n              <Button \n                variant=\"outline\" \n                onClick={() => {\n                  setSearchQuery(\"\");\n                  setPackType(\"all\");\n                  setSafetyFilter(\"all\");\n                }}\n                data-testid=\"button-clear-filters\"\n              >\n                Clear Filters\n              </Button>\n            </div>\n          )}\n\n          {/* Featured Pack Types */}\n          <Card className=\"pack-card mt-12\">\n            <CardHeader>\n              <CardTitle className=\"flex items-center\">\n                <Star className=\"mr-2 h-5 w-5\" />\n                Explore Pack Types\n              </CardTitle>\n            </CardHeader>\n            <CardContent>\n              <div className=\"grid md:grid-cols-2 lg:grid-cols-4 gap-4\">\n                <Button\n                  variant=\"outline\"\n                  className=\"h-20 flex-col space-y-2 hover:bg-primary/10 hover:border-primary/50\"\n                  onClick={() => setPackType(\"alpha\")}\n                  data-testid=\"button-pack-alpha\"\n                >\n                  <Users className=\"h-6 w-6 text-primary\" />\n                  <span className=\"font-medium\">Alpha Leaders</span>\n                </Button>\n                \n                <Button\n                  variant=\"outline\"\n                  className=\"h-20 flex-col space-y-2 hover:bg-secondary/10 hover:border-secondary/50\"\n                  onClick={() => setPackType(\"playful\")}\n                  data-testid=\"button-pack-playful\"\n                >\n                  <Sparkles className=\"h-6 w-6 text-secondary\" />\n                  <span className=\"font-medium\">Playful Pups</span>\n                </Button>\n                \n                <Button\n                  variant=\"outline\"\n                  className=\"h-20 flex-col space-y-2 hover:bg-accent/10 hover:border-accent/50\"\n                  onClick={() => setPackType(\"supportive\")}\n                  data-testid=\"button-pack-supportive\"\n                >\n                  <Heart className=\"h-6 w-6 text-accent\" />\n                  <span className=\"font-medium\">Supportive Pack</span>\n                </Button>\n                \n                <Button\n                  variant=\"outline\"\n                  className=\"h-20 flex-col space-y-2 hover:bg-success/10 hover:border-success/50\"\n                  onClick={() => setPackType(\"training\")}\n                  data-testid=\"button-pack-training\"\n                >\n                  <Dumbbell className=\"h-6 w-6 text-success\" />\n                  <span className=\"font-medium\">Training Focus</span>\n                </Button>\n              </div>\n            </CardContent>\n          </Card>\n        </div>\n      </main>\n\n      <Footer />\n    </div>\n  );\n}\n","size_bytes":11639},"client/src/components/layout/Navigation.tsx":{"content":"import { Link, useLocation } from \"wouter\";\nimport { useState } from \"react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Sheet, SheetContent, SheetTrigger } from \"@/components/ui/sheet\";\nimport { \n  Home, \n  Search, \n  MessageCircle, \n  Settings, \n  BarChart3, \n  HelpCircle,\n  BookOpen,\n  Ticket,\n  Brain,\n  Trophy,\n  Shield,\n  Menu\n} from \"lucide-react\";\nimport { useAuth } from \"@/hooks/useAuth\";\n\nexport default function Navigation() {\n  const [location] = useLocation();\n  const { user } = useAuth();\n  const [mobileOpen, setMobileOpen] = useState(false);\n\n  const navItems = [\n    { path: \"/\", icon: Home, label: \"Home\", public: true },\n    { path: \"/discover\", icon: Search, label: \"Discover\", public: true },\n    { path: \"/messages\", icon: MessageCircle, label: \"Messages\", badge: \"new\" },\n    { path: \"/dashboard\", icon: BarChart3, label: \"Dashboard\" },\n    { path: \"/achievements\", icon: Trophy, label: \"Achievements\" },\n    { path: \"/moderation\", icon: Shield, label: \"Moderation\" },\n    { path: \"/wiki\", icon: Brain, label: \"AI Wiki\", public: true },\n    { path: \"/tutorials\", icon: BookOpen, label: \"Tutorials\", public: true },\n    { path: \"/support\", icon: HelpCircle, label: \"Help\", public: true },\n    { path: \"/tickets\", icon: Ticket, label: \"Support Tickets\" },\n    { path: \"/settings\", icon: Settings, label: \"Settings\" },\n  ];\n\n  // Mobile bottom nav items (most important 4-5)\n  const mobileBottomItems = [\n    { path: \"/\", icon: Home, label: \"Home\" },\n    { path: \"/discover\", icon: Search, label: \"Discover\" },\n    { path: \"/messages\", icon: MessageCircle, label: \"Messages\", badge: \"new\" },\n    { path: \"/dashboard\", icon: BarChart3, label: \"Dashboard\" },\n    { path: \"/settings\", icon: Settings, label: \"More\" },\n  ];\n\n  const isActive = (path: string) => {\n    if (path === \"/\" && location === \"/\") return true;\n    if (path !== \"/\" && location.startsWith(path)) return true;\n    return false;\n  };\n\n  const NavContent = () => (\n    <>\n      <div className=\"mb-6\">\n        <h2 className=\"text-lg font-semibold text-foreground mb-2\">\n          FUN Empire\n        </h2>\n        <div className=\"flex flex-wrap gap-1 text-xs\">\n          <Badge variant=\"secondary\" className=\"text-pink-400\">GirlFanz</Badge>\n          <Badge variant=\"secondary\" className=\"text-green-400\">PupFanz</Badge>\n          <Badge variant=\"secondary\" className=\"text-amber-600\">DaddyFanz</Badge>\n        </div>\n      </div>\n\n      <div className=\"space-y-1\">\n        {navItems.map((item) => {\n          const isPublic = item.public;\n          const shouldShow = isPublic || user;\n          \n          if (!shouldShow) return null;\n\n          return (\n            <Link key={item.path} href={item.path}>\n              <Button\n                variant={isActive(item.path) ? \"default\" : \"ghost\"}\n                className=\"w-full justify-start gap-2\"\n                onClick={() => setMobileOpen(false)}\n                data-testid={`nav-${item.label.toLowerCase().replace(\" \", \"-\")}`}\n              >\n                <item.icon className=\"h-4 w-4\" />\n                {item.label}\n                {item.badge && (\n                  <Badge variant=\"destructive\" className=\"ml-auto text-xs\">\n                    {item.badge}\n                  </Badge>\n                )}\n              </Button>\n            </Link>\n          );\n        })}\n      </div>\n\n      {user && (\n        <div className=\"pt-4 border-t border-border mt-4\">\n          <div className=\"text-sm text-muted-foreground\">\n            Logged in as <span className=\"font-medium\">{(user as any)?.username || (user as any)?.email || 'User'}</span>\n          </div>\n        </div>\n      )}\n    </>\n  );\n\n  return (\n    <>\n      {/* Desktop Sidebar - Hidden on mobile */}\n      <nav className=\"hidden lg:block bg-card border-r border-border h-full w-64 p-4 space-y-2\">\n        <NavContent />\n      </nav>\n\n      {/* Mobile Hamburger Menu */}\n      <Sheet open={mobileOpen} onOpenChange={setMobileOpen}>\n        <SheetTrigger asChild>\n          <Button \n            variant=\"ghost\" \n            size=\"icon\" \n            className=\"lg:hidden fixed top-4 left-4 z-[60] bg-card/80 backdrop-blur-sm\"\n            data-testid=\"button-mobile-menu\"\n          >\n            <Menu className=\"h-5 w-5\" />\n          </Button>\n        </SheetTrigger>\n        <SheetContent side=\"left\" className=\"w-64 p-4\">\n          <NavContent />\n        </SheetContent>\n      </Sheet>\n\n      {/* Mobile Bottom Navigation */}\n      <nav className=\"lg:hidden fixed bottom-0 left-0 right-0 z-40 bg-card border-t border-border\" style={{ paddingBottom: 'env(safe-area-inset-bottom)' }}>\n        <div className=\"flex justify-around items-center h-16 px-2\">\n          {mobileBottomItems.map((item) => {\n            if (!user) return null;\n\n            return (\n              <Link key={item.path} href={item.path}>\n                <button\n                  className={`flex flex-col items-center justify-center gap-1 px-3 py-2 rounded-lg transition-colors ${\n                    isActive(item.path)\n                      ? \"text-primary bg-primary/10\"\n                      : \"text-muted-foreground hover:text-foreground\"\n                  }`}\n                  data-testid={`mobile-nav-${item.label.toLowerCase()}`}\n                >\n                  <div className=\"relative\">\n                    <item.icon className=\"h-5 w-5\" />\n                    {item.badge && (\n                      <span className=\"absolute -top-1 -right-1 h-2 w-2 bg-destructive rounded-full\" />\n                    )}\n                  </div>\n                  <span className=\"text-xs font-medium\">{item.label}</span>\n                </button>\n              </Link>\n            );\n          })}\n        </div>\n      </nav>\n    </>\n  );\n}\n","size_bytes":5796},"server/liveStreamService.ts":{"content":"import { nanoid } from 'nanoid';\nimport { db } from './db';\nimport {\n  liveStreams,\n  streamParticipants,\n  streamRecordings,\n  coStarVerifications,\n  tips,\n  type LiveStream,\n  type StreamParticipant,\n  type StreamRecording,\n} from '@shared/schema';\nimport { eq, and, desc, inArray, isNull } from 'drizzle-orm';\n\n/**\n * Live Stream Infrastructure Service\n * \n * Handles:\n * - Stream lifecycle (create, start, stop, end)\n * - Participant management with co-star verification gates\n * - Real-time viewer tracking\n * - Tip integration during streams\n * - Auto-recording and highlight generation\n * - WebSocket integration for real-time updates\n * \n * Integration Points:\n * - WebRTC/RTMP streaming infrastructure\n * - Recording/encoding services (FFmpeg, cloud transcoding)\n * - AI highlight detection (integrate with AI Content Processing Service)\n * - WebSocket notification system (existing wsManager)\n */\n\nexport interface CreateStreamOptions {\n  title: string;\n  description?: string;\n  scheduledStartTime?: Date;\n  requiresCoStarVerification?: boolean;\n  recordingEnabled?: boolean;\n  autoHighlightsEnabled?: boolean;\n  visibility?: 'public' | 'subscribers' | 'private';\n}\n\nexport interface JoinStreamOptions {\n  role: 'viewer' | 'co_star' | 'moderator';\n  coStarVerificationId?: string;\n}\n\nclass LiveStreamService {\n  /**\n   * Create a new live stream\n   */\n  async createStream(creatorUserId: string, options: CreateStreamOptions): Promise<LiveStream> {\n    const streamKey = `sk_${nanoid(32)}`; // Secure stream key for RTMP/WebRTC\n    const streamUrl = `/streams/${nanoid(12)}`; // Public viewing URL\n\n    const [stream] = await db.insert(liveStreams)\n      .values({\n        creatorUserId,\n        title: options.title,\n        description: options.description,\n        status: options.scheduledStartTime ? 'scheduled' : 'live',\n        requiresCoStarVerification: options.requiresCoStarVerification || false,\n        scheduledStartTime: options.scheduledStartTime,\n        streamKey,\n        streamUrl,\n        recordingEnabled: options.recordingEnabled ?? true,\n        autoHighlightsEnabled: options.autoHighlightsEnabled ?? true,\n        visibility: options.visibility || 'public',\n      })\n      .returning();\n\n    // Add creator as host\n    await this.addParticipant(stream.id, creatorUserId, { role: 'viewer' });\n    await db.update(streamParticipants)\n      .set({ role: 'host' })\n      .where(and(\n        eq(streamParticipants.streamId, stream.id),\n        eq(streamParticipants.userId, creatorUserId)\n      ));\n\n    return stream;\n  }\n\n  /**\n   * Start a live stream\n   */\n  async startStream(streamId: string, creatorUserId: string): Promise<LiveStream> {\n    // Verify creator owns the stream\n    const [stream] = await db.select()\n      .from(liveStreams)\n      .where(and(\n        eq(liveStreams.id, streamId),\n        eq(liveStreams.creatorUserId, creatorUserId)\n      ));\n\n    if (!stream) {\n      throw new Error('Stream not found or access denied');\n    }\n\n    if (stream.status === 'live') {\n      return stream; // Already live\n    }\n\n    if (stream.status !== 'scheduled') {\n      throw new Error('Cannot start stream in current status');\n    }\n\n    // Update stream status\n    const [updatedStream] = await db.update(liveStreams)\n      .set({\n        status: 'live',\n        actualStartTime: new Date(),\n        updatedAt: new Date(),\n      })\n      .where(eq(liveStreams.id, streamId))\n      .returning();\n\n    // TODO: Start recording if enabled\n    if (stream.recordingEnabled) {\n      await this.startRecording(streamId);\n    }\n\n    // TODO: Send WebSocket notification to subscribers/followers\n    // wsManager.sendToUsers(subscriberIds, { type: 'stream_started', stream: updatedStream });\n\n    return updatedStream;\n  }\n\n  /**\n   * End a live stream\n   */\n  async endStream(streamId: string, creatorUserId: string): Promise<LiveStream> {\n    // Verify creator owns the stream\n    const [stream] = await db.select()\n      .from(liveStreams)\n      .where(and(\n        eq(liveStreams.id, streamId),\n        eq(liveStreams.creatorUserId, creatorUserId)\n      ));\n\n    if (!stream) {\n      throw new Error('Stream not found or access denied');\n    }\n\n    if (stream.status !== 'live') {\n      throw new Error('Stream is not currently live');\n    }\n\n    // Update stream status\n    const [updatedStream] = await db.update(liveStreams)\n      .set({\n        status: 'ended',\n        endedAt: new Date(),\n        updatedAt: new Date(),\n      })\n      .where(eq(liveStreams.id, streamId))\n      .returning();\n\n    // Mark all active participants as left\n    await db.update(streamParticipants)\n      .set({ leftAt: new Date() })\n      .where(and(\n        eq(streamParticipants.streamId, streamId),\n        isNull(streamParticipants.leftAt)\n      ));\n\n    // TODO: Stop recording\n    await this.stopRecording(streamId);\n\n    // TODO: Generate highlights if enabled\n    if (stream.autoHighlightsEnabled) {\n      await this.generateHighlights(streamId);\n    }\n\n    return updatedStream;\n  }\n\n  /**\n   * Join a stream as a participant\n   */\n  async joinStream(\n    streamId: string,\n    userId: string,\n    options: JoinStreamOptions\n  ): Promise<StreamParticipant> {\n    const [stream] = await db.select()\n      .from(liveStreams)\n      .where(eq(liveStreams.id, streamId));\n\n    if (!stream) {\n      throw new Error('Stream not found');\n    }\n\n    if (stream.status !== 'live') {\n      throw new Error('Stream is not currently live');\n    }\n\n    // Check co-star verification requirement\n    if (options.role === 'co_star') {\n      if (stream.requiresCoStarVerification) {\n        if (!options.coStarVerificationId) {\n          throw new Error('Co-star verification required');\n        }\n\n        // Verify co-star verification status\n        const [verification] = await db.select()\n          .from(coStarVerifications)\n          .where(and(\n            eq(coStarVerifications.id, options.coStarVerificationId),\n            eq(coStarVerifications.coStarUserId, userId),\n            eq(coStarVerifications.status, 'verified')\n          ));\n\n        if (!verification) {\n          throw new Error('Valid co-star verification not found');\n        }\n      }\n    }\n\n    // Check if already in stream\n    const [existingParticipant] = await db.select()\n      .from(streamParticipants)\n      .where(and(\n        eq(streamParticipants.streamId, streamId),\n        eq(streamParticipants.userId, userId),\n        isNull(streamParticipants.leftAt)\n      ));\n\n    if (existingParticipant) {\n      return existingParticipant; // Already joined\n    }\n\n    // Add participant\n    const [participant] = await db.insert(streamParticipants)\n      .values({\n        streamId,\n        userId,\n        role: options.role,\n        coStarVerificationId: options.coStarVerificationId,\n      })\n      .returning();\n\n    // Update viewer count\n    await this.updateViewerCount(streamId);\n\n    return participant;\n  }\n\n  /**\n   * Leave a stream\n   */\n  async leaveStream(streamId: string, userId: string): Promise<void> {\n    await db.update(streamParticipants)\n      .set({ leftAt: new Date() })\n      .where(and(\n        eq(streamParticipants.streamId, streamId),\n        eq(streamParticipants.userId, userId),\n        isNull(streamParticipants.leftAt)\n      ));\n\n    // Update viewer count\n    await this.updateViewerCount(streamId);\n  }\n\n  /**\n   * Update viewer count for a stream\n   */\n  private async updateViewerCount(streamId: string): Promise<void> {\n    const activeParticipants = await db.select()\n      .from(streamParticipants)\n      .where(and(\n        eq(streamParticipants.streamId, streamId),\n        isNull(streamParticipants.leftAt)\n      ));\n\n    const viewerCount = activeParticipants.length;\n\n    const [stream] = await db.select()\n      .from(liveStreams)\n      .where(eq(liveStreams.id, streamId));\n\n    const peakViewerCount = Math.max(stream?.peakViewerCount || 0, viewerCount);\n\n    await db.update(liveStreams)\n      .set({\n        viewerCount,\n        peakViewerCount,\n        updatedAt: new Date(),\n      })\n      .where(eq(liveStreams.id, streamId));\n  }\n\n  /**\n   * Add a participant to a stream (internal helper)\n   */\n  private async addParticipant(\n    streamId: string,\n    userId: string,\n    options: JoinStreamOptions\n  ): Promise<StreamParticipant> {\n    const [participant] = await db.insert(streamParticipants)\n      .values({\n        streamId,\n        userId,\n        role: options.role,\n        coStarVerificationId: options.coStarVerificationId,\n      })\n      .returning();\n\n    return participant;\n  }\n\n  /**\n   * Send a tip during a live stream\n   */\n  async sendStreamTip(\n    streamId: string,\n    fromUserId: string,\n    toUserId: string,\n    amount: number,\n    message?: string\n  ): Promise<any> {\n    const [stream] = await db.select()\n      .from(liveStreams)\n      .where(eq(liveStreams.id, streamId));\n\n    if (!stream) {\n      throw new Error('Stream not found');\n    }\n\n    if (stream.status !== 'live') {\n      throw new Error('Stream is not currently live');\n    }\n\n    if (!stream.tipsEnabled) {\n      throw new Error('Tips are disabled for this stream');\n    }\n\n    // Create tip with stream reference\n    const [tip] = await db.insert(tips)\n      .values({\n        fromUserId,\n        toUserId,\n        amount: amount.toString(),\n        message,\n        streamId,\n        status: 'completed', // TODO: Integrate with payment processor\n      })\n      .returning();\n\n    // Update stream total tips amount\n    const currentTotal = parseFloat(stream.totalTipsAmount || '0');\n    await db.update(liveStreams)\n      .set({\n        totalTipsAmount: (currentTotal + amount).toString(),\n        updatedAt: new Date(),\n      })\n      .where(eq(liveStreams.id, streamId));\n\n    // Update participant stats\n    const [participant] = await db.select()\n      .from(streamParticipants)\n      .where(and(\n        eq(streamParticipants.streamId, streamId),\n        eq(streamParticipants.userId, fromUserId)\n      ));\n\n    if (participant) {\n      const currentTips = parseFloat(participant.tipsSentAmount || '0');\n      await db.update(streamParticipants)\n        .set({\n          tipsSentAmount: (currentTips + amount).toString(),\n        })\n        .where(and(\n          eq(streamParticipants.streamId, streamId),\n          eq(streamParticipants.userId, fromUserId)\n        ));\n    }\n\n    // TODO: Send WebSocket notification\n    // wsManager.sendToUsers([toUserId], { type: 'stream_tip', tip });\n\n    return tip;\n  }\n\n  /**\n   * Get stream details\n   */\n  async getStream(streamId: string): Promise<LiveStream | null> {\n    const [stream] = await db.select()\n      .from(liveStreams)\n      .where(eq(liveStreams.id, streamId));\n\n    return stream || null;\n  }\n\n  /**\n   * Get streams for a creator\n   */\n  async getCreatorStreams(creatorUserId: string): Promise<LiveStream[]> {\n    return db.select()\n      .from(liveStreams)\n      .where(eq(liveStreams.creatorUserId, creatorUserId))\n      .orderBy(desc(liveStreams.createdAt));\n  }\n\n  /**\n   * Get active (live) streams\n   */\n  async getLiveStreams(): Promise<LiveStream[]> {\n    return db.select()\n      .from(liveStreams)\n      .where(eq(liveStreams.status, 'live'))\n      .orderBy(desc(liveStreams.viewerCount));\n  }\n\n  /**\n   * Get stream participants\n   */\n  async getStreamParticipants(streamId: string): Promise<StreamParticipant[]> {\n    return db.select()\n      .from(streamParticipants)\n      .where(eq(streamParticipants.streamId, streamId))\n      .orderBy(desc(streamParticipants.joinedAt));\n  }\n\n  /**\n   * Get stream recordings\n   */\n  async getStreamRecordings(streamId: string): Promise<StreamRecording[]> {\n    return db.select()\n      .from(streamRecordings)\n      .where(eq(streamRecordings.streamId, streamId))\n      .orderBy(desc(streamRecordings.createdAt));\n  }\n\n  /**\n   * Start recording a stream\n   * TODO: Integrate with recording/encoding service\n   */\n  private async startRecording(streamId: string): Promise<void> {\n    // TODO: Start RTMP/HLS recording\n    // TODO: Upload to object storage\n    \n    console.log(`[LiveStream] Starting recording for stream ${streamId}`);\n    \n    // Create recording entry\n    await db.insert(streamRecordings)\n      .values({\n        streamId,\n        type: 'full_recording',\n        title: 'Full Stream Recording',\n        objectPath: `/recordings/${streamId}/full.mp4`, // TODO: Actual path\n        status: 'processing',\n      });\n  }\n\n  /**\n   * Stop recording a stream\n   * TODO: Integrate with recording/encoding service\n   */\n  private async stopRecording(streamId: string): Promise<void> {\n    console.log(`[LiveStream] Stopping recording for stream ${streamId}`);\n    \n    // Update recording status\n    await db.update(streamRecordings)\n      .set({\n        status: 'ready',\n        updatedAt: new Date(),\n      })\n      .where(and(\n        eq(streamRecordings.streamId, streamId),\n        eq(streamRecordings.type, 'full_recording')\n      ));\n  }\n\n  /**\n   * Generate highlights from stream recording\n   * TODO: Integrate with AI Content Processing Service for highlight detection\n   */\n  private async generateHighlights(streamId: string): Promise<void> {\n    console.log(`[LiveStream] Generating highlights for stream ${streamId}`);\n    \n    // TODO: Use AI to detect interesting moments\n    // TODO: Create highlight clips\n    // TODO: Upload to object storage\n    \n    // Mock: Create a few highlight entries\n    const highlightMoments = [\n      { start: 120, end: 180, title: 'Highlight 1' },\n      { start: 600, end: 660, title: 'Highlight 2' },\n    ];\n\n    for (const moment of highlightMoments) {\n      await db.insert(streamRecordings)\n        .values({\n          streamId,\n          type: 'highlight',\n          title: moment.title,\n          objectPath: `/recordings/${streamId}/highlight_${moment.start}.mp4`,\n          startTime: moment.start,\n          endTime: moment.end,\n          aiGenerated: true,\n          status: 'processing',\n        });\n    }\n  }\n}\n\nexport const liveStreamService = new LiveStreamService();\n","size_bytes":14013},"client/src/components/ui/tooltip.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as TooltipPrimitive from \"@radix-ui/react-tooltip\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst TooltipProvider = TooltipPrimitive.Provider\n\nconst Tooltip = TooltipPrimitive.Root\n\nconst TooltipTrigger = TooltipPrimitive.Trigger\n\nconst TooltipContent = React.forwardRef<\n  React.ElementRef<typeof TooltipPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof TooltipPrimitive.Content>\n>(({ className, sideOffset = 4, ...props }, ref) => (\n  <TooltipPrimitive.Content\n    ref={ref}\n    sideOffset={sideOffset}\n    className={cn(\n      \"z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-tooltip-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nTooltipContent.displayName = TooltipPrimitive.Content.displayName\n\nexport { Tooltip, TooltipTrigger, TooltipContent, TooltipProvider }\n","size_bytes":1209},"WARP.md":{"content":"# WARP.md\n\nThis file provides guidance to WARP (warp.dev) when working with code in this repository.\n\n# PupFanz â€¢ WARP Guide\n\nSpeak human. Move fast. Creator-first.\n\n## Quick Start\n\n1) `nvm use` (if .nvmrc present, otherwise use Node 20+)\n2) `pnpm install --frozen-lockfile`\n3) Copy `env/.env.example` â†’ `env/.env.local` and edit values\n4) `pnpm db:push` (apply schema to database)\n5) `pnpm dev` (starts both frontend and backend)\n6) Open http://localhost:5000 (dev server)\n\n## Common Commands\n\n- `pnpm dev` - Start both frontend/backend in development\n- `pnpm build` - Build frontend and backend for production\n- `pnpm start` - Start production build\n- `pnpm check` - TypeScript type checking\n- `pnpm lint` - ESLint (if configured)\n- `pnpm test` - Run tests (if configured)  \n- `pnpm db:push` - Apply schema changes to database\n\n## Architecture (High-level)\n\n**Frontend**\n- React 18 + TypeScript\n- Vite (fast dev/build) \n- Wouter (lightweight routing)\n- TanStack React Query (server state management)\n- Radix UI + Tailwind CSS (accessible, themed components)\n- Brand colors: Volt lime, Cobalt blue, Tangerine orange on dark theme\n\n**Backend**\n- Node.js (ESM) + TypeScript + Express.js\n- RESTful API with comprehensive middleware (security, validation, rate limiting)\n- WebSocket server for real-time messaging and notifications\n- Google Cloud Storage integration for media assets\n\n**Authentication**\n- Dual authentication system:\n  - Replit OIDC (currently implemented) - quick onboarding via `/api/login`\n  - Local JWT authentication (available) - traditional email/password\n- PostgreSQL-backed session storage (sessions table)\n- CSRF protection, rate limiting, secure cookies\n\n**Database**\n- PostgreSQL (Neon serverless recommended)\n- Drizzle ORM for type-safe operations and migrations\n- Schema in `shared/schema.ts` covers: users, profiles, media, subscriptions, messaging, consent, KYC/2257 compliance, moderation, safety reports\n- Multi-tenant support: tenants, content, content_tenant_map, subscription_plans\n\n**Safety & Compliance**\n- Age/KYC verification system with document upload\n- Granular consent tracking for interactions and data usage\n- Content moderation queue with AI confidence scoring\n- GDPR-compliant data handling with explicit consent\n- Adult industry compliance (18 U.S.C. Â§2257)\n- WCAG 2.2 AA accessibility standards\n\n## Environment Setup\n\n**Tooling Requirements**\n- Node.js 20+ (use .nvmrc if present)\n- pnpm (only package manager supported)\n- Environment files: `.env` for development (no `.env` folder structure currently)\n\n**Required Environment Variables**\n```bash\n# Database\nDATABASE_URL=\"postgresql://username:password@localhost:5432/pupfanz\"\n\n# Replit Authentication  \nREPL_ID=\"your-replit-client-id\"\nREPLIT_DOMAINS=\"your-domain.com\"\nISSUER_URL=\"https://replit.com/oidc\"\nSESSION_SECRET=\"your-session-secret-key\"\n\n# Local JWT Authentication\nJWT_SECRET=\"your-jwt-secret-key-64-characters-minimum\"\n\n# Google Cloud Storage (optional)\nGOOGLE_APPLICATION_CREDENTIALS=\"/path/to/service-account.json\"\n# Or individual GCS environment variables\n\n# Optional\nNODE_ENV=\"development\"\nPORT=\"5000\"\n```\n\n## Database & Migrations\n\n- ORM: Drizzle with PostgreSQL\n- Schema: `shared/schema.ts` includes sessions table for Replit Auth\n- Configuration: `drizzle.config.ts`\n\n**Key Commands:**\n- `pnpm db:push` - Push schema changes to database\n- Database includes sessions table for connect-pg-simple (Replit auth dependency)\n\n**Important Tables:**\n- `users` - Core user accounts with dual auth support (local/replit)\n- `profiles` - Creator/fan profiles with KYC status, pack types, safety badges\n- `media_assets` - Content with access levels (pack/premium/ppv), forensic signatures\n- `sessions` - Required for Replit OIDC authentication\n- `subscriptions`, `tips`, `messages` - Monetization and communication\n- `kyc_verifications`, `records_2257` - Compliance and age verification\n- `moderation_queue`, `safety_reports` - Content safety and community management\n\n## Authentication Flows\n\n**Replit OIDC (Currently Active)**\n- `GET /api/login` - Initiates OIDC flow with scopes: openid, email, profile, offline_access\n- `GET /api/callback` - OIDC callback handler (hostname-aware strategy)\n- `GET /api/logout` - Ends session with OIDC end-session redirect\n- Middleware: `isAuthenticated` - Validates session, refreshes expired tokens\n- Session storage: connect-pg-simple with PostgreSQL sessions table (7-day TTL)\n\n**Local JWT (Available)**\n- `POST /api/auth/register` - Create account with email/password\n- `POST /api/auth/login` - Authenticate with credentials  \n- Uses bcrypt for password hashing, Zod for validation\n- JWT tokens with configurable expiration\n\n**Development Note:**\n- Cookies default to `secure: true` - use HTTPS in development or modify for local development\n\n## Media Storage & Content\n\n- Google Cloud Storage for direct-to-cloud uploads via Uppy\n- Custom ACL system supports pack/subscriber-only, premium, pay-per-view content\n- Forensic watermarking and content fingerprinting for protection\n- Object storage service with granular permission controls\n\n**File Upload Flow:**\n1. Client requests upload URL via `POST /api/objects/upload`\n2. Direct upload to GCS with custom ACL policies\n3. Media metadata stored in `media_assets` table\n4. Access controlled via `GET /objects/:objectPath(*)` endpoint\n\n## Multi-tenant Content Model\n\n**Key Tables:**\n- `tenants` - Platform instances (PupFanz, GirlFanz, etc.)\n- `content` - Creator content with canonical tenant assignment\n- `content_tenant_map` - Cross-platform publishing (published/scheduled/hidden)\n- `subscription_plans` - Per-tenant creator subscription offerings\n\n**Cross-posting Flow:**\n- Content authored on canonical tenant\n- Mapped to other tenants via content_tenant_map\n- Status controls: published, scheduled, hidden\n\n## Safety, Compliance & Accessibility\n\n**Compliance Systems:**\n- KYC verification via `kyc_verifications` table with document storage\n- 18 U.S.C. Â§2257 record keeping in `records_2257`\n- Granular consent tracking in `consent_records`\n- Content moderation queue with AI confidence scoring\n- Safety reporting system with investigation workflows\n\n**Data Protection:**\n- GDPR-compliant with explicit consent mechanisms\n- No third-party data sharing without opt-in\n- Right to deletion and data export capabilities\n\n**Accessibility:**\n- WCAG 2.2 AA compliance baseline\n- Radix UI accessible component primitives\n- Focus management, keyboard navigation, alt text requirements\n\n**Legal Framework:**\n- Policies and procedures: https://Fanz.Foundation/knowledge-base\n\n## Payments & Monetization\n\n**CRITICAL: Adult-Friendly Processors Only**\n- Never use Stripe, PayPal, or Square (prohibited for adult content)\n- Approved processors: CCBill, Segpay, Epoch, Vendo, Verotel, NetBilling, CommerceGate, RocketGate, CentroBill, Payze, Kolektiva\n- Creator payouts: Paxum (industry standard), ePayService, Wise, crypto, ACH/SEPA\n- FanzDash serves as super-admin layer for payment routing and risk management\n\n**Tipping System:**\n- Real-time tips via WebSocket with database persistence\n- Integration with adult-friendly payment processors\n- Transparent fee structure for creators\n\n## Real-time Features\n\n**WebSocket Server:**\n- Real-time messaging system\n- Live notifications and updates\n- Connection on `/ws` path\n- Message broadcasting to connected clients\n\n**Messaging:**\n- Direct messages between users with media sharing support\n- Message types: text, image, tip, system\n- Read receipts and conversation management\n\n## Development Workflow\n\n**Code Quality:**\n- TypeScript strict mode enabled\n- Zod validation for API inputs and form data\n- ESLint configuration (if present)\n- Pre-commit hooks for code quality\n\n**Testing:**\n- Unit tests for business logic\n- Integration tests for API endpoints and authentication\n- Database integration testing\n- Load testing before major releases\n\n**Performance:**\n- API response time targets: P95 < 300ms\n- Upload success rate > 99.9%\n- Error rate monitoring and alerting\n- Database connection pooling for production\n\n## Security Considerations\n\n**Transport & Storage:**\n- TLS 1.3 for all connections\n- AES-256 encryption at rest\n- Zero-trust network architecture\n- Least privilege access principles\n\n**Application Security:**\n- CSRF protection via double submit cookies\n- Rate limiting per IP and user\n- Input validation with Zod schemas\n- XSS and injection attack prevention\n\n**Session Management:**\n- Secure cookie configuration\n- Session expiration and refresh token rotation\n- Multi-factor authentication support (admin)\n\n## Observability\n\n**Structured Logging:**\n- Request correlation IDs\n- User action tracking\n- Error stack traces with context\n- Security event logging\n\n**Monitoring:**\n- Health check endpoints for all services\n- Database connection pool monitoring\n- Error rate and response time metrics\n- Active session tracking\n\n**Incident Response:**\n- SLA: Detection < 5 minutes, resolution < 30 minutes\n- Post-mortem process within 48 hours\n- Automated alerting for critical failures\n\n## Platform Integration\n\n**FanzDash Integration:**\n- Central security control center\n- Cross-platform policy enforcement\n- Creator relationship management\n- Financial transaction oversight\n\n**Multi-platform Ecosystem:**\n- Unified SSO across FANZ network\n- Cross-platform content publishing\n- Shared creator profiles and verification status\n- Consolidated analytics and reporting\n\n## Development Commands Reference\n\nBased on current package.json scripts:\n```bash\n# Development\npnpm dev          # NODE_ENV=development tsx server/index.ts\n\n# Production  \npnpm build        # vite build && esbuild bundle\npnpm start        # NODE_ENV=production node dist/index.js\n\n# Database\npnpm db:push      # drizzle-kit push (apply schema)\n\n# Quality\npnpm check        # TypeScript compilation check\n```\n\n## File Structure Notes\n\n- `server/` - Express.js backend with routes, middleware, services\n- `client/` - React frontend with Vite build system  \n- `shared/` - Shared TypeScript types and database schema\n- `components.json` - Radix UI configuration\n- Tailwind configuration with custom PupFanz theming\n\n## Environment-Specific Notes\n\n**Development:**\n- Uses tsx for TypeScript execution\n- Hot reloading via Vite\n- Database migrations applied directly via drizzle-kit push\n\n**Production:**\n- ESBuild bundling for server\n- Vite production build for client\n- Proper session security and HTTPS enforcement\n- Connection pooling and performance optimization\n\n**Deployment:**\n- Built for serverless/container environments\n- Health check endpoint available\n- Graceful shutdown handling\n- Static asset serving configuration","size_bytes":10640},"client/src/components/ui/accordion.tsx":{"content":"import * as React from \"react\"\nimport * as AccordionPrimitive from \"@radix-ui/react-accordion\"\nimport { ChevronDown } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Accordion = AccordionPrimitive.Root\n\nconst AccordionItem = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Item>\n>(({ className, ...props }, ref) => (\n  <AccordionPrimitive.Item\n    ref={ref}\n    className={cn(\"border-b\", className)}\n    {...props}\n  />\n))\nAccordionItem.displayName = \"AccordionItem\"\n\nconst AccordionTrigger = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <AccordionPrimitive.Header className=\"flex\">\n    <AccordionPrimitive.Trigger\n      ref={ref}\n      className={cn(\n        \"flex flex-1 items-center justify-between py-4 font-medium transition-all hover:underline [&[data-state=open]>svg]:rotate-180\",\n        className\n      )}\n      {...props}\n    >\n      {children}\n      <ChevronDown className=\"h-4 w-4 shrink-0 transition-transform duration-200\" />\n    </AccordionPrimitive.Trigger>\n  </AccordionPrimitive.Header>\n))\nAccordionTrigger.displayName = AccordionPrimitive.Trigger.displayName\n\nconst AccordionContent = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <AccordionPrimitive.Content\n    ref={ref}\n    className=\"overflow-hidden text-sm transition-all data-[state=closed]:animate-accordion-up data-[state=open]:animate-accordion-down\"\n    {...props}\n  >\n    <div className={cn(\"pb-4 pt-0\", className)}>{children}</div>\n  </AccordionPrimitive.Content>\n))\n\nAccordionContent.displayName = AccordionPrimitive.Content.displayName\n\nexport { Accordion, AccordionItem, AccordionTrigger, AccordionContent }\n","size_bytes":1977},"server/objectStorage.ts":{"content":"import { Storage, File } from \"@google-cloud/storage\";\nimport { Response } from \"express\";\nimport { randomUUID } from \"crypto\";\nimport {\n  ObjectAclPolicy,\n  ObjectPermission,\n  canAccessObject,\n  getObjectAclPolicy,\n  setObjectAclPolicy,\n} from \"./objectAcl\";\n\nconst REPLIT_SIDECAR_ENDPOINT = \"http://127.0.0.1:1106\";\n\n// The object storage client is used to interact with the object storage service.\nexport const objectStorageClient = new Storage({\n  credentials: {\n    audience: \"replit\",\n    subject_token_type: \"access_token\",\n    token_url: `${REPLIT_SIDECAR_ENDPOINT}/token`,\n    type: \"external_account\",\n    credential_source: {\n      url: `${REPLIT_SIDECAR_ENDPOINT}/credential`,\n      format: {\n        type: \"json\",\n        subject_token_field_name: \"access_token\",\n      },\n    },\n    universe_domain: \"googleapis.com\",\n  },\n  projectId: \"\",\n});\n\nexport class ObjectNotFoundError extends Error {\n  constructor() {\n    super(\"Object not found\");\n    this.name = \"ObjectNotFoundError\";\n    Object.setPrototypeOf(this, ObjectNotFoundError.prototype);\n  }\n}\n\n// The object storage service is used to interact with the object storage service.\nexport class ObjectStorageService {\n  constructor() {}\n\n  // Gets the public object search paths.\n  getPublicObjectSearchPaths(): Array<string> {\n    const pathsStr = process.env.PUBLIC_OBJECT_SEARCH_PATHS || \"\";\n    const paths = Array.from(\n      new Set(\n        pathsStr\n          .split(\",\")\n          .map((path) => path.trim())\n          .filter((path) => path.length > 0)\n      )\n    );\n    if (paths.length === 0) {\n      throw new Error(\n        \"PUBLIC_OBJECT_SEARCH_PATHS not set. Create a bucket in 'Object Storage' \" +\n          \"tool and set PUBLIC_OBJECT_SEARCH_PATHS env var (comma-separated paths).\"\n      );\n    }\n    return paths;\n  }\n\n  // Gets the private object directory.\n  getPrivateObjectDir(): string {\n    const dir = process.env.PRIVATE_OBJECT_DIR || \"\";\n    if (!dir) {\n      throw new Error(\n        \"PRIVATE_OBJECT_DIR not set. Create a bucket in 'Object Storage' \" +\n          \"tool and set PRIVATE_OBJECT_DIR env var.\"\n      );\n    }\n    return dir;\n  }\n\n  // Search for a public object from the search paths.\n  async searchPublicObject(filePath: string): Promise<File | null> {\n    for (const searchPath of this.getPublicObjectSearchPaths()) {\n      const fullPath = `${searchPath}/${filePath}`;\n\n      // Full path format: /<bucket_name>/<object_name>\n      const { bucketName, objectName } = parseObjectPath(fullPath);\n      const bucket = objectStorageClient.bucket(bucketName);\n      const file = bucket.file(objectName);\n\n      // Check if file exists\n      const [exists] = await file.exists();\n      if (exists) {\n        return file;\n      }\n    }\n\n    return null;\n  }\n\n  // Downloads an object to the response.\n  async downloadObject(file: File, res: Response, cacheTtlSec: number = 3600) {\n    try {\n      // Get file metadata\n      const [metadata] = await file.getMetadata();\n      // Get the ACL policy for the object.\n      const aclPolicy = await getObjectAclPolicy(file);\n      const isPublic = aclPolicy?.visibility === \"public\";\n      // Set appropriate headers\n      res.set({\n        \"Content-Type\": metadata.contentType || \"application/octet-stream\",\n        \"Content-Length\": metadata.size,\n        \"Cache-Control\": `${\n          isPublic ? \"public\" : \"private\"\n        }, max-age=${cacheTtlSec}`,\n      });\n\n      // Stream the file to the response\n      const stream = file.createReadStream();\n\n      stream.on(\"error\", (err) => {\n        console.error(\"Stream error:\", err);\n        if (!res.headersSent) {\n          res.status(500).json({ error: \"Error streaming file\" });\n        }\n      });\n\n      stream.pipe(res);\n    } catch (error) {\n      console.error(\"Error downloading file:\", error);\n      if (!res.headersSent) {\n        res.status(500).json({ error: \"Error downloading file\" });\n      }\n    }\n  }\n\n  // Gets the upload URL for an object entity.\n  async getObjectEntityUploadURL(): Promise<string> {\n    const privateObjectDir = this.getPrivateObjectDir();\n    if (!privateObjectDir) {\n      throw new Error(\n        \"PRIVATE_OBJECT_DIR not set. Create a bucket in 'Object Storage' \" +\n          \"tool and set PRIVATE_OBJECT_DIR env var.\"\n      );\n    }\n\n    const objectId = randomUUID();\n    const fullPath = `${privateObjectDir}/uploads/${objectId}`;\n\n    const { bucketName, objectName } = parseObjectPath(fullPath);\n\n    // Sign URL for PUT method with TTL\n    return signObjectURL({\n      bucketName,\n      objectName,\n      method: \"PUT\",\n      ttlSec: 900,\n    });\n  }\n\n  // Gets the object entity file from the object path.\n  async getObjectEntityFile(objectPath: string): Promise<File> {\n    if (!objectPath.startsWith(\"/objects/\")) {\n      throw new ObjectNotFoundError();\n    }\n\n    const parts = objectPath.slice(1).split(\"/\");\n    if (parts.length < 2) {\n      throw new ObjectNotFoundError();\n    }\n\n    const entityId = parts.slice(1).join(\"/\");\n    let entityDir = this.getPrivateObjectDir();\n    if (!entityDir.endsWith(\"/\")) {\n      entityDir = `${entityDir}/`;\n    }\n    const objectEntityPath = `${entityDir}${entityId}`;\n    const { bucketName, objectName } = parseObjectPath(objectEntityPath);\n    const bucket = objectStorageClient.bucket(bucketName);\n    const objectFile = bucket.file(objectName);\n    const [exists] = await objectFile.exists();\n    if (!exists) {\n      throw new ObjectNotFoundError();\n    }\n    return objectFile;\n  }\n\n  normalizeObjectEntityPath(\n    rawPath: string,\n  ): string {\n    if (!rawPath.startsWith(\"https://storage.googleapis.com/\")) {\n      return rawPath;\n    }\n  \n    // Extract the path from the URL by removing query parameters and domain\n    const url = new URL(rawPath);\n    const rawObjectPath = url.pathname;\n  \n    let objectEntityDir = this.getPrivateObjectDir();\n    if (!objectEntityDir.endsWith(\"/\")) {\n      objectEntityDir = `${objectEntityDir}/`;\n    }\n  \n    if (!rawObjectPath.startsWith(objectEntityDir)) {\n      return rawObjectPath;\n    }\n  \n    // Extract the entity ID from the path\n    const entityId = rawObjectPath.slice(objectEntityDir.length);\n    return `/objects/${entityId}`;\n  }\n\n  // Tries to set the ACL policy for the object entity and return the normalized path.\n  async trySetObjectEntityAclPolicy(\n    rawPath: string,\n    aclPolicy: ObjectAclPolicy\n  ): Promise<string> {\n    const normalizedPath = this.normalizeObjectEntityPath(rawPath);\n    if (!normalizedPath.startsWith(\"/\")) {\n      return normalizedPath;\n    }\n\n    const objectFile = await this.getObjectEntityFile(normalizedPath);\n    await setObjectAclPolicy(objectFile, aclPolicy);\n    return normalizedPath;\n  }\n\n  // Checks if the user can access the object entity.\n  async canAccessObjectEntity({\n    userId,\n    objectFile,\n    requestedPermission,\n  }: {\n    userId?: string;\n    objectFile: File;\n    requestedPermission?: ObjectPermission;\n  }): Promise<boolean> {\n    return canAccessObject({\n      userId,\n      objectFile,\n      requestedPermission: requestedPermission ?? ObjectPermission.READ,\n    });\n  }\n\n  async deleteObject(objectPath: string): Promise<void> {\n    try {\n      // Parse the object path to get bucket and object name\n      const { bucketName, objectName } = parseObjectPath(objectPath);\n      const bucket = objectStorageClient.bucket(bucketName);\n      const file = bucket.file(objectName);\n      \n      // Delete the file from cloud storage\n      await file.delete();\n    } catch (error) {\n      console.error(\"Error deleting object:\", error);\n      throw new Error(\"Failed to delete object from storage\");\n    }\n  }\n}\n\nfunction parseObjectPath(path: string): {\n  bucketName: string;\n  objectName: string;\n} {\n  if (!path.startsWith(\"/\")) {\n    path = `/${path}`;\n  }\n  const pathParts = path.split(\"/\");\n  if (pathParts.length < 3) {\n    throw new Error(\"Invalid path: must contain at least a bucket name\");\n  }\n\n  const bucketName = pathParts[1];\n  const objectName = pathParts.slice(2).join(\"/\");\n\n  return {\n    bucketName,\n    objectName,\n  };\n}\n\nasync function signObjectURL({\n  bucketName,\n  objectName,\n  method,\n  ttlSec,\n}: {\n  bucketName: string;\n  objectName: string;\n  method: \"GET\" | \"PUT\" | \"DELETE\" | \"HEAD\";\n  ttlSec: number;\n}): Promise<string> {\n  const request = {\n    bucket_name: bucketName,\n    object_name: objectName,\n    method,\n    expires_at: new Date(Date.now() + ttlSec * 1000).toISOString(),\n  };\n  const response = await fetch(\n    `${REPLIT_SIDECAR_ENDPOINT}/object-storage/signed-object-url`,\n    {\n      method: \"POST\",\n      headers: {\n        \"Content-Type\": \"application/json\",\n      },\n      body: JSON.stringify(request),\n    }\n  );\n  if (!response.ok) {\n    throw new Error(\n      `Failed to sign object URL, errorcode: ${response.status}, ` +\n        `make sure you're running on Replit`\n    );\n  }\n\n  const { signed_url: signedURL } = await response.json();\n  return signedURL;\n}\n","size_bytes":8940},"client/src/components/layout/Header.tsx":{"content":"import { useState } from \"react\";\nimport { useAuth } from \"@/hooks/useAuth\";\nimport { useUserPacks } from \"@/hooks/usePacks\";\nimport { Button } from \"@/components/ui/button\";\nimport { Avatar, AvatarImage, AvatarFallback } from \"@/components/ui/avatar\";\nimport {\n  DropdownMenu,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuLabel,\n  DropdownMenuSeparator,\n  DropdownMenuTrigger,\n} from \"@/components/ui/dropdown-menu\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { \n  PawPrint, \n  Search, \n  MessageCircle, \n  User, \n  Settings, \n  LogOut,\n  Bell,\n  Menu,\n  X,\n  Star,\n  Shield,\n  Heart\n} from \"lucide-react\";\nimport { Link, useLocation } from \"wouter\";\nimport pupfanzLogo from \"@/assets/pupfanz-logo.jpeg\";\n\ninterface HeaderProps {\n  onAuthClick?: (mode: 'login' | 'register') => void;\n}\n\nexport default function Header({ onAuthClick }: HeaderProps) {\n  const { user, isAuthenticated } = useAuth();\n  const { data: userPacks } = useUserPacks(user?.id);\n  const [location] = useLocation();\n  const [isMobileMenuOpen, setIsMobileMenuOpen] = useState(false);\n  \n  // Get the first pack name for display (user's primary pack)\n  const primaryPack = userPacks && userPacks.length > 0 ? userPacks[0] : null;\n\n  const navigation = [\n    { name: 'Discover', href: '/discover', icon: Star },\n    { name: 'Packs', href: '/packs', icon: Heart },\n    { name: 'Safety', href: '/safety', icon: Shield },\n    { name: 'Support', href: '/support', icon: MessageCircle },\n  ];\n\n  const handleLogout = () => {\n    window.location.href = '/api/logout';\n  };\n\n  return (\n    <header className=\"fixed top-0 left-0 right-0 z-50 bg-background/80 backdrop-blur-md border-b border-border\">\n      <div className=\"max-w-7xl mx-auto px-3 sm:px-4 md:px-6 lg:px-8\">\n        <div className=\"flex items-center justify-between h-16 sm:h-20 md:h-24 lg:h-32\">\n          {/* Logo - Responsive sizing */}\n          <Link href=\"/\" className=\"flex items-center space-x-3 group\">\n            <img \n              src={pupfanzLogo} \n              alt=\"PupFanz Logo\" \n              className=\"h-12 sm:h-16 md:h-20 lg:h-28 w-auto group-hover:shadow-volt-glow transition-all duration-200 rounded-lg\"\n              data-testid=\"logo-header\"\n            />\n          </Link>\n\n          {/* Desktop Navigation */}\n          <nav className=\"hidden md:flex items-center space-x-8\">\n            {navigation.map((item) => (\n              <Link\n                key={item.name}\n                href={item.href}\n                className={`text-muted hover:text-foreground transition-colors ${\n                  location === item.href ? 'text-foreground' : ''\n                }`}\n                data-testid={`nav-${item.name.toLowerCase()}`}\n              >\n                {item.name}\n              </Link>\n            ))}\n          </nav>\n\n          {/* Search Bar (Desktop) */}\n          <div className=\"hidden lg:flex flex-1 max-w-md mx-8\">\n            <div className=\"relative w-full\">\n              <Search className=\"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted\" />\n              <input\n                type=\"text\"\n                placeholder=\"Search creators, packs...\"\n                className=\"w-full pl-10 pr-4 py-2 bg-background border border-border rounded-lg focus:ring-2 focus:ring-primary focus:border-primary transition-colors text-foreground\"\n                data-testid=\"input-search\"\n              />\n            </div>\n          </div>\n\n          {/* Auth Controls */}\n          <div className=\"flex items-center space-x-2 sm:space-x-4\">\n            {isAuthenticated ? (\n              <>\n                {/* Notifications - Hidden on small mobile */}\n                <Button variant=\"ghost\" size=\"sm\" className=\"relative hidden sm:flex\" data-testid=\"button-notifications\">\n                  <Bell className=\"h-5 w-5\" />\n                  <Badge className=\"absolute -top-1 -right-1 w-5 h-5 p-0 text-xs bg-primary text-primary-foreground\">\n                    3\n                  </Badge>\n                </Button>\n\n                {/* Messages - Hidden on small mobile */}\n                <Link href=\"/messages\" className=\"hidden sm:block\">\n                  <Button variant=\"ghost\" size=\"sm\" className=\"relative\" data-testid=\"button-messages\">\n                    <MessageCircle className=\"h-5 w-5\" />\n                  </Button>\n                </Link>\n\n                {/* User Menu */}\n                <DropdownMenu>\n                  <DropdownMenuTrigger asChild>\n                    <Button variant=\"ghost\" className=\"relative h-8 w-8 rounded-full\" data-testid=\"button-user-menu\">\n                      <Avatar className=\"h-8 w-8 border border-primary/30\">\n                        <AvatarImage src={user?.profileImageUrl} alt={user?.username} />\n                        <AvatarFallback className=\"bg-primary text-primary-foreground text-sm\">\n                          {user?.username?.charAt(0).toUpperCase()}\n                        </AvatarFallback>\n                      </Avatar>\n                    </Button>\n                  </DropdownMenuTrigger>\n                  <DropdownMenuContent className=\"w-56\" align=\"end\" forceMount>\n                    <DropdownMenuLabel className=\"font-normal\">\n                      <div className=\"flex flex-col space-y-1\">\n                        <div className=\"flex items-center gap-2\">\n                          <p className=\"text-sm font-medium leading-none\">{user?.username}</p>\n                          {primaryPack && (\n                            <Badge variant=\"outline\" className=\"text-[10px] px-1 py-0\" data-testid=\"user-pack-badge\">\n                              {primaryPack.name}\n                            </Badge>\n                          )}\n                        </div>\n                        <p className=\"text-xs leading-none text-muted\">{user?.email}</p>\n                        <div className=\"flex items-center space-x-1 pt-1\">\n                          <Badge className=\"safety-badge safety-badge-verified text-xs\">Verified</Badge>\n                          <Badge variant=\"outline\" className=\"text-xs\">{user?.role}</Badge>\n                        </div>\n                      </div>\n                    </DropdownMenuLabel>\n                    <DropdownMenuSeparator />\n                    <DropdownMenuItem asChild>\n                      <Link href={`/profile/${user?.id}`} className=\"w-full\" data-testid=\"menu-profile\">\n                        <User className=\"mr-2 h-4 w-4\" />\n                        <span>Profile</span>\n                      </Link>\n                    </DropdownMenuItem>\n                    {user?.role === 'creator' && (\n                      <DropdownMenuItem asChild>\n                        <Link href=\"/dashboard\" className=\"w-full\" data-testid=\"menu-dashboard\">\n                          <Star className=\"mr-2 h-4 w-4\" />\n                          <span>Dashboard</span>\n                        </Link>\n                      </DropdownMenuItem>\n                    )}\n                    <DropdownMenuItem asChild>\n                      <Link href=\"/settings\" className=\"w-full\" data-testid=\"menu-settings\">\n                        <Settings className=\"mr-2 h-4 w-4\" />\n                        <span>Settings</span>\n                      </Link>\n                    </DropdownMenuItem>\n                    <DropdownMenuSeparator />\n                    <DropdownMenuItem onClick={handleLogout} className=\"text-destructive\" data-testid=\"menu-logout\">\n                      <LogOut className=\"mr-2 h-4 w-4\" />\n                      <span>Log out</span>\n                    </DropdownMenuItem>\n                  </DropdownMenuContent>\n                </DropdownMenu>\n              </>\n            ) : (\n              <>\n                <Button \n                  variant=\"ghost\"\n                  size=\"sm\"\n                  className=\"hidden sm:flex\"\n                  onClick={() => onAuthClick?.('login')}\n                  data-testid=\"button-sign-in\"\n                >\n                  Sign In\n                </Button>\n                <Button \n                  className=\"btn-primary text-sm sm:text-base px-3 sm:px-4\"\n                  size=\"sm\"\n                  onClick={() => onAuthClick?.('register')}\n                  data-testid=\"button-join-pack\"\n                >\n                  <span className=\"hidden sm:inline\">Join Pack</span>\n                  <span className=\"sm:hidden\">Join</span>\n                </Button>\n              </>\n            )}\n\n            {/* Mobile Menu Button */}\n            <Button\n              variant=\"ghost\"\n              size=\"sm\"\n              className=\"md:hidden\"\n              onClick={() => setIsMobileMenuOpen(!isMobileMenuOpen)}\n              data-testid=\"button-mobile-menu\"\n            >\n              {isMobileMenuOpen ? <X className=\"h-5 w-5\" /> : <Menu className=\"h-5 w-5\" />}\n            </Button>\n          </div>\n        </div>\n\n        {/* Mobile Menu */}\n        {isMobileMenuOpen && (\n          <div className=\"md:hidden py-4 border-t border-border\">\n            {/* Mobile Search */}\n            <div className=\"mb-4\">\n              <div className=\"relative\">\n                <Search className=\"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted\" />\n                <input\n                  type=\"text\"\n                  placeholder=\"Search creators, packs...\"\n                  className=\"w-full pl-10 pr-4 py-2 bg-background border border-border rounded-lg focus:ring-2 focus:ring-primary focus:border-primary transition-colors text-foreground\"\n                  data-testid=\"input-mobile-search\"\n                />\n              </div>\n            </div>\n\n            {/* Mobile Navigation */}\n            <nav className=\"space-y-2\">\n              {navigation.map((item) => (\n                <Link\n                  key={item.name}\n                  href={item.href}\n                  className={`flex items-center space-x-3 px-3 py-2 rounded-lg text-muted hover:text-foreground hover:bg-card/50 transition-colors ${\n                    location === item.href ? 'text-foreground bg-card/50' : ''\n                  }`}\n                  onClick={() => setIsMobileMenuOpen(false)}\n                  data-testid={`mobile-nav-${item.name.toLowerCase()}`}\n                >\n                  <item.icon className=\"h-5 w-5\" />\n                  <span>{item.name}</span>\n                </Link>\n              ))}\n            </nav>\n\n            {/* Mobile Auth (if not authenticated) */}\n            {!isAuthenticated && (\n              <div className=\"mt-4 space-y-2\">\n                <Button \n                  variant=\"ghost\" \n                  className=\"w-full justify-start\"\n                  onClick={() => {\n                    onAuthClick?.('login');\n                    setIsMobileMenuOpen(false);\n                  }}\n                  data-testid=\"button-mobile-sign-in\"\n                >\n                  Sign In\n                </Button>\n                <Button \n                  className=\"w-full btn-primary\"\n                  onClick={() => {\n                    onAuthClick?.('register');\n                    setIsMobileMenuOpen(false);\n                  }}\n                  data-testid=\"button-mobile-join-pack\"\n                >\n                  Join Pack\n                </Button>\n              </div>\n            )}\n          </div>\n        )}\n      </div>\n    </header>\n  );\n}\n","size_bytes":11404},"server/distributionService.ts":{"content":"import { nanoid } from 'nanoid';\nimport { db } from './db';\nimport {\n  socialMediaAccounts,\n  distributionJobs,\n  qrCodes,\n  smartLinks,\n  content,\n  type SocialMediaAccount,\n  type DistributionJob,\n  type QrCode,\n  type SmartLink,\n} from '@shared/schema';\nimport { eq, and, desc, lte, or } from 'drizzle-orm';\n\n/**\n * Multi-Platform Distribution Service\n * \n * Handles:\n * - Social media account management\n * - Content distribution to external platforms\n * - QR code generation for content sharing\n * - Smart link creation and analytics\n * \n * Integration Points:\n * - Platform OAuth: Implement OAuth flows for each platform\n * - Platform APIs: Integrate with Twitter, Instagram, TikTok, etc.\n * - QR Generation: Integrate QR code generation library (e.g., qrcode)\n * - Link Shortening: Implement short code generation and redirect logic\n */\n\nexport interface DistributionOptions {\n  caption?: string;\n  scheduledFor?: Date;\n  platforms?: string[];\n  mediaUrls?: string[];\n}\n\nexport interface QRCodeOptions {\n  size?: number;\n  foregroundColor?: string;\n  backgroundColor?: string;\n  logo?: string;\n}\n\nexport interface SmartLinkOptions {\n  title?: string;\n  description?: string;\n  expiresAt?: Date;\n  metadata?: Record<string, any>;\n}\n\nclass DistributionService {\n  private schedulerInterval: NodeJS.Timeout | null = null;\n\n  constructor() {\n    // Start scheduler for scheduled distribution jobs\n    this.startScheduler();\n  }\n\n  /**\n   * Start the scheduler to process scheduled distribution jobs\n   */\n  private startScheduler(): void {\n    // Check for scheduled jobs every minute\n    this.schedulerInterval = setInterval(async () => {\n      try {\n        await this.processScheduledJobs();\n      } catch (error) {\n        console.error('Error processing scheduled jobs:', error);\n      }\n    }, 60000); // Every 60 seconds\n\n    console.log('[Distribution Service] Scheduler started');\n  }\n\n  /**\n   * Process scheduled distribution jobs that are due\n   */\n  private async processScheduledJobs(): Promise<void> {\n    const now = new Date();\n    \n    // Find scheduled jobs that are due\n    const dueJobs = await db.select()\n      .from(distributionJobs)\n      .where(and(\n        eq(distributionJobs.status, 'scheduled'),\n        lte(distributionJobs.scheduledFor, now)\n      ));\n\n    console.log(`[Distribution Service] Found ${dueJobs.length} scheduled jobs due for processing`);\n\n    // Process each due job\n    for (const job of dueJobs) {\n      // Update to queued first to prevent duplicate processing\n      await db.update(distributionJobs)\n        .set({ status: 'queued', updatedAt: new Date() })\n        .where(eq(distributionJobs.id, job.id));\n\n      // Process the job in background\n      this.processDistributionJob(job.id).catch(err => {\n        console.error(`Failed to process scheduled job ${job.id}:`, err);\n      });\n    }\n  }\n\n  /**\n   * Stop the scheduler (for cleanup)\n   */\n  stopScheduler(): void {\n    if (this.schedulerInterval) {\n      clearInterval(this.schedulerInterval);\n      this.schedulerInterval = null;\n      console.log('[Distribution Service] Scheduler stopped');\n    }\n  }\n\n  /**\n   * Connect a social media account for a creator\n   * TODO: Implement OAuth flow for each platform\n   * \n   * SECURITY WARNING: Token encryption must be implemented before production!\n   * Current implementation stores tokens in plaintext which is a critical security risk.\n   * Required steps:\n   * 1. Use libsodium/AES-GCM or similar for at-rest encryption\n   * 2. Source encryption keys from environment variables or KMS\n   * 3. Implement secure token rotation and refresh logic\n   * 4. Add token revocation via platform APIs on disconnect\n   */\n  async connectAccount(\n    creatorUserId: string,\n    platform: string,\n    credentials: {\n      platformUserId?: string;\n      platformUsername?: string;\n      accessToken: string;\n      refreshToken?: string;\n      tokenExpiresAt?: Date;\n    }\n  ): Promise<SocialMediaAccount> {\n    // TODO: Validate credentials with platform API\n    // TODO: CRITICAL - Encrypt access and refresh tokens before storage\n    \n    const [account] = await db.insert(socialMediaAccounts)\n      .values({\n        creatorUserId,\n        platform,\n        platformUserId: credentials.platformUserId,\n        platformUsername: credentials.platformUsername,\n        accessToken: credentials.accessToken, // TODO: Encrypt\n        refreshToken: credentials.refreshToken, // TODO: Encrypt\n        tokenExpiresAt: credentials.tokenExpiresAt,\n        status: 'connected',\n        lastSyncAt: new Date(),\n        metadata: {},\n      })\n      .returning();\n\n    return account;\n  }\n\n  /**\n   * Disconnect a social media account\n   */\n  async disconnectAccount(accountId: string, creatorUserId: string): Promise<boolean> {\n    // TODO: Revoke tokens with platform API\n    \n    const result = await db.update(socialMediaAccounts)\n      .set({ \n        status: 'revoked',\n        updatedAt: new Date(),\n      })\n      .where(and(\n        eq(socialMediaAccounts.id, accountId),\n        eq(socialMediaAccounts.creatorUserId, creatorUserId)\n      ))\n      .returning();\n\n    return result.length > 0;\n  }\n\n  /**\n   * Get all connected accounts for a creator\n   */\n  async getConnectedAccounts(creatorUserId: string): Promise<SocialMediaAccount[]> {\n    return db.select()\n      .from(socialMediaAccounts)\n      .where(eq(socialMediaAccounts.creatorUserId, creatorUserId))\n      .orderBy(desc(socialMediaAccounts.createdAt));\n  }\n\n  /**\n   * Distribute content to selected platforms\n   */\n  async distributeContent(\n    contentId: string,\n    creatorUserId: string,\n    options: DistributionOptions\n  ): Promise<DistributionJob[]> {\n    // Get content details\n    const [contentItem] = await db.select()\n      .from(content)\n      .where(and(\n        eq(content.id, contentId),\n        eq(content.creatorUserId, creatorUserId)\n      ));\n\n    if (!contentItem) {\n      throw new Error('Content not found or access denied');\n    }\n\n    // Get connected accounts\n    const accounts = await this.getConnectedAccounts(creatorUserId);\n    const activeAccounts = accounts.filter(acc => acc.status === 'connected');\n\n    if (activeAccounts.length === 0) {\n      throw new Error('No connected social media accounts found');\n    }\n\n    // Filter by requested platforms if specified\n    const targetAccounts = options.platforms\n      ? activeAccounts.filter(acc => options.platforms!.includes(acc.platform))\n      : activeAccounts;\n\n    if (targetAccounts.length === 0) {\n      throw new Error('No matching platforms found');\n    }\n\n    // Create distribution jobs for each platform\n    const jobs: DistributionJob[] = [];\n    for (const account of targetAccounts) {\n      const [job] = await db.insert(distributionJobs)\n        .values({\n          contentId,\n          creatorUserId,\n          socialMediaAccountId: account.id,\n          platform: account.platform,\n          status: options.scheduledFor ? 'scheduled' : 'queued',\n          scheduledFor: options.scheduledFor,\n          metadata: {\n            caption: options.caption || contentItem.caption,\n            mediaUrls: options.mediaUrls || [],\n          },\n        })\n        .returning();\n\n      jobs.push(job);\n\n      // If not scheduled, process immediately\n      if (!options.scheduledFor) {\n        // Don't await - process in background\n        this.processDistributionJob(job.id).catch(err => {\n          console.error(`Failed to process distribution job ${job.id}:`, err);\n        });\n      }\n    }\n\n    return jobs;\n  }\n\n  /**\n   * Process a distribution job\n   * TODO: Implement actual platform posting logic\n   */\n  private async processDistributionJob(jobId: string): Promise<void> {\n    // Update status to processing\n    await db.update(distributionJobs)\n      .set({ status: 'processing', updatedAt: new Date() })\n      .where(eq(distributionJobs.id, jobId));\n\n    try {\n      const [job] = await db.select()\n        .from(distributionJobs)\n        .where(eq(distributionJobs.id, jobId));\n\n      if (!job) {\n        throw new Error('Job not found');\n      }\n\n      const [account] = await db.select()\n        .from(socialMediaAccounts)\n        .where(eq(socialMediaAccounts.id, job.socialMediaAccountId));\n\n      if (!account) {\n        throw new Error('Account not found');\n      }\n\n      // TODO: Implement platform-specific posting logic\n      const platformPostId = await this.postToPlatform(account, job);\n\n      // Update job as published\n      await db.update(distributionJobs)\n        .set({\n          status: 'published',\n          publishedAt: new Date(),\n          platformPostId,\n          platformUrl: this.getPlatformUrl(account.platform, platformPostId),\n          updatedAt: new Date(),\n        })\n        .where(eq(distributionJobs.id, jobId));\n    } catch (error) {\n      // Update job as failed\n      // Get current retry count\n      const [currentJob] = await db.select()\n        .from(distributionJobs)\n        .where(eq(distributionJobs.id, jobId));\n\n      await db.update(distributionJobs)\n        .set({\n          status: 'failed',\n          errorMessage: error instanceof Error ? error.message : 'Unknown error',\n          retryCount: (currentJob?.retryCount || 0) + 1,\n          updatedAt: new Date(),\n        })\n        .where(eq(distributionJobs.id, jobId));\n\n      throw error;\n    }\n  }\n\n  /**\n   * Post content to a specific platform\n   * TODO: Implement actual API calls for each platform\n   */\n  private async postToPlatform(\n    account: SocialMediaAccount,\n    job: DistributionJob\n  ): Promise<string> {\n    const metadata = job.metadata as any;\n    const caption = metadata?.caption || '';\n    const mediaUrls = metadata?.mediaUrls || [];\n\n    // TODO: Implement platform-specific logic\n    switch (account.platform) {\n      case 'twitter':\n        // TODO: Use Twitter API v2 to post tweet\n        return `mock_tweet_${nanoid(8)}`;\n      \n      case 'instagram':\n        // TODO: Use Instagram Graph API to post\n        return `mock_insta_${nanoid(8)}`;\n      \n      case 'tiktok':\n        // TODO: Use TikTok API to post\n        return `mock_tiktok_${nanoid(8)}`;\n      \n      case 'onlyfans':\n        // TODO: Use OnlyFans API to post\n        return `mock_of_${nanoid(8)}`;\n      \n      case 'fansly':\n        // TODO: Use Fansly API to post\n        return `mock_fansly_${nanoid(8)}`;\n      \n      case 'reddit':\n        // TODO: Use Reddit API to post\n        return `mock_reddit_${nanoid(8)}`;\n      \n      default:\n        throw new Error(`Unsupported platform: ${account.platform}`);\n    }\n  }\n\n  /**\n   * Get platform-specific URL for a post\n   */\n  private getPlatformUrl(platform: string, postId: string): string {\n    // TODO: Generate actual platform URLs\n    const urlMap: Record<string, string> = {\n      twitter: `https://twitter.com/i/status/${postId}`,\n      instagram: `https://instagram.com/p/${postId}`,\n      tiktok: `https://tiktok.com/@user/video/${postId}`,\n      onlyfans: `https://onlyfans.com/post/${postId}`,\n      fansly: `https://fansly.com/post/${postId}`,\n      reddit: `https://reddit.com/comments/${postId}`,\n    };\n\n    return urlMap[platform] || `https://${platform}.com/${postId}`;\n  }\n\n  /**\n   * Get distribution jobs for content\n   */\n  async getContentDistributionJobs(\n    contentId: string,\n    creatorUserId: string\n  ): Promise<DistributionJob[]> {\n    return db.select()\n      .from(distributionJobs)\n      .where(and(\n        eq(distributionJobs.contentId, contentId),\n        eq(distributionJobs.creatorUserId, creatorUserId)\n      ))\n      .orderBy(desc(distributionJobs.createdAt));\n  }\n\n  /**\n   * Cancel a distribution job\n   */\n  async cancelDistributionJob(jobId: string, creatorUserId: string): Promise<boolean> {\n    const result = await db.update(distributionJobs)\n      .set({\n        status: 'cancelled',\n        updatedAt: new Date(),\n      })\n      .where(and(\n        eq(distributionJobs.id, jobId),\n        eq(distributionJobs.creatorUserId, creatorUserId),\n        or(\n          eq(distributionJobs.status, 'queued'),\n          eq(distributionJobs.status, 'scheduled')\n        )\n      ))\n      .returning();\n\n    return result.length > 0;\n  }\n\n  /**\n   * Generate QR code for content\n   * TODO: Implement actual QR code generation\n   */\n  async generateQRCode(\n    creatorUserId: string,\n    targetType: 'content' | 'profile' | 'subscription' | 'custom',\n    targetUrl: string,\n    contentId?: string,\n    options: QRCodeOptions = {}\n  ): Promise<QrCode> {\n    // TODO: Generate QR code image using qrcode library\n    // TODO: Upload to object storage\n    // TODO: Apply branding/styling from options\n    \n    const qrCodeImagePath = `/qr-codes/${nanoid()}.png`; // Mock path\n\n    const [qrCode] = await db.insert(qrCodes)\n      .values({\n        creatorUserId,\n        contentId,\n        targetType,\n        targetUrl,\n        qrCodeImagePath,\n        metadata: options,\n      })\n      .returning();\n\n    return qrCode;\n  }\n\n  /**\n   * Track QR code scan\n   */\n  async trackQRCodeScan(qrCodeId: string): Promise<void> {\n    // Get current count\n    const [currentQR] = await db.select()\n      .from(qrCodes)\n      .where(eq(qrCodes.id, qrCodeId));\n\n    if (currentQR) {\n      await db.update(qrCodes)\n        .set({\n          scanCount: (currentQR.scanCount || 0) + 1,\n          lastScannedAt: new Date(),\n          updatedAt: new Date(),\n        })\n        .where(eq(qrCodes.id, qrCodeId));\n    }\n  }\n\n  /**\n   * Get QR codes for creator\n   */\n  async getCreatorQRCodes(creatorUserId: string): Promise<QrCode[]> {\n    return db.select()\n      .from(qrCodes)\n      .where(eq(qrCodes.creatorUserId, creatorUserId))\n      .orderBy(desc(qrCodes.createdAt));\n  }\n\n  /**\n   * Create smart link\n   */\n  async createSmartLink(\n    creatorUserId: string,\n    targetUrl: string,\n    contentId?: string,\n    options: SmartLinkOptions = {}\n  ): Promise<SmartLink> {\n    const shortCode = nanoid(8);\n\n    const [link] = await db.insert(smartLinks)\n      .values({\n        creatorUserId,\n        contentId,\n        shortCode,\n        targetUrl,\n        title: options.title,\n        description: options.description,\n        expiresAt: options.expiresAt,\n        metadata: options.metadata || {},\n      })\n      .returning();\n\n    return link;\n  }\n\n  /**\n   * Track smart link click\n   */\n  async trackLinkClick(shortCode: string, uniqueVisitor: boolean = false): Promise<SmartLink | null> {\n    const [link] = await db.select()\n      .from(smartLinks)\n      .where(eq(smartLinks.shortCode, shortCode));\n\n    if (!link) {\n      return null;\n    }\n\n    // Check if expired\n    if (link.expiresAt && new Date(link.expiresAt) < new Date()) {\n      await db.update(smartLinks)\n        .set({ status: 'expired', updatedAt: new Date() })\n        .where(eq(smartLinks.id, link.id));\n      return null;\n    }\n\n    // Update click counts\n    await db.update(smartLinks)\n      .set({\n        clickCount: (link.clickCount || 0) + 1,\n        uniqueClickCount: uniqueVisitor ? (link.uniqueClickCount || 0) + 1 : link.uniqueClickCount,\n        lastClickedAt: new Date(),\n        updatedAt: new Date(),\n      })\n      .where(eq(smartLinks.id, link.id));\n\n    return link;\n  }\n\n  /**\n   * Get smart links for creator\n   */\n  async getCreatorSmartLinks(creatorUserId: string): Promise<SmartLink[]> {\n    return db.select()\n      .from(smartLinks)\n      .where(eq(smartLinks.creatorUserId, creatorUserId))\n      .orderBy(desc(smartLinks.createdAt));\n  }\n\n  /**\n   * Get smart link analytics\n   */\n  async getSmartLinkAnalytics(linkId: string, creatorUserId: string): Promise<SmartLink | null> {\n    const [link] = await db.select()\n      .from(smartLinks)\n      .where(and(\n        eq(smartLinks.id, linkId),\n        eq(smartLinks.creatorUserId, creatorUserId)\n      ));\n\n    return link || null;\n  }\n}\n\nexport const distributionService = new DistributionService();\n","size_bytes":15846},"server/voiceCloningService.ts":{"content":"import { db } from './db';\nimport {\n  voiceModels,\n  voiceMessages,\n  voiceAutomation,\n  voiceMessageQueue,\n  type InsertVoiceModel,\n  type InsertVoiceMessage,\n  type InsertVoiceAutomation,\n  type VoiceModel,\n  type VoiceMessage,\n  type VoiceAutomation,\n} from '@shared/schema';\nimport { eq, and, desc, sql } from 'drizzle-orm';\nimport { nanoid } from 'nanoid';\n\nexport class VoiceCloningService {\n  async createVoiceModel(creatorId: string, data: Omit<InsertVoiceModel, 'creatorId'>): Promise<VoiceModel> {\n    const [model] = await db.insert(voiceModels).values({\n      ...data,\n      creatorId,\n      status: 'training',\n    }).returning();\n\n    this.simulateTraining(model.id).catch(err => {\n      console.error(`Voice model training failed for ${model.id}:`, err);\n    });\n\n    return model;\n  }\n\n  private async simulateTraining(modelId: string): Promise<void> {\n    await new Promise(resolve => setTimeout(resolve, 3000));\n\n    await db\n      .update(voiceModels)\n      .set({ \n        status: 'ready',\n        modelId: `vm_${nanoid(16)}`,\n        updatedAt: new Date(),\n      })\n      .where(eq(voiceModels.id, modelId));\n  }\n\n  async getVoiceModel(modelId: string): Promise<VoiceModel | undefined> {\n    const [model] = await db\n      .select()\n      .from(voiceModels)\n      .where(eq(voiceModels.id, modelId));\n    \n    return model;\n  }\n\n  async getCreatorVoiceModels(creatorId: string): Promise<VoiceModel[]> {\n    return await db\n      .select()\n      .from(voiceModels)\n      .where(eq(voiceModels.creatorId, creatorId))\n      .orderBy(desc(voiceModels.createdAt));\n  }\n\n  async updateVoiceModel(modelId: string, updates: Partial<VoiceModel>): Promise<void> {\n    await db\n      .update(voiceModels)\n      .set({ ...updates, updatedAt: new Date() })\n      .where(eq(voiceModels.id, modelId));\n  }\n\n  async deleteVoiceModel(modelId: string): Promise<void> {\n    await db\n      .update(voiceModels)\n      .set({ isActive: false, updatedAt: new Date() })\n      .where(eq(voiceModels.id, modelId));\n  }\n\n  async createVoiceMessage(data: InsertVoiceMessage): Promise<VoiceMessage> {\n    const [message] = await db.insert(voiceMessages).values({\n      ...data,\n      status: 'pending',\n    }).returning();\n\n    await db.insert(voiceMessageQueue).values({\n      voiceMessageId: message.id,\n      priority: data.messageType === 'dm' ? 8 : 5,\n      status: 'queued',\n    });\n\n    this.processMessageQueue().catch(err => {\n      console.error('Voice message queue processing error:', err);\n    });\n\n    return message;\n  }\n\n  async generateVoiceMessage(messageId: string): Promise<void> {\n    const [message] = await db\n      .select()\n      .from(voiceMessages)\n      .where(eq(voiceMessages.id, messageId));\n\n    if (!message) {\n      throw new Error('Voice message not found');\n    }\n\n    await db\n      .update(voiceMessages)\n      .set({ status: 'generating' })\n      .where(eq(voiceMessages.id, messageId));\n\n    try {\n      const audioUrl = await this.simulateVoiceGeneration(\n        message.voiceModelId,\n        message.scriptText,\n        message.metadata\n      );\n\n      const duration = Math.floor(message.scriptText.length / 15);\n\n      await db\n        .update(voiceMessages)\n        .set({\n          status: 'ready',\n          audioUrl,\n          duration,\n        })\n        .where(eq(voiceMessages.id, messageId));\n\n      await db\n        .update(voiceModels)\n        .set({\n          usageCount: sql`${voiceModels.usageCount} + 1`,\n          totalDuration: sql`${voiceModels.totalDuration} + ${duration}`,\n        })\n        .where(eq(voiceModels.id, message.voiceModelId));\n\n    } catch (error) {\n      await db\n        .update(voiceMessages)\n        .set({\n          status: 'failed',\n          error: error instanceof Error ? error.message : 'Generation failed',\n        })\n        .where(eq(voiceMessages.id, messageId));\n      throw error;\n    }\n  }\n\n  private async simulateVoiceGeneration(\n    modelId: string,\n    scriptText: string,\n    metadata: any\n  ): Promise<string> {\n    await new Promise(resolve => setTimeout(resolve, 2000));\n\n    let personalizedText = scriptText;\n    if (metadata && typeof metadata === 'object') {\n      Object.keys(metadata).forEach(key => {\n        personalizedText = personalizedText.replace(\n          new RegExp(`{${key}}`, 'g'),\n          metadata[key]\n        );\n      });\n    }\n\n    return `/voice-messages/${modelId}/${nanoid(16)}.mp3`;\n  }\n\n  async getVoiceMessage(messageId: string): Promise<VoiceMessage | undefined> {\n    const [message] = await db\n      .select()\n      .from(voiceMessages)\n      .where(eq(voiceMessages.id, messageId));\n    \n    return message;\n  }\n\n  async getCreatorVoiceMessages(creatorId: string): Promise<VoiceMessage[]> {\n    return await db\n      .select()\n      .from(voiceMessages)\n      .where(eq(voiceMessages.creatorId, creatorId))\n      .orderBy(desc(voiceMessages.createdAt));\n  }\n\n  async getRecipientVoiceMessages(recipientId: string): Promise<VoiceMessage[]> {\n    return await db\n      .select()\n      .from(voiceMessages)\n      .where(eq(voiceMessages.recipientId, recipientId))\n      .orderBy(desc(voiceMessages.createdAt));\n  }\n\n  async createAutomation(data: InsertVoiceAutomation): Promise<VoiceAutomation> {\n    const [automation] = await db.insert(voiceAutomation).values(data).returning();\n    return automation;\n  }\n\n  async getAutomation(automationId: string): Promise<VoiceAutomation | undefined> {\n    const [automation] = await db\n      .select()\n      .from(voiceAutomation)\n      .where(eq(voiceAutomation.id, automationId));\n    \n    return automation;\n  }\n\n  async getCreatorAutomations(creatorId: string): Promise<VoiceAutomation[]> {\n    return await db\n      .select()\n      .from(voiceAutomation)\n      .where(eq(voiceAutomation.creatorId, creatorId))\n      .orderBy(desc(voiceAutomation.createdAt));\n  }\n\n  async toggleAutomation(automationId: string, isActive: boolean): Promise<void> {\n    await db\n      .update(voiceAutomation)\n      .set({ isActive, updatedAt: new Date() })\n      .where(eq(voiceAutomation.id, automationId));\n  }\n\n  async triggerAutomation(\n    triggerType: string,\n    creatorId: string,\n    recipientId: string,\n    context: Record<string, any>\n  ): Promise<void> {\n    const automations = await db\n      .select()\n      .from(voiceAutomation)\n      .where(\n        and(\n          eq(voiceAutomation.creatorId, creatorId),\n          eq(voiceAutomation.triggerType, triggerType as any),\n          eq(voiceAutomation.isActive, true)\n        )\n      );\n\n    for (const automation of automations) {\n      if (triggerType === 'tip_received' && automation.minTipAmount) {\n        const tipAmount = parseFloat(context.amount || '0');\n        const minAmount = parseFloat(automation.minTipAmount);\n        if (tipAmount < minAmount) {\n          continue;\n        }\n      }\n\n      let scriptText = automation.scriptTemplate;\n      Object.keys(context).forEach(key => {\n        scriptText = scriptText.replace(new RegExp(`{${key}}`, 'g'), context[key]);\n      });\n\n      await this.createVoiceMessage({\n        voiceModelId: automation.voiceModelId,\n        creatorId,\n        recipientId,\n        messageType: 'dm',\n        scriptText,\n        metadata: context,\n      });\n\n      await db\n        .update(voiceAutomation)\n        .set({ usageCount: sql`${voiceAutomation.usageCount} + 1` })\n        .where(eq(voiceAutomation.id, automation.id));\n    }\n  }\n\n  private async processMessageQueue(): Promise<void> {\n    const queuedMessages = await db\n      .select()\n      .from(voiceMessageQueue)\n      .where(eq(voiceMessageQueue.status, 'queued'))\n      .orderBy(desc(voiceMessageQueue.priority), voiceMessageQueue.scheduledFor)\n      .limit(10);\n\n    for (const queueItem of queuedMessages) {\n      try {\n        await db\n          .update(voiceMessageQueue)\n          .set({ status: 'processing' })\n          .where(eq(voiceMessageQueue.id, queueItem.id));\n\n        await this.generateVoiceMessage(queueItem.voiceMessageId);\n\n        await db\n          .update(voiceMessageQueue)\n          .set({ status: 'completed' })\n          .where(eq(voiceMessageQueue.id, queueItem.id));\n\n      } catch (error) {\n        console.error(`Queue processing error for ${queueItem.id}:`, error);\n        \n        await db\n          .update(voiceMessageQueue)\n          .set({\n            status: 'failed',\n            attempts: sql`${voiceMessageQueue.attempts} + 1`,\n            lastAttempt: new Date(),\n          })\n          .where(eq(voiceMessageQueue.id, queueItem.id));\n      }\n    }\n  }\n\n  async bulkCreateMessages(\n    creatorId: string,\n    voiceModelId: string,\n    recipients: { id: string; name: string }[],\n    scriptTemplate: string\n  ): Promise<VoiceMessage[]> {\n    const messages: VoiceMessage[] = [];\n\n    for (const recipient of recipients) {\n      const scriptText = scriptTemplate.replace(/{fanName}/g, recipient.name);\n\n      const message = await this.createVoiceMessage({\n        voiceModelId,\n        creatorId,\n        recipientId: recipient.id,\n        messageType: 'bulk',\n        scriptText,\n        metadata: { fanName: recipient.name },\n      });\n\n      messages.push(message);\n    }\n\n    return messages;\n  }\n\n  async getQueueStatus() {\n    const stats = await db\n      .select({\n        status: voiceMessageQueue.status,\n        count: sql<number>`count(*)`,\n      })\n      .from(voiceMessageQueue)\n      .groupBy(voiceMessageQueue.status);\n\n    return stats.reduce((acc, stat) => {\n      if (stat.status) {\n        acc[stat.status] = Number(stat.count);\n      }\n      return acc;\n    }, {} as Record<string, number>);\n  }\n}\n\nexport const voiceCloningService = new VoiceCloningService();\n","size_bytes":9657},"client/src/components/safety/AgeVerification.tsx":{"content":"import { useState } from \"react\";\nimport { useMutation, useQuery, useQueryClient } from \"@tanstack/react-query\";\nimport { useAuth } from \"@/hooks/useAuth\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { isUnauthorizedError } from \"@/lib/authUtils\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { ObjectUploader } from \"@/components/ObjectUploader\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Progress } from \"@/components/ui/progress\";\nimport { Alert, AlertDescription } from \"@/components/ui/alert\";\nimport { \n  Shield, \n  Upload, \n  Check, \n  AlertTriangle, \n  Clock,\n  FileText,\n  Camera,\n  Loader2\n} from \"lucide-react\";\n\nexport default function AgeVerification() {\n  const { user } = useAuth();\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n  const [verificationStep, setVerificationStep] = useState(1);\n  const [uploadedDocUrl, setUploadedDocUrl] = useState<string | null>(null);\n  const [docType, setDocType] = useState(\"\");\n\n  const { data: profile } = useQuery({\n    queryKey: ['/api/profile', user?.id],\n    enabled: !!user?.id,\n  });\n\n  const uploadMutation = useMutation({\n    mutationFn: async () => {\n      const response = await apiRequest('POST', '/api/objects/upload');\n      return response.json();\n    },\n    onError: (error) => {\n      if (isUnauthorizedError(error as Error)) {\n        toast({\n          title: \"Unauthorized\",\n          description: \"You are logged out. Logging in again...\",\n          variant: \"destructive\",\n        });\n        setTimeout(() => {\n          window.location.href = \"/api/login\";\n        }, 500);\n        return;\n      }\n      toast({\n        title: \"Upload Error\",\n        description: \"Failed to get upload URL. Please try again.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const submitVerificationMutation = useMutation({\n    mutationFn: async (data: { docType: string; documentPath: string }) => {\n      await apiRequest('POST', '/api/kyc/verify', data);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['/api/profile'] });\n      toast({\n        title: \"Verification Submitted!\",\n        description: \"Your age verification documents have been submitted for review.\",\n      });\n      setVerificationStep(4);\n    },\n    onError: (error) => {\n      if (isUnauthorizedError(error as Error)) {\n        toast({\n          title: \"Unauthorized\",\n          description: \"You are logged out. Logging in again...\",\n          variant: \"destructive\",\n        });\n        setTimeout(() => {\n          window.location.href = \"/api/login\";\n        }, 500);\n        return;\n      }\n      toast({\n        title: \"Verification Failed\",\n        description: \"Failed to submit verification. Please try again.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const handleGetUploadParameters = async () => {\n    const result = await uploadMutation.mutateAsync();\n    return {\n      method: 'PUT' as const,\n      url: result.uploadURL,\n    };\n  };\n\n  const handleUploadComplete = async (result: any) => {\n    if (result.successful?.length > 0) {\n      const uploadUrl = result.successful[0].uploadURL;\n      setUploadedDocUrl(uploadUrl);\n      \n      try {\n        await apiRequest('PUT', '/api/media-upload', {\n          mediaUrl: uploadUrl\n        });\n        toast({\n          title: \"Document Uploaded!\",\n          description: \"ID document uploaded successfully.\",\n        });\n        setVerificationStep(3);\n      } catch (error) {\n        toast({\n          title: \"Error\",\n          description: \"Document uploaded but failed to set permissions.\",\n          variant: \"destructive\",\n        });\n      }\n    }\n  };\n\n  const handleSubmitVerification = () => {\n    if (!uploadedDocUrl || !docType) {\n      toast({\n        title: \"Missing Information\",\n        description: \"Please select document type and upload your ID.\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    submitVerificationMutation.mutate({\n      docType,\n      documentPath: uploadedDocUrl,\n    });\n  };\n\n  const getVerificationStatus = () => {\n    if (profile?.profile?.ageVerified) return \"verified\";\n    if (profile?.profile?.kycStatus === \"pending\") return \"pending\";\n    return \"not_started\";\n  };\n\n  const status = getVerificationStatus();\n\n  const renderVerificationStep = () => {\n    switch (verificationStep) {\n      case 1:\n        return (\n          <div className=\"space-y-6\">\n            <div className=\"text-center\">\n              <Shield className=\"h-12 w-12 text-warning mx-auto mb-4\" />\n              <h3 className=\"font-semibold text-xl mb-2\">Age Verification Required</h3>\n              <p className=\"text-muted max-w-md mx-auto\">\n                To comply with adult content regulations, we need to verify that you are 18 years of age or older.\n              </p>\n            </div>\n\n            <Alert>\n              <AlertTriangle className=\"h-4 w-4\" />\n              <AlertDescription>\n                This is a one-time verification process. Your documents are encrypted and stored securely according to 18 U.S.C. Â§2257 requirements.\n              </AlertDescription>\n            </Alert>\n\n            <div className=\"space-y-4\">\n              <h4 className=\"font-medium\">What you'll need:</h4>\n              <div className=\"grid md:grid-cols-3 gap-4 text-sm\">\n                <div className=\"flex items-center space-x-3 p-3 bg-background rounded-lg border border-border\">\n                  <FileText className=\"h-5 w-5 text-secondary\" />\n                  <div>\n                    <p className=\"font-medium\">Government ID</p>\n                    <p className=\"text-muted\">Driver's license, passport, or state ID</p>\n                  </div>\n                </div>\n                <div className=\"flex items-center space-x-3 p-3 bg-background rounded-lg border border-border\">\n                  <Camera className=\"h-5 w-5 text-accent\" />\n                  <div>\n                    <p className=\"font-medium\">Clear Photo</p>\n                    <p className=\"text-muted\">Well-lit, legible document image</p>\n                  </div>\n                </div>\n                <div className=\"flex items-center space-x-3 p-3 bg-background rounded-lg border border-border\">\n                  <Clock className=\"h-5 w-5 text-success\" />\n                  <div>\n                    <p className=\"font-medium\">Quick Process</p>\n                    <p className=\"text-muted\">Usually verified within 24 hours</p>\n                  </div>\n                </div>\n              </div>\n            </div>\n\n            <Button \n              className=\"w-full btn-primary\"\n              onClick={() => setVerificationStep(2)}\n              data-testid=\"button-start-verification\"\n            >\n              Start Verification Process\n            </Button>\n          </div>\n        );\n\n      case 2:\n        return (\n          <div className=\"space-y-6\">\n            <div className=\"text-center\">\n              <Upload className=\"h-8 w-8 text-primary mx-auto mb-4\" />\n              <h3 className=\"font-semibold text-lg mb-2\">Upload Your ID Document</h3>\n              <p className=\"text-muted\">Select your document type and upload a clear photo</p>\n            </div>\n\n            <div>\n              <Label htmlFor=\"docType\">Document Type</Label>\n              <Select value={docType} onValueChange={setDocType}>\n                <SelectTrigger className=\"form-select\" data-testid=\"select-document-type\">\n                  <SelectValue placeholder=\"Select document type\" />\n                </SelectTrigger>\n                <SelectContent>\n                  <SelectItem value=\"drivers_license\">Driver's License</SelectItem>\n                  <SelectItem value=\"passport\">Passport</SelectItem>\n                  <SelectItem value=\"state_id\">State ID</SelectItem>\n                </SelectContent>\n              </Select>\n            </div>\n\n            <div className=\"border-2 border-dashed border-border rounded-xl p-8 text-center\">\n              <ObjectUploader\n                maxNumberOfFiles={1}\n                maxFileSize={10485760} // 10MB\n                onGetUploadParameters={handleGetUploadParameters}\n                onComplete={handleUploadComplete}\n                buttonClassName=\"btn-primary\"\n              >\n                <Upload className=\"h-5 w-5 mr-2\" />\n                Upload ID Document\n              </ObjectUploader>\n              <p className=\"text-xs text-muted mt-4\">\n                JPG, PNG up to 10MB â€¢ Document must be clearly visible and legible\n              </p>\n            </div>\n\n            <Alert>\n              <Shield className=\"h-4 w-4\" />\n              <AlertDescription>\n                Your document will be encrypted and stored securely. We only use this information for age verification purposes.\n              </AlertDescription>\n            </Alert>\n          </div>\n        );\n\n      case 3:\n        return (\n          <div className=\"space-y-6\">\n            <div className=\"text-center\">\n              <Check className=\"h-8 w-8 text-success mx-auto mb-4\" />\n              <h3 className=\"font-semibold text-lg mb-2\">Document Uploaded Successfully</h3>\n              <p className=\"text-muted\">Review your information and submit for verification</p>\n            </div>\n\n            <div className=\"space-y-4\">\n              <div className=\"flex items-center justify-between p-4 bg-background rounded-lg border border-border\">\n                <span>Document Type</span>\n                <Badge variant=\"outline\">\n                  {docType === 'drivers_license' ? \"Driver's License\" : \n                   docType === 'passport' ? \"Passport\" : \"State ID\"}\n                </Badge>\n              </div>\n              \n              <div className=\"flex items-center justify-between p-4 bg-background rounded-lg border border-border\">\n                <span>Upload Status</span>\n                <Badge className=\"safety-badge safety-badge-verified\">\n                  <Check className=\"h-3 w-3 mr-1\" />\n                  Uploaded\n                </Badge>\n              </div>\n            </div>\n\n            <Alert>\n              <AlertTriangle className=\"h-4 w-4\" />\n              <AlertDescription>\n                Once submitted, your verification will be reviewed by our compliance team within 24-48 hours.\n              </AlertDescription>\n            </Alert>\n\n            <div className=\"flex space-x-3\">\n              <Button \n                variant=\"outline\" \n                className=\"flex-1\"\n                onClick={() => setVerificationStep(2)}\n                data-testid=\"button-upload-different\"\n              >\n                Upload Different Document\n              </Button>\n              <Button \n                className=\"flex-1 btn-primary\"\n                onClick={handleSubmitVerification}\n                disabled={submitVerificationMutation.isPending}\n                data-testid=\"button-submit-verification\"\n              >\n                {submitVerificationMutation.isPending ? (\n                  <>\n                    <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />\n                    Submitting...\n                  </>\n                ) : (\n                  'Submit for Verification'\n                )}\n              </Button>\n            </div>\n          </div>\n        );\n\n      case 4:\n        return (\n          <div className=\"space-y-6 text-center\">\n            <Clock className=\"h-12 w-12 text-secondary mx-auto mb-4\" />\n            <h3 className=\"font-semibold text-xl mb-2\">Verification Submitted</h3>\n            <p className=\"text-muted max-w-md mx-auto\">\n              Your age verification has been submitted and is being reviewed by our compliance team.\n            </p>\n            \n            <div className=\"p-4 bg-secondary/10 border border-secondary/20 rounded-lg\">\n              <p className=\"font-medium text-secondary mb-2\">What happens next?</p>\n              <div className=\"text-sm text-muted space-y-1\">\n                <p>â€¢ Our team will review your documents within 24-48 hours</p>\n                <p>â€¢ You'll receive an email notification when complete</p>\n                <p>â€¢ Your account will be automatically updated</p>\n              </div>\n            </div>\n\n            <Button \n              variant=\"outline\"\n              onClick={() => window.location.reload()}\n              data-testid=\"button-refresh-status\"\n            >\n              Check Status\n            </Button>\n          </div>\n        );\n\n      default:\n        return null;\n    }\n  };\n\n  return (\n    <Card className=\"pack-card\">\n      <CardHeader>\n        <CardTitle className=\"flex items-center justify-between\">\n          <div className=\"flex items-center\">\n            <Shield className=\"mr-2 h-5 w-5\" />\n            Age Verification\n          </div>\n          <Badge \n            className={\n              status === 'verified' ? 'safety-badge safety-badge-verified' :\n              status === 'pending' ? 'bg-warning/20 text-warning' :\n              'bg-muted/20 text-muted'\n            }\n          >\n            {status === 'verified' ? (\n              <>\n                <Check className=\"mr-1 h-3 w-3\" />\n                Verified\n              </>\n            ) : status === 'pending' ? (\n              <>\n                <Clock className=\"mr-1 h-3 w-3\" />\n                Pending Review\n              </>\n            ) : (\n              <>\n                <AlertTriangle className=\"mr-1 h-3 w-3\" />\n                Required\n              </>\n            )}\n          </Badge>\n        </CardTitle>\n      </CardHeader>\n      <CardContent>\n        {status === 'verified' ? (\n          <div className=\"text-center py-6\">\n            <Check className=\"h-12 w-12 text-success mx-auto mb-4\" />\n            <h3 className=\"font-semibold text-lg mb-2\">Age Verification Complete</h3>\n            <p className=\"text-muted\">Your account has been verified and you can access all platform features.</p>\n            <div className=\"mt-4 p-3 bg-success/10 border border-success/20 rounded-lg\">\n              <p className=\"text-sm text-success\">\n                âœ“ 18+ Age Verified â€¢ Compliant with 18 U.S.C. Â§2257\n              </p>\n            </div>\n          </div>\n        ) : status === 'pending' ? (\n          <div className=\"text-center py-6\">\n            <Clock className=\"h-12 w-12 text-secondary mx-auto mb-4\" />\n            <h3 className=\"font-semibold text-lg mb-2\">Verification In Progress</h3>\n            <p className=\"text-muted mb-4\">\n              Your documents are being reviewed by our compliance team.\n            </p>\n            <Progress value={75} className=\"mb-4\" />\n            <p className=\"text-sm text-muted\">\n              Expected completion: Within 24-48 hours\n            </p>\n          </div>\n        ) : (\n          renderVerificationStep()\n        )}\n      </CardContent>\n    </Card>\n  );\n}\n","size_bytes":15203},"client/src/components/ui/hover-card.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as HoverCardPrimitive from \"@radix-ui/react-hover-card\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst HoverCard = HoverCardPrimitive.Root\n\nconst HoverCardTrigger = HoverCardPrimitive.Trigger\n\nconst HoverCardContent = React.forwardRef<\n  React.ElementRef<typeof HoverCardPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof HoverCardPrimitive.Content>\n>(({ className, align = \"center\", sideOffset = 4, ...props }, ref) => (\n  <HoverCardPrimitive.Content\n    ref={ref}\n    align={align}\n    sideOffset={sideOffset}\n    className={cn(\n      \"z-50 w-64 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-hover-card-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nHoverCardContent.displayName = HoverCardPrimitive.Content.displayName\n\nexport { HoverCard, HoverCardTrigger, HoverCardContent }\n","size_bytes":1251},"client/src/pages/CreatorDashboard.tsx":{"content":"import { useState } from 'react';\nimport { useQuery, useMutation } from '@tanstack/react-query';\nimport { queryClient, apiRequest } from '@/lib/queryClient';\nimport { Button } from '@/components/ui/button';\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs';\nimport { Badge } from '@/components/ui/badge';\nimport { Separator } from '@/components/ui/separator';\nimport { Switch } from '@/components/ui/switch';\nimport { Label } from '@/components/ui/label';\nimport { Textarea } from '@/components/ui/textarea';\nimport { Input } from '@/components/ui/input';\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';\nimport { useToast } from '@/hooks/use-toast';\nimport { \n  Upload, Zap, Settings, TrendingUp, Send, Calendar, Users, Video,\n  Sparkles, Target, BarChart3, Plus, Play, Edit3, CheckCircle2, XCircle\n} from 'lucide-react';\n\ninterface Content {\n  id: string;\n  title: string;\n  description: string;\n  creatorUserId: string;\n  accessLevel: string;\n  price: string;\n  status: string;\n  createdAt: string;\n}\n\ninterface SocialMediaAccount {\n  id: string;\n  platform: string;\n  platformUsername: string;\n  status: string;\n}\n\nexport default function CreatorDashboard() {\n  const { toast } = useToast();\n  const [selectedContent, setSelectedContent] = useState<string | null>(null);\n  const [customCaption, setCustomCaption] = useState('');\n  const [selectedPlatforms, setSelectedPlatforms] = useState<string[]>([]);\n  const [autoEdit, setAutoEdit] = useState(true);\n  const [aspectRatios, setAspectRatios] = useState(['9:16', '16:9', '1:1']);\n  const [generateGif, setGenerateGif] = useState(true);\n  const [scheduleFor, setScheduleFor] = useState('');\n\n  // Fetch creator's content\n  const { data: content = [] } = useQuery<Content[]>({\n    queryKey: ['/api/content'],\n  });\n\n  // Fetch connected social accounts\n  const { data: accounts = [] } = useQuery<SocialMediaAccount[]>({\n    queryKey: ['/api/distribution/accounts'],\n  });\n\n  // One-tap publish mutation\n  const publishMutation = useMutation({\n    mutationFn: async (data: {\n      contentId: string;\n      platforms?: string[];\n      customCaption?: string;\n      autoEdit?: boolean;\n      aspectRatios?: string[];\n      generateGif?: boolean;\n      scheduledFor?: string;\n    }) => {\n      return await apiRequest('/api/dashboard/quick-publish', 'POST', data);\n    },\n    onSuccess: () => {\n      toast({\n        title: \"Content Published!\",\n        description: \"Your content is being distributed to selected platforms.\",\n      });\n      queryClient.invalidateQueries({ queryKey: ['/api/distribution/jobs'] });\n    },\n    onError: (error: Error) => {\n      toast({\n        title: \"Publishing Failed\",\n        description: error.message,\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  // Content processing mutation\n  const processMutation = useMutation({\n    mutationFn: async (data: {\n      contentId: string;\n      operations: string[];\n      aspectRatios?: string[];\n      gifDuration?: number;\n      trailerDuration?: number;\n    }) => {\n      return await apiRequest('/api/content-processing/jobs', 'POST', data);\n    },\n    onSuccess: () => {\n      toast({\n        title: \"Processing Started\",\n        description: \"Your content is being processed. You'll be notified when complete.\",\n      });\n    },\n  });\n\n  const handleQuickPublish = () => {\n    if (!selectedContent) {\n      toast({\n        title: \"No Content Selected\",\n        description: \"Please select content to publish.\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    publishMutation.mutate({\n      contentId: selectedContent,\n      platforms: selectedPlatforms.length > 0 ? selectedPlatforms : undefined,\n      customCaption: customCaption || undefined,\n      autoEdit,\n      aspectRatios,\n      generateGif,\n      scheduledFor: scheduleFor || undefined,\n    });\n  };\n\n  const connectedPlatforms = accounts.filter(a => a.status === 'connected');\n  const isPending = publishMutation.isPending || processMutation.isPending;\n\n  return (\n    <div className=\"min-h-screen bg-background p-4 md:p-8\">\n      <div className=\"mx-auto max-w-7xl space-y-8\">\n        {/* Header */}\n        <div className=\"flex items-center justify-between\">\n          <div>\n            <h1 className=\"text-3xl font-bold tracking-tight\">Creator Control Center</h1>\n            <p className=\"text-muted-foreground mt-2\">\n              One-tap publishing, content processing, and campaign management\n            </p>\n          </div>\n          <Button size=\"lg\" className=\"gap-2\" data-testid=\"button-new-content\">\n            <Plus className=\"h-4 w-4\" />\n            Upload Content\n          </Button>\n        </div>\n\n        {/* Quick Stats */}\n        <div className=\"grid gap-4 md:grid-cols-4\">\n          <Card data-testid=\"card-connected-platforms\">\n            <CardHeader className=\"pb-2\">\n              <CardTitle className=\"text-sm font-medium\">Connected Platforms</CardTitle>\n            </CardHeader>\n            <CardContent>\n              <div className=\"text-2xl font-bold\">{connectedPlatforms.length}</div>\n              <p className=\"text-xs text-muted-foreground\">\n                {connectedPlatforms.map(a => a.platform).join(', ')}\n              </p>\n            </CardContent>\n          </Card>\n\n          <Card data-testid=\"card-content-items\">\n            <CardHeader className=\"pb-2\">\n              <CardTitle className=\"text-sm font-medium\">Content Library</CardTitle>\n            </CardHeader>\n            <CardContent>\n              <div className=\"text-2xl font-bold\">{content.length}</div>\n              <p className=\"text-xs text-muted-foreground\">Ready to publish</p>\n            </CardContent>\n          </Card>\n\n          <Card data-testid=\"card-processing-queue\">\n            <CardHeader className=\"pb-2\">\n              <CardTitle className=\"text-sm font-medium\">Processing Queue</CardTitle>\n            </CardHeader>\n            <CardContent>\n              <div className=\"text-2xl font-bold\">0</div>\n              <p className=\"text-xs text-muted-foreground\">Jobs in progress</p>\n            </CardContent>\n          </Card>\n\n          <Card data-testid=\"card-reach\">\n            <CardHeader className=\"pb-2\">\n              <CardTitle className=\"text-sm font-medium\">Potential Reach</CardTitle>\n            </CardHeader>\n            <CardContent>\n              <div className=\"text-2xl font-bold\">âˆž</div>\n              <p className=\"text-xs text-muted-foreground\">Across all platforms</p>\n            </CardContent>\n          </Card>\n        </div>\n\n        {/* Main Control Panel */}\n        <Tabs defaultValue=\"publish\" className=\"space-y-6\">\n          <TabsList className=\"grid w-full grid-cols-5 lg:w-auto\">\n            <TabsTrigger value=\"publish\" className=\"gap-2\" data-testid=\"tab-publish\">\n              <Zap className=\"h-4 w-4\" />\n              Publish\n            </TabsTrigger>\n            <TabsTrigger value=\"process\" className=\"gap-2\" data-testid=\"tab-process\">\n              <Sparkles className=\"h-4 w-4\" />\n              Process\n            </TabsTrigger>\n            <TabsTrigger value=\"campaigns\" className=\"gap-2\" data-testid=\"tab-campaigns\">\n              <Target className=\"h-4 w-4\" />\n              Campaigns\n            </TabsTrigger>\n            <TabsTrigger value=\"streaming\" className=\"gap-2\" data-testid=\"tab-streaming\">\n              <Video className=\"h-4 w-4\" />\n              Live\n            </TabsTrigger>\n            <TabsTrigger value=\"analytics\" className=\"gap-2\" data-testid=\"tab-analytics\">\n              <BarChart3 className=\"h-4 w-4\" />\n              Analytics\n            </TabsTrigger>\n          </TabsList>\n\n          {/* One-Tap Publishing Tab */}\n          <TabsContent value=\"publish\" className=\"space-y-6\">\n            <div className=\"grid gap-6 md:grid-cols-2\">\n              {/* Content Selection */}\n              <Card>\n                <CardHeader>\n                  <CardTitle className=\"flex items-center gap-2\">\n                    <Upload className=\"h-5 w-5\" />\n                    Select Content\n                  </CardTitle>\n                  <CardDescription>\n                    Choose content to publish across platforms\n                  </CardDescription>\n                </CardHeader>\n                <CardContent className=\"space-y-4\">\n                  {content.length === 0 ? (\n                    <div className=\"text-center py-8 text-muted-foreground\">\n                      <Upload className=\"h-12 w-12 mx-auto mb-4 opacity-50\" />\n                      <p>No content available</p>\n                      <Button variant=\"link\" className=\"mt-2\" data-testid=\"button-upload-first\">\n                        Upload your first content\n                      </Button>\n                    </div>\n                  ) : (\n                    <div className=\"space-y-2 max-h-96 overflow-y-auto\">\n                      {content.map((item) => (\n                        <div\n                          key={item.id}\n                          className={`p-4 border rounded-lg cursor-pointer transition-colors ${\n                            selectedContent === item.id\n                              ? 'border-primary bg-primary/5'\n                              : 'hover:border-primary/50'\n                          }`}\n                          onClick={() => setSelectedContent(item.id)}\n                          data-testid={`content-item-${item.id}`}\n                        >\n                          <div className=\"flex items-start justify-between\">\n                            <div className=\"flex-1\">\n                              <h4 className=\"font-medium\">{item.title}</h4>\n                              <p className=\"text-sm text-muted-foreground line-clamp-2\">\n                                {item.description}\n                              </p>\n                            </div>\n                            {selectedContent === item.id && (\n                              <CheckCircle2 className=\"h-5 w-5 text-primary flex-shrink-0 ml-2\" />\n                            )}\n                          </div>\n                          <div className=\"mt-2 flex gap-2\">\n                            <Badge variant=\"outline\">{item.accessLevel}</Badge>\n                            <Badge variant=\"outline\">{item.status}</Badge>\n                          </div>\n                        </div>\n                      ))}\n                    </div>\n                  )}\n                </CardContent>\n              </Card>\n\n              {/* Publishing Options */}\n              <Card>\n                <CardHeader>\n                  <CardTitle className=\"flex items-center gap-2\">\n                    <Settings className=\"h-5 w-5\" />\n                    Publishing Options\n                  </CardTitle>\n                  <CardDescription>\n                    Customize caption, platforms, and schedule\n                  </CardDescription>\n                </CardHeader>\n                <CardContent className=\"space-y-4\">\n                  {/* Custom Caption */}\n                  <div className=\"space-y-2\">\n                    <Label htmlFor=\"caption\">Custom Caption (Optional)</Label>\n                    <Textarea\n                      id=\"caption\"\n                      placeholder=\"Add a custom caption for this post...\"\n                      value={customCaption}\n                      onChange={(e) => setCustomCaption(e.target.value)}\n                      rows={3}\n                      data-testid=\"input-caption\"\n                    />\n                  </div>\n\n                  {/* Platform Selection */}\n                  <div className=\"space-y-2\">\n                    <Label>Platforms</Label>\n                    <div className=\"text-sm text-muted-foreground mb-2\">\n                      {connectedPlatforms.length === 0 ? (\n                        <span>No platforms connected. <Button variant=\"link\" className=\"h-auto p-0\" data-testid=\"link-connect-platforms\">Connect platforms</Button></span>\n                      ) : (\n                        'Select platforms or leave empty for all connected'\n                      )}\n                    </div>\n                    <div className=\"grid grid-cols-2 gap-2\">\n                      {connectedPlatforms.map((account) => (\n                        <Button\n                          key={account.id}\n                          variant={selectedPlatforms.includes(account.platform) ? 'default' : 'outline'}\n                          size=\"sm\"\n                          onClick={() => {\n                            setSelectedPlatforms(prev =>\n                              prev.includes(account.platform)\n                                ? prev.filter(p => p !== account.platform)\n                                : [...prev, account.platform]\n                            );\n                          }}\n                          data-testid={`button-platform-${account.platform}`}\n                        >\n                          {account.platform}\n                        </Button>\n                      ))}\n                    </div>\n                  </div>\n\n                  {/* Schedule */}\n                  <div className=\"space-y-2\">\n                    <Label htmlFor=\"schedule\">Schedule (Optional)</Label>\n                    <Input\n                      id=\"schedule\"\n                      type=\"datetime-local\"\n                      value={scheduleFor}\n                      onChange={(e) => setScheduleFor(e.target.value)}\n                      data-testid=\"input-schedule\"\n                    />\n                    <p className=\"text-xs text-muted-foreground\">\n                      Leave empty to publish immediately\n                    </p>\n                  </div>\n\n                  <Separator />\n\n                  {/* Auto-Processing Options */}\n                  <div className=\"space-y-4\">\n                    <div className=\"flex items-center justify-between\">\n                      <div className=\"space-y-0.5\">\n                        <Label htmlFor=\"auto-edit\">Auto-Edit Content</Label>\n                        <p className=\"text-xs text-muted-foreground\">\n                          AI-powered post-production\n                        </p>\n                      </div>\n                      <Switch\n                        id=\"auto-edit\"\n                        checked={autoEdit}\n                        onCheckedChange={setAutoEdit}\n                        data-testid=\"switch-auto-edit\"\n                      />\n                    </div>\n\n                    <div className=\"space-y-2\">\n                      <Label>Aspect Ratio Conversion</Label>\n                      <p className=\"text-xs text-muted-foreground mb-2\">\n                        Select formats to generate for platform optimization\n                      </p>\n                      <div className=\"grid grid-cols-3 gap-2\">\n                        {[\n                          { value: '9:16', label: 'Vertical (9:16)', desc: 'Stories, Reels' },\n                          { value: '16:9', label: 'Horizontal (16:9)', desc: 'YouTube, Desktop' },\n                          { value: '1:1', label: 'Square (1:1)', desc: 'Instagram Feed' },\n                        ].map((ratio) => (\n                          <Button\n                            key={ratio.value}\n                            variant={aspectRatios.includes(ratio.value) ? 'default' : 'outline'}\n                            size=\"sm\"\n                            className=\"flex flex-col h-auto py-2\"\n                            onClick={() => {\n                              setAspectRatios(prev =>\n                                prev.includes(ratio.value)\n                                  ? prev.filter(r => r !== ratio.value)\n                                  : [...prev, ratio.value]\n                              );\n                            }}\n                            data-testid={`button-aspect-${ratio.value}`}\n                          >\n                            <span className=\"font-medium text-sm\">{ratio.label}</span>\n                            <span className=\"text-xs opacity-70\">{ratio.desc}</span>\n                          </Button>\n                        ))}\n                      </div>\n                      <p className=\"text-xs text-muted-foreground mt-1\">\n                        {aspectRatios.length === 0 \n                          ? 'No conversions selected - original format only' \n                          : `${aspectRatios.length} format(s) selected`}\n                      </p>\n                    </div>\n\n                    <div className=\"flex items-center justify-between\">\n                      <div className=\"space-y-0.5\">\n                        <Label htmlFor=\"generate-gif\">Generate GIF</Label>\n                        <p className=\"text-xs text-muted-foreground\">\n                          Auto-create GIF preview\n                        </p>\n                      </div>\n                      <Switch\n                        id=\"generate-gif\"\n                        checked={generateGif}\n                        onCheckedChange={setGenerateGif}\n                        data-testid=\"switch-generate-gif\"\n                      />\n                    </div>\n                  </div>\n                </CardContent>\n              </Card>\n            </div>\n\n            {/* Publish Button */}\n            <Card>\n              <CardContent className=\"pt-6\">\n                <div className=\"flex items-center justify-between\">\n                  <div>\n                    <h3 className=\"font-semibold text-lg\">Ready to Publish?</h3>\n                    <p className=\"text-sm text-muted-foreground\">\n                      {selectedContent\n                        ? `Publishing to ${selectedPlatforms.length > 0 ? selectedPlatforms.length : connectedPlatforms.length} platform(s)`\n                        : 'Select content to get started'}\n                    </p>\n                  </div>\n                  <Button\n                    size=\"lg\"\n                    onClick={handleQuickPublish}\n                    disabled={!selectedContent || isPending}\n                    className=\"gap-2\"\n                    data-testid=\"button-quick-publish\"\n                  >\n                    {isPending ? (\n                      <>\n                        <div className=\"h-4 w-4 animate-spin rounded-full border-2 border-current border-t-transparent\" />\n                        Publishing...\n                      </>\n                    ) : (\n                      <>\n                        <Send className=\"h-4 w-4\" />\n                        {scheduleFor ? 'Schedule' : 'Publish'} Now\n                      </>\n                    )}\n                  </Button>\n                </div>\n              </CardContent>\n            </Card>\n          </TabsContent>\n\n          {/* Content Processing Tab */}\n          <TabsContent value=\"process\" className=\"space-y-6\">\n            <Card>\n              <CardHeader>\n                <CardTitle>AI Content Processing</CardTitle>\n                <CardDescription>\n                  Auto-edit, convert, and generate assets for your content\n                </CardDescription>\n              </CardHeader>\n              <CardContent>\n                <div className=\"text-center py-12 text-muted-foreground\">\n                  <Sparkles className=\"h-12 w-12 mx-auto mb-4 opacity-50\" />\n                  <p>Content processing controls coming soon</p>\n                  <p className=\"text-sm mt-2\">Auto-edit, aspect ratio conversion, GIF generation, and more</p>\n                </div>\n              </CardContent>\n            </Card>\n          </TabsContent>\n\n          {/* Marketing Campaigns Tab */}\n          <TabsContent value=\"campaigns\" className=\"space-y-6\">\n            <Card>\n              <CardHeader>\n                <CardTitle>Marketing Campaigns</CardTitle>\n                <CardDescription>\n                  Automated retargeting and fan engagement campaigns\n                </CardDescription>\n              </CardHeader>\n              <CardContent>\n                <div className=\"text-center py-12 text-muted-foreground\">\n                  <Target className=\"h-12 w-12 mx-auto mb-4 opacity-50\" />\n                  <p>Campaign management interface coming soon</p>\n                  <p className=\"text-sm mt-2\">Create automated campaigns, segment fans, and track analytics</p>\n                </div>\n              </CardContent>\n            </Card>\n          </TabsContent>\n\n          {/* Live Streaming Tab */}\n          <TabsContent value=\"streaming\" className=\"space-y-6\">\n            <Card>\n              <CardHeader>\n                <CardTitle>Live Streaming</CardTitle>\n                <CardDescription>\n                  Start and manage live streams with co-star verification\n                </CardDescription>\n              </CardHeader>\n              <CardContent>\n                <div className=\"text-center py-12 text-muted-foreground\">\n                  <Video className=\"h-12 w-12 mx-auto mb-4 opacity-50\" />\n                  <p>Live streaming controls coming soon</p>\n                  <p className=\"text-sm mt-2\">Go live, manage co-stars, and track viewer engagement</p>\n                </div>\n              </CardContent>\n            </Card>\n          </TabsContent>\n\n          {/* Analytics Tab */}\n          <TabsContent value=\"analytics\" className=\"space-y-6\">\n            <Card>\n              <CardHeader>\n                <CardTitle>Performance Analytics</CardTitle>\n                <CardDescription>\n                  Track reach, engagement, and revenue across all platforms\n                </CardDescription>\n              </CardHeader>\n              <CardContent>\n                <div className=\"text-center py-12 text-muted-foreground\">\n                  <BarChart3 className=\"h-12 w-12 mx-auto mb-4 opacity-50\" />\n                  <p>Analytics dashboard coming soon</p>\n                  <p className=\"text-sm mt-2\">Real-time insights into your content performance</p>\n                </div>\n              </CardContent>\n            </Card>\n          </TabsContent>\n        </Tabs>\n      </div>\n    </div>\n  );\n}\n","size_bytes":22262},"client/src/components/ui/collapsible.tsx":{"content":"\"use client\"\n\nimport * as CollapsiblePrimitive from \"@radix-ui/react-collapsible\"\n\nconst Collapsible = CollapsiblePrimitive.Root\n\nconst CollapsibleTrigger = CollapsiblePrimitive.CollapsibleTrigger\n\nconst CollapsibleContent = CollapsiblePrimitive.CollapsibleContent\n\nexport { Collapsible, CollapsibleTrigger, CollapsibleContent }\n","size_bytes":329},"client/src/pages/CreatorProfile.tsx":{"content":"import { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { useParams } from \"wouter\";\nimport { useAuth } from \"@/hooks/useAuth\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { isUnauthorizedError } from \"@/lib/authUtils\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport Header from \"@/components/layout/Header\";\nimport Footer from \"@/components/layout/Footer\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport { Avatar, AvatarImage, AvatarFallback } from \"@/components/ui/avatar\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { \n  Heart, \n  MessageCircle, \n  Share, \n  Shield, \n  Users, \n  Eye, \n  Star,\n  DollarSign,\n  Calendar,\n  MapPin,\n  Verified,\n  Flag\n} from \"lucide-react\";\nimport { useEffect } from \"react\";\n\nexport default function CreatorProfile() {\n  const params = useParams();\n  const userId = params.userId;\n  const { user, isAuthenticated } = useAuth();\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n\n  const { data: profile, isLoading: profileLoading, error: profileError } = useQuery({\n    queryKey: ['/api/profile', userId],\n    enabled: !!userId,\n  });\n\n  const { data: content, isLoading: contentLoading } = useQuery({\n    queryKey: ['/api/content', userId],\n    enabled: !!userId,\n  });\n\n  const { data: subscriptions } = useQuery({\n    queryKey: ['/api/subscriptions/mine'],\n    enabled: isAuthenticated,\n  });\n\n  const subscribeMutation = useMutation({\n    mutationFn: async (data: { creatorId: string; tier: string; price: number }) => {\n      await apiRequest('POST', '/api/subscriptions', data);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['/api/subscriptions/mine'] });\n      toast({\n        title: \"Success!\",\n        description: \"Successfully joined the pack!\",\n      });\n    },\n    onError: (error) => {\n      if (isUnauthorizedError(error as Error)) {\n        toast({\n          title: \"Unauthorized\",\n          description: \"You are logged out. Logging in again...\",\n          variant: \"destructive\",\n        });\n        setTimeout(() => {\n          window.location.href = \"/api/login\";\n        }, 500);\n        return;\n      }\n      toast({\n        title: \"Error\",\n        description: \"Failed to join pack. Please try again.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const tipMutation = useMutation({\n    mutationFn: async (data: { toUserId: string; amount: number; message?: string }) => {\n      await apiRequest('POST', '/api/tips', data);\n    },\n    onSuccess: () => {\n      toast({\n        title: \"Tip Sent!\",\n        description: \"Your tip has been sent successfully!\",\n      });\n    },\n    onError: (error) => {\n      if (isUnauthorizedError(error as Error)) {\n        toast({\n          title: \"Unauthorized\",\n          description: \"You are logged out. Logging in again...\",\n          variant: \"destructive\",\n        });\n        setTimeout(() => {\n          window.location.href = \"/api/login\";\n        }, 500);\n        return;\n      }\n      toast({\n        title: \"Error\",\n        description: \"Failed to send tip. Please try again.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  useEffect(() => {\n    if (profileError && isUnauthorizedError(profileError as Error)) {\n      toast({\n        title: \"Unauthorized\",\n        description: \"You are logged out. Logging in again...\",\n        variant: \"destructive\",\n      });\n      setTimeout(() => {\n        window.location.href = \"/api/login\";\n      }, 500);\n    }\n  }, [profileError, toast]);\n\n  const isSubscribed = subscriptions?.some((sub: any) => sub.creatorId === userId && sub.status === 'active');\n  const isOwnProfile = user?.id === userId;\n\n  const handleSubscribe = () => {\n    subscribeMutation.mutate({\n      creatorId: userId!,\n      tier: 'basic',\n      price: 9.99\n    });\n  };\n\n  const handleTip = (amount: number) => {\n    tipMutation.mutate({\n      toUserId: userId!,\n      amount,\n      message: `Tip from ${user?.username || 'Anonymous'}`\n    });\n  };\n\n  if (profileLoading) {\n    return (\n      <div className=\"min-h-screen bg-background\">\n        <Header />\n        <main className=\"pt-40 pb-16\">\n          <div className=\"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8\">\n            <div className=\"space-y-6\">\n              <Skeleton className=\"h-48 w-full\" />\n              <Skeleton className=\"h-32 w-full\" />\n              <Skeleton className=\"h-64 w-full\" />\n            </div>\n          </div>\n        </main>\n        <Footer />\n      </div>\n    );\n  }\n\n  if (!profile) {\n    return (\n      <div className=\"min-h-screen bg-background\">\n        <Header />\n        <main className=\"pt-40 pb-16\">\n          <div className=\"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 text-center\">\n            <div className=\"py-12\">\n              <Users className=\"h-16 w-16 text-muted mx-auto mb-4\" />\n              <h1 className=\"text-2xl font-bold mb-2\">Profile Not Found</h1>\n              <p className=\"text-muted\">This creator profile doesn't exist or has been removed.</p>\n            </div>\n          </div>\n        </main>\n        <Footer />\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"min-h-screen bg-background\">\n      <Header />\n      \n      <main className=\"pt-20 pb-16\">\n        <div className=\"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8\">\n          {/* Profile Header */}\n          <Card className=\"pack-card mb-8\">\n            <CardContent className=\"p-0\">\n              {/* Banner */}\n              <div className=\"h-48 bg-moonyard rounded-t-xl relative overflow-hidden\">\n                {profile.profile?.bannerUrl && (\n                  <img \n                    src={profile.profile.bannerUrl} \n                    alt=\"Profile banner\"\n                    className=\"w-full h-full object-cover\"\n                  />\n                )}\n                <div className=\"absolute inset-0 bg-gradient-to-t from-black/60 to-transparent\" />\n              </div>\n\n              {/* Profile Info */}\n              <div className=\"relative px-6 pb-6\">\n                <div className=\"flex flex-col sm:flex-row sm:items-end sm:space-x-6 -mt-16 relative z-10\">\n                  <Avatar className=\"w-32 h-32 border-4 border-background shadow-volt-glow\">\n                    <AvatarImage \n                      src={profile.profile?.avatarUrl || profile.profileImageUrl} \n                      alt={profile.profile?.displayName || profile.username}\n                    />\n                    <AvatarFallback className=\"text-2xl bg-primary text-primary-foreground\">\n                      {(profile.profile?.displayName || profile.username)?.charAt(0).toUpperCase()}\n                    </AvatarFallback>\n                  </Avatar>\n\n                  <div className=\"flex-1 mt-4 sm:mt-0\">\n                    <div className=\"flex flex-col sm:flex-row sm:items-center sm:justify-between\">\n                      <div>\n                        <h1 className=\"font-display font-bold text-3xl text-foreground\" data-testid=\"text-creator-name\">\n                          {profile.profile?.displayName || profile.username}\n                        </h1>\n                        <p className=\"text-muted\">@{profile.username}</p>\n                        <div className=\"flex flex-wrap items-center gap-2 mt-2\">\n                          {profile.profile?.ageVerified && (\n                            <Badge className=\"safety-badge safety-badge-verified\">\n                              <Verified className=\"mr-1 h-3 w-3\" />\n                              18+ Verified\n                            </Badge>\n                          )}\n                          {profile.profile?.kycStatus === 'verified' && (\n                            <Badge className=\"safety-badge safety-badge-consent\">\n                              <Shield className=\"mr-1 h-3 w-3\" />\n                              KYC Verified\n                            </Badge>\n                          )}\n                          {profile.profile?.isAftercareFriendly && (\n                            <Badge className=\"safety-badge safety-badge-aftercare\">\n                              <Heart className=\"mr-1 h-3 w-3\" />\n                              Aftercare-Friendly\n                            </Badge>\n                          )}\n                          {profile.profile?.packType && (\n                            <Badge variant=\"outline\">\n                              {profile.profile.packType}\n                            </Badge>\n                          )}\n                        </div>\n                      </div>\n\n                      {!isOwnProfile && isAuthenticated && (\n                        <div className=\"flex items-center space-x-3 mt-4 sm:mt-0\">\n                          {!isSubscribed ? (\n                            <Button \n                              className=\"btn-primary\"\n                              onClick={handleSubscribe}\n                              disabled={subscribeMutation.isPending}\n                              data-testid=\"button-subscribe\"\n                            >\n                              <Heart className=\"mr-2 h-4 w-4\" />\n                              Join Pack - $9.99/mo\n                            </Button>\n                          ) : (\n                            <Button variant=\"outline\" disabled data-testid=\"button-subscribed\">\n                              <Heart className=\"mr-2 h-4 w-4 fill-current\" />\n                              Pack Member\n                            </Button>\n                          )}\n                          <Button variant=\"outline\" data-testid=\"button-message\">\n                            <MessageCircle className=\"h-4 w-4\" />\n                          </Button>\n                          <Button variant=\"outline\" data-testid=\"button-share\">\n                            <Share className=\"h-4 w-4\" />\n                          </Button>\n                        </div>\n                      )}\n                    </div>\n\n                    {profile.profile?.bio && (\n                      <p className=\"mt-4 text-foreground max-w-2xl\" data-testid=\"text-creator-bio\">\n                        {profile.profile.bio}\n                      </p>\n                    )}\n\n                    {/* Stats */}\n                    <div className=\"flex items-center space-x-6 mt-4 text-sm text-muted\">\n                      <div className=\"flex items-center space-x-1\">\n                        <Users className=\"h-4 w-4\" />\n                        <span data-testid=\"text-pack-members\">1.2K pack members</span>\n                      </div>\n                      <div className=\"flex items-center space-x-1\">\n                        <Eye className=\"h-4 w-4\" />\n                        <span data-testid=\"text-total-views\">45.2K views</span>\n                      </div>\n                      <div className=\"flex items-center space-x-1\">\n                        <Calendar className=\"h-4 w-4\" />\n                        <span>Joined {new Date(profile.createdAt).toLocaleDateString()}</span>\n                      </div>\n                    </div>\n                  </div>\n                </div>\n              </div>\n            </CardContent>\n          </Card>\n\n          {/* Content Tabs */}\n          <Tabs defaultValue=\"content\" className=\"space-y-6\">\n            <TabsList className=\"grid w-full grid-cols-4 bg-card border border-border\">\n              <TabsTrigger value=\"content\" data-testid=\"tab-content\">Content</TabsTrigger>\n              <TabsTrigger value=\"about\" data-testid=\"tab-about\">About</TabsTrigger>\n              <TabsTrigger value=\"pack\" data-testid=\"tab-pack\">Pack</TabsTrigger>\n              <TabsTrigger value=\"tips\" data-testid=\"tab-tips\">Tips</TabsTrigger>\n            </TabsList>\n\n            <TabsContent value=\"content\" className=\"space-y-6\">\n              {contentLoading ? (\n                <div className=\"grid md:grid-cols-2 lg:grid-cols-3 gap-4\">\n                  <Skeleton className=\"aspect-square\" />\n                  <Skeleton className=\"aspect-square\" />\n                  <Skeleton className=\"aspect-square\" />\n                </div>\n              ) : content?.length > 0 ? (\n                <div className=\"grid md:grid-cols-2 lg:grid-cols-3 gap-4\">\n                  {content.map((item: any) => (\n                    <Card key={item.id} className=\"pack-card overflow-hidden group cursor-pointer\">\n                      <div className=\"aspect-square bg-gradient-to-br from-primary/20 to-secondary/20 relative\">\n                        <div className=\"absolute inset-0 flex items-center justify-center\">\n                          <Eye className=\"h-8 w-8 text-primary\" />\n                        </div>\n                        <div className=\"absolute inset-0 bg-black/60 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center\">\n                          <div className=\"text-center text-white\">\n                            <Eye className=\"h-6 w-6 mx-auto mb-2\" />\n                            <p className=\"text-sm\">{item.viewCount || 0} views</p>\n                          </div>\n                        </div>\n                        {item.accessLevel === 'ppv' && (\n                          <div className=\"absolute top-2 right-2\">\n                            <Badge className=\"bg-accent text-accent-foreground\">\n                              ${item.price}\n                            </Badge>\n                          </div>\n                        )}\n                      </div>\n                      <CardContent className=\"p-4\">\n                        <h3 className=\"font-medium truncate\" data-testid=\"text-content-title\">\n                          {item.title}\n                        </h3>\n                        <div className=\"flex items-center justify-between mt-2 text-sm text-muted\">\n                          <span>{item.likeCount || 0} likes</span>\n                          <span>{new Date(item.createdAt).toLocaleDateString()}</span>\n                        </div>\n                      </CardContent>\n                    </Card>\n                  ))}\n                </div>\n              ) : (\n                <div className=\"text-center py-12\">\n                  <Eye className=\"h-12 w-12 text-muted mx-auto mb-4\" />\n                  <h3 className=\"font-semibold text-lg mb-2\">No Content Yet</h3>\n                  <p className=\"text-muted\">This creator hasn't posted any content yet.</p>\n                </div>\n              )}\n            </TabsContent>\n\n            <TabsContent value=\"about\" className=\"space-y-6\">\n              <Card className=\"pack-card\">\n                <CardHeader>\n                  <CardTitle>About {profile.profile?.displayName || profile.username}</CardTitle>\n                </CardHeader>\n                <CardContent className=\"space-y-4\">\n                  {profile.profile?.bio && (\n                    <div>\n                      <h4 className=\"font-medium mb-2\">Bio</h4>\n                      <p className=\"text-muted\">{profile.profile.bio}</p>\n                    </div>\n                  )}\n                  \n                  <div>\n                    <h4 className=\"font-medium mb-2\">Pack Details</h4>\n                    <div className=\"space-y-2\">\n                      {profile.profile?.packType && (\n                        <div className=\"flex items-center justify-between\">\n                          <span className=\"text-muted\">Pack Type</span>\n                          <Badge variant=\"outline\">{profile.profile.packType}</Badge>\n                        </div>\n                      )}\n                      <div className=\"flex items-center justify-between\">\n                        <span className=\"text-muted\">Member Since</span>\n                        <span>{new Date(profile.createdAt).toLocaleDateString()}</span>\n                      </div>\n                      <div className=\"flex items-center justify-between\">\n                        <span className=\"text-muted\">Age Verified</span>\n                        <Badge className={profile.profile?.ageVerified ? \"safety-badge-verified\" : \"bg-muted\"}>\n                          {profile.profile?.ageVerified ? \"Verified\" : \"Pending\"}\n                        </Badge>\n                      </div>\n                    </div>\n                  </div>\n                </CardContent>\n              </Card>\n            </TabsContent>\n\n            <TabsContent value=\"pack\" className=\"space-y-6\">\n              <Card className=\"pack-card\">\n                <CardHeader>\n                  <CardTitle>Pack Community</CardTitle>\n                </CardHeader>\n                <CardContent>\n                  <div className=\"text-center py-8\">\n                    <Users className=\"h-12 w-12 text-muted mx-auto mb-4\" />\n                    <p className=\"text-muted\">Pack member features coming soon!</p>\n                  </div>\n                </CardContent>\n              </Card>\n            </TabsContent>\n\n            <TabsContent value=\"tips\" className=\"space-y-6\">\n              {!isOwnProfile && isAuthenticated && (\n                <Card className=\"pack-card\">\n                  <CardHeader>\n                    <CardTitle>Send a Tip</CardTitle>\n                  </CardHeader>\n                  <CardContent>\n                    <div className=\"grid grid-cols-2 md:grid-cols-4 gap-3\">\n                      {[5, 10, 25, 50].map((amount) => (\n                        <Button\n                          key={amount}\n                          variant=\"outline\"\n                          onClick={() => handleTip(amount)}\n                          disabled={tipMutation.isPending}\n                          className=\"h-16\"\n                          data-testid={`button-tip-${amount}`}\n                        >\n                          <div className=\"text-center\">\n                            <DollarSign className=\"h-5 w-5 mx-auto mb-1\" />\n                            <span className=\"text-lg font-bold\">${amount}</span>\n                          </div>\n                        </Button>\n                      ))}\n                    </div>\n                  </CardContent>\n                </Card>\n              )}\n\n              <Card className=\"pack-card\">\n                <CardHeader>\n                  <CardTitle>Recent Tips</CardTitle>\n                </CardHeader>\n                <CardContent>\n                  <div className=\"text-center py-8\">\n                    <Heart className=\"h-12 w-12 text-muted mx-auto mb-4\" />\n                    <p className=\"text-muted\">No tips to display</p>\n                  </div>\n                </CardContent>\n              </Card>\n            </TabsContent>\n          </Tabs>\n\n          {/* Report Button */}\n          {!isOwnProfile && (\n            <div className=\"mt-8 text-center\">\n              <Button variant=\"ghost\" size=\"sm\" className=\"text-muted hover:text-destructive\" data-testid=\"button-report\">\n                <Flag className=\"h-4 w-4 mr-2\" />\n                Report Profile\n              </Button>\n            </div>\n          )}\n        </div>\n      </main>\n\n      <Footer />\n    </div>\n  );\n}\n","size_bytes":19273},"client/src/hooks/use-toast.ts":{"content":"import * as React from \"react\"\n\nimport type {\n  ToastActionElement,\n  ToastProps,\n} from \"@/components/ui/toast\"\n\nconst TOAST_LIMIT = 1\nconst TOAST_REMOVE_DELAY = 1000000\n\ntype ToasterToast = ToastProps & {\n  id: string\n  title?: React.ReactNode\n  description?: React.ReactNode\n  action?: ToastActionElement\n}\n\nconst actionTypes = {\n  ADD_TOAST: \"ADD_TOAST\",\n  UPDATE_TOAST: \"UPDATE_TOAST\",\n  DISMISS_TOAST: \"DISMISS_TOAST\",\n  REMOVE_TOAST: \"REMOVE_TOAST\",\n} as const\n\nlet count = 0\n\nfunction genId() {\n  count = (count + 1) % Number.MAX_SAFE_INTEGER\n  return count.toString()\n}\n\ntype ActionType = typeof actionTypes\n\ntype Action =\n  | {\n      type: ActionType[\"ADD_TOAST\"]\n      toast: ToasterToast\n    }\n  | {\n      type: ActionType[\"UPDATE_TOAST\"]\n      toast: Partial<ToasterToast>\n    }\n  | {\n      type: ActionType[\"DISMISS_TOAST\"]\n      toastId?: ToasterToast[\"id\"]\n    }\n  | {\n      type: ActionType[\"REMOVE_TOAST\"]\n      toastId?: ToasterToast[\"id\"]\n    }\n\ninterface State {\n  toasts: ToasterToast[]\n}\n\nconst toastTimeouts = new Map<string, ReturnType<typeof setTimeout>>()\n\nconst addToRemoveQueue = (toastId: string) => {\n  if (toastTimeouts.has(toastId)) {\n    return\n  }\n\n  const timeout = setTimeout(() => {\n    toastTimeouts.delete(toastId)\n    dispatch({\n      type: \"REMOVE_TOAST\",\n      toastId: toastId,\n    })\n  }, TOAST_REMOVE_DELAY)\n\n  toastTimeouts.set(toastId, timeout)\n}\n\nexport const reducer = (state: State, action: Action): State => {\n  switch (action.type) {\n    case \"ADD_TOAST\":\n      return {\n        ...state,\n        toasts: [action.toast, ...state.toasts].slice(0, TOAST_LIMIT),\n      }\n\n    case \"UPDATE_TOAST\":\n      return {\n        ...state,\n        toasts: state.toasts.map((t) =>\n          t.id === action.toast.id ? { ...t, ...action.toast } : t\n        ),\n      }\n\n    case \"DISMISS_TOAST\": {\n      const { toastId } = action\n\n      // ! Side effects ! - This could be extracted into a dismissToast() action,\n      // but I'll keep it here for simplicity\n      if (toastId) {\n        addToRemoveQueue(toastId)\n      } else {\n        state.toasts.forEach((toast) => {\n          addToRemoveQueue(toast.id)\n        })\n      }\n\n      return {\n        ...state,\n        toasts: state.toasts.map((t) =>\n          t.id === toastId || toastId === undefined\n            ? {\n                ...t,\n                open: false,\n              }\n            : t\n        ),\n      }\n    }\n    case \"REMOVE_TOAST\":\n      if (action.toastId === undefined) {\n        return {\n          ...state,\n          toasts: [],\n        }\n      }\n      return {\n        ...state,\n        toasts: state.toasts.filter((t) => t.id !== action.toastId),\n      }\n  }\n}\n\nconst listeners: Array<(state: State) => void> = []\n\nlet memoryState: State = { toasts: [] }\n\nfunction dispatch(action: Action) {\n  memoryState = reducer(memoryState, action)\n  listeners.forEach((listener) => {\n    listener(memoryState)\n  })\n}\n\ntype Toast = Omit<ToasterToast, \"id\">\n\nfunction toast({ ...props }: Toast) {\n  const id = genId()\n\n  const update = (props: ToasterToast) =>\n    dispatch({\n      type: \"UPDATE_TOAST\",\n      toast: { ...props, id },\n    })\n  const dismiss = () => dispatch({ type: \"DISMISS_TOAST\", toastId: id })\n\n  dispatch({\n    type: \"ADD_TOAST\",\n    toast: {\n      ...props,\n      id,\n      open: true,\n      onOpenChange: (open) => {\n        if (!open) dismiss()\n      },\n    },\n  })\n\n  return {\n    id: id,\n    dismiss,\n    update,\n  }\n}\n\nfunction useToast() {\n  const [state, setState] = React.useState<State>(memoryState)\n\n  React.useEffect(() => {\n    listeners.push(setState)\n    return () => {\n      const index = listeners.indexOf(setState)\n      if (index > -1) {\n        listeners.splice(index, 1)\n      }\n    }\n  }, [state])\n\n  return {\n    ...state,\n    toast,\n    dismiss: (toastId?: string) => dispatch({ type: \"DISMISS_TOAST\", toastId }),\n  }\n}\n\nexport { useToast, toast }\n","size_bytes":3895},"client/src/components/ui/sheet.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as SheetPrimitive from \"@radix-ui/react-dialog\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Sheet = SheetPrimitive.Root\n\nconst SheetTrigger = SheetPrimitive.Trigger\n\nconst SheetClose = SheetPrimitive.Close\n\nconst SheetPortal = SheetPrimitive.Portal\n\nconst SheetOverlay = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Overlay\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  />\n))\nSheetOverlay.displayName = SheetPrimitive.Overlay.displayName\n\nconst sheetVariants = cva(\n  \"fixed z-50 gap-4 bg-background p-6 shadow-lg transition ease-in-out data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:duration-300 data-[state=open]:duration-500\",\n  {\n    variants: {\n      side: {\n        top: \"inset-x-0 top-0 border-b data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top\",\n        bottom:\n          \"inset-x-0 bottom-0 border-t data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom\",\n        left: \"inset-y-0 left-0 h-full w-3/4 border-r data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left sm:max-w-sm\",\n        right:\n          \"inset-y-0 right-0 h-full w-3/4  border-l data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right sm:max-w-sm\",\n      },\n    },\n    defaultVariants: {\n      side: \"right\",\n    },\n  }\n)\n\ninterface SheetContentProps\n  extends React.ComponentPropsWithoutRef<typeof SheetPrimitive.Content>,\n    VariantProps<typeof sheetVariants> {}\n\nconst SheetContent = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Content>,\n  SheetContentProps\n>(({ side = \"right\", className, children, ...props }, ref) => (\n  <SheetPortal>\n    <SheetOverlay />\n    <SheetPrimitive.Content\n      ref={ref}\n      className={cn(sheetVariants({ side }), className)}\n      {...props}\n    >\n      {children}\n      <SheetPrimitive.Close className=\"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-secondary\">\n        <X className=\"h-4 w-4\" />\n        <span className=\"sr-only\">Close</span>\n      </SheetPrimitive.Close>\n    </SheetPrimitive.Content>\n  </SheetPortal>\n))\nSheetContent.displayName = SheetPrimitive.Content.displayName\n\nconst SheetHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-2 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nSheetHeader.displayName = \"SheetHeader\"\n\nconst SheetFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nSheetFooter.displayName = \"SheetFooter\"\n\nconst SheetTitle = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Title\n    ref={ref}\n    className={cn(\"text-lg font-semibold text-foreground\", className)}\n    {...props}\n  />\n))\nSheetTitle.displayName = SheetPrimitive.Title.displayName\n\nconst SheetDescription = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nSheetDescription.displayName = SheetPrimitive.Description.displayName\n\nexport {\n  Sheet,\n  SheetPortal,\n  SheetOverlay,\n  SheetTrigger,\n  SheetClose,\n  SheetContent,\n  SheetHeader,\n  SheetFooter,\n  SheetTitle,\n  SheetDescription,\n}\n","size_bytes":4281},"client/src/components/ui/breadcrumb.tsx":{"content":"import * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { ChevronRight, MoreHorizontal } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Breadcrumb = React.forwardRef<\n  HTMLElement,\n  React.ComponentPropsWithoutRef<\"nav\"> & {\n    separator?: React.ReactNode\n  }\n>(({ ...props }, ref) => <nav ref={ref} aria-label=\"breadcrumb\" {...props} />)\nBreadcrumb.displayName = \"Breadcrumb\"\n\nconst BreadcrumbList = React.forwardRef<\n  HTMLOListElement,\n  React.ComponentPropsWithoutRef<\"ol\">\n>(({ className, ...props }, ref) => (\n  <ol\n    ref={ref}\n    className={cn(\n      \"flex flex-wrap items-center gap-1.5 break-words text-sm text-muted-foreground sm:gap-2.5\",\n      className\n    )}\n    {...props}\n  />\n))\nBreadcrumbList.displayName = \"BreadcrumbList\"\n\nconst BreadcrumbItem = React.forwardRef<\n  HTMLLIElement,\n  React.ComponentPropsWithoutRef<\"li\">\n>(({ className, ...props }, ref) => (\n  <li\n    ref={ref}\n    className={cn(\"inline-flex items-center gap-1.5\", className)}\n    {...props}\n  />\n))\nBreadcrumbItem.displayName = \"BreadcrumbItem\"\n\nconst BreadcrumbLink = React.forwardRef<\n  HTMLAnchorElement,\n  React.ComponentPropsWithoutRef<\"a\"> & {\n    asChild?: boolean\n  }\n>(({ asChild, className, ...props }, ref) => {\n  const Comp = asChild ? Slot : \"a\"\n\n  return (\n    <Comp\n      ref={ref}\n      className={cn(\"transition-colors hover:text-foreground\", className)}\n      {...props}\n    />\n  )\n})\nBreadcrumbLink.displayName = \"BreadcrumbLink\"\n\nconst BreadcrumbPage = React.forwardRef<\n  HTMLSpanElement,\n  React.ComponentPropsWithoutRef<\"span\">\n>(({ className, ...props }, ref) => (\n  <span\n    ref={ref}\n    role=\"link\"\n    aria-disabled=\"true\"\n    aria-current=\"page\"\n    className={cn(\"font-normal text-foreground\", className)}\n    {...props}\n  />\n))\nBreadcrumbPage.displayName = \"BreadcrumbPage\"\n\nconst BreadcrumbSeparator = ({\n  children,\n  className,\n  ...props\n}: React.ComponentProps<\"li\">) => (\n  <li\n    role=\"presentation\"\n    aria-hidden=\"true\"\n    className={cn(\"[&>svg]:w-3.5 [&>svg]:h-3.5\", className)}\n    {...props}\n  >\n    {children ?? <ChevronRight />}\n  </li>\n)\nBreadcrumbSeparator.displayName = \"BreadcrumbSeparator\"\n\nconst BreadcrumbEllipsis = ({\n  className,\n  ...props\n}: React.ComponentProps<\"span\">) => (\n  <span\n    role=\"presentation\"\n    aria-hidden=\"true\"\n    className={cn(\"flex h-9 w-9 items-center justify-center\", className)}\n    {...props}\n  >\n    <MoreHorizontal className=\"h-4 w-4\" />\n    <span className=\"sr-only\">More</span>\n  </span>\n)\nBreadcrumbEllipsis.displayName = \"BreadcrumbElipssis\"\n\nexport {\n  Breadcrumb,\n  BreadcrumbList,\n  BreadcrumbItem,\n  BreadcrumbLink,\n  BreadcrumbPage,\n  BreadcrumbSeparator,\n  BreadcrumbEllipsis,\n}\n","size_bytes":2712},"client/src/hooks/use-mobile.tsx":{"content":"import * as React from \"react\"\n\nconst MOBILE_BREAKPOINT = 768\n\nexport function useIsMobile() {\n  const [isMobile, setIsMobile] = React.useState<boolean | undefined>(undefined)\n\n  React.useEffect(() => {\n    const mql = window.matchMedia(`(max-width: ${MOBILE_BREAKPOINT - 1}px)`)\n    const onChange = () => {\n      setIsMobile(window.innerWidth < MOBILE_BREAKPOINT)\n    }\n    mql.addEventListener(\"change\", onChange)\n    setIsMobile(window.innerWidth < MOBILE_BREAKPOINT)\n    return () => mql.removeEventListener(\"change\", onChange)\n  }, [])\n\n  return !!isMobile\n}\n","size_bytes":565},"server/index.ts":{"content":"import express, { type Request, Response, NextFunction } from \"express\";\nimport { registerRoutes } from \"./routes\";\nimport { setupVite, serveStatic, log } from \"./vite\";\n\nconst app = express();\napp.use(express.json());\napp.use(express.urlencoded({ extended: false }));\n\napp.use((req, res, next) => {\n  const start = Date.now();\n  const path = req.path;\n  let capturedJsonResponse: Record<string, any> | undefined = undefined;\n\n  const originalResJson = res.json;\n  res.json = function (bodyJson, ...args) {\n    capturedJsonResponse = bodyJson;\n    return originalResJson.apply(res, [bodyJson, ...args]);\n  };\n\n  res.on(\"finish\", () => {\n    const duration = Date.now() - start;\n    if (path.startsWith(\"/api\")) {\n      let logLine = `${req.method} ${path} ${res.statusCode} in ${duration}ms`;\n      if (capturedJsonResponse) {\n        logLine += ` :: ${JSON.stringify(capturedJsonResponse)}`;\n      }\n\n      if (logLine.length > 80) {\n        logLine = logLine.slice(0, 79) + \"â€¦\";\n      }\n\n      log(logLine);\n    }\n  });\n\n  next();\n});\n\n(async () => {\n  const server = await registerRoutes(app);\n\n  app.use((err: any, _req: Request, res: Response, _next: NextFunction) => {\n    const status = err.status || err.statusCode || 500;\n    const message = err.message || \"Internal Server Error\";\n\n    res.status(status).json({ message });\n    throw err;\n  });\n\n  // importantly only setup vite in development and after\n  // setting up all the other routes so the catch-all route\n  // doesn't interfere with the other routes\n  if (app.get(\"env\") === \"development\") {\n    await setupVite(app, server);\n  } else {\n    serveStatic(app);\n  }\n\n  // ALWAYS serve the app on the port specified in the environment variable PORT\n  // Other ports are firewalled. Default to 5000 if not specified.\n  // this serves both the API and the client.\n  // It is the only port that is not firewalled.\n  const port = parseInt(process.env.PORT || '5000', 10);\n  server.listen({\n    port,\n    host: \"0.0.0.0\",\n    reusePort: true,\n  }, () => {\n    log(`serving on port ${port}`);\n  });\n})();\n","size_bytes":2066},"client/src/lib/authUtils.ts":{"content":"export function isUnauthorizedError(error: Error): boolean {\n  return /^401: .*Unauthorized/.test(error.message);\n}","size_bytes":115},"tailwind.config.ts":{"content":"import type { Config } from \"tailwindcss\";\n\nexport default {\n  darkMode: [\"class\"],\n  content: [\"./client/index.html\", \"./client/src/**/*.{js,jsx,ts,tsx}\"],\n  theme: {\n    extend: {\n      borderRadius: {\n        lg: \"var(--radius)\",\n        md: \"calc(var(--radius) - 2px)\",\n        sm: \"calc(var(--radius) - 4px)\",\n      },\n      colors: {\n        // PupFanz brand colors\n        pf: {\n          volt: \"hsl(78, 100%, 54%)\", // #A3FF12\n          cobalt: \"hsl(217, 91%, 60%)\", // #2563EB\n          tangerine: \"hsl(24, 100%, 50%)\", // #FF7A00\n          ink: \"hsl(240, 10%, 3.9%)\", // #0A0A0B\n          graphite: \"hsl(240, 8%, 7%)\", // #121214\n          snow: \"hsl(210, 25%, 95%)\", // #F5F7FA\n          mist: \"hsl(220, 14%, 82%)\", // #C9D0D6\n        },\n        // Base theme colors\n        background: \"var(--background)\",\n        foreground: \"var(--foreground)\",\n        card: {\n          DEFAULT: \"var(--card)\",\n          foreground: \"var(--card-foreground)\",\n        },\n        popover: {\n          DEFAULT: \"var(--popover)\",\n          foreground: \"var(--popover-foreground)\",\n        },\n        primary: {\n          DEFAULT: \"var(--primary)\",\n          foreground: \"var(--primary-foreground)\",\n        },\n        secondary: {\n          DEFAULT: \"var(--secondary)\",\n          foreground: \"var(--secondary-foreground)\",\n        },\n        muted: {\n          DEFAULT: \"var(--muted)\",\n          foreground: \"var(--muted-foreground)\",\n        },\n        accent: {\n          DEFAULT: \"var(--accent)\",\n          foreground: \"var(--accent-foreground)\",\n        },\n        destructive: {\n          DEFAULT: \"var(--destructive)\",\n          foreground: \"var(--destructive-foreground)\",\n        },\n        border: \"var(--border)\",\n        input: \"var(--input)\",\n        ring: \"var(--ring)\",\n        chart: {\n          \"1\": \"var(--chart-1)\",\n          \"2\": \"var(--chart-2)\",\n          \"3\": \"var(--chart-3)\",\n          \"4\": \"var(--chart-4)\",\n          \"5\": \"var(--chart-5)\",\n        },\n        sidebar: {\n          DEFAULT: \"var(--sidebar)\",\n          foreground: \"var(--sidebar-foreground)\",\n          primary: \"var(--sidebar-primary)\",\n          \"primary-foreground\": \"var(--sidebar-primary-foreground)\",\n          accent: \"var(--sidebar-accent)\",\n          \"accent-foreground\": \"var(--sidebar-accent-foreground)\",\n          border: \"var(--sidebar-border)\",\n          ring: \"var(--sidebar-ring)\",\n        },\n        // Semantic colors\n        success: \"hsl(142, 76%, 36%)\", // #22C55E\n        warning: \"hsl(38, 92%, 50%)\", // #F59E0B\n        error: \"hsl(0, 84%, 60%)\", // #EF4444\n      },\n      fontFamily: {\n        display: [\"var(--font-display)\"],\n        sans: [\"var(--font-sans)\"],\n        serif: [\"var(--font-serif)\"],\n        mono: [\"var(--font-mono)\"],\n      },\n      boxShadow: {\n        'volt-glow': '0 0 24px rgba(163, 255, 18, 0.25)',\n        'volt-strong': '0 0 40px rgba(163, 255, 18, 0.4)',\n      },\n      backgroundImage: {\n        'pack-howl': 'linear-gradient(135deg, #A3FF12 0%, #2563EB 60%, #00E5FF 100%)',\n        'trail-mix': 'linear-gradient(90deg, #A3FF12, #FF7A00)',\n        'moonyard': 'radial-gradient(1100px 520px at 70% -8%, rgba(37,99,235,0.25) 0%, #0A0A0B 60%)',\n      },\n      keyframes: {\n        \"accordion-down\": {\n          from: {\n            height: \"0\",\n          },\n          to: {\n            height: \"var(--radix-accordion-content-height)\",\n          },\n        },\n        \"accordion-up\": {\n          from: {\n            height: \"var(--radix-accordion-content-height)\",\n          },\n          to: {\n            height: \"0\",\n          },\n        },\n        \"bounce-subtle\": {\n          \"0%, 100%\": { transform: \"translateY(0)\" },\n          \"50%\": { transform: \"translateY(-4px)\" }\n        },\n        \"glow-pulse\": {\n          \"0%\": { boxShadow: \"0 0 20px rgba(163,255,18,0.3)\" },\n          \"100%\": { boxShadow: \"0 0 40px rgba(163,255,18,0.6)\" }\n        },\n        \"pack-howl\": {\n          \"0%\": { backgroundPosition: \"0% 50%\" },\n          \"50%\": { backgroundPosition: \"100% 50%\" },\n          \"100%\": { backgroundPosition: \"0% 50%\" }\n        }\n      },\n      animation: {\n        \"accordion-down\": \"accordion-down 0.2s ease-out\",\n        \"accordion-up\": \"accordion-up 0.2s ease-out\",\n        \"bounce-subtle\": \"bounce-subtle 2s infinite\",\n        \"glow-pulse\": \"glow-pulse 2s ease-in-out infinite alternate\",\n        \"pack-howl\": \"pack-howl 3s ease infinite\",\n      },\n    },\n  },\n  plugins: [require(\"tailwindcss-animate\"), require(\"@tailwindcss/typography\")],\n} satisfies Config;\n","size_bytes":4509},"replit.md":{"content":"# Overview\n\nPupFanz is a creator-focused adult content platform emphasizing safety, consent management, and community. It provides a modern full-stack architecture with dual authentication, comprehensive content management, real-time messaging, and robust safety features like age verification. The platform aims to foster authentic connections within the adult content creator ecosystem.\n\n# User Preferences\n\nPreferred communication style: Simple, everyday language.\n\n# System Architecture\n\n## UI/UX Decisions\n- **Design Theme**: Dark-first with custom PupFanz brand colors (Volt lime, Cobalt blue, Tangerine orange).\n- **Typography**: Space Grotesk/Sora for display, Inter/Outfit for body text.\n- **UI Components**: Radix UI primitives for accessible, headless components.\n- **Styling**: Tailwind CSS for utility-first styling.\n- **Mobile-First Responsive Design**: Adaptive layouts, touch-optimized UI, responsive navigation (hamburger menu, bottom nav), and iOS safe area support.\n\n## Technical Implementations\n- **Frontend**: React 18+ with TypeScript, Vite for bundling, Wouter for routing, TanStack React Query for state management.\n- **Backend**: Node.js with TypeScript and ES modules, Express.js for the framework, WebSocket server for real-time communication.\n- **Authentication**: Dual system with Replit OAuth and local JWT-based authentication, PostgreSQL-backed session management, CSRF protection.\n- **Data Storage**: PostgreSQL with Neon serverless hosting, Drizzle ORM for type-safe operations. Google Cloud Storage for media assets with custom ACLs.\n- **Safety & Compliance**: KYC age verification, granular consent management, content moderation with a reporting system, GDPR-compliant data handling.\n- **Content Management**: Uppy-based media upload, sophisticated ACL system for access control, tag-based categorization.\n- **Messaging**: Real-time chat with WebSocket, media sharing, integrated tipping system.\n- **AI Features & Innovations (13 GROUNDBREAKING SYSTEMS - ALL COMPLETE)**:\n    - **Recommendation Engine**: ML-driven personalized content recommendations based on user interaction, engagement scoring, and collaborative filtering.\n    - **Content Moderation**: Automated image, video, and text analysis for prohibited content with confidence scoring, auto-actions, and human review override.\n    - **Content Processing**: Automated post-production pipeline for multi-aspect ratio conversion, asset generation (GIFs, trailers), and a job queue system.\n    - **Marketing Automation**: Event-triggered campaigns (push, email, social) with fan segmentation, behavioral targeting, and analytics.\n    - **Blockchain Content Ownership**: NFT minting for exclusive content with on-chain royalty tracking, multi-chain support (Ethereum, Polygon, Solana), smart contract integration, marketplace analytics, and creator earnings dashboard.\n    - **AI Voice Cloning**: Personalized voice message generation at scale with creator voice models, fan DM automation, voice sample training, quality scoring, and usage analytics.\n    - **Holographic Streaming Infrastructure**: VR/AR streaming support with spatial audio, 3D avatar integration, viewer management, peak viewer tracking, and immersive co-star experiences.\n    - **Dynamic Pricing AI**: Real-time price optimization engine with 6 strategies (surge, demand curve, time decay, engagement-based, auction simulation, personalized), AI-calculated demand scores, price elasticity, and confidence scoring.\n    - **Fan-to-Creator Microlending**: Peer-to-peer lending system for equipment/production funding with collateral management, repayment tracking, late fee enforcement, credit scoring algorithm, and compound interest calculations.\n    - **Deepfake Detection System**: AI-powered content authenticity verification with multi-method detection (facial analysis, voice detection, metadata checking, GAN artifact detection), cryptographic signatures (SHA-256), biometric watermarking, verification code system, and user reporting with moderation workflow.\n    - **Emotional AI Engine**: Real-time sentiment analysis for fan engagement optimization with multi-emotion detection (9 emotions), mood tracking with 50-entry emotional journey, churn prediction, AI-generated empathetic response recommendations, toxicity detection, engagement level classification (disengaged â†’ super_fan), and effectiveness tracking.\n- **Creator Tools**: \n    - **Analytics Dashboard**: Real-time metrics and performance tracking.\n    - **Creator Control Dashboard** (NEW): Comprehensive one-tap publishing interface at `/creator-control` with manual override capabilities for aspect ratios (9:16, 16:9, 1:1), platform selection, caption customization, auto-edit controls, GIF generation, and scheduled publishing. Orchestrates content processing and multi-platform distribution services.\n    - **Free Access Toggle**: Control content visibility and access.\n    - **Advanced Gating**: Subscriber-only content, pay-per-view options.\n    - **Gamification**: Achievement badges, creator/fan tiers, leaderboards, points system.\n- **Notification System**: Real-time WebSocket push notifications, user-configurable preferences, quiet hours, and notification history.\n- **Dual Onboarding**: Role-based flows for Creators (5 steps) and Fanz (4 steps) with progress tracking and upgrade paths.\n- **Co-Star Verification**: Token-based invitation system for collaborative content, integrated with KYC.\n- **Multi-Platform Distribution**: Social media integration for auto-distribution, scheduled publishing, QR code generation, and trackable smart links.\n- **Live Stream Infrastructure**: Database foundation for RTMP/WebRTC streaming, co-star verification gates, participant tracking, real-time tipping, auto-recording, and AI highlight generation.\n\n## System Design Choices\n- **API Design**: RESTful endpoints.\n- **Security**: Comprehensive middleware for security, validation, and rate limiting; bcrypt for password hashing, jsonwebtoken for JWTs.\n- **Scalability**: Serverless database, cloud storage.\n- **Maintainability**: TypeScript for type safety, Drizzle ORM.\n\n# External Dependencies\n\n## Cloud Services\n- **Neon Database**: Serverless PostgreSQL hosting.\n- **Google Cloud Storage**: Object storage for media assets.\n- **Replit Infrastructure**: Deployment platform with OAuth integration.\n\n## Payment Processing\n- **Adult-Friendly Payment Processors**: Integration points for specialized payment systems supporting adult content transactions (Stripe/PayPal explicitly excluded).\n- **VerifyMy**: ID verification and compliance system for age verification/KYC.\n\n## Development Tools\n- **Vite**: Frontend build tool.\n- **Drizzle Kit**: Database migration and schema management.\n- **ESBuild**: Backend bundling.\n\n## UI/UX Libraries\n- **Radix UI**: Accessible component primitives.\n- **TanStack React Query**: Server state management and caching.\n- **Uppy**: File upload handling.\n- **Wouter**: Lightweight routing solution.\n\n## Security and Validation\n- **Zod**: Runtime type validation.\n- **bcrypt**: Password hashing.\n- **jsonwebtoken**: JWT token generation and validation.\n- **Express middleware**: Rate limiting, CORS, security headers.","size_bytes":7190},"client/src/App.tsx":{"content":"import { Switch, Route } from \"wouter\";\nimport { useState } from \"react\";\nimport { queryClient } from \"./lib/queryClient\";\nimport { QueryClientProvider, useQuery } from \"@tanstack/react-query\";\nimport { Toaster } from \"@/components/ui/toaster\";\nimport { TooltipProvider } from \"@/components/ui/tooltip\";\nimport { useAuth } from \"@/hooks/useAuth\";\nimport Landing from \"@/pages/Landing\";\nimport Home from \"@/pages/Home\";\nimport Dashboard from \"@/pages/Dashboard\";\nimport CreatorProfile from \"@/pages/CreatorProfile\";\nimport Discovery from \"@/pages/Discovery\";\nimport Messages from \"@/pages/Messages\";\nimport Settings from \"@/pages/Settings\";\nimport Wiki from \"@/pages/Wiki\";\nimport Support from \"@/pages/Support\";\nimport Tutorials from \"@/pages/Tutorials\";\nimport Achievements from \"@/pages/Achievements\";\nimport Moderation from \"@/pages/Moderation\";\nimport CreatorDashboard from \"@/pages/CreatorDashboard\";\nimport CreatorSignup from \"@/pages/CreatorSignup\";\nimport Packs from \"@/pages/Packs\";\nimport Live from \"@/pages/Live\";\nimport Safety from \"@/pages/Safety\";\nimport Guidelines from \"@/pages/Guidelines\";\nimport Report from \"@/pages/Report\";\nimport Terms from \"@/pages/Terms\";\nimport Privacy from \"@/pages/Privacy\";\nimport DMCA from \"@/pages/DMCA\";\nimport Compliance2257 from \"@/pages/Compliance2257\";\nimport NotFound from \"@/pages/not-found\";\nimport Navigation from \"@/components/layout/Navigation\";\nimport OnboardingWizard from \"@/components/onboarding/OnboardingWizard\";\n\nfunction Router() {\n  const { isAuthenticated, isLoading } = useAuth();\n\n  return (\n    <Switch>\n      {/* Landing page for unauthenticated users */}\n      <Route path=\"/\" component={isAuthenticated ? Home : Landing} />\n      \n      {/* Home route (authenticated) */}\n      <Route path=\"/home\" component={isAuthenticated ? Home : Landing} />\n      \n      {/* Discovery page (accessible to all users) */}\n      <Route path=\"/discover\" component={Discovery} />\n      \n      {/* Public pages */}\n      <Route path=\"/creator-signup\" component={CreatorSignup} />\n      <Route path=\"/packs\" component={Packs} />\n      <Route path=\"/live\" component={Live} />\n      <Route path=\"/safety\" component={Safety} />\n      <Route path=\"/guidelines\" component={Guidelines} />\n      <Route path=\"/report\" component={Report} />\n      <Route path=\"/terms\" component={Terms} />\n      <Route path=\"/privacy\" component={Privacy} />\n      <Route path=\"/dmca\" component={DMCA} />\n      <Route path=\"/2257\" component={Compliance2257} />\n      \n      {/* Public help pages */}\n      <Route path=\"/wiki\" component={Wiki} />\n      <Route path=\"/tutorials\" component={Tutorials} />\n      <Route path=\"/support\" component={Support} />\n      \n      {/* Authenticated routes */}\n      {isAuthenticated && (\n        <>\n          <Route path=\"/dashboard\" component={Dashboard} />\n          <Route path=\"/creator-control\" component={CreatorDashboard} />\n          <Route path=\"/profile/:userId\" component={CreatorProfile} />\n          <Route path=\"/messages\" component={Messages} />\n          <Route path=\"/achievements\" component={Achievements} />\n          <Route path=\"/moderation\" component={Moderation} />\n          <Route path=\"/settings\" component={Settings} />\n        </>\n      )}\n      \n      <Route component={NotFound} />\n    </Switch>\n  );\n}\n\nfunction AppContent() {\n  const { isAuthenticated } = useAuth();\n  const [showOnboarding, setShowOnboarding] = useState(false);\n\n  // Fetch user data to check onboarding status\n  const { data: user } = useQuery<any>({\n    queryKey: ['/api/auth/user'],\n    enabled: isAuthenticated,\n  });\n\n  // Show onboarding for authenticated users who haven't completed it\n  const needsOnboarding = isAuthenticated && user && !user.onboardingCompleted;\n\n  const handleOnboardingComplete = () => {\n    setShowOnboarding(false);\n    // Refresh user data\n    queryClient.invalidateQueries({ queryKey: ['/api/auth/user'] });\n  };\n  \n  return (\n    <TooltipProvider>\n        <div className=\"min-h-screen bg-moonyard text-foreground\">\n          <div className=\"relative z-10 flex\">\n            {(isAuthenticated || ['/wiki', '/tutorials', '/support'].some(path => window.location.pathname.startsWith(path))) && (\n              <Navigation />\n            )}\n            <div className=\"flex-1 pb-[calc(4rem+env(safe-area-inset-bottom))] lg:pb-0\">\n              <Toaster />\n              <Router />\n            </div>\n          </div>\n        </div>\n\n        {/* Onboarding Wizard */}\n        {needsOnboarding && (\n          <OnboardingWizard \n            isOpen={true} \n            onComplete={handleOnboardingComplete} \n          />\n        )}\n      </TooltipProvider>\n  );\n}\n\nfunction App() {\n  return (\n    <QueryClientProvider client={queryClient}>\n      <AppContent />\n    </QueryClientProvider>\n  );\n}\n\nexport default App;\n","size_bytes":4806},"client/src/components/ui/textarea.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Textarea = React.forwardRef<\n  HTMLTextAreaElement,\n  React.ComponentProps<\"textarea\">\n>(({ className, ...props }, ref) => {\n  return (\n    <textarea\n      className={cn(\n        \"flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm\",\n        className\n      )}\n      ref={ref}\n      {...props}\n    />\n  )\n})\nTextarea.displayName = \"Textarea\"\n\nexport { Textarea }\n","size_bytes":689},"client/src/components/ui/menubar.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as MenubarPrimitive from \"@radix-ui/react-menubar\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nfunction MenubarMenu({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Menu>) {\n  return <MenubarPrimitive.Menu {...props} />\n}\n\nfunction MenubarGroup({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Group>) {\n  return <MenubarPrimitive.Group {...props} />\n}\n\nfunction MenubarPortal({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Portal>) {\n  return <MenubarPrimitive.Portal {...props} />\n}\n\nfunction MenubarRadioGroup({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.RadioGroup>) {\n  return <MenubarPrimitive.RadioGroup {...props} />\n}\n\nfunction MenubarSub({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Sub>) {\n  return <MenubarPrimitive.Sub data-slot=\"menubar-sub\" {...props} />\n}\n\nconst Menubar = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"flex h-10 items-center space-x-1 rounded-md border bg-background p-1\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubar.displayName = MenubarPrimitive.Root.displayName\n\nconst MenubarTrigger = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Trigger>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-3 py-1.5 text-sm font-medium outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarTrigger.displayName = MenubarPrimitive.Trigger.displayName\n\nconst MenubarSubTrigger = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <MenubarPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto h-4 w-4\" />\n  </MenubarPrimitive.SubTrigger>\n))\nMenubarSubTrigger.displayName = MenubarPrimitive.SubTrigger.displayName\n\nconst MenubarSubContent = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-menubar-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarSubContent.displayName = MenubarPrimitive.SubContent.displayName\n\nconst MenubarContent = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Content>\n>(\n  (\n    { className, align = \"start\", alignOffset = -4, sideOffset = 8, ...props },\n    ref\n  ) => (\n    <MenubarPrimitive.Portal>\n      <MenubarPrimitive.Content\n        ref={ref}\n        align={align}\n        alignOffset={alignOffset}\n        sideOffset={sideOffset}\n        className={cn(\n          \"z-50 min-w-[12rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-menubar-content-transform-origin]\",\n          className\n        )}\n        {...props}\n      />\n    </MenubarPrimitive.Portal>\n  )\n)\nMenubarContent.displayName = MenubarPrimitive.Content.displayName\n\nconst MenubarItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <MenubarPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarItem.displayName = MenubarPrimitive.Item.displayName\n\nconst MenubarCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <MenubarPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <MenubarPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </MenubarPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </MenubarPrimitive.CheckboxItem>\n))\nMenubarCheckboxItem.displayName = MenubarPrimitive.CheckboxItem.displayName\n\nconst MenubarRadioItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <MenubarPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <MenubarPrimitive.ItemIndicator>\n        <Circle className=\"h-2 w-2 fill-current\" />\n      </MenubarPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </MenubarPrimitive.RadioItem>\n))\nMenubarRadioItem.displayName = MenubarPrimitive.RadioItem.displayName\n\nconst MenubarLabel = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <MenubarPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarLabel.displayName = MenubarPrimitive.Label.displayName\n\nconst MenubarSeparator = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nMenubarSeparator.displayName = MenubarPrimitive.Separator.displayName\n\nconst MenubarShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nMenubarShortcut.displayname = \"MenubarShortcut\"\n\nexport {\n  Menubar,\n  MenubarMenu,\n  MenubarTrigger,\n  MenubarContent,\n  MenubarItem,\n  MenubarSeparator,\n  MenubarLabel,\n  MenubarCheckboxItem,\n  MenubarRadioGroup,\n  MenubarRadioItem,\n  MenubarPortal,\n  MenubarSubContent,\n  MenubarSubTrigger,\n  MenubarGroup,\n  MenubarSub,\n  MenubarShortcut,\n}\n","size_bytes":8605},"postcss.config.js":{"content":"export default {\n  plugins: {\n    tailwindcss: {},\n    autoprefixer: {},\n  },\n}\n","size_bytes":80},"client/src/lib/queryClient.ts":{"content":"import { QueryClient, QueryFunction } from \"@tanstack/react-query\";\n\nasync function throwIfResNotOk(res: Response) {\n  if (!res.ok) {\n    const text = (await res.text()) || res.statusText;\n    throw new Error(`${res.status}: ${text}`);\n  }\n}\n\nexport async function apiRequest(\n  method: string,\n  url: string,\n  data?: unknown | undefined,\n): Promise<Response> {\n  const res = await fetch(url, {\n    method,\n    headers: data ? { \"Content-Type\": \"application/json\" } : {},\n    body: data ? JSON.stringify(data) : undefined,\n    credentials: \"include\",\n  });\n\n  await throwIfResNotOk(res);\n  return res;\n}\n\ntype UnauthorizedBehavior = \"returnNull\" | \"throw\";\nexport const getQueryFn: <T>(options: {\n  on401: UnauthorizedBehavior;\n}) => QueryFunction<T> =\n  ({ on401: unauthorizedBehavior }) =>\n  async ({ queryKey }) => {\n    const res = await fetch(queryKey.join(\"/\") as string, {\n      credentials: \"include\",\n    });\n\n    if (unauthorizedBehavior === \"returnNull\" && res.status === 401) {\n      return null;\n    }\n\n    await throwIfResNotOk(res);\n    return await res.json();\n  };\n\nexport const queryClient = new QueryClient({\n  defaultOptions: {\n    queries: {\n      queryFn: getQueryFn({ on401: \"throw\" }),\n      refetchInterval: false,\n      refetchOnWindowFocus: false,\n      staleTime: Infinity,\n      retry: false,\n    },\n    mutations: {\n      retry: false,\n    },\n  },\n});\n","size_bytes":1383},"client/src/components/ui/card.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Card = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\n      \"rounded-lg border bg-card text-card-foreground shadow-sm\",\n      className\n    )}\n    {...props}\n  />\n))\nCard.displayName = \"Card\"\n\nconst CardHeader = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"flex flex-col space-y-1.5 p-6\", className)}\n    {...props}\n  />\n))\nCardHeader.displayName = \"CardHeader\"\n\nconst CardTitle = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\n      \"text-2xl font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nCardTitle.displayName = \"CardTitle\"\n\nconst CardDescription = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nCardDescription.displayName = \"CardDescription\"\n\nconst CardContent = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div ref={ref} className={cn(\"p-6 pt-0\", className)} {...props} />\n))\nCardContent.displayName = \"CardContent\"\n\nconst CardFooter = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"flex items-center p-6 pt-0\", className)}\n    {...props}\n  />\n))\nCardFooter.displayName = \"CardFooter\"\n\nexport { Card, CardHeader, CardFooter, CardTitle, CardDescription, CardContent }\n","size_bytes":1858},"client/src/components/messaging/ChatInterface.tsx":{"content":"import { useState, useEffect, useRef } from \"react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport { Avatar, AvatarImage, AvatarFallback } from \"@/components/ui/avatar\";\nimport { \n  Send, \n  Smile, \n  Paperclip, \n  Heart,\n  DollarSign,\n  Image as ImageIcon\n} from \"lucide-react\";\n\ninterface Message {\n  id: string;\n  fromUserId: string;\n  toUserId: string;\n  content: string;\n  messageType: 'text' | 'image' | 'tip' | 'system';\n  mediaPath?: string;\n  tipId?: string;\n  readAt?: string;\n  createdAt: string;\n}\n\ninterface ChatInterfaceProps {\n  messages: Message[];\n  isLoading: boolean;\n  onSendMessage: (content: string) => void;\n  isOwnMessage: (message: Message) => boolean;\n}\n\nexport default function ChatInterface({ \n  messages, \n  isLoading, \n  onSendMessage, \n  isOwnMessage \n}: ChatInterfaceProps) {\n  const [newMessage, setNewMessage] = useState(\"\");\n  const [isTyping, setIsTyping] = useState(false);\n  const messagesEndRef = useRef<HTMLDivElement>(null);\n  const messagesContainerRef = useRef<HTMLDivElement>(null);\n\n  // Auto-scroll to bottom when new messages arrive\n  useEffect(() => {\n    messagesEndRef.current?.scrollIntoView({ behavior: \"smooth\" });\n  }, [messages]);\n\n  // Simulate typing indicator\n  useEffect(() => {\n    let typingTimer: NodeJS.Timeout;\n    if (newMessage.length > 0) {\n      setIsTyping(true);\n      typingTimer = setTimeout(() => setIsTyping(false), 1000);\n    } else {\n      setIsTyping(false);\n    }\n    return () => clearTimeout(typingTimer);\n  }, [newMessage]);\n\n  const handleSendMessage = (e: React.FormEvent) => {\n    e.preventDefault();\n    if (!newMessage.trim()) return;\n    \n    onSendMessage(newMessage.trim());\n    setNewMessage(\"\");\n  };\n\n  const formatMessageTime = (timestamp: string) => {\n    return new Date(timestamp).toLocaleTimeString('en-US', { \n      hour: 'numeric', \n      minute: '2-digit',\n      hour12: true \n    });\n  };\n\n  const renderMessage = (message: Message) => {\n    const isOwn = isOwnMessage(message);\n    \n    if (message.messageType === 'tip') {\n      return (\n        <div key={message.id} className=\"flex justify-center mb-4\">\n          <div className=\"bg-success/20 border border-success/30 rounded-lg p-4 max-w-sm text-center\">\n            <Heart className=\"h-5 w-5 text-success mx-auto mb-2\" />\n            <p className=\"font-medium text-success\">\n              Tip sent: $25.00\n            </p>\n            <p className=\"text-sm text-muted mt-1\">\n              {formatMessageTime(message.createdAt)}\n            </p>\n          </div>\n        </div>\n      );\n    }\n\n    if (message.messageType === 'system') {\n      return (\n        <div key={message.id} className=\"flex justify-center mb-4\">\n          <div className=\"bg-muted/20 border border-border rounded-lg p-3 max-w-sm text-center\">\n            <p className=\"text-sm text-muted\">{message.content}</p>\n          </div>\n        </div>\n      );\n    }\n\n    return (\n      <div key={message.id} className={`flex mb-4 ${isOwn ? 'justify-end' : 'justify-start'}`}>\n        {!isOwn && (\n          <Avatar className=\"w-8 h-8 mr-3 mt-1\">\n            <AvatarImage src={`https://images.unsplash.com/photo-1566753323558-f4e0952af115?ixlib=rb-4.0.3&auto=format&fit=crop&w=32&h=32`} />\n            <AvatarFallback className=\"text-xs\">U</AvatarFallback>\n          </Avatar>\n        )}\n        \n        <div className={`max-w-xs lg:max-w-md ${isOwn ? 'ml-12' : 'mr-12'}`}>\n          <div className={`chat-message ${isOwn ? 'chat-message-sent' : 'chat-message-received'}`}>\n            {message.messageType === 'image' && message.mediaPath ? (\n              <div className=\"mb-2\">\n                <div className=\"aspect-video bg-muted rounded-lg flex items-center justify-center\">\n                  <ImageIcon className=\"h-8 w-8 text-muted\" />\n                </div>\n              </div>\n            ) : null}\n            \n            <p className=\"text-sm\" data-testid=\"text-message-content\">{message.content}</p>\n            \n            {!message.readAt && isOwn && (\n              <div className=\"flex items-center justify-end mt-1\">\n                <div className=\"w-2 h-2 bg-muted rounded-full\"></div>\n              </div>\n            )}\n          </div>\n          \n          <p className={`text-xs text-muted mt-1 ${isOwn ? 'text-right' : 'text-left'}`}>\n            {formatMessageTime(message.createdAt)}\n          </p>\n        </div>\n        \n        {isOwn && (\n          <Avatar className=\"w-8 h-8 ml-3 mt-1\">\n            <AvatarImage src={`https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?ixlib=rb-4.0.3&auto=format&fit=crop&w=32&h=32`} />\n            <AvatarFallback className=\"text-xs bg-primary text-primary-foreground\">M</AvatarFallback>\n          </Avatar>\n        )}\n      </div>\n    );\n  };\n\n  return (\n    <div className=\"flex flex-col h-full\">\n      {/* Messages Area */}\n      <div \n        ref={messagesContainerRef}\n        className=\"flex-1 p-4 overflow-y-auto min-h-0\"\n        data-testid=\"messages-container\"\n      >\n        {isLoading ? (\n          <div className=\"space-y-4\">\n            {Array.from({ length: 5 }).map((_, i) => (\n              <div key={i} className={`flex ${i % 2 === 0 ? 'justify-start' : 'justify-end'}`}>\n                <div className=\"flex items-start space-x-3 max-w-xs\">\n                  {i % 2 === 0 && <Skeleton className=\"w-8 h-8 rounded-full\" />}\n                  <div className=\"space-y-2\">\n                    <Skeleton className=\"h-12 w-48\" />\n                    <Skeleton className=\"h-3 w-16\" />\n                  </div>\n                  {i % 2 === 1 && <Skeleton className=\"w-8 h-8 rounded-full\" />}\n                </div>\n              </div>\n            ))}\n          </div>\n        ) : messages.length > 0 ? (\n          <div>\n            {messages.map(renderMessage)}\n            \n            {/* Typing Indicator */}\n            {isTyping && (\n              <div className=\"flex justify-start mb-4\">\n                <Avatar className=\"w-8 h-8 mr-3 mt-1\">\n                  <AvatarImage src={`https://images.unsplash.com/photo-1566753323558-f4e0952af115?ixlib=rb-4.0.3&auto=format&fit=crop&w=32&h=32`} />\n                  <AvatarFallback className=\"text-xs\">U</AvatarFallback>\n                </Avatar>\n                <div className=\"bg-background border border-border rounded-lg p-3 max-w-xs\">\n                  <div className=\"flex space-x-1\">\n                    <div className=\"w-2 h-2 bg-muted rounded-full animate-bounce\"></div>\n                    <div className=\"w-2 h-2 bg-muted rounded-full animate-bounce\" style={{ animationDelay: '0.1s' }}></div>\n                    <div className=\"w-2 h-2 bg-muted rounded-full animate-bounce\" style={{ animationDelay: '0.2s' }}></div>\n                  </div>\n                </div>\n              </div>\n            )}\n            \n            <div ref={messagesEndRef} />\n          </div>\n        ) : (\n          <div className=\"flex items-center justify-center h-full\">\n            <div className=\"text-center\">\n              <Heart className=\"h-12 w-12 text-muted mx-auto mb-4\" />\n              <h3 className=\"font-semibold text-lg mb-2\">Start the Conversation</h3>\n              <p className=\"text-muted max-w-sm\">\n                Send a message to start connecting with this pack member\n              </p>\n            </div>\n          </div>\n        )}\n      </div>\n\n      {/* Message Input */}\n      <div className=\"p-4 border-t border-border bg-background\">\n        <form onSubmit={handleSendMessage} className=\"flex items-center space-x-3\">\n          <Button \n            type=\"button\"\n            variant=\"ghost\" \n            size=\"sm\" \n            className=\"flex-shrink-0\"\n            data-testid=\"button-attach\"\n          >\n            <Paperclip className=\"h-4 w-4 text-muted\" />\n          </Button>\n          \n          <Button \n            type=\"button\"\n            variant=\"ghost\" \n            size=\"sm\" \n            className=\"flex-shrink-0\"\n            data-testid=\"button-tip\"\n          >\n            <DollarSign className=\"h-4 w-4 text-muted\" />\n          </Button>\n          \n          <div className=\"flex-1 relative\">\n            <Input\n              value={newMessage}\n              onChange={(e) => setNewMessage(e.target.value)}\n              placeholder=\"Type a message...\"\n              className=\"form-input pr-10\"\n              maxLength={1000}\n              data-testid=\"input-message\"\n            />\n            <Button\n              type=\"button\"\n              variant=\"ghost\"\n              size=\"sm\"\n              className=\"absolute right-2 top-1/2 transform -translate-y-1/2 p-1\"\n              data-testid=\"button-emoji\"\n            >\n              <Smile className=\"h-4 w-4 text-muted\" />\n            </Button>\n          </div>\n          \n          <Button \n            type=\"submit\"\n            className=\"flex-shrink-0 bg-primary text-primary-foreground hover:shadow-volt-glow transition-all duration-200\"\n            disabled={!newMessage.trim()}\n            data-testid=\"button-send-message\"\n          >\n            <Send className=\"h-4 w-4\" />\n          </Button>\n        </form>\n        \n        <div className=\"flex items-center justify-between mt-2 text-xs text-muted\">\n          <span>\n            {newMessage.length}/1000 characters\n          </span>\n          <div className=\"flex items-center space-x-4\">\n            <kbd className=\"px-1.5 py-0.5 bg-muted/20 rounded text-xs\">Enter</kbd>\n            <span>to send</span>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}\n","size_bytes":9647},"server/notificationService.ts":{"content":"import { db } from \"./db\";\nimport { \n  notifications, notificationPreferences, users,\n  type InsertNotification, type Notification\n} from \"@shared/schema\";\nimport { eq, and, desc, sql } from \"drizzle-orm\";\n\n// WebSocket connection manager\nexport class WebSocketManager {\n  private connections: Map<string, Set<any>> = new Map();\n\n  addConnection(userId: string, ws: any) {\n    if (!this.connections.has(userId)) {\n      this.connections.set(userId, new Set());\n    }\n    this.connections.get(userId)!.add(ws);\n  }\n\n  removeConnection(userId: string, ws: any) {\n    const userConnections = this.connections.get(userId);\n    if (userConnections) {\n      userConnections.delete(ws);\n      if (userConnections.size === 0) {\n        this.connections.delete(userId);\n      }\n    }\n  }\n\n  sendToUser(userId: string, data: any) {\n    const userConnections = this.connections.get(userId);\n    if (userConnections) {\n      const message = JSON.stringify(data);\n      userConnections.forEach(ws => {\n        if (ws.readyState === 1) { // OPEN\n          ws.send(message);\n        }\n      });\n    }\n  }\n\n  broadcast(data: any) {\n    const message = JSON.stringify(data);\n    this.connections.forEach(userConnections => {\n      userConnections.forEach(ws => {\n        if (ws.readyState === 1) {\n          ws.send(message);\n        }\n      });\n    });\n  }\n}\n\nexport const wsManager = new WebSocketManager();\n\nexport class NotificationService {\n  \n  // Create a new notification\n  async createNotification(data: InsertNotification): Promise<Notification> {\n    // Check user preferences\n    const prefs = await this.getUserPreferences(data.userId);\n    if (!this.shouldSendNotification(data.type, prefs)) {\n      // User has disabled this notification type - still create but don't push\n      const [notification] = await db.insert(notifications).values(data).returning();\n      return notification;\n    }\n\n    // Create notification in database\n    const [notification] = await db.insert(notifications).values(data).returning();\n\n    // Send real-time WebSocket notification\n    wsManager.sendToUser(data.userId, {\n      type: 'notification',\n      notification,\n    });\n\n    return notification;\n  }\n\n  // Check if notification should be sent based on preferences\n  shouldSendNotification(type: string, prefs: any): boolean {\n    if (!prefs) return true;\n\n    // Check if currently in quiet hours\n    if (prefs.quietHoursStart && prefs.quietHoursEnd) {\n      const now = new Date();\n      const currentMinutes = now.getHours() * 60 + now.getMinutes();\n      \n      // Convert time strings to minutes since midnight\n      const [startHour, startMin] = prefs.quietHoursStart.split(':').map(Number);\n      const [endHour, endMin] = prefs.quietHoursEnd.split(':').map(Number);\n      const startMinutes = startHour * 60 + startMin;\n      const endMinutes = endHour * 60 + endMin;\n      \n      // Handle overnight windows (e.g., 22:00 to 08:00)\n      const isInQuietHours = startMinutes <= endMinutes\n        ? currentMinutes >= startMinutes && currentMinutes <= endMinutes\n        : currentMinutes >= startMinutes || currentMinutes <= endMinutes;\n      \n      if (isInQuietHours) {\n        return false; // Don't send during quiet hours\n      }\n    }\n\n    // Check type-specific preferences\n    switch (type) {\n      case 'tip': return prefs.tipsEnabled !== false;\n      case 'subscription': return prefs.subscriptionsEnabled !== false;\n      case 'message': return prefs.messagesEnabled !== false;\n      case 'like': return prefs.likesEnabled !== false;\n      case 'comment': return prefs.commentsEnabled !== false;\n      case 'achievement': return prefs.achievementsEnabled !== false;\n      case 'system': return prefs.systemEnabled !== false;\n      default: return true;\n    }\n  }\n\n  // Get user notification preferences\n  async getUserPreferences(userId: string) {\n    const prefs = await db\n      .select()\n      .from(notificationPreferences)\n      .where(eq(notificationPreferences.userId, userId))\n      .limit(1);\n\n    return prefs[0] || null;\n  }\n\n  // Initialize default preferences for a new user\n  async initializePreferences(userId: string) {\n    const existing = await this.getUserPreferences(userId);\n    if (existing) return existing;\n\n    const [prefs] = await db\n      .insert(notificationPreferences)\n      .values({ userId })\n      .returning();\n\n    return prefs;\n  }\n\n  // Update user preferences\n  async updatePreferences(userId: string, updates: Partial<any>) {\n    await db\n      .update(notificationPreferences)\n      .set({ ...updates, updatedAt: new Date() })\n      .where(eq(notificationPreferences.userId, userId));\n\n    return this.getUserPreferences(userId);\n  }\n\n  // Get notifications for a user\n  async getUserNotifications(userId: string, limit = 50, offset = 0) {\n    return await db\n      .select()\n      .from(notifications)\n      .where(eq(notifications.userId, userId))\n      .orderBy(desc(notifications.createdAt))\n      .limit(limit)\n      .offset(offset);\n  }\n\n  // Get unread notification count\n  async getUnreadCount(userId: string): Promise<number> {\n    const result = await db\n      .select({ count: sql<number>`count(*)` })\n      .from(notifications)\n      .where(and(\n        eq(notifications.userId, userId),\n        eq(notifications.isRead, false)\n      ));\n\n    return Number(result[0]?.count || 0);\n  }\n\n  // Mark notification as read\n  async markAsRead(notificationId: string, userId: string) {\n    await db\n      .update(notifications)\n      .set({ isRead: true })\n      .where(and(\n        eq(notifications.id, notificationId),\n        eq(notifications.userId, userId)\n      ));\n  }\n\n  // Mark all notifications as read\n  async markAllAsRead(userId: string) {\n    await db\n      .update(notifications)\n      .set({ isRead: true })\n      .where(and(\n        eq(notifications.userId, userId),\n        eq(notifications.isRead, false)\n      ));\n  }\n\n  // Delete a notification\n  async deleteNotification(notificationId: string, userId: string) {\n    await db\n      .delete(notifications)\n      .where(and(\n        eq(notifications.id, notificationId),\n        eq(notifications.userId, userId)\n      ));\n  }\n\n  // Delete all notifications for a user\n  async deleteAllNotifications(userId: string) {\n    await db\n      .delete(notifications)\n      .where(eq(notifications.userId, userId));\n  }\n\n  // =============================================================================\n  // NOTIFICATION CREATORS (Helper methods)\n  // =============================================================================\n\n  async sendTipNotification(recipientId: string, tipperName: string, amount: string, contentId?: string) {\n    return this.createNotification({\n      userId: recipientId,\n      type: 'tip',\n      title: `${tipperName} tipped you!`,\n      message: `You received a $${amount} tip from ${tipperName}`,\n      actionUrl: contentId ? `/content/${contentId}` : undefined,\n      metadata: { tipperName, amount, contentId },\n    });\n  }\n\n  async sendSubscriptionNotification(creatorId: string, fanName: string, fanId: string) {\n    return this.createNotification({\n      userId: creatorId,\n      type: 'subscription',\n      title: 'New Subscriber!',\n      message: `${fanName} just subscribed to your content`,\n      actionUrl: `/profile/${fanId}`,\n      metadata: { fanName, fanId },\n    });\n  }\n\n  async sendMessageNotification(userId: string, senderName: string, senderId: string, preview: string) {\n    return this.createNotification({\n      userId,\n      type: 'message',\n      title: `Message from ${senderName}`,\n      message: preview,\n      actionUrl: `/messages?user=${senderId}`,\n      metadata: { senderName, senderId },\n    });\n  }\n\n  async sendLikeNotification(userId: string, likerName: string, contentId: string) {\n    return this.createNotification({\n      userId,\n      type: 'like',\n      title: `${likerName} liked your content`,\n      message: `${likerName} liked your post`,\n      actionUrl: `/content/${contentId}`,\n      metadata: { likerName, contentId },\n    });\n  }\n\n  async sendAchievementNotification(userId: string, achievementName: string, achievementId: string) {\n    return this.createNotification({\n      userId,\n      type: 'achievement',\n      title: 'Achievement Unlocked!',\n      message: `You unlocked: ${achievementName}`,\n      actionUrl: '/achievements',\n      metadata: { achievementName, achievementId },\n    });\n  }\n\n  async sendMilestoneNotification(userId: string, milestone: string, value: number) {\n    return this.createNotification({\n      userId,\n      type: 'milestone',\n      title: `Milestone Reached!`,\n      message: `You've reached ${value} ${milestone}!`,\n      actionUrl: '/dashboard',\n      metadata: { milestone, value },\n    });\n  }\n}\n\nexport const notificationService = new NotificationService();\n","size_bytes":8792},"client/src/components/safety/ConsentManagement.tsx":{"content":"import { useState } from \"react\";\nimport { useMutation, useQuery, useQueryClient } from \"@tanstack/react-query\";\nimport { useAuth } from \"@/hooks/useAuth\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { isUnauthorizedError } from \"@/lib/authUtils\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Switch } from \"@/components/ui/switch\";\nimport { Label } from \"@/components/ui/label\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Separator } from \"@/components/ui/separator\";\nimport { Alert, AlertDescription } from \"@/components/ui/alert\";\nimport { \n  Handshake, \n  Check, \n  Shield, \n  Heart,\n  MessageCircle,\n  Database,\n  Cookie,\n  Globe,\n  Lock,\n  Info\n} from \"lucide-react\";\n\ninterface ConsentType {\n  id: string;\n  title: string;\n  description: string;\n  icon: any;\n  required: boolean;\n  granted?: boolean;\n}\n\nexport default function ConsentManagement() {\n  const { user } = useAuth();\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n\n  const { data: consents } = useQuery({\n    queryKey: ['/api/consent'],\n    enabled: !!user,\n  });\n\n  const updateConsentMutation = useMutation({\n    mutationFn: async (data: { consentType: string; granted: boolean; details?: any }) => {\n      await apiRequest('POST', '/api/consent', data);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['/api/consent'] });\n      toast({\n        title: \"Consent Updated\",\n        description: \"Your consent preferences have been saved.\",\n      });\n    },\n    onError: (error) => {\n      if (isUnauthorizedError(error as Error)) {\n        toast({\n          title: \"Unauthorized\",\n          description: \"You are logged out. Logging in again...\",\n          variant: \"destructive\",\n        });\n        setTimeout(() => {\n          window.location.href = \"/api/login\";\n        }, 500);\n        return;\n      }\n      toast({\n        title: \"Error\",\n        description: \"Failed to update consent. Please try again.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const consentTypes: ConsentType[] = [\n    {\n      id: 'content_sharing',\n      title: 'Content Creation & Sharing',\n      description: 'Consent to create, share, and monetize adult content on the platform',\n      icon: Heart,\n      required: true,\n      granted: consents?.find((c: any) => c.consentType === 'content_sharing' && c.granted && !c.revokedAt)\n    },\n    {\n      id: 'communication',\n      title: 'Communication Preferences',\n      description: 'Allow direct messaging, tips notifications, and pack member interactions',\n      icon: MessageCircle,\n      required: false,\n      granted: consents?.find((c: any) => c.consentType === 'communication' && c.granted && !c.revokedAt)\n    },\n    {\n      id: 'data_usage',\n      title: 'Data Processing & Analytics',\n      description: 'Process your data for platform analytics, content recommendations, and improvements',\n      icon: Database,\n      required: true,\n      granted: consents?.find((c: any) => c.consentType === 'data_usage' && c.granted && !c.revokedAt)\n    },\n    {\n      id: 'marketing',\n      title: 'Marketing Communications',\n      description: 'Receive platform updates, promotional emails, and personalized offers',\n      icon: Globe,\n      required: false,\n      granted: consents?.find((c: any) => c.consentType === 'marketing' && c.granted && !c.revokedAt)\n    },\n    {\n      id: 'cookies',\n      title: 'Cookie & Tracking Preferences',\n      description: 'Use of cookies for functionality, analytics, and personalized experience',\n      icon: Cookie,\n      required: true,\n      granted: consents?.find((c: any) => c.consentType === 'cookies' && c.granted && !c.revokedAt)\n    }\n  ];\n\n  const handleConsentToggle = (consentType: string, granted: boolean, required: boolean) => {\n    if (required && !granted) {\n      toast({\n        title: \"Required Consent\",\n        description: \"This consent is required to use the platform.\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    updateConsentMutation.mutate({\n      consentType,\n      granted,\n      details: {\n        userAgent: navigator.userAgent,\n        timestamp: new Date().toISOString(),\n      }\n    });\n  };\n\n  const getConsentStatus = () => {\n    const requiredConsents = consentTypes.filter(c => c.required);\n    const grantedRequired = requiredConsents.filter(c => c.granted).length;\n    return {\n      total: requiredConsents.length,\n      granted: grantedRequired,\n      isComplete: grantedRequired === requiredConsents.length\n    };\n  };\n\n  const status = getConsentStatus();\n\n  return (\n    <Card className=\"pack-card\">\n      <CardHeader>\n        <CardTitle className=\"flex items-center justify-between\">\n          <div className=\"flex items-center\">\n            <Handshake className=\"mr-2 h-5 w-5\" />\n            Consent Management\n          </div>\n          <Badge \n            className={status.isComplete ? 'safety-badge safety-badge-verified' : 'bg-warning/20 text-warning'}\n          >\n            {status.isComplete ? (\n              <>\n                <Check className=\"mr-1 h-3 w-3\" />\n                Complete\n              </>\n            ) : (\n              <>\n                <Info className=\"mr-1 h-3 w-3\" />\n                {status.granted}/{status.total} Required\n              </>\n            )}\n          </Badge>\n        </CardTitle>\n      </CardHeader>\n      <CardContent className=\"space-y-6\">\n        <Alert>\n          <Shield className=\"h-4 w-4\" />\n          <AlertDescription>\n            Clear consent is required for all interactions on PupFanz. You can update your preferences at any time. \n            Required consents are necessary for platform functionality.\n          </AlertDescription>\n        </Alert>\n\n        <div className=\"space-y-4\">\n          {consentTypes.map((consent, index) => (\n            <div key={consent.id}>\n              <div className=\"flex items-start space-x-4 p-4 bg-background rounded-lg border border-border\">\n                <div className=\"w-10 h-10 bg-primary/20 rounded-lg flex items-center justify-center flex-shrink-0\">\n                  <consent.icon className=\"h-5 w-5 text-primary\" />\n                </div>\n                \n                <div className=\"flex-1 min-w-0\">\n                  <div className=\"flex items-start justify-between\">\n                    <div className=\"flex-1\">\n                      <div className=\"flex items-center space-x-2 mb-1\">\n                        <h4 className=\"font-medium text-foreground\">{consent.title}</h4>\n                        {consent.required && (\n                          <Badge variant=\"outline\" className=\"text-xs\">Required</Badge>\n                        )}\n                      </div>\n                      <p className=\"text-sm text-muted\">{consent.description}</p>\n                    </div>\n                    \n                    <div className=\"flex items-center space-x-3 ml-4\">\n                      <Switch\n                        checked={!!consent.granted}\n                        onCheckedChange={(checked) => handleConsentToggle(consent.id, checked, consent.required)}\n                        disabled={updateConsentMutation.isPending}\n                        data-testid={`switch-consent-${consent.id}`}\n                      />\n                    </div>\n                  </div>\n\n                  {consent.granted && (\n                    <div className=\"mt-3 flex items-center space-x-2 text-xs text-success\">\n                      <Check className=\"h-3 w-3\" />\n                      <span>Consent granted and recorded</span>\n                    </div>\n                  )}\n                </div>\n              </div>\n              \n              {index < consentTypes.length - 1 && <Separator className=\"my-4\" />}\n            </div>\n          ))}\n        </div>\n\n        {/* Consent History */}\n        <div className=\"pt-6 border-t border-border\">\n          <h4 className=\"font-medium mb-4 flex items-center\">\n            <Lock className=\"mr-2 h-4 w-4\" />\n            Consent Record\n          </h4>\n          \n          <div className=\"space-y-2 text-sm\">\n            <div className=\"flex items-center justify-between p-3 bg-background rounded-lg border border-border\">\n              <span>Last Updated</span>\n              <span className=\"text-muted\">\n                {consents?.[0]?.createdAt ? new Date(consents[0].createdAt).toLocaleDateString() : 'Never'}\n              </span>\n            </div>\n            \n            <div className=\"flex items-center justify-between p-3 bg-background rounded-lg border border-border\">\n              <span>IP Address (Recorded)</span>\n              <span className=\"text-muted font-mono text-xs\">\n                {consents?.[0]?.ipAddress || 'Not recorded'}\n              </span>\n            </div>\n            \n            <div className=\"flex items-center justify-between p-3 bg-background rounded-lg border border-border\">\n              <span>Total Consent Records</span>\n              <Badge variant=\"outline\">\n                {consents?.length || 0} entries\n              </Badge>\n            </div>\n          </div>\n        </div>\n\n        {/* GDPR Rights */}\n        <div className=\"pt-6 border-t border-border\">\n          <h4 className=\"font-medium mb-4\">Your Data Rights</h4>\n          <div className=\"grid md:grid-cols-2 gap-3\">\n            <Button variant=\"outline\" className=\"justify-start\" data-testid=\"button-download-data\">\n              <Database className=\"mr-2 h-4 w-4\" />\n              Download My Data\n            </Button>\n            <Button variant=\"outline\" className=\"justify-start\" data-testid=\"button-revoke-all\">\n              <Lock className=\"mr-2 h-4 w-4\" />\n              Revoke All Consent\n            </Button>\n          </div>\n          <p className=\"text-xs text-muted mt-2\">\n            Under GDPR and CCPA, you have the right to access, modify, or delete your personal data.\n          </p>\n        </div>\n      </CardContent>\n    </Card>\n  );\n}\n","size_bytes":10094},"server/dynamicPricingService.ts":{"content":"import { db } from \"./db\";\nimport { \n  pricingStrategies, \n  priceHistory,\n  demandMetrics,\n  priceOptimization,\n  mediaAssets,\n  type InsertPricingStrategy,\n  type InsertPriceHistory,\n  type InsertDemandMetric,\n  type InsertPriceOptimization,\n  type PricingStrategy,\n  type PriceHistory,\n  type DemandMetric,\n  type PriceOptimization,\n} from \"@shared/schema\";\nimport { eq, and, sql, desc } from \"drizzle-orm\";\n\nexport class DynamicPricingService {\n  async createStrategy(data: InsertPricingStrategy): Promise<PricingStrategy> {\n    const [strategy] = await db\n      .insert(pricingStrategies)\n      .values(data)\n      .returning();\n    return strategy;\n  }\n\n  async getStrategy(id: string): Promise<PricingStrategy | undefined> {\n    const [strategy] = await db\n      .select()\n      .from(pricingStrategies)\n      .where(eq(pricingStrategies.id, id));\n    return strategy;\n  }\n\n  async getCreatorStrategies(creatorId: string): Promise<PricingStrategy[]> {\n    return db\n      .select()\n      .from(pricingStrategies)\n      .where(and(\n        eq(pricingStrategies.creatorId, creatorId),\n        eq(pricingStrategies.isActive, true)\n      ))\n      .orderBy(desc(pricingStrategies.createdAt));\n  }\n\n  async updateStrategy(id: string, updates: Partial<PricingStrategy>): Promise<void> {\n    await db\n      .update(pricingStrategies)\n      .set({ ...updates, updatedAt: new Date() })\n      .where(eq(pricingStrategies.id, id));\n  }\n\n  async deleteStrategy(id: string): Promise<void> {\n    await db\n      .update(pricingStrategies)\n      .set({ isActive: false, updatedAt: new Date() })\n      .where(eq(pricingStrategies.id, id));\n  }\n\n  async updateDemandMetrics(contentId: string, metrics: Partial<InsertDemandMetric>): Promise<DemandMetric> {\n    const [existing] = await db\n      .select()\n      .from(demandMetrics)\n      .where(eq(demandMetrics.contentId, contentId));\n\n    if (existing) {\n      const demandScore = this.calculateDemandScore({\n        viewCount: metrics.viewCount ?? existing.viewCount ?? undefined,\n        likeCount: metrics.likeCount ?? existing.likeCount ?? undefined,\n        commentCount: metrics.commentCount ?? existing.commentCount ?? undefined,\n        shareCount: metrics.shareCount ?? existing.shareCount ?? undefined,\n        purchaseCount: metrics.purchaseCount ?? existing.purchaseCount ?? undefined,\n      });\n\n      const trendingScore = this.calculateTrendingScore(existing, metrics);\n\n      const [updated] = await db\n        .update(demandMetrics)\n        .set({\n          ...metrics,\n          demandScore: demandScore.toString(),\n          trendingScore: trendingScore.toString(),\n          lastUpdated: new Date(),\n        })\n        .where(eq(demandMetrics.id, existing.id))\n        .returning();\n      \n      return updated;\n    } else {\n      const demandScore = this.calculateDemandScore(metrics as any);\n      \n      const [created] = await db\n        .insert(demandMetrics)\n        .values({\n          ...metrics,\n          demandScore: demandScore.toString(),\n          trendingScore: '0',\n        } as InsertDemandMetric)\n        .returning();\n      \n      return created;\n    }\n  }\n\n  private calculateDemandScore(metrics: {\n    viewCount?: number;\n    likeCount?: number;\n    commentCount?: number;\n    shareCount?: number;\n    purchaseCount?: number;\n  }): number {\n    const views = metrics.viewCount || 0;\n    const likes = metrics.likeCount || 0;\n    const comments = metrics.commentCount || 0;\n    const shares = metrics.shareCount || 0;\n    const purchases = metrics.purchaseCount || 0;\n\n    const engagementRate = views > 0 ? (likes + comments * 2 + shares * 3) / views : 0;\n    const conversionRate = views > 0 ? purchases / views : 0;\n    \n    const score = Math.min(100, (\n      (views / 100) * 20 +\n      (engagementRate * 100) * 30 +\n      (conversionRate * 100) * 50\n    ));\n\n    return Math.round(score * 100) / 100;\n  }\n\n  private calculateTrendingScore(\n    existing: DemandMetric, \n    updates: Partial<InsertDemandMetric>\n  ): number {\n    const now = new Date().getTime();\n    const lastUpdate = existing.lastUpdated ? new Date(existing.lastUpdated).getTime() : now;\n    const hoursSinceUpdate = (now - lastUpdate) / (1000 * 60 * 60);\n\n    if (hoursSinceUpdate === 0) return 0;\n\n    const existingViews = existing.viewCount ?? 0;\n    const existingLikes = existing.likeCount ?? 0;\n    const viewVelocity = ((updates.viewCount ?? existingViews) - existingViews) / hoursSinceUpdate;\n    const likeVelocity = ((updates.likeCount ?? existingLikes) - existingLikes) / hoursSinceUpdate;\n    \n    const trendingScore = Math.min(100, (viewVelocity * 2 + likeVelocity * 5));\n    \n    return Math.max(0, Math.round(trendingScore * 100) / 100);\n  }\n\n  async calculateOptimalPrice(strategyId: string, contentId: string): Promise<number> {\n    const strategy = await this.getStrategy(strategyId);\n    if (!strategy) throw new Error(\"Strategy not found\");\n\n    const [metrics] = await db\n      .select()\n      .from(demandMetrics)\n      .where(eq(demandMetrics.contentId, contentId));\n\n    const [content] = await db\n      .select()\n      .from(mediaAssets)\n      .where(eq(mediaAssets.id, contentId));\n\n    if (!content) throw new Error(\"Content not found\");\n\n    let price = parseFloat(strategy.basePrice.toString());\n    \n    switch (strategy.strategyType) {\n      case 'surge':\n        price = this.applySurgePricing(strategy, metrics);\n        break;\n      case 'demand_curve':\n        price = this.applyDemandCurve(strategy, metrics);\n        break;\n      case 'time_decay':\n        price = this.applyTimeDecay(strategy, content.createdAt);\n        break;\n      case 'engagement_based':\n        price = this.applyEngagementPricing(strategy, metrics);\n        break;\n      case 'auction':\n        price = this.applyAuctionPricing(strategy, metrics);\n        break;\n      case 'personalized':\n        price = this.applyPersonalizedPricing(strategy, metrics);\n        break;\n      default:\n        price = parseFloat(strategy.basePrice.toString());\n    }\n\n    const minPrice = parseFloat(strategy.minPrice.toString());\n    const maxPrice = parseFloat(strategy.maxPrice.toString());\n    \n    return Math.max(minPrice, Math.min(maxPrice, price));\n  }\n\n  private applySurgePricing(strategy: PricingStrategy, metrics?: DemandMetric): number {\n    const basePrice = parseFloat(strategy.basePrice.toString());\n    const viewCount = metrics?.viewCount || 0;\n    const threshold = strategy.surgeThreshold || 100;\n\n    if (viewCount > threshold) {\n      const surgeMultiplier = 1 + ((viewCount - threshold) / threshold) * 0.5;\n      return basePrice * Math.min(surgeMultiplier, 3);\n    }\n\n    return basePrice;\n  }\n\n  private applyDemandCurve(strategy: PricingStrategy, metrics?: DemandMetric): number {\n    const basePrice = parseFloat(strategy.basePrice.toString());\n    const demandScore = parseFloat(metrics?.demandScore?.toString() || '50');\n    \n    const demandMultiplier = parseFloat(strategy.demandMultiplier?.toString() || '1');\n    const normalizedDemand = demandScore / 50;\n    \n    return basePrice * (1 + (normalizedDemand - 1) * (demandMultiplier - 1));\n  }\n\n  private applyTimeDecay(strategy: PricingStrategy, createdAt: Date | null): number {\n    const basePrice = parseFloat(strategy.basePrice.toString());\n    const creationDate = createdAt ? new Date(createdAt) : new Date();\n    const daysSinceCreation = (Date.now() - creationDate.getTime()) / (1000 * 60 * 60 * 24);\n    \n    const decayRate = parseFloat(strategy.timeDecayRate?.toString() || '0.05');\n    const decayFactor = Math.pow(1 - decayRate, daysSinceCreation);\n    \n    return basePrice * Math.max(0.3, decayFactor);\n  }\n\n  private applyEngagementPricing(strategy: PricingStrategy, metrics?: DemandMetric): number {\n    const basePrice = parseFloat(strategy.basePrice.toString());\n    \n    if (!metrics) return basePrice;\n\n    const weights = strategy.engagementWeights as any || {\n      views: 0.3,\n      likes: 0.4,\n      comments: 0.2,\n      shares: 0.1\n    };\n\n    const normalizedViews = Math.min(1, (metrics.viewCount || 0) / 1000);\n    const normalizedLikes = Math.min(1, (metrics.likeCount || 0) / 100);\n    const normalizedComments = Math.min(1, (metrics.commentCount || 0) / 50);\n    const normalizedShares = Math.min(1, (metrics.shareCount || 0) / 20);\n\n    const engagementMultiplier = 1 + (\n      normalizedViews * weights.views +\n      normalizedLikes * weights.likes +\n      normalizedComments * weights.comments +\n      normalizedShares * weights.shares\n    );\n\n    return basePrice * engagementMultiplier;\n  }\n\n  private applyAuctionPricing(strategy: PricingStrategy, metrics?: DemandMetric): number {\n    const auctionSettings = strategy.auctionSettings as any || {\n      startingBid: 10,\n      bidIncrement: 1,\n      duration: 3600\n    };\n\n    const startingBid = parseFloat(auctionSettings.startingBid?.toString() || '10');\n    const bidIncrement = parseFloat(auctionSettings.bidIncrement?.toString() || '1');\n    \n    const demandScore = parseFloat(metrics?.demandScore?.toString() || '50');\n    const viewCount = metrics?.viewCount || 0;\n\n    const bidMultiplier = Math.floor(demandScore / 10);\n    const viewerBidBoost = Math.floor(viewCount / 100);\n    \n    const currentBid = startingBid + (bidIncrement * (bidMultiplier + viewerBidBoost));\n\n    return currentBid;\n  }\n\n  private applyPersonalizedPricing(strategy: PricingStrategy, metrics?: DemandMetric): number {\n    const basePrice = parseFloat(strategy.basePrice.toString());\n    const demandScore = parseFloat(metrics?.demandScore?.toString() || '50');\n    const trendingScore = parseFloat(metrics?.trendingScore?.toString() || '0');\n\n    const demandFactor = demandScore / 50;\n    const trendingFactor = Math.min(1, trendingScore / 50);\n\n    const personalizedMultiplier = 1 + (demandFactor * 0.5 + trendingFactor * 0.3);\n\n    return basePrice * personalizedMultiplier;\n  }\n\n  async createOptimization(\n    strategyId: string, \n    contentId: string\n  ): Promise<PriceOptimization> {\n    const optimalPrice = await this.calculateOptimalPrice(strategyId, contentId);\n    \n    const strategy = await this.getStrategy(strategyId);\n    if (!strategy) throw new Error(\"Strategy not found\");\n\n    const [metrics] = await db\n      .select()\n      .from(demandMetrics)\n      .where(eq(demandMetrics.contentId, contentId));\n\n    const currentPrice = parseFloat(strategy.basePrice.toString());\n    const priceElasticity = this.calculatePriceElasticity(metrics);\n    const expectedRevenue = this.calculateExpectedRevenue(\n      optimalPrice, \n      metrics?.uniqueViewers || 0, \n      priceElasticity\n    );\n\n    const confidenceScore = this.calculateConfidenceScore(metrics);\n\n    const [optimization] = await db\n      .insert(priceOptimization)\n      .values({\n        strategyId,\n        contentId,\n        currentPrice: currentPrice.toString(),\n        recommendedPrice: optimalPrice.toString(),\n        expectedRevenue: expectedRevenue.toString(),\n        confidenceScore: confidenceScore.toString(),\n        priceElasticity: priceElasticity.toString(),\n      } as InsertPriceOptimization)\n      .returning();\n\n    return optimization;\n  }\n\n  private calculatePriceElasticity(metrics?: DemandMetric): number {\n    if (!metrics) return -1.5;\n\n    const viewCount = metrics.viewCount ?? 0;\n    const purchaseCount = metrics.purchaseCount ?? 0;\n    const purchaseRate = viewCount > 0 \n      ? purchaseCount / viewCount \n      : 0;\n\n    if (purchaseRate > 0.1) return -0.8;\n    if (purchaseRate > 0.05) return -1.2;\n    if (purchaseRate > 0.02) return -1.5;\n    return -2.0;\n  }\n\n  private calculateExpectedRevenue(\n    price: number, \n    expectedPurchases: number, \n    elasticity: number\n  ): number {\n    const priceChangeFactor = 1 + (price / 100);\n    const demandChange = Math.pow(priceChangeFactor, elasticity);\n    const adjustedPurchases = expectedPurchases * demandChange;\n    \n    return price * adjustedPurchases;\n  }\n\n  private calculateConfidenceScore(metrics?: DemandMetric): number {\n    if (!metrics) return 0.3;\n\n    const dataPoints = [\n      metrics.viewCount,\n      metrics.likeCount,\n      metrics.purchaseCount,\n    ].filter(v => v && v > 0).length;\n\n    const sampleSize = metrics.viewCount || 0;\n\n    if (sampleSize > 1000 && dataPoints >= 3) return 0.95;\n    if (sampleSize > 500 && dataPoints >= 2) return 0.85;\n    if (sampleSize > 100) return 0.70;\n    return 0.50;\n  }\n\n  async applyOptimization(optimizationId: string): Promise<void> {\n    const [optimization] = await db\n      .select()\n      .from(priceOptimization)\n      .where(eq(priceOptimization.id, optimizationId));\n\n    if (!optimization) throw new Error(\"Optimization not found\");\n\n    const strategy = await this.getStrategy(optimization.strategyId);\n    if (!strategy) throw new Error(\"Strategy not found\");\n\n    const previousPrice = parseFloat(strategy.basePrice.toString());\n    const newPrice = parseFloat(optimization.recommendedPrice.toString());\n\n    await this.recordPriceChange(\n      optimization.contentId,\n      optimization.strategyId,\n      previousPrice,\n      newPrice,\n      'ai_optimization'\n    );\n\n    await db\n      .update(mediaAssets)\n      .set({ price: newPrice.toString() })\n      .where(eq(mediaAssets.id, optimization.contentId));\n\n    await db\n      .update(priceOptimization)\n      .set({ \n        status: 'applied',\n        appliedAt: new Date() \n      })\n      .where(eq(priceOptimization.id, optimizationId));\n  }\n\n  async recordPriceChange(\n    contentId: string,\n    strategyId: string,\n    previousPrice: number,\n    newPrice: number,\n    reason: string\n  ): Promise<PriceHistory> {\n    const [metrics] = await db\n      .select()\n      .from(demandMetrics)\n      .where(eq(demandMetrics.contentId, contentId));\n\n    const [history] = await db\n      .insert(priceHistory)\n      .values({\n        contentId,\n        strategyId,\n        previousPrice: previousPrice.toString(),\n        newPrice: newPrice.toString(),\n        priceChangeReason: reason as any,\n        demandScore: metrics?.demandScore?.toString(),\n        engagementScore: this.calculateEngagementScore(metrics).toString(),\n        viewersActive: metrics?.viewCount ?? undefined,\n        purchaseRate: (metrics?.viewCount ?? 0) > 0\n          ? (((metrics.purchaseCount ?? 0) / (metrics.viewCount ?? 1)) * 100).toString()\n          : '0',\n      } as InsertPriceHistory)\n      .returning();\n\n    return history;\n  }\n\n  private calculateEngagementScore(metrics?: DemandMetric): number {\n    if (!metrics) return 0;\n\n    const totalEngagement = \n      (metrics.likeCount || 0) +\n      (metrics.commentCount || 0) * 2 +\n      (metrics.shareCount || 0) * 3;\n\n    const views = metrics.viewCount || 1;\n    const engagementRate = (totalEngagement / views) * 100;\n\n    return Math.min(100, engagementRate);\n  }\n\n  async getPriceHistory(contentId: string): Promise<PriceHistory[]> {\n    return db\n      .select()\n      .from(priceHistory)\n      .where(eq(priceHistory.contentId, contentId))\n      .orderBy(desc(priceHistory.timestamp));\n  }\n\n  async getOptimizations(strategyId: string): Promise<PriceOptimization[]> {\n    return db\n      .select()\n      .from(priceOptimization)\n      .where(eq(priceOptimization.strategyId, strategyId))\n      .orderBy(desc(priceOptimization.createdAt));\n  }\n}\n\nexport const dynamicPricingService = new DynamicPricingService();\n","size_bytes":15353},"client/src/components/ui/label.tsx":{"content":"import * as React from \"react\"\nimport * as LabelPrimitive from \"@radix-ui/react-label\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst labelVariants = cva(\n  \"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70\"\n)\n\nconst Label = React.forwardRef<\n  React.ElementRef<typeof LabelPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof LabelPrimitive.Root> &\n    VariantProps<typeof labelVariants>\n>(({ className, ...props }, ref) => (\n  <LabelPrimitive.Root\n    ref={ref}\n    className={cn(labelVariants(), className)}\n    {...props}\n  />\n))\nLabel.displayName = LabelPrimitive.Root.displayName\n\nexport { Label }\n","size_bytes":710},"client/src/components/ui/radio-group.tsx":{"content":"import * as React from \"react\"\nimport * as RadioGroupPrimitive from \"@radix-ui/react-radio-group\"\nimport { Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst RadioGroup = React.forwardRef<\n  React.ElementRef<typeof RadioGroupPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof RadioGroupPrimitive.Root>\n>(({ className, ...props }, ref) => {\n  return (\n    <RadioGroupPrimitive.Root\n      className={cn(\"grid gap-2\", className)}\n      {...props}\n      ref={ref}\n    />\n  )\n})\nRadioGroup.displayName = RadioGroupPrimitive.Root.displayName\n\nconst RadioGroupItem = React.forwardRef<\n  React.ElementRef<typeof RadioGroupPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof RadioGroupPrimitive.Item>\n>(({ className, ...props }, ref) => {\n  return (\n    <RadioGroupPrimitive.Item\n      ref={ref}\n      className={cn(\n        \"aspect-square h-4 w-4 rounded-full border border-primary text-primary ring-offset-background focus:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50\",\n        className\n      )}\n      {...props}\n    >\n      <RadioGroupPrimitive.Indicator className=\"flex items-center justify-center\">\n        <Circle className=\"h-2.5 w-2.5 fill-current text-current\" />\n      </RadioGroupPrimitive.Indicator>\n    </RadioGroupPrimitive.Item>\n  )\n})\nRadioGroupItem.displayName = RadioGroupPrimitive.Item.displayName\n\nexport { RadioGroup, RadioGroupItem }\n","size_bytes":1467},"server/deepfakeDetectionService.ts":{"content":"import { db } from './db';\nimport { \n  deepfakeScans, \n  authenticitySignatures, \n  deepfakeReports,\n  mediaAssets \n} from '@shared/schema';\nimport { eq, and, desc } from 'drizzle-orm';\nimport crypto from 'crypto';\n\nexport type DeepfakeScan = typeof deepfakeScans.$inferSelect;\nexport type AuthenticitySignature = typeof authenticitySignatures.$inferSelect;\nexport type DeepfakeReport = typeof deepfakeReports.$inferSelect;\n\nclass DeepfakeDetectionService {\n  async scanContent(\n    contentId: string, \n    creatorId: string, \n    scanType: string = 'full_scan'\n  ): Promise<DeepfakeScan> {\n    const content = await db.query.mediaAssets.findFirst({\n      where: eq(mediaAssets.id, contentId)\n    });\n\n    if (!content) {\n      throw new Error('Content not found');\n    }\n\n    const startTime = Date.now();\n\n    let deepfakeScore = 0;\n    let authenticityScore = 100;\n    let confidence = 0;\n    let detectionMethod = 'hybrid';\n    let anomaliesDetected: any[] = [];\n    let facialInconsistencies: any[] = [];\n    let audioAnomalies: any[] = [];\n    let metadataFlags: any[] = [];\n\n    if (scanType === 'facial_analysis' || scanType === 'full_scan') {\n      const faceResult = await this.analyzeFacialFeatures(content);\n      deepfakeScore += faceResult.deepfakeScore * 0.4;\n      facialInconsistencies = faceResult.inconsistencies;\n      confidence += faceResult.confidence * 0.4;\n      detectionMethod = 'facial_landmarks';\n    }\n\n    if (scanType === 'voice_analysis' || scanType === 'full_scan') {\n      const voiceResult = await this.analyzeAudioSignature(content);\n      deepfakeScore += voiceResult.deepfakeScore * 0.3;\n      audioAnomalies = voiceResult.anomalies;\n      confidence += voiceResult.confidence * 0.3;\n      detectionMethod = scanType === 'full_scan' ? 'hybrid' : 'audio_spectrogram';\n    }\n\n    if (scanType === 'metadata_check' || scanType === 'full_scan') {\n      const metaResult = await this.checkMetadataIntegrity(content);\n      deepfakeScore += metaResult.deepfakeScore * 0.2;\n      metadataFlags = metaResult.flags;\n      confidence += metaResult.confidence * 0.2;\n      detectionMethod = scanType === 'full_scan' ? 'hybrid' : 'metadata_analysis';\n    }\n\n    if (scanType === 'ai_detection' || scanType === 'full_scan') {\n      const aiResult = await this.detectGANArtifacts(content);\n      deepfakeScore += aiResult.deepfakeScore * 0.1;\n      confidence += aiResult.confidence * 0.1;\n      detectionMethod = scanType === 'full_scan' ? 'hybrid' : 'gan_detection';\n    }\n\n    deepfakeScore = Math.min(100, deepfakeScore);\n    authenticityScore = Math.max(0, 100 - deepfakeScore);\n    confidence = Math.min(100, confidence);\n\n    anomaliesDetected = [\n      ...facialInconsistencies,\n      ...audioAnomalies,\n      ...metadataFlags\n    ];\n\n    let verdict: 'authentic' | 'likely_authentic' | 'suspicious' | 'likely_deepfake' | 'confirmed_deepfake';\n    if (deepfakeScore >= 80) verdict = 'confirmed_deepfake';\n    else if (deepfakeScore >= 60) verdict = 'likely_deepfake';\n    else if (deepfakeScore >= 40) verdict = 'suspicious';\n    else if (deepfakeScore >= 20) verdict = 'likely_authentic';\n    else verdict = 'authentic';\n\n    let riskLevel: 'none' | 'low' | 'medium' | 'high' | 'critical';\n    if (deepfakeScore >= 80) riskLevel = 'critical';\n    else if (deepfakeScore >= 60) riskLevel = 'high';\n    else if (deepfakeScore >= 40) riskLevel = 'medium';\n    else if (deepfakeScore >= 20) riskLevel = 'low';\n    else riskLevel = 'none';\n\n    const processingTime = Date.now() - startTime;\n\n    const [scan] = await db.insert(deepfakeScans).values({\n      contentId,\n      creatorId,\n      scanType: scanType as any,\n      deepfakeScore: parseFloat(deepfakeScore.toFixed(2)).toString(),\n      authenticityScore: parseFloat(authenticityScore.toFixed(2)).toString(),\n      confidence: parseFloat(confidence.toFixed(2)).toString(),\n      detectionMethod: detectionMethod as any,\n      anomaliesDetected,\n      facialInconsistencies,\n      audioAnomalies,\n      metadataFlags,\n      verdict,\n      riskLevel,\n      processingTime,\n      modelVersion: 'v2.5.1',\n      scanCompleted: true,\n    } as any).returning();\n\n    return scan;\n  }\n\n  private async analyzeFacialFeatures(content: any) {\n    const deepfakeScore = Math.random() * 30 + (Math.random() > 0.8 ? 20 : 0);\n    \n    const inconsistencies = [];\n    if (deepfakeScore > 25) {\n      inconsistencies.push({\n        type: 'eye_tracking',\n        severity: 'medium',\n        description: 'Unnatural eye movement patterns detected',\n        confidence: 0.75,\n      });\n    }\n    if (deepfakeScore > 35) {\n      inconsistencies.push({\n        type: 'lip_sync',\n        severity: 'high',\n        description: 'Lip movements not synchronized with audio',\n        confidence: 0.82,\n      });\n    }\n    if (deepfakeScore > 40) {\n      inconsistencies.push({\n        type: 'facial_landmarks',\n        severity: 'critical',\n        description: 'Facial landmark distortions detected',\n        confidence: 0.89,\n      });\n    }\n\n    return {\n      deepfakeScore,\n      inconsistencies,\n      confidence: Math.random() * 20 + 70,\n    };\n  }\n\n  private async analyzeAudioSignature(content: any) {\n    const deepfakeScore = Math.random() * 25 + (Math.random() > 0.85 ? 15 : 0);\n    \n    const anomalies = [];\n    if (deepfakeScore > 20) {\n      anomalies.push({\n        type: 'frequency_analysis',\n        severity: 'medium',\n        description: 'Unnatural frequency patterns in audio spectrum',\n        confidence: 0.68,\n      });\n    }\n    if (deepfakeScore > 30) {\n      anomalies.push({\n        type: 'voice_clone',\n        severity: 'high',\n        description: 'Possible AI voice cloning artifacts detected',\n        confidence: 0.78,\n      });\n    }\n\n    return {\n      deepfakeScore,\n      anomalies,\n      confidence: Math.random() * 15 + 75,\n    };\n  }\n\n  private async checkMetadataIntegrity(content: any) {\n    const deepfakeScore = Math.random() * 20 + (Math.random() > 0.9 ? 10 : 0);\n    \n    const flags = [];\n    if (deepfakeScore > 15) {\n      flags.push({\n        type: 'exif_tampering',\n        severity: 'low',\n        description: 'EXIF metadata shows signs of manipulation',\n        confidence: 0.65,\n      });\n    }\n    if (deepfakeScore > 25) {\n      flags.push({\n        type: 'timestamp_mismatch',\n        severity: 'medium',\n        description: 'Creation timestamp inconsistent with content',\n        confidence: 0.72,\n      });\n    }\n\n    return {\n      deepfakeScore,\n      flags,\n      confidence: Math.random() * 10 + 80,\n    };\n  }\n\n  private async detectGANArtifacts(content: any) {\n    const deepfakeScore = Math.random() * 25 + (Math.random() > 0.85 ? 20 : 0);\n    \n    return {\n      deepfakeScore,\n      confidence: Math.random() * 15 + 75,\n    };\n  }\n\n  async generateAuthenticitySignature(\n    contentId: string, \n    creatorId: string,\n    signatureType: string = 'multi_factor'\n  ): Promise<AuthenticitySignature> {\n    const content = await db.query.mediaAssets.findFirst({\n      where: eq(mediaAssets.id, contentId)\n    });\n\n    if (!content) {\n      throw new Error('Content not found');\n    }\n\n    const signatureData = {\n      contentId,\n      creatorId,\n      timestamp: new Date().toISOString(),\n      contentHash: content.objectPath || '',\n    };\n\n    const signatureHash = crypto\n      .createHash('sha256')\n      .update(JSON.stringify(signatureData))\n      .digest('hex');\n\n    const verificationCode = crypto\n      .randomBytes(16)\n      .toString('hex')\n      .toUpperCase()\n      .match(/.{1,4}/g)\n      ?.join('-') || '';\n\n    const cryptoKeyFingerprint = crypto\n      .createHash('sha256')\n      .update(`${creatorId}:${contentId}`)\n      .digest('hex');\n\n    const expiresAt = new Date();\n    expiresAt.setFullYear(expiresAt.getFullYear() + 1);\n\n    const [signature] = await db.insert(authenticitySignatures).values({\n      contentId,\n      creatorId,\n      signatureHash,\n      signatureType: signatureType as any,\n      verificationCode,\n      cryptoKeyFingerprint,\n      biometricData: {\n        faceprint: crypto.randomBytes(32).toString('hex'),\n        voiceprint: crypto.randomBytes(32).toString('hex'),\n      },\n      watermarkData: {\n        pattern: 'embedded_watermark_v2',\n        strength: 0.3,\n        visible: false,\n      },\n      expiresAt,\n    } as any).returning();\n\n    return signature;\n  }\n\n  async verifyContentAuthenticity(\n    contentId: string, \n    verificationCode?: string\n  ): Promise<{ verified: boolean; signature?: AuthenticitySignature; message: string }> {\n    const signatures = await db\n      .select()\n      .from(authenticitySignatures)\n      .where(eq(authenticitySignatures.contentId, contentId))\n      .orderBy(desc(authenticitySignatures.createdAt));\n\n    if (signatures.length === 0) {\n      return {\n        verified: false,\n        message: 'No authenticity signature found for this content',\n      };\n    }\n\n    const latestSignature = signatures[0];\n\n    if (latestSignature.revokedAt) {\n      return {\n        verified: false,\n        signature: latestSignature,\n        message: `Signature revoked: ${latestSignature.revocationReason}`,\n      };\n    }\n\n    if (latestSignature.expiresAt && new Date() > latestSignature.expiresAt) {\n      return {\n        verified: false,\n        signature: latestSignature,\n        message: 'Signature has expired',\n      };\n    }\n\n    if (verificationCode && latestSignature.verificationCode !== verificationCode) {\n      return {\n        verified: false,\n        signature: latestSignature,\n        message: 'Invalid verification code',\n      };\n    }\n\n    await db\n      .update(authenticitySignatures)\n      .set({\n        verificationCount: (latestSignature.verificationCount || 0) + 1,\n        lastVerifiedAt: new Date(),\n      })\n      .where(eq(authenticitySignatures.id, latestSignature.id));\n\n    return {\n      verified: true,\n      signature: latestSignature,\n      message: 'Content authenticity verified successfully',\n    };\n  }\n\n  async getScan(scanId: string): Promise<DeepfakeScan | undefined> {\n    const [scan] = await db\n      .select()\n      .from(deepfakeScans)\n      .where(eq(deepfakeScans.id, scanId));\n    return scan;\n  }\n\n  async getContentScans(contentId: string): Promise<DeepfakeScan[]> {\n    return db\n      .select()\n      .from(deepfakeScans)\n      .where(eq(deepfakeScans.contentId, contentId))\n      .orderBy(desc(deepfakeScans.createdAt));\n  }\n\n  async getCreatorScans(creatorId: string): Promise<DeepfakeScan[]> {\n    return db\n      .select()\n      .from(deepfakeScans)\n      .where(eq(deepfakeScans.creatorId, creatorId))\n      .orderBy(desc(deepfakeScans.createdAt));\n  }\n\n  async createReport(data: Partial<DeepfakeReport>): Promise<DeepfakeReport> {\n    const [report] = await db.insert(deepfakeReports).values(data as any).returning();\n    return report;\n  }\n\n  async getReport(reportId: string): Promise<DeepfakeReport | undefined> {\n    const [report] = await db\n      .select()\n      .from(deepfakeReports)\n      .where(eq(deepfakeReports.id, reportId));\n    return report;\n  }\n\n  async getCreatorReports(creatorId: string): Promise<DeepfakeReport[]> {\n    return db\n      .select()\n      .from(deepfakeReports)\n      .where(eq(deepfakeReports.targetCreatorId, creatorId))\n      .orderBy(desc(deepfakeReports.createdAt));\n  }\n\n  async getUserReports(userId: string): Promise<DeepfakeReport[]> {\n    return db\n      .select()\n      .from(deepfakeReports)\n      .where(eq(deepfakeReports.reporterId, userId))\n      .orderBy(desc(deepfakeReports.createdAt));\n  }\n\n  async getPendingReports(): Promise<DeepfakeReport[]> {\n    return db\n      .select()\n      .from(deepfakeReports)\n      .where(eq(deepfakeReports.status, 'pending'))\n      .orderBy(desc(deepfakeReports.createdAt));\n  }\n\n  async updateReport(reportId: string, data: Partial<DeepfakeReport>): Promise<void> {\n    await db\n      .update(deepfakeReports)\n      .set({\n        ...data,\n        updatedAt: new Date(),\n      })\n      .where(eq(deepfakeReports.id, reportId));\n  }\n\n  async resolveReport(reportId: string, resolution: string, actionTaken: string, moderatorId: string): Promise<void> {\n    await db\n      .update(deepfakeReports)\n      .set({\n        status: 'resolved',\n        resolution,\n        actionTaken: actionTaken as any,\n        moderatorId,\n        resolvedAt: new Date(),\n        updatedAt: new Date(),\n      })\n      .where(eq(deepfakeReports.id, reportId));\n  }\n\n  async revokeSignature(signatureId: string, reason: string): Promise<void> {\n    await db\n      .update(authenticitySignatures)\n      .set({\n        verified: false,\n        revokedAt: new Date(),\n        revocationReason: reason,\n        updatedAt: new Date(),\n      })\n      .where(eq(authenticitySignatures.id, signatureId));\n  }\n\n  async getSignature(signatureId: string): Promise<AuthenticitySignature | undefined> {\n    const [signature] = await db\n      .select()\n      .from(authenticitySignatures)\n      .where(eq(authenticitySignatures.id, signatureId));\n    return signature;\n  }\n\n  async getContentSignature(contentId: string): Promise<AuthenticitySignature | undefined> {\n    const [signature] = await db\n      .select()\n      .from(authenticitySignatures)\n      .where(eq(authenticitySignatures.contentId, contentId))\n      .orderBy(desc(authenticitySignatures.createdAt));\n    return signature;\n  }\n}\n\nexport const deepfakeDetectionService = new DeepfakeDetectionService();\n","size_bytes":13403},"client/src/pages/Packs.tsx":{"content":"import { useState } from \"react\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { \n  Search, \n  Users, \n  Star, \n  Lock,\n  TrendingUp,\n  MessageCircle,\n  Heart\n} from \"lucide-react\";\n\nconst featuredPacks = [\n  {\n    id: \"1\",\n    name: \"Alpha Pack\",\n    description: \"Elite creators sharing exclusive content and experiences\",\n    members: 1234,\n    isPrivate: false,\n    category: \"Premium\",\n    trending: true\n  },\n  {\n    id: \"2\",\n    name: \"Wild Side\",\n    description: \"Adventurous creators pushing boundaries\",\n    members: 892,\n    isPrivate: false,\n    category: \"Adventure\",\n    trending: true\n  },\n  {\n    id: \"3\",\n    name: \"VIP Lounge\",\n    description: \"Exclusive access to top-tier creator collaborations\",\n    members: 456,\n    isPrivate: true,\n    category: \"VIP\",\n    trending: false\n  },\n  {\n    id: \"4\",\n    name: \"Creative Collective\",\n    description: \"Artists and performers collaborating on unique content\",\n    members: 678,\n    isPrivate: false,\n    category: \"Creative\",\n    trending: false\n  }\n];\n\nexport default function Packs() {\n  const [searchQuery, setSearchQuery] = useState(\"\");\n\n  const filteredPacks = featuredPacks.filter(pack =>\n    pack.name.toLowerCase().includes(searchQuery.toLowerCase()) ||\n    pack.description.toLowerCase().includes(searchQuery.toLowerCase()) ||\n    pack.category.toLowerCase().includes(searchQuery.toLowerCase())\n  );\n\n  return (\n    <div className=\"container mx-auto p-6 max-w-6xl\">\n      <div className=\"mb-8\">\n        <div className=\"flex items-center gap-2 mb-4\">\n          <Users className=\"h-8 w-8 text-primary\" />\n          <h1 className=\"text-3xl font-bold\">Pack Communities</h1>\n        </div>\n        <p className=\"text-muted-foreground text-lg\">\n          Join exclusive creator communities and connect with your pack\n        </p>\n      </div>\n\n      <div className=\"mb-6\">\n        <div className=\"relative\">\n          <Search className=\"absolute left-3 top-3 h-4 w-4 text-muted-foreground\" />\n          <Input\n            placeholder=\"Search packs...\"\n            value={searchQuery}\n            onChange={(e) => setSearchQuery(e.target.value)}\n            className=\"pl-10\"\n            data-testid=\"input-search-packs\"\n          />\n        </div>\n      </div>\n\n      <div className=\"grid gap-6 md:grid-cols-2 lg:grid-cols-2 mb-12\">\n        {filteredPacks.map((pack) => (\n          <Card key={pack.id} className=\"hover:shadow-lg transition-shadow\" data-testid={`card-pack-${pack.id}`}>\n            <CardHeader>\n              <div className=\"flex items-start justify-between\">\n                <div className=\"flex-1\">\n                  <CardTitle className=\"flex items-center gap-2\">\n                    {pack.name}\n                    {pack.isPrivate && <Lock className=\"h-4 w-4 text-muted-foreground\" />}\n                    {pack.trending && <TrendingUp className=\"h-4 w-4 text-primary\" />}\n                  </CardTitle>\n                  <CardDescription className=\"mt-2\">{pack.description}</CardDescription>\n                </div>\n              </div>\n              <div className=\"flex gap-2 mt-3\">\n                <Badge variant=\"outline\">{pack.category}</Badge>\n                {pack.trending && <Badge variant=\"default\">Trending</Badge>}\n              </div>\n            </CardHeader>\n            <CardContent>\n              <div className=\"flex items-center justify-between\">\n                <div className=\"flex items-center gap-4 text-sm text-muted-foreground\">\n                  <div className=\"flex items-center gap-1\">\n                    <Users className=\"h-4 w-4\" />\n                    <span>{pack.members.toLocaleString()} members</span>\n                  </div>\n                </div>\n                <Button variant={pack.isPrivate ? \"outline\" : \"default\"} data-testid={`button-join-${pack.id}`}>\n                  {pack.isPrivate ? \"Request Access\" : \"Join Pack\"}\n                </Button>\n              </div>\n            </CardContent>\n          </Card>\n        ))}\n      </div>\n\n      <Card>\n        <CardHeader>\n          <CardTitle>What are Pack Communities?</CardTitle>\n        </CardHeader>\n        <CardContent className=\"space-y-4\">\n          <div className=\"flex items-start gap-3\">\n            <Heart className=\"h-5 w-5 text-primary mt-0.5\" />\n            <div>\n              <div className=\"font-medium\">Exclusive Content</div>\n              <div className=\"text-sm text-muted-foreground\">\n                Access unique collaborations and special content only available to pack members\n              </div>\n            </div>\n          </div>\n          <div className=\"flex items-start gap-3\">\n            <MessageCircle className=\"h-5 w-5 text-primary mt-0.5\" />\n            <div>\n              <div className=\"font-medium\">Direct Interaction</div>\n              <div className=\"text-sm text-muted-foreground\">\n                Chat with creators and other pack members in private communities\n              </div>\n            </div>\n          </div>\n          <div className=\"flex items-start gap-3\">\n            <Star className=\"h-5 w-5 text-primary mt-0.5\" />\n            <div>\n              <div className=\"font-medium\">Special Perks</div>\n              <div className=\"text-sm text-muted-foreground\">\n                Enjoy member-only perks, early access, and exclusive events\n              </div>\n            </div>\n          </div>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","size_bytes":5603},"client/src/pages/CreatorSignup.tsx":{"content":"import { useState } from \"react\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { \n  Users, \n  DollarSign, \n  Star, \n  Shield, \n  Zap,\n  CheckCircle,\n  ArrowRight\n} from \"lucide-react\";\nimport { useAuth } from \"@/hooks/useAuth\";\nimport { useLocation } from \"wouter\";\n\nconst creatorBenefits = [\n  {\n    icon: DollarSign,\n    title: \"Earn More\",\n    description: \"Keep 80% of your earnings with transparent, creator-friendly pricing\"\n  },\n  {\n    icon: Users,\n    title: \"Build Your Pack\",\n    description: \"Connect with your most loyal fans in exclusive pack communities\"\n  },\n  {\n    icon: Star,\n    title: \"Premium Tools\",\n    description: \"Access advanced analytics, AI editing, and content management tools\"\n  },\n  {\n    icon: Shield,\n    title: \"Safe & Secure\",\n    description: \"Industry-leading safety features and content protection\"\n  },\n  {\n    icon: Zap,\n    title: \"Multi-Platform\",\n    description: \"Distribute to social media with one-click automation\"\n  }\n];\n\nconst requirements = [\n  \"Must be 18 years or older\",\n  \"Valid government-issued ID for verification\",\n  \"Banking information for payouts\",\n  \"Agree to community guidelines and terms\"\n];\n\nexport default function CreatorSignup() {\n  const { isAuthenticated } = useAuth();\n  const [, setLocation] = useLocation();\n\n  const handleGetStarted = () => {\n    if (isAuthenticated) {\n      setLocation(\"/dashboard\");\n    } else {\n      setLocation(\"/\");\n    }\n  };\n\n  return (\n    <div className=\"container mx-auto p-6 max-w-6xl\">\n      <div className=\"mb-12 text-center\">\n        <h1 className=\"text-4xl font-bold mb-4\">Become a Creator</h1>\n        <p className=\"text-muted-foreground text-xl max-w-2xl mx-auto\">\n          Join thousands of creators earning on their own terms. Build your brand, engage your fans, and maximize your income.\n        </p>\n      </div>\n\n      <div className=\"grid gap-6 md:grid-cols-2 lg:grid-cols-3 mb-12\">\n        {creatorBenefits.map((benefit) => {\n          const IconComponent = benefit.icon;\n          return (\n            <Card key={benefit.title} data-testid={`benefit-${benefit.title.toLowerCase().replace(/\\s+/g, '-')}`}>\n              <CardHeader>\n                <IconComponent className=\"h-8 w-8 text-primary mb-2\" />\n                <CardTitle className=\"text-lg\">{benefit.title}</CardTitle>\n              </CardHeader>\n              <CardContent>\n                <p className=\"text-muted-foreground\">{benefit.description}</p>\n              </CardContent>\n            </Card>\n          );\n        })}\n      </div>\n\n      <div className=\"grid gap-8 lg:grid-cols-2 mb-12\">\n        <Card>\n          <CardHeader>\n            <CardTitle>Requirements</CardTitle>\n            <CardDescription>What you need to get started</CardDescription>\n          </CardHeader>\n          <CardContent>\n            <ul className=\"space-y-3\">\n              {requirements.map((req, index) => (\n                <li key={index} className=\"flex items-start gap-3\" data-testid={`requirement-${index}`}>\n                  <CheckCircle className=\"h-5 w-5 text-primary mt-0.5 flex-shrink-0\" />\n                  <span>{req}</span>\n                </li>\n              ))}\n            </ul>\n          </CardContent>\n        </Card>\n\n        <Card>\n          <CardHeader>\n            <CardTitle>How It Works</CardTitle>\n            <CardDescription>Simple steps to start earning</CardDescription>\n          </CardHeader>\n          <CardContent>\n            <ol className=\"space-y-4\">\n              <li className=\"flex gap-3\">\n                <Badge className=\"h-6 w-6 rounded-full flex items-center justify-center flex-shrink-0\">1</Badge>\n                <div>\n                  <div className=\"font-medium\">Sign Up & Verify</div>\n                  <div className=\"text-sm text-muted-foreground\">Complete your profile and verify your identity</div>\n                </div>\n              </li>\n              <li className=\"flex gap-3\">\n                <Badge className=\"h-6 w-6 rounded-full flex items-center justify-center flex-shrink-0\">2</Badge>\n                <div>\n                  <div className=\"font-medium\">Set Up Your Page</div>\n                  <div className=\"text-sm text-muted-foreground\">Customize your profile and subscription tiers</div>\n                </div>\n              </li>\n              <li className=\"flex gap-3\">\n                <Badge className=\"h-6 w-6 rounded-full flex items-center justify-center flex-shrink-0\">3</Badge>\n                <div>\n                  <div className=\"font-medium\">Create & Earn</div>\n                  <div className=\"text-sm text-muted-foreground\">Upload content and start building your fanbase</div>\n                </div>\n              </li>\n            </ol>\n          </CardContent>\n        </Card>\n      </div>\n\n      <div className=\"text-center\">\n        <Card className=\"inline-block\">\n          <CardContent className=\"pt-6\">\n            <h2 className=\"text-2xl font-bold mb-4\">Ready to Start Your Creator Journey?</h2>\n            <p className=\"text-muted-foreground mb-6 max-w-md\">\n              Join our community of creators and start monetizing your content today\n            </p>\n            <Button \n              size=\"lg\" \n              className=\"gap-2\"\n              onClick={handleGetStarted}\n              data-testid=\"button-get-started\"\n            >\n              Get Started\n              <ArrowRight className=\"h-4 w-4\" />\n            </Button>\n          </CardContent>\n        </Card>\n      </div>\n    </div>\n  );\n}\n","size_bytes":5635},"server/holographicStreamingService.ts":{"content":"import { db } from \"./db\";\nimport { \n  avatarModels, \n  holographicStreams, \n  holographicViewers, \n  spatialAudioTracks,\n  type InsertAvatarModel,\n  type InsertHolographicStream,\n  type InsertHolographicViewer,\n  type InsertSpatialAudioTrack,\n  type AvatarModel,\n  type HolographicStream,\n  type HolographicViewer,\n  type SpatialAudioTrack,\n} from \"@shared/schema\";\nimport { eq, and, sql, desc } from \"drizzle-orm\";\n\nexport class HolographicStreamingService {\n  async createAvatarModel(data: InsertAvatarModel): Promise<AvatarModel> {\n    const [avatar] = await db\n      .insert(avatarModels)\n      .values(data)\n      .returning();\n    return avatar;\n  }\n\n  async getAvatarModel(id: string): Promise<AvatarModel | undefined> {\n    const [avatar] = await db\n      .select()\n      .from(avatarModels)\n      .where(eq(avatarModels.id, id));\n    return avatar;\n  }\n\n  async getCreatorAvatars(creatorId: string): Promise<AvatarModel[]> {\n    return db\n      .select()\n      .from(avatarModels)\n      .where(and(\n        eq(avatarModels.creatorId, creatorId),\n        eq(avatarModels.isActive, true)\n      ))\n      .orderBy(desc(avatarModels.createdAt));\n  }\n\n  async updateAvatarModel(id: string, updates: Partial<AvatarModel>): Promise<void> {\n    await db\n      .update(avatarModels)\n      .set({ ...updates, updatedAt: new Date() })\n      .where(eq(avatarModels.id, id));\n  }\n\n  async deleteAvatarModel(id: string): Promise<void> {\n    await db\n      .update(avatarModels)\n      .set({ isActive: false, updatedAt: new Date() })\n      .where(eq(avatarModels.id, id));\n  }\n\n  async createStream(data: InsertHolographicStream): Promise<HolographicStream> {\n    const [stream] = await db\n      .insert(holographicStreams)\n      .values(data)\n      .returning();\n    return stream;\n  }\n\n  async getStream(id: string): Promise<HolographicStream | undefined> {\n    const [stream] = await db\n      .select()\n      .from(holographicStreams)\n      .where(eq(holographicStreams.id, id));\n    return stream;\n  }\n\n  async getCreatorStreams(creatorId: string): Promise<HolographicStream[]> {\n    return db\n      .select()\n      .from(holographicStreams)\n      .where(eq(holographicStreams.creatorId, creatorId))\n      .orderBy(desc(holographicStreams.createdAt));\n  }\n\n  async getLiveStreams(): Promise<HolographicStream[]> {\n    return db\n      .select()\n      .from(holographicStreams)\n      .where(eq(holographicStreams.status, 'live'))\n      .orderBy(desc(holographicStreams.viewerCount));\n  }\n\n  async updateStream(id: string, updates: Partial<HolographicStream>): Promise<void> {\n    await db\n      .update(holographicStreams)\n      .set({ ...updates, updatedAt: new Date() })\n      .where(eq(holographicStreams.id, id));\n  }\n\n  async startStream(id: string): Promise<void> {\n    await db\n      .update(holographicStreams)\n      .set({ \n        status: 'live', \n        startedAt: new Date(),\n        updatedAt: new Date() \n      })\n      .where(eq(holographicStreams.id, id));\n  }\n\n  async endStream(id: string): Promise<void> {\n    const stream = await this.getStream(id);\n    if (!stream) return;\n\n    const viewers = await this.getStreamViewers(id);\n    \n    for (const viewer of viewers) {\n      if (!viewer.leftAt) {\n        await this.viewerLeave(viewer.id);\n      }\n    }\n\n    await db\n      .update(holographicStreams)\n      .set({ \n        status: 'ended', \n        endedAt: new Date(),\n        updatedAt: new Date() \n      })\n      .where(eq(holographicStreams.id, id));\n  }\n\n  async viewerJoin(data: InsertHolographicViewer): Promise<HolographicViewer> {\n    const stream = await this.getStream(data.streamId);\n    if (!stream) {\n      throw new Error(\"Stream not found\");\n    }\n\n    if (stream.status !== 'live') {\n      throw new Error(\"Cannot join: Stream is not live\");\n    }\n\n    const currentViewers = stream.viewerCount || 0;\n    const maxViewers = stream.maxViewers || 100;\n\n    if (currentViewers >= maxViewers) {\n      throw new Error(\"Cannot join: Stream is at maximum capacity\");\n    }\n\n    const [viewer] = await db\n      .insert(holographicViewers)\n      .values(data)\n      .returning();\n\n    const newViewerCount = currentViewers + 1;\n\n    await db\n      .update(holographicStreams)\n      .set({ \n        viewerCount: newViewerCount,\n        peakViewerCount: sql`GREATEST(${holographicStreams.peakViewerCount}, ${newViewerCount})`\n      })\n      .where(eq(holographicStreams.id, data.streamId));\n\n    return viewer;\n  }\n\n  async viewerLeave(viewerId: string): Promise<void> {\n    const [viewer] = await db\n      .select()\n      .from(holographicViewers)\n      .where(eq(holographicViewers.id, viewerId));\n\n    if (!viewer || viewer.leftAt || !viewer.joinedAt) return;\n\n    const watchTime = Math.floor((Date.now() - viewer.joinedAt.getTime()) / 1000);\n\n    await db\n      .update(holographicViewers)\n      .set({ \n        leftAt: new Date(),\n        watchTime \n      })\n      .where(eq(holographicViewers.id, viewerId));\n\n    await db\n      .update(holographicStreams)\n      .set({ \n        viewerCount: sql`${holographicStreams.viewerCount} - 1` \n      })\n      .where(eq(holographicStreams.id, viewer.streamId));\n  }\n\n  async updateViewerPosition(\n    viewerId: string, \n    position: { x: number, y: number, z: number },\n    orientation: { pitch: number, yaw: number, roll: number }\n  ): Promise<void> {\n    await db\n      .update(holographicViewers)\n      .set({ \n        viewerPosition: position,\n        viewerOrientation: orientation \n      })\n      .where(eq(holographicViewers.id, viewerId));\n  }\n\n  async recordViewerGesture(viewerId: string, gesture: string): Promise<void> {\n    const [viewer] = await db\n      .select()\n      .from(holographicViewers)\n      .where(eq(holographicViewers.id, viewerId));\n\n    if (!viewer) return;\n\n    const gestures = Array.isArray(viewer.gesturesUsed) ? viewer.gesturesUsed : [];\n    gestures.push({\n      gesture,\n      timestamp: new Date().toISOString()\n    });\n\n    await db\n      .update(holographicViewers)\n      .set({ gesturesUsed: gestures })\n      .where(eq(holographicViewers.id, viewerId));\n  }\n\n  async recordViewerTip(viewerId: string, amount: number): Promise<void> {\n    await db\n      .update(holographicViewers)\n      .set({ \n        tipsGiven: sql`${holographicViewers.tipsGiven} + ${amount}` \n      })\n      .where(eq(holographicViewers.id, viewerId));\n  }\n\n  async getStreamViewers(streamId: string): Promise<HolographicViewer[]> {\n    return db\n      .select()\n      .from(holographicViewers)\n      .where(eq(holographicViewers.streamId, streamId))\n      .orderBy(desc(holographicViewers.joinedAt));\n  }\n\n  async getActiveViewers(streamId: string): Promise<HolographicViewer[]> {\n    return db\n      .select()\n      .from(holographicViewers)\n      .where(and(\n        eq(holographicViewers.streamId, streamId),\n        sql`${holographicViewers.leftAt} IS NULL`\n      ))\n      .orderBy(desc(holographicViewers.joinedAt));\n  }\n\n  async addSpatialAudio(data: InsertSpatialAudioTrack): Promise<SpatialAudioTrack> {\n    const [track] = await db\n      .insert(spatialAudioTracks)\n      .values(data)\n      .returning();\n    return track;\n  }\n\n  async updateSpatialAudio(id: string, updates: Partial<SpatialAudioTrack>): Promise<void> {\n    await db\n      .update(spatialAudioTracks)\n      .set(updates)\n      .where(eq(spatialAudioTracks.id, id));\n  }\n\n  async updateAudioPosition(\n    id: string, \n    position: { x: number, y: number, z: number }\n  ): Promise<void> {\n    await db\n      .update(spatialAudioTracks)\n      .set({ position })\n      .where(eq(spatialAudioTracks.id, id));\n  }\n\n  async removeSpatialAudio(id: string): Promise<void> {\n    await db\n      .delete(spatialAudioTracks)\n      .where(eq(spatialAudioTracks.id, id));\n  }\n\n  async getStreamAudio(streamId: string): Promise<SpatialAudioTrack[]> {\n    return db\n      .select()\n      .from(spatialAudioTracks)\n      .where(and(\n        eq(spatialAudioTracks.streamId, streamId),\n        eq(spatialAudioTracks.isActive, true)\n      ));\n  }\n\n  async getStreamAnalytics(streamId: string) {\n    const viewers = await this.getStreamViewers(streamId);\n    \n    const totalViewers = viewers.length;\n    const uniqueDevices = new Set(viewers.map(v => v.deviceType)).size;\n    const totalWatchTime = viewers.reduce((sum, v) => sum + (v.watchTime || 0), 0);\n    const totalTips = viewers.reduce((sum, v) => {\n      const tips = parseFloat(v.tipsGiven?.toString() || '0');\n      return sum + tips;\n    }, 0);\n\n    const avgWatchTime = totalViewers > 0 ? totalWatchTime / totalViewers : 0;\n\n    const deviceBreakdown = viewers.reduce((acc, v) => {\n      const device = v.deviceType || 'unknown';\n      acc[device] = (acc[device] || 0) + 1;\n      return acc;\n    }, {} as Record<string, number>);\n\n    const interactionBreakdown = viewers.reduce((acc, v) => {\n      const mode = v.interactionMode || 'spectator';\n      acc[mode] = (acc[mode] || 0) + 1;\n      return acc;\n    }, {} as Record<string, number>);\n\n    const allGestures = viewers.flatMap(v => \n      Array.isArray(v.gesturesUsed) ? v.gesturesUsed : []\n    );\n\n    return {\n      totalViewers,\n      uniqueDevices,\n      totalWatchTime,\n      avgWatchTime,\n      totalTips,\n      deviceBreakdown,\n      interactionBreakdown,\n      topGestures: allGestures.slice(0, 10),\n      peakViewers: await this.getPeakViewers(streamId)\n    };\n  }\n\n  private async getPeakViewers(streamId: string): Promise<number> {\n    const stream = await this.getStream(streamId);\n    return stream?.peakViewerCount || 0;\n  }\n\n  async generateHighlights(streamId: string): Promise<string> {\n    const viewers = await this.getStreamViewers(streamId);\n    \n    const highEngagementMoments = viewers.filter(v => {\n      const gestures = Array.isArray(v.gesturesUsed) ? v.gesturesUsed : [];\n      return gestures.length > 5;\n    });\n\n    const highlightUrl = `https://storage.googleapis.com/highlights/${streamId}_highlights.mp4`;\n    \n    await db\n      .update(holographicStreams)\n      .set({ highlightsUrl: highlightUrl, updatedAt: new Date() })\n      .where(eq(holographicStreams.id, streamId));\n\n    return highlightUrl;\n  }\n\n  async incrementAvatarUsage(avatarId: string): Promise<void> {\n    await db\n      .update(avatarModels)\n      .set({ \n        usageCount: sql`${avatarModels.usageCount} + 1`,\n        updatedAt: new Date() \n      })\n      .where(eq(avatarModels.id, avatarId));\n  }\n}\n\nexport const holographicStreamingService = new HolographicStreamingService();\n","size_bytes":10450},"client/src/components/ui/sidebar.tsx":{"content":"import * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { VariantProps, cva } from \"class-variance-authority\"\nimport { PanelLeft } from \"lucide-react\"\n\nimport { useIsMobile } from \"@/hooks/use-mobile\"\nimport { cn } from \"@/lib/utils\"\nimport { Button } from \"@/components/ui/button\"\nimport { Input } from \"@/components/ui/input\"\nimport { Separator } from \"@/components/ui/separator\"\nimport {\n  Sheet,\n  SheetContent,\n  SheetDescription,\n  SheetHeader,\n  SheetTitle,\n} from \"@/components/ui/sheet\"\nimport { Skeleton } from \"@/components/ui/skeleton\"\nimport {\n  Tooltip,\n  TooltipContent,\n  TooltipProvider,\n  TooltipTrigger,\n} from \"@/components/ui/tooltip\"\n\nconst SIDEBAR_COOKIE_NAME = \"sidebar_state\"\nconst SIDEBAR_COOKIE_MAX_AGE = 60 * 60 * 24 * 7\nconst SIDEBAR_WIDTH = \"16rem\"\nconst SIDEBAR_WIDTH_MOBILE = \"18rem\"\nconst SIDEBAR_WIDTH_ICON = \"3rem\"\nconst SIDEBAR_KEYBOARD_SHORTCUT = \"b\"\n\ntype SidebarContextProps = {\n  state: \"expanded\" | \"collapsed\"\n  open: boolean\n  setOpen: (open: boolean) => void\n  openMobile: boolean\n  setOpenMobile: (open: boolean) => void\n  isMobile: boolean\n  toggleSidebar: () => void\n}\n\nconst SidebarContext = React.createContext<SidebarContextProps | null>(null)\n\nfunction useSidebar() {\n  const context = React.useContext(SidebarContext)\n  if (!context) {\n    throw new Error(\"useSidebar must be used within a SidebarProvider.\")\n  }\n\n  return context\n}\n\nconst SidebarProvider = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> & {\n    defaultOpen?: boolean\n    open?: boolean\n    onOpenChange?: (open: boolean) => void\n  }\n>(\n  (\n    {\n      defaultOpen = true,\n      open: openProp,\n      onOpenChange: setOpenProp,\n      className,\n      style,\n      children,\n      ...props\n    },\n    ref\n  ) => {\n    const isMobile = useIsMobile()\n    const [openMobile, setOpenMobile] = React.useState(false)\n\n    // This is the internal state of the sidebar.\n    // We use openProp and setOpenProp for control from outside the component.\n    const [_open, _setOpen] = React.useState(defaultOpen)\n    const open = openProp ?? _open\n    const setOpen = React.useCallback(\n      (value: boolean | ((value: boolean) => boolean)) => {\n        const openState = typeof value === \"function\" ? value(open) : value\n        if (setOpenProp) {\n          setOpenProp(openState)\n        } else {\n          _setOpen(openState)\n        }\n\n        // This sets the cookie to keep the sidebar state.\n        document.cookie = `${SIDEBAR_COOKIE_NAME}=${openState}; path=/; max-age=${SIDEBAR_COOKIE_MAX_AGE}`\n      },\n      [setOpenProp, open]\n    )\n\n    // Helper to toggle the sidebar.\n    const toggleSidebar = React.useCallback(() => {\n      return isMobile\n        ? setOpenMobile((open) => !open)\n        : setOpen((open) => !open)\n    }, [isMobile, setOpen, setOpenMobile])\n\n    // Adds a keyboard shortcut to toggle the sidebar.\n    React.useEffect(() => {\n      const handleKeyDown = (event: KeyboardEvent) => {\n        if (\n          event.key === SIDEBAR_KEYBOARD_SHORTCUT &&\n          (event.metaKey || event.ctrlKey)\n        ) {\n          event.preventDefault()\n          toggleSidebar()\n        }\n      }\n\n      window.addEventListener(\"keydown\", handleKeyDown)\n      return () => window.removeEventListener(\"keydown\", handleKeyDown)\n    }, [toggleSidebar])\n\n    // We add a state so that we can do data-state=\"expanded\" or \"collapsed\".\n    // This makes it easier to style the sidebar with Tailwind classes.\n    const state = open ? \"expanded\" : \"collapsed\"\n\n    const contextValue = React.useMemo<SidebarContextProps>(\n      () => ({\n        state,\n        open,\n        setOpen,\n        isMobile,\n        openMobile,\n        setOpenMobile,\n        toggleSidebar,\n      }),\n      [state, open, setOpen, isMobile, openMobile, setOpenMobile, toggleSidebar]\n    )\n\n    return (\n      <SidebarContext.Provider value={contextValue}>\n        <TooltipProvider delayDuration={0}>\n          <div\n            style={\n              {\n                \"--sidebar-width\": SIDEBAR_WIDTH,\n                \"--sidebar-width-icon\": SIDEBAR_WIDTH_ICON,\n                ...style,\n              } as React.CSSProperties\n            }\n            className={cn(\n              \"group/sidebar-wrapper flex min-h-svh w-full has-[[data-variant=inset]]:bg-sidebar\",\n              className\n            )}\n            ref={ref}\n            {...props}\n          >\n            {children}\n          </div>\n        </TooltipProvider>\n      </SidebarContext.Provider>\n    )\n  }\n)\nSidebarProvider.displayName = \"SidebarProvider\"\n\nconst Sidebar = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> & {\n    side?: \"left\" | \"right\"\n    variant?: \"sidebar\" | \"floating\" | \"inset\"\n    collapsible?: \"offcanvas\" | \"icon\" | \"none\"\n  }\n>(\n  (\n    {\n      side = \"left\",\n      variant = \"sidebar\",\n      collapsible = \"offcanvas\",\n      className,\n      children,\n      ...props\n    },\n    ref\n  ) => {\n    const { isMobile, state, openMobile, setOpenMobile } = useSidebar()\n\n    if (collapsible === \"none\") {\n      return (\n        <div\n          className={cn(\n            \"flex h-full w-[--sidebar-width] flex-col bg-sidebar text-sidebar-foreground\",\n            className\n          )}\n          ref={ref}\n          {...props}\n        >\n          {children}\n        </div>\n      )\n    }\n\n    if (isMobile) {\n      return (\n        <Sheet open={openMobile} onOpenChange={setOpenMobile} {...props}>\n          <SheetContent\n            data-sidebar=\"sidebar\"\n            data-mobile=\"true\"\n            className=\"w-[--sidebar-width] bg-sidebar p-0 text-sidebar-foreground [&>button]:hidden\"\n            style={\n              {\n                \"--sidebar-width\": SIDEBAR_WIDTH_MOBILE,\n              } as React.CSSProperties\n            }\n            side={side}\n          >\n            <SheetHeader className=\"sr-only\">\n              <SheetTitle>Sidebar</SheetTitle>\n              <SheetDescription>Displays the mobile sidebar.</SheetDescription>\n            </SheetHeader>\n            <div className=\"flex h-full w-full flex-col\">{children}</div>\n          </SheetContent>\n        </Sheet>\n      )\n    }\n\n    return (\n      <div\n        ref={ref}\n        className=\"group peer hidden text-sidebar-foreground md:block\"\n        data-state={state}\n        data-collapsible={state === \"collapsed\" ? collapsible : \"\"}\n        data-variant={variant}\n        data-side={side}\n      >\n        {/* This is what handles the sidebar gap on desktop */}\n        <div\n          className={cn(\n            \"relative w-[--sidebar-width] bg-transparent transition-[width] duration-200 ease-linear\",\n            \"group-data-[collapsible=offcanvas]:w-0\",\n            \"group-data-[side=right]:rotate-180\",\n            variant === \"floating\" || variant === \"inset\"\n              ? \"group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)_+_theme(spacing.4))]\"\n              : \"group-data-[collapsible=icon]:w-[--sidebar-width-icon]\"\n          )}\n        />\n        <div\n          className={cn(\n            \"fixed inset-y-0 z-10 hidden h-svh w-[--sidebar-width] transition-[left,right,width] duration-200 ease-linear md:flex\",\n            side === \"left\"\n              ? \"left-0 group-data-[collapsible=offcanvas]:left-[calc(var(--sidebar-width)*-1)]\"\n              : \"right-0 group-data-[collapsible=offcanvas]:right-[calc(var(--sidebar-width)*-1)]\",\n            // Adjust the padding for floating and inset variants.\n            variant === \"floating\" || variant === \"inset\"\n              ? \"p-2 group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)_+_theme(spacing.4)_+2px)]\"\n              : \"group-data-[collapsible=icon]:w-[--sidebar-width-icon] group-data-[side=left]:border-r group-data-[side=right]:border-l\",\n            className\n          )}\n          {...props}\n        >\n          <div\n            data-sidebar=\"sidebar\"\n            className=\"flex h-full w-full flex-col bg-sidebar group-data-[variant=floating]:rounded-lg group-data-[variant=floating]:border group-data-[variant=floating]:border-sidebar-border group-data-[variant=floating]:shadow\"\n          >\n            {children}\n          </div>\n        </div>\n      </div>\n    )\n  }\n)\nSidebar.displayName = \"Sidebar\"\n\nconst SidebarTrigger = React.forwardRef<\n  React.ElementRef<typeof Button>,\n  React.ComponentProps<typeof Button>\n>(({ className, onClick, ...props }, ref) => {\n  const { toggleSidebar } = useSidebar()\n\n  return (\n    <Button\n      ref={ref}\n      data-sidebar=\"trigger\"\n      variant=\"ghost\"\n      size=\"icon\"\n      className={cn(\"h-7 w-7\", className)}\n      onClick={(event) => {\n        onClick?.(event)\n        toggleSidebar()\n      }}\n      {...props}\n    >\n      <PanelLeft />\n      <span className=\"sr-only\">Toggle Sidebar</span>\n    </Button>\n  )\n})\nSidebarTrigger.displayName = \"SidebarTrigger\"\n\nconst SidebarRail = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<\"button\">\n>(({ className, ...props }, ref) => {\n  const { toggleSidebar } = useSidebar()\n\n  return (\n    <button\n      ref={ref}\n      data-sidebar=\"rail\"\n      aria-label=\"Toggle Sidebar\"\n      tabIndex={-1}\n      onClick={toggleSidebar}\n      title=\"Toggle Sidebar\"\n      className={cn(\n        \"absolute inset-y-0 z-20 hidden w-4 -translate-x-1/2 transition-all ease-linear after:absolute after:inset-y-0 after:left-1/2 after:w-[2px] hover:after:bg-sidebar-border group-data-[side=left]:-right-4 group-data-[side=right]:left-0 sm:flex\",\n        \"[[data-side=left]_&]:cursor-w-resize [[data-side=right]_&]:cursor-e-resize\",\n        \"[[data-side=left][data-state=collapsed]_&]:cursor-e-resize [[data-side=right][data-state=collapsed]_&]:cursor-w-resize\",\n        \"group-data-[collapsible=offcanvas]:translate-x-0 group-data-[collapsible=offcanvas]:after:left-full group-data-[collapsible=offcanvas]:hover:bg-sidebar\",\n        \"[[data-side=left][data-collapsible=offcanvas]_&]:-right-2\",\n        \"[[data-side=right][data-collapsible=offcanvas]_&]:-left-2\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarRail.displayName = \"SidebarRail\"\n\nconst SidebarInset = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"main\">\n>(({ className, ...props }, ref) => {\n  return (\n    <main\n      ref={ref}\n      className={cn(\n        \"relative flex w-full flex-1 flex-col bg-background\",\n        \"md:peer-data-[variant=inset]:m-2 md:peer-data-[state=collapsed]:peer-data-[variant=inset]:ml-2 md:peer-data-[variant=inset]:ml-0 md:peer-data-[variant=inset]:rounded-xl md:peer-data-[variant=inset]:shadow\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarInset.displayName = \"SidebarInset\"\n\nconst SidebarInput = React.forwardRef<\n  React.ElementRef<typeof Input>,\n  React.ComponentProps<typeof Input>\n>(({ className, ...props }, ref) => {\n  return (\n    <Input\n      ref={ref}\n      data-sidebar=\"input\"\n      className={cn(\n        \"h-8 w-full bg-background shadow-none focus-visible:ring-2 focus-visible:ring-sidebar-ring\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarInput.displayName = \"SidebarInput\"\n\nconst SidebarHeader = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\">\n>(({ className, ...props }, ref) => {\n  return (\n    <div\n      ref={ref}\n      data-sidebar=\"header\"\n      className={cn(\"flex flex-col gap-2 p-2\", className)}\n      {...props}\n    />\n  )\n})\nSidebarHeader.displayName = \"SidebarHeader\"\n\nconst SidebarFooter = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\">\n>(({ className, ...props }, ref) => {\n  return (\n    <div\n      ref={ref}\n      data-sidebar=\"footer\"\n      className={cn(\"flex flex-col gap-2 p-2\", className)}\n      {...props}\n    />\n  )\n})\nSidebarFooter.displayName = \"SidebarFooter\"\n\nconst SidebarSeparator = React.forwardRef<\n  React.ElementRef<typeof Separator>,\n  React.ComponentProps<typeof Separator>\n>(({ className, ...props }, ref) => {\n  return (\n    <Separator\n      ref={ref}\n      data-sidebar=\"separator\"\n      className={cn(\"mx-2 w-auto bg-sidebar-border\", className)}\n      {...props}\n    />\n  )\n})\nSidebarSeparator.displayName = \"SidebarSeparator\"\n\nconst SidebarContent = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\">\n>(({ className, ...props }, ref) => {\n  return (\n    <div\n      ref={ref}\n      data-sidebar=\"content\"\n      className={cn(\n        \"flex min-h-0 flex-1 flex-col gap-2 overflow-auto group-data-[collapsible=icon]:overflow-hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarContent.displayName = \"SidebarContent\"\n\nconst SidebarGroup = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\">\n>(({ className, ...props }, ref) => {\n  return (\n    <div\n      ref={ref}\n      data-sidebar=\"group\"\n      className={cn(\"relative flex w-full min-w-0 flex-col p-2\", className)}\n      {...props}\n    />\n  )\n})\nSidebarGroup.displayName = \"SidebarGroup\"\n\nconst SidebarGroupLabel = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> & { asChild?: boolean }\n>(({ className, asChild = false, ...props }, ref) => {\n  const Comp = asChild ? Slot : \"div\"\n\n  return (\n    <Comp\n      ref={ref}\n      data-sidebar=\"group-label\"\n      className={cn(\n        \"flex h-8 shrink-0 items-center rounded-md px-2 text-xs font-medium text-sidebar-foreground/70 outline-none ring-sidebar-ring transition-[margin,opacity] duration-200 ease-linear focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0\",\n        \"group-data-[collapsible=icon]:-mt-8 group-data-[collapsible=icon]:opacity-0\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarGroupLabel.displayName = \"SidebarGroupLabel\"\n\nconst SidebarGroupAction = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<\"button\"> & { asChild?: boolean }\n>(({ className, asChild = false, ...props }, ref) => {\n  const Comp = asChild ? Slot : \"button\"\n\n  return (\n    <Comp\n      ref={ref}\n      data-sidebar=\"group-action\"\n      className={cn(\n        \"absolute right-3 top-3.5 flex aspect-square w-5 items-center justify-center rounded-md p-0 text-sidebar-foreground outline-none ring-sidebar-ring transition-transform hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0\",\n        // Increases the hit area of the button on mobile.\n        \"after:absolute after:-inset-2 after:md:hidden\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarGroupAction.displayName = \"SidebarGroupAction\"\n\nconst SidebarGroupContent = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\">\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    data-sidebar=\"group-content\"\n    className={cn(\"w-full text-sm\", className)}\n    {...props}\n  />\n))\nSidebarGroupContent.displayName = \"SidebarGroupContent\"\n\nconst SidebarMenu = React.forwardRef<\n  HTMLUListElement,\n  React.ComponentProps<\"ul\">\n>(({ className, ...props }, ref) => (\n  <ul\n    ref={ref}\n    data-sidebar=\"menu\"\n    className={cn(\"flex w-full min-w-0 flex-col gap-1\", className)}\n    {...props}\n  />\n))\nSidebarMenu.displayName = \"SidebarMenu\"\n\nconst SidebarMenuItem = React.forwardRef<\n  HTMLLIElement,\n  React.ComponentProps<\"li\">\n>(({ className, ...props }, ref) => (\n  <li\n    ref={ref}\n    data-sidebar=\"menu-item\"\n    className={cn(\"group/menu-item relative\", className)}\n    {...props}\n  />\n))\nSidebarMenuItem.displayName = \"SidebarMenuItem\"\n\nconst sidebarMenuButtonVariants = cva(\n  \"peer/menu-button flex w-full items-center gap-2 overflow-hidden rounded-md p-2 text-left text-sm outline-none ring-sidebar-ring transition-[width,height,padding] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 active:bg-sidebar-accent active:text-sidebar-accent-foreground disabled:pointer-events-none disabled:opacity-50 group-has-[[data-sidebar=menu-action]]/menu-item:pr-8 aria-disabled:pointer-events-none aria-disabled:opacity-50 data-[active=true]:bg-sidebar-accent data-[active=true]:font-medium data-[active=true]:text-sidebar-accent-foreground data-[state=open]:hover:bg-sidebar-accent data-[state=open]:hover:text-sidebar-accent-foreground group-data-[collapsible=icon]:!size-8 group-data-[collapsible=icon]:!p-2 [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0\",\n  {\n    variants: {\n      variant: {\n        default: \"hover:bg-sidebar-accent hover:text-sidebar-accent-foreground\",\n        outline:\n          \"bg-background shadow-[0_0_0_1px_hsl(var(--sidebar-border))] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground hover:shadow-[0_0_0_1px_hsl(var(--sidebar-accent))]\",\n      },\n      size: {\n        default: \"h-8 text-sm\",\n        sm: \"h-7 text-xs\",\n        lg: \"h-12 text-sm group-data-[collapsible=icon]:!p-0\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n)\n\nconst SidebarMenuButton = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<\"button\"> & {\n    asChild?: boolean\n    isActive?: boolean\n    tooltip?: string | React.ComponentProps<typeof TooltipContent>\n  } & VariantProps<typeof sidebarMenuButtonVariants>\n>(\n  (\n    {\n      asChild = false,\n      isActive = false,\n      variant = \"default\",\n      size = \"default\",\n      tooltip,\n      className,\n      ...props\n    },\n    ref\n  ) => {\n    const Comp = asChild ? Slot : \"button\"\n    const { isMobile, state } = useSidebar()\n\n    const button = (\n      <Comp\n        ref={ref}\n        data-sidebar=\"menu-button\"\n        data-size={size}\n        data-active={isActive}\n        className={cn(sidebarMenuButtonVariants({ variant, size }), className)}\n        {...props}\n      />\n    )\n\n    if (!tooltip) {\n      return button\n    }\n\n    if (typeof tooltip === \"string\") {\n      tooltip = {\n        children: tooltip,\n      }\n    }\n\n    return (\n      <Tooltip>\n        <TooltipTrigger asChild>{button}</TooltipTrigger>\n        <TooltipContent\n          side=\"right\"\n          align=\"center\"\n          hidden={state !== \"collapsed\" || isMobile}\n          {...tooltip}\n        />\n      </Tooltip>\n    )\n  }\n)\nSidebarMenuButton.displayName = \"SidebarMenuButton\"\n\nconst SidebarMenuAction = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<\"button\"> & {\n    asChild?: boolean\n    showOnHover?: boolean\n  }\n>(({ className, asChild = false, showOnHover = false, ...props }, ref) => {\n  const Comp = asChild ? Slot : \"button\"\n\n  return (\n    <Comp\n      ref={ref}\n      data-sidebar=\"menu-action\"\n      className={cn(\n        \"absolute right-1 top-1.5 flex aspect-square w-5 items-center justify-center rounded-md p-0 text-sidebar-foreground outline-none ring-sidebar-ring transition-transform hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 peer-hover/menu-button:text-sidebar-accent-foreground [&>svg]:size-4 [&>svg]:shrink-0\",\n        // Increases the hit area of the button on mobile.\n        \"after:absolute after:-inset-2 after:md:hidden\",\n        \"peer-data-[size=sm]/menu-button:top-1\",\n        \"peer-data-[size=default]/menu-button:top-1.5\",\n        \"peer-data-[size=lg]/menu-button:top-2.5\",\n        \"group-data-[collapsible=icon]:hidden\",\n        showOnHover &&\n          \"group-focus-within/menu-item:opacity-100 group-hover/menu-item:opacity-100 data-[state=open]:opacity-100 peer-data-[active=true]/menu-button:text-sidebar-accent-foreground md:opacity-0\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarMenuAction.displayName = \"SidebarMenuAction\"\n\nconst SidebarMenuBadge = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\">\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    data-sidebar=\"menu-badge\"\n    className={cn(\n      \"pointer-events-none absolute right-1 flex h-5 min-w-5 select-none items-center justify-center rounded-md px-1 text-xs font-medium tabular-nums text-sidebar-foreground\",\n      \"peer-hover/menu-button:text-sidebar-accent-foreground peer-data-[active=true]/menu-button:text-sidebar-accent-foreground\",\n      \"peer-data-[size=sm]/menu-button:top-1\",\n      \"peer-data-[size=default]/menu-button:top-1.5\",\n      \"peer-data-[size=lg]/menu-button:top-2.5\",\n      \"group-data-[collapsible=icon]:hidden\",\n      className\n    )}\n    {...props}\n  />\n))\nSidebarMenuBadge.displayName = \"SidebarMenuBadge\"\n\nconst SidebarMenuSkeleton = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> & {\n    showIcon?: boolean\n  }\n>(({ className, showIcon = false, ...props }, ref) => {\n  // Random width between 50 to 90%.\n  const width = React.useMemo(() => {\n    return `${Math.floor(Math.random() * 40) + 50}%`\n  }, [])\n\n  return (\n    <div\n      ref={ref}\n      data-sidebar=\"menu-skeleton\"\n      className={cn(\"flex h-8 items-center gap-2 rounded-md px-2\", className)}\n      {...props}\n    >\n      {showIcon && (\n        <Skeleton\n          className=\"size-4 rounded-md\"\n          data-sidebar=\"menu-skeleton-icon\"\n        />\n      )}\n      <Skeleton\n        className=\"h-4 max-w-[--skeleton-width] flex-1\"\n        data-sidebar=\"menu-skeleton-text\"\n        style={\n          {\n            \"--skeleton-width\": width,\n          } as React.CSSProperties\n        }\n      />\n    </div>\n  )\n})\nSidebarMenuSkeleton.displayName = \"SidebarMenuSkeleton\"\n\nconst SidebarMenuSub = React.forwardRef<\n  HTMLUListElement,\n  React.ComponentProps<\"ul\">\n>(({ className, ...props }, ref) => (\n  <ul\n    ref={ref}\n    data-sidebar=\"menu-sub\"\n    className={cn(\n      \"mx-3.5 flex min-w-0 translate-x-px flex-col gap-1 border-l border-sidebar-border px-2.5 py-0.5\",\n      \"group-data-[collapsible=icon]:hidden\",\n      className\n    )}\n    {...props}\n  />\n))\nSidebarMenuSub.displayName = \"SidebarMenuSub\"\n\nconst SidebarMenuSubItem = React.forwardRef<\n  HTMLLIElement,\n  React.ComponentProps<\"li\">\n>(({ ...props }, ref) => <li ref={ref} {...props} />)\nSidebarMenuSubItem.displayName = \"SidebarMenuSubItem\"\n\nconst SidebarMenuSubButton = React.forwardRef<\n  HTMLAnchorElement,\n  React.ComponentProps<\"a\"> & {\n    asChild?: boolean\n    size?: \"sm\" | \"md\"\n    isActive?: boolean\n  }\n>(({ asChild = false, size = \"md\", isActive, className, ...props }, ref) => {\n  const Comp = asChild ? Slot : \"a\"\n\n  return (\n    <Comp\n      ref={ref}\n      data-sidebar=\"menu-sub-button\"\n      data-size={size}\n      data-active={isActive}\n      className={cn(\n        \"flex h-7 min-w-0 -translate-x-px items-center gap-2 overflow-hidden rounded-md px-2 text-sidebar-foreground outline-none ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 active:bg-sidebar-accent active:text-sidebar-accent-foreground disabled:pointer-events-none disabled:opacity-50 aria-disabled:pointer-events-none aria-disabled:opacity-50 [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0 [&>svg]:text-sidebar-accent-foreground\",\n        \"data-[active=true]:bg-sidebar-accent data-[active=true]:text-sidebar-accent-foreground\",\n        size === \"sm\" && \"text-xs\",\n        size === \"md\" && \"text-sm\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarMenuSubButton.displayName = \"SidebarMenuSubButton\"\n\nexport {\n  Sidebar,\n  SidebarContent,\n  SidebarFooter,\n  SidebarGroup,\n  SidebarGroupAction,\n  SidebarGroupContent,\n  SidebarGroupLabel,\n  SidebarHeader,\n  SidebarInput,\n  SidebarInset,\n  SidebarMenu,\n  SidebarMenuAction,\n  SidebarMenuBadge,\n  SidebarMenuButton,\n  SidebarMenuItem,\n  SidebarMenuSkeleton,\n  SidebarMenuSub,\n  SidebarMenuSubButton,\n  SidebarMenuSubItem,\n  SidebarProvider,\n  SidebarRail,\n  SidebarSeparator,\n  SidebarTrigger,\n  useSidebar,\n}\n","size_bytes":23567},"client/src/components/ui/carousel.tsx":{"content":"import * as React from \"react\"\nimport useEmblaCarousel, {\n  type UseEmblaCarouselType,\n} from \"embla-carousel-react\"\nimport { ArrowLeft, ArrowRight } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Button } from \"@/components/ui/button\"\n\ntype CarouselApi = UseEmblaCarouselType[1]\ntype UseCarouselParameters = Parameters<typeof useEmblaCarousel>\ntype CarouselOptions = UseCarouselParameters[0]\ntype CarouselPlugin = UseCarouselParameters[1]\n\ntype CarouselProps = {\n  opts?: CarouselOptions\n  plugins?: CarouselPlugin\n  orientation?: \"horizontal\" | \"vertical\"\n  setApi?: (api: CarouselApi) => void\n}\n\ntype CarouselContextProps = {\n  carouselRef: ReturnType<typeof useEmblaCarousel>[0]\n  api: ReturnType<typeof useEmblaCarousel>[1]\n  scrollPrev: () => void\n  scrollNext: () => void\n  canScrollPrev: boolean\n  canScrollNext: boolean\n} & CarouselProps\n\nconst CarouselContext = React.createContext<CarouselContextProps | null>(null)\n\nfunction useCarousel() {\n  const context = React.useContext(CarouselContext)\n\n  if (!context) {\n    throw new Error(\"useCarousel must be used within a <Carousel />\")\n  }\n\n  return context\n}\n\nconst Carousel = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement> & CarouselProps\n>(\n  (\n    {\n      orientation = \"horizontal\",\n      opts,\n      setApi,\n      plugins,\n      className,\n      children,\n      ...props\n    },\n    ref\n  ) => {\n    const [carouselRef, api] = useEmblaCarousel(\n      {\n        ...opts,\n        axis: orientation === \"horizontal\" ? \"x\" : \"y\",\n      },\n      plugins\n    )\n    const [canScrollPrev, setCanScrollPrev] = React.useState(false)\n    const [canScrollNext, setCanScrollNext] = React.useState(false)\n\n    const onSelect = React.useCallback((api: CarouselApi) => {\n      if (!api) {\n        return\n      }\n\n      setCanScrollPrev(api.canScrollPrev())\n      setCanScrollNext(api.canScrollNext())\n    }, [])\n\n    const scrollPrev = React.useCallback(() => {\n      api?.scrollPrev()\n    }, [api])\n\n    const scrollNext = React.useCallback(() => {\n      api?.scrollNext()\n    }, [api])\n\n    const handleKeyDown = React.useCallback(\n      (event: React.KeyboardEvent<HTMLDivElement>) => {\n        if (event.key === \"ArrowLeft\") {\n          event.preventDefault()\n          scrollPrev()\n        } else if (event.key === \"ArrowRight\") {\n          event.preventDefault()\n          scrollNext()\n        }\n      },\n      [scrollPrev, scrollNext]\n    )\n\n    React.useEffect(() => {\n      if (!api || !setApi) {\n        return\n      }\n\n      setApi(api)\n    }, [api, setApi])\n\n    React.useEffect(() => {\n      if (!api) {\n        return\n      }\n\n      onSelect(api)\n      api.on(\"reInit\", onSelect)\n      api.on(\"select\", onSelect)\n\n      return () => {\n        api?.off(\"select\", onSelect)\n      }\n    }, [api, onSelect])\n\n    return (\n      <CarouselContext.Provider\n        value={{\n          carouselRef,\n          api: api,\n          opts,\n          orientation:\n            orientation || (opts?.axis === \"y\" ? \"vertical\" : \"horizontal\"),\n          scrollPrev,\n          scrollNext,\n          canScrollPrev,\n          canScrollNext,\n        }}\n      >\n        <div\n          ref={ref}\n          onKeyDownCapture={handleKeyDown}\n          className={cn(\"relative\", className)}\n          role=\"region\"\n          aria-roledescription=\"carousel\"\n          {...props}\n        >\n          {children}\n        </div>\n      </CarouselContext.Provider>\n    )\n  }\n)\nCarousel.displayName = \"Carousel\"\n\nconst CarouselContent = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const { carouselRef, orientation } = useCarousel()\n\n  return (\n    <div ref={carouselRef} className=\"overflow-hidden\">\n      <div\n        ref={ref}\n        className={cn(\n          \"flex\",\n          orientation === \"horizontal\" ? \"-ml-4\" : \"-mt-4 flex-col\",\n          className\n        )}\n        {...props}\n      />\n    </div>\n  )\n})\nCarouselContent.displayName = \"CarouselContent\"\n\nconst CarouselItem = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const { orientation } = useCarousel()\n\n  return (\n    <div\n      ref={ref}\n      role=\"group\"\n      aria-roledescription=\"slide\"\n      className={cn(\n        \"min-w-0 shrink-0 grow-0 basis-full\",\n        orientation === \"horizontal\" ? \"pl-4\" : \"pt-4\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nCarouselItem.displayName = \"CarouselItem\"\n\nconst CarouselPrevious = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<typeof Button>\n>(({ className, variant = \"outline\", size = \"icon\", ...props }, ref) => {\n  const { orientation, scrollPrev, canScrollPrev } = useCarousel()\n\n  return (\n    <Button\n      ref={ref}\n      variant={variant}\n      size={size}\n      className={cn(\n        \"absolute  h-8 w-8 rounded-full\",\n        orientation === \"horizontal\"\n          ? \"-left-12 top-1/2 -translate-y-1/2\"\n          : \"-top-12 left-1/2 -translate-x-1/2 rotate-90\",\n        className\n      )}\n      disabled={!canScrollPrev}\n      onClick={scrollPrev}\n      {...props}\n    >\n      <ArrowLeft className=\"h-4 w-4\" />\n      <span className=\"sr-only\">Previous slide</span>\n    </Button>\n  )\n})\nCarouselPrevious.displayName = \"CarouselPrevious\"\n\nconst CarouselNext = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<typeof Button>\n>(({ className, variant = \"outline\", size = \"icon\", ...props }, ref) => {\n  const { orientation, scrollNext, canScrollNext } = useCarousel()\n\n  return (\n    <Button\n      ref={ref}\n      variant={variant}\n      size={size}\n      className={cn(\n        \"absolute h-8 w-8 rounded-full\",\n        orientation === \"horizontal\"\n          ? \"-right-12 top-1/2 -translate-y-1/2\"\n          : \"-bottom-12 left-1/2 -translate-x-1/2 rotate-90\",\n        className\n      )}\n      disabled={!canScrollNext}\n      onClick={scrollNext}\n      {...props}\n    >\n      <ArrowRight className=\"h-4 w-4\" />\n      <span className=\"sr-only\">Next slide</span>\n    </Button>\n  )\n})\nCarouselNext.displayName = \"CarouselNext\"\n\nexport {\n  type CarouselApi,\n  Carousel,\n  CarouselContent,\n  CarouselItem,\n  CarouselPrevious,\n  CarouselNext,\n}\n","size_bytes":6210},"client/src/components/ui/dropdown-menu.tsx":{"content":"import * as React from \"react\"\nimport * as DropdownMenuPrimitive from \"@radix-ui/react-dropdown-menu\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst DropdownMenu = DropdownMenuPrimitive.Root\n\nconst DropdownMenuTrigger = DropdownMenuPrimitive.Trigger\n\nconst DropdownMenuGroup = DropdownMenuPrimitive.Group\n\nconst DropdownMenuPortal = DropdownMenuPrimitive.Portal\n\nconst DropdownMenuSub = DropdownMenuPrimitive.Sub\n\nconst DropdownMenuRadioGroup = DropdownMenuPrimitive.RadioGroup\n\nconst DropdownMenuSubTrigger = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <DropdownMenuPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto\" />\n  </DropdownMenuPrimitive.SubTrigger>\n))\nDropdownMenuSubTrigger.displayName =\n  DropdownMenuPrimitive.SubTrigger.displayName\n\nconst DropdownMenuSubContent = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <DropdownMenuPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-dropdown-menu-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuSubContent.displayName =\n  DropdownMenuPrimitive.SubContent.displayName\n\nconst DropdownMenuContent = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Content>\n>(({ className, sideOffset = 4, ...props }, ref) => (\n  <DropdownMenuPrimitive.Portal>\n    <DropdownMenuPrimitive.Content\n      ref={ref}\n      sideOffset={sideOffset}\n      className={cn(\n        \"z-50 max-h-[var(--radix-dropdown-menu-content-available-height)] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-dropdown-menu-content-transform-origin]\",\n        className\n      )}\n      {...props}\n    />\n  </DropdownMenuPrimitive.Portal>\n))\nDropdownMenuContent.displayName = DropdownMenuPrimitive.Content.displayName\n\nconst DropdownMenuItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <DropdownMenuPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuItem.displayName = DropdownMenuPrimitive.Item.displayName\n\nconst DropdownMenuCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <DropdownMenuPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <DropdownMenuPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </DropdownMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </DropdownMenuPrimitive.CheckboxItem>\n))\nDropdownMenuCheckboxItem.displayName =\n  DropdownMenuPrimitive.CheckboxItem.displayName\n\nconst DropdownMenuRadioItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <DropdownMenuPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <DropdownMenuPrimitive.ItemIndicator>\n        <Circle className=\"h-2 w-2 fill-current\" />\n      </DropdownMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </DropdownMenuPrimitive.RadioItem>\n))\nDropdownMenuRadioItem.displayName = DropdownMenuPrimitive.RadioItem.displayName\n\nconst DropdownMenuLabel = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <DropdownMenuPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuLabel.displayName = DropdownMenuPrimitive.Label.displayName\n\nconst DropdownMenuSeparator = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <DropdownMenuPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nDropdownMenuSeparator.displayName = DropdownMenuPrimitive.Separator.displayName\n\nconst DropdownMenuShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\"ml-auto text-xs tracking-widest opacity-60\", className)}\n      {...props}\n    />\n  )\n}\nDropdownMenuShortcut.displayName = \"DropdownMenuShortcut\"\n\nexport {\n  DropdownMenu,\n  DropdownMenuTrigger,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuCheckboxItem,\n  DropdownMenuRadioItem,\n  DropdownMenuLabel,\n  DropdownMenuSeparator,\n  DropdownMenuShortcut,\n  DropdownMenuGroup,\n  DropdownMenuPortal,\n  DropdownMenuSub,\n  DropdownMenuSubContent,\n  DropdownMenuSubTrigger,\n  DropdownMenuRadioGroup,\n}\n","size_bytes":7609},"client/src/lib/utils.ts":{"content":"import { clsx, type ClassValue } from \"clsx\"\nimport { twMerge } from \"tailwind-merge\"\n\nexport function cn(...inputs: ClassValue[]) {\n  return twMerge(clsx(inputs))\n}\n","size_bytes":166},"server/aiContentProcessingService.ts":{"content":"import { db } from \"./db\";\nimport { mediaAssets, content } from \"@shared/schema\";\nimport { eq } from \"drizzle-orm\";\n\n/**\n * AI Content Processing Service\n * \n * Handles automated content processing including:\n * - Auto-editing (cutting, transitions)\n * - Multi-aspect ratio conversion (9:16, 16:9, 1:1)\n * - GIF generation for promotional use\n * - Trailer creation (15-30 second teasers)\n * - Highlight reel generation\n * - Branding overlay (intros/outros)\n */\n\nexport interface ProcessingJob {\n  id: string;\n  contentId: string;\n  status: 'queued' | 'processing' | 'completed' | 'failed';\n  operations: ProcessingOperation[];\n  results?: ProcessingResults;\n  error?: string;\n  createdAt: Date;\n  completedAt?: Date;\n}\n\nexport interface ProcessingOperation {\n  type: 'edit' | 'convert' | 'gif' | 'trailer' | 'highlight' | 'branding';\n  config?: Record<string, any>;\n}\n\nexport interface ProcessingResults {\n  editedVideo?: string; // Object storage path\n  aspectRatios?: {\n    '9:16'?: string; // TikTok/Instagram Stories\n    '16:9'?: string; // YouTube\n    '1:1'?: string; // Instagram/Twitter feed\n  };\n  gif?: string;\n  trailer?: string;\n  highlights?: string[];\n  processingTime?: number; // milliseconds\n}\n\nexport interface ProcessingOptions {\n  autoEdit?: boolean;\n  aspectRatios?: Array<'9:16' | '16:9' | '1:1'>;\n  generateGif?: boolean;\n  generateTrailer?: boolean;\n  trailerDuration?: number; // seconds (15-30)\n  generateHighlights?: boolean;\n  addBranding?: boolean;\n  customBranding?: {\n    introPath?: string;\n    outroPath?: string;\n    logoPath?: string;\n  };\n}\n\nclass AIContentProcessingService {\n  private jobs: Map<string, ProcessingJob> = new Map();\n\n  /**\n   * Queue a content processing job\n   */\n  async queueProcessing(\n    contentId: string,\n    sourceVideoPath: string,\n    options: ProcessingOptions\n  ): Promise<ProcessingJob> {\n    const { nanoid } = await import('nanoid');\n    const jobId = nanoid();\n\n    const operations: ProcessingOperation[] = [];\n\n    if (options.autoEdit) {\n      operations.push({ type: 'edit', config: {} });\n    }\n\n    if (options.aspectRatios && options.aspectRatios.length > 0) {\n      operations.push({\n        type: 'convert',\n        config: { aspectRatios: options.aspectRatios }\n      });\n    }\n\n    if (options.generateGif) {\n      operations.push({ type: 'gif', config: {} });\n    }\n\n    if (options.generateTrailer) {\n      operations.push({\n        type: 'trailer',\n        config: { duration: options.trailerDuration || 15 }\n      });\n    }\n\n    if (options.generateHighlights) {\n      operations.push({ type: 'highlight', config: {} });\n    }\n\n    if (options.addBranding) {\n      operations.push({\n        type: 'branding',\n        config: options.customBranding || {}\n      });\n    }\n\n    const job: ProcessingJob = {\n      id: jobId,\n      contentId,\n      status: 'queued',\n      operations,\n      createdAt: new Date()\n    };\n\n    this.jobs.set(jobId, job);\n\n    // Start processing asynchronously\n    this.processJob(jobId, sourceVideoPath, options).catch(error => {\n      console.error(`Error processing job ${jobId}:`, error);\n      this.jobs.get(jobId)!.status = 'failed';\n      this.jobs.get(jobId)!.error = error.message;\n    });\n\n    return job;\n  }\n\n  /**\n   * Process a queued job\n   */\n  private async processJob(\n    jobId: string,\n    sourceVideoPath: string,\n    options: ProcessingOptions\n  ): Promise<void> {\n    const job = this.jobs.get(jobId);\n    if (!job) throw new Error('Job not found');\n\n    job.status = 'processing';\n    const startTime = Date.now();\n\n    try {\n      const results: ProcessingResults = {};\n\n      // Auto-edit video\n      if (options.autoEdit) {\n        results.editedVideo = await this.autoEditVideo(sourceVideoPath);\n      }\n\n      // Convert to multiple aspect ratios\n      if (options.aspectRatios && options.aspectRatios.length > 0) {\n        results.aspectRatios = await this.convertAspectRatios(\n          results.editedVideo || sourceVideoPath,\n          options.aspectRatios\n        );\n      }\n\n      // Generate GIF\n      if (options.generateGif) {\n        results.gif = await this.generateGif(results.editedVideo || sourceVideoPath);\n      }\n\n      // Generate trailer\n      if (options.generateTrailer) {\n        results.trailer = await this.generateTrailer(\n          results.editedVideo || sourceVideoPath,\n          options.trailerDuration || 15\n        );\n      }\n\n      // Generate highlights\n      if (options.generateHighlights) {\n        results.highlights = await this.generateHighlights(\n          results.editedVideo || sourceVideoPath\n        );\n      }\n\n      // Add branding\n      if (options.addBranding) {\n        await this.addBranding(results, options.customBranding);\n      }\n\n      results.processingTime = Date.now() - startTime;\n\n      job.results = results;\n      job.status = 'completed';\n      job.completedAt = new Date();\n\n    } catch (error: any) {\n      job.status = 'failed';\n      job.error = error.message;\n      throw error;\n    }\n  }\n\n  /**\n   * Auto-edit video using AI\n   * Detects best segments, removes dead space, adds transitions\n   */\n  private async autoEditVideo(sourcePath: string): Promise<string> {\n    // TODO: Integration with video editing AI service\n    // For now, return placeholder\n    console.log(`[AI Processing] Auto-editing video: ${sourcePath}`);\n    \n    // Simulate processing delay\n    await new Promise(resolve => setTimeout(resolve, 2000));\n    \n    return `processed/edited_${Date.now()}.mp4`;\n  }\n\n  /**\n   * Convert video to multiple aspect ratios\n   */\n  private async convertAspectRatios(\n    sourcePath: string,\n    ratios: Array<'9:16' | '16:9' | '1:1'>\n  ): Promise<Record<string, string>> {\n    console.log(`[AI Processing] Converting to aspect ratios: ${ratios.join(', ')}`);\n    \n    const results: Record<string, string> = {};\n    \n    for (const ratio of ratios) {\n      // TODO: Integration with video conversion service (FFmpeg, cloud video API)\n      await new Promise(resolve => setTimeout(resolve, 1000));\n      results[ratio] = `processed/${ratio.replace(':', 'x')}_${Date.now()}.mp4`;\n    }\n    \n    return results;\n  }\n\n  /**\n   * Generate GIF from video highlights\n   */\n  private async generateGif(sourcePath: string): Promise<string> {\n    console.log(`[AI Processing] Generating GIF from: ${sourcePath}`);\n    \n    // TODO: Integration with GIF generation service\n    await new Promise(resolve => setTimeout(resolve, 1500));\n    \n    return `processed/promo_${Date.now()}.gif`;\n  }\n\n  /**\n   * Generate short trailer (15-30 seconds)\n   */\n  private async generateTrailer(\n    sourcePath: string,\n    duration: number\n  ): Promise<string> {\n    console.log(`[AI Processing] Generating ${duration}s trailer from: ${sourcePath}`);\n    \n    // TODO: Integration with AI video analysis and trailer generation\n    await new Promise(resolve => setTimeout(resolve, 2000));\n    \n    return `processed/trailer_${duration}s_${Date.now()}.mp4`;\n  }\n\n  /**\n   * Generate highlight reels\n   */\n  private async generateHighlights(sourcePath: string): Promise<string[]> {\n    console.log(`[AI Processing] Generating highlights from: ${sourcePath}`);\n    \n    // TODO: Integration with AI scene detection and highlight extraction\n    await new Promise(resolve => setTimeout(resolve, 2500));\n    \n    return [\n      `processed/highlight_1_${Date.now()}.mp4`,\n      `processed/highlight_2_${Date.now()}.mp4`,\n      `processed/highlight_3_${Date.now()}.mp4`\n    ];\n  }\n\n  /**\n   * Add branding (intro/outro/logo overlay)\n   */\n  private async addBranding(\n    results: ProcessingResults,\n    branding?: ProcessingOptions['customBranding']\n  ): Promise<void> {\n    console.log(`[AI Processing] Adding branding overlays`);\n    \n    // TODO: Integration with video overlay service\n    await new Promise(resolve => setTimeout(resolve, 1000));\n    \n    // Branding would be applied to all generated videos\n  }\n\n  /**\n   * Get job status\n   */\n  async getJobStatus(jobId: string): Promise<ProcessingJob | null> {\n    return this.jobs.get(jobId) || null;\n  }\n\n  /**\n   * Get all jobs for a content item\n   */\n  async getContentJobs(contentId: string): Promise<ProcessingJob[]> {\n    return Array.from(this.jobs.values()).filter(\n      job => job.contentId === contentId\n    );\n  }\n\n  /**\n   * Cancel a processing job\n   */\n  async cancelJob(jobId: string): Promise<boolean> {\n    const job = this.jobs.get(jobId);\n    if (!job) return false;\n    \n    if (job.status === 'processing') {\n      // TODO: Implement cancellation of in-progress jobs\n      job.status = 'failed';\n      job.error = 'Job cancelled by user';\n    }\n    \n    return true;\n  }\n\n  /**\n   * Clean up completed jobs (retention policy)\n   */\n  async cleanupOldJobs(maxAgeHours: number = 24): Promise<number> {\n    const cutoff = new Date(Date.now() - maxAgeHours * 60 * 60 * 1000);\n    let cleaned = 0;\n    \n    const entries = Array.from(this.jobs.entries());\n    for (const [jobId, job] of entries) {\n      if (\n        job.status === 'completed' &&\n        job.completedAt &&\n        job.completedAt < cutoff\n      ) {\n        this.jobs.delete(jobId);\n        cleaned++;\n      }\n    }\n    \n    return cleaned;\n  }\n}\n\nexport const aiContentProcessingService = new AIContentProcessingService();\n","size_bytes":9251},"server/db.ts":{"content":"import { Pool, neonConfig } from '@neondatabase/serverless';\nimport { drizzle } from 'drizzle-orm/neon-serverless';\nimport ws from \"ws\";\nimport * as schema from \"@shared/schema\";\n\nneonConfig.webSocketConstructor = ws;\n\nif (!process.env.DATABASE_URL) {\n  throw new Error(\n    \"DATABASE_URL must be set. Did you forget to provision a database?\",\n  );\n}\n\nexport const pool = new Pool({ connectionString: process.env.DATABASE_URL });\nexport const db = drizzle({ client: pool, schema });\n","size_bytes":483},"client/src/components/onboarding/FanzOnboarding.tsx":{"content":"import { useState } from \"react\";\nimport { useMutation, useQuery } from \"@tanstack/react-query\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogDescription,\n  DialogHeader,\n  DialogTitle,\n} from \"@/components/ui/dialog\";\nimport { Button } from \"@/components/ui/button\";\nimport { Progress } from \"@/components/ui/progress\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { \n  Heart, CreditCard, Sparkles, \n  ArrowRight, ArrowLeft, CheckCircle, Users \n} from \"lucide-react\";\n\ninterface FanzOnboardingProps {\n  isOpen: boolean;\n  onComplete: () => void;\n}\n\nconst interests = [\n  \"Art\", \"Music\", \"Gaming\", \"Fitness\", \"Cooking\", \"Fashion\",\n  \"Photography\", \"Dance\", \"Comedy\", \"Lifestyle\", \"Tech\", \"Travel\"\n];\n\nexport default function FanzOnboarding({ isOpen, onComplete }: FanzOnboardingProps) {\n  const { toast } = useToast();\n  const [currentStep, setCurrentStep] = useState(1);\n  const totalSteps = 4;\n\n  const [selectedInterests, setSelectedInterests] = useState<string[]>([]);\n  const [paymentSkipped, setPaymentSkipped] = useState(false);\n\n  const { data: user } = useQuery({\n    queryKey: ['/api/auth/user'],\n  });\n\n  const updateOnboardingMutation = useMutation({\n    mutationFn: async (data: any) => {\n      const response = await apiRequest('POST', '/api/onboarding/update', data);\n      return response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['/api/auth/user'] });\n    },\n    onError: (error) => {\n      toast({\n        title: \"Error\",\n        description: \"Failed to save progress. Please try again.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const completeOnboardingMutation = useMutation({\n    mutationFn: async () => {\n      const response = await apiRequest('POST', '/api/onboarding/complete', {});\n      return response.json();\n    },\n    onSuccess: () => {\n      toast({\n        title: \"Welcome to the community! ðŸŽ‰\",\n        description: \"Your feed is ready. Start exploring!\",\n      });\n      queryClient.invalidateQueries({ queryKey: ['/api/auth/user'] });\n      onComplete();\n    },\n    onError: (error) => {\n      toast({\n        title: \"Error\",\n        description: \"Failed to complete onboarding. Please try again.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const handleNext = () => {\n    // Save current step data\n    if (currentStep === 2) {\n      updateOnboardingMutation.mutate({\n        step: currentStep,\n        data: { interests: selectedInterests },\n      });\n    }\n\n    if (currentStep < totalSteps) {\n      setCurrentStep(currentStep + 1);\n    }\n  };\n\n  const handleBack = () => {\n    if (currentStep > 1) {\n      setCurrentStep(currentStep - 1);\n    }\n  };\n\n  const handleComplete = () => {\n    completeOnboardingMutation.mutate();\n  };\n\n  const toggleInterest = (interest: string) => {\n    setSelectedInterests(prev => \n      prev.includes(interest)\n        ? prev.filter(i => i !== interest)\n        : [...prev, interest]\n    );\n  };\n\n  const progress = (currentStep / totalSteps) * 100;\n\n  return (\n    <Dialog open={isOpen} onOpenChange={() => {}}>\n      <DialogContent className=\"sm:max-w-2xl bg-card border border-border\" data-testid=\"dialog-fanz-onboarding\">\n        <DialogHeader>\n          <div className=\"flex items-center justify-center gap-2 mb-2\">\n            <Users className=\"w-6 h-6 text-secondary\" />\n            <DialogTitle className=\"font-display text-2xl\">Fanz Onboarding</DialogTitle>\n          </div>\n          <Progress value={progress} className=\"h-2\" data-testid=\"progress-onboarding\" />\n          <DialogDescription className=\"text-center mt-2\">\n            Step {currentStep} of {totalSteps}\n          </DialogDescription>\n        </DialogHeader>\n\n        <div className=\"mt-6\">\n          {/* Step 1: Welcome */}\n          {currentStep === 1 && (\n            <div className=\"space-y-6\" data-testid=\"step-welcome\">\n              <div className=\"text-center space-y-4\">\n                <Heart className=\"w-16 h-16 mx-auto text-secondary\" />\n                <h3 className=\"font-display text-2xl\">\n                  Discover. Connect. Support. ðŸ’–\n                </h3>\n                <p className=\"text-muted-foreground max-w-md mx-auto\">\n                  Your new world of creators awaits! Explore personalized content, \n                  connect directly with creators, and be part of something special.\n                </p>\n                <div className=\"bg-secondary/10 p-4 rounded-lg mt-4\">\n                  <h4 className=\"font-semibold mb-2\">What you'll love:</h4>\n                  <ul className=\"text-sm space-y-2 text-left max-w-sm mx-auto\">\n                    <li className=\"flex items-center gap-2\">\n                      <CheckCircle className=\"w-4 h-4 text-secondary\" />\n                      Personalized discovery feed\n                    </li>\n                    <li className=\"flex items-center gap-2\">\n                      <CheckCircle className=\"w-4 h-4 text-secondary\" />\n                      Direct access to creators\n                    </li>\n                    <li className=\"flex items-center gap-2\">\n                      <CheckCircle className=\"w-4 h-4 text-secondary\" />\n                      Exclusive content & experiences\n                    </li>\n                    <li className=\"flex items-center gap-2\">\n                      <CheckCircle className=\"w-4 h-4 text-secondary\" />\n                      Safe & secure platform\n                    </li>\n                  </ul>\n                </div>\n              </div>\n            </div>\n          )}\n\n          {/* Step 2: Personalization */}\n          {currentStep === 2 && (\n            <div className=\"space-y-6\" data-testid=\"step-personalization\">\n              <div className=\"text-center\">\n                <Sparkles className=\"w-16 h-16 mx-auto text-secondary mb-4\" />\n                <h3 className=\"font-display text-xl mb-2\">What interests you?</h3>\n                <p className=\"text-muted-foreground mb-4\">\n                  Select your interests to get a personalized feed\n                </p>\n              </div>\n              <div className=\"flex flex-wrap gap-2 justify-center\">\n                {interests.map(interest => (\n                  <Badge\n                    key={interest}\n                    variant={selectedInterests.includes(interest) ? \"default\" : \"outline\"}\n                    className=\"cursor-pointer px-4 py-2 text-sm\"\n                    onClick={() => toggleInterest(interest)}\n                    data-testid={`badge-interest-${interest.toLowerCase()}`}\n                  >\n                    {interest}\n                  </Badge>\n                ))}\n              </div>\n              <p className=\"text-center text-sm text-muted-foreground\">\n                Selected {selectedInterests.length} interests\n              </p>\n            </div>\n          )}\n\n          {/* Step 3: Payment Setup (Optional) */}\n          {currentStep === 3 && (\n            <div className=\"space-y-6\" data-testid=\"step-payment\">\n              <div className=\"text-center\">\n                <CreditCard className=\"w-16 h-16 mx-auto text-secondary mb-4\" />\n                <h3 className=\"font-display text-xl mb-2\">Payment Setup</h3>\n                <p className=\"text-muted-foreground mb-4\">\n                  Add a payment method to tip or subscribe instantly (optional)\n                </p>\n              </div>\n              <div className=\"bg-muted/50 p-6 rounded-lg space-y-4\">\n                <div className=\"flex items-center justify-center gap-2 text-sm text-muted-foreground\">\n                  <CheckCircle className=\"w-4 h-4\" />\n                  <span>Bank-level encryption</span>\n                </div>\n                <div className=\"flex items-center justify-center gap-2 text-sm text-muted-foreground\">\n                  <CheckCircle className=\"w-4 h-4\" />\n                  <span>Your privacy is protected</span>\n                </div>\n                <Button \n                  variant=\"outline\" \n                  className=\"w-full\" \n                  onClick={() => setPaymentSkipped(true)}\n                  data-testid=\"button-skip-payment\"\n                >\n                  Skip for now\n                </Button>\n                <Button className=\"w-full btn-secondary\" data-testid=\"button-add-payment\">\n                  <CreditCard className=\"w-4 h-4 mr-2\" />\n                  Add Payment Method\n                </Button>\n              </div>\n            </div>\n          )}\n\n          {/* Step 4: Dashboard Intro */}\n          {currentStep === 4 && (\n            <div className=\"space-y-6\" data-testid=\"step-dashboard\">\n              <div className=\"text-center\">\n                <Sparkles className=\"w-16 h-16 mx-auto text-secondary mb-4\" />\n                <h3 className=\"font-display text-2xl mb-2\">You're All Set! ðŸŽ‰</h3>\n                <p className=\"text-muted-foreground mb-4\">\n                  Your personalized feed is ready. Here's how to get started:\n                </p>\n              </div>\n              <div className=\"space-y-3\">\n                <div className=\"flex items-start gap-3 p-3 bg-muted/50 rounded-lg\">\n                  <Heart className=\"w-5 h-5 text-secondary mt-0.5\" />\n                  <div>\n                    <h4 className=\"font-semibold\">Discover Creators</h4>\n                    <p className=\"text-sm text-muted-foreground\">\n                      Browse your personalized feed and find creators you love\n                    </p>\n                  </div>\n                </div>\n                <div className=\"flex items-start gap-3 p-3 bg-muted/50 rounded-lg\">\n                  <Users className=\"w-5 h-5 text-secondary mt-0.5\" />\n                  <div>\n                    <h4 className=\"font-semibold\">Follow & Subscribe</h4>\n                    <p className=\"text-sm text-muted-foreground\">\n                      Support creators and get access to exclusive content\n                    </p>\n                  </div>\n                </div>\n                <div className=\"flex items-start gap-3 p-3 bg-muted/50 rounded-lg\">\n                  <Sparkles className=\"w-5 h-5 text-secondary mt-0.5\" />\n                  <div>\n                    <h4 className=\"font-semibold\">Engage & Connect</h4>\n                    <p className=\"text-sm text-muted-foreground\">\n                      Like, comment, tip, and message your favorite creators\n                    </p>\n                  </div>\n                </div>\n              </div>\n            </div>\n          )}\n        </div>\n\n        {/* Navigation */}\n        <div className=\"flex justify-between mt-6\">\n          <Button\n            variant=\"outline\"\n            onClick={handleBack}\n            disabled={currentStep === 1}\n            data-testid=\"button-back\"\n          >\n            <ArrowLeft className=\"w-4 h-4 mr-2\" />\n            Back\n          </Button>\n          \n          {currentStep < totalSteps ? (\n            <Button\n              onClick={handleNext}\n              disabled={updateOnboardingMutation.isPending}\n              data-testid=\"button-next\"\n            >\n              {updateOnboardingMutation.isPending ? 'Saving...' : 'Next'}\n              <ArrowRight className=\"w-4 h-4 ml-2\" />\n            </Button>\n          ) : (\n            <Button\n              onClick={handleComplete}\n              disabled={completeOnboardingMutation.isPending}\n              className=\"btn-secondary\"\n              data-testid=\"button-complete\"\n            >\n              {completeOnboardingMutation.isPending ? 'Completing...' : 'Start Exploring'}\n              <CheckCircle className=\"w-4 h-4 ml-2\" />\n            </Button>\n          )}\n        </div>\n      </DialogContent>\n    </Dialog>\n  );\n}\n","size_bytes":11798},"client/src/hooks/useAuth.ts":{"content":"import { useQuery } from \"@tanstack/react-query\";\n\nexport function useAuth() {\n  const { data: user, isLoading, error } = useQuery({\n    queryKey: [\"/api/auth/user\"],\n    retry: false,\n    throwOnError: false,\n  });\n\n  // User is authenticated if we have user data and no 401 error\n  const isAuthenticated = !!user && !error;\n\n  return {\n    user: isAuthenticated ? user : null,\n    isLoading,\n    isAuthenticated,\n  };\n}\n","size_bytes":422},"server/storage.ts":{"content":"import {\n  users,\n  profiles,\n  mediaAssets,\n  subscriptions,\n  tips,\n  messages,\n  consentRecords,\n  safetyReports,\n  kycVerifications,\n  moderationQueue,\n  tenants,\n  content,\n  contentTenantMap,\n  subscriptionPlans,\n  packs,\n  packMembers,\n  type User,\n  type InsertUser,\n  type Profile,\n  type InsertProfile,\n  type MediaAsset,\n  type InsertMediaAsset,\n  type Subscription,\n  type InsertSubscription,\n  type Tip,\n  type InsertTip,\n  type Message,\n  type InsertMessage,\n  type ConsentRecord,\n  type InsertConsentRecord,\n  type SafetyReport,\n  type InsertSafetyReport,\n  type Tenant,\n  type InsertTenant,\n  type Content,\n  type InsertContent,\n  type ContentTenantMap,\n  type InsertContentTenantMap,\n  type SubscriptionPlan,\n  type InsertSubscriptionPlan,\n  type Pack,\n  type InsertPack,\n  type PackMember,\n  type InsertPackMember,\n} from \"@shared/schema\";\nimport { db } from \"./db\";\nimport { eq, desc, and, or, like, count, isNull } from \"drizzle-orm\";\n\nexport interface IStorage {\n  // User operations (mandatory for Replit Auth)\n  getUser(id: string): Promise<User | undefined>;\n  upsertUser(user: InsertUser): Promise<User>;\n  createUser(user: InsertUser): Promise<User>;\n  getUserByUsername(username: string): Promise<User | undefined>;\n  getUserByEmail(email: string): Promise<User | undefined>;\n  \n  // Profile operations\n  getProfile(userId: string): Promise<Profile | undefined>;\n  createProfile(profile: InsertProfile): Promise<Profile>;\n  updateProfile(userId: string, updates: Partial<InsertProfile>): Promise<Profile>;\n  \n  // Media operations\n  createMediaAsset(asset: InsertMediaAsset): Promise<MediaAsset>;\n  getMediaAsset(id: string): Promise<MediaAsset | undefined>;\n  getMediaAssetsByOwner(ownerId: string): Promise<MediaAsset[]>;\n  getUserMediaAssets(userId: string): Promise<MediaAsset[]>;\n  updateMediaAsset(id: string, updates: Partial<InsertMediaAsset>): Promise<MediaAsset>;\n  deleteMediaAsset(id: string): Promise<void>;\n  checkMediaAccess(userId: string, mediaId: string): Promise<boolean>;\n  \n  // Discovery operations\n  searchCreators(query: string, filters?: any): Promise<(User & { profile: Profile | null })[]>;\n  getFeaturedCreators(): Promise<(User & { profile: Profile | null })[]>;\n  \n  // Subscription operations\n  createSubscription(subscription: InsertSubscription): Promise<Subscription>;\n  getSubscriptionsByFan(fanId: string): Promise<Subscription[]>;\n  getSubscriptionsByCreator(creatorId: string): Promise<Subscription[]>;\n  \n  // Tip operations\n  createTip(tip: InsertTip): Promise<Tip>;\n  getTipsByCreator(creatorId: string): Promise<Tip[]>;\n  \n  // Messaging operations\n  createMessage(message: InsertMessage): Promise<Message>;\n  getMessagesBetweenUsers(user1Id: string, user2Id: string): Promise<Message[]>;\n  getConversations(userId: string): Promise<any[]>;\n  \n  // Safety operations\n  createConsentRecord(consent: InsertConsentRecord): Promise<ConsentRecord>;\n  getConsentRecords(userId: string): Promise<ConsentRecord[]>;\n  createSafetyReport(report: InsertSafetyReport): Promise<SafetyReport>;\n  \n  // Analytics operations\n  getCreatorEarnings(creatorId: string, period: 'day' | 'week' | 'month'): Promise<any>;\n  getCreatorStats(creatorId: string): Promise<any>;\n  \n  // Multi-tenant operations\n  getTenants(): Promise<Tenant[]>;\n  getTenant(id: string): Promise<Tenant | undefined>;\n  getTenantBySlug(slug: string): Promise<Tenant | undefined>;\n  \n  // Enhanced content operations\n  createContent(content: InsertContent): Promise<Content>;\n  getContent(id: string): Promise<Content | undefined>;\n  getContentByCreator(creatorId: string, tenantId?: string): Promise<Content[]>;\n  getContentByTenant(tenantId: string): Promise<Content[]>;\n  updateContent(id: string, updates: Partial<InsertContent>): Promise<Content>;\n  deleteContent(id: string): Promise<void>;\n  \n  // Cross-posting operations\n  publishContentToTenant(contentId: string, tenantId: string): Promise<ContentTenantMap>;\n  unpublishContentFromTenant(contentId: string, tenantId: string): Promise<void>;\n  getContentTenants(contentId: string): Promise<ContentTenantMap[]>;\n  \n  // Enhanced subscription plans\n  createSubscriptionPlan(plan: InsertSubscriptionPlan): Promise<SubscriptionPlan>;\n  getSubscriptionPlans(creatorId: string, tenantId?: string): Promise<SubscriptionPlan[]>;\n  getSubscriptionPlan(id: string): Promise<SubscriptionPlan | undefined>;\n  updateSubscriptionPlan(id: string, updates: Partial<InsertSubscriptionPlan>): Promise<SubscriptionPlan>;\n  deleteSubscriptionPlan(id: string): Promise<void>;\n  \n  // Feed operations\n  getFeedPosts(userId: string | undefined, page: number, limit: number): Promise<any[]>;\n  \n  // Pack operations\n  createPack(pack: InsertPack): Promise<Pack>;\n  getPack(id: string): Promise<Pack | undefined>;\n  getPackBySlug(slug: string): Promise<Pack | undefined>;\n  getPacksByCreator(creatorId: string): Promise<Pack[]>;\n  getAllPacks(): Promise<Pack[]>;\n  joinPack(packId: string, userId: string): Promise<PackMember>;\n  leavePack(packId: string, userId: string): Promise<void>;\n  getUserPacks(userId: string): Promise<(Pack & { membership: PackMember })[]>;\n  getPackMembers(packId: string): Promise<(PackMember & { user: User })[]>;\n  isPackMember(packId: string, userId: string): Promise<boolean>;\n}\n\nexport class DatabaseStorage implements IStorage {\n  async getUser(id: string): Promise<User | undefined> {\n    const [user] = await db.select().from(users).where(eq(users.id, id));\n    return user;\n  }\n\n  async upsertUser(userData: InsertUser): Promise<User> {\n    const [user] = await db\n      .insert(users)\n      .values(userData)\n      .onConflictDoUpdate({\n        target: users.id,\n        set: {\n          ...userData,\n          updatedAt: new Date(),\n        },\n      })\n      .returning();\n    return user;\n  }\n\n  async createUser(userData: InsertUser): Promise<User> {\n    const [user] = await db.insert(users).values(userData).returning();\n    return user;\n  }\n\n  async getUserByUsername(username: string): Promise<User | undefined> {\n    const [user] = await db.select().from(users).where(eq(users.username, username));\n    return user;\n  }\n\n  async getUserByEmail(email: string): Promise<User | undefined> {\n    const [user] = await db.select().from(users).where(eq(users.email, email));\n    return user;\n  }\n\n  async getProfile(userId: string): Promise<Profile | undefined> {\n    const [profile] = await db.select().from(profiles).where(eq(profiles.userId, userId));\n    return profile;\n  }\n\n  async createProfile(profileData: InsertProfile): Promise<Profile> {\n    const [profile] = await db.insert(profiles).values(profileData).returning();\n    return profile;\n  }\n\n  async updateProfile(userId: string, updates: Partial<InsertProfile>): Promise<Profile> {\n    const [profile] = await db\n      .update(profiles)\n      .set({ ...updates, updatedAt: new Date() })\n      .where(eq(profiles.userId, userId))\n      .returning();\n    return profile;\n  }\n\n  async createMediaAsset(assetData: InsertMediaAsset): Promise<MediaAsset> {\n    const [asset] = await db.insert(mediaAssets).values(assetData).returning();\n    return asset;\n  }\n\n  async getMediaAsset(id: string): Promise<MediaAsset | undefined> {\n    const [asset] = await db.select().from(mediaAssets).where(eq(mediaAssets.id, id));\n    return asset;\n  }\n\n  async getMediaAssetsByOwner(ownerId: string): Promise<MediaAsset[]> {\n    return await db\n      .select()\n      .from(mediaAssets)\n      .where(eq(mediaAssets.ownerId, ownerId))\n      .orderBy(desc(mediaAssets.createdAt));\n  }\n\n  async updateMediaAsset(id: string, updates: Partial<InsertMediaAsset>): Promise<MediaAsset> {\n    const [asset] = await db\n      .update(mediaAssets)\n      .set({ ...updates, updatedAt: new Date() })\n      .where(eq(mediaAssets.id, id))\n      .returning();\n    return asset;\n  }\n\n  async getUserMediaAssets(userId: string): Promise<MediaAsset[]> {\n    return this.getMediaAssetsByOwner(userId);\n  }\n\n  async deleteMediaAsset(id: string): Promise<void> {\n    await db.delete(mediaAssets).where(eq(mediaAssets.id, id));\n  }\n\n  async checkMediaAccess(userId: string, mediaId: string): Promise<boolean> {\n    const media = await this.getMediaAsset(mediaId);\n    if (!media) return false;\n\n    // Owner always has access\n    if (media.ownerId === userId) return true;\n\n    // Public content is accessible to all\n    if (media.accessLevel === 'pack') return true;\n\n    // For premium/ppv content, check subscriptions\n    if (media.accessLevel === 'premium') {\n      const subscriptions = await this.getSubscriptionsByFan(userId);\n      return subscriptions.some(sub => \n        sub.creatorId === media.ownerId && \n        sub.status === 'active'\n      );\n    }\n\n    // For PPV content, would need to check payment records\n    // For now, return false (would implement payment check here)\n    return false;\n  }\n\n  async searchCreators(query: string, filters?: any): Promise<(User & { profile: Profile | null })[]> {\n    const results = await db\n      .select({\n        id: users.id,\n        username: users.username,\n        email: users.email,\n        firstName: users.firstName,\n        lastName: users.lastName,\n        profileImageUrl: users.profileImageUrl,\n        role: users.role,\n        authProvider: users.authProvider,\n        status: users.status,\n        createdAt: users.createdAt,\n        updatedAt: users.updatedAt,\n        password: users.password,\n        profile: {\n          id: profiles.id,\n          userId: profiles.userId,\n          displayName: profiles.displayName,\n          bio: profiles.bio,\n          avatarUrl: profiles.avatarUrl,\n          bannerUrl: profiles.bannerUrl,\n          kycStatus: profiles.kycStatus,\n          ageVerified: profiles.ageVerified,\n          packType: profiles.packType,\n          isAftercareFriendly: profiles.isAftercareFriendly,\n          safetyBadges: profiles.safetyBadges,\n          createdAt: profiles.createdAt,\n          updatedAt: profiles.updatedAt,\n        }\n      })\n      .from(users)\n      .leftJoin(profiles, eq(users.id, profiles.userId))\n      .where(\n        and(\n          eq(users.role, 'creator'),\n          eq(users.status, 'active'),\n          or(\n            like(users.username, `%${query}%`),\n            like(profiles.displayName, `%${query}%`),\n            like(profiles.bio, `%${query}%`)\n          )\n        )\n      )\n      .limit(20);\n\n    return results.map(row => ({\n      ...row,\n      profile: row.profile?.id ? row.profile : null\n    }));\n  }\n\n  async getFeaturedCreators(): Promise<(User & { profile: Profile | null })[]> {\n    const results = await db\n      .select({\n        id: users.id,\n        username: users.username,\n        email: users.email,\n        firstName: users.firstName,\n        lastName: users.lastName,\n        profileImageUrl: users.profileImageUrl,\n        role: users.role,\n        authProvider: users.authProvider,\n        status: users.status,\n        createdAt: users.createdAt,\n        updatedAt: users.updatedAt,\n        password: users.password,\n        profile: {\n          id: profiles.id,\n          userId: profiles.userId,\n          displayName: profiles.displayName,\n          bio: profiles.bio,\n          avatarUrl: profiles.avatarUrl,\n          bannerUrl: profiles.bannerUrl,\n          kycStatus: profiles.kycStatus,\n          ageVerified: profiles.ageVerified,\n          packType: profiles.packType,\n          isAftercareFriendly: profiles.isAftercareFriendly,\n          safetyBadges: profiles.safetyBadges,\n          createdAt: profiles.createdAt,\n          updatedAt: profiles.updatedAt,\n        }\n      })\n      .from(users)\n      .leftJoin(profiles, eq(users.id, profiles.userId))\n      .where(\n        and(\n          eq(users.role, 'creator'),\n          eq(users.status, 'active'),\n          eq(profiles.ageVerified, true)\n        )\n      )\n      .orderBy(desc(users.createdAt))\n      .limit(12);\n\n    return results.map(row => ({\n      ...row,\n      profile: row.profile?.id ? row.profile : null\n    }));\n  }\n\n  async createSubscription(subscriptionData: InsertSubscription): Promise<Subscription> {\n    const [subscription] = await db.insert(subscriptions).values(subscriptionData).returning();\n    return subscription;\n  }\n\n  async getSubscriptionsByFan(fanId: string): Promise<Subscription[]> {\n    return await db\n      .select()\n      .from(subscriptions)\n      .where(eq(subscriptions.fanId, fanId))\n      .orderBy(desc(subscriptions.createdAt));\n  }\n\n  async getSubscriptionsByCreator(creatorId: string): Promise<Subscription[]> {\n    return await db\n      .select()\n      .from(subscriptions)\n      .where(eq(subscriptions.creatorId, creatorId))\n      .orderBy(desc(subscriptions.createdAt));\n  }\n\n  async createTip(tipData: InsertTip): Promise<Tip> {\n    const [tip] = await db.insert(tips).values(tipData).returning();\n    return tip;\n  }\n\n  async getTipsByCreator(creatorId: string): Promise<Tip[]> {\n    return await db\n      .select()\n      .from(tips)\n      .where(eq(tips.toUserId, creatorId))\n      .orderBy(desc(tips.createdAt));\n  }\n\n  async createMessage(messageData: InsertMessage): Promise<Message> {\n    const [message] = await db.insert(messages).values(messageData).returning();\n    return message;\n  }\n\n  async getMessagesBetweenUsers(user1Id: string, user2Id: string): Promise<Message[]> {\n    return await db\n      .select()\n      .from(messages)\n      .where(\n        or(\n          and(eq(messages.fromUserId, user1Id), eq(messages.toUserId, user2Id)),\n          and(eq(messages.fromUserId, user2Id), eq(messages.toUserId, user1Id))\n        )\n      )\n      .orderBy(messages.createdAt);\n  }\n\n  async getConversations(userId: string): Promise<any[]> {\n    // Get recent conversations for a user\n    const conversations = await db\n      .select({\n        otherUserId: messages.fromUserId,\n        lastMessage: messages.content,\n        lastMessageTime: messages.createdAt,\n        unreadCount: count(),\n      })\n      .from(messages)\n      .where(\n        and(\n          eq(messages.toUserId, userId),\n          isNull(messages.readAt)\n        )\n      )\n      .groupBy(messages.fromUserId, messages.content, messages.createdAt)\n      .orderBy(desc(messages.createdAt))\n      .limit(10);\n\n    return conversations;\n  }\n\n  async createConsentRecord(consentData: InsertConsentRecord): Promise<ConsentRecord> {\n    const [consent] = await db.insert(consentRecords).values(consentData).returning();\n    return consent;\n  }\n\n  async getConsentRecords(userId: string): Promise<ConsentRecord[]> {\n    return await db\n      .select()\n      .from(consentRecords)\n      .where(eq(consentRecords.userId, userId))\n      .orderBy(desc(consentRecords.createdAt));\n  }\n\n  async createSafetyReport(reportData: InsertSafetyReport): Promise<SafetyReport> {\n    const [report] = await db.insert(safetyReports).values(reportData).returning();\n    return report;\n  }\n\n  async getCreatorEarnings(creatorId: string, period: 'day' | 'week' | 'month'): Promise<any> {\n    // Calculate earnings from tips and subscriptions\n    const now = new Date();\n    let startDate: Date;\n\n    switch (period) {\n      case 'day':\n        startDate = new Date(now.getTime() - 24 * 60 * 60 * 1000);\n        break;\n      case 'week':\n        startDate = new Date(now.getTime() - 7 * 24 * 60 * 60 * 1000);\n        break;\n      case 'month':\n        startDate = new Date(now.getTime() - 30 * 24 * 60 * 60 * 1000);\n        break;\n    }\n\n    const tipEarnings = await db\n      .select()\n      .from(tips)\n      .where(\n        and(\n          eq(tips.toUserId, creatorId),\n          eq(tips.status, 'completed')\n        )\n      );\n\n    const subscriptionEarnings = await db\n      .select()\n      .from(subscriptions)\n      .where(\n        and(\n          eq(subscriptions.creatorId, creatorId),\n          eq(subscriptions.status, 'active')\n        )\n      );\n\n    const totalTips = tipEarnings.reduce((sum, tip) => sum + parseFloat(tip.amount), 0);\n    const totalSubscriptions = subscriptionEarnings.reduce((sum, sub) => sum + parseFloat(sub.price), 0);\n\n    return {\n      totalEarnings: totalTips + totalSubscriptions,\n      tipEarnings: totalTips,\n      subscriptionEarnings: totalSubscriptions,\n      period,\n    };\n  }\n\n  async getCreatorStats(creatorId: string): Promise<any> {\n    const [subscriberCount] = await db\n      .select({ count: count() })\n      .from(subscriptions)\n      .where(\n        and(\n          eq(subscriptions.creatorId, creatorId),\n          eq(subscriptions.status, 'active')\n        )\n      );\n\n    const [contentCount] = await db\n      .select({ count: count() })\n      .from(mediaAssets)\n      .where(eq(mediaAssets.ownerId, creatorId));\n\n    const viewsSum = await db\n      .select()\n      .from(mediaAssets)\n      .where(eq(mediaAssets.ownerId, creatorId));\n\n    const totalViews = viewsSum.reduce((sum, asset) => sum + (asset.viewCount || 0), 0);\n\n    return {\n      subscribers: subscriberCount.count,\n      contentCount: contentCount.count,\n      totalViews,\n    };\n  }\n\n  // Multi-tenant operations\n  async getTenants(): Promise<Tenant[]> {\n    return await db.select().from(tenants).orderBy(tenants.name);\n  }\n\n  async getTenant(id: string): Promise<Tenant | undefined> {\n    const [tenant] = await db.select().from(tenants).where(eq(tenants.id, id));\n    return tenant;\n  }\n\n  async getTenantBySlug(slug: string): Promise<Tenant | undefined> {\n    const [tenant] = await db.select().from(tenants).where(eq(tenants.slug, slug));\n    return tenant;\n  }\n\n  // Enhanced content operations\n  async createContent(contentData: InsertContent): Promise<Content> {\n    const [contentItem] = await db.insert(content).values(contentData).returning();\n    return contentItem;\n  }\n\n  async getContent(id: string): Promise<Content | undefined> {\n    const [contentItem] = await db.select().from(content).where(eq(content.id, id));\n    return contentItem;\n  }\n\n  async getContentByCreator(creatorId: string, tenantId?: string): Promise<Content[]> {\n    if (tenantId) {\n      const results = await db\n        .select({\n          id: content.id,\n          creatorUserId: content.creatorUserId,\n          title: content.title,\n          caption: content.caption,\n          priceCents: content.priceCents,\n          visibility: content.visibility,\n          canonicalTenant: content.canonicalTenant,\n          tags: content.tags,\n          mediaAssetIds: content.mediaAssetIds,\n          createdAt: content.createdAt,\n          updatedAt: content.updatedAt,\n        })\n        .from(content)\n        .innerJoin(contentTenantMap, eq(content.id, contentTenantMap.contentId))\n        .where(\n          and(\n            eq(content.creatorUserId, creatorId),\n            eq(contentTenantMap.tenantId, tenantId),\n            eq(contentTenantMap.status, 'published')\n          )\n        )\n        .orderBy(desc(content.createdAt));\n      return results;\n    }\n\n    return await db\n      .select()\n      .from(content)\n      .where(eq(content.creatorUserId, creatorId))\n      .orderBy(desc(content.createdAt));\n  }\n\n  async getContentByTenant(tenantId: string): Promise<Content[]> {\n    return await db\n      .select({\n        id: content.id,\n        creatorUserId: content.creatorUserId,\n        title: content.title,\n        caption: content.caption,\n        priceCents: content.priceCents,\n        visibility: content.visibility,\n        canonicalTenant: content.canonicalTenant,\n        tags: content.tags,\n        mediaAssetIds: content.mediaAssetIds,\n        createdAt: content.createdAt,\n        updatedAt: content.updatedAt,\n      })\n      .from(content)\n      .innerJoin(contentTenantMap, eq(content.id, contentTenantMap.contentId))\n      .where(\n        and(\n          eq(contentTenantMap.tenantId, tenantId),\n          eq(contentTenantMap.status, 'published')\n        )\n      )\n      .orderBy(desc(content.createdAt));\n  }\n\n  async updateContent(id: string, updates: Partial<InsertContent>): Promise<Content> {\n    const [contentItem] = await db\n      .update(content)\n      .set({ ...updates, updatedAt: new Date() })\n      .where(eq(content.id, id))\n      .returning();\n    return contentItem;\n  }\n\n  async deleteContent(id: string): Promise<void> {\n    // Delete content-tenant mappings first\n    await db.delete(contentTenantMap).where(eq(contentTenantMap.contentId, id));\n    // Delete the content\n    await db.delete(content).where(eq(content.id, id));\n  }\n\n  // Cross-posting operations\n  async publishContentToTenant(contentId: string, tenantId: string): Promise<ContentTenantMap> {\n    const [mapping] = await db\n      .insert(contentTenantMap)\n      .values({\n        contentId,\n        tenantId,\n        status: 'published',\n        publishedAt: new Date(),\n      })\n      .onConflictDoUpdate({\n        target: [contentTenantMap.contentId, contentTenantMap.tenantId],\n        set: {\n          status: 'published',\n          publishedAt: new Date(),\n        },\n      })\n      .returning();\n    return mapping;\n  }\n\n  async unpublishContentFromTenant(contentId: string, tenantId: string): Promise<void> {\n    await db\n      .update(contentTenantMap)\n      .set({ status: 'hidden' })\n      .where(\n        and(\n          eq(contentTenantMap.contentId, contentId),\n          eq(contentTenantMap.tenantId, tenantId)\n        )\n      );\n  }\n\n  async getContentTenants(contentId: string): Promise<ContentTenantMap[]> {\n    return await db\n      .select()\n      .from(contentTenantMap)\n      .where(eq(contentTenantMap.contentId, contentId));\n  }\n\n  // Enhanced subscription plans\n  async createSubscriptionPlan(planData: InsertSubscriptionPlan): Promise<SubscriptionPlan> {\n    const [plan] = await db.insert(subscriptionPlans).values(planData).returning();\n    return plan;\n  }\n\n  async getSubscriptionPlans(creatorId: string, tenantId?: string): Promise<SubscriptionPlan[]> {\n    if (tenantId) {\n      return await db\n        .select()\n        .from(subscriptionPlans)\n        .where(\n          and(\n            eq(subscriptionPlans.creatorUserId, creatorId),\n            eq(subscriptionPlans.active, true),\n            eq(subscriptionPlans.tenantId, tenantId)\n          )\n        )\n        .orderBy(subscriptionPlans.priceCents);\n    }\n\n    return await db\n      .select()\n      .from(subscriptionPlans)\n      .where(\n        and(\n          eq(subscriptionPlans.creatorUserId, creatorId),\n          eq(subscriptionPlans.active, true)\n        )\n      )\n      .orderBy(subscriptionPlans.priceCents);\n  }\n\n  async getSubscriptionPlan(id: string): Promise<SubscriptionPlan | undefined> {\n    const [plan] = await db.select().from(subscriptionPlans).where(eq(subscriptionPlans.id, id));\n    return plan;\n  }\n\n  async updateSubscriptionPlan(id: string, updates: Partial<InsertSubscriptionPlan>): Promise<SubscriptionPlan> {\n    const [plan] = await db\n      .update(subscriptionPlans)\n      .set(updates)\n      .where(eq(subscriptionPlans.id, id))\n      .returning();\n    return plan;\n  }\n\n  async deleteSubscriptionPlan(id: string): Promise<void> {\n    await db\n      .update(subscriptionPlans)\n      .set({ active: false })\n      .where(eq(subscriptionPlans.id, id));\n  }\n\n  // Feed operations\n  async getFeedPosts(userId: string | undefined, page: number, limit: number): Promise<any[]> {\n    const offset = (page - 1) * limit;\n    \n    // Get content with creator information and pack info\n    const contentList = await db\n      .select({\n        content: content,\n        creator: users,\n        profile: profiles,\n        packMembership: packMembers,\n        pack: packs,\n      })\n      .from(content)\n      .leftJoin(users, eq(content.creatorUserId, users.id))\n      .leftJoin(profiles, eq(users.id, profiles.userId))\n      .leftJoin(packMembers, eq(users.id, packMembers.userId))\n      .leftJoin(packs, eq(packMembers.packId, packs.id))\n      .where(eq(content.visibility, 'public'))\n      .orderBy(desc(content.createdAt))\n      .limit(limit)\n      .offset(offset);\n\n    // Get user subscriptions if logged in\n    let userSubscriptions: Set<string> = new Set();\n    if (userId) {\n      const subs = await db\n        .select()\n        .from(subscriptions)\n        .where(\n          and(\n            eq(subscriptions.fanId, userId),\n            eq(subscriptions.status, 'active')\n          )\n        );\n      userSubscriptions = new Set(subs.map(s => s.creatorId));\n    }\n\n    // Transform to feed format\n    return contentList.map(item => ({\n      id: item.content.id,\n      creatorUserId: item.content.creatorUserId,\n      creatorName: item.creator?.username || item.profile?.displayName || 'Unknown',\n      creatorAvatar: item.profile?.avatarUrl || '',\n      creatorIsAgeVerified: item.profile?.ageVerified || false,\n      creatorAllowsFree: item.profile?.allowsFreeAccess || false,\n      packName: item.pack?.name || null,\n      title: item.content.title,\n      caption: item.content.caption,\n      visibility: item.content.visibility,\n      priceCents: item.content.priceCents || 0,\n      mediaUrl: item.content.mediaAssetIds && (item.content.mediaAssetIds as any[])[0] \n        ? `/api/media/${(item.content.mediaAssetIds as any[])[0]}/download` \n        : undefined,\n      mediaType: 'image/jpeg', // TODO: Get actual media type from mediaAssets table\n      isSubscribed: userId ? userSubscriptions.has(item.content.creatorUserId) : false,\n      isFree: item.content.visibility === 'public' && item.content.priceCents === 0,\n      tags: (item.content.tags as string[]) || [],\n      likeCount: 0, // TODO: Implement likes system\n      commentCount: 0, // TODO: Implement comments system\n      createdAt: item.content.createdAt,\n    }));\n  }\n\n  // Pack operations\n  async createPack(pack: InsertPack): Promise<Pack> {\n    const [newPack] = await db.insert(packs).values(pack).returning();\n    \n    // Automatically add creator as pack owner\n    await db.insert(packMembers).values({\n      packId: newPack.id,\n      userId: pack.creatorId,\n      role: 'owner',\n    });\n    \n    return newPack;\n  }\n\n  async getPack(id: string): Promise<Pack | undefined> {\n    const [pack] = await db.select().from(packs).where(eq(packs.id, id));\n    return pack;\n  }\n\n  async getPackBySlug(slug: string): Promise<Pack | undefined> {\n    const [pack] = await db.select().from(packs).where(eq(packs.slug, slug));\n    return pack;\n  }\n\n  async getPacksByCreator(creatorId: string): Promise<Pack[]> {\n    return db.select().from(packs).where(eq(packs.creatorId, creatorId));\n  }\n\n  async getAllPacks(): Promise<Pack[]> {\n    return db.select().from(packs).where(eq(packs.isPublic, true)).orderBy(desc(packs.createdAt));\n  }\n\n  async joinPack(packId: string, userId: string): Promise<PackMember> {\n    const [member] = await db.insert(packMembers).values({\n      packId,\n      userId,\n      role: 'member',\n    }).returning();\n    \n    // Update member count\n    await db.update(packs)\n      .set({ memberCount: db.raw('member_count + 1') as any })\n      .where(eq(packs.id, packId));\n    \n    return member;\n  }\n\n  async leavePack(packId: string, userId: string): Promise<void> {\n    await db.delete(packMembers)\n      .where(and(\n        eq(packMembers.packId, packId),\n        eq(packMembers.userId, userId)\n      ));\n    \n    // Update member count\n    await db.update(packs)\n      .set({ memberCount: db.raw('member_count - 1') as any })\n      .where(eq(packs.id, packId));\n  }\n\n  async getUserPacks(userId: string): Promise<(Pack & { membership: PackMember })[]> {\n    const userPackMemberships = await db\n      .select({\n        pack: packs,\n        membership: packMembers,\n      })\n      .from(packMembers)\n      .innerJoin(packs, eq(packMembers.packId, packs.id))\n      .where(eq(packMembers.userId, userId));\n    \n    return userPackMemberships.map(item => ({\n      ...item.pack,\n      membership: item.membership,\n    }));\n  }\n\n  async getPackMembers(packId: string): Promise<(PackMember & { user: User })[]> {\n    const members = await db\n      .select({\n        member: packMembers,\n        user: users,\n      })\n      .from(packMembers)\n      .innerJoin(users, eq(packMembers.userId, users.id))\n      .where(eq(packMembers.packId, packId));\n    \n    return members.map(item => ({\n      ...item.member,\n      user: item.user,\n    }));\n  }\n\n  async isPackMember(packId: string, userId: string): Promise<boolean> {\n    const [member] = await db\n      .select()\n      .from(packMembers)\n      .where(and(\n        eq(packMembers.packId, packId),\n        eq(packMembers.userId, userId)\n      ));\n    \n    return !!member;\n  }\n}\n\nexport const storage = new DatabaseStorage();\n","size_bytes":28434},"server/microlendingService.ts":{"content":"import { db } from './db';\nimport { \n  loanListings, \n  loanOffers, \n  activeLoans, \n  loanPayments, \n  loanCollateral,\n  users \n} from '@shared/schema';\nimport { eq, and, desc, sql } from 'drizzle-orm';\n\nexport type LoanListing = typeof loanListings.$inferSelect;\nexport type LoanOffer = typeof loanOffers.$inferSelect;\nexport type ActiveLoan = typeof activeLoans.$inferSelect;\nexport type LoanPayment = typeof loanPayments.$inferSelect;\nexport type LoanCollateral = typeof loanCollateral.$inferSelect;\n\nclass MicrolendingService {\n  async createLoanListing(data: Partial<LoanListing>): Promise<LoanListing> {\n    const creditScore = await this.calculateCreditScore(data.creatorId!);\n    const riskLevel = this.calculateRiskLevel(creditScore);\n\n    const [listing] = await db.insert(loanListings).values({\n      ...data,\n      creditScore,\n      riskLevel,\n    } as any).returning();\n\n    return listing;\n  }\n\n  async getCreatorListings(creatorId: string): Promise<LoanListing[]> {\n    return db\n      .select()\n      .from(loanListings)\n      .where(eq(loanListings.creatorId, creatorId))\n      .orderBy(desc(loanListings.createdAt));\n  }\n\n  async getActiveListings(): Promise<LoanListing[]> {\n    return db\n      .select()\n      .from(loanListings)\n      .where(eq(loanListings.status, 'active'))\n      .orderBy(desc(loanListings.createdAt));\n  }\n\n  async getListing(id: string): Promise<LoanListing | undefined> {\n    const [listing] = await db\n      .select()\n      .from(loanListings)\n      .where(eq(loanListings.id, id));\n    return listing;\n  }\n\n  async updateListing(id: string, data: Partial<LoanListing>): Promise<void> {\n    await db\n      .update(loanListings)\n      .set({\n        ...data,\n        updatedAt: new Date(),\n      })\n      .where(eq(loanListings.id, id));\n  }\n\n  async deleteListing(id: string): Promise<void> {\n    await db\n      .update(loanListings)\n      .set({ status: 'cancelled' })\n      .where(eq(loanListings.id, id));\n  }\n\n  async createOffer(data: Partial<LoanOffer>): Promise<LoanOffer> {\n    const expiresAt = new Date();\n    expiresAt.setDate(expiresAt.getDate() + 7);\n\n    const [offer] = await db.insert(loanOffers).values({\n      ...data,\n      expiresAt,\n    } as any).returning();\n\n    await db\n      .update(loanListings)\n      .set({\n        totalOffered: sql`${loanListings.totalOffered} + ${data.amount}`,\n        offerCount: sql`${loanListings.offerCount} + 1`,\n        updatedAt: new Date(),\n      })\n      .where(eq(loanListings.id, data.listingId!));\n\n    return offer;\n  }\n\n  async getListingOffers(listingId: string): Promise<LoanOffer[]> {\n    return db\n      .select()\n      .from(loanOffers)\n      .where(eq(loanOffers.listingId, listingId))\n      .orderBy(desc(loanOffers.createdAt));\n  }\n\n  async getLenderOffers(lenderId: string): Promise<LoanOffer[]> {\n    return db\n      .select()\n      .from(loanOffers)\n      .where(eq(loanOffers.lenderId, lenderId))\n      .orderBy(desc(loanOffers.createdAt));\n  }\n\n  async getOffer(id: string): Promise<LoanOffer | undefined> {\n    const [offer] = await db\n      .select()\n      .from(loanOffers)\n      .where(eq(loanOffers.id, id));\n    return offer;\n  }\n\n  async updateOffer(id: string, status: string): Promise<void> {\n    await db\n      .update(loanOffers)\n      .set({\n        status: status as any,\n        updatedAt: new Date(),\n      })\n      .where(eq(loanOffers.id, id));\n  }\n\n  async acceptOffer(offerId: string): Promise<ActiveLoan> {\n    const offer = await this.getOffer(offerId);\n    if (!offer) {\n      throw new Error('Offer not found');\n    }\n\n    const listing = await this.getListing(offer.listingId);\n    if (!listing) {\n      throw new Error('Listing not found');\n    }\n\n    await this.updateOffer(offerId, 'accepted');\n\n    const otherOffers = await this.getListingOffers(offer.listingId);\n    for (const otherOffer of otherOffers) {\n      if (otherOffer.id !== offerId && otherOffer.status === 'pending') {\n        await this.updateOffer(otherOffer.id, 'rejected');\n      }\n    }\n\n    const interestRate = parseFloat(offer.proposedInterestRate?.toString() || listing.interestRate.toString());\n    const termMonths = offer.proposedTermMonths || listing.termMonths;\n    const amount = parseFloat(offer.amount.toString());\n\n    const monthlyPayment = this.calculateMonthlyPayment(amount, interestRate, termMonths);\n    const totalRepayment = monthlyPayment * termMonths;\n\n    const nextPaymentDue = new Date();\n    nextPaymentDue.setMonth(nextPaymentDue.getMonth() + 1);\n\n    const [loan] = await db.insert(activeLoans).values({\n      listingId: listing.id,\n      offerId: offer.id,\n      creatorId: listing.creatorId,\n      lenderId: offer.lenderId,\n      principalAmount: offer.amount,\n      interestRate: interestRate.toString(),\n      termMonths,\n      monthlyPayment: monthlyPayment.toString(),\n      totalRepayment: totalRepayment.toString(),\n      remainingBalance: totalRepayment.toString(),\n      nextPaymentDue,\n      paymentsRemaining: termMonths,\n      collateralType: listing.collateralType,\n      collateralDetails: listing.collateralDescription ? {\n        description: listing.collateralDescription,\n        value: listing.collateralValue?.toString(),\n      } : {},\n    } as any).returning();\n\n    if (listing.collateralType !== 'none') {\n      await db.insert(loanCollateral).values({\n        loanId: loan.id,\n        collateralType: listing.collateralType,\n        valuationAmount: listing.collateralValue || '0',\n        earningsPercentage: listing.collateralType === 'revenue_share' ? '15' : null,\n        earningsMonths: listing.collateralType === 'future_earnings' ? termMonths : null,\n        contentRightsDetails: listing.collateralType === 'content_rights' ? {\n          description: listing.collateralDescription,\n        } : null,\n        equipmentDetails: listing.collateralType === 'equipment' ? {\n          description: listing.collateralDescription,\n        } : null,\n      } as any);\n    }\n\n    await this.updateListing(listing.id, { status: 'funded' });\n\n    return loan;\n  }\n\n  async getCreatorLoans(creatorId: string): Promise<ActiveLoan[]> {\n    return db\n      .select()\n      .from(activeLoans)\n      .where(eq(activeLoans.creatorId, creatorId))\n      .orderBy(desc(activeLoans.createdAt));\n  }\n\n  async getLenderLoans(lenderId: string): Promise<ActiveLoan[]> {\n    return db\n      .select()\n      .from(activeLoans)\n      .where(eq(activeLoans.lenderId, lenderId))\n      .orderBy(desc(activeLoans.createdAt));\n  }\n\n  async getLoan(id: string): Promise<ActiveLoan | undefined> {\n    const [loan] = await db\n      .select()\n      .from(activeLoans)\n      .where(eq(activeLoans.id, id));\n    return loan;\n  }\n\n  async makePayment(loanId: string, amount: number): Promise<LoanPayment> {\n    const loan = await this.getLoan(loanId);\n    if (!loan) {\n      throw new Error('Loan not found');\n    }\n\n    const loanAmount = parseFloat(amount.toString());\n    const remainingBalance = parseFloat(loan.remainingBalance.toString());\n    const monthlyPayment = parseFloat(loan.monthlyPayment.toString());\n    const interestRate = parseFloat(loan.interestRate.toString()) / 100 / 12;\n\n    const now = new Date();\n    const dueDate = loan.nextPaymentDue || now;\n    const daysLate = now > dueDate ? Math.floor((now.getTime() - dueDate.getTime()) / (1000 * 60 * 60 * 24)) : 0;\n    const lateFee = daysLate > (loan.gracePeriodDays || 7) ? daysLate * 5 : 0;\n\n    const balanceWithLateFee = remainingBalance + lateFee;\n\n    const interestAmount = remainingBalance * interestRate;\n    const principalAmount = Math.max(0, loanAmount - interestAmount - lateFee);\n\n    const newBalance = balanceWithLateFee - loanAmount;\n    const totalPaid = parseFloat((loan.amountPaid || '0').toString()) + loanAmount;\n\n    let paymentType: 'scheduled' | 'early' | 'late' | 'partial' | 'final' = 'scheduled';\n    if (loanAmount < monthlyPayment) {\n      paymentType = 'partial';\n    } else if (loanAmount > monthlyPayment) {\n      paymentType = 'early';\n    } else if (newBalance <= 0) {\n      paymentType = 'final';\n    }\n    \n    if (daysLate > (loan.gracePeriodDays || 7)) {\n      paymentType = 'late';\n    }\n\n    const [payment] = await db.insert(loanPayments).values({\n      loanId,\n      amount: loanAmount.toString(),\n      principalAmount: principalAmount.toString(),\n      interestAmount: interestAmount.toString(),\n      paymentType,\n      status: 'completed',\n      dueDate,\n      paidAt: now,\n      lateFee: lateFee.toString(),\n      daysLate,\n    } as any).returning();\n\n    const nextPaymentDue = new Date(dueDate);\n    nextPaymentDue.setMonth(nextPaymentDue.getMonth() + 1);\n\n    const currentTotalRepayment = parseFloat(loan.totalRepayment.toString());\n    const newTotalRepayment = lateFee > 0 ? (currentTotalRepayment + lateFee).toString() : loan.totalRepayment.toString();\n\n    await db\n      .update(activeLoans)\n      .set({\n        amountPaid: totalPaid.toString(),\n        remainingBalance: Math.max(0, newBalance).toString(),\n        totalRepayment: newTotalRepayment,\n        nextPaymentDue: newBalance > 0 ? nextPaymentDue : null,\n        paymentsRemaining: Math.max(0, (loan.paymentsRemaining || 0) - 1),\n        status: newBalance <= 0 ? 'paid_off' : 'active',\n        latePaymentCount: daysLate > (loan.gracePeriodDays || 7) ? (loan.latePaymentCount || 0) + 1 : loan.latePaymentCount,\n        updatedAt: now,\n      })\n      .where(eq(activeLoans.id, loanId));\n\n    if (newBalance <= 0) {\n      await db\n        .update(loanCollateral)\n        .set({\n          status: 'released',\n          releaseDate: now,\n        })\n        .where(eq(loanCollateral.loanId, loanId));\n    }\n\n    return payment;\n  }\n\n  async getLoanPayments(loanId: string): Promise<LoanPayment[]> {\n    return db\n      .select()\n      .from(loanPayments)\n      .where(eq(loanPayments.loanId, loanId))\n      .orderBy(desc(loanPayments.createdAt));\n  }\n\n  async markLoanAsDefaulted(loanId: string, reason: string): Promise<void> {\n    const now = new Date();\n    \n    await db\n      .update(activeLoans)\n      .set({\n        status: 'defaulted',\n        defaultedAt: now,\n        defaultReason: reason,\n        updatedAt: now,\n      })\n      .where(eq(activeLoans.id, loanId));\n\n    await db\n      .update(loanCollateral)\n      .set({\n        status: 'seized',\n        seizureDate: now,\n      })\n      .where(eq(loanCollateral.loanId, loanId));\n  }\n\n  async getLoanCollateral(loanId: string): Promise<LoanCollateral[]> {\n    return db\n      .select()\n      .from(loanCollateral)\n      .where(eq(loanCollateral.loanId, loanId));\n  }\n\n  async calculateCreditScore(creatorId: string): Promise<number> {\n    const completedLoans = await db\n      .select()\n      .from(activeLoans)\n      .where(and(\n        eq(activeLoans.creatorId, creatorId),\n        eq(activeLoans.status, 'paid_off')\n      ));\n\n    const activeLoansCount = await db\n      .select()\n      .from(activeLoans)\n      .where(and(\n        eq(activeLoans.creatorId, creatorId),\n        eq(activeLoans.status, 'active')\n      ));\n\n    const defaultedLoans = await db\n      .select()\n      .from(activeLoans)\n      .where(and(\n        eq(activeLoans.creatorId, creatorId),\n        eq(activeLoans.status, 'defaulted')\n      ));\n\n    let score = 500;\n\n    score += completedLoans.length * 50;\n    score -= defaultedLoans.length * 150;\n    score -= activeLoansCount.length * 20;\n\n    for (const loan of activeLoansCount) {\n      if ((loan.latePaymentCount || 0) > 0) {\n        score -= (loan.latePaymentCount || 0) * 10;\n      }\n    }\n\n    return Math.min(Math.max(score, 300), 850);\n  }\n\n  private calculateRiskLevel(creditScore: number): 'low' | 'medium' | 'high' | 'very_high' {\n    if (creditScore >= 700) return 'low';\n    if (creditScore >= 600) return 'medium';\n    if (creditScore >= 500) return 'high';\n    return 'very_high';\n  }\n\n  private calculateMonthlyPayment(principal: number, annualRate: number, months: number): number {\n    const monthlyRate = annualRate / 100 / 12;\n    if (monthlyRate === 0) return principal / months;\n    \n    const payment = principal * (monthlyRate * Math.pow(1 + monthlyRate, months)) / \n                   (Math.pow(1 + monthlyRate, months) - 1);\n    \n    return Math.round(payment * 100) / 100;\n  }\n\n  async getLoanAnalytics(userId: string, userType: 'creator' | 'lender') {\n    const loans = userType === 'creator' \n      ? await this.getCreatorLoans(userId)\n      : await this.getLenderLoans(userId);\n\n    const totalLoans = loans.length;\n    const activeLoans = loans.filter(l => l.status === 'active').length;\n    const paidOffLoans = loans.filter(l => l.status === 'paid_off').length;\n    const defaultedLoans = loans.filter(l => l.status === 'defaulted').length;\n\n    const totalBorrowed = loans.reduce((sum, l) => \n      sum + parseFloat(l.principalAmount.toString()), 0\n    );\n\n    const totalRepaid = loans.reduce((sum, l) => \n      sum + parseFloat((l.amountPaid || '0').toString()), 0\n    );\n\n    const totalOutstanding = loans\n      .filter(l => l.status === 'active')\n      .reduce((sum, l) => sum + parseFloat(l.remainingBalance.toString()), 0);\n\n    return {\n      totalLoans,\n      activeLoans,\n      paidOffLoans,\n      defaultedLoans,\n      totalBorrowed,\n      totalRepaid,\n      totalOutstanding,\n      creditScore: userType === 'creator' ? await this.calculateCreditScore(userId) : null,\n    };\n  }\n}\n\nexport const microlendingService = new MicrolendingService();\n","size_bytes":13408},"server/creatorAnalytics.ts":{"content":"import { eq, desc, and, gte, lte, sql, count } from \"drizzle-orm\";\nimport { db } from \"./db\";\nimport {\n  creatorDailyMetrics,\n  creatorAudienceInsights,\n  creatorRevenueForecasts,\n  contentPerformanceMetrics,\n  subscriptions,\n  tips,\n  content,\n  users,\n  profiles,\n  userInteractions,\n  type CreatorDailyMetrics,\n  type CreatorAudienceInsights,\n  type ContentPerformanceMetrics,\n} from \"@shared/schema\";\n\nexport class CreatorAnalyticsService {\n  // Calculate and store daily metrics for a creator\n  async computeDailyMetrics(creatorId: string, date: Date = new Date()) {\n    const startOfDay = new Date(date);\n    startOfDay.setHours(0, 0, 0, 0);\n    \n    const endOfDay = new Date(date);\n    endOfDay.setHours(23, 59, 59, 999);\n\n    // Get subscription revenue for the day\n    const subsToday = await db\n      .select({\n        count: count(),\n        revenue: sql<string>`SUM(CAST(${subscriptions.price} AS DECIMAL))`,\n      })\n      .from(subscriptions)\n      .where(\n        and(\n          eq(subscriptions.creatorId, creatorId),\n          gte(subscriptions.createdAt, startOfDay),\n          lte(subscriptions.createdAt, endOfDay)\n        )\n      );\n\n    // Get tip revenue for the day\n    const tipsToday = await db\n      .select({\n        count: count(),\n        revenue: sql<string>`SUM(CAST(${tips.amount} AS DECIMAL))`,\n      })\n      .from(tips)\n      .where(\n        and(\n          eq(tips.toUserId, creatorId),\n          gte(tips.createdAt, startOfDay),\n          lte(tips.createdAt, endOfDay)\n        )\n      );\n\n    // Get total active subscribers\n    const totalSubs = await db\n      .select({ count: count() })\n      .from(subscriptions)\n      .where(\n        and(\n          eq(subscriptions.creatorId, creatorId),\n          eq(subscriptions.status, 'active')\n        )\n      );\n\n    // Get new subscribers today\n    const newSubs = await db\n      .select({ count: count() })\n      .from(subscriptions)\n      .where(\n        and(\n          eq(subscriptions.creatorId, creatorId),\n          gte(subscriptions.createdAt, startOfDay),\n          lte(subscriptions.createdAt, endOfDay)\n        )\n      );\n\n    // Get cancelled subscriptions today (note: using createdAt as updatedAt doesn't exist)\n    const lostSubs = await db\n      .select({ count: count() })\n      .from(subscriptions)\n      .where(\n        and(\n          eq(subscriptions.creatorId, creatorId),\n          eq(subscriptions.status, 'cancelled')\n        )\n      );\n\n    // Get content interactions today\n    const creatorContent = await db\n      .select({ id: content.id })\n      .from(content)\n      .where(eq(content.creatorUserId, creatorId));\n\n    const contentIds = creatorContent.map(c => c.id);\n\n    let contentViews = 0;\n    let contentLikes = 0;\n    let contentShares = 0;\n\n    if (contentIds.length > 0) {\n      const interactions = await db\n        .select({\n          type: userInteractions.interactionType,\n          count: count(),\n        })\n        .from(userInteractions)\n        .where(\n          and(\n            sql`${userInteractions.contentId} IN ${contentIds}`,\n            gte(userInteractions.createdAt, startOfDay),\n            lte(userInteractions.createdAt, endOfDay)\n          )\n        )\n        .groupBy(userInteractions.interactionType);\n\n      for (const int of interactions) {\n        if (int.type === 'view') contentViews = int.count;\n        if (int.type === 'like') contentLikes = int.count;\n        if (int.type === 'share') contentShares = int.count;\n      }\n    }\n\n    const subscriptionRevenue = parseFloat(subsToday[0]?.revenue || '0');\n    const tipRevenue = parseFloat(tipsToday[0]?.revenue || '0');\n    const totalRevenue = subscriptionRevenue + tipRevenue;\n\n    const totalSubscribers = totalSubs[0]?.count || 0;\n    const engagementRate = totalSubscribers > 0 \n      ? ((contentViews + contentLikes + contentShares) / totalSubscribers) * 100 \n      : 0;\n\n    // Upsert daily metrics\n    await db\n      .insert(creatorDailyMetrics)\n      .values({\n        creatorId,\n        date: startOfDay,\n        subscriptionRevenue: subscriptionRevenue.toString(),\n        tipRevenue: tipRevenue.toString(),\n        ppvRevenue: '0', // TODO: Add PPV tracking\n        totalRevenue: totalRevenue.toString(),\n        newSubscribers: newSubs[0]?.count || 0,\n        lostSubscribers: lostSubs[0]?.count || 0,\n        totalSubscribers,\n        contentViews,\n        contentLikes,\n        contentShares,\n        messagesReceived: 0, // TODO: Add message tracking\n        engagementRate: engagementRate.toFixed(2),\n      })\n      .onConflictDoNothing();\n\n    return {\n      subscriptionRevenue,\n      tipRevenue,\n      totalRevenue,\n      newSubscribers: newSubs[0]?.count || 0,\n      totalSubscribers,\n      contentViews,\n      contentLikes,\n      contentShares,\n      engagementRate: parseFloat(engagementRate.toFixed(2)),\n    };\n  }\n\n  // Get daily metrics for a date range\n  async getDailyMetrics(creatorId: string, startDate: Date, endDate: Date): Promise<CreatorDailyMetrics[]> {\n    return await db\n      .select()\n      .from(creatorDailyMetrics)\n      .where(\n        and(\n          eq(creatorDailyMetrics.creatorId, creatorId),\n          gte(creatorDailyMetrics.date, startDate),\n          lte(creatorDailyMetrics.date, endDate)\n        )\n      )\n      .orderBy(desc(creatorDailyMetrics.date));\n  }\n\n  // Compute audience insights\n  async computeAudienceInsights(creatorId: string) {\n    // Get all active subscribers with their profiles\n    const subscribers = await db\n      .select({\n        fanId: subscriptions.fanId,\n        price: subscriptions.price,\n        createdAt: subscriptions.createdAt,\n        profile: profiles,\n      })\n      .from(subscriptions)\n      .leftJoin(profiles, eq(subscriptions.fanId, profiles.userId))\n      .where(\n        and(\n          eq(subscriptions.creatorId, creatorId),\n          eq(subscriptions.status, 'active')\n        )\n      );\n\n    // Get all tips to identify top fans\n    const fanTips = await db\n      .select({\n        fanId: tips.fromUserId,\n        totalAmount: sql<string>`SUM(CAST(${tips.amount} AS DECIMAL))`,\n      })\n      .from(tips)\n      .where(eq(tips.toUserId, creatorId))\n      .groupBy(tips.fromUserId);\n\n    // Calculate top fans by spending (subscriptions + tips)\n    const fanSpending: Record<string, number> = {};\n\n    for (const sub of subscribers) {\n      const subPrice = parseFloat(sub.price || '0');\n      fanSpending[sub.fanId] = (fanSpending[sub.fanId] || 0) + subPrice;\n    }\n\n    for (const tip of fanTips) {\n      fanSpending[tip.fanId] = (fanSpending[tip.fanId] || 0) + parseFloat(tip.totalAmount);\n    }\n\n    const topFans = Object.entries(fanSpending)\n      .sort((a, b) => b[1] - a[1])\n      .slice(0, 10)\n      .map(([id, amount]) => ({ id, amount }));\n\n    // Calculate pack type distribution\n    const packTypeDist: Record<string, number> = {};\n    for (const sub of subscribers) {\n      const packType = sub.profile?.packType || 'unknown';\n      packTypeDist[packType] = (packTypeDist[packType] || 0) + 1;\n    }\n\n    // Calculate average subscription length\n    const now = Date.now();\n    const subscriptionLengths = subscribers.map(sub => {\n      const daysSince = (now - new Date(sub.createdAt).getTime()) / (1000 * 60 * 60 * 24);\n      return daysSince;\n    });\n    const avgSubLength = subscriptionLengths.length > 0\n      ? subscriptionLengths.reduce((a, b) => a + b, 0) / subscriptionLengths.length\n      : 0;\n\n    // Calculate average tip amount\n    const allTips = await db\n      .select({ amount: tips.amount })\n      .from(tips)\n      .where(eq(tips.toUserId, creatorId));\n\n    const avgTipAmount = allTips.length > 0\n      ? allTips.reduce((sum, t) => sum + parseFloat(t.amount || '0'), 0) / allTips.length\n      : 0;\n\n    // Calculate retention rate (30-day window)\n    const thirtyDaysAgo = new Date();\n    thirtyDaysAgo.setDate(thirtyDaysAgo.getDate() - 30);\n\n    const subsThirtyDaysAgo = await db\n      .select({ count: count() })\n      .from(subscriptions)\n      .where(\n        and(\n          eq(subscriptions.creatorId, creatorId),\n          lte(subscriptions.createdAt, thirtyDaysAgo)\n        )\n      );\n\n    const stillActive = await db\n      .select({ count: count() })\n      .from(subscriptions)\n      .where(\n        and(\n          eq(subscriptions.creatorId, creatorId),\n          lte(subscriptions.createdAt, thirtyDaysAgo),\n          eq(subscriptions.status, 'active')\n        )\n      );\n\n    const retentionRate = (subsThirtyDaysAgo[0]?.count || 0) > 0\n      ? ((stillActive[0]?.count || 0) / (subsThirtyDaysAgo[0]?.count || 1)) * 100\n      : 0;\n\n    const churnRate = 100 - retentionRate;\n\n    // Upsert audience insights\n    await db\n      .insert(creatorAudienceInsights)\n      .values({\n        creatorId,\n        topFanIds: topFans,\n        packTypeDistribution: packTypeDist,\n        geographicDistribution: {}, // TODO: Add geo tracking\n        averageSubscriptionLength: avgSubLength.toFixed(2),\n        averageTipAmount: avgTipAmount.toFixed(2),\n        retentionRate: retentionRate.toFixed(2),\n        churnRate: churnRate.toFixed(2),\n        lastUpdated: new Date(),\n      })\n      .onConflictDoUpdate({\n        target: creatorAudienceInsights.creatorId,\n        set: {\n          topFanIds: topFans,\n          packTypeDistribution: packTypeDist,\n          averageSubscriptionLength: avgSubLength.toFixed(2),\n          averageTipAmount: avgTipAmount.toFixed(2),\n          retentionRate: retentionRate.toFixed(2),\n          churnRate: churnRate.toFixed(2),\n          lastUpdated: new Date(),\n        },\n      });\n\n    return {\n      topFans,\n      packTypeDistribution: packTypeDist,\n      averageSubscriptionLength: avgSubLength,\n      averageTipAmount: avgTipAmount,\n      retentionRate,\n      churnRate,\n    };\n  }\n\n  // Get audience insights\n  async getAudienceInsights(creatorId: string): Promise<CreatorAudienceInsights | undefined> {\n    const [insights] = await db\n      .select()\n      .from(creatorAudienceInsights)\n      .where(eq(creatorAudienceInsights.creatorId, creatorId))\n      .limit(1);\n\n    return insights;\n  }\n\n  // Generate revenue forecast using simple linear regression\n  async generateRevenueForecast(creatorId: string, monthsAhead: number = 3) {\n    // Get historical revenue data (last 6 months)\n    const sixMonthsAgo = new Date();\n    sixMonthsAgo.setMonth(sixMonthsAgo.getMonth() - 6);\n\n    const historicalData = await db\n      .select()\n      .from(creatorDailyMetrics)\n      .where(\n        and(\n          eq(creatorDailyMetrics.creatorId, creatorId),\n          gte(creatorDailyMetrics.date, sixMonthsAgo)\n        )\n      )\n      .orderBy(creatorDailyMetrics.date);\n\n    if (historicalData.length < 30) {\n      // Not enough data for forecasting\n      return [];\n    }\n\n    // Group by month and sum revenue\n    const monthlyRevenue: Record<string, number> = {};\n    for (const day of historicalData) {\n      const monthKey = `${day.date.getFullYear()}-${day.date.getMonth() + 1}`;\n      monthlyRevenue[monthKey] = (monthlyRevenue[monthKey] || 0) + parseFloat(day.totalRevenue || '0');\n    }\n\n    const revenueValues = Object.values(monthlyRevenue);\n    \n    // Simple linear regression\n    const n = revenueValues.length;\n    const sumX = (n * (n + 1)) / 2; // Sum of 1, 2, 3, ...\n    const sumY = revenueValues.reduce((a, b) => a + b, 0);\n    const sumXY = revenueValues.reduce((sum, y, i) => sum + (i + 1) * y, 0);\n    const sumX2 = (n * (n + 1) * (2 * n + 1)) / 6;\n\n    const slope = (n * sumXY - sumX * sumY) / (n * sumX2 - sumX * sumX);\n    const intercept = (sumY - slope * sumX) / n;\n\n    // Calculate R-squared for confidence\n    const mean = sumY / n;\n    const ss_tot = revenueValues.reduce((sum, y) => sum + Math.pow(y - mean, 2), 0);\n    const ss_res = revenueValues.reduce((sum, y, i) => {\n      const predicted = slope * (i + 1) + intercept;\n      return sum + Math.pow(y - predicted, 2);\n    }, 0);\n    const rSquared = 1 - (ss_res / ss_tot);\n    const confidenceLevel = Math.max(0, Math.min(100, rSquared * 100));\n\n    // Generate forecasts\n    const forecasts = [];\n    const now = new Date();\n    \n    for (let i = 1; i <= monthsAhead; i++) {\n      const forecastMonth = new Date(now);\n      forecastMonth.setMonth(forecastMonth.getMonth() + i);\n      forecastMonth.setDate(1);\n      forecastMonth.setHours(0, 0, 0, 0);\n\n      const predicted = slope * (n + i) + intercept;\n      const growthRate = n > 0 ? ((predicted - revenueValues[n - 1]) / revenueValues[n - 1]) * 100 : 0;\n\n      await db\n        .insert(creatorRevenueForecasts)\n        .values({\n          creatorId,\n          forecastMonth,\n          predictedRevenue: Math.max(0, predicted).toFixed(2),\n          confidenceLevel: confidenceLevel.toFixed(2),\n          growthRate: growthRate.toFixed(2),\n          modelVersion: 'linear-v1',\n        })\n        .onConflictDoNothing();\n\n      forecasts.push({\n        month: forecastMonth,\n        predictedRevenue: Math.max(0, predicted),\n        confidenceLevel,\n        growthRate,\n      });\n    }\n\n    return forecasts;\n  }\n\n  // Update content performance metrics\n  async updateContentPerformance(contentId: string) {\n    const interactions = await db\n      .select({\n        type: userInteractions.interactionType,\n        count: count(),\n        avgDuration: sql<string>`AVG(${userInteractions.durationSeconds})`,\n      })\n      .from(userInteractions)\n      .where(eq(userInteractions.contentId, contentId))\n      .groupBy(userInteractions.interactionType);\n\n    let totalViews = 0;\n    let likeCount = 0;\n    let shareCount = 0;\n    let saveCount = 0;\n    let avgViewDuration = 0;\n\n    for (const int of interactions) {\n      if (int.type === 'view') {\n        totalViews = int.count;\n        avgViewDuration = parseFloat(int.avgDuration || '0');\n      }\n      if (int.type === 'like') likeCount = int.count;\n      if (int.type === 'share') shareCount = int.count;\n      if (int.type === 'save') saveCount = int.count;\n    }\n\n    // Get unique viewers\n    const uniqueViewers = await db\n      .select({ count: sql<number>`COUNT(DISTINCT ${userInteractions.userId})` })\n      .from(userInteractions)\n      .where(\n        and(\n          eq(userInteractions.contentId, contentId),\n          eq(userInteractions.interactionType, 'view')\n        )\n      );\n\n    // Get tips for this content\n    const contentTips = await db\n      .select({\n        count: count(),\n        revenue: sql<string>`SUM(CAST(${tips.amount} AS DECIMAL))`,\n      })\n      .from(tips)\n      .where(eq(tips.mediaId, contentId));\n\n    const tipCount = contentTips[0]?.count || 0;\n    const tipRevenue = parseFloat(contentTips[0]?.revenue || '0');\n\n    // Upsert performance metrics\n    await db\n      .insert(contentPerformanceMetrics)\n      .values({\n        contentId,\n        totalViews,\n        uniqueViewers: uniqueViewers[0]?.count || 0,\n        averageViewDuration: avgViewDuration.toString(),\n        completionRate: '0', // TODO: Calculate based on video length\n        likeCount,\n        shareCount,\n        saveCount,\n        commentCount: 0, // TODO: Add comments tracking\n        tipCount,\n        totalTipRevenue: tipRevenue.toString(),\n        conversionRate: '0', // TODO: Calculate free to paid conversion\n        lastUpdated: new Date(),\n      })\n      .onConflictDoUpdate({\n        target: contentPerformanceMetrics.contentId,\n        set: {\n          totalViews,\n          uniqueViewers: uniqueViewers[0]?.count || 0,\n          averageViewDuration: avgViewDuration.toString(),\n          likeCount,\n          shareCount,\n          saveCount,\n          tipCount,\n          totalTipRevenue: tipRevenue.toString(),\n          lastUpdated: new Date(),\n        },\n      });\n  }\n\n  // Get content performance for all creator's content\n  async getContentPerformance(creatorId: string): Promise<ContentPerformanceMetrics[]> {\n    const creatorContent = await db\n      .select({ id: content.id })\n      .from(content)\n      .where(eq(content.creatorUserId, creatorId));\n\n    const contentIds = creatorContent.map(c => c.id);\n\n    if (contentIds.length === 0) {\n      return [];\n    }\n\n    return await db\n      .select()\n      .from(contentPerformanceMetrics)\n      .where(sql`${contentPerformanceMetrics.contentId} IN ${contentIds}`)\n      .orderBy(desc(contentPerformanceMetrics.totalViews));\n  }\n\n  // Get analytics summary for a creator\n  async getAnalyticsSummary(creatorId: string) {\n    // Get last 30 days metrics\n    const thirtyDaysAgo = new Date();\n    thirtyDaysAgo.setDate(thirtyDaysAgo.getDate() - 30);\n\n    const recentMetrics = await this.getDailyMetrics(creatorId, thirtyDaysAgo, new Date());\n    \n    const totalRevenue = recentMetrics.reduce((sum, m) => sum + parseFloat(m.totalRevenue || '0'), 0);\n    const totalViews = recentMetrics.reduce((sum, m) => sum + (m.contentViews || 0), 0);\n    const totalNewSubs = recentMetrics.reduce((sum, m) => sum + (m.newSubscribers || 0), 0);\n\n    const audienceInsights = await this.getAudienceInsights(creatorId);\n    const contentPerformance = await this.getContentPerformance(creatorId);\n\n    // Get recent forecast\n    const [forecast] = await db\n      .select()\n      .from(creatorRevenueForecasts)\n      .where(eq(creatorRevenueForecasts.creatorId, creatorId))\n      .orderBy(desc(creatorRevenueForecasts.computedAt))\n      .limit(1);\n\n    return {\n      last30Days: {\n        totalRevenue,\n        totalViews,\n        totalNewSubscribers: totalNewSubs,\n        dailyMetrics: recentMetrics,\n      },\n      audience: audienceInsights,\n      topContent: contentPerformance.slice(0, 10),\n      nextMonthForecast: forecast ? {\n        predictedRevenue: parseFloat(forecast.predictedRevenue),\n        confidenceLevel: parseFloat(forecast.confidenceLevel || '0'),\n        growthRate: parseFloat(forecast.growthRate || '0'),\n      } : null,\n    };\n  }\n}\n\nexport const creatorAnalytics = new CreatorAnalyticsService();\n","size_bytes":17862},"server/recommendationEngine.ts":{"content":"import { eq, desc, and, sql, inArray, not } from \"drizzle-orm\";\nimport { db } from \"./db\";\nimport {\n  userInteractions,\n  contentEngagementScores,\n  userPreferenceProfiles,\n  creatorSimilarity,\n  content,\n  users,\n  profiles,\n  subscriptions,\n  type UserInteraction,\n  type ContentEngagementScore,\n  type UserPreferenceProfile,\n} from \"@shared/schema\";\n\n// =============================================================================\n// AI-POWERED RECOMMENDATION ENGINE\n// =============================================================================\n\nexport class RecommendationEngine {\n  // Track user interaction for learning\n  async trackInteraction(params: {\n    userId: string;\n    contentId: string;\n    interactionType: 'view' | 'like' | 'share' | 'save' | 'skip' | 'report';\n    durationSeconds?: number;\n    metadata?: Record<string, any>;\n  }) {\n    await db.insert(userInteractions).values(params);\n    \n    // Update engagement scores asynchronously\n    this.updateEngagementScores(params.contentId).catch(console.error);\n    \n    // Update user preferences asynchronously\n    this.updateUserPreferences(params.userId).catch(console.error);\n  }\n\n  // Update content engagement scores\n  private async updateEngagementScores(contentId: string) {\n    const interactions = await db\n      .select()\n      .from(userInteractions)\n      .where(eq(userInteractions.contentId, contentId));\n\n    const viewCount = interactions.filter(i => i.interactionType === 'view').length;\n    const likeCount = interactions.filter(i => i.interactionType === 'like').length;\n    const shareCount = interactions.filter(i => i.interactionType === 'share').length;\n    const saveCount = interactions.filter(i => i.interactionType === 'save').length;\n\n    // Calculate average view duration\n    const viewDurations = interactions\n      .filter(i => i.interactionType === 'view' && i.durationSeconds)\n      .map(i => i.durationSeconds || 0);\n    const avgViewDuration = viewDurations.length > 0 \n      ? viewDurations.reduce((a, b) => a + b, 0) / viewDurations.length \n      : 0;\n\n    // Calculate engagement score (weighted formula)\n    const engagementScore = (\n      viewCount * 1 +\n      likeCount * 3 +\n      shareCount * 5 +\n      saveCount * 4\n    ) / Math.max(viewCount, 1);\n\n    // Calculate trending score (time-weighted)\n    const recentInteractions = interactions.filter(i => {\n      const hoursSince = (Date.now() - new Date(i.createdAt).getTime()) / (1000 * 60 * 60);\n      return hoursSince < 24; // Last 24 hours\n    });\n    const trendingScore = recentInteractions.length * engagementScore * 1.5;\n\n    // Upsert engagement scores\n    await db\n      .insert(contentEngagementScores)\n      .values({\n        contentId,\n        viewCount,\n        likeCount,\n        shareCount,\n        saveCount,\n        avgViewDuration: avgViewDuration.toString(),\n        engagementScore: engagementScore.toString(),\n        trendingScore: trendingScore.toString(),\n        lastUpdated: new Date(),\n      })\n      .onConflictDoUpdate({\n        target: contentEngagementScores.contentId,\n        set: {\n          viewCount,\n          likeCount,\n          shareCount,\n          saveCount,\n          avgViewDuration: avgViewDuration.toString(),\n          engagementScore: engagementScore.toString(),\n          trendingScore: trendingScore.toString(),\n          lastUpdated: new Date(),\n        },\n      });\n  }\n\n  // Update user preference profile based on interactions\n  private async updateUserPreferences(userId: string) {\n    const interactions = await db\n      .select({\n        interaction: userInteractions,\n        content: content,\n        creator: users,\n        profile: profiles,\n      })\n      .from(userInteractions)\n      .leftJoin(content, eq(userInteractions.contentId, content.id))\n      .leftJoin(users, eq(content.creatorUserId, users.id))\n      .leftJoin(profiles, eq(users.id, profiles.userId))\n      .where(eq(userInteractions.userId, userId))\n      .limit(200); // Last 200 interactions\n\n    // Calculate creator preferences\n    const creatorScores: Record<string, number> = {};\n    const tagScores: Record<string, number> = {};\n    const packTypeScores: Record<string, number> = {};\n\n    for (const item of interactions) {\n      if (!item.content) continue;\n\n      const weight = this.getInteractionWeight(item.interaction.interactionType);\n      const creatorId = item.content.creatorUserId;\n\n      // Update creator scores\n      creatorScores[creatorId] = (creatorScores[creatorId] || 0) + weight;\n\n      // Update tag scores\n      const tags = (item.content.tags as string[]) || [];\n      for (const tag of tags) {\n        tagScores[tag] = (tagScores[tag] || 0) + weight;\n      }\n\n      // Update pack type scores\n      if (item.profile?.packType) {\n        const packType = item.profile.packType;\n        packTypeScores[packType] = (packTypeScores[packType] || 0) + weight;\n      }\n    }\n\n    // Convert to sorted arrays\n    const preferredCreators = Object.entries(creatorScores)\n      .sort((a, b) => b[1] - a[1])\n      .slice(0, 20)\n      .map(([id, score]) => ({ id, score }));\n\n    const preferredTags = Object.entries(tagScores)\n      .sort((a, b) => b[1] - a[1])\n      .slice(0, 30)\n      .map(([tag, score]) => ({ tag, score }));\n\n    const preferredPackTypes = Object.entries(packTypeScores)\n      .sort((a, b) => b[1] - a[1])\n      .map(([type, score]) => ({ type, score }));\n\n    // Upsert user preference profile\n    await db\n      .insert(userPreferenceProfiles)\n      .values({\n        userId,\n        preferredCreators,\n        preferredTags,\n        preferredPackTypes,\n        interactionVector: {}, // Can be expanded for ML features\n        lastUpdated: new Date(),\n      })\n      .onConflictDoUpdate({\n        target: userPreferenceProfiles.userId,\n        set: {\n          preferredCreators,\n          preferredTags,\n          preferredPackTypes,\n          lastUpdated: new Date(),\n        },\n      });\n  }\n\n  // Get interaction weight for scoring\n  private getInteractionWeight(type: string): number {\n    const weights: Record<string, number> = {\n      view: 1,\n      like: 3,\n      share: 5,\n      save: 4,\n      skip: -1,\n      report: -10,\n    };\n    return weights[type] || 0;\n  }\n\n  // Generate personalized recommendations\n  async getRecommendations(params: {\n    userId: string;\n    limit?: number;\n    excludeContentIds?: string[];\n  }): Promise<Array<{ contentId: string; score: number; reason: string }>> {\n    const { userId, limit = 20, excludeContentIds = [] } = params;\n\n    // Get user preferences\n    const [userPrefs] = await db\n      .select()\n      .from(userPreferenceProfiles)\n      .where(eq(userPreferenceProfiles.userId, userId))\n      .limit(1);\n\n    // Get user subscriptions\n    const userSubs = await db\n      .select({ creatorId: subscriptions.creatorId })\n      .from(subscriptions)\n      .where(eq(subscriptions.fanId, userId));\n\n    const subscribedCreatorIds = userSubs.map(s => s.creatorId);\n\n    // Get already viewed content\n    const viewedContent = await db\n      .select({ contentId: userInteractions.contentId })\n      .from(userInteractions)\n      .where(\n        and(\n          eq(userInteractions.userId, userId),\n          eq(userInteractions.interactionType, 'view')\n        )\n      )\n      .limit(500);\n\n    const viewedContentIds = viewedContent.map(v => v.contentId);\n    const allExcludedIds = [...excludeContentIds, ...viewedContentIds];\n\n    // Build recommendation candidates with scoring\n    const recommendations: Array<{ contentId: string; score: number; reason: string }> = [];\n\n    // Strategy 1: Content from preferred creators (highest weight)\n    if (userPrefs?.preferredCreators) {\n      const preferredCreatorIds = (userPrefs.preferredCreators as any[])\n        .slice(0, 10)\n        .map(c => c.id)\n        .filter(id => id); // Filter out any null/undefined values\n\n      if (preferredCreatorIds.length > 0) {\n        const creatorContent = await db\n          .select({\n            id: content.id,\n            creatorUserId: content.creatorUserId,\n            engagementScore: contentEngagementScores.engagementScore,\n          })\n          .from(content)\n          .leftJoin(contentEngagementScores, eq(content.id, contentEngagementScores.contentId))\n          .where(\n            and(\n              inArray(content.creatorUserId, preferredCreatorIds),\n              allExcludedIds.length > 0 ? not(inArray(content.id, allExcludedIds)) : undefined\n            )\n          )\n          .limit(30);\n\n        for (const item of creatorContent) {\n          const baseScore = 10; // High base score for preferred creators\n          const engagementBoost = parseFloat(item.engagementScore || '0') * 0.5;\n          recommendations.push({\n            contentId: item.id,\n            score: baseScore + engagementBoost,\n            reason: 'From creator you love',\n          });\n        }\n      }\n    }\n\n    // Strategy 2: Trending content with high engagement\n    const trendingContent = await db\n      .select({\n        id: content.id,\n        trendingScore: contentEngagementScores.trendingScore,\n        engagementScore: contentEngagementScores.engagementScore,\n      })\n      .from(content)\n      .leftJoin(contentEngagementScores, eq(content.id, contentEngagementScores.contentId))\n      .where(\n        allExcludedIds.length > 0 ? not(inArray(content.id, allExcludedIds)) : undefined\n      )\n      .orderBy(desc(contentEngagementScores.trendingScore))\n      .limit(20);\n\n    for (const item of trendingContent) {\n      const trendingBoost = parseFloat(item.trendingScore || '0') * 0.3;\n      const engagementBoost = parseFloat(item.engagementScore || '0') * 0.2;\n      recommendations.push({\n        contentId: item.id,\n        score: 5 + trendingBoost + engagementBoost,\n        reason: 'Trending now',\n      });\n    }\n\n    // Strategy 3: Content matching preferred tags\n    if (userPrefs?.preferredTags) {\n      const preferredTags = (userPrefs.preferredTags as any[])\n        .slice(0, 5)\n        .map(t => t.tag);\n\n      if (preferredTags.length > 0) {\n        const taggedContent = await db\n          .select({\n            id: content.id,\n            tags: content.tags,\n            engagementScore: contentEngagementScores.engagementScore,\n          })\n          .from(content)\n          .leftJoin(contentEngagementScores, eq(content.id, contentEngagementScores.contentId))\n          .where(\n            allExcludedIds.length > 0 ? not(inArray(content.id, allExcludedIds)) : undefined\n          )\n          .limit(50);\n\n        for (const item of taggedContent) {\n          const itemTags = (item.tags as string[]) || [];\n          const matchingTags = itemTags.filter(tag => preferredTags.includes(tag));\n          \n          if (matchingTags.length > 0) {\n            const tagMatchScore = matchingTags.length * 2;\n            const engagementBoost = parseFloat(item.engagementScore || '0') * 0.3;\n            recommendations.push({\n              contentId: item.id,\n              score: 7 + tagMatchScore + engagementBoost,\n              reason: `Matches your interests: ${matchingTags.join(', ')}`,\n            });\n          }\n        }\n      }\n    }\n\n    // Strategy 4: Content from subscribed creators\n    if (subscribedCreatorIds.length > 0) {\n      const subscribedContent = await db\n        .select({\n          id: content.id,\n          engagementScore: contentEngagementScores.engagementScore,\n        })\n        .from(content)\n        .leftJoin(contentEngagementScores, eq(content.id, contentEngagementScores.contentId))\n        .where(\n          and(\n            inArray(content.creatorUserId, subscribedCreatorIds),\n            allExcludedIds.length > 0 ? not(inArray(content.id, allExcludedIds)) : undefined\n          )\n        )\n        .limit(15);\n\n      for (const item of subscribedContent) {\n        const baseScore = 8;\n        const engagementBoost = parseFloat(item.engagementScore || '0') * 0.4;\n        recommendations.push({\n          contentId: item.id,\n          score: baseScore + engagementBoost,\n          reason: 'From creator you subscribe to',\n        });\n      }\n    }\n\n    // Deduplicate and sort by score\n    const uniqueRecs = Array.from(\n      new Map(recommendations.map(r => [r.contentId, r])).values()\n    );\n    \n    uniqueRecs.sort((a, b) => b.score - a.score);\n    \n    return uniqueRecs.slice(0, limit);\n  }\n\n  // Calculate creator similarity for collaborative filtering\n  async computeCreatorSimilarity() {\n    const creators = await db\n      .select({ id: users.id })\n      .from(users)\n      .where(eq(users.role, 'creator'));\n\n    // For each pair of creators, calculate similarity based on shared audience\n    for (let i = 0; i < creators.length; i++) {\n      for (let j = i + 1; j < creators.length; j++) {\n        const creator1Id = creators[i].id;\n        const creator2Id = creators[j].id;\n\n        // Get subscribers for each creator\n        const subs1 = await db\n          .select({ fanId: subscriptions.fanId })\n          .from(subscriptions)\n          .where(eq(subscriptions.creatorId, creator1Id));\n\n        const subs2 = await db\n          .select({ fanId: subscriptions.fanId })\n          .from(subscriptions)\n          .where(eq(subscriptions.creatorId, creator2Id));\n\n        const fans1 = new Set(subs1.map(s => s.fanId));\n        const fans2 = new Set(subs2.map(s => s.fanId));\n\n        // Calculate Jaccard similarity\n        const intersection = new Set([...fans1].filter(x => fans2.has(x)));\n        const union = new Set([...fans1, ...fans2]);\n        const similarity = union.size > 0 ? intersection.size / union.size : 0;\n\n        if (similarity > 0.1) { // Only store meaningful similarities\n          await db\n            .insert(creatorSimilarity)\n            .values({\n              creatorId1: creator1Id,\n              creatorId2: creator2Id,\n              similarityScore: similarity.toString(),\n              computedAt: new Date(),\n            })\n            .onConflictDoNothing();\n        }\n      }\n    }\n  }\n}\n\nexport const recommendationEngine = new RecommendationEngine();\n","size_bytes":14063},"client/src/components/ui/form.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as LabelPrimitive from \"@radix-ui/react-label\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport {\n  Controller,\n  FormProvider,\n  useFormContext,\n  type ControllerProps,\n  type FieldPath,\n  type FieldValues,\n} from \"react-hook-form\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Label } from \"@/components/ui/label\"\n\nconst Form = FormProvider\n\ntype FormFieldContextValue<\n  TFieldValues extends FieldValues = FieldValues,\n  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>\n> = {\n  name: TName\n}\n\nconst FormFieldContext = React.createContext<FormFieldContextValue>(\n  {} as FormFieldContextValue\n)\n\nconst FormField = <\n  TFieldValues extends FieldValues = FieldValues,\n  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>\n>({\n  ...props\n}: ControllerProps<TFieldValues, TName>) => {\n  return (\n    <FormFieldContext.Provider value={{ name: props.name }}>\n      <Controller {...props} />\n    </FormFieldContext.Provider>\n  )\n}\n\nconst useFormField = () => {\n  const fieldContext = React.useContext(FormFieldContext)\n  const itemContext = React.useContext(FormItemContext)\n  const { getFieldState, formState } = useFormContext()\n\n  const fieldState = getFieldState(fieldContext.name, formState)\n\n  if (!fieldContext) {\n    throw new Error(\"useFormField should be used within <FormField>\")\n  }\n\n  const { id } = itemContext\n\n  return {\n    id,\n    name: fieldContext.name,\n    formItemId: `${id}-form-item`,\n    formDescriptionId: `${id}-form-item-description`,\n    formMessageId: `${id}-form-item-message`,\n    ...fieldState,\n  }\n}\n\ntype FormItemContextValue = {\n  id: string\n}\n\nconst FormItemContext = React.createContext<FormItemContextValue>(\n  {} as FormItemContextValue\n)\n\nconst FormItem = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const id = React.useId()\n\n  return (\n    <FormItemContext.Provider value={{ id }}>\n      <div ref={ref} className={cn(\"space-y-2\", className)} {...props} />\n    </FormItemContext.Provider>\n  )\n})\nFormItem.displayName = \"FormItem\"\n\nconst FormLabel = React.forwardRef<\n  React.ElementRef<typeof LabelPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof LabelPrimitive.Root>\n>(({ className, ...props }, ref) => {\n  const { error, formItemId } = useFormField()\n\n  return (\n    <Label\n      ref={ref}\n      className={cn(error && \"text-destructive\", className)}\n      htmlFor={formItemId}\n      {...props}\n    />\n  )\n})\nFormLabel.displayName = \"FormLabel\"\n\nconst FormControl = React.forwardRef<\n  React.ElementRef<typeof Slot>,\n  React.ComponentPropsWithoutRef<typeof Slot>\n>(({ ...props }, ref) => {\n  const { error, formItemId, formDescriptionId, formMessageId } = useFormField()\n\n  return (\n    <Slot\n      ref={ref}\n      id={formItemId}\n      aria-describedby={\n        !error\n          ? `${formDescriptionId}`\n          : `${formDescriptionId} ${formMessageId}`\n      }\n      aria-invalid={!!error}\n      {...props}\n    />\n  )\n})\nFormControl.displayName = \"FormControl\"\n\nconst FormDescription = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, ...props }, ref) => {\n  const { formDescriptionId } = useFormField()\n\n  return (\n    <p\n      ref={ref}\n      id={formDescriptionId}\n      className={cn(\"text-sm text-muted-foreground\", className)}\n      {...props}\n    />\n  )\n})\nFormDescription.displayName = \"FormDescription\"\n\nconst FormMessage = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, children, ...props }, ref) => {\n  const { error, formMessageId } = useFormField()\n  const body = error ? String(error?.message ?? \"\") : children\n\n  if (!body) {\n    return null\n  }\n\n  return (\n    <p\n      ref={ref}\n      id={formMessageId}\n      className={cn(\"text-sm font-medium text-destructive\", className)}\n      {...props}\n    >\n      {body}\n    </p>\n  )\n})\nFormMessage.displayName = \"FormMessage\"\n\nexport {\n  useFormField,\n  Form,\n  FormItem,\n  FormLabel,\n  FormControl,\n  FormDescription,\n  FormMessage,\n  FormField,\n}\n","size_bytes":4120},"server/objectAcl.ts":{"content":"import { File } from \"@google-cloud/storage\";\n\nconst ACL_POLICY_METADATA_KEY = \"custom:aclPolicy\";\n\n// The type of the access group.\n//\n// Can be flexibly defined according to the use case.\n//\n// Examples:\n// - USER_LIST: the users from a list stored in the database;\n// - EMAIL_DOMAIN: the users whose email is in a specific domain;\n// - GROUP_MEMBER: the users who are members of a specific group;\n// - SUBSCRIBER: the users who are subscribers of a specific service / content\n//   creator.\nexport enum ObjectAccessGroupType {}\n\n// The logic user group that can access the object.\nexport interface ObjectAccessGroup {\n  // The type of the access group.\n  type: ObjectAccessGroupType;\n  // The logic id that is enough to identify the qualified group members.\n  //\n  // It may have different format for different types. For example:\n  // - for USER_LIST, the id could be the user list db entity id, and the\n  //   user list db entity could contain a bunch of user ids. User needs\n  //   to be a member of the user list to be able to access the object.\n  // - for EMAIL_DOMAIN, the id could be the email domain, and the user needs\n  //   to have an email with the domain to be able to access the object.\n  // - for GROUP_MEMBER, the id could be the group db entity id, and the\n  //   group db entity could contain a bunch of user ids. User needs to be\n  //   a member of the group to be able to access the object.\n  // - for SUBSCRIBER, the id could be the subscriber db entity id, and the\n  //   subscriber db entity could contain a bunch of user ids. User needs to\n  //   be a subscriber to be able to access the object.\n  id: string;\n}\n\nexport enum ObjectPermission {\n  READ = \"read\",\n  WRITE = \"write\",\n}\n\nexport interface ObjectAclRule {\n  group: ObjectAccessGroup;\n  permission: ObjectPermission;\n}\n\n// The ACL policy of the object.\n// This would be set as part of the object custom metadata:\n// - key: \"custom:aclPolicy\"\n// - value: JSON string of the ObjectAclPolicy object.\nexport interface ObjectAclPolicy {\n  owner: string;\n  visibility: \"public\" | \"private\";\n  aclRules?: Array<ObjectAclRule>;\n}\n\n// Check if the requested permission is allowed based on the granted permission.\nfunction isPermissionAllowed(\n  requested: ObjectPermission,\n  granted: ObjectPermission,\n): boolean {\n  // Users granted with read or write permissions can read the object.\n  if (requested === ObjectPermission.READ) {\n    return [ObjectPermission.READ, ObjectPermission.WRITE].includes(granted);\n  }\n\n  // Only users granted with write permissions can write the object.\n  return granted === ObjectPermission.WRITE;\n}\n\n// The base class for all access groups.\n//\n// Different types of access groups can be implemented according to the use case.\nabstract class BaseObjectAccessGroup implements ObjectAccessGroup {\n  constructor(\n    public readonly type: ObjectAccessGroupType,\n    public readonly id: string,\n  ) {}\n\n  // Check if the user is a member of the group.\n  public abstract hasMember(userId: string): Promise<boolean>;\n}\n\nfunction createObjectAccessGroup(\n  group: ObjectAccessGroup,\n): BaseObjectAccessGroup {\n  switch (group.type) {\n    // Implement the case for each type of access group to instantiate.\n    //\n    // For example:\n    // case \"USER_LIST\":\n    //   return new UserListAccessGroup(group.id);\n    // case \"EMAIL_DOMAIN\":\n    //   return new EmailDomainAccessGroup(group.id);\n    // case \"GROUP_MEMBER\":\n    //   return new GroupMemberAccessGroup(group.id);\n    // case \"SUBSCRIBER\":\n    //   return new SubscriberAccessGroup(group.id);\n    default:\n      throw new Error(`Unknown access group type: ${group.type}`);\n  }\n}\n\n// Sets the ACL policy to the object metadata.\nexport async function setObjectAclPolicy(\n  objectFile: File,\n  aclPolicy: ObjectAclPolicy,\n): Promise<void> {\n  const [exists] = await objectFile.exists();\n  if (!exists) {\n    throw new Error(`Object not found: ${objectFile.name}`);\n  }\n\n  await objectFile.setMetadata({\n    metadata: {\n      [ACL_POLICY_METADATA_KEY]: JSON.stringify(aclPolicy),\n    },\n  });\n}\n\n// Gets the ACL policy from the object metadata.\nexport async function getObjectAclPolicy(\n  objectFile: File,\n): Promise<ObjectAclPolicy | null> {\n  const [metadata] = await objectFile.getMetadata();\n  const aclPolicy = metadata?.metadata?.[ACL_POLICY_METADATA_KEY];\n  if (!aclPolicy) {\n    return null;\n  }\n  return JSON.parse(aclPolicy as string);\n}\n\n// Checks if the user can access the object.\nexport async function canAccessObject({\n  userId,\n  objectFile,\n  requestedPermission,\n}: {\n  userId?: string;\n  objectFile: File;\n  requestedPermission: ObjectPermission;\n}): Promise<boolean> {\n  // When this function is called, the acl policy is required.\n  const aclPolicy = await getObjectAclPolicy(objectFile);\n  if (!aclPolicy) {\n    return false;\n  }\n\n  // Public objects are always accessible for read.\n  if (\n    aclPolicy.visibility === \"public\" &&\n    requestedPermission === ObjectPermission.READ\n  ) {\n    return true;\n  }\n\n  // Access control requires the user id.\n  if (!userId) {\n    return false;\n  }\n\n  // The owner of the object can always access it.\n  if (aclPolicy.owner === userId) {\n    return true;\n  }\n\n  // Go through the ACL rules to check if the user has the required permission.\n  for (const rule of aclPolicy.aclRules || []) {\n    const accessGroup = createObjectAccessGroup(rule.group);\n    if (\n      (await accessGroup.hasMember(userId)) &&\n      isPermissionAllowed(requestedPermission, rule.permission)\n    ) {\n      return true;\n    }\n  }\n\n  return false;\n}\n","size_bytes":5544},"client/src/components/ui/toaster.tsx":{"content":"import { useToast } from \"@/hooks/use-toast\"\nimport {\n  Toast,\n  ToastClose,\n  ToastDescription,\n  ToastProvider,\n  ToastTitle,\n  ToastViewport,\n} from \"@/components/ui/toast\"\n\nexport function Toaster() {\n  const { toasts } = useToast()\n\n  return (\n    <ToastProvider>\n      {toasts.map(function ({ id, title, description, action, ...props }) {\n        return (\n          <Toast key={id} {...props}>\n            <div className=\"grid gap-1\">\n              {title && <ToastTitle>{title}</ToastTitle>}\n              {description && (\n                <ToastDescription>{description}</ToastDescription>\n              )}\n            </div>\n            {action}\n            <ToastClose />\n          </Toast>\n        )\n      })}\n      <ToastViewport />\n    </ToastProvider>\n  )\n}\n","size_bytes":772},"client/src/index.css":{"content":"@import url('https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;400;500;600;700&family=Inter:wght@300;400;500;600;700&display=swap');\n@tailwind base;\n@tailwind components;\n@tailwind utilities;\n\n:root {\n  /* PupFanz Brand Colors */\n  --pf-volt: hsl(78, 100%, 54%); /* #A3FF12 */\n  --pf-cobalt: hsl(217, 91%, 60%); /* #2563EB */\n  --pf-tangerine: hsl(24, 100%, 50%); /* #FF7A00 */\n  --pf-ink: hsl(240, 10%, 3.9%); /* #0A0A0B */\n  --pf-graphite: hsl(240, 8%, 7%); /* #121214 */\n  --pf-snow: hsl(210, 25%, 95%); /* #F5F7FA */\n  --pf-mist: hsl(220, 14%, 82%); /* #C9D0D6 */\n\n  /* Semantic Colors */\n  --success: hsl(142, 76%, 36%); /* #22C55E */\n  --warning: hsl(38, 92%, 50%); /* #F59E0B */\n  --error: hsl(0, 84%, 60%); /* #EF4444 */\n\n  /* Base Theme */\n  --background: var(--pf-ink);\n  --foreground: var(--pf-snow);\n  --card: var(--pf-graphite);\n  --card-foreground: var(--pf-snow);\n  --popover: var(--pf-graphite);\n  --popover-foreground: var(--pf-snow);\n  --primary: var(--pf-volt);\n  --primary-foreground: var(--pf-ink);\n  --secondary: var(--pf-cobalt);\n  --secondary-foreground: var(--pf-snow);\n  --muted: var(--pf-mist);\n  --muted-foreground: var(--pf-mist);\n  --accent: var(--pf-tangerine);\n  --accent-foreground: var(--pf-ink);\n  --destructive: var(--error);\n  --destructive-foreground: var(--pf-snow);\n  --border: hsl(240, 6%, 15%); /* #26262A */\n  --input: var(--pf-graphite);\n  --ring: var(--pf-cobalt);\n\n  /* Sidebar */\n  --sidebar: var(--pf-graphite);\n  --sidebar-foreground: var(--pf-snow);\n  --sidebar-primary: var(--pf-volt);\n  --sidebar-primary-foreground: var(--pf-ink);\n  --sidebar-accent: var(--pf-graphite);\n  --sidebar-accent-foreground: var(--pf-volt);\n  --sidebar-border: var(--border);\n  --sidebar-ring: var(--pf-cobalt);\n\n  /* Typography */\n  --font-display: 'Space Grotesk', system-ui, sans-serif;\n  --font-sans: 'Inter', system-ui, sans-serif;\n  --font-serif: Georgia, serif;\n  --font-mono: Menlo, monospace;\n\n  /* Spacing & Effects */\n  --radius: 12px;\n  --shadow-volt-glow: 0 0 16px rgba(163, 255, 18, 0.15);\n  --shadow-volt-strong: 0 0 24px rgba(163, 255, 18, 0.25);\n  \n  /* Neon text effects */\n  --text-neon-primary: 0 0 3px rgba(163, 255, 18, 0.6), 0 0 6px rgba(163, 255, 18, 0.4), 0 0 9px rgba(163, 255, 18, 0.25), 0 0 12px rgba(163, 255, 18, 0.1);\n  --text-neon-secondary: 0 0 3px rgba(37, 99, 235, 0.6), 0 0 6px rgba(37, 99, 235, 0.4), 0 0 9px rgba(37, 99, 235, 0.25);\n  --text-neon-accent: 0 0 3px rgba(255, 122, 0, 0.6), 0 0 6px rgba(255, 122, 0, 0.4), 0 0 9px rgba(255, 122, 0, 0.25);\n\n  /* Gradients */\n  --gradient-pack: linear-gradient(135deg, var(--pf-volt) 0%, var(--pf-cobalt) 60%, #00E5FF 100%);\n  --gradient-trail: linear-gradient(90deg, var(--pf-volt), var(--pf-tangerine));\n  --gradient-moonyard: radial-gradient(1100px 520px at 70% -8%, rgba(37, 99, 235, 0.25) 0%, #0A0A0B 60%);\n  --gradient-pack-ghost: linear-gradient(135deg, rgba(163, 255, 18, 0.15) 0%, rgba(37, 99, 235, 0.15) 60%, rgba(0, 229, 255, 0.1) 100%);\n}\n\n.dark {\n  /* Dark mode is default for PupFanz */\n  --background: var(--pf-ink);\n  --foreground: var(--pf-snow);\n}\n\n@layer base {\n  * {\n    @apply border-border;\n  }\n\n  body {\n    @apply text-foreground font-sans antialiased;\n    font-family: var(--font-sans);\n    background: transparent;\n  }\n\n  h1, h2, h3, h4, h5, h6 {\n    font-family: var(--font-display);\n  }\n}\n\n@layer components {\n  /* PupFanz specific components */\n  .pack-gradient {\n    background: var(--gradient-pack);\n  }\n\n  .trail-gradient {\n    background: var(--gradient-trail);\n  }\n\n  .moonyard-bg {\n    background: var(--gradient-moonyard);\n  }\n\n  .volt-glow {\n    box-shadow: var(--shadow-volt-glow);\n  }\n\n  .volt-strong {\n    box-shadow: var(--shadow-volt-strong);\n  }\n\n  /* Neon typography classes */\n  .neon-text-primary {\n    color: var(--pf-volt);\n    text-shadow: var(--text-neon-primary);\n    font-weight: 600;\n    letter-spacing: 0.05em;\n  }\n\n  .neon-text-secondary {\n    color: var(--pf-cobalt);\n    text-shadow: var(--text-neon-secondary);\n    font-weight: 600;\n    letter-spacing: 0.05em;\n  }\n\n  .neon-text-accent {\n    color: var(--pf-tangerine);\n    text-shadow: var(--text-neon-accent);\n    font-weight: 600;\n    letter-spacing: 0.05em;\n  }\n\n  .neon-heading {\n    color: var(--pf-volt);\n    text-shadow: var(--text-neon-primary);\n    font-family: var(--font-display);\n    font-weight: 700;\n    letter-spacing: 0.1em;\n    text-transform: uppercase;\n  }\n\n  /* Button variants */\n  .btn-primary {\n    @apply bg-primary text-primary-foreground font-semibold rounded-lg transition-all duration-200;\n    box-shadow: var(--shadow-volt-glow);\n    text-shadow: var(--text-neon-primary);\n    letter-spacing: 0.05em;\n  }\n\n  .btn-primary:hover {\n    background: var(--gradient-trail);\n    box-shadow: var(--shadow-volt-strong);\n    transform: translateY(-1px);\n  }\n\n  .btn-secondary {\n    @apply bg-secondary text-secondary-foreground font-medium rounded-lg transition-colors;\n  }\n\n  .btn-secondary:hover {\n    background-color: hsl(var(--secondary) / 0.9);\n  }\n\n  /* Pack-specific animations */\n  @keyframes bounce-subtle {\n    0%, 100% { transform: translateY(0); }\n    50% { transform: translateY(-4px); }\n  }\n\n  @keyframes glow-pulse {\n    0% { box-shadow: 0 0 20px rgba(163, 255, 18, 0.3); }\n    100% { box-shadow: 0 0 40px rgba(163, 255, 18, 0.6); }\n  }\n\n  @keyframes pack-howl {\n    0% { background-position: 0% 50%; }\n    50% { background-position: 100% 50%; }\n    100% { background-position: 0% 50%; }\n  }\n\n  .animate-bounce-subtle {\n    animation: bounce-subtle 2s infinite;\n  }\n\n  .animate-glow-pulse {\n    animation: glow-pulse 2s ease-in-out infinite alternate;\n  }\n\n  .animate-pack-howl {\n    background-size: 200% 200%;\n    animation: pack-howl 3s ease infinite;\n  }\n\n  /* Safety badges */\n  .safety-badge {\n    @apply inline-flex items-center px-2 py-1 text-xs font-medium rounded-full;\n  }\n\n  .safety-badge-verified {\n    @apply bg-green-100 text-green-700 dark:bg-green-900/20 dark:text-green-400;\n  }\n\n  .safety-badge-consent {\n    background-color: hsl(var(--secondary) / 0.2);\n    color: hsl(var(--secondary-foreground));\n  }\n\n  .safety-badge-aftercare {\n    background-color: hsl(var(--accent) / 0.2);\n    color: hsl(var(--accent-foreground));\n  }\n\n  /* Pack energy styling */\n  .pack-energy {\n    @apply transform transition-all duration-200 hover:-translate-y-1;\n  }\n\n  .pack-card {\n    @apply bg-card border border-border rounded-xl transition-all duration-200;\n  }\n\n  .pack-card:hover {\n    border-color: hsl(var(--primary) / 0.3);\n    box-shadow: var(--shadow-volt-glow);\n  }\n\n  /* Content grid for media */\n  .content-grid {\n    @apply grid gap-2;\n    grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));\n  }\n\n  .content-preview {\n    @apply aspect-square rounded-lg flex items-center justify-center;\n    background: var(--gradient-pack-ghost);\n  }\n\n  /* Chat interface styling */\n  .chat-message {\n    @apply max-w-xs lg:max-w-md rounded-lg p-3;\n  }\n\n  .chat-message-received {\n    @apply bg-background border border-border;\n  }\n\n  .chat-message-sent {\n    @apply bg-primary text-primary-foreground;\n  }\n\n  /* Form controls with pack theming */\n  .form-input {\n    @apply w-full px-4 py-3 bg-background border border-border rounded-lg \n           focus:ring-2 focus:ring-primary focus:border-primary \n           transition-colors text-foreground;\n  }\n\n  .form-select {\n    @apply w-full px-4 py-3 bg-background border border-border rounded-lg \n           focus:ring-2 focus:ring-primary focus:border-primary \n           transition-colors text-foreground;\n  }\n\n  .form-textarea {\n    @apply w-full px-4 py-3 bg-background border border-border rounded-lg \n           focus:ring-2 focus:ring-primary focus:border-primary \n           transition-colors text-foreground resize-none;\n  }\n\n  /* Tab styling */\n  .tab-active {\n    @apply border-b-3 border-primary text-foreground;\n    border-bottom-width: 3px;\n  }\n\n  .tab-inactive {\n    @apply border-b border-border text-muted hover:text-foreground transition-colors;\n    border-bottom-width: 1px;\n    border-color: rgba(255, 255, 255, 0.08);\n  }\n\n  /* Upload zone styling */\n  .upload-zone {\n    @apply border-2 border-dashed border-border rounded-xl p-12 text-center \n           hover:border-primary/50 transition-colors cursor-pointer;\n  }\n\n  .upload-zone-active {\n    @apply border-primary bg-primary/5;\n  }\n}\n\n@layer utilities {\n  .text-gradient-pack {\n    background: var(--gradient-pack);\n    -webkit-background-clip: text;\n    -webkit-text-fill-color: transparent;\n    background-clip: text;\n  }\n\n  .bg-pack-howl {\n    background: var(--gradient-pack);\n  }\n\n  .bg-trail-mix {\n    background: var(--gradient-trail);\n  }\n\n  .bg-moonyard {\n    background: var(--gradient-moonyard);\n  }\n}\n","size_bytes":8721},"client/src/components/ui/slider.tsx":{"content":"import * as React from \"react\"\nimport * as SliderPrimitive from \"@radix-ui/react-slider\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Slider = React.forwardRef<\n  React.ElementRef<typeof SliderPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof SliderPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <SliderPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative flex w-full touch-none select-none items-center\",\n      className\n    )}\n    {...props}\n  >\n    <SliderPrimitive.Track className=\"relative h-2 w-full grow overflow-hidden rounded-full bg-secondary\">\n      <SliderPrimitive.Range className=\"absolute h-full bg-primary\" />\n    </SliderPrimitive.Track>\n    <SliderPrimitive.Thumb className=\"block h-5 w-5 rounded-full border-2 border-primary bg-background ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50\" />\n  </SliderPrimitive.Root>\n))\nSlider.displayName = SliderPrimitive.Root.displayName\n\nexport { Slider }\n","size_bytes":1077},"server/marketingAutomationService.ts":{"content":"import { db } from \"./db\";\nimport { eq, and, or, gte, lte, inArray, isNull, sql, desc } from \"drizzle-orm\";\nimport {\n  marketingCampaigns,\n  fanSegments,\n  fanSegmentMembers,\n  campaignExecutions,\n  socialPostQueue,\n  subscriptions,\n  userInteractions,\n  tips as tipsTable,\n  users,\n  distributionJobs,\n  socialMediaAccounts,\n} from \"@shared/schema\";\nimport { notificationService } from \"./notificationService\";\nimport { distributionService } from \"./distributionService\";\n\n/**\n * AI Marketing Automation Service\n * \n * Provides fan retargeting, automated campaigns, push notifications, and scheduled social posts.\n * Integrates with notification service and distribution service for multi-channel marketing.\n */\nclass MarketingAutomationService {\n  private schedulerInterval: NodeJS.Timeout | null = null;\n\n  /**\n   * Initialize the service and start the campaign scheduler\n   */\n  constructor() {\n    this.startScheduler();\n  }\n\n  /**\n   * Start the campaign scheduler (checks every 60 seconds for due campaigns)\n   */\n  private startScheduler(): void {\n    if (this.schedulerInterval) {\n      return; // Already running\n    }\n\n    console.log(\"[Marketing Automation] Scheduler started\");\n    \n    // Run immediately on start\n    this.processDueCampaigns().catch(error => {\n      console.error(\"[Marketing Automation] Error in initial campaign processing:\", error);\n    });\n\n    // Then run every 60 seconds\n    this.schedulerInterval = setInterval(() => {\n      this.processDueCampaigns().catch(error => {\n        console.error(\"[Marketing Automation] Error processing campaigns:\", error);\n      });\n    }, 60000); // 60 seconds\n  }\n\n  /**\n   * Process due campaigns and social posts\n   */\n  private async processDueCampaigns(): Promise<void> {\n    const now = new Date();\n\n    // Find active scheduled campaigns that are due and haven't been executed yet\n    const dueCampaigns = await db.select()\n      .from(marketingCampaigns)\n      .where(and(\n        eq(marketingCampaigns.status, 'active'),\n        eq(marketingCampaigns.trigger, 'scheduled'),\n        lte(marketingCampaigns.scheduledFor, now),\n        or(\n          isNull(marketingCampaigns.lastExecutedAt),\n          sql`${marketingCampaigns.lastExecutedAt} < ${marketingCampaigns.scheduledFor}`\n        )\n      ));\n\n    for (const campaign of dueCampaigns) {\n      try {\n        // Check execution limits\n        if (campaign.maxExecutions && (campaign.executionCount || 0) >= campaign.maxExecutions) {\n          await db.update(marketingCampaigns)\n            .set({ status: 'completed' })\n            .where(eq(marketingCampaigns.id, campaign.id));\n          continue;\n        }\n\n        // Check end date\n        if (campaign.endDate && campaign.endDate < now) {\n          await db.update(marketingCampaigns)\n            .set({ status: 'completed' })\n            .where(eq(marketingCampaigns.id, campaign.id));\n          continue;\n        }\n\n        await this.executeCampaign(campaign.id);\n        \n        console.log(`[Marketing Automation] Executed campaign: ${campaign.name}`);\n      } catch (error) {\n        console.error(`[Marketing Automation] Error executing campaign ${campaign.id}:`, error);\n      }\n    }\n\n    // Process due social posts\n    await this.processDueSocialPosts();\n  }\n\n  /**\n   * Process due social posts\n   */\n  private async processDueSocialPosts(): Promise<void> {\n    const now = new Date();\n\n    const duePosts = await db.select()\n      .from(socialPostQueue)\n      .where(and(\n        eq(socialPostQueue.status, 'scheduled'),\n        lte(socialPostQueue.scheduledFor, now)\n      ));\n\n    for (const post of duePosts) {\n      try {\n        // Mark as posting\n        await db.update(socialPostQueue)\n          .set({ status: 'posting' })\n          .where(eq(socialPostQueue.id, post.id));\n\n        // Get creator's social media accounts\n        const platforms = post.platforms as string[];\n        let allSuccessful = true;\n        let errorMessage = '';\n\n        for (const platform of platforms) {\n          try {\n            // Find the creator's connected account for this platform\n            const [account] = await db.select()\n              .from(socialMediaAccounts)\n              .where(and(\n                eq(socialMediaAccounts.creatorUserId, post.creatorId),\n                sql`${socialMediaAccounts.platform} = ${platform}`,\n                eq(socialMediaAccounts.status, 'connected')\n              ));\n\n            if (!account) {\n              console.log(`[Marketing Automation] No connected ${platform} account for creator ${post.creatorId}`);\n              allSuccessful = false;\n              errorMessage += `No connected ${platform} account. `;\n              continue;\n            }\n\n            // Create distribution job via distribution service\n            const contentId = post.mediaPath ? `marketing_${post.id}` : post.id;\n            \n            await distributionService.distributeContent(\n              contentId,\n              post.creatorId,\n              {\n                platforms: [platform as any],\n                caption: post.postContent,\n                scheduledFor: undefined,\n              }\n            );\n\n            console.log(`[Marketing Automation] Created distribution job for ${platform}: ${post.postContent.substring(0, 50)}...`);\n          } catch (platformError) {\n            console.error(`[Marketing Automation] Error posting to ${platform}:`, platformError);\n            allSuccessful = false;\n            errorMessage += `${platform} error: ${platformError instanceof Error ? platformError.message : 'Unknown'}. `;\n          }\n        }\n\n        // Update final status\n        if (allSuccessful) {\n          await db.update(socialPostQueue)\n            .set({ \n              status: 'posted',\n              postedAt: new Date()\n            })\n            .where(eq(socialPostQueue.id, post.id));\n          console.log(`[Marketing Automation] Successfully posted to all platforms: ${post.id}`);\n        } else {\n          await db.update(socialPostQueue)\n            .set({ \n              status: 'failed',\n              errorMessage: errorMessage.trim()\n            })\n            .where(eq(socialPostQueue.id, post.id));\n          console.log(`[Marketing Automation] Partial failure posting: ${post.id} - ${errorMessage}`);\n        }\n      } catch (error) {\n        console.error(`[Marketing Automation] Error processing social post ${post.id}:`, error);\n        await db.update(socialPostQueue)\n          .set({ \n            status: 'failed',\n            errorMessage: error instanceof Error ? error.message : 'Unknown error'\n          })\n          .where(eq(socialPostQueue.id, post.id));\n      }\n    }\n  }\n\n  // ==========================================================================\n  // CAMPAIGN MANAGEMENT\n  // ==========================================================================\n\n  /**\n   * Create a new marketing campaign\n   */\n  async createCampaign(\n    creatorId: string,\n    data: {\n      name: string;\n      type: 'push_notification' | 'email' | 'social_post' | 'retargeting' | 'automated';\n      trigger: string;\n      triggerConditions?: any;\n      targetSegmentId?: string;\n      targetAllFans?: boolean;\n      messageTemplate: string;\n      subject?: string;\n      mediaPath?: string;\n      ctaText?: string;\n      ctaUrl?: string;\n      scheduledFor?: Date;\n      startDate?: Date;\n      endDate?: Date;\n      maxExecutions?: number;\n    }\n  ) {\n    const [campaign] = await db.insert(marketingCampaigns)\n      .values({\n        creatorId,\n        name: data.name,\n        type: data.type,\n        trigger: data.trigger,\n        triggerConditions: data.triggerConditions,\n        targetSegmentId: data.targetSegmentId,\n        targetAllFans: data.targetAllFans,\n        messageTemplate: data.messageTemplate,\n        subject: data.subject,\n        mediaPath: data.mediaPath,\n        ctaText: data.ctaText,\n        ctaUrl: data.ctaUrl,\n        scheduledFor: data.scheduledFor,\n        startDate: data.startDate,\n        endDate: data.endDate,\n        maxExecutions: data.maxExecutions,\n      })\n      .returning();\n\n    return campaign;\n  }\n\n  /**\n   * Activate a campaign\n   */\n  async activateCampaign(campaignId: string, creatorId: string) {\n    const [campaign] = await db.select()\n      .from(marketingCampaigns)\n      .where(eq(marketingCampaigns.id, campaignId));\n\n    if (!campaign) {\n      throw new Error(\"Campaign not found\");\n    }\n\n    if (campaign.creatorId !== creatorId) {\n      throw new Error(\"Unauthorized\");\n    }\n\n    await db.update(marketingCampaigns)\n      .set({ status: 'active' })\n      .where(eq(marketingCampaigns.id, campaignId));\n\n    // Execute immediately if manual trigger\n    if (campaign.trigger === 'manual') {\n      await this.executeCampaign(campaignId);\n    }\n\n    return { success: true };\n  }\n\n  /**\n   * Pause a campaign\n   */\n  async pauseCampaign(campaignId: string, creatorId: string) {\n    const [campaign] = await db.select()\n      .from(marketingCampaigns)\n      .where(eq(marketingCampaigns.id, campaignId));\n\n    if (!campaign) {\n      throw new Error(\"Campaign not found\");\n    }\n\n    if (campaign.creatorId !== creatorId) {\n      throw new Error(\"Unauthorized\");\n    }\n\n    await db.update(marketingCampaigns)\n      .set({ status: 'paused' })\n      .where(eq(marketingCampaigns.id, campaignId));\n\n    return { success: true };\n  }\n\n  /**\n   * Execute a campaign (send to recipients)\n   */\n  async executeCampaign(campaignId: string): Promise<void> {\n    const [campaign] = await db.select()\n      .from(marketingCampaigns)\n      .where(eq(marketingCampaigns.id, campaignId));\n\n    if (!campaign) {\n      throw new Error(\"Campaign not found\");\n    }\n\n    // Get target recipients\n    const recipients = await this.getCampaignRecipients(campaign);\n\n    let sentCount = 0;\n\n    // Send to each recipient\n    for (const recipient of recipients) {\n      try {\n        // Queue execution\n        const [execution] = await db.insert(campaignExecutions)\n          .values({\n            campaignId,\n            recipientId: recipient.id,\n            status: 'queued',\n          })\n          .returning();\n\n        // Send based on campaign type\n        switch (campaign.type) {\n          case 'push_notification':\n            await this.sendPushNotification(campaign, recipient, execution.id);\n            break;\n          case 'email':\n            // TODO: Integrate with email service\n            console.log(`[Marketing Automation] Would send email to ${recipient.email}`);\n            break;\n          case 'social_post':\n            // Already handled by social post queue\n            break;\n        }\n\n        sentCount++;\n\n        // Update execution status\n        await db.update(campaignExecutions)\n          .set({ \n            status: 'sent',\n            deliveredAt: new Date()\n          })\n          .where(eq(campaignExecutions.id, execution.id));\n\n      } catch (error) {\n        console.error(`[Marketing Automation] Error sending to recipient ${recipient.id}:`, error);\n      }\n    }\n\n    // Update campaign stats\n    await db.update(marketingCampaigns)\n      .set({\n        executionCount: sql`${marketingCampaigns.executionCount} + 1`,\n        lastExecutedAt: new Date(),\n        totalSent: sql`${marketingCampaigns.totalSent} + ${sentCount}`,\n      })\n      .where(eq(marketingCampaigns.id, campaignId));\n  }\n\n  /**\n   * Get campaign recipients based on targeting\n   */\n  private async getCampaignRecipients(campaign: any): Promise<any[]> {\n    if (campaign.targetAllFans) {\n      // Get all fans of this creator (subscribers)\n      const subs = await db.select({ fanId: subscriptions.fanId })\n        .from(subscriptions)\n        .where(and(\n          eq(subscriptions.creatorId, campaign.creatorId),\n          eq(subscriptions.status, 'active')\n        ));\n\n      const fanIds = subs.map(s => s.fanId);\n      \n      if (fanIds.length === 0) return [];\n\n      return await db.select()\n        .from(users)\n        .where(inArray(users.id, fanIds));\n    } else if (campaign.targetSegmentId) {\n      // Get fans in the segment\n      const members = await db.select()\n        .from(fanSegmentMembers)\n        .innerJoin(users, eq(fanSegmentMembers.fanId, users.id))\n        .where(eq(fanSegmentMembers.segmentId, campaign.targetSegmentId));\n\n      return members.map(m => m.users);\n    }\n\n    return [];\n  }\n\n  /**\n   * Send push notification via notification service\n   */\n  private async sendPushNotification(campaign: any, recipient: any, executionId: string): Promise<void> {\n    await notificationService.createNotification({\n      userId: recipient.id,\n      type: 'system',\n      title: campaign.subject || 'New Message',\n      message: campaign.messageTemplate,\n      actionUrl: campaign.ctaUrl,\n      metadata: {\n        campaignId: campaign.id,\n        executionId,\n      },\n    });\n  }\n\n  /**\n   * Get campaign analytics\n   */\n  async getCampaignAnalytics(campaignId: string, creatorId: string) {\n    const [campaign] = await db.select()\n      .from(marketingCampaigns)\n      .where(eq(marketingCampaigns.id, campaignId));\n\n    if (!campaign) {\n      throw new Error(\"Campaign not found\");\n    }\n\n    if (campaign.creatorId !== creatorId) {\n      throw new Error(\"Unauthorized\");\n    }\n\n    // Get execution stats\n    const executions = await db.select()\n      .from(campaignExecutions)\n      .where(eq(campaignExecutions.campaignId, campaignId));\n\n    const stats = {\n      totalSent: executions.length,\n      delivered: executions.filter(e => e.status === 'delivered' || e.status === 'opened' || e.status === 'clicked' || e.status === 'converted').length,\n      opened: executions.filter(e => e.status === 'opened' || e.status === 'clicked' || e.status === 'converted').length,\n      clicked: executions.filter(e => e.status === 'clicked' || e.status === 'converted').length,\n      converted: executions.filter(e => e.status === 'converted').length,\n      failed: executions.filter(e => e.status === 'failed').length,\n      bounced: executions.filter(e => e.status === 'bounced').length,\n      deliveryRate: executions.length > 0 ? (executions.filter(e => e.status !== 'failed' && e.status !== 'bounced').length / executions.length * 100).toFixed(2) : '0.00',\n      openRate: executions.length > 0 ? (executions.filter(e => e.status === 'opened' || e.status === 'clicked' || e.status === 'converted').length / executions.length * 100).toFixed(2) : '0.00',\n      clickRate: executions.length > 0 ? (executions.filter(e => e.status === 'clicked' || e.status === 'converted').length / executions.length * 100).toFixed(2) : '0.00',\n      conversionRate: executions.length > 0 ? (executions.filter(e => e.status === 'converted').length / executions.length * 100).toFixed(2) : '0.00',\n    };\n\n    return {\n      campaign,\n      stats,\n      executions: executions.slice(0, 100), // Recent 100\n    };\n  }\n\n  // ==========================================================================\n  // FAN SEGMENT MANAGEMENT\n  // ==========================================================================\n\n  /**\n   * Create a fan segment\n   */\n  async createSegment(\n    creatorId: string,\n    data: {\n      name: string;\n      description?: string;\n      segmentType: 'manual' | 'auto_rule' | 'behavioral' | 'demographic';\n      rules?: any;\n    }\n  ) {\n    const [segment] = await db.insert(fanSegments)\n      .values({\n        creatorId,\n        ...data,\n      })\n      .returning();\n\n    // Calculate membership for auto segments\n    if (data.segmentType !== 'manual') {\n      await this.recalculateSegment(segment.id);\n    }\n\n    return segment;\n  }\n\n  /**\n   * Add fan to segment manually\n   */\n  async addFanToSegment(segmentId: string, fanId: string, creatorId: string) {\n    // Verify segment ownership\n    const [segment] = await db.select()\n      .from(fanSegments)\n      .where(eq(fanSegments.id, segmentId));\n\n    if (!segment) {\n      throw new Error(\"Segment not found\");\n    }\n\n    if (segment.creatorId !== creatorId) {\n      throw new Error(\"Unauthorized\");\n    }\n\n    // Add to segment\n    await db.insert(fanSegmentMembers)\n      .values({\n        segmentId,\n        fanId,\n      })\n      .onConflictDoNothing();\n\n    // Update count\n    await this.updateSegmentCount(segmentId);\n\n    return { success: true };\n  }\n\n  /**\n   * Remove fan from segment\n   */\n  async removeFanFromSegment(segmentId: string, fanId: string, creatorId: string) {\n    // Verify segment ownership\n    const [segment] = await db.select()\n      .from(fanSegments)\n      .where(eq(fanSegments.id, segmentId));\n\n    if (!segment) {\n      throw new Error(\"Segment not found\");\n    }\n\n    if (segment.creatorId !== creatorId) {\n      throw new Error(\"Unauthorized\");\n    }\n\n    await db.delete(fanSegmentMembers)\n      .where(and(\n        eq(fanSegmentMembers.segmentId, segmentId),\n        eq(fanSegmentMembers.fanId, fanId)\n      ));\n\n    // Update count\n    await this.updateSegmentCount(segmentId);\n\n    return { success: true };\n  }\n\n  /**\n   * Recalculate segment membership based on rules\n   */\n  async recalculateSegment(segmentId: string): Promise<void> {\n    const [segment] = await db.select()\n      .from(fanSegments)\n      .where(eq(fanSegments.id, segmentId));\n\n    if (!segment || segment.segmentType === 'manual') {\n      return;\n    }\n\n    // Clear existing members for auto segments\n    await db.delete(fanSegmentMembers)\n      .where(eq(fanSegmentMembers.segmentId, segmentId));\n\n    const rules = segment.rules as any || {};\n\n    // Get all subscribers of this creator\n    const subs = await db.select()\n      .from(subscriptions)\n      .where(and(\n        eq(subscriptions.creatorId, segment.creatorId),\n        eq(subscriptions.status, 'active')\n      ));\n\n    const qualifiedFans: string[] = [];\n\n    for (const sub of subs) {\n      let qualifies = true;\n\n      // Check subscription tier rule\n      if (rules.subscription_tier && Array.isArray(rules.subscription_tier)) {\n        if (!rules.subscription_tier.includes(sub.tier)) {\n          qualifies = false;\n        }\n      }\n\n      // Check total spent rule\n      if (rules.total_spent && qualifies) {\n        const tipsData = await db.select()\n          .from(tipsTable)\n          .where(and(\n            eq(tipsTable.fromUserId, sub.fanId),\n            eq(tipsTable.toUserId, segment.creatorId),\n            eq(tipsTable.status, 'completed')\n          ));\n\n        const totalSpent = tipsData.reduce((sum: number, tip: any) => sum + parseFloat(tip.amount.toString()), 0);\n\n        if (rules.total_spent.gte && totalSpent < rules.total_spent.gte) {\n          qualifies = false;\n        }\n        if (rules.total_spent.lte && totalSpent > rules.total_spent.lte) {\n          qualifies = false;\n        }\n      }\n\n      // Check inactivity rule (days since last interaction)\n      if (rules.inactivity_days && qualifies) {\n        const recentInteractions = await db.select()\n          .from(userInteractions)\n          .where(eq(userInteractions.userId, sub.fanId))\n          .orderBy(desc(userInteractions.createdAt))\n          .limit(1);\n\n        if (recentInteractions.length > 0 && recentInteractions[0]) {\n          const daysSinceLastInteraction = Math.floor(\n            (Date.now() - recentInteractions[0].createdAt.getTime()) / (1000 * 60 * 60 * 24)\n          );\n\n          if (rules.inactivity_days.gte && daysSinceLastInteraction < rules.inactivity_days.gte) {\n            qualifies = false;\n          }\n        }\n      }\n\n      if (qualifies) {\n        qualifiedFans.push(sub.fanId);\n      }\n    }\n\n    // Add qualified fans to segment\n    if (qualifiedFans.length > 0) {\n      await db.insert(fanSegmentMembers)\n        .values(qualifiedFans.map(fanId => ({\n          segmentId,\n          fanId,\n        })))\n        .onConflictDoNothing();\n    }\n\n    // Update segment stats\n    await db.update(fanSegments)\n      .set({\n        fanCount: qualifiedFans.length,\n        lastRecalculatedAt: new Date(),\n      })\n      .where(eq(fanSegments.id, segmentId));\n  }\n\n  /**\n   * Update segment fan count\n   */\n  private async updateSegmentCount(segmentId: string): Promise<void> {\n    const members = await db.select()\n      .from(fanSegmentMembers)\n      .where(eq(fanSegmentMembers.segmentId, segmentId));\n\n    await db.update(fanSegments)\n      .set({ fanCount: members.length })\n      .where(eq(fanSegments.id, segmentId));\n  }\n\n  /**\n   * Get creator segments\n   */\n  async getCreatorSegments(creatorId: string) {\n    return await db.select()\n      .from(fanSegments)\n      .where(and(\n        eq(fanSegments.creatorId, creatorId),\n        eq(fanSegments.isActive, true)\n      ));\n  }\n\n  /**\n   * Get segment members\n   */\n  async getSegmentMembers(segmentId: string, creatorId: string) {\n    // Verify ownership\n    const [segment] = await db.select()\n      .from(fanSegments)\n      .where(eq(fanSegments.id, segmentId));\n\n    if (!segment) {\n      throw new Error(\"Segment not found\");\n    }\n\n    if (segment.creatorId !== creatorId) {\n      throw new Error(\"Unauthorized\");\n    }\n\n    const members = await db.select()\n      .from(fanSegmentMembers)\n      .innerJoin(users, eq(fanSegmentMembers.fanId, users.id))\n      .where(eq(fanSegmentMembers.segmentId, segmentId));\n\n    return members.map(m => m.users);\n  }\n\n  // ==========================================================================\n  // SOCIAL POST QUEUE\n  // ==========================================================================\n\n  /**\n   * Schedule a social media post\n   */\n  async scheduleSocialPost(\n    creatorId: string,\n    data: {\n      platforms: string[];\n      postContent: string;\n      mediaPath?: string;\n      scheduledFor: Date;\n      campaignId?: string;\n    }\n  ) {\n    const [post] = await db.insert(socialPostQueue)\n      .values({\n        creatorId,\n        ...data,\n        platforms: data.platforms,\n      })\n      .returning();\n\n    return post;\n  }\n\n  /**\n   * Cancel scheduled social post\n   */\n  async cancelSocialPost(postId: string, creatorId: string) {\n    const [post] = await db.select()\n      .from(socialPostQueue)\n      .where(eq(socialPostQueue.id, postId));\n\n    if (!post) {\n      throw new Error(\"Post not found\");\n    }\n\n    if (post.creatorId !== creatorId) {\n      throw new Error(\"Unauthorized\");\n    }\n\n    if (post.status !== 'scheduled' && post.status !== 'queued') {\n      throw new Error(\"Cannot cancel post in current status\");\n    }\n\n    await db.update(socialPostQueue)\n      .set({ status: 'cancelled' })\n      .where(eq(socialPostQueue.id, postId));\n\n    return { success: true };\n  }\n\n  /**\n   * Get creator's scheduled posts\n   */\n  async getScheduledPosts(creatorId: string) {\n    return await db.select()\n      .from(socialPostQueue)\n      .where(and(\n        eq(socialPostQueue.creatorId, creatorId),\n        inArray(socialPostQueue.status, ['scheduled', 'queued'])\n      ))\n      .orderBy(socialPostQueue.scheduledFor);\n  }\n}\n\nexport const marketingAutomationService = new MarketingAutomationService();\n","size_bytes":22960},"client/src/components/ui/command.tsx":{"content":"import * as React from \"react\"\nimport { type DialogProps } from \"@radix-ui/react-dialog\"\nimport { Command as CommandPrimitive } from \"cmdk\"\nimport { Search } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Dialog, DialogContent } from \"@/components/ui/dialog\"\n\nconst Command = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive\n    ref={ref}\n    className={cn(\n      \"flex h-full w-full flex-col overflow-hidden rounded-md bg-popover text-popover-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nCommand.displayName = CommandPrimitive.displayName\n\nconst CommandDialog = ({ children, ...props }: DialogProps) => {\n  return (\n    <Dialog {...props}>\n      <DialogContent className=\"overflow-hidden p-0 shadow-lg\">\n        <Command className=\"[&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground [&_[cmdk-group]:not([hidden])_~[cmdk-group]]:pt-0 [&_[cmdk-group]]:px-2 [&_[cmdk-input-wrapper]_svg]:h-5 [&_[cmdk-input-wrapper]_svg]:w-5 [&_[cmdk-input]]:h-12 [&_[cmdk-item]]:px-2 [&_[cmdk-item]]:py-3 [&_[cmdk-item]_svg]:h-5 [&_[cmdk-item]_svg]:w-5\">\n          {children}\n        </Command>\n      </DialogContent>\n    </Dialog>\n  )\n}\n\nconst CommandInput = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Input>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Input>\n>(({ className, ...props }, ref) => (\n  <div className=\"flex items-center border-b px-3\" cmdk-input-wrapper=\"\">\n    <Search className=\"mr-2 h-4 w-4 shrink-0 opacity-50\" />\n    <CommandPrimitive.Input\n      ref={ref}\n      className={cn(\n        \"flex h-11 w-full rounded-md bg-transparent py-3 text-sm outline-none placeholder:text-muted-foreground disabled:cursor-not-allowed disabled:opacity-50\",\n        className\n      )}\n      {...props}\n    />\n  </div>\n))\n\nCommandInput.displayName = CommandPrimitive.Input.displayName\n\nconst CommandList = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.List\n    ref={ref}\n    className={cn(\"max-h-[300px] overflow-y-auto overflow-x-hidden\", className)}\n    {...props}\n  />\n))\n\nCommandList.displayName = CommandPrimitive.List.displayName\n\nconst CommandEmpty = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Empty>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Empty>\n>((props, ref) => (\n  <CommandPrimitive.Empty\n    ref={ref}\n    className=\"py-6 text-center text-sm\"\n    {...props}\n  />\n))\n\nCommandEmpty.displayName = CommandPrimitive.Empty.displayName\n\nconst CommandGroup = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Group>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Group>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Group\n    ref={ref}\n    className={cn(\n      \"overflow-hidden p-1 text-foreground [&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:py-1.5 [&_[cmdk-group-heading]]:text-xs [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\n\nCommandGroup.displayName = CommandPrimitive.Group.displayName\n\nconst CommandSeparator = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 h-px bg-border\", className)}\n    {...props}\n  />\n))\nCommandSeparator.displayName = CommandPrimitive.Separator.displayName\n\nconst CommandItem = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Item>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default gap-2 select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none data-[disabled=true]:pointer-events-none data-[selected='true']:bg-accent data-[selected=true]:text-accent-foreground data-[disabled=true]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n      className\n    )}\n    {...props}\n  />\n))\n\nCommandItem.displayName = CommandPrimitive.Item.displayName\n\nconst CommandShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nCommandShortcut.displayName = \"CommandShortcut\"\n\nexport {\n  Command,\n  CommandDialog,\n  CommandInput,\n  CommandList,\n  CommandEmpty,\n  CommandGroup,\n  CommandItem,\n  CommandShortcut,\n  CommandSeparator,\n}\n","size_bytes":4885},"client/src/components/ui/badge.tsx":{"content":"import * as React from \"react\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst badgeVariants = cva(\n  \"inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2\",\n  {\n    variants: {\n      variant: {\n        default:\n          \"border-transparent bg-primary text-primary-foreground hover:bg-primary/80\",\n        secondary:\n          \"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80\",\n        destructive:\n          \"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80\",\n        outline: \"text-foreground\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nexport interface BadgeProps\n  extends React.HTMLAttributes<HTMLDivElement>,\n    VariantProps<typeof badgeVariants> {}\n\nfunction Badge({ className, variant, ...props }: BadgeProps) {\n  return (\n    <div className={cn(badgeVariants({ variant }), className)} {...props} />\n  )\n}\n\nexport { Badge, badgeVariants }\n","size_bytes":1128},"client/src/pages/Achievements.tsx":{"content":"import { useQuery } from \"@tanstack/react-query\";\nimport { Award, Trophy, Lock, Star, Crown, Shield } from \"lucide-react\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Progress } from \"@/components/ui/progress\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\n\nexport default function Achievements() {\n  const { data: achievements = [], isLoading } = useQuery<any[]>({\n    queryKey: ['/api/gamification/achievements'],\n  });\n\n  const categorizedAchievements = achievements.reduce((acc: any, item: any) => {\n    const category = item.achievement.category || 'other';\n    if (!acc[category]) acc[category] = [];\n    acc[category].push(item);\n    return acc;\n  }, {});\n\n  const getTierColor = (tier: string) => {\n    switch (tier) {\n      case 'bronze': return 'bg-orange-700 dark:bg-orange-800';\n      case 'silver': return 'bg-gray-400 dark:bg-gray-500';\n      case 'gold': return 'bg-yellow-500 dark:bg-yellow-600';\n      case 'platinum': return 'bg-cyan-500 dark:bg-cyan-600';\n      case 'diamond': return 'bg-blue-500 dark:bg-blue-600';\n      default: return 'bg-gray-600 dark:bg-gray-700';\n    }\n  };\n\n  const getTierIcon = (tier: string) => {\n    switch (tier) {\n      case 'bronze': return <Award className=\"w-6 h-6\" />;\n      case 'silver': return <Shield className=\"w-6 h-6\" />;\n      case 'gold': return <Trophy className=\"w-6 h-6\" />;\n      case 'platinum': return <Star className=\"w-6 h-6\" />;\n      case 'diamond': return <Crown className=\"w-6 h-6\" />;\n      default: return <Award className=\"w-6 h-6\" />;\n    }\n  };\n\n  if (isLoading) {\n    return (\n      <div className=\"container mx-auto px-4 py-8\" data-testid=\"page-achievements\">\n        <div className=\"animate-pulse space-y-4\">\n          <div className=\"h-8 bg-muted rounded w-64\"></div>\n          <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4\">\n            {[1, 2, 3, 4, 5, 6].map((i) => (\n              <div key={i} className=\"h-40 bg-muted rounded\"></div>\n            ))}\n          </div>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"container mx-auto px-4 py-8\" data-testid=\"page-achievements\">\n      <div className=\"mb-8\">\n        <h1 className=\"text-4xl font-bold mb-2 text-foreground dark:text-white\" data-testid=\"heading-achievements\">\n          Your Achievements\n        </h1>\n        <p className=\"text-muted-foreground dark:text-gray-400\">\n          Unlock badges and rewards as you progress on the platform\n        </p>\n      </div>\n\n      <div className=\"mb-6 grid grid-cols-1 md:grid-cols-3 gap-4\">\n        <Card className=\"bg-card dark:bg-gray-800\">\n          <CardContent className=\"pt-6\">\n            <div className=\"flex items-center justify-between\">\n              <div>\n                <p className=\"text-sm text-muted-foreground dark:text-gray-400\">Total Achievements</p>\n                <p className=\"text-3xl font-bold text-foreground dark:text-white\" data-testid=\"stat-total-achievements\">\n                  {achievements.length}\n                </p>\n              </div>\n              <Trophy className=\"w-12 h-12 text-yellow-500\" />\n            </div>\n          </CardContent>\n        </Card>\n\n        <Card className=\"bg-card dark:bg-gray-800\">\n          <CardContent className=\"pt-6\">\n            <div className=\"flex items-center justify-between\">\n              <div>\n                <p className=\"text-sm text-muted-foreground dark:text-gray-400\">Total Points</p>\n                <p className=\"text-3xl font-bold text-foreground dark:text-white\" data-testid=\"stat-total-points\">\n                  {achievements.reduce((sum: number, item: any) => sum + (item.achievement.points || 0), 0)}\n                </p>\n              </div>\n              <Star className=\"w-12 h-12 text-blue-500\" />\n            </div>\n          </CardContent>\n        </Card>\n\n        <Card className=\"bg-card dark:bg-gray-800\">\n          <CardContent className=\"pt-6\">\n            <div className=\"flex items-center justify-between\">\n              <div>\n                <p className=\"text-sm text-muted-foreground dark:text-gray-400\">Rarity Breakdown</p>\n                <div className=\"flex gap-2 mt-2\">\n                  {['bronze', 'silver', 'gold', 'platinum', 'diamond'].map(tier => {\n                    const count = achievements.filter((a: any) => a.achievement.tier === tier).length;\n                    if (count === 0) return null;\n                    return (\n                      <Badge key={tier} className={`${getTierColor(tier)} text-white`} data-testid={`badge-tier-${tier}`}>\n                        {count}\n                      </Badge>\n                    );\n                  })}\n                </div>\n              </div>\n              <Crown className=\"w-12 h-12 text-purple-500\" />\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n\n      <Tabs defaultValue=\"all\" className=\"w-full\">\n        <TabsList className=\"grid w-full grid-cols-6 bg-muted dark:bg-gray-800\">\n          <TabsTrigger value=\"all\" data-testid=\"tab-all\">All</TabsTrigger>\n          <TabsTrigger value=\"creator\" data-testid=\"tab-creator\">Creator</TabsTrigger>\n          <TabsTrigger value=\"fan\" data-testid=\"tab-fan\">Fan</TabsTrigger>\n          <TabsTrigger value=\"engagement\" data-testid=\"tab-engagement\">Engagement</TabsTrigger>\n          <TabsTrigger value=\"milestone\" data-testid=\"tab-milestone\">Milestone</TabsTrigger>\n          <TabsTrigger value=\"special\" data-testid=\"tab-special\">Special</TabsTrigger>\n        </TabsList>\n\n        <TabsContent value=\"all\" className=\"mt-6\">\n          <AchievementGrid achievements={achievements} getTierColor={getTierColor} getTierIcon={getTierIcon} />\n        </TabsContent>\n\n        {Object.keys(categorizedAchievements).map(category => (\n          <TabsContent key={category} value={category} className=\"mt-6\">\n            <AchievementGrid \n              achievements={categorizedAchievements[category]} \n              getTierColor={getTierColor} \n              getTierIcon={getTierIcon} \n            />\n          </TabsContent>\n        ))}\n      </Tabs>\n    </div>\n  );\n}\n\nfunction AchievementGrid({ achievements, getTierColor, getTierIcon }: any) {\n  if (achievements.length === 0) {\n    return (\n      <div className=\"text-center py-12\">\n        <Lock className=\"w-16 h-16 mx-auto text-muted-foreground dark:text-gray-600 mb-4\" />\n        <p className=\"text-muted-foreground dark:text-gray-400\">No achievements unlocked in this category yet</p>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4\">\n      {achievements.map((item: any) => {\n        const achievement = item.achievement;\n        const userAchievement = item.userAchievement;\n\n        return (\n          <Card \n            key={achievement.id} \n            className=\"bg-card dark:bg-gray-800 hover:shadow-lg transition-shadow\"\n            data-testid={`achievement-card-${achievement.id}`}\n          >\n            <CardHeader>\n              <div className=\"flex items-start justify-between\">\n                <div className={`p-3 rounded-lg ${getTierColor(achievement.tier)} text-white`}>\n                  {getTierIcon(achievement.tier)}\n                </div>\n                <Badge className={`${getTierColor(achievement.tier)} text-white`} data-testid={`badge-tier-${achievement.tier}`}>\n                  {achievement.tier}\n                </Badge>\n              </div>\n              <CardTitle className=\"text-foreground dark:text-white\" data-testid={`achievement-title-${achievement.id}`}>\n                {achievement.name}\n              </CardTitle>\n              <CardDescription className=\"dark:text-gray-400\">\n                {achievement.description}\n              </CardDescription>\n            </CardHeader>\n            <CardContent>\n              <div className=\"flex items-center justify-between mb-2\">\n                <span className=\"text-sm text-muted-foreground dark:text-gray-400\">Progress</span>\n                <span className=\"text-sm font-semibold text-foreground dark:text-white\" data-testid={`achievement-progress-${achievement.id}`}>\n                  {userAchievement.progress}%\n                </span>\n              </div>\n              <Progress value={userAchievement.progress} className=\"h-2\" />\n              <div className=\"mt-4 flex items-center justify-between\">\n                <div className=\"flex items-center gap-1 text-yellow-500\">\n                  <Star className=\"w-4 h-4\" />\n                  <span className=\"text-sm font-semibold\" data-testid={`achievement-points-${achievement.id}`}>\n                    {achievement.points} pts\n                  </span>\n                </div>\n                <span className=\"text-xs text-muted-foreground dark:text-gray-500\" data-testid={`achievement-unlocked-date-${achievement.id}`}>\n                  Unlocked {new Date(userAchievement.unlockedAt).toLocaleDateString()}\n                </span>\n              </div>\n            </CardContent>\n          </Card>\n        );\n      })}\n    </div>\n  );\n}\n","size_bytes":9135},"client/src/hooks/usePacks.ts":{"content":"import { useQuery } from \"@tanstack/react-query\";\n\nexport function useUserPacks(userId: string | undefined) {\n  return useQuery({\n    queryKey: ['/api/users', userId, 'packs'],\n    enabled: !!userId,\n    retry: false,\n  });\n}\n\nexport function useAllPacks() {\n  return useQuery({\n    queryKey: ['/api/packs'],\n    retry: false,\n  });\n}\n\nexport function usePack(packId: string | undefined) {\n  return useQuery({\n    queryKey: ['/api/packs', packId],\n    enabled: !!packId,\n    retry: false,\n  });\n}\n","size_bytes":497}},"version":2}