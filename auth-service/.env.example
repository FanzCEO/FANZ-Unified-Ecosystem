# FANZ Auth Service Environment Configuration

# Basic Service Configuration
NODE_ENV=development
PORT=3001

# Database Configuration
DATABASE_URL=postgresql://username:password@localhost:5432/fanz_auth
REDIS_URL=redis://localhost:6379

# JWT Configuration  
JWT_SECRET=your-super-secure-jwt-secret-here
JWT_EXPIRY=24h
REFRESH_TOKEN_EXPIRY=30d

# ===========================================
# RATE LIMITING CONFIGURATION 
# ===========================================

# Global Rate Limiting Settings
RATE_LIMIT_ENABLED=true
RATE_LIMIT_REDIS_PREFIX=rl:auth:
RL_LOGGING_ENABLED=true
RL_LOGGING_LEVEL=warn

# HMAC Secret for Account Key Hashing (REQUIRED in production)
# This secret is used to hash email/username for rate limiting keys
# CRITICAL: Change this in production and keep it secure!
RL_HMAC_SECRET=change-this-super-secure-hmac-secret-in-production

# Sensitive Operations (Login, Registration, Password Reset)
# These are the most restrictive limits to prevent brute force attacks
RL_SENSITIVE_WINDOW_MS=60000      # 1 minute window
RL_SENSITIVE_MAX_IP=5             # Max 5 attempts per IP per minute
RL_SENSITIVE_MAX_ACCOUNT=3        # Max 3 attempts per account per minute
RL_SENSITIVE_LONG_WINDOW_MS=3600000  # 1 hour window  
RL_SENSITIVE_LONG_MAX_IP=20       # Max 20 attempts per IP per hour

# Token Operations (Refresh, Validation)  
# Moderate limits for token-related operations
RL_TOKEN_WINDOW_MS=60000          # 1 minute window
RL_TOKEN_MAX_IP=30                # Max 30 requests per IP per minute
RL_TOKEN_MAX_USER=60              # Max 60 requests per user per minute
RL_TOKEN_LONG_WINDOW_MS=900000    # 15 minute window
RL_TOKEN_LONG_MAX_USER=500        # Max 500 requests per user per 15 minutes

# Standard Operations (Logout, Profile, Platform Access)
# More generous limits for regular operations
RL_STANDARD_WINDOW_MS=60000       # 1 minute window  
RL_STANDARD_MAX_IP=60             # Max 60 requests per IP per minute

# Bypass Configuration for Internal Services
RL_BYPASS_ENABLED=true
RL_BYPASS_JWT_AUD=fanzfinance-os,fanz-internal
RL_BYPASS_SERVICE_CLAIM=fanzfinance-os
RL_BYPASS_API_KEYS=

# ===========================================
# RATE LIMITING RECOMMENDATIONS BY ENVIRONMENT
# ===========================================

# DEVELOPMENT (Current settings above)
# - Generous limits for easier development
# - All logging enabled for debugging

# STAGING 
# RL_SENSITIVE_MAX_IP=3
# RL_SENSITIVE_MAX_ACCOUNT=2  
# RL_TOKEN_MAX_IP=20
# RL_STANDARD_MAX_IP=40

# PRODUCTION
# RL_SENSITIVE_MAX_IP=2           # Very strict for production
# RL_SENSITIVE_MAX_ACCOUNT=1      # Only 1 attempt per account per minute
# RL_TOKEN_MAX_IP=15              # Lower token limits
# RL_STANDARD_MAX_IP=30           # Conservative standard limits
# RL_LOGGING_LEVEL=error          # Reduce logging noise

# ===========================================
# SECURITY NOTES
# ===========================================

# 1. HMAC Secret: 
#    - Must be changed in production
#    - Should be at least 32 characters
#    - Store in secure secret management (AWS Secrets Manager, etc.)

# 2. Rate Limit Bypass:
#    - Only enable for trusted internal services
#    - Use API keys or JWT claims to identify internal services
#    - Regularly rotate API keys

# 3. Monitoring:
#    - Monitor 429 response rates
#    - Set up alerts for unusual patterns
#    - Review rate limit effectiveness regularly

# 4. Tuning:
#    - Start with conservative limits
#    - Gradually adjust based on legitimate usage patterns  
#    - Different limits for different environments